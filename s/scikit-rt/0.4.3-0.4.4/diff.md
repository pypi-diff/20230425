# Comparing `tmp/scikit-rt-0.4.3.tar.gz` & `tmp/scikit-rt-0.4.4.tar.gz`

## filetype from file(1)

```diff
@@ -1 +1 @@
-gzip compressed data, was "scikit-rt-0.4.3.tar", last modified: Mon Apr 17 11:28:49 2023, max compression
+gzip compressed data, was "scikit-rt-0.4.4.tar", last modified: Tue Apr 25 08:43:09 2023, max compression
```

## Comparing `scikit-rt-0.4.3.tar` & `scikit-rt-0.4.4.tar`

### file list

```diff
@@ -1,71 +1,71 @@
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-17 11:28:49.870790 scikit-rt-0.4.3/
--rw-r--r--   0 runner    (1001) docker     (123)    35129 2023-04-17 11:24:43.000000 scikit-rt-0.4.3/LICENSE
--rw-r--r--   0 runner    (1001) docker     (123)     1590 2023-04-17 11:28:49.870790 scikit-rt-0.4.3/PKG-INFO
--rw-r--r--   0 runner    (1001) docker     (123)     1208 2023-04-17 11:24:43.000000 scikit-rt-0.4.3/README.md
--rw-r--r--   0 runner    (1001) docker     (123)      818 2023-04-17 11:24:43.000000 scikit-rt-0.4.3/pypi.md
--rw-r--r--   0 runner    (1001) docker     (123)      108 2023-04-17 11:24:43.000000 scikit-rt-0.4.3/pyproject.toml
--rw-r--r--   0 runner    (1001) docker     (123)     2839 2023-04-17 11:28:49.874790 scikit-rt-0.4.3/setup.cfg
--rw-r--r--   0 runner    (1001) docker     (123)       37 2023-04-17 11:24:43.000000 scikit-rt-0.4.3/setup.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-17 11:28:49.846790 scikit-rt-0.4.3/src/
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-17 11:28:49.850790 scikit-rt-0.4.3/src/scikit_rt.egg-info/
--rw-r--r--   0 runner    (1001) docker     (123)     1590 2023-04-17 11:28:49.000000 scikit-rt-0.4.3/src/scikit_rt.egg-info/PKG-INFO
--rw-r--r--   0 runner    (1001) docker     (123)     1819 2023-04-17 11:28:49.000000 scikit-rt-0.4.3/src/scikit_rt.egg-info/SOURCES.txt
--rw-r--r--   0 runner    (1001) docker     (123)        1 2023-04-17 11:28:49.000000 scikit-rt-0.4.3/src/scikit_rt.egg-info/dependency_links.txt
--rw-r--r--   0 runner    (1001) docker     (123)     1936 2023-04-17 11:28:49.000000 scikit-rt-0.4.3/src/scikit_rt.egg-info/requires.txt
--rw-r--r--   0 runner    (1001) docker     (123)        5 2023-04-17 11:28:49.000000 scikit-rt-0.4.3/src/scikit_rt.egg-info/top_level.txt
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-17 11:28:49.858790 scikit-rt-0.4.3/src/skrt/
--rw-r--r--   0 runner    (1001) docker     (123)      620 2023-04-17 11:24:43.000000 scikit-rt-0.4.3/src/skrt/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)    12816 2023-04-17 11:24:43.000000 scikit-rt-0.4.3/src/skrt/application.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-17 11:28:49.862790 scikit-rt-0.4.3/src/skrt/better_viewer/
--rw-r--r--   0 runner    (1001) docker     (123)   131500 2023-04-17 11:24:43.000000 scikit-rt-0.4.3/src/skrt/better_viewer/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)     3920 2023-04-17 11:24:43.000000 scikit-rt-0.4.3/src/skrt/better_viewer/options.py
--rw-r--r--   0 runner    (1001) docker     (123)    72208 2023-04-17 11:24:43.000000 scikit-rt-0.4.3/src/skrt/core.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-17 11:28:49.846790 scikit-rt-0.4.3/src/skrt/data/
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-17 11:28:49.862790 scikit-rt-0.4.3/src/skrt/data/elastix_parameter_files/
--rwxr-xr-x   0 runner    (1001) docker     (123)     1732 2023-04-17 11:24:43.000000 scikit-rt-0.4.3/src/skrt/data/elastix_parameter_files/BE_BSpline05.txt
--rwxr-xr-x   0 runner    (1001) docker     (123)     1801 2023-04-17 11:24:43.000000 scikit-rt-0.4.3/src/skrt/data/elastix_parameter_files/MI_Affine.txt
--rwxr-xr-x   0 runner    (1001) docker     (123)     1649 2023-04-17 11:24:43.000000 scikit-rt-0.4.3/src/skrt/data/elastix_parameter_files/MI_BSpline05.txt
--rwxr-xr-x   0 runner    (1001) docker     (123)     1650 2023-04-17 11:24:43.000000 scikit-rt-0.4.3/src/skrt/data/elastix_parameter_files/MI_BSpline15.txt
--rwxr-xr-x   0 runner    (1001) docker     (123)     1650 2023-04-17 11:24:43.000000 scikit-rt-0.4.3/src/skrt/data/elastix_parameter_files/MI_BSpline30.txt
--rwxr-xr-x   0 runner    (1001) docker     (123)     1798 2023-04-17 11:24:43.000000 scikit-rt-0.4.3/src/skrt/data/elastix_parameter_files/MI_Rigid.txt
--rwxr-xr-x   0 runner    (1001) docker     (123)     1804 2023-04-17 11:24:43.000000 scikit-rt-0.4.3/src/skrt/data/elastix_parameter_files/MI_Translation.txt
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-17 11:28:49.862790 scikit-rt-0.4.3/src/skrt/data/niftyreg_parameter_files/
--rw-r--r--   0 runner    (1001) docker     (123)      141 2023-04-17 11:24:43.000000 scikit-rt-0.4.3/src/skrt/data/niftyreg_parameter_files/Affine.txt
--rw-r--r--   0 runner    (1001) docker     (123)      124 2023-04-17 11:24:43.000000 scikit-rt-0.4.3/src/skrt/data/niftyreg_parameter_files/BE_BSpline05.txt
--rw-r--r--   0 runner    (1001) docker     (123)      113 2023-04-17 11:24:43.000000 scikit-rt-0.4.3/src/skrt/data/niftyreg_parameter_files/NMI_BSpline05.txt
--rw-r--r--   0 runner    (1001) docker     (123)      115 2023-04-17 11:24:43.000000 scikit-rt-0.4.3/src/skrt/data/niftyreg_parameter_files/NMI_BSpline15.txt
--rw-r--r--   0 runner    (1001) docker     (123)      115 2023-04-17 11:24:43.000000 scikit-rt-0.4.3/src/skrt/data/niftyreg_parameter_files/NMI_BSpline30.txt
--rw-r--r--   0 runner    (1001) docker     (123)      205 2023-04-17 11:24:43.000000 scikit-rt-0.4.3/src/skrt/data/niftyreg_parameter_files/Rigid.txt
--rw-r--r--   0 runner    (1001) docker     (123)    23275 2023-04-17 11:24:43.000000 scikit-rt-0.4.3/src/skrt/dicom_writer.py
--rw-r--r--   0 runner    (1001) docker     (123)    35313 2023-04-17 11:24:43.000000 scikit-rt-0.4.3/src/skrt/dose.py
--rw-r--r--   0 runner    (1001) docker     (123)   239611 2023-04-17 11:24:43.000000 scikit-rt-0.4.3/src/skrt/image.py
--rw-r--r--   0 runner    (1001) docker     (123)     1738 2023-04-17 11:24:43.000000 scikit-rt-0.4.3/src/skrt/multi.py
--rw-r--r--   0 runner    (1001) docker     (123)   105267 2023-04-17 11:24:43.000000 scikit-rt-0.4.3/src/skrt/patient.py
--rw-r--r--   0 runner    (1001) docker     (123)   122005 2023-04-17 11:24:43.000000 scikit-rt-0.4.3/src/skrt/registration.py
--rw-r--r--   0 runner    (1001) docker     (123)    52538 2023-04-17 11:24:43.000000 scikit-rt-0.4.3/src/skrt/segmentation.py
--rw-r--r--   0 runner    (1001) docker     (123)    17553 2023-04-17 11:24:43.000000 scikit-rt-0.4.3/src/skrt/simulation.py
--rw-r--r--   0 runner    (1001) docker     (123)   349272 2023-04-17 11:24:43.000000 scikit-rt-0.4.3/src/skrt/structures.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-17 11:28:49.862790 scikit-rt-0.4.3/src/skrt/viewer/
--rw-r--r--   0 runner    (1001) docker     (123)       43 2023-04-17 11:24:43.000000 scikit-rt-0.4.3/src/skrt/viewer/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)   154795 2023-04-17 11:24:43.000000 scikit-rt-0.4.3/src/skrt/viewer/core.py
--rw-r--r--   0 runner    (1001) docker     (123)   113136 2023-04-17 11:24:43.000000 scikit-rt-0.4.3/src/skrt/viewer/viewer.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-17 11:28:49.870790 scikit-rt-0.4.3/tests/
--rw-r--r--   0 runner    (1001) docker     (123)      820 2023-04-17 11:24:43.000000 scikit-rt-0.4.3/tests/test_01_setup.py
--rw-r--r--   0 runner    (1001) docker     (123)    10063 2023-04-17 11:24:43.000000 scikit-rt-0.4.3/tests/test_application.py
--rw-r--r--   0 runner    (1001) docker     (123)    15414 2023-04-17 11:24:43.000000 scikit-rt-0.4.3/tests/test_core.py
--rw-r--r--   0 runner    (1001) docker     (123)     7248 2023-04-17 11:24:43.000000 scikit-rt-0.4.3/tests/test_dose.py
--rw-r--r--   0 runner    (1001) docker     (123)    58059 2023-04-17 11:24:43.000000 scikit-rt-0.4.3/tests/test_image.py
--rw-r--r--   0 runner    (1001) docker     (123)     1369 2023-04-17 11:24:43.000000 scikit-rt-0.4.3/tests/test_multi.py
--rw-r--r--   0 runner    (1001) docker     (123)     9168 2023-04-17 11:24:43.000000 scikit-rt-0.4.3/tests/test_patient.py
--rw-r--r--   0 runner    (1001) docker     (123)     1554 2023-04-17 11:24:43.000000 scikit-rt-0.4.3/tests/test_qv_image.py
--rw-r--r--   0 runner    (1001) docker     (123)     8791 2023-04-17 11:24:43.000000 scikit-rt-0.4.3/tests/test_qv_quickviewer.py
--rw-r--r--   0 runner    (1001) docker     (123)     6165 2023-04-17 11:24:43.000000 scikit-rt-0.4.3/tests/test_qv_struct_loader.py
--rw-r--r--   0 runner    (1001) docker     (123)     3876 2023-04-17 11:24:43.000000 scikit-rt-0.4.3/tests/test_qv_struct_metrics.py
--rw-r--r--   0 runner    (1001) docker     (123)     1156 2023-04-17 11:24:43.000000 scikit-rt-0.4.3/tests/test_qv_structs.py
--rw-r--r--   0 runner    (1001) docker     (123)    32378 2023-04-17 11:24:43.000000 scikit-rt-0.4.3/tests/test_registration.py
--rw-r--r--   0 runner    (1001) docker     (123)    21138 2023-04-17 11:24:43.000000 scikit-rt-0.4.3/tests/test_roi_metrics.py
--rw-r--r--   0 runner    (1001) docker     (123)     5429 2023-04-17 11:24:43.000000 scikit-rt-0.4.3/tests/test_segmentation.py
--rw-r--r--   0 runner    (1001) docker     (123)       35 2023-04-17 11:24:43.000000 scikit-rt-0.4.3/tests/test_simulation.py
--rw-r--r--   0 runner    (1001) docker     (123)    65888 2023-04-17 11:24:43.000000 scikit-rt-0.4.3/tests/test_structs.py
--rw-r--r--   0 runner    (1001) docker     (123)     2513 2023-04-17 11:24:43.000000 scikit-rt-0.4.3/tests/test_synthetic_image.py
--rw-r--r--   0 runner    (1001) docker     (123)     7725 2023-04-17 11:24:43.000000 scikit-rt-0.4.3/tests/test_viewer.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-25 08:43:09.202419 scikit-rt-0.4.4/
+-rw-r--r--   0 runner    (1001) docker     (123)    35129 2023-04-25 08:38:57.000000 scikit-rt-0.4.4/LICENSE
+-rw-r--r--   0 runner    (1001) docker     (123)     1590 2023-04-25 08:43:09.202419 scikit-rt-0.4.4/PKG-INFO
+-rw-r--r--   0 runner    (1001) docker     (123)     1505 2023-04-25 08:38:57.000000 scikit-rt-0.4.4/README.md
+-rw-r--r--   0 runner    (1001) docker     (123)      818 2023-04-25 08:38:57.000000 scikit-rt-0.4.4/pypi.md
+-rw-r--r--   0 runner    (1001) docker     (123)      108 2023-04-25 08:38:57.000000 scikit-rt-0.4.4/pyproject.toml
+-rw-r--r--   0 runner    (1001) docker     (123)     2839 2023-04-25 08:43:09.202419 scikit-rt-0.4.4/setup.cfg
+-rw-r--r--   0 runner    (1001) docker     (123)       37 2023-04-25 08:38:57.000000 scikit-rt-0.4.4/setup.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-25 08:43:09.194419 scikit-rt-0.4.4/src/
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-25 08:43:09.194419 scikit-rt-0.4.4/src/scikit_rt.egg-info/
+-rw-r--r--   0 runner    (1001) docker     (123)     1590 2023-04-25 08:43:08.000000 scikit-rt-0.4.4/src/scikit_rt.egg-info/PKG-INFO
+-rw-r--r--   0 runner    (1001) docker     (123)     1819 2023-04-25 08:43:09.000000 scikit-rt-0.4.4/src/scikit_rt.egg-info/SOURCES.txt
+-rw-r--r--   0 runner    (1001) docker     (123)        1 2023-04-25 08:43:08.000000 scikit-rt-0.4.4/src/scikit_rt.egg-info/dependency_links.txt
+-rw-r--r--   0 runner    (1001) docker     (123)     1936 2023-04-25 08:43:08.000000 scikit-rt-0.4.4/src/scikit_rt.egg-info/requires.txt
+-rw-r--r--   0 runner    (1001) docker     (123)        5 2023-04-25 08:43:08.000000 scikit-rt-0.4.4/src/scikit_rt.egg-info/top_level.txt
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-25 08:43:09.198419 scikit-rt-0.4.4/src/skrt/
+-rw-r--r--   0 runner    (1001) docker     (123)      620 2023-04-25 08:38:57.000000 scikit-rt-0.4.4/src/skrt/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)    12816 2023-04-25 08:38:57.000000 scikit-rt-0.4.4/src/skrt/application.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-25 08:43:09.198419 scikit-rt-0.4.4/src/skrt/better_viewer/
+-rw-r--r--   0 runner    (1001) docker     (123)   132020 2023-04-25 08:38:57.000000 scikit-rt-0.4.4/src/skrt/better_viewer/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3920 2023-04-25 08:38:57.000000 scikit-rt-0.4.4/src/skrt/better_viewer/options.py
+-rw-r--r--   0 runner    (1001) docker     (123)    73050 2023-04-25 08:38:57.000000 scikit-rt-0.4.4/src/skrt/core.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-25 08:43:09.194419 scikit-rt-0.4.4/src/skrt/data/
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-25 08:43:09.198419 scikit-rt-0.4.4/src/skrt/data/elastix_parameter_files/
+-rwxr-xr-x   0 runner    (1001) docker     (123)     1732 2023-04-25 08:38:57.000000 scikit-rt-0.4.4/src/skrt/data/elastix_parameter_files/BE_BSpline05.txt
+-rwxr-xr-x   0 runner    (1001) docker     (123)     1801 2023-04-25 08:38:57.000000 scikit-rt-0.4.4/src/skrt/data/elastix_parameter_files/MI_Affine.txt
+-rwxr-xr-x   0 runner    (1001) docker     (123)     1649 2023-04-25 08:38:57.000000 scikit-rt-0.4.4/src/skrt/data/elastix_parameter_files/MI_BSpline05.txt
+-rwxr-xr-x   0 runner    (1001) docker     (123)     1650 2023-04-25 08:38:57.000000 scikit-rt-0.4.4/src/skrt/data/elastix_parameter_files/MI_BSpline15.txt
+-rwxr-xr-x   0 runner    (1001) docker     (123)     1650 2023-04-25 08:38:57.000000 scikit-rt-0.4.4/src/skrt/data/elastix_parameter_files/MI_BSpline30.txt
+-rwxr-xr-x   0 runner    (1001) docker     (123)     1798 2023-04-25 08:38:57.000000 scikit-rt-0.4.4/src/skrt/data/elastix_parameter_files/MI_Rigid.txt
+-rwxr-xr-x   0 runner    (1001) docker     (123)     1804 2023-04-25 08:38:57.000000 scikit-rt-0.4.4/src/skrt/data/elastix_parameter_files/MI_Translation.txt
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-25 08:43:09.198419 scikit-rt-0.4.4/src/skrt/data/niftyreg_parameter_files/
+-rw-r--r--   0 runner    (1001) docker     (123)      141 2023-04-25 08:38:57.000000 scikit-rt-0.4.4/src/skrt/data/niftyreg_parameter_files/Affine.txt
+-rw-r--r--   0 runner    (1001) docker     (123)      124 2023-04-25 08:38:57.000000 scikit-rt-0.4.4/src/skrt/data/niftyreg_parameter_files/BE_BSpline05.txt
+-rw-r--r--   0 runner    (1001) docker     (123)      113 2023-04-25 08:38:57.000000 scikit-rt-0.4.4/src/skrt/data/niftyreg_parameter_files/NMI_BSpline05.txt
+-rw-r--r--   0 runner    (1001) docker     (123)      115 2023-04-25 08:38:57.000000 scikit-rt-0.4.4/src/skrt/data/niftyreg_parameter_files/NMI_BSpline15.txt
+-rw-r--r--   0 runner    (1001) docker     (123)      115 2023-04-25 08:38:57.000000 scikit-rt-0.4.4/src/skrt/data/niftyreg_parameter_files/NMI_BSpline30.txt
+-rw-r--r--   0 runner    (1001) docker     (123)      205 2023-04-25 08:38:57.000000 scikit-rt-0.4.4/src/skrt/data/niftyreg_parameter_files/Rigid.txt
+-rw-r--r--   0 runner    (1001) docker     (123)    23275 2023-04-25 08:38:57.000000 scikit-rt-0.4.4/src/skrt/dicom_writer.py
+-rw-r--r--   0 runner    (1001) docker     (123)    39459 2023-04-25 08:38:57.000000 scikit-rt-0.4.4/src/skrt/dose.py
+-rw-r--r--   0 runner    (1001) docker     (123)   240666 2023-04-25 08:38:57.000000 scikit-rt-0.4.4/src/skrt/image.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1738 2023-04-25 08:38:57.000000 scikit-rt-0.4.4/src/skrt/multi.py
+-rw-r--r--   0 runner    (1001) docker     (123)   105267 2023-04-25 08:38:57.000000 scikit-rt-0.4.4/src/skrt/patient.py
+-rw-r--r--   0 runner    (1001) docker     (123)   132720 2023-04-25 08:38:57.000000 scikit-rt-0.4.4/src/skrt/registration.py
+-rw-r--r--   0 runner    (1001) docker     (123)    52538 2023-04-25 08:38:57.000000 scikit-rt-0.4.4/src/skrt/segmentation.py
+-rw-r--r--   0 runner    (1001) docker     (123)    17553 2023-04-25 08:38:57.000000 scikit-rt-0.4.4/src/skrt/simulation.py
+-rw-r--r--   0 runner    (1001) docker     (123)   351006 2023-04-25 08:38:57.000000 scikit-rt-0.4.4/src/skrt/structures.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-25 08:43:09.198419 scikit-rt-0.4.4/src/skrt/viewer/
+-rw-r--r--   0 runner    (1001) docker     (123)       43 2023-04-25 08:38:57.000000 scikit-rt-0.4.4/src/skrt/viewer/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)   154795 2023-04-25 08:38:57.000000 scikit-rt-0.4.4/src/skrt/viewer/core.py
+-rw-r--r--   0 runner    (1001) docker     (123)   113136 2023-04-25 08:38:57.000000 scikit-rt-0.4.4/src/skrt/viewer/viewer.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-04-25 08:43:09.202419 scikit-rt-0.4.4/tests/
+-rw-r--r--   0 runner    (1001) docker     (123)      820 2023-04-25 08:38:57.000000 scikit-rt-0.4.4/tests/test_01_setup.py
+-rw-r--r--   0 runner    (1001) docker     (123)    10063 2023-04-25 08:38:57.000000 scikit-rt-0.4.4/tests/test_application.py
+-rw-r--r--   0 runner    (1001) docker     (123)    15414 2023-04-25 08:38:57.000000 scikit-rt-0.4.4/tests/test_core.py
+-rw-r--r--   0 runner    (1001) docker     (123)     7248 2023-04-25 08:38:57.000000 scikit-rt-0.4.4/tests/test_dose.py
+-rw-r--r--   0 runner    (1001) docker     (123)    58059 2023-04-25 08:38:57.000000 scikit-rt-0.4.4/tests/test_image.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1369 2023-04-25 08:38:57.000000 scikit-rt-0.4.4/tests/test_multi.py
+-rw-r--r--   0 runner    (1001) docker     (123)     9168 2023-04-25 08:38:57.000000 scikit-rt-0.4.4/tests/test_patient.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1554 2023-04-25 08:38:57.000000 scikit-rt-0.4.4/tests/test_qv_image.py
+-rw-r--r--   0 runner    (1001) docker     (123)     8791 2023-04-25 08:38:57.000000 scikit-rt-0.4.4/tests/test_qv_quickviewer.py
+-rw-r--r--   0 runner    (1001) docker     (123)     6165 2023-04-25 08:38:57.000000 scikit-rt-0.4.4/tests/test_qv_struct_loader.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3876 2023-04-25 08:38:57.000000 scikit-rt-0.4.4/tests/test_qv_struct_metrics.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1156 2023-04-25 08:38:57.000000 scikit-rt-0.4.4/tests/test_qv_structs.py
+-rw-r--r--   0 runner    (1001) docker     (123)    34152 2023-04-25 08:38:57.000000 scikit-rt-0.4.4/tests/test_registration.py
+-rw-r--r--   0 runner    (1001) docker     (123)    21138 2023-04-25 08:38:57.000000 scikit-rt-0.4.4/tests/test_roi_metrics.py
+-rw-r--r--   0 runner    (1001) docker     (123)     5429 2023-04-25 08:38:57.000000 scikit-rt-0.4.4/tests/test_segmentation.py
+-rw-r--r--   0 runner    (1001) docker     (123)       35 2023-04-25 08:38:57.000000 scikit-rt-0.4.4/tests/test_simulation.py
+-rw-r--r--   0 runner    (1001) docker     (123)    65888 2023-04-25 08:38:57.000000 scikit-rt-0.4.4/tests/test_structs.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2513 2023-04-25 08:38:57.000000 scikit-rt-0.4.4/tests/test_synthetic_image.py
+-rw-r--r--   0 runner    (1001) docker     (123)     7725 2023-04-25 08:38:57.000000 scikit-rt-0.4.4/tests/test_viewer.py
```

### Comparing `scikit-rt-0.4.3/LICENSE` & `scikit-rt-0.4.4/LICENSE`

 * *Files identical despite different names*

### Comparing `scikit-rt-0.4.3/PKG-INFO` & `scikit-rt-0.4.4/PKG-INFO`

 * *Files 9% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: scikit-rt
-Version: 0.4.3
+Version: 0.4.4
 Summary: Toolkit for analysis of radiotherapy data
 Home-page: https://github.com/scikit-rt/scikit-rt
 Author: H. Pullen, K. Harrison
 Author-email: scikit-rt@hep.phy.cam.ac.uk
 License: UNKNOWN
 Project-URL: Bug Tracker, https://github.com/scikit-rt/scikit-rt/issues
 Description: # Scikit-rt
```

### Comparing `scikit-rt-0.4.3/README.md` & `scikit-rt-0.4.4/README.md`

 * *Files 18% similar despite different names*

```diff
@@ -4,14 +4,18 @@
 radiotherapy data in [DICOM](https://www.dicomstandard.org/) and
 [NIfTI](https://nifti.nimh.nih.gov/) formats.  It includes
 image registration via [elastix](https://elastix.lumc.nl/)
 and [NiftyReg](http://cmictig.cs.ucl.ac.uk/wiki/index.php/NiftyReg),
 single- and multi-atlas segmentation, and region-of-interest (ROI)
 comparisons.
 
+Documentation: [https://scikit-rt.github.io/scikit-rt/](https://scikit-rt.github.io/scikit-rt/)  
+Code repository: [https://github.com/scikit-rt/scikit-rt/](https://github.com/scikit-rt/scikit-rt/)  
+PyPI project page: [https://pypi.org/project/scikit-rt/](https://pypi.org/project/scikit-rt/)  
+
 This work was supported by Cancer Research UK RadNet Cambridge [C17918/A28870].
 
 <img src="docs/images/Radnet Cambridge.png" alt="RadNet logo" height="150"/>
 
 ## Help topics
 
 1. [Documentation and support](docs/markdown/support.md)
```

### Comparing `scikit-rt-0.4.3/pypi.md` & `scikit-rt-0.4.4/pypi.md`

 * *Files identical despite different names*

### Comparing `scikit-rt-0.4.3/setup.cfg` & `scikit-rt-0.4.4/setup.cfg`

 * *Files 2% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 [metadata]
 name = scikit-rt
-version = 0.4.3
+version = 0.4.4
 author = H. Pullen, K. Harrison
 author_email = scikit-rt@hep.phy.cam.ac.uk
 description = Toolkit for analysis of radiotherapy data
 long_description = file: pypi.md
 long_description_content_type = text/markdown
 url = https://github.com/scikit-rt/scikit-rt
 project_urls =
```

### Comparing `scikit-rt-0.4.3/src/scikit_rt.egg-info/PKG-INFO` & `scikit-rt-0.4.4/src/scikit_rt.egg-info/PKG-INFO`

 * *Files 9% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: scikit-rt
-Version: 0.4.3
+Version: 0.4.4
 Summary: Toolkit for analysis of radiotherapy data
 Home-page: https://github.com/scikit-rt/scikit-rt
 Author: H. Pullen, K. Harrison
 Author-email: scikit-rt@hep.phy.cam.ac.uk
 License: UNKNOWN
 Project-URL: Bug Tracker, https://github.com/scikit-rt/scikit-rt/issues
 Description: # Scikit-rt
```

### Comparing `scikit-rt-0.4.3/src/scikit_rt.egg-info/SOURCES.txt` & `scikit-rt-0.4.4/src/scikit_rt.egg-info/SOURCES.txt`

 * *Files identical despite different names*

### Comparing `scikit-rt-0.4.3/src/scikit_rt.egg-info/requires.txt` & `scikit-rt-0.4.4/src/scikit_rt.egg-info/requires.txt`

 * *Files identical despite different names*

### Comparing `scikit-rt-0.4.3/src/skrt/__init__.py` & `scikit-rt-0.4.4/src/skrt/__init__.py`

 * *Files identical despite different names*

### Comparing `scikit-rt-0.4.3/src/skrt/application.py` & `scikit-rt-0.4.4/src/skrt/application.py`

 * *Files identical despite different names*

### Comparing `scikit-rt-0.4.3/src/skrt/better_viewer/__init__.py` & `scikit-rt-0.4.4/src/skrt/better_viewer/__init__.py`

 * *Files 1% similar despite different names*

```diff
@@ -6,37 +6,39 @@
 import matplotlib as mpl
 import matplotlib.pyplot as plt
 import numpy as np
 import os
 import pandas as pd
 import re
 
-from skrt.core import is_list
+from skrt.core import is_list, Defaults
 from skrt.image import (
     get_mask,
     Image, 
     ImageComparison,
     _axes, 
     _slice_axes, 
     _plot_axes,
     _default_figsize,
 )
 from skrt.dose import Dose
-from skrt.registration import Grid, DeformationField, Jacobian
+from skrt.registration import engines, Grid, DeformationField, Jacobian
 from skrt.structures import (
     StructureSet, 
     ROI, 
     get_colored_roi_string, 
     df_to_html,
     compare_roi_pairs
 )
 
 # ipywidgets settings
 _style = {'description_width': 'initial'}
 
+# Set default for whether to omit user-interface elements.
+Defaults({"no_ui": False})
 
 class BetterViewer:
     '''Display multiple SingleViewers and/or comparison images.'''
 
     def __init__(
         self,
         images=None,
@@ -65,15 +67,15 @@
         show_mse=False,
         dta_tolerance=5,
         dta_crit=1,
         diff_crit=15,
         suptitle=None,
         show=True,
         include_image=False,
-        no_ui=False,
+        no_ui=None,
         ylabel_first_only=True,
         yticks_first_only=False,
         ytick_labels_first_only=True,
         colorbar_last_only=True,
         **kwargs,
     ):
         '''
@@ -315,16 +317,19 @@
         translation : bool, default=False
             If True, widgets will be displayed allowing the user to apply a
             translation to the image. Note that this will not change the Image
             object itself, only the image displayed in the viewer.
 
         translation_write_style : bool, default="normal"
             Method for writing translations to a file. Can either be "normal"
-            (will write x, y, z translations) or "shift" (will shift 
-            translations in an elastix transform file).
+            (will write x, y, z translations) or the name of a
+            registration engine (will shift translations in
+            a registration transform file).  For historical reasons,
+            "shift" is accepted as a synonym for "elastix" as
+            registration engine.
 
         show_mse : str, default=None
             Color for annotation of mean-squared-error if using comparison
             images. If None, no annotation will be added. Can be set to 'True'
             to use default colour (white).
 
         dta_tolerance : float, default=5
@@ -834,20 +839,21 @@
             and to the right hand side of the plot as well as below and to the
             left. The top/right ticks will not be labelled.
 
         include_image : bool, default=False
             If True, and image has associated image, overlay former on the
             latter.
 
-        no_ui : bool, default=False
+        no_ui : bool, default=None
             If True, omit user-interface elements (Jupyter widgets)
             for interaction with viewed image(s).  This can be useful
             for including graphics in stored notebooks.  On GitHub, for
             example, static plots in notebooks are rendered correctly,
-            but Jupyter widgets can cause problems.
+            but Jupyter widgets can cause problems.  If None, set to
+            the value of skrt.core.Default().no_ui.
         '''
 
         # Get image file inputs
         if not isinstance(images, list) or isinstance(images, tuple):
             self.images = [images]
         else:
             self.images = images
@@ -860,15 +866,15 @@
         self.rois = self.get_input_list(rois, allow_sublist=True)
         #  self.multi_rois = self.get_input_list(multi_rois, allow_sublist=True)
         self.grid = self.get_input_list(grid)
         self.jacobian = self.get_input_list(jacobian)
         self.df = self.get_input_list(df)
 
         # Define whether to omit user-interface elements.
-        self.no_ui = no_ui
+        self.no_ui = Defaults().no_ui if no_ui is None else no_ui
 
         self.colorbar = kwargs.pop('colorbar', False)
 
         # Set options for deformation field.
         self.df_kwargs = kwargs.get("df_kwargs", {})
         self.df_plot_type = kwargs.get("df_plot_type", "quiver")
         self.df_spacing = kwargs.get("df_spacing", 30)
@@ -952,14 +958,16 @@
             comparison_only
             and comparison is None
             and not any([show_cb, show_overlay, show_diff])
         ):
             comparison = True
         self.load_comparison(comparison)
         self.translation = translation
+        if "shift" == translation_write_style:
+            translation_write_style = "elastix"
         self.translation_write_style = translation_write_style
         self.show_mse = show_mse
         self.dta_tolerance = dta_tolerance
         self.dta_crit = dta_crit
         self.diff_crit = diff_crit
 
         # Settings needed for plotting
@@ -1344,19 +1352,20 @@
         output_file = self.translation_output.value
         if self.translation_write_style == "normal":
             out_text = ''.join(f'{ax} {self.tsliders[ax].value}\n' 
                                for ax in _axes)
             outfile = open(output_file, 'w')
             outfile.write(out_text)
             outfile.close()
-        elif self.translation_write_style == "shift": 
+        elif self.translation_write_style in engines: 
             from skrt.registration import shift_translation_parameters
             shift_translation_parameters(
                 output_file, 
-                *[self.tsliders[ax].value for ax in _axes]
+                *[self.tsliders[ax].value for ax in _axes],
+                engine=self.translation_write_style
             )
         else:
             print("Unrecognised translation writing option: " +
                   self.translation_write_style)
             return
         print('Wrote translation to file:', output_file)
```

### Comparing `scikit-rt-0.4.3/src/skrt/better_viewer/options.py` & `scikit-rt-0.4.4/src/skrt/better_viewer/options.py`

 * *Files identical despite different names*

### Comparing `scikit-rt-0.4.3/src/skrt/core.py` & `scikit-rt-0.4.4/src/skrt/core.py`

 * *Files 2% similar despite different names*

```diff
@@ -105,14 +105,18 @@
 # 'WARNING' (30), 'ERROR' (40), 'CRITICAL' (50)
 Defaults({"log_level": "WARNING"})
 
 # Lengths of date and time stamps.
 Defaults({"len_date": 8})
 Defaults({"len_time": 6})
 
+# Define whether to call compress_user(), when printing the attributes
+# of a Data object, for each string corresponding to a file path.
+Defaults({"compress_user": False})
+
 
 class Data:
     """
     Base class for objects serving as data containers.
     An object has user-defined data attributes, which may include
     other Data objects and lists of Data objects.
 
@@ -187,15 +191,15 @@
                 if n:
                     if depth > 0:
                         value_string = "["
                         for i, item in enumerate(items):
                             try:
                                 item_string = item.__repr__(depth=(depth - 1))
                             except TypeError:
-                                item_string = item.__repr__()
+                                item_string = self.get_item_string(item)
                             comma = "," if (i + 1 < n) else ""
                             value_string = f"{value_string} {item_string}{comma}"
                         value_string = f"{value_string}]"
                     else:
                         value_string = f"[{n} * {item[0].__class__}]"
                 else:
                     value_string = "[]"
@@ -208,15 +212,15 @@
                     if depth > 0:
                         value_string = "{"
                         for i, (key, value) in enumerate(items.items()):
                             item_string = "{key}: "
                             try:
                                 item_string += item.__repr__(depth=(depth - 1))
                             except TypeError:
-                                item_string += item.__repr__()
+                                item_string += self.get_item_string(item)
                             comma = "," if (i + 1 < n) else ""
                             value_string = f"{value_string} {item_string}{comma}"
                         value_string = f"{{{value_string}}}"
                     else:
                         value_string = f"{{{n} * keys of type {list(item.keys())[0].__class__}}}"
                 else:
                     value_string = "{}"
@@ -229,20 +233,38 @@
             else:
                 if issubclass(item.__class__, Data):
                     if depth > 0:
                         value_string = item.__repr__(depth=(depth - 1))
                     else:
                         value_string = f"{item.__class__}"
                 else:
-                    value_string = item.__repr__()
+                    value_string = self.get_item_string(item)
             out.append(f"  {key}: {value_string} ")
 
         out.append("}")
         return "\n".join(out)
 
+    def get_item_string(self, item):
+        """
+        Return string representation of an item.
+
+        If Defaults().compress_user is set to True, the function
+        compress_user() is called for each item corresponding to a file
+        path, where the file or its parent directory exists.
+        """
+        if (
+                Defaults().compress_user
+                and isinstance(item, (str, Path))
+                and (os.path.exists(str(item))
+                     or os.path.exists(os.path.dirname(str(item))))
+                ):
+            return compress_user(item)
+        else:
+            return item.__repr__()
+
     def clone(self, **kwargs):
         """
         Return a clone of the Data object. All attributes of the original
         object will be copied by reference to the new object, with some
         exceptions (see parameters below).
```

### Comparing `scikit-rt-0.4.3/src/skrt/data/elastix_parameter_files/BE_BSpline05.txt` & `scikit-rt-0.4.4/src/skrt/data/elastix_parameter_files/BE_BSpline05.txt`

 * *Files identical despite different names*

### Comparing `scikit-rt-0.4.3/src/skrt/data/elastix_parameter_files/MI_Affine.txt` & `scikit-rt-0.4.4/src/skrt/data/elastix_parameter_files/MI_Affine.txt`

 * *Files identical despite different names*

### Comparing `scikit-rt-0.4.3/src/skrt/data/elastix_parameter_files/MI_BSpline05.txt` & `scikit-rt-0.4.4/src/skrt/data/elastix_parameter_files/MI_BSpline05.txt`

 * *Files identical despite different names*

### Comparing `scikit-rt-0.4.3/src/skrt/data/elastix_parameter_files/MI_BSpline15.txt` & `scikit-rt-0.4.4/src/skrt/data/elastix_parameter_files/MI_BSpline15.txt`

 * *Files identical despite different names*

### Comparing `scikit-rt-0.4.3/src/skrt/data/elastix_parameter_files/MI_BSpline30.txt` & `scikit-rt-0.4.4/src/skrt/data/elastix_parameter_files/MI_BSpline30.txt`

 * *Files identical despite different names*

### Comparing `scikit-rt-0.4.3/src/skrt/data/elastix_parameter_files/MI_Rigid.txt` & `scikit-rt-0.4.4/src/skrt/data/elastix_parameter_files/MI_Rigid.txt`

 * *Files identical despite different names*

### Comparing `scikit-rt-0.4.3/src/skrt/data/elastix_parameter_files/MI_Translation.txt` & `scikit-rt-0.4.4/src/skrt/data/elastix_parameter_files/MI_Translation.txt`

 * *Files identical despite different names*

### Comparing `scikit-rt-0.4.3/src/skrt/dicom_writer.py` & `scikit-rt-0.4.4/src/skrt/dicom_writer.py`

 * *Files identical despite different names*

### Comparing `scikit-rt-0.4.3/src/skrt/dose.py` & `scikit-rt-0.4.4/src/skrt/dose.py`

 * *Files 3% similar despite different names*

```diff
@@ -257,15 +257,16 @@
             if hasattr(self, attribute):
                 delattr(self, attribute)
 
         # Initialise additional attributes
         self.dose_units = None
         self.dose_type = None
         self.dose_summation_type = None
-        
+        self.n_fraction = None
+        self._equivalent_dose = None
 
     def load(self, *args, **kwargs):
         """Load self and set default maximum plotting intensity from max of
         data array if not yet set."""
 
         skrt.image.Image.load(self, *args, **kwargs)
         self._default_vmax = self.data.max()
@@ -316,14 +317,20 @@
         self.load()
         return self.dose_type
 
     def get_dose_summation_type(self):
         self.load()
         return self.dose_summation_type
 
+    def get_n_fraction(self):
+        """Return number of dose fractions."""
+        if self.n_fraction is None and hasattr(self, "plan"):
+            self.n_fraction = self.plan.get_n_fraction()
+        return self.n_fraction
+
     def get_dose_in_roi_3d(self, roi, standardise=True):
         """Return copy of the dose array that has values retained
         inside an ROI, and set to zero elsewhere.  Fails if the
         ROI and dose arrays are not the same size."""
 
         roi.create_mask()
         if not self.has_same_geometry(roi.mask, standardise=standardise):
@@ -449,14 +456,18 @@
         if fname is not None:
             matplotlib.pyplot.savefig(fname)
         else:
             matplotlib.pyplot.show()
 
         return ax
 
+    def plot_DVH(self, *args, **kwargs):
+        """Alias for plot_dvh()."""
+        self.plot_dvh(*args, **kwargs)
+
     def get_mean_dose(self, roi):
         """Get mean dose inside an ROI."""
 
         doses = self.get_dose_in_roi(roi)
         if doses.size:
             return np.mean(doses)
         elif roi.get_volume(method="mask"):
@@ -471,134 +482,218 @@
 
     def get_bed(self, *args, **kwargs):
         """
         Alias for skrt.dose.Dose method get_biologically_effective_dose().
 
         See aliased method for documentation.
         """
+        self._equivalent_dose = "get_bed()"
         return self.get_biologically_effective_dose(*args, **kwargs)
 
-    def get_biologically_effective_dose(self, rois=None, alpha_beta_ratios=None,
+    def get_biologically_effective_dose(
+            self, rois=None, alpha_beta_ratios=None,
             n_fraction=None, fill=0, standardise=False, force=False):
         """
         Get a Dose object where array values are biologically effective dose.
 
         The biologically effective dose, BED, for a volume element
         characterised by linear and quadratic coefficients alpha and beta
         for the linear-quadratic equation, is related to the physical dose,
         D, delivered over n equal fractions as:
             BED = D * (1 + (D/n) / (alpha/beta)).
 
         **Parameters:**
 
         rois : ROI/StructureSet/list, default=None
-            Object(s) specifying ROIs for which biologically effective
-            dose is to be determined.  The object(s) can be a
-            single skrt.structures.ROI object, a single
-            skrt.structures.StructureSet object, or a list containing any
-            combination of ROI and StructureSet objects.
+            Object(s) specifying ROIs for which calculation is to be
+            performed.  The object(s) can be a single
+            skrt.structures.ROI object, a single skrt.structures.StructureSet
+            object, or a list containing any combination of ROI
+            and StructureSet objects.
+
+        alpha_beta_ratios : dict, default=None
+            By default, values of alpha over beta used are the values
+            set for individual ROIs, for example using
+            skrt.StructureSet.set_alpha_beta_ratios().  The default
+            values can be overridden here by passing a dictionary
+            where keys are ROI names and values are revised values
+            for alpha over beta.
+
+        n_fraction : float, default=None
+            Number of equal-dose fractions over which physical total dose
+            is delivered.  If None, the value returned by
+            self.get_n_fraction() is used.
+
+        fill : float/None, default=0
+            Specification of dose value to set outside of ROIs, and for ROIs
+            where alpha over beta has a null value.  If a float, this is
+            used as the default dose value.  If None, physical-dose values
+            are retained.
+
+        standardise : bool, default=False
+            If False, the data arrays for Doses and for ROI masks will be
+            kept in the orientation in which they were loaded; otherwise,
+            they will be converted to standard dicom-style orientation,
+            such that [column, row, slice] corresponds to the [x, y, z] axes.
+
+        force : bool, default=False
+            Determine action if the current dose object has
+            dose_type set to "EFFECTIVE".  If False, write an error message,
+            and don't apply the formula for recalculating dose.  If
+            True, apply the formula, even if the dose_type suggests that
+            dose values have already been corrected for biological effect.
+        """
+        self._equivalent_dose = "get_biologically_effective_dose()"
+        return self.get_equivalent_dose(
+                dose_rate=0, rois=rois, alpha_beta_ratios=alpha_beta_ratios,
+                n_fraction=n_fraction, fill=fill, standardise=standardise,
+                force=force)
+
+    def get_eqd(self, *args, **kwargs):
+        """
+        Alias for skrt.dose.Dose method get_equivalent_dose().
+
+        See aliased method for documentation.
+        """
+        self._equivalent_dose = "get_eqd()"
+        return self.get_equivalent_dose(*args, **kwargs)
+
+    def get_equivalent_dose(
+            self, dose_rate=2, rois=None, alpha_beta_ratios=None,
+            n_fraction=None, fill=0, standardise=False, force=False):
+        """
+        Get a Dose object where array values are equivalent dose
+        for a specified dose per fraction.
+
+        If a physical dose, D, is delivered over n equal fractions to a
+        volume element characterised by linear and quadratic coefficients
+        alpha and beta for the linear-quadratic equation, the total equivalent
+        dose, EQDd, at a dose rate d per fraction, is:
+            EQDd = D * ((D/n) + (alpha/beta)) / (d + (alpha/beta)).
+        It approaches the biologically effective dose, BED,
+        as d tends to zero:
+            EQD0 = D * (1 + (D/n) / (alpha/beta)) = BED.
+
+        **Parameters:**
+
+        dose_rate : float, default=2
+            Dose (Gy) per fraction for which calculation is to be determined.
+
+        rois : ROI/StructureSet/list, default=None
+            Object(s) specifying ROIs for which calculation is to be
+            performed.  The object(s) can be a single
+            skrt.structures.ROI object, a single skrt.structures.StructureSet
+            object, or a list containing any combination of ROI
+            and StructureSet objects.
 
         alpha_beta_ratios : dict, default=None
             By default, values of alpha over beta used are the values
             set for individual ROIs, for example using
             skrt.StructureSet.set_alpha_beta_ratios().  The default
             values can be overridden here by passing a dictionary
             where keys are ROI names and values are revised values
             for alpha over beta.
 
         n_fraction : float, default=None
-            Number of equal-dose fractions over which physical dose
-            is delivered.  If None, and the dose has an associated plan,
-            the value returned by self.plan.get_n_fraction() is used.
+            Number of equal-dose fractions over which physical total dose
+            is delivered.  If None, the value returned by
+            self.get_n_fraction() is used.
 
-        fill : float/str, default=0
+        fill : float/None, default=0
             Specification of dose value to set outside of ROIs, and for ROIs
             where alpha over beta has a null value.  If a float, this is
-            used as the default dose value.  If 'physical_dose", physical-dose
-            values are retained.
+            used as the default dose value.  If None, physical-dose values
+            are retained.
 
         standardise : bool, default=False
             If False, the data arrays for Doses and for ROI masks will be
             kept in the orientation in which they were loaded; otherwise,
             they will be converted to standard dicom-style orientation,
             such that [column, row, slice] corresponds to the [x, y, z] axes.
 
         force : bool, default=False
             Determine action if the current dose object has
             dose_type set to "EFFECTIVE".  If False, write an error message,
-            and don't apply the formula for biologically effective dose.  If
+            and don't apply the formula for recalculating dose.  If
             True, apply the formula, even if the dose_type suggests that
-            values already represent biologically effective dose.
+            dose values have already been corrected for biological effect.
         """
-        # Check that the input parameter allow
-        # calculation of biologically effective dose.
+        # Ensure that a method name is set.
+        if self._equivalent_dose is None:
+            self._equivalent_dose = "get_equivalent_dose()"
 
-        if not isinstance(fill, numbers.Number) and fill != "physical_dose":
+        # Check input values.
+        if not isinstance(fill, numbers.Number) and fill is not None:
             self.logger.error(f"Value of fill set to '{fill}' "
-                    "but must be 'physical_dose' or a number.")
+                    "but must be a number or None.")
+            self._equivalent_dose = None
             return
 
         self.load()
         if "EFFECTIVE" == self.dose_type and not force:
-            self.logger.error("Method get_biologically_effective_dose() called "
+            self.logger.error(f"Method {self._equivalent_dose} called "
                     f"for dose with type '{self.dose_type}'.  "
                     "If this is the intention, repeat call with 'force=True'")
+            self._equivalent_dose = None
             return
 
         rois = skrt.structures.get_all_rois(rois)
         if not rois:
-            self.logger.error("Method get_biologically_effective_dose() called "
+            self.logger.error(f"Method {self._equivalent_dose} called "
                 "without specifying any ROIs.")
+            self._equivalent_dose = None
             return
 
         if not n_fraction:
-            if hasattr(self, "plan"):
-                n_fraction = self.plan.get_n_fraction()
+            n_fraction = self.get_n_fraction()
 
         if not n_fraction:
-            self.logger.error("Method get_biologically_effective_dose() called "
+            self.logger.error(f"Method {self._equivalent_dose} called "
                 "without specifying number of fractions.")
+            self._equivalent_dose = None
             return
 
         # Set default dose to be fill value.
         if isinstance(fill, numbers.Number):
-            bed = Dose(
+            dose = Dose(
                     path=(fill *
                         np.ones(self.get_data(standardise=standardise).shape)),
                     affine=self.get_affine(standardise=standardise))
-        # Set default dose to be physical dose.
-        elif "physical_dose" == fill:
-            bed = Dose(
+        # Set default dose to be initial dose.
+        elif fill is None:
+            dose = Dose(
                     path=self.get_data(standardise=standardise),
                     affine=self.get_affine(standardise=standardise))
 
-        # Calculate biologically effective dose
-        # inside ROIs with alpha/beta defined.
+        # Calculate equivalent dose inside ROIs with alpha/beta defined.
         for roi in rois:
             # For current ROI, use alpha/beta given in input,
             # or use the value assigned to the ROI.
             alpha_over_beta = alpha_beta_ratios.get(
                     roi.name, roi.alpha_over_beta)
             # If alpha/beta is defined,
-            # calculate the biologically effective dose.
+            # calculate the equivalent dose.
             if alpha_over_beta is not None:
                 dose_in_roi = self.get_dose_in_roi_3d(
                         roi, standardise=standardise)
-                dose_in_roi += ((dose_in_roi * dose_in_roi)
-                        / (n_fraction * alpha_over_beta))
-                bed.data[dose_in_roi > 0] = dose_in_roi[dose_in_roi > 0]
+                dose_in_roi *= ((alpha_over_beta + dose_in_roi / n_fraction)
+                                / (dose_rate + alpha_over_beta))
+                dose.data[dose_in_roi > 0] = dose_in_roi[dose_in_roi > 0]
 
         # Reset the default maximum plotting intensity
         # from the maximum of the data array.
-        bed._default_vmax = bed.data.max()
-
-        # Set dose_type to indicate that this is biologically effective dose.
-        bed.dose_type = "EFFECTIVE"
+        dose._default_vmax = dose.data.max()
 
-        return bed
+        # Set dose_type to indicate that biological effect
+        # is taken into account.
+        dose.dose_type = "EFFECTIVE"
+
+        # Unset method name - it will be reset by the next caller.
+        self._equivalent_dose = None
+        return dose
 
 class Plan(skrt.core.Archive):
     """
     Class representing a radiotherapy plan.
 
     Attributes of a Plan object should usually be accessed via
     their getter methods, rather than directly, to ensure that
```

### Comparing `scikit-rt-0.4.3/src/skrt/image.py` & `scikit-rt-0.4.4/src/skrt/image.py`

 * *Files 1% similar despite different names*

```diff
@@ -181,27 +181,28 @@
             if title is not None:
                 self.title = title
             return
 
         # Otherwise, load from source
         self.data = None
         self.title = title
-        self.source = str(path) if isinstance(path, pathlib.Path) else path
+        self.source = (skrt.core.fullpath(path)
+                       if isinstance(path, (str, pathlib.Path)) else path)
         if isinstance(self.source, str):
             self.source = sorted(glob.glob(self.source),
                     key=skrt.core.alphanumeric)
             if 1 == len(self.source):
                 self.source = self.source[0]
             elif not self.source:
                 self.source = ""
         elif isinstance(self.source, (list, set, tuple)):
             paths = list(self.source)
             self.source = []
             for path in paths:
-                self.source.extend(glob.glob(str(path)))
+                self.source.extend(glob.glob(skrt.core.fullpath(path)))
 
         self.source_type = None
         self.dicom_dataset = None
         self.voxel_size = list(voxel_size) if voxel_size is not None else None
         self.origin = list(origin) if origin is not None else None
         self.affine = affine
         self.downsampling = downsample
@@ -414,15 +415,15 @@
         '''
 
         # Check if the requested type is recognised.
         nii_type = itype in ['nii', 'nifti']
         dcm_type = itype in ['dcm', 'dicom']
 
         if nii_type or dcm_type:
-            # Ensure that image is loaded, and created clone.
+            # Ensure that image is loaded, and create clone.
             self.load()
             im = self.__class__(self)
 
             # Modify image data if source_type isn't the requested type.
             if ((nii_type and 'nifti' not in self.source_type)
                     or (dcm_type and 'nifti' in self.source_type)):
                 affine = self.affine.copy()
@@ -919,15 +920,16 @@
             window_width = self.rgb_rescale_slope
 
         # If still None, raise exception
         if self.data is None:
             raise RuntimeError(f"{self.source} not a valid image source!")
 
         # Cast to custom type
-        if self._custom_dtype is not None:
+        if (self._custom_dtype is not None
+            and self.data.dtype != self._custom_dtype):
             self.data = self.data.astype(self._custom_dtype)
 
         # Ensure array is 3D
         if self.data.ndim == 2:
             self.data = self.data[..., np.newaxis]
 
         # Apply downsampling
@@ -1638,16 +1640,19 @@
                         image_size, origin, voxel_size)
                 nx, ny, nz = image_size
                 meshgrid = np.meshgrid(
                         y2_array, x2_array, z2_array, indexing="ij")
                 vstack = np.vstack(meshgrid)
                 point_array = vstack.reshape(3, -1).T.reshape(ny, nx, nz, 3)
 
-                # Perform resizing
+                # Perform resizing, ensuring that original data type is kept.
+                dtype = self.data.dtype
                 self.data = interpolant(point_array)
+                if dtype != self.data.dtype:
+                    self.data = self.data.astype(dtype)
 
                 # Reset geometry
                 self.voxel_size = voxel_size
                 self.origin= origin
                 self.n_voxels = image_size
                 self.affine = None
                 self.set_geometry()
@@ -2008,14 +2013,19 @@
                 get_geometry(
                     self.affine, self.voxel_size, self.origin, 
                     is_nifti=("nifti" in self.source_type),
                     shape=self.data.shape
                 )
 
         # Set number of voxels in [x, y, z] directions
+        for attribute in [
+                "_affine_canonical", "_data_canonical",
+                "_saffine", "_sdata", "_sorigin"]:
+            if hasattr(self, attribute):
+                delattr(self, attribute)
         self.standardise_data()
         self.n_voxels = [self._sdata.shape[1], self._sdata.shape[0],
                          self._sdata.shape[2]]
 
         # Set axis limits for standardised plotting
         self.lims = [
             (
@@ -3833,47 +3843,64 @@
     def crop(self, xlim=None, ylim=None, zlim=None):
         """
         Crop the image to a given x, y, z range in mm. If any are None, the 
         image will not be cropped in that direction.
         """
 
         lims = [xlim, ylim, zlim]
+        if all([lim is None for lim in lims]):
+            return
+
+        # Ensure DICOM representation for cropping.
+        if "nifti" in self.source_type:
+            im = self.astype("dicom")
+        else:
+            im = self
+
         for i_ax, lim in enumerate(lims):
 
             if lim is None:
                 continue
 
             # Find array indices at which to crop
-            i1 = self.pos_to_idx(lims[i_ax][0], ax=i_ax, return_int=False)
-            i2 = self.pos_to_idx(lims[i_ax][1], ax=i_ax, return_int=False)
+            i1 = im.pos_to_idx(lims[i_ax][0], ax=i_ax, return_int=False)
+            i2 = im.pos_to_idx(lims[i_ax][1], ax=i_ax, return_int=False)
             i_big, i_small = i2, i1
             if i1 > i2:
                 i_big, i_small = i_small, i_big
             i_small = int(np.floor(i_small + 0.5))
             i_big = int(np.floor(i_big + 0.5))
 
             # Ensure indices are within image range
             if i_small < 0:
                 i_small = 0
-            if i_big > self.n_voxels[i_ax]:
-                i_big = self.n_voxels[i_ax]
+            if i_big > im.n_voxels[i_ax]:
+                i_big = im.n_voxels[i_ax]
 
             # Crop the data array
-            ax_to_slice = self.get_axes().index(i_ax)
-            self.data = self.data.take(indices=range(i_small, i_big),
+            ax_to_slice = im.get_axes().index(i_ax)
+            im.data = im.data.take(indices=range(i_small, i_big),
                                        axis=ax_to_slice)
 
             # Reset origin position
-            if self.image_extent[i_ax][1] > self.image_extent[i_ax][0]:
-                self.origin[i_ax] = self.idx_to_pos(i_small, ax=i_ax)
+            if im.image_extent[i_ax][1] > im.image_extent[i_ax][0]:
+                im.origin[i_ax] = im.idx_to_pos(i_small, ax=i_ax)
             else:
-                self.origin[i_ax] = self.idx_to_pos(i_big, ax=i_ax)
+                im.origin[i_ax] = im.idx_to_pos(i_big, ax=i_ax)
 
         # Reset image geometry
-        self.affine = None
+        im.affine = get_geometry(None, im.voxel_size, im.origin)[0]
+
+        # Revert to original representation.
+        if "nifti" in self.source_type:
+            im = im.astype("nifti")
+            self.data = im.data.copy()
+            self.affine, self.voxel_size, self.origin = get_geometry(
+                    im.affine, im.voxel_size, im.origin)
+
         self.set_geometry()
 
     def crop_about_point(self, point=None, xlim=None, ylim=None, zlim=None):
         """
         Crop the image to a given x, y, z range in mm about a point.
 
         If any range is None, the image will not be cropped in that direction.
```

### Comparing `scikit-rt-0.4.3/src/skrt/multi.py` & `scikit-rt-0.4.4/src/skrt/multi.py`

 * *Files identical despite different names*

### Comparing `scikit-rt-0.4.3/src/skrt/patient.py` & `scikit-rt-0.4.4/src/skrt/patient.py`

 * *Files identical despite different names*

### Comparing `scikit-rt-0.4.3/src/skrt/registration.py` & `scikit-rt-0.4.4/src/skrt/registration.py`

 * *Files 4% similar despite different names*

```diff
@@ -28,15 +28,15 @@
   features of Jacobian determinant.
 - prepend_path() : Prepend path to environment variable.
 - read_parameters() : Get dictionary of parameters from a registration
   parameter file.
 - set_elastix_dir() :  Perform environment setup for using elastix software.
 - set_engine_dir() : Perform environment setup for using registration software.
 - shift_translation_parameters() : Add offsets to the translation parameters
-  in an elastix parameter file.
+  in a registration parameter file.
 - write_parameters() : Write dictionary of parameters to a registration
   parameter file.
 """
 import matplotlib.pyplot as plt
 import matplotlib.cm
 import matplotlib.colors
 import numbers
@@ -384,14 +384,18 @@
                     f"No {category} image found at {path}! "
                     f"Make sure you run Registration.set_{category}_image"
                     " before running a registration."
                 )
                 return
             self.set_image(path, category, force=False)
 
+    def add_pfile(self, file, name=None, params=None):
+        """Alias for add_file() with ftype='p'."""
+        self.add_file(file, name=name, params=params, ftype="p")
+
     def add_file(self, file, name=None, params=None, ftype="p"):
         """Add a single file of type <ftype> to the list of registration steps.
         This file can optionally be modified by providing a dict
         of parameter names and new values in <params>.
 
         **Parameters:**
 
@@ -534,15 +538,15 @@
         if filename not in files:
             self.logger.warning(
                     f"Default file {name} not found. Available files:")
             self.list_default_pfiles(self)
             return
         full_files = self.engine.get_default_pfiles(False)
         pfile = full_files[files.index(filename)]
-        return read_parameters(pfile)
+        return self.engine.read_parameters(pfile)
 
     def add_default_pfile(self, filename, params=None):
         """
         Add a default parameter file. For options, run
         Registration.list_default_pfiles(). You can also inspect the contents
         of a default parameter file by running get_default_params(name).
 
@@ -1228,14 +1232,18 @@
 
         if not hasattr(self, "_tmp_dir"):
             return
         if os.path.exists(self._tmp_dir):
             if not self.keep_tmp_dir:
                 shutil.rmtree(self._tmp_dir)
 
+    def adjust_pfile(self, step, params, reset=True):
+        """Alias for adjust_file() with ftype='p'."""
+        self.adjust_file(step, params, ftype='p', reset=reset)
+
     def adjust_file(self, step, params, ftype='p', reset=True):
         """Adjust parameters in a parameter or transform file for a given step. 
 
         **Parameters:**
 
         step : str/int
             Name or number of step for which the parameter file should be 
@@ -1264,17 +1272,19 @@
             self.logger.warning(f"\nValid file types are: '{self.file_types}'")
             return
         ftype = ftype.lower()
 
         step = self.get_step_name(step)
 
         if "p" == ftype:
-            adjust_parameters(self.pfiles[step], self.pfiles[step], params)
+            self.engine.adjust_parameters(
+                    self.pfiles[step], self.pfiles[step], params)
         elif "t" == ftype:
-            adjust_parameters(self.tfiles[step], self.tfiles[step], params)
+            self.engine.adjust_parameters(
+                    self.tfiles[step], self.tfiles[step], params)
 
         if (reset and step in self.tfiles
                 and os.path.exists(self.pfiles.get(step, ""))):
             del self.tfiles[step]
 
     def view_init(self, **kwargs):
         """Interactively view initial fixed and moving images."""
@@ -1364,30 +1374,25 @@
         # Check registration has been run
         if not self.is_registered(step):
             self.logger.warning(
                     f"Registration for {step} has not yet been performed.")
             return
 
         # Check the tfile contains a 3-parameter translation
-        pars = read_parameters(self.tfiles[step])
-        if pars["Transform"] != "TranslationTransform":
-            self.logger.warning(
-                f"Can only manually adjust a translation step. Incorrect "
-                f"transform type for step {step}: {pars['Transform']}"
-            )
+        if not self.engine.shift_translation_parameters(self.tfiles[step]):
             return
 
         # Create BetterViewer and modify its write_translation function
         from skrt.better_viewer import BetterViewer
 
         bv = BetterViewer(
             [self.fixed_image, self.get_transformed_image(step=step)],
             comparison=True,
             translation=True,
-            translation_write_style="shift",
+            translation_write_style=self.engine,
             show=False,
         )
         bv.translation_output.value = self.tfiles[step]
         if reapply_transformation:
             bv._registration = self
             bv._registration_step = step
         bv.show()
@@ -1395,27 +1400,27 @@
 
     def get_input_parameters(self, step):
         """
         Get dict of input parameters for a given step.
         """
 
         step = self.get_step_name(step)
-        return read_parameters(self.pfiles[step])
+        return self.engine.read_parameters(self.pfiles[step])
 
     def get_transform_parameters(self, step):
         """
         Get dict of output transform parameters for a given step.
         """
 
         step = self.get_step_name(step)
         if not self.is_registered(step):
             self.logger.warning(
                     f"Registration step {step} has not yet been performed.")
             return
-        return read_parameters(self.tfiles[step])
+        return self.engine.read_parameters(self.tfiles[step])
 
     def get_step_name(self, step):
         """Convert <step> to a string containing a step name. If <step> is
         already a string, use this; otherwise if <step> is an integer,
         obtain the corresponding step name.  Check that step has
         a parameter file and/or a transform file assigned."""
 
@@ -1626,29 +1631,98 @@
         """
         For fixed image and transformed moving image after step,
         calculate mutual information or a variant.
         after step.
 
         **Parameters:**
         step : int/str/list, default=None
-            Name or number of the step for which the registration should be
-            performed. Available steps are listed in self.steps.
+            Name or number of the registration step after which
+            mutual information is to be calculated.  Available
+            steps are listed in self.steps.
 
         force : bool, default=False
             If True, transformation of the moving image will be
-            performed, even if the image was transformed previously.
+            forced, even if the image was transformed previously.
 
         **kwargs
             Keyword arguments passed to
             skrt.image.Image.get_mutual_information()
             See this method's documentation for options.
         """
         return self.fixed_image.get_mutual_information(
                 self.get_transformed_image(step, force), **kwargs)
 
+    def get_relative_structural_content(self, step=-1, force=False, **kwargs):
+        """
+        Quantify structural content relative to fixed image of
+        transformed moving image after step.
+
+        **Parameters:**
+        step : int/str/list, default=None
+            Name or number of the registration step after which relative
+            structure content is to be calculated. Available steps are
+            listed in self.steps.
+
+        force : bool, default=False
+            If True, transformation of the moving image will be
+            forced, even if the image was transformed previously.
+
+        **kwargs
+            Keyword arguments passed to
+            skrt.image.Image.get_relative_structural_content()
+            See this method's documentation for options.
+        """
+        return self.get_transformed_image(
+                step, force).get_relative_structural_content(
+                        self.fixed_image, **kwargs)
+
+    def get_fidelity(self, step=-1, force=False, **kwargs):
+        """
+        Calculate fidelity with which transformed moving image after step
+        matches fixed image.
+
+        **Parameters:**
+        step : int/str/list, default=None
+            Name or number of the registration step after which fidelity
+            is to be calculated. Available steps are listed in self.steps.
+
+        force : bool, default=False
+            If True, transformation of the moving image will be
+            forced, even if the image was transformed previously.
+
+        **kwargs
+            Keyword arguments passed to
+            skrt.image.Image.get_relative_structural_content()
+            See this method's documentation for options.
+        """
+        return self.get_transformed_image(
+                step, force).get_fidelity(self.fixed_image, **kwargs)
+
+    def get_correlation_quality(self, step=-1, force=False, **kwargs):
+        """
+        Calculate quality of correlation between transformed moving image
+        after step and fixed image.
+
+        **Parameters:**
+        step : int/str/list, default=None
+            Name or number of the registration step after which correlation
+            quality is to be calculated. Available steps are listed
+            in self.steps.
+
+        force : bool, default=False
+            If True, transformation of the moving image will be
+            forced, even if the image was transformed previously.
+
+        **kwargs
+            Keyword arguments passed to
+            skrt.image.Image.get_relative_structural_content()
+            See this method's documentation for options.
+        """
+        return self.get_transformed_image(
+                step, force).get_correlation_quality(self.fixed_image, **kwargs)
 
 class Grid(ImageOverlay):
     """
     Class representating a grid.
 
     This is the same as the ImageOverlay class, but sets different
     attribute values at instantiation.
@@ -2205,38 +2279,46 @@
     transform_points_implemented (bool): Indicate whether registration engine
         implements mapping of points from fixed image to moving images.
     def_signs (tuple/None): Indicate signs to be applied to
         (x, y, z) components of deformation field.
 
     **Methods:**
     __init__():  Create RegistrationEngine instance.
+    adjust_parameters():
+        Modify contents of a registration parameter file.
     define_translation(): Define translation parameters to be passed
         to registration engine.
     get_default_pfiles(): Get list of default parameter files.
     get_default_pfiles_dir(): Return path to directory containing
         default parameter files.
     get_def_cmd(): Get registration-engine command for computing
         deformation field.
     get_jac_cmd(): Get registration-engine command for computing
         Jacobian determinant.
     get_registration_cmd(): Get registration-engine command for
         performing image registration.
     get_roi_params(): Get default parameters to be used when
         transforming ROI mask.
-    get_transform_cmd():
-        Get registration-engine command for applying registration transform.
+    get_transform_cmd(): Get registration-engine command for
+        applying registration transform.
+    read_parameters(): Get dictionary of parameters from a
+        registration parameter file.
     set_exe_env(): Set environment variables for running
         registration-engine software.
-    set_exe_paths():
-        Set path(s)s to registration-engine executable(s).
+    set_exe_paths(): Set path(s)s to registration-engine executable(s).
+    shift_translation_parameters(): Add offsets to the translation parameters
+        in a registration transform file.
+    write_parameters(): Write dictionary of parameters to a
+        registration parameter file.
 
     **Static method:**
-    get_transform_strategies():
-        Get list of available strategies for applying registration transform.
+    get_transform_strategies(): Get list of available strategies
+        for applying registration transform.
     """
+
     # Indicate whether registration engine implements mapping of points
     # from fixed image to moving images.
     transform_points_implemented = False
 
     # Indicate signs to be applied to (x, y, z) components of deformation field.
     # If None, components are taken to be as read from file.
     def_signs = None
@@ -2267,14 +2349,32 @@
         self.logger = get_logger(
                 name=type(self).__name__, log_level=self.log_level)
 
         if not hasattr(self, "name"):
             self.name = type(self).__name__.lower()
         self.set_exe_env(path, force)
 
+    def adjust_parameters(self, infile, outfile, params):
+        """
+        Modify contents of a registration parameter file.
+
+        **Parameters:**
+
+        infile : str/patlib.Path
+            Path to a registration parameter file.
+
+        outfile : str/pathlib.Path
+            Path to output file.
+
+        params : dict
+            Dictionary of parameter names and new values.
+        """
+        raise NotImplementedError("Method 'adjust_parameters()' "
+                                  f"not implemented for class {type(self)}")
+
     def define_translation(self, dxdydz, fixed_image=None):
         """
         Define translation parameters to be passed to registration engine.
 
         **Parameters:**
 
         dxdydz : tuple/list
@@ -2425,14 +2525,25 @@
         Get name of transform log file.
         """
         if not hasattr(self, "transform_log"):
             raise NotImplementedError("Class attribute 'transform_log' "
                                   f"not implemented for class {type(self)}")
         return self.transform_log
 
+    def read_parameters(self, infile):
+        """
+        Get dictionary of parameters from a registration parameter file.
+
+        **Parameter:**
+        infile: str/pathlib.Path
+            Path to registration parameter file.
+        """
+        raise NotImplementedError("Method 'read_parameters()' "
+                                  f"not implemented for class {type(self)}")
+
     def set_exe_env(self, path=None, force=False):
         """
         Set environment variables for running registration-engine software.
 
         **Parameters:**
 
         path : str/pathlib.Path, default=None
@@ -2489,14 +2600,51 @@
 
         path : str/pathlib.Path, default=None
             Path to directory containing registration-engine executable(s).
         """
         raise NotImplementedError("Method 'set_exe_paths()' "
                                   f"not implemented for class {type(self)}")
 
+    def shift_translation_parameters(
+            self, infile, dx=0, dy=0, dz=0, outfile=None):
+        """
+        Add offsets to the translation parameters in a registration
+        transform file.
+        
+        **Parameters:**
+
+        infile: str
+            Path to input transform file.
+
+        dx, dy, dz: int, default=0
+            Amounts by which to increase translation parameters, along
+            x, y, z directions.
+
+        outfile: str, default=None
+            Path to output parameter file.  If None, overwrite input
+            parameter file.
+        """
+        raise NotImplementedError("Method 'shift_translation_parameters()' "
+                                  f"not implemented for class {type(self)}")
+
+    def write_parameters(self, outfile, params):
+        """
+        Write dictionary of parameters to a registration parameter file.
+
+        **Parameters:**
+
+        outfile: str/pathlib.Path
+            Path to output file.
+
+        params: dict
+            Dictionary of parameters to be written to file.
+        """
+        raise NotImplementedError("Method 'write_parameters()' "
+                                  f"not implemented for class {type(self)}")
+
     @staticmethod
     def get_transform_strategies():
         """
         Get list of available strategies for applying registration transform.
 
         Possible strategies are:
 
@@ -2528,14 +2676,30 @@
         # Initialise paths to executables.
         for exe in Elastix.exes:
             setattr(self, exe, exe)
 
         # Perform rest of initialisation via base class.
         super().__init__(**kwargs)
 
+    def adjust_parameters(self, infile, outfile, params):
+        # Modify elastix parameter file.
+        # For information about format, see section 3.4 of elastix manual:
+        # https://elastix.lumc.nl/download/elastix-5.0.1-manual.pdf
+
+        # Check that file to be adjusted exists.
+        if not os.path.exists(infile):
+            self.logger.warning(f"File not found: '{infile}'")
+            self.logger.warning("No parameter-adjustment performed")
+            return
+
+        # Read input
+        original_params = self.read_parameters(infile)
+        original_params.update(params)
+        self.write_parameters(outfile, original_params)
+
     def define_translation(self, dxdydz, fixed_image=None):
         # Define translation parameters that are enough to allow
         # application before a registration step.
         translation = {
                 "Transform": "TranslationTransform",
                 "NumberOfParameters": 3,
                 "TransformParameters": dxdydz,
@@ -2593,28 +2757,57 @@
         return {"ResampleInterpolator": '"FinalNearestNeighborInterpolator"'}
 
     def get_transform_cmd(
             self, fixed_path, moving_path, outdir, tfile, params=None):
         # Perform any modifications to the transform parameter file.
         if params:
             out_tfile = str(Path(outdir) / Path(tfile).name)
-            adjust_parameters(tfile, out_tfile, params)
+            self.adjust_parameters(tfile, out_tfile, params)
             tfile = out_tfile.replace("\\", "/")
 
         # Return command for applying registration transform.
         return [
             self.transformix,
             "-def" if ".txt" == Path(moving_path).suffix else "-in",
             moving_path,
             "-out",
             outdir,
             "-tp",
             tfile,
         ]
 
+    def read_parameters(self, infile):
+        # Read elastix parameter file.
+        # For information about format, see section 3.4 of elastix manual:
+        # https://elastix.lumc.nl/download/elastix-5.0.1-manual.pdf
+        lines = [line for line in open(infile).readlines()
+                 if line.startswith("(")]
+        lines = [line[line.find("(") + 1 : line.rfind(")")].split()
+                 for line in lines]
+        params = {line[0]: " ".join(line[1:]) for line in lines}
+        for name, param in params.items():
+            if '"' in param:
+                params[name] = param.strip('"')
+                if params[name] == "false":
+                    params[name] = False
+                elif params[name] == "true":
+                    params[name] = True
+            elif len(param.split()) > 1:
+                params[name] = [p for p in param.rstrip("(").split()]
+                if "." in params[name][0]:
+                    params[name] = [float(p) for p in params[name]]
+                else:
+                    params[name] = [int(p) for p in params[name]]
+            else:
+                if "." in param:
+                    params[name] = float(param)
+                else:
+                    params[name] = int(param)
+        return params
+
     def set_exe_paths(self, path):
         # Set paths to elastix executables.
         exe_dir = None
         sw_dir = Path(fullpath(path))
         if sw_dir.is_dir():
             if (sw_dir / "bin/elastix").exists():
                 exe_dir = sw_dir / "bin"
@@ -2624,14 +2817,56 @@
                 exe_dir = sw_dir
                 for exe in Elastix.exes:
                     setattr(self, exe, f"{exe}.exe")
 
         # Return the path to the directory containing the executables.
         return exe_dir
 
+    def shift_translation_parameters(
+            self, infile, dx=0, dy=0, dz=0, outfile=None):
+        # Add offsets to the translation parameters
+        # of an elaxtix transform file.
+        if outfile is None:
+            outfile = infile
+        pars = self.read_parameters(infile)
+        init = pars["TransformParameters"]
+        if pars["Transform"] != "TranslationTransform":
+            self.logger.warning(
+                f"Can only manually adjust a translation step. Incorrect "
+                f"transform type: {pars['Transform']}"
+            )
+            return False
+
+        pars["TransformParameters"] = [init[0] - dx, init[1] - dy, init[2] - dz]
+        self.write_parameters(outfile, pars)
+        return True
+
+    def write_parameters(self, outfile, params):
+        # Write elastix parameter file.
+        # For information about format, see section 3.4 of elastix manual:
+        # https://elastix.lumc.nl/download/elastix-5.0.1-manual.pdf
+        file = open(outfile, "w")
+        for name, param in params.items():
+            if "//" == name:
+                line = f"\n{name} {param}"
+            else:
+                line = f"({name}"
+                if isinstance(param, str):
+                    line += f' "{param}")'
+                elif isinstance(param, (list, tuple)):
+                    for item in param:
+                        line += " " + str(item)
+                    line += ")"
+                elif isinstance(param, bool):
+                    line += f' "{str(param).lower()}")'
+                else:
+                    line += " " + str(param) + ")"
+            file.write(line + "\n")
+        file.close()
+
     @staticmethod
     def get_transform_strategies():
         return ["pull", "push"]
 
 
 @add_engine
 class NiftyReg(RegistrationEngine):
@@ -2650,14 +2885,22 @@
         # Initialise paths to executables.
         for exe in NiftyReg.exes:
             setattr(self, exe, exe)
 
         # Perform rest of initialisation via base class.
         super().__init__(**kwargs)
 
+    def adjust_parameters(self, infile, outfile, params):
+        # Modify NiftyReg parameter file.
+        # NiftyReg doesn't define its own file format.  Here adopt
+        # format used by elastix.  For information about this,
+        # see section 3.4 of elastix manual:
+        # https://elastix.lumc.nl/download/elastix-5.0.1-manual.pdf
+        return Elastix.adjust_parameters(self, infile, outfile, params)
+
     def define_translation(self, dxdydz, fixed_image=None):
         # Define translation parameters that are enough to allow
         # application before a registration step.
         # Signs account for different conventions between NiftyReg and Elastix.
         translation = [
                 f"1 0 0 {-dxdydz[0]}",
                 f"0 1 0 {-dxdydz[1]}",
@@ -2679,15 +2922,15 @@
                     f"-jac {outdir}/spatialJacobian.nii").split()
 
     def get_registration_cmd(
             self, fixed_path, moving_path, fixed_mask_path, moving_mask_path,
             pfile, outdir, tfile=None):
 
         # Read registration parameters from file.
-        params = read_parameters(pfile)
+        params = self.read_parameters(pfile)
 
         # Define path to output directory.
         outdir = Path(outdir)
 
         # Start command with execuable, paths to fixed and moving images,
         # and path to output file (name following elastix convention).
         cmd = [
@@ -2736,14 +2979,34 @@
         params = [str(val) for items in params.items() for val in items]
 
         # Return command for applying registration transform.
         return [self.reg_resample, "-ref", fixed_path, "-flo", moving_path,
                 "-res", str(Path(outdir) / 'result.nii'),
                 "-trans", tfile] + params
 
+    def read_affine(self, infile):
+        """
+        Read affine matrix from file. 
+
+        **Parameter:**
+        infile: str/pathlib.Path
+            Path to file from which to read affine matrix.
+        """
+        with open(infile) as file:
+            lines = [line.strip().split() for line in file.readlines()]
+        return [[float(item) for item in line] for line in lines]
+
+    def read_parameters(self, infile):
+        # Read NiftyReg parameter file.
+        # NiftyReg doesn't define its own file format.  Here adopt
+        # format used by elastix.  For information about this,
+        # see section 3.4 of elastix manual:
+        # https://elastix.lumc.nl/download/elastix-5.0.1-manual.pdf
+        return Elastix.read_parameters(self, infile)
+
     def set_exe_paths(self, path):
         # Set paths to NiftyReg executables.
         exe_dir = None
         sw_dir = Path(fullpath(path))
         if sw_dir.is_dir():
             if (sw_dir / "bin/reg_f3d").exists():
                 exe_dir = sw_dir / "bin"
@@ -2753,64 +3016,78 @@
                 for exe in NiftyReg.exes:
                     setattr(self, exe, f"{exe}.exe")
                 exe_dir = sw_dir
 
         # Return the path to the directory containing the executables.
         return exe_dir
 
+    def shift_translation_parameters(
+            self, infile, dx=0, dy=0, dz=0, outfile=None):
+        # Add offsets to the translation parameters
+        # of a Niftyreg transform file.
+        print(infile, dx, dy, dz, outfile)
+        if outfile is None:
+            outfile = infile
+
+        affine = self.read_affine(infile)
+
+        # Offset translation parameters.
+        # Signs account for different conventions between NiftyReg and Elastix.
+        affine[0][3] -= dx
+        affine[1][3] -= dy
+        affine[2][3] += dz
+
+        self.write_affine(affine, outfile)
+        return True
+
+    def write_affine(self, affine, outfile):
+        """
+        Write affine matrix fo file. 
+
+        **Parameter:**
+        outfile: str/pathlib.Path
+            Path to file to which to write affine matrix.
+        """
+        rows = [" ".join([str(val) for val in row]) for row in affine]
+        with open(outfile, "w") as file:
+            file.write("\n".join(rows))
+
+    def write_parameters(self, outfile, params):
+        # Write NiftyReg parameter file.
+        # NiftyReg doesn't define its own file format.  Here adopt
+        # format used by elastix.  For information about this,
+        # see section 3.4 of elastix manual:
+        # https://elastix.lumc.nl/download/elastix-5.0.1-manual.pdf
+        return Elastix.write_parameters(self, outfile, params)
+
     @staticmethod
     def get_transform_strategies():
         return ["pull"]
 
 
-def adjust_parameters(infile, outfile, params):
+def adjust_parameters(infile, outfile, params, engine=None):
     """
     Modify contents of a registration parameter file.
 
-    This function will work for any file that stores parameter-value pairs
-    in the format used by elastix:
-
-    - Lines beginning `//` are comments.
-    - Blank lines are ignored.
-    - A parameter-value pair is specified as:
-      ```
-      // Value is True or False.
-      (parameter "true")
-      (parameter "false")
-
-      // Value is a string.
-      (parameter "value")
-
-      // Value is a number.
-      (parameter value)
-      ```
-
     **Parameters:**
 
-    file : str
+    infile : str
         Path to a registration parameter file.
 
     outfile : str
         Path to output file.
 
     params : dict
         Dictionary of parameter names and new values.
-    """
-
-    # Check that file to be adjusted exists.
-    if not os.path.exists(infile):
-        print(f"File not found: '{infile}'")
-        print("No parameter-adjustment performed")
-        return
-
-    # Read input
-    original_params = read_parameters(infile)
-    original_params.update(params)
-    write_parameters(outfile, original_params)
 
+    engine: str, default=None
+        String identifying registration engine, corresponding to
+        a key of the dictionary skrt.registration.engines.
+    """
+    return get_engine_cls(engine)().adjust_parameters(infile, outfile, params)
 
 def get_data_dir():
     """Return path to data directory within the scikit-rt package."""
     return Path(resource_filename("skrt", "data"))
 
 
 def get_default_pfiles(pattern="*.txt", engine=None, basename_only=False):
@@ -2827,15 +3104,15 @@
         Name of registration engine for which path to directory
         containing default parameter files is required.  If None,
         use value set for skrt.core.Default().registration_engine.
 
     pattern: str, default="*.txt"
         Glob-style pattern for filtering on file names.
     """
-    engine = engine or Defaults().registration_engine
+    engine = get_engine_name(engine)
     files = sorted(list(get_default_pfiles_dir(engine).glob(pattern)))
     if basename_only:
         return [file.name for file in files]
     return files
 
 
 def get_default_pfiles_dir(engine=None):
@@ -2845,21 +3122,19 @@
 
     **Parameter:**
     engine: str, default=None
         Name of registration engine for which path to directory
         containing default parameter files is required.  If None,
         use value set for skrt.core.Default().registration_engine.
     """
-    engine = engine or Defaults().registration_engine
-    return get_data_dir() / f"{engine}_parameter_files"
-
+    return get_data_dir() / f"{get_engine_name(engine)}_parameter_files"
 
-def get_engine_cls(engine=None, engine_dir=None):
+def get_engine_name(engine=None, engine_dir=None):
     """
-    Get registration-engine class, given engine name or software directory.
+    Get registration-engine name, given engine name or software directory.
 
     **Parameters:**
 
     engine: str, default=None
         String identifying registration engine, corresponding to
         a key of the dictionary skrt.registration.engines.
 
@@ -2868,23 +3143,42 @@
         It's assumed that the registration engine is a key of
         the dictionary skrt.registration.engines, that the directory
         path includes this key, and that directory path doesn't
         include any other keys of skrt.registration.engines.
     """
     # Treat case where engine is a key of engines.
     if engine in engines:
-        return engines[engine]
+        return engine
 
     # Treat case where engine_dir includes a key of engines.
     for local_engine in engines:
         if local_engine in str(engine_dir):
-            return engines[local_engine]
+            return local_engine
 
-    # Return class of default registration engine.
-    return engines.get(Defaults().registration_engine, None)
+    # Return default engine name.
+    return Defaults().registration_engine
+
+def get_engine_cls(engine=None, engine_dir=None):
+    """
+    Get registration-engine class, given engine name or software directory.
+
+    **Parameters:**
+
+    engine: str, default=None
+        String identifying registration engine, corresponding to
+        a key of the dictionary skrt.registration.engines.
+
+    engine_dir: pathlib.Path/str, default=None
+        Path to directory containing registration-engine software.
+        It's assumed that the registration engine is a key of
+        the dictionary skrt.registration.engines, that the directory
+        path includes this key, and that directory path doesn't
+        include any other keys of skrt.registration.engines.
+    """
+    return engines.get(get_engine_name(engine, engine_dir), None)
 
 
 def get_image_transform_parameters(im):
     """
     Define Elastix registration-independent parameters for transforms
     to the space of a specified image.
 
@@ -3075,42 +3369,27 @@
         if variable in os.environ:
             if os.environ[variable]:
                 os.environ[variable] = f'{path}:{os.environ[variable]}'
         else:
             os.environ[variable] = path
 
 
-def read_parameters(infile):
-    """
-    Get dictionary of parameters from a registratioin parameter file.
+def read_parameters(infile, engine=None):
     """
+    Get dictionary of parameters from a registration parameter file.
 
-    lines = [line for line in open(infile).readlines() if line.startswith("(")]
-    lines = [line[line.find("(") + 1 : line.rfind(")")].split()
-            for line in lines]
-    params = {line[0]: " ".join(line[1:]) for line in lines}
-    for name, param in params.items():
-        if '"' in param:
-            params[name] = param.strip('"')
-            if params[name] == "false":
-                params[name] = False
-            elif params[name] == "true":
-                params[name] = True
-        elif len(param.split()) > 1:
-            params[name] = [p for p in param.rstrip("(").split()]
-            if "." in params[name][0]:
-                params[name] = [float(p) for p in params[name]]
-            else:
-                params[name] = [int(p) for p in params[name]]
-        else:
-            if "." in param:
-                params[name] = float(param)
-            else:
-                params[name] = int(param)
-    return params
+    **Parameters:**
+    infile: str, pathlib.Path
+        Path fo registration parameter file.
+
+    engine: str, default=None
+        String identifying registration engine, corresponding to
+        a key of the dictionary skrt.registration.engines.
+    """
+    return get_engine_cls(engine)().read_parameters(infile)
 
 
 def set_elastix_dir(path, force=True):
     """
     Perform environment setup for using elastix software.
 
     Function deprecated - use set_engine_dir()
@@ -3143,76 +3422,57 @@
         to a key of the dictionary skrt.registration.engines.
 
     force : bool, default=True
         If False, modify environment based on <path> only if registration
         software can't be located in the existing environment.  If True, modify
         environment based on <path> in all cases.
     """
-    if not engine in engines:
-        raise RuntimeError(f"Registration engine not known: {engine}; "
+    local_engine = get_engine_name(engine, path)
+    if not local_engine in engines:
+        raise RuntimeError("Unable to determine registration engine "
+                           f"from path: {path}, engine: {engine}; "
                            f"known engines are: {list(engines)}")
-    get_engine_cls(engine, path)(path=path, force=force)
+    get_engine_cls(local_engine)(path=path, force=force)
 
 
-def shift_translation_parameters(infile, dx=0, dy=0, dz=0, outfile=None):
+def shift_translation_parameters(
+        infile, dx=0, dy=0, dz=0, outfile=None, engine=None):
     """
-    Add offsets to the translation parameters in an elastix parameter file.
+    Add offsets to the translation parameters in a registration transform file.
     
     **Parameters:**
 
     infile: str
         Path to input parameter file.
 
     dx, dy, dz: int, default=0
         Amounts by which to increase translation parameters, along
         x, y, z directions.
 
     outfile: str, default=None
         Path to output parameter file.  If None, overwrite input parameter file.
-    """
-
-    if outfile is None:
-        outfile = infile
-    pars = read_parameters(infile)
-    init = pars["TransformParameters"]
-    if pars["Transform"] != "TranslationTransform":
-        self.logger.warning(
-            f"Can only manually adjust a translation step. Incorrect "
-            f"transform type: {pars['Transform']}"
-        )
-        return
 
-    pars["TransformParameters"] = [init[0] - dx, init[1] - dy, init[2] - dz]
-    write_parameters(outfile, pars)
+    engine: str, default=None
+        String identifying registration engine, corresponding to
+        a key of the dictionary skrt.registration.engines.
+    """
+    get_engine_cls(engine)().shift_translation_parameters(
+            infile, dx=0, dy=0, dz=0, outfile=None)
 
 
-def write_parameters(outfile, params):
+def write_parameters(outfile, params, engine=None):
     """
     Write dictionary of parameters to a registration parameter file.
 
     **Parameters:**
 
     outfile: str
         Path to output file.
 
     params: dict
         Dictionary of parameters to be written to file.
-    """
 
-    file = open(outfile, "w")
-    for name, param in params.items():
-        if "//" == name:
-            line = f"\n{name} {param}"
-        else:
-            line = f"({name}"
-            if isinstance(param, str):
-                line += f' "{param}")'
-            elif isinstance(param, (list, tuple)):
-                for item in param:
-                    line += " " + str(item)
-                line += ")"
-            elif isinstance(param, bool):
-                line += f' "{str(param).lower()}")'
-            else:
-                line += " " + str(param) + ")"
-        file.write(line + "\n")
-    file.close()
+    engine: str, default=None
+        String identifying registration engine, corresponding to
+        a key of the dictionary skrt.registration.engines.
+    """
+    get_engine_cls(engine)().write_parameters(outfile, params)
```

### Comparing `scikit-rt-0.4.3/src/skrt/segmentation.py` & `scikit-rt-0.4.4/src/skrt/segmentation.py`

 * *Files identical despite different names*

### Comparing `scikit-rt-0.4.3/src/skrt/simulation.py` & `scikit-rt-0.4.4/src/skrt/simulation.py`

 * *Files identical despite different names*

### Comparing `scikit-rt-0.4.3/src/skrt/structures.py` & `scikit-rt-0.4.4/src/skrt/structures.py`

 * *Files 1% similar despite different names*

```diff
@@ -539,21292 +539,21400 @@
 000021a0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
 000021b0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
 000021c0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
 000021d0: 662e 696e 7075 745f 636f 6e74 6f75 7273  f.input_contours
 000021e0: 5b7a 5d2e 6170 7065 6e64 2863 6f6e 746f  [z].append(conto
 000021f0: 7572 290a 2020 2020 2020 2020 656c 7365  ur).        else
 00002200: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
-00002210: 6c66 2e73 6f75 7263 6520 3d20 7374 7228  lf.source = str(
-00002220: 736f 7572 6365 2920 6966 2069 7369 6e73  source) if isins
-00002230: 7461 6e63 6528 736f 7572 6365 2c20 5061  tance(source, Pa
-00002240: 7468 2920 656c 7365 2073 6f75 7263 650a  th) else source.
-00002250: 0a20 2020 2020 2020 2023 2041 7373 6967  .        # Assig
-00002260: 6e20 6f74 6865 7220 7072 6f70 6572 7469  n other properti
-00002270: 6573 0a20 2020 2020 2020 2073 656c 662e  es.        self.
-00002280: 6375 7374 6f6d 5f63 6f6c 6f72 203d 2063  custom_color = c
-00002290: 6f6c 6f72 2069 7320 6e6f 7420 4e6f 6e65  olor is not None
-000022a0: 0a20 2020 2020 2020 2073 656c 662e 7365  .        self.se
-000022b0: 745f 636f 6c6f 7228 636f 6c6f 7229 0a20  t_color(color). 
-000022c0: 2020 2020 2020 2073 656c 662e 6d61 736b         self.mask
-000022d0: 203d 204e 6f6e 650a 2020 2020 2020 2020   = None.        
-000022e0: 7365 6c66 2e69 6d61 6765 203d 2069 6d61  self.image = ima
-000022f0: 6765 0a20 2020 2020 2020 2069 6620 696d  ge.        if im
-00002300: 6167 6520 616e 6420 6e6f 7420 6973 696e  age and not isin
-00002310: 7374 616e 6365 2869 6d61 6765 2c20 736b  stance(image, sk
-00002320: 7274 2e69 6d61 6765 2e49 6d61 6765 293a  rt.image.Image):
-00002330: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00002340: 662e 696d 6167 6520 3d20 736b 7274 2e69  f.image = skrt.i
-00002350: 6d61 6765 2e49 6d61 6765 2869 6d61 6765  mage.Image(image
-00002360: 290a 2020 2020 2020 2020 7365 6c66 2e73  ).        self.s
-00002370: 6861 7065 203d 2073 6861 7065 0a20 2020  hape = shape.   
-00002380: 2020 2020 2073 656c 662e 6166 6669 6e65       self.affine
-00002390: 2c20 7365 6c66 2e76 6f78 656c 5f73 697a  , self.voxel_siz
-000023a0: 652c 2073 656c 662e 6f72 6967 696e 203d  e, self.origin =
-000023b0: 205c 0a20 2020 2020 2020 2020 2020 2020   \.             
-000023c0: 2020 2073 6b72 742e 696d 6167 652e 6765     skrt.image.ge
-000023d0: 745f 6765 6f6d 6574 7279 2861 6666 696e  t_geometry(affin
-000023e0: 652c 2076 6f78 656c 5f73 697a 652c 206f  e, voxel_size, o
-000023f0: 7269 6769 6e29 0a20 2020 2020 2020 2073  rigin).        s
-00002400: 656c 662e 736c 6963 655f 7468 6963 6b6e  elf.slice_thickn
-00002410: 6573 735f 636f 6e74 6f75 7273 203d 204e  ess_contours = N
-00002420: 6f6e 650a 2020 2020 2020 2020 7365 6c66  one.        self
-00002430: 2e6d 6173 6b5f 7468 7265 7368 6f6c 6420  .mask_threshold 
-00002440: 3d20 6d61 736b 5f74 6872 6573 686f 6c64  = mask_threshold
-00002450: 0a20 2020 2020 2020 2073 656c 662e 6f76  .        self.ov
-00002460: 6572 6c61 705f 6c65 7665 6c20 3d20 6f76  erlap_level = ov
-00002470: 6572 6c61 705f 6c65 7665 6c0a 2020 2020  erlap_level.    
-00002480: 2020 2020 7365 6c66 2e63 6f6e 746f 7572      self.contour
-00002490: 7320 3d20 7b7d 0a20 2020 2020 2020 2073  s = {}.        s
-000024a0: 656c 662e 6465 6661 756c 745f 6765 6f6d  elf.default_geom
-000024b0: 5f6d 6574 686f 6420 3d20 6465 6661 756c  _method = defaul
-000024c0: 745f 6765 6f6d 5f6d 6574 686f 640a 2020  t_geom_method.  
-000024d0: 2020 2020 2020 7365 6c66 2e6b 7761 7267        self.kwarg
-000024e0: 7320 3d20 6b77 6172 6773 0a20 2020 2020  s = kwargs.     
-000024f0: 2020 2073 656c 662e 736f 7572 6365 5f74     self.source_t
-00002500: 7970 6520 3d20 4e6f 6e65 0a20 2020 2020  ype = None.     
-00002510: 2020 2073 656c 662e 6469 636f 6d5f 6461     self.dicom_da
-00002520: 7461 7365 7420 3d20 4e6f 6e65 0a20 2020  taset = None.   
-00002530: 2020 2020 2073 656c 662e 636f 6e74 6f75       self.contou
-00002540: 7273 5f6f 6e6c 7920 3d20 4661 6c73 650a  rs_only = False.
-00002550: 2020 2020 2020 2020 7365 6c66 2e70 6c61          self.pla
-00002560: 6e73 203d 205b 5d0a 2020 2020 2020 2020  ns = [].        
-00002570: 7365 6c66 2e61 6c70 6861 5f6f 7665 725f  self.alpha_over_
-00002580: 6265 7461 203d 2061 6c70 6861 5f6f 7665  beta = alpha_ove
-00002590: 725f 6265 7461 0a0a 2020 2020 2020 2020  r_beta..        
-000025a0: 2320 5072 6f70 6572 7469 6573 2072 656c  # Properties rel
-000025b0: 6174 696e 6720 746f 2070 6c61 6e20 646f  ating to plan do
-000025c0: 7365 2063 6f6e 7374 7261 696e 7473 0a20  se constraints. 
-000025d0: 2020 2020 2020 2073 656c 662e 726f 695f         self.roi_
-000025e0: 7479 7065 203d 204e 6f6e 650a 2020 2020  type = None.    
-000025f0: 2020 2020 7365 6c66 2e63 6f6e 7374 7261      self.constra
-00002600: 696e 7420 3d20 4e6f 6e65 0a0a 2020 2020  int = None..    
-00002610: 2020 2020 2320 4372 6561 7465 206e 616d      # Create nam
-00002620: 650a 2020 2020 2020 2020 7365 6c66 2e6e  e.        self.n
-00002630: 616d 6520 3d20 6e61 6d65 0a20 2020 2020  ame = name.     
-00002640: 2020 2069 6620 7365 6c66 2e6e 616d 6520     if self.name 
-00002650: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
-00002660: 2020 2020 2069 6620 6973 696e 7374 616e       if isinstan
-00002670: 6365 2873 656c 662e 736f 7572 6365 2c20  ce(self.source, 
-00002680: 7374 7229 3a0a 2020 2020 2020 2020 2020  str):.          
-00002690: 2020 2020 2020 6261 7365 6e61 6d65 203d        basename =
-000026a0: 206f 732e 7061 7468 2e62 6173 656e 616d   os.path.basenam
-000026b0: 6528 7365 6c66 2e73 6f75 7263 6529 2e73  e(self.source).s
-000026c0: 706c 6974 2822 2e22 295b 305d 0a20 2020  plit(".")[0].   
-000026d0: 2020 2020 2020 2020 2020 2020 206e 616d               nam
-000026e0: 6520 3d20 7265 2e73 7562 2872 2252 5453  e = re.sub(r"RTS
-000026f0: 5452 5543 545f 5b4d 5643 545d 2b5f 5c64  TRUCT_[MVCT]+_\d
-00002700: 2b5f 5c64 2b5f 5c64 2b22 2c20 2222 2c20  +_\d+_\d+", "", 
-00002710: 6261 7365 6e61 6d65 290a 2020 2020 2020  basename).      
-00002720: 2020 2020 2020 2020 2020 2320 2073 656c            #  sel
-00002730: 662e 6e61 6d65 203d 206e 616d 655b 305d  f.name = name[0]
-00002740: 2e75 7070 6572 2829 202b 206e 616d 655b  .upper() + name[
-00002750: 313a 5d0a 2020 2020 2020 2020 2020 2020  1:].            
-00002760: 2020 2020 7365 6c66 2e6e 616d 6520 3d20      self.name = 
-00002770: 6e61 6d65 0a20 2020 2020 2020 2020 2020  name.           
-00002780: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+00002210: 6c66 2e73 6f75 7263 6520 3d20 2873 6b72  lf.source = (skr
+00002220: 742e 636f 7265 2e66 756c 6c70 6174 6828  t.core.fullpath(
+00002230: 736f 7572 6365 290a 2020 2020 2020 2020  source).        
+00002240: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002250: 2020 2069 6620 6973 696e 7374 616e 6365     if isinstance
+00002260: 2873 6f75 7263 652c 2028 7374 722c 2050  (source, (str, P
+00002270: 6174 6829 2920 656c 7365 2073 6f75 7263  ath)) else sourc
+00002280: 6529 0a0a 2020 2020 2020 2020 2320 4173  e)..        # As
+00002290: 7369 676e 206f 7468 6572 2070 726f 7065  sign other prope
+000022a0: 7274 6965 730a 2020 2020 2020 2020 7365  rties.        se
+000022b0: 6c66 2e63 7573 746f 6d5f 636f 6c6f 7220  lf.custom_color 
+000022c0: 3d20 636f 6c6f 7220 6973 206e 6f74 204e  = color is not N
+000022d0: 6f6e 650a 2020 2020 2020 2020 7365 6c66  one.        self
+000022e0: 2e73 6574 5f63 6f6c 6f72 2863 6f6c 6f72  .set_color(color
+000022f0: 290a 2020 2020 2020 2020 7365 6c66 2e6d  ).        self.m
+00002300: 6173 6b20 3d20 4e6f 6e65 0a20 2020 2020  ask = None.     
+00002310: 2020 2073 656c 662e 696d 6167 6520 3d20     self.image = 
+00002320: 696d 6167 650a 2020 2020 2020 2020 6966  image.        if
+00002330: 2069 6d61 6765 2061 6e64 206e 6f74 2069   image and not i
+00002340: 7369 6e73 7461 6e63 6528 696d 6167 652c  sinstance(image,
+00002350: 2073 6b72 742e 696d 6167 652e 496d 6167   skrt.image.Imag
+00002360: 6529 3a0a 2020 2020 2020 2020 2020 2020  e):.            
+00002370: 7365 6c66 2e69 6d61 6765 203d 2073 6b72  self.image = skr
+00002380: 742e 696d 6167 652e 496d 6167 6528 696d  t.image.Image(im
+00002390: 6167 6529 0a20 2020 2020 2020 2073 656c  age).        sel
+000023a0: 662e 7368 6170 6520 3d20 7368 6170 650a  f.shape = shape.
+000023b0: 2020 2020 2020 2020 7365 6c66 2e61 6666          self.aff
+000023c0: 696e 652c 2073 656c 662e 766f 7865 6c5f  ine, self.voxel_
+000023d0: 7369 7a65 2c20 7365 6c66 2e6f 7269 6769  size, self.origi
+000023e0: 6e20 3d20 5c0a 2020 2020 2020 2020 2020  n = \.          
+000023f0: 2020 2020 2020 736b 7274 2e69 6d61 6765        skrt.image
+00002400: 2e67 6574 5f67 656f 6d65 7472 7928 6166  .get_geometry(af
+00002410: 6669 6e65 2c20 766f 7865 6c5f 7369 7a65  fine, voxel_size
+00002420: 2c20 6f72 6967 696e 290a 2020 2020 2020  , origin).      
+00002430: 2020 7365 6c66 2e73 6c69 6365 5f74 6869    self.slice_thi
+00002440: 636b 6e65 7373 5f63 6f6e 746f 7572 7320  ckness_contours 
+00002450: 3d20 4e6f 6e65 0a20 2020 2020 2020 2073  = None.        s
+00002460: 656c 662e 6d61 736b 5f74 6872 6573 686f  elf.mask_thresho
+00002470: 6c64 203d 206d 6173 6b5f 7468 7265 7368  ld = mask_thresh
+00002480: 6f6c 640a 2020 2020 2020 2020 7365 6c66  old.        self
+00002490: 2e6f 7665 726c 6170 5f6c 6576 656c 203d  .overlap_level =
+000024a0: 206f 7665 726c 6170 5f6c 6576 656c 0a20   overlap_level. 
+000024b0: 2020 2020 2020 2073 656c 662e 636f 6e74         self.cont
+000024c0: 6f75 7273 203d 207b 7d0a 2020 2020 2020  ours = {}.      
+000024d0: 2020 7365 6c66 2e64 6566 6175 6c74 5f67    self.default_g
+000024e0: 656f 6d5f 6d65 7468 6f64 203d 2064 6566  eom_method = def
+000024f0: 6175 6c74 5f67 656f 6d5f 6d65 7468 6f64  ault_geom_method
+00002500: 0a20 2020 2020 2020 2073 656c 662e 6b77  .        self.kw
+00002510: 6172 6773 203d 206b 7761 7267 730a 2020  args = kwargs.  
+00002520: 2020 2020 2020 7365 6c66 2e73 6f75 7263        self.sourc
+00002530: 655f 7479 7065 203d 204e 6f6e 650a 2020  e_type = None.  
+00002540: 2020 2020 2020 7365 6c66 2e64 6963 6f6d        self.dicom
+00002550: 5f64 6174 6173 6574 203d 204e 6f6e 650a  _dataset = None.
+00002560: 2020 2020 2020 2020 7365 6c66 2e63 6f6e          self.con
+00002570: 746f 7572 735f 6f6e 6c79 203d 2046 616c  tours_only = Fal
+00002580: 7365 0a20 2020 2020 2020 2073 656c 662e  se.        self.
+00002590: 706c 616e 7320 3d20 5b5d 0a20 2020 2020  plans = [].     
+000025a0: 2020 2073 656c 662e 616c 7068 615f 6f76     self.alpha_ov
+000025b0: 6572 5f62 6574 6120 3d20 616c 7068 615f  er_beta = alpha_
+000025c0: 6f76 6572 5f62 6574 610a 0a20 2020 2020  over_beta..     
+000025d0: 2020 2023 2050 726f 7065 7274 6965 7320     # Properties 
+000025e0: 7265 6c61 7469 6e67 2074 6f20 706c 616e  relating to plan
+000025f0: 2064 6f73 6520 636f 6e73 7472 6169 6e74   dose constraint
+00002600: 730a 2020 2020 2020 2020 7365 6c66 2e72  s.        self.r
+00002610: 6f69 5f74 7970 6520 3d20 4e6f 6e65 0a20  oi_type = None. 
+00002620: 2020 2020 2020 2073 656c 662e 636f 6e73         self.cons
+00002630: 7472 6169 6e74 203d 204e 6f6e 650a 0a20  traint = None.. 
+00002640: 2020 2020 2020 2023 2043 7265 6174 6520         # Create 
+00002650: 6e61 6d65 0a20 2020 2020 2020 2073 656c  name.        sel
+00002660: 662e 6e61 6d65 203d 206e 616d 650a 2020  f.name = name.  
+00002670: 2020 2020 2020 6966 2073 656c 662e 6e61        if self.na
+00002680: 6d65 2069 7320 4e6f 6e65 3a0a 2020 2020  me is None:.    
+00002690: 2020 2020 2020 2020 6966 2069 7369 6e73          if isins
+000026a0: 7461 6e63 6528 7365 6c66 2e73 6f75 7263  tance(self.sourc
+000026b0: 652c 2073 7472 293a 0a20 2020 2020 2020  e, str):.       
+000026c0: 2020 2020 2020 2020 2062 6173 656e 616d           basenam
+000026d0: 6520 3d20 6f73 2e70 6174 682e 6261 7365  e = os.path.base
+000026e0: 6e61 6d65 2873 656c 662e 736f 7572 6365  name(self.source
+000026f0: 292e 7370 6c69 7428 222e 2229 5b30 5d0a  ).split(".")[0].
+00002700: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002710: 6e61 6d65 203d 2072 652e 7375 6228 7222  name = re.sub(r"
+00002720: 5254 5354 5255 4354 5f5b 4d56 4354 5d2b  RTSTRUCT_[MVCT]+
+00002730: 5f5c 642b 5f5c 642b 5f5c 642b 222c 2022  _\d+_\d+_\d+", "
+00002740: 222c 2062 6173 656e 616d 6529 0a20 2020  ", basename).   
+00002750: 2020 2020 2020 2020 2020 2020 2023 2020               #  
+00002760: 7365 6c66 2e6e 616d 6520 3d20 6e61 6d65  self.name = name
+00002770: 5b30 5d2e 7570 7065 7228 2920 2b20 6e61  [0].upper() + na
+00002780: 6d65 5b31 3a5d 0a20 2020 2020 2020 2020  me[1:].         
 00002790: 2020 2020 2020 2073 656c 662e 6e61 6d65         self.name
-000027a0: 203d 2052 4f49 4465 6661 756c 7473 2829   = ROIDefaults()
-000027b0: 2e67 6574 5f64 6566 6175 6c74 5f72 6f69  .get_default_roi
-000027c0: 5f6e 616d 6528 290a 2020 2020 2020 2020  _name().        
-000027d0: 7365 6c66 2e6f 7269 6769 6e61 6c5f 6e61  self.original_na
-000027e0: 6d65 203d 206e 616d 650a 2020 2020 2020  me = name.      
-000027f0: 2020 7365 6c66 2e74 6974 6c65 203d 204e    self.title = N
-00002800: 6f6e 650a 0a20 2020 2020 2020 2023 2052  one..        # R
-00002810: 4f49 206e 756d 6265 7220 6173 2064 6566  OI number as def
-00002820: 696e 6564 2069 6e20 4449 434f 4d20 5254  ined in DICOM RT
-00002830: 5354 5255 4354 2066 696c 652e 0a20 2020  STRUCT file..   
-00002840: 2020 2020 2023 204c 6566 7420 746f 204e       # Left to N
-00002850: 6f6e 6520 666f 7220 524f 4920 6c6f 6164  one for ROI load
-00002860: 6564 2066 726f 6d20 6e6f 6e2d 4449 434f  ed from non-DICO
-00002870: 4d20 736f 7572 6365 2e0a 2020 2020 2020  M source..      
-00002880: 2020 7365 6c66 2e6e 756d 6265 7220 3d20    self.number = 
-00002890: 4e6f 6e65 0a0a 2020 2020 2020 2020 2320  None..        # 
-000028a0: 4c6f 6164 2052 4f49 2064 6174 610a 2020  Load ROI data.  
-000028b0: 2020 2020 2020 7365 6c66 2e6c 6f61 6465        self.loade
-000028c0: 6420 3d20 4661 6c73 650a 2020 2020 2020  d = False.      
-000028d0: 2020 7365 6c66 2e6c 6f61 6465 645f 6d61    self.loaded_ma
-000028e0: 736b 203d 2046 616c 7365 0a20 2020 2020  sk = False.     
-000028f0: 2020 2069 6620 6c6f 6164 3a0a 2020 2020     if load:.    
-00002900: 2020 2020 2020 2020 7365 6c66 2e6c 6f61          self.loa
-00002910: 6428 290a 0a20 2020 2020 2020 2023 2049  d()..        # I
-00002920: 6e69 7469 616c 6973 6520 6173 2073 6b72  nitialise as skr
-00002930: 742e 636f 7265 2e41 7263 6869 7665 206f  t.core.Archive o
-00002940: 626a 6563 740a 2020 2020 2020 2020 7061  bject.        pa
-00002950: 7468 203d 2073 656c 662e 736f 7572 6365  th = self.source
-00002960: 2069 6620 6973 696e 7374 616e 6365 2873   if isinstance(s
-00002970: 656c 662e 736f 7572 6365 2c20 7374 7229  elf.source, str)
-00002980: 2065 6c73 6520 2222 0a20 2020 2020 2020   else "".       
-00002990: 2073 6b72 742e 636f 7265 2e41 7263 6869   skrt.core.Archi
-000029a0: 7665 2e5f 5f69 6e69 745f 5f28 7365 6c66  ve.__init__(self
-000029b0: 2c20 7061 7468 290a 0a20 2020 2064 6566  , path)..    def
-000029c0: 205f 5f65 715f 5f28 7365 6c66 2c20 6f74   __eq__(self, ot
-000029d0: 6865 7229 3a0a 2020 2020 2020 2020 7265  her):.        re
-000029e0: 7475 726e 206f 7468 6572 2069 7320 7365  turn other is se
-000029f0: 6c66 0a0a 2020 2020 6465 6620 6c6f 6164  lf..    def load
-00002a00: 2873 656c 662c 2066 6f72 6365 3d46 616c  (self, force=Fal
-00002a10: 7365 293a 0a20 2020 2020 2020 2022 2222  se):.        """
-00002a20: 4c6f 6164 2052 4f49 2066 726f 6d20 6669  Load ROI from fi
-00002a30: 6c65 206f 7220 736f 7572 6365 2e20 5468  le or source. Th
-00002a40: 6520 6c6f 6164 696e 6720 7365 7175 656e  e loading sequen
-00002a50: 6365 2069 7320 6173 2066 6f6c 6c6f 7773  ce is as follows
-00002a60: 3a0a 0a20 2020 2020 2020 2031 2e20 4966  :..        1. If
-00002a70: 2073 656c 662e 696d 6167 6520 6973 206e   self.image is n
-00002a80: 6f74 204e 6f6e 652c 2065 6e73 7572 6520  ot None, ensure 
-00002a90: 7468 6174 2074 6865 2069 6d61 6765 2069  that the image i
-00002aa0: 7320 6c6f 6164 6564 2061 6e64 200a 2020  s loaded and .  
-00002ab0: 2020 2020 2020 6173 7369 676e 2069 7473        assign its
-00002ac0: 2067 656f 6d65 7472 6963 2070 726f 7065   geometric prope
-00002ad0: 7274 6965 7320 746f 2074 6869 7320 524f  rties to this RO
-00002ae0: 492e 0a0a 2020 2020 2020 2020 322e 2041  I...        2. A
-00002af0: 7474 656d 7074 2074 6f20 6c6f 6164 2064  ttempt to load d
-00002b00: 6174 6120 6672 6f6d 2073 656c 662e 736f  ata from self.so
-00002b10: 7572 6365 3a0a 0a20 2020 2020 2020 2028  urce:..        (
-00002b20: 6129 2049 6620 7468 6973 2069 7320 616e  a) If this is an
-00002b30: 2049 6d61 6765 206f 626a 6563 742c 2074   Image object, t
-00002b40: 6865 2052 4f49 2077 696c 6c20 6265 2063  he ROI will be c
-00002b50: 7265 6174 6564 2062 7920 6170 706c 7969  reated by applyi
-00002b60: 6e67 2061 200a 2020 2020 2020 2020 7468  ng a .        th
-00002b70: 7265 7368 6f6c 6420 746f 2074 6865 2049  reshold to the I
-00002b80: 6d61 6765 2773 2061 7272 6179 2e20 5365  mage's array. Se
-00002b90: 7420 7365 6c66 2e6d 6173 6b20 746f 2074  t self.mask to t
-00002ba0: 6865 2074 6872 6573 686f 6c64 6564 2069  he thresholded i
-00002bb0: 6d61 6765 0a20 2020 2020 2020 2061 6e64  mage.        and
-00002bc0: 2073 656c 662e 696e 7075 745f 7479 7065   self.input_type
-00002bd0: 203d 2022 6d61 736b 222e 0a20 2020 2020   = "mask"..     
-00002be0: 2020 2028 6229 2049 6620 7365 6c66 2e73     (b) If self.s
-00002bf0: 6f75 7263 6520 6973 2061 2073 7472 696e  ource is a strin
-00002c00: 672c 2061 7474 656d 7074 2074 6f20 6c6f  g, attempt to lo
-00002c10: 6164 2066 726f 6d20 6120 6669 6c65 0a20  ad from a file. 
-00002c20: 2020 2020 2020 2063 6f6e 666f 726d 696e         conformin
-00002c30: 6720 746f 2074 7261 6e73 666f 726d 6978  g to transformix
-00002c40: 206f 7574 7075 7420 282e 7478 7420 6578   output (.txt ex
-00002c50: 7465 6e73 696f 6e29 206f 7220 6672 6f6d  tension) or from
-00002c60: 2061 0a20 2020 2020 2020 2064 6963 6f6d   a.        dicom
-00002c70: 2073 7472 7563 7475 7265 2073 6574 2028   structure set (
-00002c80: 696e 2062 6f74 6820 6361 7365 7320 7365  in both cases se
-00002c90: 7474 696e 6720 7365 6c66 2e69 6e70 7574  tting self.input
-00002ca0: 5f63 6f6e 746f 7572 7329 2e0a 2020 2020  _contours)..    
-00002cb0: 2020 2020 2863 2920 4966 2074 7261 6e73      (c) If trans
-00002cc0: 666f 726d 6978 206f 7220 6469 636f 6d20  formix or dicom 
-00002cd0: 6c6f 6164 696e 6720 6661 696c 732c 2061  loading fails, a
-00002ce0: 7474 656d 7074 2074 6f20 6c6f 6164 0a20  ttempt to load. 
-00002cf0: 2020 2020 2020 2073 656c 662e 736f 7572         self.sour
-00002d00: 6365 2061 7320 616e 2049 6d61 6765 206f  ce as an Image o
-00002d10: 626a 6563 7420 746f 2063 7265 6174 6520  bject to create 
-00002d20: 616e 2052 4f49 206d 6173 6b2e 2049 6620  an ROI mask. If 
-00002d30: 7468 6973 0a20 2020 2020 2020 2066 696e  this.        fin
-00002d40: 6473 2061 2076 616c 6964 2049 6d61 6765  ds a valid Image
-00002d50: 2c20 7365 7420 7365 6c66 2e6d 6173 6b20  , set self.mask 
-00002d60: 746f 2074 6861 7420 696d 6167 6520 616e  to that image an
-00002d70: 6420 7365 740a 2020 2020 2020 2020 7365  d set.        se
-00002d80: 6c66 2e69 6e70 7574 5f74 7970 6520 3d20  lf.input_type = 
-00002d90: 226d 6173 6b22 2e0a 2020 2020 2020 2020  "mask"..        
-00002da0: 2864 2920 4966 2073 656c 662e 736f 7572  (d) If self.sour
-00002db0: 6365 2069 7320 4e6f 6e65 2c20 646f 206e  ce is None, do n
-00002dc0: 6f74 6869 6e67 2077 6974 6820 6974 2e0a  othing with it..
-00002dd0: 0a20 2020 2020 2020 2033 2e20 4368 6563  .        3. Chec
-00002de0: 6b20 7768 6574 6865 7220 7365 6c66 2e69  k whether self.i
-00002df0: 6e70 7574 5f63 6f6e 746f 7572 7320 636f  nput_contours co
-00002e00: 6e74 6169 6e73 2064 6174 612e 2054 6869  ntains data. Thi
-00002e10: 7320 636f 756c 6420 6172 6973 650a 2020  s could arise.  
-00002e20: 2020 2020 2020 696e 2074 776f 2073 6365        in two sce
-00002e30: 6e61 7269 6f73 3a0a 2020 2020 2020 2020  narios:.        
-00002e40: 0a20 2020 2020 2020 2028 6129 2054 6865  .        (a) The
-00002e50: 2052 4f49 2077 6173 2069 6e69 7469 616c   ROI was initial
-00002e60: 6973 6564 2066 726f 6d20 6120 6469 6374  ised from a dict
-00002e70: 206f 6620 636f 6e74 6f75 7273 2c20 7768   of contours, wh
-00002e80: 6963 6820 7765 7265 0a20 2020 2020 2020  ich were.       
-00002e90: 2061 7373 6967 6e65 6420 746f 2073 656c   assigned to sel
-00002ea0: 662e 696e 7075 745f 636f 6e74 6f75 7273  f.input_contours
-00002eb0: 2069 6e20 7365 6c66 2e5f 5f69 6e69 7428   in self.__init(
-00002ec0: 293b 206f 720a 2020 2020 2020 2020 2862  ); or.        (b
-00002ed0: 2920 4120 7365 7420 6f66 2063 6f6e 746f  ) A set of conto
-00002ee0: 7572 7320 7761 7320 7375 6363 6573 7366  urs was successf
-00002ef0: 756c 6c79 206c 6f61 6465 6420 6672 6f6d  ully loaded from
-00002f00: 2061 2074 7261 6e73 666f 726d 6978 206f   a transformix o
-00002f10: 720a 2020 2020 2020 2020 6469 636f 6d20  r.        dicom 
-00002f20: 6669 6c65 2066 6f75 6e64 2061 7420 7365  file found at se
-00002f30: 6c66 2e73 6f75 7263 6520 696e 2073 7465  lf.source in ste
-00002f40: 7020 3128 6229 2e0a 0a20 2020 2020 2020  p 1(b)...       
-00002f50: 2049 6620 696e 7075 7420 636f 6e74 6f75   If input contou
-00002f60: 7273 2061 7265 2066 6f75 6e64 2c20 7468  rs are found, th
-00002f70: 6573 6520 6172 6520 6173 7369 676e 6564  ese are assigned
-00002f80: 2074 6f20 7365 6c66 2e63 6f6e 746f 7572   to self.contour
-00002f90: 735b 2278 2d79 225d 0a20 2020 2020 2020  s["x-y"].       
-00002fa0: 2061 6e64 2073 656c 662e 736f 7572 6365   and self.source
-00002fb0: 5f74 7970 6520 6973 2073 6574 2074 6f20  _type is set to 
-00002fc0: 2263 6f6e 746f 7572 222e 2041 6464 6974  "contour". Addit
-00002fd0: 696f 6e61 6c6c 792c 2069 6620 7365 6c66  ionally, if self
-00002fe0: 2e69 6d61 6765 0a20 2020 2020 2020 2069  .image.        i
-00002ff0: 7320 6e6f 7420 4e6f 6e65 2c20 7365 7420  s not None, set 
-00003000: 7365 6c66 2e6d 6173 6b20 746f 2061 6e20  self.mask to an 
-00003010: 6172 7261 7920 6f66 207a 6572 6f73 2074  array of zeros t
-00003020: 6865 2073 616d 6520 7369 7a65 2061 7320  he same size as 
-00003030: 7468 6520 0a20 2020 2020 2020 2069 6d61  the .        ima
-00003040: 6765 2e0a 0a20 2020 2020 2020 2034 2e20  ge...        4. 
-00003050: 5365 7420 6120 666c 6167 2069 6e64 6963  Set a flag indic
-00003060: 6174 696e 6720 7768 6574 6865 7220 7468  ating whether th
-00003070: 6973 2052 4f49 2068 6173 2063 6f6e 746f  is ROI has conto
-00003080: 7572 7320 6f6e 6c79 2028 692e 6520 6e6f  urs only (i.e no
-00003090: 0a20 2020 2020 2020 206d 6173 6b20 6f72  .        mask or
-000030a0: 2069 6d61 6765 2066 726f 6d20 7768 6963   image from whic
-000030b0: 6820 746f 2064 7261 7720 6f72 6967 696e  h to draw origin
-000030c0: 2f76 6f78 656c 2073 697a 6573 292c 2061  /voxel sizes), a
-000030d0: 6e64 2073 6574 0a20 2020 2020 2020 2064  nd set.        d
-000030e0: 6566 6175 6c74 2067 656f 6d65 7472 6963  efault geometric
-000030f0: 2063 616c 6375 6c61 7469 6f6e 206d 6574   calculation met
-00003100: 686f 6420 746f 2073 656c 662e 736f 7572  hod to self.sour
-00003110: 6365 5f74 7970 652e 2053 6574 0a20 2020  ce_type. Set.   
-00003120: 2020 2020 2073 656c 662e 6c6f 6164 6564       self.loaded
-00003130: 2074 6f20 5472 7565 2e0a 2020 2020 2020   to True..      
-00003140: 2020 2222 220a 0a20 2020 2020 2020 2069    """..        i
-00003150: 6620 7365 6c66 2e6c 6f61 6465 6420 616e  f self.loaded an
-00003160: 6420 6e6f 7420 666f 7263 653a 0a20 2020  d not force:.   
-00003170: 2020 2020 2020 2020 2072 6574 7572 6e0a           return.
-00003180: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
-00003190: 2e69 6d61 6765 3a0a 2020 2020 2020 2020  .image:.        
-000031a0: 2020 2020 7365 6c66 2e69 6d61 6765 2e6c      self.image.l
-000031b0: 6f61 6428 290a 2020 2020 2020 2020 2020  oad().          
-000031c0: 2020 7365 6c66 2e73 6861 7065 203d 2073    self.shape = s
-000031d0: 656c 662e 696d 6167 652e 6765 745f 6461  elf.image.get_da
-000031e0: 7461 2829 2e73 6861 7065 0a20 2020 2020  ta().shape.     
-000031f0: 2020 2020 2020 2073 656c 662e 6166 6669         self.affi
-00003200: 6e65 203d 2073 656c 662e 696d 6167 652e  ne = self.image.
-00003210: 6765 745f 6166 6669 6e65 2829 0a20 2020  get_affine().   
-00003220: 2020 2020 2020 2020 2073 656c 662e 766f           self.vo
-00003230: 7865 6c5f 7369 7a65 203d 2073 656c 662e  xel_size = self.
-00003240: 696d 6167 652e 6765 745f 766f 7865 6c5f  image.get_voxel_
-00003250: 7369 7a65 2829 0a20 2020 2020 2020 2020  size().         
-00003260: 2020 2073 656c 662e 6f72 6967 696e 203d     self.origin =
-00003270: 2073 656c 662e 696d 6167 652e 6765 745f   self.image.get_
-00003280: 6f72 6967 696e 2829 0a0a 2020 2020 2020  origin()..      
-00003290: 2020 726f 6973 203d 205b 5d0a 0a20 2020    rois = []..   
-000032a0: 2020 2020 2023 204c 6f61 6420 6672 6f6d       # Load from
-000032b0: 2061 6e20 6578 6973 7469 6e67 2049 6d61   an existing Ima
-000032c0: 6765 0a20 2020 2020 2020 2069 6620 6973  ge.        if is
-000032d0: 7375 6263 6c61 7373 2874 7970 6528 7365  subclass(type(se
-000032e0: 6c66 2e73 6f75 7263 6529 2c20 736b 7274  lf.source), skrt
-000032f0: 2e69 6d61 6765 2e49 6d61 6765 293a 0a20  .image.Image):. 
-00003300: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
-00003310: 7420 7365 6c66 2e69 6d61 6765 3a0a 2020  t self.image:.  
-00003320: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00003330: 6c66 2e69 6d61 6765 203d 2073 656c 662e  lf.image = self.
-00003340: 736f 7572 6365 0a20 2020 2020 2020 2020  source.         
-00003350: 2020 2073 656c 662e 6d61 736b 203d 2073     self.mask = s
-00003360: 6b72 742e 696d 6167 652e 496d 6167 6528  krt.image.Image(
-00003370: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00003380: 2073 656c 662e 736f 7572 6365 2e67 6574   self.source.get
-00003390: 5f64 6174 6128 2920 3e20 7365 6c66 2e6d  _data() > self.m
-000033a0: 6173 6b5f 7468 7265 7368 6f6c 642c 0a20  ask_threshold,. 
-000033b0: 2020 2020 2020 2020 2020 2020 2020 2061                 a
-000033c0: 6666 696e 653d 7365 6c66 2e73 6f75 7263  ffine=self.sourc
-000033d0: 652e 6765 745f 6166 6669 6e65 2829 0a20  e.get_affine(). 
-000033e0: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
-000033f0: 2020 2020 2020 2020 2073 656c 662e 736f           self.so
-00003400: 7572 6365 5f74 7970 6520 3d20 226d 6173  urce_type = "mas
-00003410: 6b22 0a20 2020 2020 2020 2020 2020 2073  k".            s
-00003420: 656c 662e 6c6f 6164 6564 203d 2054 7275  elf.loaded = Tru
-00003430: 650a 2020 2020 2020 2020 2020 2020 7365  e.            se
-00003440: 6c66 2e63 7265 6174 655f 6d61 736b 2829  lf.create_mask()
-00003450: 0a0a 2020 2020 2020 2020 656c 6966 2069  ..        elif i
-00003460: 7369 6e73 7461 6e63 6528 7365 6c66 2e73  sinstance(self.s
-00003470: 6f75 7263 652c 2073 7472 293a 0a20 2020  ource, str):.   
-00003480: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
-00003490: 2e73 6f75 7263 652e 656e 6473 7769 7468  .source.endswith
-000034a0: 2827 2e74 7874 2729 3a0a 2020 2020 2020  ('.txt'):.      
-000034b0: 2020 2020 2020 2020 2020 2320 5472 7920            # Try 
-000034c0: 6c6f 6164 696e 6720 6672 6f6d 2074 7261  loading from tra
-000034d0: 6e73 666f 726d 6978 2d63 6f6d 7061 7469  nsformix-compati
-000034e0: 626c 6520 706f 696e 7420 636c 6f75 640a  ble point cloud.
-000034f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003500: 706f 696e 7473 203d 2073 656c 662e 6c6f  points = self.lo
-00003510: 6164 5f74 7261 6e73 666f 726d 6978 5f70  ad_transformix_p
-00003520: 6f69 6e74 7328 290a 0a20 2020 2020 2020  oints()..       
-00003530: 2020 2020 2020 2020 2023 2045 7874 7261           # Extra
-00003540: 6374 2073 6c69 6365 2d62 792d 736c 6963  ct slice-by-slic
-00003550: 6520 6469 6374 696f 6e61 7279 206f 6620  e dictionary of 
-00003560: 2878 2c20 7929 2070 6f69 6e74 730a 2020  (x, y) points.  
-00003570: 2020 2020 2020 2020 2020 2020 2020 636f                co
-00003580: 6e74 6f75 7273 203d 207b 7d0a 2020 2020  ntours = {}.    
-00003590: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-000035a0: 706f 696e 7420 696e 2073 6f72 7465 6428  point in sorted(
-000035b0: 706f 696e 7473 293a 0a20 2020 2020 2020  points):.       
-000035c0: 2020 2020 2020 2020 2020 2020 2078 5f70               x_p
-000035d0: 6f69 6e74 2c20 795f 706f 696e 742c 207a  oint, y_point, z
-000035e0: 5f70 6f69 6e74 203d 2070 6f69 6e74 735b  _point = points[
-000035f0: 706f 696e 745d 5b27 4f75 7470 7574 506f  point]['OutputPo
-00003600: 696e 7427 5d0a 2020 2020 2020 2020 2020  int'].          
-00003610: 2020 2020 2020 2020 2020 6b65 7920 3d20            key = 
-00003620: 6627 7b7a 5f70 6f69 6e74 3a2e 3266 7d27  f'{z_point:.2f}'
-00003630: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00003640: 2020 2020 2069 6620 6e6f 7420 6b65 7920       if not key 
-00003650: 696e 2063 6f6e 746f 7572 733a 0a20 2020  in contours:.   
-00003660: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003670: 2020 2020 2063 6f6e 746f 7572 735b 6b65       contours[ke
-00003680: 795d 203d 207b 7d0a 2020 2020 2020 2020  y] = {}.        
-00003690: 2020 2020 2020 2020 2020 2020 635f 696e              c_in
-000036a0: 6465 7820 3d20 706f 696e 7473 5b70 6f69  dex = points[poi
-000036b0: 6e74 5d5b 2743 6f6e 746f 7572 496e 6465  nt]['ContourInde
-000036c0: 7827 5d0a 2020 2020 2020 2020 2020 2020  x'].            
-000036d0: 2020 2020 2020 2020 6966 206e 6f74 2063          if not c
-000036e0: 5f69 6e64 6578 2069 6e20 636f 6e74 6f75  _index in contou
-000036f0: 7273 5b6b 6579 5d3a 0a20 2020 2020 2020  rs[key]:.       
-00003700: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003710: 2063 6f6e 746f 7572 735b 6b65 795d 5b63   contours[key][c
-00003720: 5f69 6e64 6578 5d20 3d20 5b5d 0a20 2020  _index] = [].   
-00003730: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003740: 2063 6f6e 746f 7572 735b 6b65 795d 5b63   contours[key][c
-00003750: 5f69 6e64 6578 5d2e 6170 7065 6e64 285b  _index].append([
-00003760: 785f 706f 696e 742c 2079 5f70 6f69 6e74  x_point, y_point
-00003770: 5d29 0a0a 2020 2020 2020 2020 2020 2020  ])..            
-00003780: 2020 2020 2320 5374 6f72 6520 7468 6520      # Store the 
-00003790: 6c69 7374 206f 6620 636f 6e74 6f75 7273  list of contours
-000037a0: 2e0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000037b0: 2020 7365 6c66 2e69 6e70 7574 5f63 6f6e    self.input_con
-000037c0: 746f 7572 7320 3d20 7b7d 0a20 2020 2020  tours = {}.     
-000037d0: 2020 2020 2020 2020 2020 2066 6f72 206b             for k
-000037e0: 6579 2069 6e20 736f 7274 6564 2863 6f6e  ey in sorted(con
-000037f0: 746f 7572 7329 3a0a 2020 2020 2020 2020  tours):.        
-00003800: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00003810: 2e69 6e70 7574 5f63 6f6e 746f 7572 735b  .input_contours[
-00003820: 666c 6f61 7428 6b65 7929 5d20 3d20 5b5d  float(key)] = []
-00003830: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00003840: 2020 2020 2066 6f72 2063 5f69 6e64 6578       for c_index
-00003850: 2069 6e20 736f 7274 6564 2863 6f6e 746f   in sorted(conto
-00003860: 7572 735b 6b65 795d 293a 0a20 2020 2020  urs[key]):.     
-00003870: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003880: 2020 2073 656c 662e 696e 7075 745f 636f     self.input_co
-00003890: 6e74 6f75 7273 5b66 6c6f 6174 286b 6579  ntours[float(key
-000038a0: 295d 2e61 7070 656e 6428 0a20 2020 2020  )].append(.     
-000038b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000038c0: 2020 2020 2020 206e 702e 6172 7261 7928         np.array(
-000038d0: 636f 6e74 6f75 7273 5b6b 6579 5d5b 635f  contours[key][c_
-000038e0: 696e 6465 785d 2929 0a20 2020 2020 2020  index])).       
-000038f0: 2020 2020 2020 2020 2072 6f69 732e 6170           rois.ap
-00003900: 7065 6e64 2873 656c 662e 6e61 6d65 290a  pend(self.name).
-00003910: 0a20 2020 2020 2020 2020 2020 2065 6c69  .            eli
-00003920: 6620 6f73 2e70 6174 682e 6973 6469 7228  f os.path.isdir(
-00003930: 7365 6c66 2e73 6f75 7263 6529 206f 7220  self.source) or 
-00003940: 6e6f 7420 7365 6c66 2e73 6f75 7263 652e  not self.source.
-00003950: 656e 6473 7769 7468 2827 2e6e 6969 2729  endswith('.nii')
-00003960: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00003970: 2020 2320 5472 7920 6c6f 6164 696e 6720    # Try loading 
-00003980: 6672 6f6d 2064 6963 6f6d 2073 7472 7563  from dicom struc
-00003990: 7475 7265 2073 6574 0a20 2020 2020 2020  ture set.       
-000039a0: 2020 2020 2020 2020 2072 6f69 732c 2064           rois, d
-000039b0: 7320 3d20 6c6f 6164 5f72 6f69 735f 6469  s = load_rois_di
-000039c0: 636f 6d28 7365 6c66 2e73 6f75 7263 652c  com(self.source,
-000039d0: 206e 616d 6573 3d73 656c 662e 6e61 6d65   names=self.name
-000039e0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-000039f0: 2020 6966 206c 656e 2872 6f69 7329 3a0a    if len(rois):.
-00003a00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003a10: 2020 2020 6e75 6d62 6572 203d 206c 6973      number = lis
-00003a20: 7428 726f 6973 2e6b 6579 7328 2929 5b30  t(rois.keys())[0
-00003a30: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
-00003a40: 2020 2020 2020 726f 6920 3d20 726f 6973        roi = rois
-00003a50: 5b6e 756d 6265 725d 0a20 2020 2020 2020  [number].       
-00003a60: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-00003a70: 662e 6e61 6d65 203d 2072 6f69 5b22 6e61  f.name = roi["na
-00003a80: 6d65 225d 0a20 2020 2020 2020 2020 2020  me"].           
-00003a90: 2020 2020 2020 2020 2073 656c 662e 6e75           self.nu
-00003aa0: 6d62 6572 203d 206e 756d 6265 720a 2020  mber = number.  
-00003ab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003ac0: 2020 7365 6c66 2e69 6e70 7574 5f63 6f6e    self.input_con
-00003ad0: 746f 7572 7320 3d20 726f 695b 2263 6f6e  tours = roi["con
-00003ae0: 746f 7572 7322 5d0a 2020 2020 2020 2020  tours"].        
-00003af0: 2020 2020 2020 2020 2020 2020 6966 206e              if n
-00003b00: 6f74 2073 656c 662e 6375 7374 6f6d 5f63  ot self.custom_c
-00003b10: 6f6c 6f72 3a0a 2020 2020 2020 2020 2020  olor:.          
-00003b20: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00003b30: 6c66 2e73 6574 5f63 6f6c 6f72 2872 6f69  lf.set_color(roi
-00003b40: 5b22 636f 6c6f 7222 5d29 0a20 2020 2020  ["color"]).     
-00003b50: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00003b60: 656c 662e 6469 636f 6d5f 6461 7461 7365  elf.dicom_datase
-00003b70: 7420 3d20 6473 0a0a 2020 2020 2020 2020  t = ds..        
-00003b80: 2320 4c6f 6164 2052 4f49 206d 6173 6b0a  # Load ROI mask.
-00003b90: 2020 2020 2020 2020 6966 206e 6f74 2073          if not s
-00003ba0: 656c 662e 6c6f 6164 6564 2061 6e64 206e  elf.loaded and n
-00003bb0: 6f74 206c 656e 2872 6f69 7329 2061 6e64  ot len(rois) and
-00003bc0: 2073 656c 662e 736f 7572 6365 2069 7320   self.source is 
-00003bd0: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
-00003be0: 2020 2020 2020 7365 6c66 2e6d 6173 6b20        self.mask 
-00003bf0: 3d20 736b 7274 2e69 6d61 6765 2e49 6d61  = skrt.image.Ima
-00003c00: 6765 280a 2020 2020 2020 2020 2020 2020  ge(.            
-00003c10: 2020 2020 7365 6c66 2e73 6f75 7263 652c      self.source,
-00003c20: 200a 2020 2020 2020 2020 2020 2020 2020   .              
-00003c30: 2020 6166 6669 6e65 3d73 656c 662e 6166    affine=self.af
-00003c40: 6669 6e65 2c20 0a20 2020 2020 2020 2020  fine, .         
-00003c50: 2020 2020 2020 2076 6f78 656c 5f73 697a         voxel_siz
-00003c60: 653d 7365 6c66 2e76 6f78 656c 5f73 697a  e=self.voxel_siz
-00003c70: 652c 200a 2020 2020 2020 2020 2020 2020  e, .            
-00003c80: 2020 2020 6f72 6967 696e 3d73 656c 662e      origin=self.
-00003c90: 6f72 6967 696e 2c20 0a20 2020 2020 2020  origin, .       
-00003ca0: 2020 2020 2020 2020 2064 7479 7065 3d62           dtype=b
-00003cb0: 6f6f 6c2c 0a20 2020 2020 2020 2020 2020  ool,.           
-00003cc0: 2020 2020 202a 2a73 656c 662e 6b77 6172       **self.kwar
-00003cd0: 6773 0a20 2020 2020 2020 2020 2020 2029  gs.            )
-00003ce0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00003cf0: 662e 6c6f 6164 6564 203d 2054 7275 650a  f.loaded = True.
-00003d00: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00003d10: 2e73 6f75 7263 655f 7479 7065 203d 2022  .source_type = "
-00003d20: 6d61 736b 220a 2020 2020 2020 2020 2020  mask".          
-00003d30: 2020 7365 6c66 2e63 7265 6174 655f 6d61    self.create_ma
-00003d40: 736b 2829 0a0a 2020 2020 2020 2020 2320  sk()..        # 
-00003d50: 4465 616c 2077 6974 6820 696e 7075 7420  Deal with input 
-00003d60: 636f 6e74 6f75 7273 0a20 2020 2020 2020  contours.       
-00003d70: 2069 6620 7365 6c66 2e69 6e70 7574 5f63   if self.input_c
-00003d80: 6f6e 746f 7572 7320 6973 206e 6f74 204e  ontours is not N
-00003d90: 6f6e 653a 0a0a 2020 2020 2020 2020 2020  one:..          
-00003da0: 2020 2320 4372 6561 7465 2049 6d61 6765    # Create Image
-00003db0: 206f 626a 6563 740a 2020 2020 2020 2020   object.        
-00003dc0: 2020 2020 6966 2073 656c 662e 696d 6167      if self.imag
-00003dd0: 6520 6973 206e 6f74 204e 6f6e 653a 0a20  e is not None:. 
-00003de0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00003df0: 656c 662e 7368 6170 6520 3d20 7365 6c66  elf.shape = self
-00003e00: 2e69 6d61 6765 2e64 6174 612e 7368 6170  .image.data.shap
-00003e10: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
-00003e20: 2020 7365 6c66 2e6d 6173 6b20 3d20 736b    self.mask = sk
-00003e30: 7274 2e69 6d61 6765 2e49 6d61 6765 280a  rt.image.Image(.
-00003e40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003e50: 2020 2020 6e70 2e7a 6572 6f73 2873 656c      np.zeros(sel
-00003e60: 662e 7368 6170 6529 2c20 0a20 2020 2020  f.shape), .     
-00003e70: 2020 2020 2020 2020 2020 2020 2020 2061                 a
-00003e80: 6666 696e 653d 7365 6c66 2e69 6d61 6765  ffine=self.image
-00003e90: 2e67 6574 5f61 6666 696e 6528 292c 200a  .get_affine(), .
-00003ea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003eb0: 2020 2020 2a2a 7365 6c66 2e6b 7761 7267      **self.kwarg
-00003ec0: 730a 2020 2020 2020 2020 2020 2020 2020  s.              
-00003ed0: 2020 290a 0a20 2020 2020 2020 2020 2020    )..           
-00003ee0: 2023 2053 6574 2078 2d79 2063 6f6e 746f   # Set x-y conto
-00003ef0: 7572 7320 7769 7468 207a 2070 6f73 6974  urs with z posit
-00003f00: 696f 6e73 2061 7320 6b65 7973 0a20 2020  ions as keys.   
-00003f10: 2020 2020 2020 2020 2073 656c 662e 636f           self.co
-00003f20: 6e74 6f75 7273 5b22 782d 7922 5d20 3d20  ntours["x-y"] = 
-00003f30: 7b7d 0a20 2020 2020 2020 2020 2020 2066  {}.            f
-00003f40: 6f72 207a 2c20 636f 6e74 6f75 7273 2069  or z, contours i
-00003f50: 6e20 7365 6c66 2e69 6e70 7574 5f63 6f6e  n self.input_con
-00003f60: 746f 7572 732e 6974 656d 7328 293a 0a20  tours.items():. 
-00003f70: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00003f80: 656c 662e 636f 6e74 6f75 7273 5b22 782d  elf.contours["x-
-00003f90: 7922 5d5b 7a5d 203d 205b 636f 6e74 6f75  y"][z] = [contou
-00003fa0: 725b 3a2c 203a 325d 2066 6f72 2063 6f6e  r[:, :2] for con
-00003fb0: 746f 7572 2069 6e20 636f 6e74 6f75 7273  tour in contours
-00003fc0: 5d0a 2020 2020 2020 2020 2020 2020 7365  ].            se
-00003fd0: 6c66 2e73 6f75 7263 655f 7479 7065 203d  lf.source_type =
-00003fe0: 2022 636f 6e74 6f75 7222 0a20 2020 2020   "contour".     
-00003ff0: 2020 2020 2020 2073 656c 662e 6c6f 6164         self.load
-00004000: 6564 203d 2054 7275 650a 0a20 2020 2020  ed = True..     
-00004010: 2020 2023 2053 746f 7265 2066 6c61 6720     # Store flag 
-00004020: 666f 7220 6361 7365 7320 7769 7468 206e  for cases with n
-00004030: 6f20 6173 736f 6369 6174 6564 2069 6d61  o associated ima
-00004040: 6765 206f 7220 6765 6f6d 6574 7269 6320  ge or geometric 
-00004050: 696e 666f 0a20 2020 2020 2020 2068 6173  info.        has
-00004060: 5f69 6d61 6765 203d 2073 656c 662e 696d  _image = self.im
-00004070: 6167 6520 6973 206e 6f74 204e 6f6e 650a  age is not None.
-00004080: 2020 2020 2020 2020 6861 735f 6765 6f6d          has_geom
-00004090: 203d 2073 656c 662e 7368 6170 6520 6973   = self.shape is
-000040a0: 206e 6f74 204e 6f6e 6520 616e 6420 280a   not None and (.
-000040b0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-000040c0: 2e61 6666 696e 6520 6973 206e 6f74 204e  .affine is not N
-000040d0: 6f6e 6520 6f72 2028 0a20 2020 2020 2020  one or (.       
-000040e0: 2020 2020 2020 2020 2073 656c 662e 766f           self.vo
-000040f0: 7865 6c5f 7369 7a65 2069 7320 6e6f 7420  xel_size is not 
-00004100: 4e6f 6e65 2061 6e64 2073 656c 662e 6f72  None and self.or
-00004110: 6967 696e 2069 7320 6e6f 7420 4e6f 6e65  igin is not None
-00004120: 0a20 2020 2020 2020 2020 2020 2029 290a  .            )).
-00004130: 2020 2020 2020 2020 7365 6c66 2e63 6f6e          self.con
-00004140: 746f 7572 735f 6f6e 6c79 203d 2073 656c  tours_only = sel
-00004150: 662e 736f 7572 6365 5f74 7970 6520 3d3d  f.source_type ==
-00004160: 2022 636f 6e74 6f75 7222 205c 0a20 2020   "contour" \.   
-00004170: 2020 2020 2020 2020 2020 2020 2061 6e64               and
-00004180: 206e 6f74 2068 6173 5f69 6d61 6765 2061   not has_image a
-00004190: 6e64 206e 6f74 2068 6173 5f67 656f 6d0a  nd not has_geom.
-000041a0: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-000041b0: 6465 6661 756c 745f 6765 6f6d 5f6d 6574  default_geom_met
-000041c0: 686f 6420 3d3d 2022 6175 746f 223a 0a20  hod == "auto":. 
-000041d0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-000041e0: 6465 6661 756c 745f 6765 6f6d 5f6d 6574  default_geom_met
-000041f0: 686f 6420 3d20 7365 6c66 2e73 6f75 7263  hod = self.sourc
-00004200: 655f 7479 7065 0a0a 2020 2020 2020 2020  e_type..        
-00004210: 2320 5374 6f72 6520 666c 6167 2066 6f72  # Store flag for
-00004220: 2065 6d70 7469 6e65 7373 0a20 2020 2020   emptiness.     
-00004230: 2020 2069 6620 7365 6c66 2e73 6f75 7263     if self.sourc
-00004240: 655f 7479 7065 203d 3d20 2263 6f6e 746f  e_type == "conto
-00004250: 7572 223a 0a20 2020 2020 2020 2020 2020  ur":.           
-00004260: 2073 656c 662e 656d 7074 7920 3d20 6e6f   self.empty = no
-00004270: 7420 6c65 6e28 7365 6c66 2e69 6e70 7574  t len(self.input
-00004280: 5f63 6f6e 746f 7572 7329 0a20 2020 2020  _contours).     
-00004290: 2020 2020 2020 2073 656c 662e 736c 6963         self.slic
-000042a0: 655f 7468 6963 6b6e 6573 735f 636f 6e74  e_thickness_cont
-000042b0: 6f75 7273 203d 2073 656c 662e 6765 745f  ours = self.get_
-000042c0: 736c 6963 655f 7468 6963 6b6e 6573 735f  slice_thickness_
-000042d0: 636f 6e74 6f75 7273 2829 0a20 2020 2020  contours().     
-000042e0: 2020 2065 6c69 6620 7365 6c66 2e73 6f75     elif self.sou
-000042f0: 7263 655f 7479 7065 203d 3d20 226d 6173  rce_type == "mas
-00004300: 6b22 3a0a 2020 2020 2020 2020 2020 2020  k":.            
-00004310: 7365 6c66 2e65 6d70 7479 203d 206e 6f74  self.empty = not
-00004320: 206e 702e 616e 7928 7365 6c66 2e6d 6173   np.any(self.mas
-00004330: 6b2e 6765 745f 6461 7461 2829 290a 2020  k.get_data()).  
-00004340: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-00004350: 2020 2020 2020 2020 7365 6c66 2e65 6d70          self.emp
-00004360: 7479 203d 2054 7275 650a 0a20 2020 2020  ty = True..     
-00004370: 2020 2073 656c 662e 6c6f 6164 6564 203d     self.loaded =
-00004380: 2054 7275 650a 0a20 2020 2064 6566 205f   True..    def _
-00004390: 6c6f 6164 5f66 726f 6d5f 6669 6c65 2873  load_from_file(s
-000043a0: 656c 662c 2066 696c 656e 616d 6529 3a0a  elf, filename):.
-000043b0: 2020 2020 2020 2020 2222 2241 7474 656d          """Attem
-000043c0: 7074 2074 6f20 6c6f 6164 2052 4f49 2066  pt to load ROI f
-000043d0: 726f 6d20 6120 6469 636f 6d20 6f72 206e  rom a dicom or n
-000043e0: 6966 7469 2066 696c 652e 2222 220a 0a20  ifti file.""".. 
-000043f0: 2020 2064 6566 206c 6f61 645f 7472 616e     def load_tran
-00004400: 7366 6f72 6d69 785f 706f 696e 7473 2873  sformix_points(s
-00004410: 656c 6629 3a0a 2020 2020 2020 2020 2727  elf):.        ''
-00004420: 270a 2020 2020 2020 2020 4c6f 6164 2070  '.        Load p
-00004430: 6f69 6e74 2063 6f6f 7264 696e 6174 6573  oint coordinates
-00004440: 2066 726f 6d20 6669 6c65 206f 6620 7468   from file of th
-00004450: 6520 666f 726d 6174 2070 726f 6475 6365  e format produce
-00004460: 6420 6279 2054 7261 6e73 666f 726d 6978  d by Transformix
-00004470: 2e0a 2020 2020 2020 2020 2727 270a 2020  ..        '''.  
-00004480: 2020 2020 2020 6465 6620 6765 745f 636f        def get_co
-00004490: 6f72 6469 6e61 7465 7328 696e 5f64 6174  ordinates(in_dat
-000044a0: 613d 2727 293a 0a20 2020 2020 2020 2020  a=''):.         
-000044b0: 2020 2027 2727 0a20 2020 2020 2020 2020     '''.         
-000044c0: 2020 2048 656c 7065 7220 6675 6e63 7469     Helper functi
-000044d0: 6f6e 2c20 746f 2075 6e70 6163 6b20 7374  on, to unpack st
-000044e0: 7269 6e67 206f 6620 6461 7461 2069 6e74  ring of data int
-000044f0: 6f20 6c69 7374 206f 6620 636f 6f72 6469  o list of coordi
-00004500: 6e61 7465 732e 200a 2020 2020 2020 2020  nates. .        
-00004510: 2020 2020 2727 270a 2020 2020 2020 2020      '''.        
-00004520: 2020 2020 636f 6f72 6469 6e61 7465 7320      coordinates 
-00004530: 3d20 5b65 7661 6c28 7329 0a20 2020 2020  = [eval(s).     
-00004540: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-00004550: 6f72 2073 2069 6e20 7265 2e66 696e 6461  or s in re.finda
-00004560: 6c6c 2872 275b 2d5c 645c 2e5d 2b27 2c20  ll(r'[-\d\.]+', 
-00004570: 696e 5f64 6174 6129 5d0a 2020 2020 2020  in_data)].      
-00004580: 2020 2020 2020 7265 7475 726e 2063 6f6f        return coo
-00004590: 7264 696e 6174 6573 0a0a 2020 2020 2020  rdinates..      
-000045a0: 2020 2320 5265 6164 2066 696c 652e 0a20    # Read file.. 
-000045b0: 2020 2020 2020 2077 6974 6820 6f70 656e         with open
-000045c0: 2873 656c 662e 736f 7572 6365 2c20 2772  (self.source, 'r
-000045d0: 272c 2065 6e63 6f64 696e 673d 2761 7363  ', encoding='asc
-000045e0: 6969 2729 2061 7320 696e 5f66 696c 653a  ii') as in_file:
-000045f0: 0a20 2020 2020 2020 2020 2020 2064 6174  .            dat
-00004600: 615f 726f 7773 203d 2069 6e5f 6669 6c65  a_rows = in_file
-00004610: 2e72 6561 646c 696e 6573 2829 0a0a 2020  .readlines()..  
-00004620: 2020 2020 2020 2320 4578 7472 6163 7420        # Extract 
-00004630: 706f 696e 7420 6461 7461 2074 6f20 6469  point data to di
-00004640: 6374 696f 6e61 7279 2e0a 2020 2020 2020  ctionary..      
-00004650: 2020 706f 696e 7473 203d 207b 7d0a 2020    points = {}.  
-00004660: 2020 2020 2020 666f 7220 726f 7720 696e        for row in
-00004670: 2064 6174 615f 726f 7773 3a0a 2020 2020   data_rows:.    
-00004680: 2020 2020 2020 2020 706f 696e 742c 2069          point, i
-00004690: 6e70 7574 5f69 6e64 6578 2c20 696e 7075  nput_index, inpu
-000046a0: 745f 706f 696e 742c 206f 7574 7075 745f  t_point, output_
-000046b0: 696e 6465 785f 6669 7865 642c 205c 0a20  index_fixed, \. 
-000046c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000046d0: 2020 206f 7574 7075 745f 706f 696e 742c     output_point,
-000046e0: 2064 6566 6f72 6d61 7469 6f6e 203d 2072   deformation = r
-000046f0: 6f77 2e73 706c 6974 2827 3b27 290a 0a20  ow.split(';').. 
-00004700: 2020 2020 2020 2020 2020 2070 6f69 6e74             point
-00004710: 203d 2069 6e74 2870 6f69 6e74 2e73 706c   = int(point.spl
-00004720: 6974 2829 5b2d 315d 290a 2020 2020 2020  it()[-1]).      
-00004730: 2020 2020 2020 706f 696e 7473 5b70 6f69        points[poi
-00004740: 6e74 5d20 3d20 7b7d 0a20 2020 2020 2020  nt] = {}.       
-00004750: 2020 2020 2070 6f69 6e74 735b 706f 696e       points[poin
-00004760: 745d 5b27 496e 7075 7449 6e64 6578 275d  t]['InputIndex']
-00004770: 203d 2067 6574 5f63 6f6f 7264 696e 6174   = get_coordinat
-00004780: 6573 2869 6e70 7574 5f69 6e64 6578 290a  es(input_index).
-00004790: 2020 2020 2020 2020 2020 2020 706f 696e              poin
-000047a0: 7473 5b70 6f69 6e74 5d5b 2749 6e70 7574  ts[point]['Input
-000047b0: 506f 696e 7427 5d20 3d20 6765 745f 636f  Point'] = get_co
-000047c0: 6f72 6469 6e61 7465 7328 696e 7075 745f  ordinates(input_
-000047d0: 706f 696e 7429 0a20 2020 2020 2020 2020  point).         
-000047e0: 2020 2070 6f69 6e74 735b 706f 696e 745d     points[point]
-000047f0: 5b27 4f75 7470 7574 496e 6465 7846 6978  ['OutputIndexFix
-00004800: 6564 275d 203d 2067 6574 5f63 6f6f 7264  ed'] = get_coord
-00004810: 696e 6174 6573 280a 2020 2020 2020 2020  inates(.        
-00004820: 2020 2020 2020 2020 2020 2020 6f75 7470              outp
-00004830: 7574 5f69 6e64 6578 5f66 6978 6564 290a  ut_index_fixed).
-00004840: 2020 2020 2020 2020 2020 2020 706f 696e              poin
-00004850: 7473 5b70 6f69 6e74 5d5b 274f 7574 7075  ts[point]['Outpu
-00004860: 7450 6f69 6e74 275d 203d 2067 6574 5f63  tPoint'] = get_c
-00004870: 6f6f 7264 696e 6174 6573 286f 7574 7075  oordinates(outpu
-00004880: 745f 706f 696e 7429 0a20 2020 2020 2020  t_point).       
-00004890: 2020 2020 2070 6f69 6e74 735b 706f 696e       points[poin
-000048a0: 745d 5b27 4465 666f 726d 6174 696f 6e27  t]['Deformation'
-000048b0: 5d20 3d20 6765 745f 636f 6f72 6469 6e61  ] = get_coordina
-000048c0: 7465 7328 6465 666f 726d 6174 696f 6e29  tes(deformation)
-000048d0: 0a0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
-000048e0: 4966 2074 6865 2054 7261 6e73 666f 726d  If the Transform
-000048f0: 6978 2069 6e70 7574 2077 6173 2077 7269  ix input was wri
-00004900: 7474 656e 2075 7369 6e67 2052 4f49 2e77  tten using ROI.w
-00004910: 7269 7465 2829 2c0a 2020 2020 2020 2020  rite(),.        
-00004920: 2020 2020 2320 6120 706f 696e 7420 7a2d      # a point z-
-00004930: 636f 6f72 6469 6e61 7465 2077 696c 6c20  coordinate will 
-00004940: 6861 7665 2073 6978 2064 6967 6974 7320  have six digits 
-00004950: 6166 7465 7220 7468 6520 6465 6369 6d61  after the decima
-00004960: 6c0a 2020 2020 2020 2020 2020 2020 2320  l.            # 
-00004970: 706f 696e 742c 2077 6974 6820 7468 6520  point, with the 
-00004980: 636f 6e74 6f75 7220 696e 6465 7820 696e  contour index in
-00004990: 2074 6865 206c 6173 7420 7468 7265 652e   the last three.
-000049a0: 0a20 2020 2020 2020 2020 2020 2023 2028  .            # (
-000049b0: 496e 7075 7420 706f 696e 7473 2061 7265  Input points are
-000049c0: 2077 7269 7474 656e 2074 6f20 7468 6520   written to the 
-000049d0: 5472 616e 7366 6f72 6d69 7820 6f75 7470  Transformix outp
-000049e0: 7574 0a20 2020 2020 2020 2020 2020 2023  ut.            #
-000049f0: 2077 6974 6820 7369 7820 6469 6769 7473   with six digits
-00004a00: 2061 6674 6572 2074 6865 2064 6563 696d   after the decim
-00004a10: 616c 2070 6f69 6e74 2066 6f72 2061 6c6c  al point for all
-00004a20: 2063 6f6f 7264 696e 6174 6573 2e29 0a20   coordinates.). 
-00004a30: 2020 2020 2020 2020 2020 207a 645f 696e             zd_in
-00004a40: 203d 2072 652e 6669 6e64 616c 6c28 7227   = re.findall(r'
-00004a50: 5b2d 5c64 5c2e 5d2b 272c 2069 6e70 7574  [-\d\.]+', input
-00004a60: 5f70 6f69 6e74 295b 2d31 5d2e 7273 706c  _point)[-1].rspl
-00004a70: 6974 2822 2e22 2c20 3129 5b2d 315d 0a20  it(".", 1)[-1]. 
-00004a80: 2020 2020 2020 2020 2020 2069 6620 6c65             if le
-00004a90: 6e28 7a64 5f69 6e29 203d 3d20 363a 0a20  n(zd_in) == 6:. 
-00004aa0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-00004ab0: 6f69 6e74 735b 706f 696e 745d 5b22 436f  oints[point]["Co
-00004ac0: 6e74 6f75 7249 6e64 6578 225d 203d 2069  ntourIndex"] = i
-00004ad0: 6e74 287a 645f 696e 5b33 3a5d 290a 2020  nt(zd_in[3:]).  
-00004ae0: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
-00004af0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004b00: 706f 696e 7473 5b70 6f69 6e74 5d5b 2243  points[point]["C
-00004b10: 6f6e 746f 7572 496e 6465 7822 5d20 3d20  ontourIndex"] = 
-00004b20: 300a 0a20 2020 2020 2020 2023 2041 6674  0..        # Aft
-00004b30: 6572 2061 7070 6c69 6361 7469 6f6e 206f  er application o
-00004b40: 6620 6120 7265 6769 7374 7261 7469 6f6e  f a registration
-00004b50: 2074 7261 6e73 666f 726d 2c20 706f 696e   transform, poin
-00004b60: 7473 206f 7269 6769 6e61 6c6c 790a 2020  ts originally.  
-00004b70: 2020 2020 2020 2320 696e 2074 6865 2073        # in the s
-00004b80: 616d 6520 6d61 7920 656e 6420 7570 2077  ame may end up w
-00004b90: 6974 6820 736c 6967 6874 6c79 2064 6966  ith slightly dif
-00004ba0: 6665 7265 6e74 207a 2d63 6f6f 7264 696e  ferent z-coordin
-00004bb0: 6174 6573 2e0a 2020 2020 2020 2020 2320  ates..        # 
-00004bc0: 466f 7220 6d6f 7374 2070 7572 706f 7365  For most purpose
-00004bd0: 7320 2861 6e64 2073 6c69 6365 2074 6869  s (and slice thi
-00004be0: 636b 6e65 7373 6573 2920 6974 2773 2070  cknesses) it's p
-00004bf0: 726f 6261 626c 790a 2020 2020 2020 2020  robably.        
-00004c00: 2320 6120 7265 6173 6f6e 6162 6c65 2061  # a reasonable a
-00004c10: 7070 726f 7869 6d61 7469 6f6e 2074 6f20  pproximation to 
-00004c20: 6d61 7020 616c 6c20 706f 696e 7473 2074  map all points t
-00004c30: 6f20 7468 6520 6d65 616e 0a20 2020 2020  o the mean.     
-00004c40: 2020 2023 207a 2d63 6f6f 7264 696e 6174     # z-coordinat
-00004c50: 6520 6f66 2061 6c6c 2070 6f69 6e74 7320  e of all points 
-00004c60: 6f72 6967 696e 616c 6c79 2069 6e20 7468  originally in th
-00004c70: 6520 7361 6d65 2070 6c61 6e65 2e0a 2020  e same plane..  
-00004c80: 2020 2020 2020 6b65 6570 5f6f 7269 6769        keep_origi
-00004c90: 6e61 6c5f 706c 616e 6573 203d 2067 6574  nal_planes = get
-00004ca0: 6174 7472 2873 656c 662c 2027 6b65 6570  attr(self, 'keep
-00004cb0: 5f6f 7269 6769 6e61 6c5f 706c 616e 6573  _original_planes
-00004cc0: 272c 2054 7275 6529 0a20 2020 2020 2020  ', True).       
-00004cd0: 2069 6620 6b65 6570 5f6f 7269 6769 6e61   if keep_origina
-00004ce0: 6c5f 706c 616e 6573 3a0a 2020 2020 2020  l_planes:.      
-00004cf0: 2020 2020 2020 2320 536f 7274 2070 6f69        # Sort poi
-00004d00: 6e74 7320 6279 2073 6c69 6365 207a 2d63  nts by slice z-c
-00004d10: 6f6f 7264 696e 6174 652c 0a20 2020 2020  oordinate,.     
-00004d20: 2020 2020 2020 2023 206b 6565 7069 6e67         # keeping
-00004d30: 2072 656c 6174 6976 6520 6f72 6465 7220   relative order 
-00004d40: 7769 7468 696e 2061 2073 6c69 6365 2e0a  within a slice..
-00004d50: 2020 2020 2020 2020 2020 2020 736c 6963              slic
-00004d60: 6573 203d 207b 7d0a 2020 2020 2020 2020  es = {}.        
-00004d70: 2020 2020 666f 7220 706f 696e 7420 696e      for point in
-00004d80: 2073 6f72 7465 6428 706f 696e 7473 293a   sorted(points):
-00004d90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00004da0: 2069 2c20 6a2c 206b 203d 2070 6f69 6e74   i, j, k = point
-00004db0: 735b 706f 696e 745d 5b22 496e 7075 7449  s[point]["InputI
-00004dc0: 6e64 6578 225d 0a20 2020 2020 2020 2020  ndex"].         
-00004dd0: 2020 2020 2020 2078 2c20 792c 207a 203d         x, y, z =
-00004de0: 2070 6f69 6e74 735b 706f 696e 745d 5b22   points[point]["
-00004df0: 4f75 7470 7574 506f 696e 7422 5d0a 2020  OutputPoint"].  
-00004e00: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00004e10: 206b 206e 6f74 2069 6e20 736c 6963 6573   k not in slices
-00004e20: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00004e30: 2020 2020 2020 736c 6963 6573 5b6b 5d20        slices[k] 
-00004e40: 3d20 7b27 706f 696e 7473 273a 205b 5d2c  = {'points': [],
-00004e50: 2027 7a5f 706f 696e 7473 273a 205b 5d7d   'z_points': []}
-00004e60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00004e70: 2073 6c69 6365 735b 6b5d 5b22 706f 696e   slices[k]["poin
-00004e80: 7473 225d 2e61 7070 656e 6428 706f 696e  ts"].append(poin
-00004e90: 7429 0a20 2020 2020 2020 2020 2020 2020  t).             
-00004ea0: 2020 2073 6c69 6365 735b 6b5d 5b22 7a5f     slices[k]["z_
-00004eb0: 706f 696e 7473 225d 2e61 7070 656e 6428  points"].append(
-00004ec0: 7a29 0a0a 2020 2020 2020 2020 2020 2020  z)..            
-00004ed0: 2320 466f 7220 706f 696e 7473 2069 6e20  # For points in 
-00004ee0: 6561 6368 2073 6c69 6365 2c20 7265 7365  each slice, rese
-00004ef0: 7420 7a2d 636f 6f72 6469 6e61 7465 7320  t z-coordinates 
-00004f00: 746f 206d 6561 6e20 7661 6c75 652e 0a20  to mean value.. 
-00004f10: 2020 2020 2020 2020 2020 2066 6f72 206b             for k
-00004f20: 2069 6e20 736f 7274 6564 2873 6c69 6365   in sorted(slice
-00004f30: 7329 3a0a 2020 2020 2020 2020 2020 2020  s):.            
-00004f40: 2020 2020 7a5f 6d65 616e 203d 206e 702e      z_mean = np.
-00004f50: 6d65 616e 2873 6c69 6365 735b 6b5d 5b22  mean(slices[k]["
-00004f60: 7a5f 706f 696e 7473 225d 290a 2020 2020  z_points"]).    
-00004f70: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-00004f80: 706f 696e 7420 696e 2073 6c69 6365 735b  point in slices[
-00004f90: 6b5d 5b22 706f 696e 7473 225d 3a0a 2020  k]["points"]:.  
-00004fa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004fb0: 2020 782c 2079 2c20 7a20 3d20 706f 696e    x, y, z = poin
-00004fc0: 7473 5b70 6f69 6e74 5d5b 224f 7574 7075  ts[point]["Outpu
-00004fd0: 7450 6f69 6e74 225d 0a20 2020 2020 2020  tPoint"].       
-00004fe0: 2020 2020 2020 2020 2020 2020 2070 6f69               poi
-00004ff0: 6e74 735b 706f 696e 745d 5b22 4f75 7470  nts[point]["Outp
-00005000: 7574 506f 696e 7422 5d20 3d20 2878 2c20  utPoint"] = (x, 
-00005010: 792c 207a 5f6d 6561 6e29 0a0a 2020 2020  y, z_mean)..    
-00005020: 2020 2020 7265 7475 726e 2070 6f69 6e74      return point
-00005030: 730a 0a20 2020 2064 6566 2063 6c6f 6e65  s..    def clone
-00005040: 5f61 7474 7273 2873 656c 662c 206f 626a  _attrs(self, obj
-00005050: 2c20 636f 7079 5f64 6174 613d 5472 7565  , copy_data=True
-00005060: 293a 0a20 2020 2020 2020 2022 2222 4173  ):.        """As
-00005070: 7369 676e 2061 6c6c 2061 7474 7269 6275  sign all attribu
-00005080: 7465 7320 6f66 203c 7365 6c66 3e20 746f  tes of <self> to
-00005090: 2061 6e6f 7468 6572 206f 626a 6563 742c   another object,
-000050a0: 203c 6f62 6a3e 2c20 2065 6e73 7572 696e   <obj>,  ensurin
-000050b0: 6720 0a20 2020 2020 2020 2074 6861 7420  g .        that 
-000050c0: 6f77 6e20 6d61 736b 2773 2064 6174 6120  own mask's data 
-000050d0: 6765 7473 2063 6f72 7265 6374 6c79 2063  gets correctly c
-000050e0: 6f70 6965 6420 6966 203c 636f 7079 5f64  opied if <copy_d
-000050f0: 6174 613e 2069 7320 5472 7565 2e22 2222  ata> is True."""
-00005100: 0a0a 2020 2020 2020 2020 736b 7274 2e63  ..        skrt.c
-00005110: 6f72 652e 4461 7461 2e63 6c6f 6e65 5f61  ore.Data.clone_a
-00005120: 7474 7273 2873 656c 662c 206f 626a 2c20  ttrs(self, obj, 
-00005130: 636f 7079 5f64 6174 613d 636f 7079 5f64  copy_data=copy_d
-00005140: 6174 6129 0a20 2020 2020 2020 2069 6620  ata).        if 
-00005150: 636f 7079 5f64 6174 6120 616e 6420 7365  copy_data and se
-00005160: 6c66 2e6d 6173 6b20 6973 206e 6f74 204e  lf.mask is not N
-00005170: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-00005180: 206f 626a 2e6d 6173 6b20 3d20 7365 6c66   obj.mask = self
-00005190: 2e6d 6173 6b2e 636c 6f6e 6528 636f 7079  .mask.clone(copy
-000051a0: 5f64 6174 613d 5472 7565 290a 0a20 2020  _data=True)..   
-000051b0: 2064 6566 2067 6574 5f64 6963 6f6d 5f64   def get_dicom_d
-000051c0: 6174 6173 6574 2873 656c 6629 3a0a 2020  ataset(self):.  
-000051d0: 2020 2020 2020 2222 2252 6574 7572 6e20        """Return 
-000051e0: 7079 6469 636f 6d2e 6461 7461 7365 742e  pydicom.dataset.
-000051f0: 4669 6c65 4461 7461 7365 7420 6f62 6a65  FileDataset obje
-00005200: 6374 2061 7373 6f63 6961 7465 6420 7769  ct associated wi
-00005210: 7468 2074 6869 7320 524f 490a 2020 2020  th this ROI.    
-00005220: 2020 2020 6966 206c 6f61 6465 6420 6672      if loaded fr
-00005230: 6f6d 2064 6963 6f6d 3b20 6f74 6865 7277  om dicom; otherw
-00005240: 6973 652c 2072 6574 7572 6e20 4e6f 6e65  ise, return None
-00005250: 2e22 2222 0a0a 2020 2020 2020 2020 7365  ."""..        se
-00005260: 6c66 2e6c 6f61 6428 290a 2020 2020 2020  lf.load().      
-00005270: 2020 7265 7475 726e 2073 656c 662e 6469    return self.di
-00005280: 636f 6d5f 6461 7461 7365 740a 0a20 2020  com_dataset..   
-00005290: 2064 6566 2072 6573 6574 5f63 6f6e 746f   def reset_conto
-000052a0: 7572 7328 7365 6c66 2c20 636f 6e74 6f75  urs(self, contou
-000052b0: 7273 3d4e 6f6e 652c 206d 6f73 745f 706f  rs=None, most_po
-000052c0: 696e 7473 3d46 616c 7365 293a 0a20 2020  ints=False):.   
-000052d0: 2020 2020 2022 2222 5265 7365 7420 782d       """Reset x-
-000052e0: 7920 636f 6e74 6f75 7273 2074 6f20 6120  y contours to a 
-000052f0: 6769 7665 6e20 6469 6374 206f 6620 736c  given dict of sl
-00005300: 6963 6573 2061 6e64 2063 6f6e 746f 7572  ices and contour
-00005310: 206c 6973 7473 2c20 0a20 2020 2020 2020   lists, .       
-00005320: 2061 6e64 2065 6e73 7572 6520 7468 6174   and ensure that
-00005330: 206d 6173 6b20 616e 6420 792d 7a2f 782d   mask and y-z/x-
-00005340: 7a20 636f 6e74 6f75 7273 2077 696c 6c20  z contours will 
-00005350: 6265 2072 6563 7265 6174 6564 2e20 4966  be recreated. If
-00005360: 200a 2020 2020 2020 2020 636f 6e74 6f75   .        contou
-00005370: 7273 2069 7320 4e6f 6e65 2c20 636f 6e74  rs is None, cont
-00005380: 6f75 7273 2077 696c 6c20 6265 2072 6573  ours will be res
-00005390: 6574 2075 7369 6e67 206f 776e 2078 2d79  et using own x-y
-000053a0: 2063 6f6e 746f 7572 732e 0a20 2020 2020   contours..     
-000053b0: 2020 2049 6620 6d6f 7374 5f70 6f69 6e74     If most_point
-000053c0: 7320 6973 2054 7275 652c 206f 6e6c 7920  s is True, only 
-000053d0: 7468 6520 636f 6e74 6f75 7220 7769 7468  the contour with
-000053e0: 206d 6f73 7420 706f 696e 7473 2066 6f72   most points for
-000053f0: 0a20 2020 2020 2020 2065 6163 6820 736c  .        each sl
-00005400: 6963 6520 6973 2063 6f6e 7369 6465 7265  ice is considere
-00005410: 642e 2222 220a 0a20 2020 2020 2020 2023  d."""..        #
-00005420: 2043 6865 636b 2066 6f72 6d61 7420 6973   Check format is
-00005430: 2063 6f72 7265 6374 0a20 2020 2020 2020   correct.       
-00005440: 2069 6620 636f 6e74 6f75 7273 2069 7320   if contours is 
-00005450: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-00005460: 2020 636f 6e74 6f75 7273 203d 2073 656c    contours = sel
-00005470: 662e 6765 745f 636f 6e74 6f75 7273 2829  f.get_contours()
-00005480: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
-00005490: 6973 696e 7374 616e 6365 2863 6f6e 746f  isinstance(conto
-000054a0: 7572 732c 2064 6963 7429 3a0a 2020 2020  urs, dict):.    
-000054b0: 2020 2020 2020 2020 7261 6973 6520 5479          raise Ty
-000054c0: 7065 4572 726f 7228 2263 6f6e 746f 7572  peError("contour
-000054d0: 7320 7368 6f75 6c64 2062 6520 6120 6469  s should be a di
-000054e0: 6374 2229 0a20 2020 2020 2020 2066 6f72  ct").        for
-000054f0: 207a 2c20 6320 696e 2063 6f6e 746f 7572   z, c in contour
-00005500: 732e 6974 656d 7328 293a 0a20 2020 2020  s.items():.     
-00005510: 2020 2020 2020 2069 6620 6e6f 7420 6973         if not is
-00005520: 696e 7374 616e 6365 2863 2c20 6c69 7374  instance(c, list
-00005530: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-00005540: 2020 2072 6169 7365 2054 7970 6545 7272     raise TypeErr
-00005550: 6f72 2866 2263 6f6e 746f 7572 735b 7b7a  or(f"contours[{z
-00005560: 7d5d 2073 686f 756c 6420 6265 2061 206c  }] should be a l
-00005570: 6973 7420 6f66 2063 6f6e 746f 7572 7320  ist of contours 
-00005580: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-00005590: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000055a0: 2020 6622 6f6e 2073 6c69 6365 207b 7a7d    f"on slice {z}
-000055b0: 2229 0a0a 2020 2020 2020 2020 2320 466f  ")..        # Fo
-000055c0: 7220 6561 6368 2073 6c69 6365 2c20 6b65  r each slice, ke
-000055d0: 6570 206f 6e6c 7920 636f 6e74 6f75 7220  ep only contour 
-000055e0: 7769 7468 206d 6f73 7420 706f 696e 7473  with most points
-000055f0: 2e0a 2020 2020 2020 2020 6966 206d 6f73  ..        if mos
-00005600: 745f 706f 696e 7473 3a0a 2020 2020 2020  t_points:.      
-00005610: 2020 2020 2020 636f 6e74 6f75 7273 203d        contours =
-00005620: 207b 6b65 793a 205b 6d61 7828 7661 6c75   {key: [max(valu
-00005630: 652c 206b 6579 3d6c 656e 295d 0a20 2020  e, key=len)].   
-00005640: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005650: 2066 6f72 206b 6579 2c20 7661 6c75 6520   for key, value 
-00005660: 696e 2063 6f6e 746f 7572 732e 6974 656d  in contours.item
-00005670: 7328 297d 0a0a 2020 2020 2020 2020 7365  s()}..        se
-00005680: 6c66 2e69 6e70 7574 5f63 6f6e 746f 7572  lf.input_contour
-00005690: 7320 3d20 636f 6e74 6f75 7273 0a20 2020  s = contours.   
-000056a0: 2020 2020 2073 656c 662e 656d 7074 7920       self.empty 
-000056b0: 3d20 6e6f 7420 6c65 6e28 7365 6c66 2e69  = not len(self.i
-000056c0: 6e70 7574 5f63 6f6e 746f 7572 7329 0a20  nput_contours). 
-000056d0: 2020 2020 2020 2073 656c 662e 636f 6e74         self.cont
-000056e0: 6f75 7273 203d 207b 2278 2d79 223a 2063  ours = {"x-y": c
-000056f0: 6f6e 746f 7572 737d 0a20 2020 2020 2020  ontours}.       
-00005700: 2073 656c 662e 6c6f 6164 6564 5f6d 6173   self.loaded_mas
-00005710: 6b20 3d20 4661 6c73 650a 2020 2020 2020  k = False.      
-00005720: 2020 7365 6c66 2e6d 6173 6b20 3d20 4e6f    self.mask = No
-00005730: 6e65 0a0a 2020 2020 6465 6620 7265 7365  ne..    def rese
-00005740: 745f 6d61 736b 2873 656c 662c 206d 6173  t_mask(self, mas
-00005750: 6b3d 4e6f 6e65 293a 0a20 2020 2020 2020  k=None):.       
-00005760: 2022 2222 5365 7420 6d61 736b 2074 6f20   """Set mask to 
-00005770: 6569 7468 6572 2061 206e 756d 7079 2061  either a numpy a
-00005780: 7272 6179 206f 7220 616e 2049 6d61 6765  rray or an Image
-00005790: 206f 626a 6563 742c 2061 6e64 2065 6e73   object, and ens
-000057a0: 7572 6520 0a20 2020 2020 2020 2074 6861  ure .        tha
-000057b0: 7420 636f 6e74 6f75 7273 2077 696c 6c20  t contours will 
-000057c0: 6265 2072 6563 7265 6174 6564 2e20 4966  be recreated. If
-000057d0: 206d 6173 6b20 6973 204e 6f6e 652c 2063   mask is None, c
-000057e0: 6f6e 746f 7572 7320 7769 6c6c 2062 6520  ontours will be 
-000057f0: 0a20 2020 2020 2020 2072 6573 6574 2075  .        reset u
-00005800: 7369 6e67 206f 776e 206d 6173 6b2e 2222  sing own mask.""
-00005810: 220a 0a20 2020 2020 2020 2069 6620 6973  "..        if is
-00005820: 696e 7374 616e 6365 286d 6173 6b2c 2073  instance(mask, s
-00005830: 6b72 742e 696d 6167 652e 496d 6167 6529  krt.image.Image)
-00005840: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
-00005850: 6c66 2e6d 6173 6b20 3d20 6d61 736b 0a20  lf.mask = mask. 
-00005860: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00005870: 6166 6669 6e65 203d 206d 6173 6b2e 6765  affine = mask.ge
-00005880: 745f 6166 6669 6e65 2829 0a20 2020 2020  t_affine().     
-00005890: 2020 2020 2020 2073 656c 662e 766f 7865         self.voxe
-000058a0: 6c5f 7369 7a65 203d 206d 6173 6b2e 6765  l_size = mask.ge
-000058b0: 745f 766f 7865 6c5f 7369 7a65 2829 0a20  t_voxel_size(). 
-000058c0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-000058d0: 6f72 6967 696e 203d 206d 6173 6b2e 6765  origin = mask.ge
-000058e0: 745f 6f72 6967 696e 2829 0a20 2020 2020  t_origin().     
-000058f0: 2020 2020 2020 2073 656c 662e 7368 6170         self.shap
-00005900: 6520 3d20 6d61 736b 2e67 6574 5f64 6174  e = mask.get_dat
-00005910: 6128 292e 7368 6170 650a 0a20 2020 2020  a().shape..     
-00005920: 2020 2065 6c69 6620 6973 696e 7374 616e     elif isinstan
-00005930: 6365 286d 6173 6b2c 206e 702e 6e64 6172  ce(mask, np.ndar
-00005940: 7261 7929 3a0a 2020 2020 2020 2020 2020  ray):.          
-00005950: 2020 7365 6c66 2e6d 6173 6b20 3d20 736b    self.mask = sk
-00005960: 7274 2e69 6d61 6765 2e49 6d61 6765 280a  rt.image.Image(.
-00005970: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005980: 6d61 736b 2c0a 2020 2020 2020 2020 2020  mask,.          
-00005990: 2020 2020 2020 6166 6669 6e65 203d 2073        affine = s
-000059a0: 656c 662e 6166 6669 6e65 2c0a 2020 2020  elf.affine,.    
-000059b0: 2020 2020 2020 2020 2020 2020 766f 7865              voxe
-000059c0: 6c5f 7369 7a65 3d73 656c 662e 766f 7865  l_size=self.voxe
-000059d0: 6c5f 7369 7a65 2c0a 2020 2020 2020 2020  l_size,.        
-000059e0: 2020 2020 2020 2020 6f72 6967 696e 3d73          origin=s
-000059f0: 656c 662e 6f72 6967 696e 0a20 2020 2020  elf.origin.     
-00005a00: 2020 2020 2020 2029 0a0a 2020 2020 2020         )..      
-00005a10: 2020 656c 6966 206d 6173 6b20 6973 206e    elif mask is n
-00005a20: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
-00005a30: 2020 2020 2072 6169 7365 2054 7970 6545       raise TypeE
-00005a40: 7272 6f72 2822 6d61 736b 2073 686f 756c  rror("mask shoul
-00005a50: 6420 6265 2061 6e20 496d 6167 6520 6f72  d be an Image or
-00005a60: 2061 206e 756d 7079 2061 7272 6179 2229   a numpy array")
-00005a70: 0a0a 2020 2020 2020 2020 7365 6c66 2e6d  ..        self.m
-00005a80: 6173 6b2e 6765 745f 7374 616e 6461 7264  ask.get_standard
-00005a90: 6973 6564 5f64 6174 6128 666f 7263 653d  ised_data(force=
-00005aa0: 5472 7565 290a 2020 2020 2020 2020 7365  True).        se
-00005ab0: 6c66 2e6c 6f61 6465 645f 6d61 736b 203d  lf.loaded_mask =
-00005ac0: 2054 7275 650a 2020 2020 2020 2020 7365   True.        se
-00005ad0: 6c66 2e63 6f6e 746f 7572 7320 3d20 7b7d  lf.contours = {}
-00005ae0: 0a20 2020 2020 2020 2073 656c 662e 656d  .        self.em
-00005af0: 7074 7920 3d20 6e6f 7420 6e70 2e61 6e79  pty = not np.any
-00005b00: 2873 656c 662e 6d61 736b 2e67 6574 5f64  (self.mask.get_d
-00005b10: 6174 6128 2929 0a20 2020 2020 2020 2073  ata()).        s
-00005b20: 656c 662e 696e 7075 745f 636f 6e74 6f75  elf.input_contou
-00005b30: 7273 203d 204e 6f6e 650a 0a20 2020 2064  rs = None..    d
-00005b40: 6566 2067 6574 5f63 6f6e 746f 7572 7328  ef get_contours(
-00005b50: 7365 6c66 2c20 7669 6577 3d22 782d 7922  self, view="x-y"
-00005b60: 2c20 6964 785f 6173 5f6b 6579 3d46 616c  , idx_as_key=Fal
-00005b70: 7365 2c20 6d6f 7374 5f70 6f69 6e74 733d  se, most_points=
-00005b80: 4661 6c73 6529 3a0a 2020 2020 2020 2020  False):.        
-00005b90: 2222 220a 2020 2020 2020 2020 4765 7420  """.        Get 
-00005ba0: 6469 6374 206f 6620 636f 6e74 6f75 7273  dict of contours
-00005bb0: 2069 6e20 6120 6769 7665 6e20 6f72 6965   in a given orie
-00005bc0: 6e74 6174 696f 6e2e 0a0a 2020 2020 2020  ntation...      
-00005bd0: 2020 2a2a 5061 7261 6d65 7465 7273 3a2a    **Parameters:*
-00005be0: 2a0a 0a20 2020 2020 2020 2076 6965 7720  *..        view 
-00005bf0: 3a20 7374 722c 2064 6566 6175 6c74 3d22  : str, default="
-00005c00: 782d 7922 0a20 2020 2020 2020 2020 2020  x-y".           
-00005c10: 2056 6965 7720 696e 2077 6869 6368 2074   View in which t
-00005c20: 6f20 6f62 7461 696e 2063 6f6e 746f 7572  o obtain contour
-00005c30: 732e 0a0a 2020 2020 2020 2020 6964 785f  s...        idx_
-00005c40: 6173 5f6b 6579 203a 2062 6f6f 6c2c 2064  as_key : bool, d
-00005c50: 6566 6175 6c74 3d46 616c 7365 0a20 2020  efault=False.   
-00005c60: 2020 2020 2020 2020 2049 6620 5472 7565           If True
-00005c70: 2c20 7573 6520 736c 6963 6520 696e 6469  , use slice indi
-00005c80: 6365 7320 6173 2064 6963 7469 6f6e 6172  ces as dictionar
-00005c90: 7920 6b65 7973 3b20 6966 2046 616c 7365  y keys; if False
-00005ca0: 2c0a 2020 2020 2020 2020 2020 2020 7573  ,.            us
-00005cb0: 6520 736c 6963 6520 7a2d 636f 6f72 6469  e slice z-coordi
-00005cc0: 6e61 7465 7320 6173 2064 6963 7469 6f6e  nates as diction
-00005cd0: 6172 7920 6b65 7973 2e0a 0a20 2020 2020  ary keys...     
-00005ce0: 2020 206d 6f73 745f 706f 696e 7473 203a     most_points :
-00005cf0: 2062 6f6f 6c2c 2064 6566 6175 6c74 3d46   bool, default=F
-00005d00: 616c 7365 0a20 2020 2020 2020 2020 2020  alse.           
-00005d10: 2049 6620 5472 7565 2c20 7265 7475 726e   If True, return
-00005d20: 206f 6e6c 7920 7468 6520 636f 6e74 6f75   only the contou
-00005d30: 7220 7769 7468 206d 6f73 7420 706f 696e  r with most poin
-00005d40: 7473 2066 6f72 2065 6163 6820 736c 6963  ts for each slic
-00005d50: 653b 0a20 2020 2020 2020 2020 2020 2069  e;.            i
-00005d60: 6620 4661 6c73 652c 2072 6574 7572 6e20  f False, return 
-00005d70: 616c 6c20 636f 6e74 6f75 7273 2066 6f72  all contours for
-00005d80: 2065 6163 6820 736c 6963 652e 0a20 2020   each slice..   
-00005d90: 2020 2020 2022 2222 0a0a 2020 2020 2020       """..      
-00005da0: 2020 7365 6c66 2e6c 6f61 6428 290a 2020    self.load().  
-00005db0: 2020 2020 2020 6966 2076 6965 7720 6e6f        if view no
-00005dc0: 7420 696e 2073 656c 662e 636f 6e74 6f75  t in self.contou
-00005dd0: 7273 3a0a 2020 2020 2020 2020 2020 2020  rs:.            
-00005de0: 7365 6c66 2e63 7265 6174 655f 636f 6e74  self.create_cont
-00005df0: 6f75 7273 2876 6965 7729 0a20 2020 2020  ours(view).     
-00005e00: 2020 2063 6f6e 746f 7572 7320 3d20 7365     contours = se
-00005e10: 6c66 2e63 6f6e 746f 7572 735b 7669 6577  lf.contours[view
-00005e20: 5d0a 0a20 2020 2020 2020 2023 2043 6f6e  ]..        # Con
-00005e30: 7665 7274 206b 6579 7320 746f 2069 6e64  vert keys to ind
-00005e40: 6963 6573 2072 6174 6865 7220 7468 616e  ices rather than
-00005e50: 2070 6f73 6974 696f 6e73 0a20 2020 2020   positions.     
-00005e60: 2020 2069 6620 6964 785f 6173 5f6b 6579     if idx_as_key
-00005e70: 3a0a 2020 2020 2020 2020 2020 2020 636f  :.            co
-00005e80: 6e74 6f75 7273 203d 207b 7365 6c66 2e70  ntours = {self.p
-00005e90: 6f73 5f74 6f5f 6964 7828 6b65 792c 2073  os_to_idx(key, s
-00005ea0: 6b72 742e 696d 6167 652e 5f73 6c69 6365  krt.image._slice
-00005eb0: 5f61 7865 735b 7669 6577 5d29 3a20 0a20  _axes[view]): . 
-00005ec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005ed0: 2020 2020 2020 2076 616c 7565 2066 6f72         value for
-00005ee0: 206b 6579 2c20 7661 6c75 6520 696e 2063   key, value in c
-00005ef0: 6f6e 746f 7572 732e 6974 656d 7328 297d  ontours.items()}
-00005f00: 0a0a 2020 2020 2020 2020 2320 466f 7220  ..        # For 
-00005f10: 6561 6368 2073 6c69 6365 2c20 6b65 6570  each slice, keep
-00005f20: 206f 6e6c 7920 636f 6e74 6f75 7220 7769   only contour wi
-00005f30: 7468 206d 6f73 7420 706f 696e 7473 2e0a  th most points..
-00005f40: 2020 2020 2020 2020 6966 206d 6f73 745f          if most_
-00005f50: 706f 696e 7473 3a0a 2020 2020 2020 2020  points:.        
-00005f60: 2020 2020 636f 6e74 6f75 7273 203d 207b      contours = {
-00005f70: 6b65 793a 205b 6d61 7828 7661 6c75 652c  key: [max(value,
-00005f80: 206b 6579 3d6c 656e 295d 0a20 2020 2020   key=len)].     
-00005f90: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-00005fa0: 6f72 206b 6579 2c20 7661 6c75 6520 696e  or key, value in
-00005fb0: 2063 6f6e 746f 7572 732e 6974 656d 7328   contours.items(
-00005fc0: 297d 0a0a 2020 2020 2020 2020 7265 7475  )}..        retu
-00005fd0: 726e 2063 6f6e 746f 7572 730a 0a20 2020  rn contours..   
-00005fe0: 2064 6566 2067 6574 5f63 6f6e 746f 7572   def get_contour
-00005ff0: 735f 6f6e 5f73 6c69 6365 2873 656c 662c  s_on_slice(self,
-00006000: 2076 6965 773d 2278 2d79 222c 2073 6c3d   view="x-y", sl=
-00006010: 4e6f 6e65 2c20 6964 783d 4e6f 6e65 2c20  None, idx=None, 
-00006020: 706f 733d 4e6f 6e65 293a 0a0a 2020 2020  pos=None):..    
-00006030: 2020 2020 7365 6c66 2e6c 6f61 6428 290a      self.load().
-00006040: 2020 2020 2020 2020 6966 2073 6c20 6973          if sl is
-00006050: 204e 6f6e 6520 616e 6420 6964 7820 6973   None and idx is
-00006060: 204e 6f6e 6520 616e 6420 706f 7320 6973   None and pos is
-00006070: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-00006080: 2020 2069 6478 203d 2073 656c 662e 6765     idx = self.ge
-00006090: 745f 6d69 645f 6964 7828 7669 6577 290a  t_mid_idx(view).
-000060a0: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-000060b0: 2020 2020 2020 2020 2020 6964 7820 3d20            idx = 
-000060c0: 7365 6c66 2e67 6574 5f69 6478 2876 6965  self.get_idx(vie
-000060d0: 772c 2073 6c2c 2069 6478 2c20 706f 7329  w, sl, idx, pos)
-000060e0: 0a20 2020 2020 2020 2074 7279 3a0a 2020  .        try:.  
-000060f0: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00006100: 2073 656c 662e 6765 745f 636f 6e74 6f75   self.get_contou
-00006110: 7273 2876 6965 772c 2069 6478 5f61 735f  rs(view, idx_as_
-00006120: 6b65 793d 5472 7565 295b 6964 785d 0a20  key=True)[idx]. 
-00006130: 2020 2020 2020 2065 7863 6570 7420 4b65         except Ke
-00006140: 7945 7272 6f72 3a0a 2020 2020 2020 2020  yError:.        
-00006150: 2020 2020 7265 7475 726e 205b 5d0a 0a20      return [].. 
-00006160: 2020 2064 6566 2067 6574 5f73 6c69 6365     def get_slice
-00006170: 5f70 6f73 6974 696f 6e73 2873 656c 662c  _positions(self,
-00006180: 206f 7468 6572 3d4e 6f6e 652c 2076 6965   other=None, vie
-00006190: 773d 2278 2d79 222c 2070 6f73 6974 696f  w="x-y", positio
-000061a0: 6e5f 6173 5f69 6478 3d46 616c 7365 2c0a  n_as_idx=False,.
-000061b0: 2020 2020 2020 2020 2020 2020 6d65 7468              meth
-000061c0: 6f64 3d22 756e 696f 6e22 293a 0a20 2020  od="union"):.   
-000061d0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-000061e0: 2047 6574 206f 7264 6572 6564 206c 6973   Get ordered lis
-000061f0: 7420 6f66 2073 6c69 6365 2070 6f73 6974  t of slice posit
-00006200: 696f 6e73 2066 6f72 2073 656c 6620 616e  ions for self an
-00006210: 6420 6f74 6865 722e 0a0a 2020 2020 2020  d other...      
-00006220: 2020 2a2a 5061 7261 6d65 7465 7273 3a2a    **Parameters:*
-00006230: 2a0a 0a20 2020 2020 2020 206f 7468 6572  *..        other
-00006240: 203a 2073 6b72 742e 7374 7275 6374 7572   : skrt.structur
-00006250: 6573 2e52 4f49 2c20 6465 6661 756c 743d  es.ROI, default=
-00006260: 4e6f 6e65 0a20 2020 2020 2020 2020 2020  None.           
-00006270: 2053 6563 6f6e 6420 524f 4920 6f66 2061   Second ROI of a
-00006280: 2070 6169 7220 666f 7220 7768 6963 6820   pair for which 
-00006290: 736c 6963 6520 706f 7369 7469 6f6e 7320  slice positions 
-000062a0: 6172 6520 6265 206f 6274 6169 6e65 642e  are be obtained.
-000062b0: 0a20 2020 2020 2020 2020 2020 2044 6973  .            Dis
-000062c0: 7265 6761 7264 6564 2069 6620 4e6f 6e65  regarded if None
-000062d0: 2e0a 0a20 2020 2020 2020 2076 6965 7720  ...        view 
-000062e0: 3a20 7374 722c 2064 6566 6175 6c74 3d22  : str, default="
-000062f0: 782d 7922 0a20 2020 2020 2020 2020 2020  x-y".           
-00006300: 2056 6965 7720 696e 2077 6869 6368 2074   View in which t
-00006310: 6f20 6f62 7461 696e 2073 6c69 6365 732e  o obtain slices.
-00006320: 0a0a 2020 2020 2020 2020 706f 7369 7469  ..        positi
-00006330: 6f6e 5f61 735f 6964 7820 3a20 626f 6f6c  on_as_idx : bool
-00006340: 2c20 6465 6661 756c 743d 4661 6c73 650a  , default=False.
-00006350: 2020 2020 2020 2020 2020 2020 4966 2054              If T
-00006360: 7275 652c 2072 6574 7572 6e20 706f 7369  rue, return posi
-00006370: 7469 6f6e 7320 6173 2073 6c69 6365 2069  tions as slice i
-00006380: 6e64 6963 6573 3b20 6966 2046 616c 7365  ndices; if False
-00006390: 2c0a 2020 2020 2020 2020 2020 2020 7265  ,.            re
-000063a0: 7475 726e 2070 6f73 6974 696f 6e73 2061  turn positions a
-000063b0: 7320 736c 6963 6520 7a2d 636f 6f72 6469  s slice z-coordi
-000063c0: 6e61 7465 7320 286d 6d29 2e0a 0a20 2020  nates (mm)...   
-000063d0: 2020 2020 206d 6574 686f 643a 2073 7472       method: str
-000063e0: 2c20 6465 6661 756c 743d 2275 6e69 6f6e  , default="union
-000063f0: 220a 2020 2020 2020 2020 2020 2020 5374  ".            St
-00006400: 7269 6e67 2073 7065 6369 6679 696e 6720  ring specifying 
-00006410: 736c 6963 6573 2066 6f72 2077 6869 6368  slices for which
-00006420: 2070 6f73 6974 696f 6e73 2061 7265 2074   positions are t
-00006430: 6f20 6265 206f 6274 6169 6e65 642c 0a20  o be obtained,. 
-00006440: 2020 2020 2020 2020 2020 2066 6f72 2052             for R
-00006450: 4f49 7320 7365 6c66 2061 6e64 206f 7468  OIs self and oth
-00006460: 6572 2e0a 0a20 2020 2020 2020 2020 2020  er...           
-00006470: 202d 2022 6c65 6674 2220 286f 7220 6f74   - "left" (or ot
-00006480: 6865 7220 6973 204e 6f6e 6529 3a20 7265  her is None): re
-00006490: 7475 726e 2070 6f73 6974 696f 6e73 206f  turn positions o
-000064a0: 660a 2020 2020 2020 2020 2020 2020 2020  f.              
-000064b0: 736c 6963 6573 2063 6f6e 7461 696e 696e  slices containin
-000064c0: 6720 7365 6c66 3b0a 2020 2020 2020 2020  g self;.        
-000064d0: 2020 2020 2d20 2272 6967 6874 223a 2072      - "right": r
-000064e0: 6574 7572 6e20 706f 7369 7469 6f6e 7320  eturn positions 
-000064f0: 6f66 2073 6c69 6365 7320 636f 6e74 6169  of slices contai
-00006500: 6e69 6e67 206f 7468 6572 3b0a 2020 2020  ning other;.    
-00006510: 2020 2020 2020 2020 2d20 2275 6e69 6f6e          - "union
-00006520: 223a 2072 6574 7572 6e20 706f 7369 7469  ": return positi
-00006530: 6f6e 7320 6f66 2073 6c69 6365 7320 636f  ons of slices co
-00006540: 6e74 6169 6e69 6e67 2065 6974 6865 7220  ntaining either 
-00006550: 7365 6c66 0a20 2020 2020 2020 2020 2020  self.           
-00006560: 2020 206f 7220 6f74 6865 723b 0a20 2020     or other;.   
-00006570: 2020 2020 2020 2020 202d 2022 696e 7465           - "inte
-00006580: 7273 6563 7469 6f6e 223a 2072 6574 7572  rsection": retur
-00006590: 6e20 706f 7369 7469 6f6e 7320 6f66 2073  n positions of s
-000065a0: 6c69 6365 7320 636f 6e74 6169 6e69 6e67  lices containing
-000065b0: 2062 6f74 680a 2020 2020 2020 2020 2020   both.          
-000065c0: 2020 2020 7365 6c66 2061 6e64 206f 7468      self and oth
-000065d0: 6572 2e0a 2020 2020 2020 2020 2222 220a  er..        """.
-000065e0: 2020 2020 2020 2020 7265 7475 726e 2067          return g
-000065f0: 6574 5f73 6c69 6365 5f70 6f73 6974 696f  et_slice_positio
-00006600: 6e73 2873 656c 662c 206f 7468 6572 2c20  ns(self, other, 
-00006610: 7669 6577 2c20 706f 7369 7469 6f6e 5f61  view, position_a
-00006620: 735f 6964 782c 0a20 2020 2020 2020 2020  s_idx,.         
-00006630: 2020 2020 2020 206d 6574 686f 6429 0a0a         method)..
-00006640: 2020 2020 6465 6620 6765 745f 6166 6669      def get_affi
-00006650: 6e65 2873 656c 662c 2066 6f72 6365 5f73  ne(self, force_s
-00006660: 7461 6e64 6172 6469 7365 3d46 616c 7365  tandardise=False
-00006670: 2c20 2a2a 6b77 6172 6773 293a 0a20 2020  , **kwargs):.   
-00006680: 2020 2020 2022 2222 4c6f 6164 2073 656c       """Load sel
-00006690: 6620 616e 6420 6765 7420 6166 6669 6e65  f and get affine
-000066a0: 206d 6174 7269 782e 2222 220a 0a20 2020   matrix."""..   
-000066b0: 2020 2020 2073 656c 662e 6c6f 6164 2829       self.load()
-000066c0: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
-000066d0: 2e6c 6f61 6465 645f 6d61 736b 3a0a 2020  .loaded_mask:.  
-000066e0: 2020 2020 2020 2020 2020 7265 7475 726e            return
-000066f0: 2073 656c 662e 6d61 736b 2e67 6574 5f61   self.mask.get_a
-00006700: 6666 696e 6528 666f 7263 655f 7374 616e  ffine(force_stan
-00006710: 6461 7264 6973 653d 666f 7263 655f 7374  dardise=force_st
-00006720: 616e 6461 7264 6973 652c 200a 2020 2020  andardise, .    
-00006730: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006740: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006750: 2020 2020 2a2a 6b77 6172 6773 290a 2020      **kwargs).  
-00006760: 2020 2020 2020 656c 6966 2073 656c 662e        elif self.
-00006770: 696d 6167 6520 6973 206e 6f74 204e 6f6e  image is not Non
-00006780: 653a 0a20 2020 2020 2020 2020 2020 2072  e:.            r
-00006790: 6574 7572 6e20 7365 6c66 2e69 6d61 6765  eturn self.image
-000067a0: 2e67 6574 5f61 6666 696e 6528 666f 7263  .get_affine(forc
-000067b0: 655f 7374 616e 6461 7264 6973 653d 666f  e_standardise=fo
-000067c0: 7263 655f 7374 616e 6461 7264 6973 652c  rce_standardise,
-000067d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000067e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000067f0: 2020 2020 2020 2020 2020 2a2a 6b77 6172            **kwar
-00006800: 6773 290a 2020 2020 2020 2020 7265 7475  gs).        retu
-00006810: 726e 2073 656c 662e 6166 6669 6e65 0a0a  rn self.affine..
-00006820: 2020 2020 6465 6620 6765 745f 7472 616e      def get_tran
-00006830: 736c 6174 696f 6e5f 746f 5f61 6c69 676e  slation_to_align
-00006840: 280a 2020 2020 2020 2020 2020 2020 7365  (.            se
-00006850: 6c66 2c20 6f74 6865 722c 207a 5f66 7261  lf, other, z_fra
-00006860: 6374 696f 6e31 3d4e 6f6e 652c 207a 5f66  ction1=None, z_f
-00006870: 7261 6374 696f 6e32 3d4e 6f6e 6529 3a0a  raction2=None):.
-00006880: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00006890: 2020 2020 4465 7465 726d 696e 6520 7472      Determine tr
-000068a0: 616e 736c 6174 696f 6e20 666f 7220 616c  anslation for al
-000068b0: 6967 6e69 6e67 203c 7365 6c66 3e20 746f  igning <self> to
-000068c0: 203c 6f74 6865 723e 2e0a 0a20 2020 2020   <other>...     
-000068d0: 2020 202a 2a50 6172 616d 6574 6572 733a     **Parameters:
-000068e0: 2a2a 0a0a 2020 2020 2020 2020 6f74 6865  **..        othe
-000068f0: 7220 3a20 524f 492f 5374 7275 6374 7572  r : ROI/Structur
-00006900: 6553 6574 2f6c 6973 740a 2020 2020 2020  eSet/list.      
-00006910: 2020 2020 2020 524f 4920 7769 7468 2077        ROI with w
-00006920: 6869 6368 2061 6c69 676e 6d65 6e74 2069  hich alignment i
-00006930: 7320 746f 2062 6520 7065 7266 6f72 6d65  s to be performe
-00006940: 642e 2020 5468 6973 2063 616e 2062 650a  d.  This can be.
-00006950: 2020 2020 2020 2020 2020 2020 7370 6563              spec
-00006960: 6966 6965 6420 6469 7265 6374 6c79 2061  ified directly a
-00006970: 7320 6120 7369 6e67 6c65 2052 4f49 2e20  s a single ROI. 
-00006980: 2041 6c74 6572 6e61 7469 7665 6c79 2c20   Alternatively, 
-00006990: 6974 2063 616e 0a20 2020 2020 2020 2020  it can.         
-000069a0: 2020 2062 6520 6120 5374 7275 6374 7572     be a Structur
-000069b0: 6553 6574 2c20 6f72 2061 206c 6973 7420  eSet, or a list 
-000069c0: 6f72 2052 4f49 2f53 7472 7563 7475 7265  or ROI/Structure
-000069d0: 5365 7420 6f62 6a65 6374 732c 0a20 2020  Set objects,.   
-000069e0: 2020 2020 2020 2020 2069 6e20 7768 6963           in whic
-000069f0: 6820 6361 7365 2074 6865 2069 6e64 6976  h case the indiv
-00006a00: 6964 7561 6c20 524f 4973 2077 696c 6c20  idual ROIs will 
-00006a10: 6265 2063 6f6d 6269 6e65 642e 0a0a 2020  be combined...  
-00006a20: 2020 2020 2020 7a5f 6672 6163 7469 6f6e        z_fraction
-00006a30: 3120 3a20 666c 6f61 742c 2064 6566 6175  1 : float, defau
-00006a40: 6c74 3d4e 6f6e 650a 2020 2020 2020 2020  lt=None.        
-00006a50: 2020 2020 506f 7369 7469 6f6e 2061 6c6f      Position alo
-00006a60: 6e67 207a 2061 7869 7320 6f66 2073 6c69  ng z axis of sli
-00006a70: 6365 2074 6872 6f75 6768 203c 7365 6c66  ce through <self
-00006a80: 3e20 6f6e 2077 6869 6368 0a20 2020 2020  > on which.     
-00006a90: 2020 2020 2020 2074 6f20 616c 6967 6e2e         to align.
-00006aa0: 2020 4966 204e 6f6e 652c 2061 6c69 676e    If None, align
-00006ab0: 6d65 6e74 2069 7320 746f 2074 6865 2063  ment is to the c
-00006ac0: 656e 7472 6f69 6420 6f66 2074 6865 0a20  entroid of the. 
-00006ad0: 2020 2020 2020 2020 2020 2077 686f 6c65             whole
-00006ae0: 2052 4f49 2076 6f6c 756d 652e 2020 4f74   ROI volume.  Ot
-00006af0: 6865 7277 6973 652c 2061 6c69 676e 6d65  herwise, alignme
-00006b00: 6e74 2069 7320 746f 2074 6865 0a20 2020  nt is to the.   
-00006b10: 2020 2020 2020 2020 2063 656e 7472 6f69           centroi
-00006b20: 6420 6f66 2074 6865 2073 6c69 6365 2061  d of the slice a
-00006b30: 7420 7468 6520 7370 6563 6966 6965 6420  t the specified 
-00006b40: 6469 7374 616e 6365 0a20 2020 2020 2020  distance.       
-00006b50: 2020 2020 2066 726f 6d20 7468 6520 524f       from the RO
-00006b60: 4927 7320 6d6f 7374 2d69 6e66 6572 696f  I's most-inferio
-00006b70: 7220 706f 696e 743a 2030 2063 6f72 7265  r point: 0 corre
-00006b80: 7370 6f6e 6473 2074 6f0a 2020 2020 2020  sponds to.      
-00006b90: 2020 2020 2020 7468 6520 6d6f 7374 2d69        the most-i
-00006ba0: 6e66 6572 696f 7220 706f 696e 7420 286c  nferior point (l
-00006bb0: 6f77 6573 7420 7a29 3b20 3120 636f 7272  owest z); 1 corr
-00006bc0: 6573 706f 6e64 7320 746f 2074 6865 0a20  esponds to the. 
-00006bd0: 2020 2020 2020 2020 2020 206d 6f73 742d             most-
-00006be0: 7375 7065 7269 6f72 2070 6f69 6e74 2028  superior point (
-00006bf0: 6869 6768 6573 7420 7a29 2e20 2056 616c  highest z).  Val
-00006c00: 7565 7320 666f 7220 7a5f 6672 6163 7469  ues for z_fracti
-00006c10: 6f6e 0a20 2020 2020 2020 2020 2020 206f  on.            o
-00006c20: 7574 7369 6465 2074 6865 2069 6e74 6572  utside the inter
-00006c30: 7661 6c20 5b30 2c20 315d 2072 6573 756c  val [0, 1] resul
-00006c40: 7420 696e 2061 2052 756e 7469 6d65 4572  t in a RuntimeEr
-00006c50: 726f 722e 0a0a 2020 2020 2020 2020 7a5f  ror...        z_
-00006c60: 6672 6163 7469 6f6e 3220 3a20 666c 6f61  fraction2 : floa
-00006c70: 742c 2064 6566 6175 6c74 3d4e 6f6e 650a  t, default=None.
-00006c80: 2020 2020 2020 2020 2020 2020 506f 7369              Posi
-00006c90: 7469 6f6e 2061 6c6f 6e67 207a 2061 7869  tion along z axi
-00006ca0: 7320 6f66 2073 6c69 6365 2074 6872 6f75  s of slice throu
-00006cb0: 6768 203c 6f74 6865 723e 206f 6e20 7768  gh <other> on wh
-00006cc0: 6963 680a 2020 2020 2020 2020 2020 2020  ich.            
-00006cd0: 746f 2061 6c69 676e 2e20 2049 6620 4e6f  to align.  If No
-00006ce0: 6e65 2c20 616c 6967 6e6d 656e 7420 6973  ne, alignment is
-00006cf0: 2074 6f20 7468 6520 6365 6e74 726f 6964   to the centroid
-00006d00: 206f 6620 7468 650a 2020 2020 2020 2020   of the.        
-00006d10: 2020 2020 7768 6f6c 6520 524f 4920 766f      whole ROI vo
-00006d20: 6c75 6d65 2e20 204f 7468 6572 7769 7365  lume.  Otherwise
-00006d30: 2c20 616c 6967 6e6d 656e 7420 6973 2074  , alignment is t
-00006d40: 6f20 7468 650a 2020 2020 2020 2020 2020  o the.          
-00006d50: 2020 6365 6e74 726f 6964 206f 6620 7468    centroid of th
-00006d60: 6520 736c 6963 6520 6174 2074 6865 2073  e slice at the s
-00006d70: 7065 6369 6669 6564 2064 6973 7461 6e63  pecified distanc
-00006d80: 650a 2020 2020 2020 2020 2020 2020 6672  e.            fr
-00006d90: 6f6d 2074 6865 2052 4f49 2773 206d 6f73  om the ROI's mos
-00006da0: 742d 696e 6665 7269 6f72 2070 6f69 6e74  t-inferior point
-00006db0: 3a20 3020 636f 7272 6573 706f 6e64 7320  : 0 corresponds 
-00006dc0: 746f 0a20 2020 2020 2020 2020 2020 2074  to.            t
-00006dd0: 6865 206d 6f73 742d 696e 6665 7269 6f72  he most-inferior
-00006de0: 2070 6f69 6e74 2028 6c6f 7765 7374 207a   point (lowest z
-00006df0: 293b 2031 2063 6f72 7265 7370 6f6e 6473  ); 1 corresponds
-00006e00: 2074 6f20 7468 650a 2020 2020 2020 2020   to the.        
-00006e10: 2020 2020 6d6f 7374 2d73 7570 6572 696f      most-superio
-00006e20: 7220 706f 696e 7420 2868 6967 6865 7374  r point (highest
-00006e30: 207a 292e 2020 5661 6c75 6573 2066 6f72   z).  Values for
-00006e40: 207a 5f66 7261 6374 696f 6e0a 2020 2020   z_fraction.    
-00006e50: 2020 2020 2020 2020 6f75 7473 6964 6520          outside 
-00006e60: 7468 6520 696e 7465 7276 616c 205b 302c  the interval [0,
-00006e70: 2031 5d20 7265 7375 6c74 2069 6e20 6120   1] result in a 
-00006e80: 5275 6e74 696d 6545 7272 6f72 2e0a 2020  RuntimeError..  
-00006e90: 2020 2020 2020 2020 2020 2222 220a 2020            """.  
-00006ea0: 2020 2020 2020 7265 7475 726e 2067 6574        return get
-00006eb0: 5f74 7261 6e73 6c61 7469 6f6e 5f74 6f5f  _translation_to_
-00006ec0: 616c 6967 6e28 0a20 2020 2020 2020 2020  align(.         
-00006ed0: 2020 2020 2020 2073 656c 662c 206f 7468         self, oth
-00006ee0: 6572 2c20 7a5f 6672 6163 7469 6f6e 312c  er, z_fraction1,
-00006ef0: 207a 5f66 7261 6374 696f 6e32 290a 0a20   z_fraction2).. 
-00006f00: 2020 2064 6566 2067 6574 5f76 6f78 656c     def get_voxel
-00006f10: 5f73 697a 6528 7365 6c66 293a 0a20 2020  _size(self):.   
-00006f20: 2020 2020 2022 2222 4c6f 6164 2073 656c       """Load sel
-00006f30: 6620 616e 6420 6765 7420 766f 7865 6c5f  f and get voxel_
-00006f40: 7369 7a65 2e22 2222 0a0a 2020 2020 2020  size."""..      
-00006f50: 2020 7365 6c66 2e6c 6f61 6428 290a 2020    self.load().  
-00006f60: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-00006f70: 662e 766f 7865 6c5f 7369 7a65 0a0a 2020  f.voxel_size..  
-00006f80: 2020 6465 6620 6765 745f 6e70 5f76 6f78    def get_np_vox
-00006f90: 656c 5f73 697a 6528 7365 6c66 2c20 7669  el_size(self, vi
-00006fa0: 6577 3d4e 6f6e 6529 3a0a 2020 2020 2020  ew=None):.      
-00006fb0: 2020 2222 220a 2020 2020 2020 2020 4765    """.        Ge
-00006fc0: 7420 766f 7865 6c5f 7369 7a65 2066 6f72  t voxel_size for
-00006fd0: 206e 756d 7079 2061 7869 7320 6f72 6465   numpy axis orde
-00006fe0: 7269 6e67 2061 6e64 2073 7065 6369 6669  ring and specifi
-00006ff0: 6564 2076 6965 772e 0a0a 2020 2020 2020  ed view...      
-00007000: 2020 7669 6577 203a 2073 7472 0a20 2020    view : str.   
-00007010: 2020 2020 2020 2020 204f 7269 656e 7461           Orienta
-00007020: 7469 6f6e 2063 6f6e 7369 6465 7265 6420  tion considered 
-00007030: 666f 7220 3244 2069 6d61 6765 206f 7220  for 2D image or 
-00007040: 7072 6f6a 6563 7469 6f6e 2e0a 2020 2020  projection..    
-00007050: 2020 2020 2020 2020 4361 6e20 6265 2022          Can be "
-00007060: 782d 7922 2c20 2279 2d7a 222c 206f 7220  x-y", "y-z", or 
-00007070: 2278 2d7a 222e 0a20 2020 2020 2020 2022  "x-z"..        "
-00007080: 2222 0a0a 2020 2020 2020 2020 7365 6c66  ""..        self
-00007090: 2e6c 6f61 6428 290a 2020 2020 2020 2020  .load().        
-000070a0: 6966 2076 6965 7720 6973 204e 6f6e 653a  if view is None:
-000070b0: 0a20 2020 2020 2020 2020 2020 2076 782c  .            vx,
-000070c0: 2076 792c 2076 7a20 3d20 7365 6c66 2e76   vy, vz = self.v
-000070d0: 6f78 656c 5f73 697a 650a 2020 2020 2020  oxel_size.      
-000070e0: 2020 2020 2020 766f 7865 6c5f 7369 7a65        voxel_size
-000070f0: 203d 205b 7679 2c20 7678 2c20 767a 5d0a   = [vy, vx, vz].
-00007100: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-00007110: 2020 2020 2020 2020 2020 766f 7865 6c5f            voxel_
-00007120: 7369 7a65 203d 205b 7365 6c66 2e76 6f78  size = [self.vox
-00007130: 656c 5f73 697a 655b 695d 0a20 2020 2020  el_size[i].     
-00007140: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-00007150: 6f72 2069 2069 6e20 736b 7274 2e69 6d61  or i in skrt.ima
-00007160: 6765 2e5f 706c 6f74 5f61 7865 735b 7669  ge._plot_axes[vi
-00007170: 6577 5d5d 0a0a 2020 2020 2020 2020 7265  ew]]..        re
-00007180: 7475 726e 2076 6f78 656c 5f73 697a 650a  turn voxel_size.
-00007190: 0a20 2020 2064 6566 2067 6574 5f6f 7269  .    def get_ori
-000071a0: 6769 6e28 7365 6c66 293a 0a20 2020 2020  gin(self):.     
-000071b0: 2020 2022 2222 4c6f 6164 2073 656c 6620     """Load self 
-000071c0: 616e 6420 6765 7420 6f72 6967 696e 2e22  and get origin."
-000071d0: 2222 0a0a 2020 2020 2020 2020 7365 6c66  ""..        self
-000071e0: 2e6c 6f61 6428 290a 2020 2020 2020 2020  .load().        
-000071f0: 7265 7475 726e 2073 656c 662e 6f72 6967  return self.orig
-00007200: 696e 0a0a 2020 2020 6465 6620 6765 745f  in..    def get_
-00007210: 6e61 6d65 2873 656c 662c 206f 7269 6769  name(self, origi
-00007220: 6e61 6c3d 4661 6c73 6529 3a0a 2020 2020  nal=False):.    
-00007230: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-00007240: 4c6f 6164 2073 656c 6620 616e 6420 6765  Load self and ge
-00007250: 7420 6e61 6d65 2e20 4966 203c 6f72 6967  t name. If <orig
-00007260: 696e 616c 3e20 6973 2054 7275 652c 2067  inal> is True, g
-00007270: 6574 2074 6865 206f 7269 6769 6e61 6c20  et the original 
-00007280: 6e61 6d65 2e0a 2020 2020 2020 2020 2222  name..        ""
-00007290: 220a 0a20 2020 2020 2020 2073 656c 662e  "..        self.
-000072a0: 6c6f 6164 2829 0a20 2020 2020 2020 2072  load().        r
-000072b0: 6574 7572 6e20 2873 656c 662e 6f72 6967  eturn (self.orig
-000072c0: 696e 616c 5f6e 616d 6520 6966 206f 7269  inal_name if ori
-000072d0: 6769 6e61 6c20 656c 7365 2073 656c 662e  ginal else self.
-000072e0: 6e61 6d65 290a 0a20 2020 2064 6566 2067  name)..    def g
-000072f0: 6574 5f6d 6173 6b28 7365 6c66 2c20 7669  et_mask(self, vi
-00007300: 6577 3d22 782d 7922 2c20 666c 6174 7465  ew="x-y", flatte
-00007310: 6e3d 4661 6c73 652c 2073 7461 6e64 6172  n=False, standar
-00007320: 6469 7365 3d46 616c 7365 2c20 0a20 2020  dise=False, .   
-00007330: 2020 2020 2020 2020 2020 2020 2020 666f                fo
-00007340: 7263 655f 7374 616e 6461 7264 6973 653d  rce_standardise=
-00007350: 4661 6c73 6529 3a0a 2020 2020 2020 2020  False):.        
-00007360: 2222 2247 6574 2062 696e 6172 7920 6d61  """Get binary ma
-00007370: 736b 2c20 6f70 7469 6f6e 616c 6c79 2066  sk, optionally f
-00007380: 6c61 7474 656e 6564 2069 6e20 6120 6769  lattened in a gi
-00007390: 7665 6e20 6f72 6965 6e74 6174 696f 6e2e  ven orientation.
-000073a0: 2222 220a 0a20 2020 2020 2020 2073 656c  """..        sel
-000073b0: 662e 6c6f 6164 2829 0a20 2020 2020 2020  f.load().       
-000073c0: 2073 656c 662e 6372 6561 7465 5f6d 6173   self.create_mas
-000073d0: 6b28 290a 2020 2020 2020 2020 6966 206e  k().        if n
-000073e0: 6f74 2066 6c61 7474 656e 3a0a 2020 2020  ot flatten:.    
-000073f0: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-00007400: 656c 662e 6d61 736b 2e67 6574 5f64 6174  elf.mask.get_dat
-00007410: 6128 7374 616e 6461 7264 6973 653d 7374  a(standardise=st
-00007420: 616e 6461 7264 6973 652c 200a 2020 2020  andardise, .    
-00007430: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007440: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007450: 2020 666f 7263 655f 7374 616e 6461 7264    force_standard
-00007460: 6973 653d 666f 7263 655f 7374 616e 6461  ise=force_standa
-00007470: 7264 6973 6529 0a20 2020 2020 2020 2072  rdise).        r
-00007480: 6574 7572 6e20 6e70 2e73 756d 280a 2020  eturn np.sum(.  
-00007490: 2020 2020 2020 2020 2020 7365 6c66 2e6d            self.m
-000074a0: 6173 6b2e 6765 745f 6461 7461 2873 7461  ask.get_data(sta
-000074b0: 6e64 6172 6469 7365 3d73 7461 6e64 6172  ndardise=standar
-000074c0: 6469 7365 2c20 0a20 2020 2020 2020 2020  dise, .         
-000074d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000074e0: 2020 2020 2020 666f 7263 655f 7374 616e        force_stan
-000074f0: 6461 7264 6973 653d 666f 7263 655f 7374  dardise=force_st
-00007500: 616e 6461 7264 6973 6529 2c0a 2020 2020  andardise),.    
-00007510: 2020 2020 2020 2020 6178 6973 3d73 6b72          axis=skr
-00007520: 742e 696d 6167 652e 5f73 6c69 6365 5f61  t.image._slice_a
-00007530: 7865 735b 7669 6577 5d0a 2020 2020 2020  xes[view].      
-00007540: 2020 292e 6173 7479 7065 2862 6f6f 6c29    ).astype(bool)
-00007550: 0a0a 2020 2020 6465 6620 6765 745f 6d61  ..    def get_ma
-00007560: 736b 5f69 6d61 6765 2873 656c 6629 3a0a  sk_image(self):.
-00007570: 2020 2020 2020 2020 2222 2247 6574 2069          """Get i
-00007580: 6d61 6765 206f 626a 6563 7420 7265 7072  mage object repr
-00007590: 6573 656e 7469 6e67 2052 4f49 206d 6173  esenting ROI mas
-000075a0: 6b2e 2222 220a 0a20 2020 2020 2020 2073  k."""..        s
-000075b0: 656c 662e 6c6f 6164 2829 0a20 2020 2020  elf.load().     
-000075c0: 2020 2073 656c 662e 6372 6561 7465 5f6d     self.create_m
-000075d0: 6173 6b28 290a 2020 2020 2020 2020 7265  ask().        re
-000075e0: 7475 726e 2073 656c 662e 6d61 736b 0a0a  turn self.mask..
-000075f0: 2020 2020 6465 6620 6765 745f 706f 6c79      def get_poly
-00007600: 676f 6e73 2873 656c 662c 2076 6965 773d  gons(self, view=
-00007610: 2278 2d79 222c 2069 6478 5f61 735f 6b65  "x-y", idx_as_ke
-00007620: 793d 4661 6c73 6529 3a0a 2020 2020 2020  y=False):.      
-00007630: 2020 2222 2247 6574 2064 6963 7420 6f66    """Get dict of
-00007640: 2070 6f6c 7967 6f6e 7320 666f 7220 6561   polygons for ea
-00007650: 6368 2073 6c69 6365 2e22 2222 0a0a 2020  ch slice."""..  
-00007660: 2020 2020 2020 706f 6c79 676f 6e73 203d        polygons =
-00007670: 207b 7d0a 2020 2020 2020 2020 666f 7220   {}.        for 
-00007680: 692c 2063 6f6e 746f 7572 7320 696e 2073  i, contours in s
-00007690: 656c 662e 6765 745f 636f 6e74 6f75 7273  elf.get_contours
-000076a0: 2876 6965 772c 2069 6478 5f61 735f 6b65  (view, idx_as_ke
-000076b0: 7929 2e69 7465 6d73 2829 3a0a 2020 2020  y).items():.    
-000076c0: 2020 2020 2020 2020 706f 6c79 676f 6e73          polygons
-000076d0: 5b69 5d20 3d20 5b63 6f6e 746f 7572 5f74  [i] = [contour_t
-000076e0: 6f5f 706f 6c79 676f 6e28 6329 2066 6f72  o_polygon(c) for
-000076f0: 2063 2069 6e20 636f 6e74 6f75 7273 5d0a   c in contours].
-00007700: 2020 2020 2020 2020 7265 7475 726e 2070          return p
-00007710: 6f6c 7967 6f6e 730a 0a20 2020 2064 6566  olygons..    def
-00007720: 2067 6574 5f70 6f6c 7967 6f6e 735f 6f6e   get_polygons_on
-00007730: 5f73 6c69 6365 2873 656c 662c 2076 6965  _slice(self, vie
-00007740: 773d 2278 2d79 222c 2073 6c3d 4e6f 6e65  w="x-y", sl=None
-00007750: 2c20 6964 783d 4e6f 6e65 2c20 706f 733d  , idx=None, pos=
-00007760: 4e6f 6e65 293a 0a20 2020 2020 2020 2022  None):.        "
-00007770: 2222 4765 7420 7368 6170 656c 7920 706f  ""Get shapely po
-00007780: 6c79 676f 6e20 6f62 6a65 6374 7320 636f  lygon objects co
-00007790: 7272 6573 706f 6e64 696e 6720 746f 2061  rresponding to a
-000077a0: 2067 6976 656e 2073 6c69 6365 2e22 2222   given slice."""
-000077b0: 0a0a 2020 2020 2020 2020 636f 6e74 6f75  ..        contou
-000077c0: 7273 203d 2073 656c 662e 6765 745f 636f  rs = self.get_co
-000077d0: 6e74 6f75 7273 5f6f 6e5f 736c 6963 6528  ntours_on_slice(
-000077e0: 7669 6577 2c20 736c 2c20 6964 782c 2070  view, sl, idx, p
-000077f0: 6f73 290a 2020 2020 2020 2020 7265 7475  os).        retu
-00007800: 726e 205b 636f 6e74 6f75 725f 746f 5f70  rn [contour_to_p
-00007810: 6f6c 7967 6f6e 2863 2920 666f 7220 6320  olygon(c) for c 
-00007820: 696e 2063 6f6e 746f 7572 735d 0a0a 2020  in contours]..  
-00007830: 2020 6465 6620 6372 6561 7465 5f63 6f6e    def create_con
-00007840: 746f 7572 7328 7365 6c66 2c20 7669 6577  tours(self, view
-00007850: 3d22 616c 6c22 2c20 666f 7263 653d 4661  ="all", force=Fa
-00007860: 6c73 6529 3a0a 2020 2020 2020 2020 2222  lse):.        ""
-00007870: 2243 7265 6174 6520 636f 6e74 6f75 7273  "Create contours
-00007880: 2069 6e20 616c 6c20 6f72 6965 6e74 6174   in all orientat
-00007890: 696f 6e73 2e22 2222 0a0a 2020 2020 2020  ions."""..      
-000078a0: 2020 6966 206e 6f74 2066 6f72 6365 3a0a    if not force:.
-000078b0: 2020 2020 2020 2020 2020 2020 6966 2076              if v
-000078c0: 6965 7720 3d3d 2022 616c 6c22 2061 6e64  iew == "all" and
-000078d0: 2061 6c6c 285b 7620 696e 2073 656c 662e   all([v in self.
-000078e0: 636f 6e74 6f75 7273 2066 6f72 2076 2069  contours for v i
-000078f0: 6e20 0a20 2020 2020 2020 2020 2020 2020  n .             
-00007900: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007910: 2020 2020 2020 2020 2073 6b72 742e 696d           skrt.im
-00007920: 6167 652e 5f70 6c6f 745f 6178 6573 5d29  age._plot_axes])
-00007930: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00007940: 2020 7265 7475 726e 0a20 2020 2020 2020    return.       
-00007950: 2020 2020 2069 6620 7669 6577 2069 6e20       if view in 
-00007960: 7365 6c66 2e63 6f6e 746f 7572 733a 0a20  self.contours:. 
-00007970: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00007980: 6574 7572 6e0a 0a20 2020 2020 2020 2069  eturn..        i
-00007990: 6620 6e6f 7420 7365 6c66 2e6c 6f61 6465  f not self.loade
-000079a0: 643a 0a20 2020 2020 2020 2020 2020 2073  d:.            s
-000079b0: 656c 662e 6c6f 6164 2829 0a0a 2020 2020  elf.load()..    
-000079c0: 2020 2020 7365 6c66 2e63 7265 6174 655f      self.create_
-000079d0: 6d61 736b 2829 0a20 2020 2020 2020 2069  mask().        i
-000079e0: 6620 666f 7263 653a 0a20 2020 2020 2020  f force:.       
-000079f0: 2020 2020 2073 656c 662e 636f 6e74 6f75       self.contou
-00007a00: 7273 203d 207b 7d0a 0a20 2020 2020 2020  rs = {}..       
-00007a10: 2023 2043 7265 6174 6520 636f 6e74 6f75   # Create contou
-00007a20: 7273 2069 6e20 6576 6572 7920 6f72 6965  rs in every orie
-00007a30: 6e74 6174 696f 6e0a 2020 2020 2020 2020  ntation.        
-00007a40: 7669 6577 7320 3d20 6c69 7374 2873 6b72  views = list(skr
-00007a50: 742e 696d 6167 652e 5f70 6c6f 745f 6178  t.image._plot_ax
-00007a60: 6573 2e6b 6579 7328 2929 2069 6620 7669  es.keys()) if vi
-00007a70: 6577 203d 3d20 2261 6c6c 2220 656c 7365  ew == "all" else
-00007a80: 205b 7669 6577 5d0a 2020 2020 2020 2020   [view].        
-00007a90: 666f 7220 7620 696e 2076 6965 7773 3a0a  for v in views:.
-00007aa0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00007ab0: 7620 696e 2073 656c 662e 636f 6e74 6f75  v in self.contou
-00007ac0: 7273 3a0a 2020 2020 2020 2020 2020 2020  rs:.            
-00007ad0: 2020 2020 636f 6e74 696e 7565 0a0a 2020      continue..  
-00007ae0: 2020 2020 2020 2020 2020 2320 4d61 6b65            # Make
-00007af0: 206e 6577 2063 6f6e 746f 7572 7320 6672   new contours fr
-00007b00: 6f6d 206d 6173 6b0a 2020 2020 2020 2020  om mask.        
-00007b10: 2020 2020 7a5f 6178 203d 2073 6b72 742e      z_ax = skrt.
-00007b20: 696d 6167 652e 5f73 6c69 6365 5f61 7865  image._slice_axe
-00007b30: 735b 765d 0a20 2020 2020 2020 2020 2020  s[v].           
-00007b40: 2073 656c 662e 636f 6e74 6f75 7273 5b76   self.contours[v
-00007b50: 5d20 3d20 7b7d 0a20 2020 2020 2020 2020  ] = {}.         
-00007b60: 2020 2066 6f72 2069 7a20 696e 2073 656c     for iz in sel
-00007b70: 662e 6765 745f 696e 6469 6365 7328 762c  f.get_indices(v,
-00007b80: 206d 6574 686f 643d 226d 6173 6b22 293a   method="mask"):
-00007b90: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00007ba0: 2020 2320 4765 7420 736c 6963 6520 6f66    # Get slice of
-00007bb0: 206d 6173 6b20 6172 7261 790a 2020 2020   mask array.    
-00007bc0: 2020 2020 2020 2020 2020 2020 6d61 736b              mask
-00007bd0: 5f73 6c69 6365 203d 2073 656c 662e 6765  _slice = self.ge
-00007be0: 745f 736c 6963 6528 762c 2069 6478 3d69  t_slice(v, idx=i
-00007bf0: 7a29 2e54 0a20 2020 2020 2020 2020 2020  z).T.           
-00007c00: 2020 2020 2069 6620 6d61 736b 5f73 6c69       if mask_sli
-00007c10: 6365 2e6d 6178 2829 203c 2030 2e35 3a0a  ce.max() < 0.5:.
-00007c20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007c30: 2020 2020 636f 6e74 696e 7565 0a0a 2020      continue..  
-00007c40: 2020 2020 2020 2020 2020 2020 2020 706f                po
-00007c50: 696e 7473 203d 2073 656c 662e 6d61 736b  ints = self.mask
-00007c60: 5f74 6f5f 636f 6e74 6f75 7273 286d 6173  _to_contours(mas
-00007c70: 6b5f 736c 6963 652c 2076 290a 2020 2020  k_slice, v).    
-00007c80: 2020 2020 2020 2020 2020 2020 6966 2070              if p
-00007c90: 6f69 6e74 733a 0a20 2020 2020 2020 2020  oints:.         
-00007ca0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00007cb0: 636f 6e74 6f75 7273 5b76 5d5b 7365 6c66  contours[v][self
-00007cc0: 2e69 6478 5f74 6f5f 706f 7328 697a 2c20  .idx_to_pos(iz, 
-00007cd0: 7a5f 6178 295d 203d 2070 6f69 6e74 730a  z_ax)] = points.
-00007ce0: 0a20 2020 2064 6566 206d 6173 6b5f 746f  .    def mask_to
-00007cf0: 5f63 6f6e 746f 7572 7328 7365 6c66 2c20  _contours(self, 
-00007d00: 6d61 736b 2c20 7669 6577 2c20 696e 7665  mask, view, inve
-00007d10: 7274 3d46 616c 7365 293a 0a20 2020 2020  rt=False):.     
-00007d20: 2020 2022 2222 4372 6561 7465 2063 6f6e     """Create con
-00007d30: 746f 7572 7320 6672 6f6d 2061 206d 6173  tours from a mas
-00007d40: 6b2e 2222 220a 0a20 2020 2020 2020 2063  k."""..        c
-00007d50: 6f6e 746f 7572 7320 3d20 736b 696d 6167  ontours = skimag
-00007d60: 652e 6d65 6173 7572 652e 6669 6e64 5f63  e.measure.find_c
-00007d70: 6f6e 746f 7572 7328 6d61 736b 2c20 302e  ontours(mask, 0.
-00007d80: 352c 2022 6c6f 7722 2c20 226c 6f77 2229  5, "low", "low")
-00007d90: 0a0a 2020 2020 2020 2020 2320 436f 6e76  ..        # Conv
-00007da0: 6572 7420 696e 6469 6365 7320 746f 2070  ert indices to p
-00007db0: 6f73 6974 696f 6e73 2069 6e20 6d6d 0a20  ositions in mm. 
-00007dc0: 2020 2020 2020 2078 5f61 782c 2079 5f61         x_ax, y_a
-00007dd0: 7820 3d20 736b 7274 2e69 6d61 6765 2e5f  x = skrt.image._
-00007de0: 706c 6f74 5f61 7865 735b 7669 6577 5d0a  plot_axes[view].
-00007df0: 2020 2020 2020 2020 706f 696e 7473 203d          points =
-00007e00: 205b 5d0a 2020 2020 2020 2020 666f 7220   [].        for 
-00007e10: 636f 6e74 6f75 7220 696e 2063 6f6e 746f  contour in conto
-00007e20: 7572 733a 0a20 2020 2020 2020 2020 2020  urs:.           
-00007e30: 2063 6f6e 746f 7572 5f70 6f69 6e74 7320   contour_points 
-00007e40: 3d20 5b5d 0a20 2020 2020 2020 2020 2020  = [].           
-00007e50: 2066 6f72 2069 782c 2069 7920 696e 2063   for ix, iy in c
-00007e60: 6f6e 746f 7572 3a0a 2020 2020 2020 2020  ontour:.        
-00007e70: 2020 2020 2020 2020 7078 203d 2073 656c          px = sel
-00007e80: 662e 6964 785f 746f 5f70 6f73 2869 782c  f.idx_to_pos(ix,
-00007e90: 2078 5f61 7829 0a20 2020 2020 2020 2020   x_ax).         
-00007ea0: 2020 2020 2020 2070 7920 3d20 7365 6c66         py = self
-00007eb0: 2e69 6478 5f74 6f5f 706f 7328 6979 2c20  .idx_to_pos(iy, 
-00007ec0: 795f 6178 290a 2020 2020 2020 2020 2020  y_ax).          
-00007ed0: 2020 2020 2020 6966 2069 6e76 6572 743a        if invert:
-00007ee0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00007ef0: 2020 2020 2070 782c 2070 7920 3d20 7079       px, py = py
-00007f00: 2c20 7078 0a20 2020 2020 2020 2020 2020  , px.           
-00007f10: 2020 2020 2063 6f6e 746f 7572 5f70 6f69       contour_poi
-00007f20: 6e74 732e 6170 7065 6e64 285b 7078 2c20  nts.append([px, 
-00007f30: 7079 5d29 0a20 2020 2020 2020 2020 2020  py]).           
-00007f40: 2070 6f69 6e74 732e 6170 7065 6e64 286e   points.append(n
-00007f50: 702e 6172 7261 7928 636f 6e74 6f75 725f  p.array(contour_
-00007f60: 706f 696e 7473 2929 0a0a 2020 2020 2020  points))..      
-00007f70: 2020 7265 7475 726e 2070 6f69 6e74 730a    return points.
-00007f80: 0a20 2020 2064 6566 2063 7265 6174 655f  .    def create_
-00007f90: 6d61 736b 280a 2020 2020 2020 2020 7365  mask(.        se
-00007fa0: 6c66 2c20 0a20 2020 2020 2020 2066 6f72  lf, .        for
-00007fb0: 6365 3d46 616c 7365 2c20 0a20 2020 2020  ce=False, .     
-00007fc0: 2020 206f 7665 726c 6170 5f6c 6576 656c     overlap_level
-00007fd0: 3d4e 6f6e 652c 200a 2020 2020 2020 2020  =None, .        
-00007fe0: 766f 7865 6c5f 7369 7a65 3d4e 6f6e 652c  voxel_size=None,
-00007ff0: 200a 2020 2020 2020 2020 7368 6170 653d   .        shape=
-00008000: 4e6f 6e65 0a20 2020 2029 3a0a 2020 2020  None.    ):.    
-00008010: 2020 2020 2222 2243 7265 6174 6520 6269      """Create bi
-00008020: 6e61 7279 206d 6173 6b20 7265 7072 6573  nary mask repres
-00008030: 656e 7461 7469 6f6e 206f 6620 7468 6973  entation of this
-00008040: 2052 4f49 2e20 4966 2074 6865 2052 4f49   ROI. If the ROI
-00008050: 2077 6173 2063 7265 6174 6564 0a20 2020   was created.   
-00008060: 2020 2020 2066 726f 6d20 636f 6e74 6f75       from contou
-00008070: 7273 2c20 7468 6573 6520 636f 6e74 6f75  rs, these contou
-00008080: 7273 2077 696c 6c20 6265 2063 6f6e 7665  rs will be conve
-00008090: 7274 6564 2074 6f20 6120 6d61 736b 3b20  rted to a mask; 
-000080a0: 6966 2074 6865 2052 4f49 0a20 2020 2020  if the ROI.     
-000080b0: 2020 2077 6173 2063 7265 6174 6564 2066     was created f
-000080c0: 726f 6d20 6120 6d61 736b 2c20 7468 6973  rom a mask, this
-000080d0: 206d 6173 6b20 7769 6c6c 2062 6520 6361   mask will be ca
-000080e0: 7374 2074 6f20 6120 626f 6f6c 6561 6e20  st to a boolean 
-000080f0: 6172 7261 7920 616e 640a 2020 2020 2020  array and.      
-00008100: 2020 6974 7320 6765 6f65 6d74 7269 6320    its geoemtric 
-00008110: 7072 6f70 6572 7469 6573 2077 696c 6c20  properties will 
-00008120: 6265 2061 7373 6967 6e65 6420 746f 2074  be assigned to t
-00008130: 6869 7320 524f 492e 2049 6620 6120 6d61  his ROI. If a ma
-00008140: 736b 2068 6173 200a 2020 2020 2020 2020  sk has .        
-00008150: 616c 7265 6164 7920 6265 656e 2063 7265  already been cre
-00008160: 6174 6564 2c20 6e6f 7468 696e 6720 7769  ated, nothing wi
-00008170: 6c6c 2068 6170 7065 6e20 756e 6c65 7373  ll happen unless
-00008180: 2066 6f72 6365 3d54 7275 652e 0a0a 2020   force=True...  
-00008190: 2020 2020 2020 2a2a 5061 7261 6d65 7465        **Paramete
-000081a0: 7273 3a2a 2a0a 2020 2020 2020 2020 0a20  rs:**.        . 
-000081b0: 2020 2020 2020 2066 6f72 6365 203a 2062         force : b
-000081c0: 6f6f 6c2c 2064 6566 6175 6c74 3d46 616c  ool, default=Fal
-000081d0: 7365 0a20 2020 2020 2020 2020 2020 2049  se.            I
-000081e0: 6620 5472 7565 2c20 7468 6520 6d61 736b  f True, the mask
-000081f0: 2077 696c 6c20 6265 2072 6563 7265 6174   will be recreat
-00008200: 6564 2065 7665 6e20 6966 2069 7420 616c  ed even if it al
-00008210: 7265 6164 7920 6578 6973 7473 2e0a 0a20  ready exists... 
-00008220: 2020 2020 2020 206f 7665 726c 6170 5f6c         overlap_l
-00008230: 6576 656c 203a 2066 6c6f 6174 2c20 6465  evel : float, de
-00008240: 6661 756c 743d 302e 3235 0a20 2020 2020  fault=0.25.     
-00008250: 2020 2020 2020 2052 6571 7569 7265 6420         Required 
-00008260: 6f76 6572 6c61 7020 6f66 2061 2070 6978  overlap of a pix
-00008270: 656c 2077 6974 6820 7468 6520 524f 4920  el with the ROI 
-00008280: 636f 6e74 6f75 7220 696e 206f 7264 6572  contour in order
-00008290: 2066 6f72 2074 6865 200a 2020 2020 2020   for the .      
-000082a0: 2020 2020 2020 7069 7865 6c20 746f 2062        pixel to b
-000082b0: 6520 6164 6465 6420 746f 2074 6865 206d  e added to the m
-000082c0: 6173 6b2e 2049 6620 4e6f 6e65 2c20 7468  ask. If None, th
-000082d0: 6520 7661 6c75 6520 6f66 0a20 2020 2020  e value of.     
-000082e0: 2020 2020 2020 2073 656c 662e 6f76 6572         self.over
-000082f0: 6c61 705f 6c65 7665 6c20 7769 6c6c 2062  lap_level will b
-00008300: 6520 7573 6564 3b20 6f74 6865 7277 6973  e used; otherwis
-00008310: 652c 0a20 2020 2020 2020 2020 2020 2073  e,.            s
-00008320: 656c 662e 6f76 6572 6c61 705f 6c65 7665  elf.overlap_leve
-00008330: 6c20 7769 6c6c 2062 6520 6f76 6572 7772  l will be overwr
-00008340: 6974 7465 6e20 7769 7468 2074 6869 7320  itten with this 
-00008350: 7661 6c75 652e 2049 6620 626f 7468 2061  value. If both a
-00008360: 7265 200a 2020 2020 2020 2020 2020 2020  re .            
-00008370: 4e6f 6e65 2c20 7468 6520 6f75 7470 7574  None, the output
-00008380: 206f 6620 736b 696d 6167 652e 6472 6177   of skimage.draw
-00008390: 2e70 6f6c 7967 6f6e 326d 6173 6b20 7769  .polygon2mask wi
-000083a0: 6c6c 2062 6520 7265 7475 726e 6564 200a  ll be returned .
-000083b0: 2020 2020 2020 2020 2020 2020 7769 7468              with
-000083c0: 206e 6f20 626f 7264 6572 2063 6865 636b   no border check
-000083d0: 732c 2077 6869 6368 2069 7320 6661 7374  s, which is fast
-000083e0: 6572 2074 6861 6e20 7065 7266 6f72 6d69  er than performi
-000083f0: 6e67 2062 6f72 6465 7220 6368 6563 6b73  ng border checks
-00008400: 2e0a 0a20 2020 2020 2020 2076 6f78 656c  ...        voxel
-00008410: 5f73 697a 6520 3a20 6c69 7374 2c20 6465  _size : list, de
-00008420: 6661 756c 743d 4e6f 6e65 0a20 2020 2020  fault=None.     
-00008430: 2020 2020 2020 2056 6f78 656c 2073 697a         Voxel siz
-00008440: 6573 206f 6620 7468 6520 6465 7369 7265  es of the desire
-00008450: 6420 6d61 736b 2069 6e20 7468 6520 5b78  d mask in the [x
-00008460: 2c20 795d 2064 6972 6563 7469 6f6e 2e20  , y] direction. 
-00008470: 4f6e 6c79 2075 7365 6420 6966 200a 2020  Only used if .  
-00008480: 2020 2020 2020 2020 2020 7468 6520 524f            the RO
-00008490: 4920 7761 7320 6372 6561 7465 6420 6672  I was created fr
-000084a0: 6f6d 2063 6f6e 746f 7572 733b 2069 676e  om contours; ign
-000084b0: 6f72 6564 2069 6620 524f 4920 7761 7320  ored if ROI was 
-000084c0: 6372 6561 7465 6420 6672 6f6d 200a 2020  created from .  
-000084d0: 2020 2020 2020 2020 2020 6d61 736b 2e20            mask. 
-000084e0: 4361 7573 6573 2073 656c 662e 696d 6167  Causes self.imag
-000084f0: 6520 746f 2062 6520 7265 706c 6163 6564  e to be replaced
-00008500: 2077 6974 6820 6120 0a20 2020 2020 2020   with a .       
-00008510: 2020 2020 2062 6c61 6e6b 2064 756d 6d79       blank dummy
-00008520: 2069 6d61 6765 2077 6974 6820 7468 6573   image with thes
-00008530: 6520 766f 7865 6c20 7369 7a65 732e 0a0a  e voxel sizes...
-00008540: 2020 2020 2020 2020 7368 6170 6520 3a20          shape : 
-00008550: 6c69 7374 2c20 6465 6661 756c 743d 4e6f  list, default=No
-00008560: 6e65 0a20 2020 2020 2020 2020 2020 2053  ne.            S
-00008570: 6861 7065 206f 6620 7468 6520 6465 7369  hape of the desi
-00008580: 7265 6420 6d61 736b 2069 6e20 7468 6520  red mask in the 
-00008590: 5b78 2c20 795d 2064 6972 6563 7469 6f6e  [x, y] direction
-000085a0: 2e20 4f6e 6c79 2075 7365 6420 6966 200a  . Only used if .
-000085b0: 2020 2020 2020 2020 2020 2020 3c76 6f78              <vox
-000085c0: 656c 5f73 697a 653e 2069 7320 4e6f 6e65  el_size> is None
-000085d0: 2061 6e64 2074 6865 2052 4f49 2077 6173   and the ROI was
-000085e0: 2063 7265 6174 6564 2066 726f 6d20 636f   created from co
-000085f0: 6e74 6f75 7273 3b20 0a20 2020 2020 2020  ntours; .       
-00008600: 2020 2020 2069 676e 6f72 6564 2069 6620       ignored if 
-00008610: 524f 4920 7761 7320 6372 6561 7465 6420  ROI was created 
-00008620: 6672 6f6d 206d 6173 6b2e 2043 6175 7365  from mask. Cause
-00008630: 7320 7365 6c66 2e69 6d61 6765 2074 6f20  s self.image to 
-00008640: 6265 200a 2020 2020 2020 2020 2020 2020  be .            
-00008650: 7265 706c 6163 6564 2077 6974 6820 6120  replaced with a 
-00008660: 626c 616e 6b20 6475 6d6d 7920 696d 6167  blank dummy imag
-00008670: 6520 6f66 2074 6869 7320 7368 6170 652e  e of this shape.
-00008680: 0a20 2020 2020 2020 2022 2222 0a0a 2020  .        """..  
-00008690: 2020 2020 2020 6966 2073 656c 662e 6c6f        if self.lo
-000086a0: 6164 6564 5f6d 6173 6b20 616e 6420 6e6f  aded_mask and no
-000086b0: 7420 666f 7263 653a 0a20 2020 2020 2020  t force:.       
-000086c0: 2020 2020 2072 6574 7572 6e0a 0a20 2020       return..   
-000086d0: 2020 2020 2069 6620 6e6f 7420 7365 6c66       if not self
-000086e0: 2e6c 6f61 6465 643a 0a20 2020 2020 2020  .loaded:.       
-000086f0: 2020 2020 2073 656c 662e 6c6f 6164 2829       self.load()
-00008700: 0a20 2020 2020 2020 2069 6620 6f76 6572  .        if over
-00008710: 6c61 705f 6c65 7665 6c20 6973 206e 6f74  lap_level is not
-00008720: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-00008730: 2020 2073 656c 662e 6f76 6572 6c61 705f     self.overlap_
-00008740: 6c65 7665 6c20 3d20 6f76 6572 6c61 705f  level = overlap_
-00008750: 6c65 7665 6c0a 0a20 2020 2020 2020 2023  level..        #
-00008760: 2053 6574 2069 6d61 6765 2074 6f20 6475   Set image to du
-00008770: 6d6d 7920 696d 6167 6520 6966 206e 6565  mmy image if nee
-00008780: 6465 640a 2020 2020 2020 2020 6966 2028  ded.        if (
-00008790: 666f 7263 6520 616e 6420 2873 6861 7065  force and (shape
-000087a0: 2069 7320 6e6f 7420 4e6f 6e65 206f 7220   is not None or 
-000087b0: 766f 7865 6c5f 7369 7a65 2069 7320 6e6f  voxel_size is no
-000087c0: 7420 4e6f 6e65 2929 205c 0a20 2020 2020  t None)) \.     
-000087d0: 2020 2020 2020 6f72 2028 7365 6c66 2e63        or (self.c
-000087e0: 6f6e 746f 7572 735f 6f6e 6c79 2061 6e64  ontours_only and
-000087f0: 2073 656c 662e 696d 6167 6520 6973 204e   self.image is N
-00008800: 6f6e 6529 3a0a 2020 2020 2020 2020 2020  one):.          
-00008810: 2020 7365 6c66 2e73 6574 5f69 6d61 6765    self.set_image
-00008820: 5f74 6f5f 6475 6d6d 7928 7368 6170 653d  _to_dummy(shape=
-00008830: 7368 6170 652c 2076 6f78 656c 5f73 697a  shape, voxel_siz
-00008840: 653d 766f 7865 6c5f 7369 7a65 290a 0a20  e=voxel_size).. 
-00008850: 2020 2020 2020 2023 2043 7265 6174 6520         # Create 
-00008860: 6d61 736b 2066 726f 6d20 696e 7075 7420  mask from input 
-00008870: 782d 7920 636f 6e74 6f75 7273 200a 2020  x-y contours .  
-00008880: 2020 2020 2020 6966 2073 656c 662e 696e        if self.in
-00008890: 7075 745f 636f 6e74 6f75 7273 3a0a 0a20  put_contours:.. 
-000088a0: 2020 2020 2020 2020 2020 2023 2049 6e69             # Ini
-000088b0: 7469 616c 6973 6520 7365 6c66 2e6d 6173  tialise self.mas
-000088c0: 6b20 6173 2069 6d61 6765 0a20 2020 2020  k as image.     
-000088d0: 2020 2020 2020 2073 656c 662e 6d61 736b         self.mask
-000088e0: 203d 2073 6b72 742e 696d 6167 652e 496d   = skrt.image.Im
-000088f0: 6167 6528 0a20 2020 2020 2020 2020 2020  age(.           
-00008900: 2020 2020 206e 702e 7a65 726f 7328 2873       np.zeros((s
-00008910: 656c 662e 7368 6170 655b 315d 2c20 7365  elf.shape[1], se
-00008920: 6c66 2e73 6861 7065 5b30 5d2c 2073 656c  lf.shape[0], sel
-00008930: 662e 7368 6170 655b 325d 292c 0a20 2020  f.shape[2]),.   
-00008940: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008950: 2064 7479 7065 3d62 6f6f 6c29 2c0a 2020   dtype=bool),.  
-00008960: 2020 2020 2020 2020 2020 2020 2020 6166                af
-00008970: 6669 6e65 3d73 656c 662e 6166 6669 6e65  fine=self.affine
-00008980: 2c20 0a20 2020 2020 2020 2020 2020 2020  , .             
-00008990: 2020 2076 6f78 656c 5f73 697a 653d 7365     voxel_size=se
-000089a0: 6c66 2e76 6f78 656c 5f73 697a 652c 0a20  lf.voxel_size,. 
-000089b0: 2020 2020 2020 2020 2020 2020 2020 206f                 o
-000089c0: 7269 6769 6e3d 7365 6c66 2e6f 7269 6769  rigin=self.origi
-000089d0: 6e0a 2020 2020 2020 2020 2020 2020 290a  n.            ).
-000089e0: 0a20 2020 2020 2020 2020 2020 2023 2043  .            # C
-000089f0: 7265 6174 6520 6d61 736b 206f 6e20 6561  reate mask on ea
-00008a00: 6368 207a 206c 6179 6572 0a20 2020 2020  ch z layer.     
-00008a10: 2020 2020 2020 2066 6f72 207a 2c20 636f         for z, co
-00008a20: 6e74 6f75 7273 2069 6e20 7365 6c66 2e69  ntours in self.i
-00008a30: 6e70 7574 5f63 6f6e 746f 7572 732e 6974  nput_contours.it
-00008a40: 656d 7328 293a 0a0a 2020 2020 2020 2020  ems():..        
-00008a50: 2020 2020 2020 2020 2320 4c6f 6f70 206f          # Loop o
-00008a60: 7665 7220 6561 6368 2063 6f6e 746f 7572  ver each contour
-00008a70: 206f 6e20 7468 6520 7a20 736c 6963 650a   on the z slice.
-00008a80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008a90: 697a 203d 2069 6e74 2873 656c 662e 706f  iz = int(self.po
-00008aa0: 735f 746f 5f69 6478 287a 2c20 227a 2229  s_to_idx(z, "z")
-00008ab0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00008ac0: 2020 6966 2069 7a20 3e3d 2073 656c 662e    if iz >= self.
-00008ad0: 6d61 736b 2e64 6174 612e 7368 6170 655b  mask.data.shape[
-00008ae0: 325d 3a20 2023 2049 676e 6f72 6520 736c  2]:  # Ignore sl
-00008af0: 6963 6573 206f 7574 7369 6465 206d 6173  ices outside mas
-00008b00: 6b20 7261 6e67 650a 2020 2020 2020 2020  k range.        
-00008b10: 2020 2020 2020 2020 2020 2020 636f 6e74              cont
-00008b20: 696e 7565 0a0a 2020 2020 2020 2020 2020  inue..          
-00008b30: 2020 2020 2020 706f 735f 746f 5f69 6478        pos_to_idx
-00008b40: 5f76 6563 203d 206e 702e 7665 6374 6f72  _vec = np.vector
-00008b50: 697a 6528 7365 6c66 2e70 6f73 5f74 6f5f  ize(self.pos_to_
-00008b60: 6964 7829 0a20 2020 2020 2020 2020 2020  idx).           
-00008b70: 2020 2020 2066 6f72 2070 6f69 6e74 7320       for points 
-00008b80: 696e 2063 6f6e 746f 7572 733a 0a0a 2020  in contours:..  
-00008b90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008ba0: 2020 2320 5265 7175 6972 6520 6174 206c    # Require at l
-00008bb0: 6561 7374 2033 2070 6f69 6e74 7320 746f  east 3 points to
-00008bc0: 2064 6566 696e 6520 6120 706f 6c79 676f   define a polygo
-00008bd0: 6e2e 0a20 2020 2020 2020 2020 2020 2020  n..             
-00008be0: 2020 2020 2020 2069 6620 6c65 6e28 706f         if len(po
-00008bf0: 696e 7473 2920 3c20 333a 0a20 2020 2020  ints) < 3:.     
-00008c00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008c10: 2020 2063 6f6e 7469 6e75 650a 0a20 2020     continue..   
-00008c20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008c30: 2023 2043 6f6e 7665 7274 2028 782c 2079   # Convert (x, y
-00008c40: 2920 706f 7369 7469 6f6e 7320 746f 2061  ) positions to a
-00008c50: 7272 6179 2069 6e64 6963 6573 0a20 2020  rray indices.   
+000027a0: 203d 206e 616d 650a 2020 2020 2020 2020   = name.        
+000027b0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+000027c0: 2020 2020 2020 2020 2020 7365 6c66 2e6e            self.n
+000027d0: 616d 6520 3d20 524f 4944 6566 6175 6c74  ame = ROIDefault
+000027e0: 7328 292e 6765 745f 6465 6661 756c 745f  s().get_default_
+000027f0: 726f 695f 6e61 6d65 2829 0a20 2020 2020  roi_name().     
+00002800: 2020 2073 656c 662e 6f72 6967 696e 616c     self.original
+00002810: 5f6e 616d 6520 3d20 6e61 6d65 0a20 2020  _name = name.   
+00002820: 2020 2020 2073 656c 662e 7469 746c 6520       self.title 
+00002830: 3d20 4e6f 6e65 0a0a 2020 2020 2020 2020  = None..        
+00002840: 2320 524f 4920 6e75 6d62 6572 2061 7320  # ROI number as 
+00002850: 6465 6669 6e65 6420 696e 2044 4943 4f4d  defined in DICOM
+00002860: 2052 5453 5452 5543 5420 6669 6c65 2e0a   RTSTRUCT file..
+00002870: 2020 2020 2020 2020 2320 4c65 6674 2074          # Left t
+00002880: 6f20 4e6f 6e65 2066 6f72 2052 4f49 206c  o None for ROI l
+00002890: 6f61 6465 6420 6672 6f6d 206e 6f6e 2d44  oaded from non-D
+000028a0: 4943 4f4d 2073 6f75 7263 652e 0a20 2020  ICOM source..   
+000028b0: 2020 2020 2073 656c 662e 6e75 6d62 6572       self.number
+000028c0: 203d 204e 6f6e 650a 0a20 2020 2020 2020   = None..       
+000028d0: 2023 204c 6f61 6420 524f 4920 6461 7461   # Load ROI data
+000028e0: 0a20 2020 2020 2020 2073 656c 662e 6c6f  .        self.lo
+000028f0: 6164 6564 203d 2046 616c 7365 0a20 2020  aded = False.   
+00002900: 2020 2020 2073 656c 662e 6c6f 6164 6564       self.loaded
+00002910: 5f6d 6173 6b20 3d20 4661 6c73 650a 2020  _mask = False.  
+00002920: 2020 2020 2020 6966 206c 6f61 643a 0a20        if load:. 
+00002930: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00002940: 6c6f 6164 2829 0a0a 2020 2020 2020 2020  load()..        
+00002950: 2320 496e 6974 6961 6c69 7365 2061 7320  # Initialise as 
+00002960: 736b 7274 2e63 6f72 652e 4172 6368 6976  skrt.core.Archiv
+00002970: 6520 6f62 6a65 6374 0a20 2020 2020 2020  e object.       
+00002980: 2070 6174 6820 3d20 7365 6c66 2e73 6f75   path = self.sou
+00002990: 7263 6520 6966 2069 7369 6e73 7461 6e63  rce if isinstanc
+000029a0: 6528 7365 6c66 2e73 6f75 7263 652c 2073  e(self.source, s
+000029b0: 7472 2920 656c 7365 2022 220a 2020 2020  tr) else "".    
+000029c0: 2020 2020 736b 7274 2e63 6f72 652e 4172      skrt.core.Ar
+000029d0: 6368 6976 652e 5f5f 696e 6974 5f5f 2873  chive.__init__(s
+000029e0: 656c 662c 2070 6174 6829 0a0a 2020 2020  elf, path)..    
+000029f0: 6465 6620 5f5f 6571 5f5f 2873 656c 662c  def __eq__(self,
+00002a00: 206f 7468 6572 293a 0a20 2020 2020 2020   other):.       
+00002a10: 2072 6574 7572 6e20 6f74 6865 7220 6973   return other is
+00002a20: 2073 656c 660a 0a20 2020 2064 6566 206c   self..    def l
+00002a30: 6f61 6428 7365 6c66 2c20 666f 7263 653d  oad(self, force=
+00002a40: 4661 6c73 6529 3a0a 2020 2020 2020 2020  False):.        
+00002a50: 2222 224c 6f61 6420 524f 4920 6672 6f6d  """Load ROI from
+00002a60: 2066 696c 6520 6f72 2073 6f75 7263 652e   file or source.
+00002a70: 2054 6865 206c 6f61 6469 6e67 2073 6571   The loading seq
+00002a80: 7565 6e63 6520 6973 2061 7320 666f 6c6c  uence is as foll
+00002a90: 6f77 733a 0a0a 2020 2020 2020 2020 312e  ows:..        1.
+00002aa0: 2049 6620 7365 6c66 2e69 6d61 6765 2069   If self.image i
+00002ab0: 7320 6e6f 7420 4e6f 6e65 2c20 656e 7375  s not None, ensu
+00002ac0: 7265 2074 6861 7420 7468 6520 696d 6167  re that the imag
+00002ad0: 6520 6973 206c 6f61 6465 6420 616e 6420  e is loaded and 
+00002ae0: 0a20 2020 2020 2020 2061 7373 6967 6e20  .        assign 
+00002af0: 6974 7320 6765 6f6d 6574 7269 6320 7072  its geometric pr
+00002b00: 6f70 6572 7469 6573 2074 6f20 7468 6973  operties to this
+00002b10: 2052 4f49 2e0a 0a20 2020 2020 2020 2032   ROI...        2
+00002b20: 2e20 4174 7465 6d70 7420 746f 206c 6f61  . Attempt to loa
+00002b30: 6420 6461 7461 2066 726f 6d20 7365 6c66  d data from self
+00002b40: 2e73 6f75 7263 653a 0a0a 2020 2020 2020  .source:..      
+00002b50: 2020 2861 2920 4966 2074 6869 7320 6973    (a) If this is
+00002b60: 2061 6e20 496d 6167 6520 6f62 6a65 6374   an Image object
+00002b70: 2c20 7468 6520 524f 4920 7769 6c6c 2062  , the ROI will b
+00002b80: 6520 6372 6561 7465 6420 6279 2061 7070  e created by app
+00002b90: 6c79 696e 6720 6120 0a20 2020 2020 2020  lying a .       
+00002ba0: 2074 6872 6573 686f 6c64 2074 6f20 7468   threshold to th
+00002bb0: 6520 496d 6167 6527 7320 6172 7261 792e  e Image's array.
+00002bc0: 2053 6574 2073 656c 662e 6d61 736b 2074   Set self.mask t
+00002bd0: 6f20 7468 6520 7468 7265 7368 6f6c 6465  o the thresholde
+00002be0: 6420 696d 6167 650a 2020 2020 2020 2020  d image.        
+00002bf0: 616e 6420 7365 6c66 2e69 6e70 7574 5f74  and self.input_t
+00002c00: 7970 6520 3d20 226d 6173 6b22 2e0a 2020  ype = "mask"..  
+00002c10: 2020 2020 2020 2862 2920 4966 2073 656c        (b) If sel
+00002c20: 662e 736f 7572 6365 2069 7320 6120 7374  f.source is a st
+00002c30: 7269 6e67 2c20 6174 7465 6d70 7420 746f  ring, attempt to
+00002c40: 206c 6f61 6420 6672 6f6d 2061 2066 696c   load from a fil
+00002c50: 650a 2020 2020 2020 2020 636f 6e66 6f72  e.        confor
+00002c60: 6d69 6e67 2074 6f20 7472 616e 7366 6f72  ming to transfor
+00002c70: 6d69 7820 6f75 7470 7574 2028 2e74 7874  mix output (.txt
+00002c80: 2065 7874 656e 7369 6f6e 2920 6f72 2066   extension) or f
+00002c90: 726f 6d20 610a 2020 2020 2020 2020 6469  rom a.        di
+00002ca0: 636f 6d20 7374 7275 6374 7572 6520 7365  com structure se
+00002cb0: 7420 2869 6e20 626f 7468 2063 6173 6573  t (in both cases
+00002cc0: 2073 6574 7469 6e67 2073 656c 662e 696e   setting self.in
+00002cd0: 7075 745f 636f 6e74 6f75 7273 292e 0a20  put_contours).. 
+00002ce0: 2020 2020 2020 2028 6329 2049 6620 7472         (c) If tr
+00002cf0: 616e 7366 6f72 6d69 7820 6f72 2064 6963  ansformix or dic
+00002d00: 6f6d 206c 6f61 6469 6e67 2066 6169 6c73  om loading fails
+00002d10: 2c20 6174 7465 6d70 7420 746f 206c 6f61  , attempt to loa
+00002d20: 640a 2020 2020 2020 2020 7365 6c66 2e73  d.        self.s
+00002d30: 6f75 7263 6520 6173 2061 6e20 496d 6167  ource as an Imag
+00002d40: 6520 6f62 6a65 6374 2074 6f20 6372 6561  e object to crea
+00002d50: 7465 2061 6e20 524f 4920 6d61 736b 2e20  te an ROI mask. 
+00002d60: 4966 2074 6869 730a 2020 2020 2020 2020  If this.        
+00002d70: 6669 6e64 7320 6120 7661 6c69 6420 496d  finds a valid Im
+00002d80: 6167 652c 2073 6574 2073 656c 662e 6d61  age, set self.ma
+00002d90: 736b 2074 6f20 7468 6174 2069 6d61 6765  sk to that image
+00002da0: 2061 6e64 2073 6574 0a20 2020 2020 2020   and set.       
+00002db0: 2073 656c 662e 696e 7075 745f 7479 7065   self.input_type
+00002dc0: 203d 2022 6d61 736b 222e 0a20 2020 2020   = "mask"..     
+00002dd0: 2020 2028 6429 2049 6620 7365 6c66 2e73     (d) If self.s
+00002de0: 6f75 7263 6520 6973 204e 6f6e 652c 2064  ource is None, d
+00002df0: 6f20 6e6f 7468 696e 6720 7769 7468 2069  o nothing with i
+00002e00: 742e 0a0a 2020 2020 2020 2020 332e 2043  t...        3. C
+00002e10: 6865 636b 2077 6865 7468 6572 2073 656c  heck whether sel
+00002e20: 662e 696e 7075 745f 636f 6e74 6f75 7273  f.input_contours
+00002e30: 2063 6f6e 7461 696e 7320 6461 7461 2e20   contains data. 
+00002e40: 5468 6973 2063 6f75 6c64 2061 7269 7365  This could arise
+00002e50: 0a20 2020 2020 2020 2069 6e20 7477 6f20  .        in two 
+00002e60: 7363 656e 6172 696f 733a 0a20 2020 2020  scenarios:.     
+00002e70: 2020 200a 2020 2020 2020 2020 2861 2920     .        (a) 
+00002e80: 5468 6520 524f 4920 7761 7320 696e 6974  The ROI was init
+00002e90: 6961 6c69 7365 6420 6672 6f6d 2061 2064  ialised from a d
+00002ea0: 6963 7420 6f66 2063 6f6e 746f 7572 732c  ict of contours,
+00002eb0: 2077 6869 6368 2077 6572 650a 2020 2020   which were.    
+00002ec0: 2020 2020 6173 7369 676e 6564 2074 6f20      assigned to 
+00002ed0: 7365 6c66 2e69 6e70 7574 5f63 6f6e 746f  self.input_conto
+00002ee0: 7572 7320 696e 2073 656c 662e 5f5f 696e  urs in self.__in
+00002ef0: 6974 2829 3b20 6f72 0a20 2020 2020 2020  it(); or.       
+00002f00: 2028 6229 2041 2073 6574 206f 6620 636f   (b) A set of co
+00002f10: 6e74 6f75 7273 2077 6173 2073 7563 6365  ntours was succe
+00002f20: 7373 6675 6c6c 7920 6c6f 6164 6564 2066  ssfully loaded f
+00002f30: 726f 6d20 6120 7472 616e 7366 6f72 6d69  rom a transformi
+00002f40: 7820 6f72 0a20 2020 2020 2020 2064 6963  x or.        dic
+00002f50: 6f6d 2066 696c 6520 666f 756e 6420 6174  om file found at
+00002f60: 2073 656c 662e 736f 7572 6365 2069 6e20   self.source in 
+00002f70: 7374 6570 2031 2862 292e 0a0a 2020 2020  step 1(b)...    
+00002f80: 2020 2020 4966 2069 6e70 7574 2063 6f6e      If input con
+00002f90: 746f 7572 7320 6172 6520 666f 756e 642c  tours are found,
+00002fa0: 2074 6865 7365 2061 7265 2061 7373 6967   these are assig
+00002fb0: 6e65 6420 746f 2073 656c 662e 636f 6e74  ned to self.cont
+00002fc0: 6f75 7273 5b22 782d 7922 5d0a 2020 2020  ours["x-y"].    
+00002fd0: 2020 2020 616e 6420 7365 6c66 2e73 6f75      and self.sou
+00002fe0: 7263 655f 7479 7065 2069 7320 7365 7420  rce_type is set 
+00002ff0: 746f 2022 636f 6e74 6f75 7222 2e20 4164  to "contour". Ad
+00003000: 6469 7469 6f6e 616c 6c79 2c20 6966 2073  ditionally, if s
+00003010: 656c 662e 696d 6167 650a 2020 2020 2020  elf.image.      
+00003020: 2020 6973 206e 6f74 204e 6f6e 652c 2073    is not None, s
+00003030: 6574 2073 656c 662e 6d61 736b 2074 6f20  et self.mask to 
+00003040: 616e 2061 7272 6179 206f 6620 7a65 726f  an array of zero
+00003050: 7320 7468 6520 7361 6d65 2073 697a 6520  s the same size 
+00003060: 6173 2074 6865 200a 2020 2020 2020 2020  as the .        
+00003070: 696d 6167 652e 0a0a 2020 2020 2020 2020  image...        
+00003080: 342e 2053 6574 2061 2066 6c61 6720 696e  4. Set a flag in
+00003090: 6469 6361 7469 6e67 2077 6865 7468 6572  dicating whether
+000030a0: 2074 6869 7320 524f 4920 6861 7320 636f   this ROI has co
+000030b0: 6e74 6f75 7273 206f 6e6c 7920 2869 2e65  ntours only (i.e
+000030c0: 206e 6f0a 2020 2020 2020 2020 6d61 736b   no.        mask
+000030d0: 206f 7220 696d 6167 6520 6672 6f6d 2077   or image from w
+000030e0: 6869 6368 2074 6f20 6472 6177 206f 7269  hich to draw ori
+000030f0: 6769 6e2f 766f 7865 6c20 7369 7a65 7329  gin/voxel sizes)
+00003100: 2c20 616e 6420 7365 740a 2020 2020 2020  , and set.      
+00003110: 2020 6465 6661 756c 7420 6765 6f6d 6574    default geomet
+00003120: 7269 6320 6361 6c63 756c 6174 696f 6e20  ric calculation 
+00003130: 6d65 7468 6f64 2074 6f20 7365 6c66 2e73  method to self.s
+00003140: 6f75 7263 655f 7479 7065 2e20 5365 740a  ource_type. Set.
+00003150: 2020 2020 2020 2020 7365 6c66 2e6c 6f61          self.loa
+00003160: 6465 6420 746f 2054 7275 652e 0a20 2020  ded to True..   
+00003170: 2020 2020 2022 2222 0a0a 2020 2020 2020       """..      
+00003180: 2020 6966 2073 656c 662e 6c6f 6164 6564    if self.loaded
+00003190: 2061 6e64 206e 6f74 2066 6f72 6365 3a0a   and not force:.
+000031a0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+000031b0: 726e 0a0a 2020 2020 2020 2020 6966 2073  rn..        if s
+000031c0: 656c 662e 696d 6167 653a 0a20 2020 2020  elf.image:.     
+000031d0: 2020 2020 2020 2073 656c 662e 696d 6167         self.imag
+000031e0: 652e 6c6f 6164 2829 0a20 2020 2020 2020  e.load().       
+000031f0: 2020 2020 2073 656c 662e 7368 6170 6520       self.shape 
+00003200: 3d20 7365 6c66 2e69 6d61 6765 2e67 6574  = self.image.get
+00003210: 5f64 6174 6128 292e 7368 6170 650a 2020  _data().shape.  
+00003220: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
+00003230: 6666 696e 6520 3d20 7365 6c66 2e69 6d61  ffine = self.ima
+00003240: 6765 2e67 6574 5f61 6666 696e 6528 290a  ge.get_affine().
+00003250: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00003260: 2e76 6f78 656c 5f73 697a 6520 3d20 7365  .voxel_size = se
+00003270: 6c66 2e69 6d61 6765 2e67 6574 5f76 6f78  lf.image.get_vox
+00003280: 656c 5f73 697a 6528 290a 2020 2020 2020  el_size().      
+00003290: 2020 2020 2020 7365 6c66 2e6f 7269 6769        self.origi
+000032a0: 6e20 3d20 7365 6c66 2e69 6d61 6765 2e67  n = self.image.g
+000032b0: 6574 5f6f 7269 6769 6e28 290a 0a20 2020  et_origin()..   
+000032c0: 2020 2020 2072 6f69 7320 3d20 5b5d 0a0a       rois = []..
+000032d0: 2020 2020 2020 2020 2320 4c6f 6164 2066          # Load f
+000032e0: 726f 6d20 616e 2065 7869 7374 696e 6720  rom an existing 
+000032f0: 496d 6167 650a 2020 2020 2020 2020 6966  Image.        if
+00003300: 2069 7373 7562 636c 6173 7328 7479 7065   issubclass(type
+00003310: 2873 656c 662e 736f 7572 6365 292c 2073  (self.source), s
+00003320: 6b72 742e 696d 6167 652e 496d 6167 6529  krt.image.Image)
+00003330: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
+00003340: 206e 6f74 2073 656c 662e 696d 6167 653a   not self.image:
+00003350: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00003360: 2073 656c 662e 696d 6167 6520 3d20 7365   self.image = se
+00003370: 6c66 2e73 6f75 7263 650a 2020 2020 2020  lf.source.      
+00003380: 2020 2020 2020 7365 6c66 2e6d 6173 6b20        self.mask 
+00003390: 3d20 736b 7274 2e69 6d61 6765 2e49 6d61  = skrt.image.Ima
+000033a0: 6765 280a 2020 2020 2020 2020 2020 2020  ge(.            
+000033b0: 2020 2020 7365 6c66 2e73 6f75 7263 652e      self.source.
+000033c0: 6765 745f 6461 7461 2829 203e 2073 656c  get_data() > sel
+000033d0: 662e 6d61 736b 5f74 6872 6573 686f 6c64  f.mask_threshold
+000033e0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+000033f0: 2020 6166 6669 6e65 3d73 656c 662e 736f    affine=self.so
+00003400: 7572 6365 2e67 6574 5f61 6666 696e 6528  urce.get_affine(
+00003410: 292c 0a20 2020 2020 2020 2020 2020 2020  ),.             
+00003420: 2020 2064 7479 7065 3d62 6f6f 6c0a 2020     dtype=bool.  
+00003430: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+00003440: 2020 2020 2020 2020 7365 6c66 2e73 6f75          self.sou
+00003450: 7263 655f 7479 7065 203d 2022 6d61 736b  rce_type = "mask
+00003460: 220a 2020 2020 2020 2020 2020 2020 7365  ".            se
+00003470: 6c66 2e6c 6f61 6465 6420 3d20 5472 7565  lf.loaded = True
+00003480: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00003490: 662e 6372 6561 7465 5f6d 6173 6b28 290a  f.create_mask().
+000034a0: 0a20 2020 2020 2020 2065 6c69 6620 6973  .        elif is
+000034b0: 696e 7374 616e 6365 2873 656c 662e 736f  instance(self.so
+000034c0: 7572 6365 2c20 7374 7229 3a0a 2020 2020  urce, str):.    
+000034d0: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+000034e0: 736f 7572 6365 2e65 6e64 7377 6974 6828  source.endswith(
+000034f0: 272e 7478 7427 293a 0a20 2020 2020 2020  '.txt'):.       
+00003500: 2020 2020 2020 2020 2023 2054 7279 206c           # Try l
+00003510: 6f61 6469 6e67 2066 726f 6d20 7472 616e  oading from tran
+00003520: 7366 6f72 6d69 782d 636f 6d70 6174 6962  sformix-compatib
+00003530: 6c65 2070 6f69 6e74 2063 6c6f 7564 0a20  le point cloud. 
+00003540: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+00003550: 6f69 6e74 7320 3d20 7365 6c66 2e6c 6f61  oints = self.loa
+00003560: 645f 7472 616e 7366 6f72 6d69 785f 706f  d_transformix_po
+00003570: 696e 7473 2829 0a0a 2020 2020 2020 2020  ints()..        
+00003580: 2020 2020 2020 2020 2320 4578 7472 6163          # Extrac
+00003590: 7420 736c 6963 652d 6279 2d73 6c69 6365  t slice-by-slice
+000035a0: 2064 6963 7469 6f6e 6172 7920 6f66 2028   dictionary of (
+000035b0: 782c 2079 2920 706f 696e 7473 0a20 2020  x, y) points.   
+000035c0: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
+000035d0: 746f 7572 7320 3d20 7b7d 0a20 2020 2020  tours = {}.     
+000035e0: 2020 2020 2020 2020 2020 2066 6f72 2070             for p
+000035f0: 6f69 6e74 2069 6e20 736f 7274 6564 2870  oint in sorted(p
+00003600: 6f69 6e74 7329 3a0a 2020 2020 2020 2020  oints):.        
+00003610: 2020 2020 2020 2020 2020 2020 785f 706f              x_po
+00003620: 696e 742c 2079 5f70 6f69 6e74 2c20 7a5f  int, y_point, z_
+00003630: 706f 696e 7420 3d20 706f 696e 7473 5b70  point = points[p
+00003640: 6f69 6e74 5d5b 274f 7574 7075 7450 6f69  oint]['OutputPoi
+00003650: 6e74 275d 0a20 2020 2020 2020 2020 2020  nt'].           
+00003660: 2020 2020 2020 2020 206b 6579 203d 2066           key = f
+00003670: 277b 7a5f 706f 696e 743a 2e32 667d 270a  '{z_point:.2f}'.
+00003680: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003690: 2020 2020 6966 206e 6f74 206b 6579 2069      if not key i
+000036a0: 6e20 636f 6e74 6f75 7273 3a0a 2020 2020  n contours:.    
+000036b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000036c0: 2020 2020 636f 6e74 6f75 7273 5b6b 6579      contours[key
+000036d0: 5d20 3d20 7b7d 0a20 2020 2020 2020 2020  ] = {}.         
+000036e0: 2020 2020 2020 2020 2020 2063 5f69 6e64             c_ind
+000036f0: 6578 203d 2070 6f69 6e74 735b 706f 696e  ex = points[poin
+00003700: 745d 5b27 436f 6e74 6f75 7249 6e64 6578  t]['ContourIndex
+00003710: 275d 0a20 2020 2020 2020 2020 2020 2020  '].             
+00003720: 2020 2020 2020 2069 6620 6e6f 7420 635f         if not c_
+00003730: 696e 6465 7820 696e 2063 6f6e 746f 7572  index in contour
+00003740: 735b 6b65 795d 3a0a 2020 2020 2020 2020  s[key]:.        
+00003750: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003760: 636f 6e74 6f75 7273 5b6b 6579 5d5b 635f  contours[key][c_
+00003770: 696e 6465 785d 203d 205b 5d0a 2020 2020  index] = [].    
+00003780: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003790: 636f 6e74 6f75 7273 5b6b 6579 5d5b 635f  contours[key][c_
+000037a0: 696e 6465 785d 2e61 7070 656e 6428 5b78  index].append([x
+000037b0: 5f70 6f69 6e74 2c20 795f 706f 696e 745d  _point, y_point]
+000037c0: 290a 0a20 2020 2020 2020 2020 2020 2020  )..             
+000037d0: 2020 2023 2053 746f 7265 2074 6865 206c     # Store the l
+000037e0: 6973 7420 6f66 2063 6f6e 746f 7572 732e  ist of contours.
+000037f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00003800: 2073 656c 662e 696e 7075 745f 636f 6e74   self.input_cont
+00003810: 6f75 7273 203d 207b 7d0a 2020 2020 2020  ours = {}.      
+00003820: 2020 2020 2020 2020 2020 666f 7220 6b65            for ke
+00003830: 7920 696e 2073 6f72 7465 6428 636f 6e74  y in sorted(cont
+00003840: 6f75 7273 293a 0a20 2020 2020 2020 2020  ours):.         
+00003850: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00003860: 696e 7075 745f 636f 6e74 6f75 7273 5b66  input_contours[f
+00003870: 6c6f 6174 286b 6579 295d 203d 205b 5d0a  loat(key)] = [].
+00003880: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003890: 2020 2020 666f 7220 635f 696e 6465 7820      for c_index 
+000038a0: 696e 2073 6f72 7465 6428 636f 6e74 6f75  in sorted(contou
+000038b0: 7273 5b6b 6579 5d29 3a0a 2020 2020 2020  rs[key]):.      
+000038c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000038d0: 2020 7365 6c66 2e69 6e70 7574 5f63 6f6e    self.input_con
+000038e0: 746f 7572 735b 666c 6f61 7428 6b65 7929  tours[float(key)
+000038f0: 5d2e 6170 7065 6e64 280a 2020 2020 2020  ].append(.      
+00003900: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003910: 2020 2020 2020 6e70 2e61 7272 6179 2863        np.array(c
+00003920: 6f6e 746f 7572 735b 6b65 795d 5b63 5f69  ontours[key][c_i
+00003930: 6e64 6578 5d29 290a 2020 2020 2020 2020  ndex])).        
+00003940: 2020 2020 2020 2020 726f 6973 2e61 7070          rois.app
+00003950: 656e 6428 7365 6c66 2e6e 616d 6529 0a0a  end(self.name)..
+00003960: 2020 2020 2020 2020 2020 2020 656c 6966              elif
+00003970: 206f 732e 7061 7468 2e69 7364 6972 2873   os.path.isdir(s
+00003980: 656c 662e 736f 7572 6365 2920 6f72 206e  elf.source) or n
+00003990: 6f74 2073 656c 662e 736f 7572 6365 2e65  ot self.source.e
+000039a0: 6e64 7377 6974 6828 272e 6e69 6927 293a  ndswith('.nii'):
+000039b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000039c0: 2023 2054 7279 206c 6f61 6469 6e67 2066   # Try loading f
+000039d0: 726f 6d20 6469 636f 6d20 7374 7275 6374  rom dicom struct
+000039e0: 7572 6520 7365 740a 2020 2020 2020 2020  ure set.        
+000039f0: 2020 2020 2020 2020 726f 6973 2c20 6473          rois, ds
+00003a00: 203d 206c 6f61 645f 726f 6973 5f64 6963   = load_rois_dic
+00003a10: 6f6d 2873 656c 662e 736f 7572 6365 2c20  om(self.source, 
+00003a20: 6e61 6d65 733d 7365 6c66 2e6e 616d 6529  names=self.name)
+00003a30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00003a40: 2069 6620 6c65 6e28 726f 6973 293a 0a20   if len(rois):. 
+00003a50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003a60: 2020 206e 756d 6265 7220 3d20 6c69 7374     number = list
+00003a70: 2872 6f69 732e 6b65 7973 2829 295b 305d  (rois.keys())[0]
+00003a80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00003a90: 2020 2020 2072 6f69 203d 2072 6f69 735b       roi = rois[
+00003aa0: 6e75 6d62 6572 5d0a 2020 2020 2020 2020  number].        
+00003ab0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00003ac0: 2e6e 616d 6520 3d20 726f 695b 226e 616d  .name = roi["nam
+00003ad0: 6522 5d0a 2020 2020 2020 2020 2020 2020  e"].            
+00003ae0: 2020 2020 2020 2020 7365 6c66 2e6e 756d          self.num
+00003af0: 6265 7220 3d20 6e75 6d62 6572 0a20 2020  ber = number.   
+00003b00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003b10: 2073 656c 662e 696e 7075 745f 636f 6e74   self.input_cont
+00003b20: 6f75 7273 203d 2072 6f69 5b22 636f 6e74  ours = roi["cont
+00003b30: 6f75 7273 225d 0a20 2020 2020 2020 2020  ours"].         
+00003b40: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
+00003b50: 7420 7365 6c66 2e63 7573 746f 6d5f 636f  t self.custom_co
+00003b60: 6c6f 723a 0a20 2020 2020 2020 2020 2020  lor:.           
+00003b70: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+00003b80: 662e 7365 745f 636f 6c6f 7228 726f 695b  f.set_color(roi[
+00003b90: 2263 6f6c 6f72 225d 290a 2020 2020 2020  "color"]).      
+00003ba0: 2020 2020 2020 2020 2020 2020 2020 7365                se
+00003bb0: 6c66 2e64 6963 6f6d 5f64 6174 6173 6574  lf.dicom_dataset
+00003bc0: 203d 2064 730a 0a20 2020 2020 2020 2023   = ds..        #
+00003bd0: 204c 6f61 6420 524f 4920 6d61 736b 0a20   Load ROI mask. 
+00003be0: 2020 2020 2020 2069 6620 6e6f 7420 7365         if not se
+00003bf0: 6c66 2e6c 6f61 6465 6420 616e 6420 6e6f  lf.loaded and no
+00003c00: 7420 6c65 6e28 726f 6973 2920 616e 6420  t len(rois) and 
+00003c10: 7365 6c66 2e73 6f75 7263 6520 6973 206e  self.source is n
+00003c20: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
+00003c30: 2020 2020 2073 656c 662e 6d61 736b 203d       self.mask =
+00003c40: 2073 6b72 742e 696d 6167 652e 496d 6167   skrt.image.Imag
+00003c50: 6528 0a20 2020 2020 2020 2020 2020 2020  e(.             
+00003c60: 2020 2073 656c 662e 736f 7572 6365 2c20     self.source, 
+00003c70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00003c80: 2061 6666 696e 653d 7365 6c66 2e61 6666   affine=self.aff
+00003c90: 696e 652c 200a 2020 2020 2020 2020 2020  ine, .          
+00003ca0: 2020 2020 2020 766f 7865 6c5f 7369 7a65        voxel_size
+00003cb0: 3d73 656c 662e 766f 7865 6c5f 7369 7a65  =self.voxel_size
+00003cc0: 2c20 0a20 2020 2020 2020 2020 2020 2020  , .             
+00003cd0: 2020 206f 7269 6769 6e3d 7365 6c66 2e6f     origin=self.o
+00003ce0: 7269 6769 6e2c 200a 2020 2020 2020 2020  rigin, .        
+00003cf0: 2020 2020 2020 2020 6474 7970 653d 626f          dtype=bo
+00003d00: 6f6c 2c0a 2020 2020 2020 2020 2020 2020  ol,.            
+00003d10: 2020 2020 2a2a 7365 6c66 2e6b 7761 7267      **self.kwarg
+00003d20: 730a 2020 2020 2020 2020 2020 2020 290a  s.            ).
+00003d30: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00003d40: 2e6c 6f61 6465 6420 3d20 5472 7565 0a20  .loaded = True. 
+00003d50: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00003d60: 736f 7572 6365 5f74 7970 6520 3d20 226d  source_type = "m
+00003d70: 6173 6b22 0a20 2020 2020 2020 2020 2020  ask".           
+00003d80: 2073 656c 662e 6372 6561 7465 5f6d 6173   self.create_mas
+00003d90: 6b28 290a 0a20 2020 2020 2020 2023 2044  k()..        # D
+00003da0: 6561 6c20 7769 7468 2069 6e70 7574 2063  eal with input c
+00003db0: 6f6e 746f 7572 730a 2020 2020 2020 2020  ontours.        
+00003dc0: 6966 2073 656c 662e 696e 7075 745f 636f  if self.input_co
+00003dd0: 6e74 6f75 7273 2069 7320 6e6f 7420 4e6f  ntours is not No
+00003de0: 6e65 3a0a 0a20 2020 2020 2020 2020 2020  ne:..           
+00003df0: 2023 2043 7265 6174 6520 496d 6167 6520   # Create Image 
+00003e00: 6f62 6a65 6374 0a20 2020 2020 2020 2020  object.         
+00003e10: 2020 2069 6620 7365 6c66 2e69 6d61 6765     if self.image
+00003e20: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
+00003e30: 2020 2020 2020 2020 2020 2020 2020 7365                se
+00003e40: 6c66 2e73 6861 7065 203d 2073 656c 662e  lf.shape = self.
+00003e50: 696d 6167 652e 6461 7461 2e73 6861 7065  image.data.shape
+00003e60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00003e70: 2073 656c 662e 6d61 736b 203d 2073 6b72   self.mask = skr
+00003e80: 742e 696d 6167 652e 496d 6167 6528 0a20  t.image.Image(. 
+00003e90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003ea0: 2020 206e 702e 7a65 726f 7328 7365 6c66     np.zeros(self
+00003eb0: 2e73 6861 7065 292c 200a 2020 2020 2020  .shape), .      
+00003ec0: 2020 2020 2020 2020 2020 2020 2020 6166                af
+00003ed0: 6669 6e65 3d73 656c 662e 696d 6167 652e  fine=self.image.
+00003ee0: 6765 745f 6166 6669 6e65 2829 2c20 0a20  get_affine(), . 
+00003ef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003f00: 2020 2064 7479 7065 3d62 6f6f 6c2c 0a20     dtype=bool,. 
+00003f10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003f20: 2020 202a 2a73 656c 662e 6b77 6172 6773     **self.kwargs
+00003f30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00003f40: 2029 0a0a 2020 2020 2020 2020 2020 2020   )..            
+00003f50: 2320 5365 7420 782d 7920 636f 6e74 6f75  # Set x-y contou
+00003f60: 7273 2077 6974 6820 7a20 706f 7369 7469  rs with z positi
+00003f70: 6f6e 7320 6173 206b 6579 730a 2020 2020  ons as keys.    
+00003f80: 2020 2020 2020 2020 7365 6c66 2e63 6f6e          self.con
+00003f90: 746f 7572 735b 2278 2d79 225d 203d 207b  tours["x-y"] = {
+00003fa0: 7d0a 2020 2020 2020 2020 2020 2020 666f  }.            fo
+00003fb0: 7220 7a2c 2063 6f6e 746f 7572 7320 696e  r z, contours in
+00003fc0: 2073 656c 662e 696e 7075 745f 636f 6e74   self.input_cont
+00003fd0: 6f75 7273 2e69 7465 6d73 2829 3a0a 2020  ours.items():.  
+00003fe0: 2020 2020 2020 2020 2020 2020 2020 7365                se
+00003ff0: 6c66 2e63 6f6e 746f 7572 735b 2278 2d79  lf.contours["x-y
+00004000: 225d 5b7a 5d20 3d20 5b63 6f6e 746f 7572  "][z] = [contour
+00004010: 5b3a 2c20 3a32 5d20 666f 7220 636f 6e74  [:, :2] for cont
+00004020: 6f75 7220 696e 2063 6f6e 746f 7572 735d  our in contours]
+00004030: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00004040: 662e 736f 7572 6365 5f74 7970 6520 3d20  f.source_type = 
+00004050: 2263 6f6e 746f 7572 220a 2020 2020 2020  "contour".      
+00004060: 2020 2020 2020 7365 6c66 2e6c 6f61 6465        self.loade
+00004070: 6420 3d20 5472 7565 0a0a 2020 2020 2020  d = True..      
+00004080: 2020 2320 5374 6f72 6520 666c 6167 2066    # Store flag f
+00004090: 6f72 2063 6173 6573 2077 6974 6820 6e6f  or cases with no
+000040a0: 2061 7373 6f63 6961 7465 6420 696d 6167   associated imag
+000040b0: 6520 6f72 2067 656f 6d65 7472 6963 2069  e or geometric i
+000040c0: 6e66 6f0a 2020 2020 2020 2020 6861 735f  nfo.        has_
+000040d0: 696d 6167 6520 3d20 7365 6c66 2e69 6d61  image = self.ima
+000040e0: 6765 2069 7320 6e6f 7420 4e6f 6e65 0a20  ge is not None. 
+000040f0: 2020 2020 2020 2068 6173 5f67 656f 6d20         has_geom 
+00004100: 3d20 7365 6c66 2e73 6861 7065 2069 7320  = self.shape is 
+00004110: 6e6f 7420 4e6f 6e65 2061 6e64 2028 0a20  not None and (. 
+00004120: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00004130: 6166 6669 6e65 2069 7320 6e6f 7420 4e6f  affine is not No
+00004140: 6e65 206f 7220 280a 2020 2020 2020 2020  ne or (.        
+00004150: 2020 2020 2020 2020 7365 6c66 2e76 6f78          self.vox
+00004160: 656c 5f73 697a 6520 6973 206e 6f74 204e  el_size is not N
+00004170: 6f6e 6520 616e 6420 7365 6c66 2e6f 7269  one and self.ori
+00004180: 6769 6e20 6973 206e 6f74 204e 6f6e 650a  gin is not None.
+00004190: 2020 2020 2020 2020 2020 2020 2929 0a20              )). 
+000041a0: 2020 2020 2020 2073 656c 662e 636f 6e74         self.cont
+000041b0: 6f75 7273 5f6f 6e6c 7920 3d20 7365 6c66  ours_only = self
+000041c0: 2e73 6f75 7263 655f 7479 7065 203d 3d20  .source_type == 
+000041d0: 2263 6f6e 746f 7572 2220 5c0a 2020 2020  "contour" \.    
+000041e0: 2020 2020 2020 2020 2020 2020 616e 6420              and 
+000041f0: 6e6f 7420 6861 735f 696d 6167 6520 616e  not has_image an
+00004200: 6420 6e6f 7420 6861 735f 6765 6f6d 0a20  d not has_geom. 
+00004210: 2020 2020 2020 2069 6620 7365 6c66 2e64         if self.d
+00004220: 6566 6175 6c74 5f67 656f 6d5f 6d65 7468  efault_geom_meth
+00004230: 6f64 203d 3d20 2261 7574 6f22 3a0a 2020  od == "auto":.  
+00004240: 2020 2020 2020 2020 2020 7365 6c66 2e64            self.d
+00004250: 6566 6175 6c74 5f67 656f 6d5f 6d65 7468  efault_geom_meth
+00004260: 6f64 203d 2073 656c 662e 736f 7572 6365  od = self.source
+00004270: 5f74 7970 650a 0a20 2020 2020 2020 2023  _type..        #
+00004280: 2053 746f 7265 2066 6c61 6720 666f 7220   Store flag for 
+00004290: 656d 7074 696e 6573 730a 2020 2020 2020  emptiness.      
+000042a0: 2020 6966 2073 656c 662e 736f 7572 6365    if self.source
+000042b0: 5f74 7970 6520 3d3d 2022 636f 6e74 6f75  _type == "contou
+000042c0: 7222 3a0a 2020 2020 2020 2020 2020 2020  r":.            
+000042d0: 7365 6c66 2e65 6d70 7479 203d 206e 6f74  self.empty = not
+000042e0: 206c 656e 2873 656c 662e 696e 7075 745f   len(self.input_
+000042f0: 636f 6e74 6f75 7273 290a 2020 2020 2020  contours).      
+00004300: 2020 2020 2020 7365 6c66 2e73 6c69 6365        self.slice
+00004310: 5f74 6869 636b 6e65 7373 5f63 6f6e 746f  _thickness_conto
+00004320: 7572 7320 3d20 7365 6c66 2e67 6574 5f73  urs = self.get_s
+00004330: 6c69 6365 5f74 6869 636b 6e65 7373 5f63  lice_thickness_c
+00004340: 6f6e 746f 7572 7328 290a 2020 2020 2020  ontours().      
+00004350: 2020 656c 6966 2073 656c 662e 736f 7572    elif self.sour
+00004360: 6365 5f74 7970 6520 3d3d 2022 6d61 736b  ce_type == "mask
+00004370: 223a 0a20 2020 2020 2020 2020 2020 2073  ":.            s
+00004380: 656c 662e 656d 7074 7920 3d20 6e6f 7420  elf.empty = not 
+00004390: 6e70 2e61 6e79 2873 656c 662e 6d61 736b  np.any(self.mask
+000043a0: 2e67 6574 5f64 6174 6128 2929 0a20 2020  .get_data()).   
+000043b0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+000043c0: 2020 2020 2020 2073 656c 662e 656d 7074         self.empt
+000043d0: 7920 3d20 5472 7565 0a0a 2020 2020 2020  y = True..      
+000043e0: 2020 7365 6c66 2e6c 6f61 6465 6420 3d20    self.loaded = 
+000043f0: 5472 7565 0a0a 2020 2020 6465 6620 5f6c  True..    def _l
+00004400: 6f61 645f 6672 6f6d 5f66 696c 6528 7365  oad_from_file(se
+00004410: 6c66 2c20 6669 6c65 6e61 6d65 293a 0a20  lf, filename):. 
+00004420: 2020 2020 2020 2022 2222 4174 7465 6d70         """Attemp
+00004430: 7420 746f 206c 6f61 6420 524f 4920 6672  t to load ROI fr
+00004440: 6f6d 2061 2064 6963 6f6d 206f 7220 6e69  om a dicom or ni
+00004450: 6674 6920 6669 6c65 2e22 2222 0a0a 2020  fti file."""..  
+00004460: 2020 6465 6620 6c6f 6164 5f74 7261 6e73    def load_trans
+00004470: 666f 726d 6978 5f70 6f69 6e74 7328 7365  formix_points(se
+00004480: 6c66 293a 0a20 2020 2020 2020 2027 2727  lf):.        '''
+00004490: 0a20 2020 2020 2020 204c 6f61 6420 706f  .        Load po
+000044a0: 696e 7420 636f 6f72 6469 6e61 7465 7320  int coordinates 
+000044b0: 6672 6f6d 2066 696c 6520 6f66 2074 6865  from file of the
+000044c0: 2066 6f72 6d61 7420 7072 6f64 7563 6564   format produced
+000044d0: 2062 7920 5472 616e 7366 6f72 6d69 782e   by Transformix.
+000044e0: 0a20 2020 2020 2020 2027 2727 0a20 2020  .        '''.   
+000044f0: 2020 2020 2064 6566 2067 6574 5f63 6f6f       def get_coo
+00004500: 7264 696e 6174 6573 2869 6e5f 6461 7461  rdinates(in_data
+00004510: 3d27 2729 3a0a 2020 2020 2020 2020 2020  =''):.          
+00004520: 2020 2727 270a 2020 2020 2020 2020 2020    '''.          
+00004530: 2020 4865 6c70 6572 2066 756e 6374 696f    Helper functio
+00004540: 6e2c 2074 6f20 756e 7061 636b 2073 7472  n, to unpack str
+00004550: 696e 6720 6f66 2064 6174 6120 696e 746f  ing of data into
+00004560: 206c 6973 7420 6f66 2063 6f6f 7264 696e   list of coordin
+00004570: 6174 6573 2e20 0a20 2020 2020 2020 2020  ates. .         
+00004580: 2020 2027 2727 0a20 2020 2020 2020 2020     '''.         
+00004590: 2020 2063 6f6f 7264 696e 6174 6573 203d     coordinates =
+000045a0: 205b 6576 616c 2873 290a 2020 2020 2020   [eval(s).      
+000045b0: 2020 2020 2020 2020 2020 2020 2020 666f                fo
+000045c0: 7220 7320 696e 2072 652e 6669 6e64 616c  r s in re.findal
+000045d0: 6c28 7227 5b2d 5c64 5c2e 5d2b 272c 2069  l(r'[-\d\.]+', i
+000045e0: 6e5f 6461 7461 295d 0a20 2020 2020 2020  n_data)].       
+000045f0: 2020 2020 2072 6574 7572 6e20 636f 6f72       return coor
+00004600: 6469 6e61 7465 730a 0a20 2020 2020 2020  dinates..       
+00004610: 2023 2052 6561 6420 6669 6c65 2e0a 2020   # Read file..  
+00004620: 2020 2020 2020 7769 7468 206f 7065 6e28        with open(
+00004630: 7365 6c66 2e73 6f75 7263 652c 2027 7227  self.source, 'r'
+00004640: 2c20 656e 636f 6469 6e67 3d27 6173 6369  , encoding='asci
+00004650: 6927 2920 6173 2069 6e5f 6669 6c65 3a0a  i') as in_file:.
+00004660: 2020 2020 2020 2020 2020 2020 6461 7461              data
+00004670: 5f72 6f77 7320 3d20 696e 5f66 696c 652e  _rows = in_file.
+00004680: 7265 6164 6c69 6e65 7328 290a 0a20 2020  readlines()..   
+00004690: 2020 2020 2023 2045 7874 7261 6374 2070       # Extract p
+000046a0: 6f69 6e74 2064 6174 6120 746f 2064 6963  oint data to dic
+000046b0: 7469 6f6e 6172 792e 0a20 2020 2020 2020  tionary..       
+000046c0: 2070 6f69 6e74 7320 3d20 7b7d 0a20 2020   points = {}.   
+000046d0: 2020 2020 2066 6f72 2072 6f77 2069 6e20       for row in 
+000046e0: 6461 7461 5f72 6f77 733a 0a20 2020 2020  data_rows:.     
+000046f0: 2020 2020 2020 2070 6f69 6e74 2c20 696e         point, in
+00004700: 7075 745f 696e 6465 782c 2069 6e70 7574  put_index, input
+00004710: 5f70 6f69 6e74 2c20 6f75 7470 7574 5f69  _point, output_i
+00004720: 6e64 6578 5f66 6978 6564 2c20 5c0a 2020  ndex_fixed, \.  
+00004730: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004740: 2020 6f75 7470 7574 5f70 6f69 6e74 2c20    output_point, 
+00004750: 6465 666f 726d 6174 696f 6e20 3d20 726f  deformation = ro
+00004760: 772e 7370 6c69 7428 273b 2729 0a0a 2020  w.split(';')..  
+00004770: 2020 2020 2020 2020 2020 706f 696e 7420            point 
+00004780: 3d20 696e 7428 706f 696e 742e 7370 6c69  = int(point.spli
+00004790: 7428 295b 2d31 5d29 0a20 2020 2020 2020  t()[-1]).       
+000047a0: 2020 2020 2070 6f69 6e74 735b 706f 696e       points[poin
+000047b0: 745d 203d 207b 7d0a 2020 2020 2020 2020  t] = {}.        
+000047c0: 2020 2020 706f 696e 7473 5b70 6f69 6e74      points[point
+000047d0: 5d5b 2749 6e70 7574 496e 6465 7827 5d20  ]['InputIndex'] 
+000047e0: 3d20 6765 745f 636f 6f72 6469 6e61 7465  = get_coordinate
+000047f0: 7328 696e 7075 745f 696e 6465 7829 0a20  s(input_index). 
+00004800: 2020 2020 2020 2020 2020 2070 6f69 6e74             point
+00004810: 735b 706f 696e 745d 5b27 496e 7075 7450  s[point]['InputP
+00004820: 6f69 6e74 275d 203d 2067 6574 5f63 6f6f  oint'] = get_coo
+00004830: 7264 696e 6174 6573 2869 6e70 7574 5f70  rdinates(input_p
+00004840: 6f69 6e74 290a 2020 2020 2020 2020 2020  oint).          
+00004850: 2020 706f 696e 7473 5b70 6f69 6e74 5d5b    points[point][
+00004860: 274f 7574 7075 7449 6e64 6578 4669 7865  'OutputIndexFixe
+00004870: 6427 5d20 3d20 6765 745f 636f 6f72 6469  d'] = get_coordi
+00004880: 6e61 7465 7328 0a20 2020 2020 2020 2020  nates(.         
+00004890: 2020 2020 2020 2020 2020 206f 7574 7075             outpu
+000048a0: 745f 696e 6465 785f 6669 7865 6429 0a20  t_index_fixed). 
+000048b0: 2020 2020 2020 2020 2020 2070 6f69 6e74             point
+000048c0: 735b 706f 696e 745d 5b27 4f75 7470 7574  s[point]['Output
+000048d0: 506f 696e 7427 5d20 3d20 6765 745f 636f  Point'] = get_co
+000048e0: 6f72 6469 6e61 7465 7328 6f75 7470 7574  ordinates(output
+000048f0: 5f70 6f69 6e74 290a 2020 2020 2020 2020  _point).        
+00004900: 2020 2020 706f 696e 7473 5b70 6f69 6e74      points[point
+00004910: 5d5b 2744 6566 6f72 6d61 7469 6f6e 275d  ]['Deformation']
+00004920: 203d 2067 6574 5f63 6f6f 7264 696e 6174   = get_coordinat
+00004930: 6573 2864 6566 6f72 6d61 7469 6f6e 290a  es(deformation).
+00004940: 0a20 2020 2020 2020 2020 2020 2023 2049  .            # I
+00004950: 6620 7468 6520 5472 616e 7366 6f72 6d69  f the Transformi
+00004960: 7820 696e 7075 7420 7761 7320 7772 6974  x input was writ
+00004970: 7465 6e20 7573 696e 6720 524f 492e 7772  ten using ROI.wr
+00004980: 6974 6528 292c 0a20 2020 2020 2020 2020  ite(),.         
+00004990: 2020 2023 2061 2070 6f69 6e74 207a 2d63     # a point z-c
+000049a0: 6f6f 7264 696e 6174 6520 7769 6c6c 2068  oordinate will h
+000049b0: 6176 6520 7369 7820 6469 6769 7473 2061  ave six digits a
+000049c0: 6674 6572 2074 6865 2064 6563 696d 616c  fter the decimal
+000049d0: 0a20 2020 2020 2020 2020 2020 2023 2070  .            # p
+000049e0: 6f69 6e74 2c20 7769 7468 2074 6865 2063  oint, with the c
+000049f0: 6f6e 746f 7572 2069 6e64 6578 2069 6e20  ontour index in 
+00004a00: 7468 6520 6c61 7374 2074 6872 6565 2e0a  the last three..
+00004a10: 2020 2020 2020 2020 2020 2020 2320 2849              # (I
+00004a20: 6e70 7574 2070 6f69 6e74 7320 6172 6520  nput points are 
+00004a30: 7772 6974 7465 6e20 746f 2074 6865 2054  written to the T
+00004a40: 7261 6e73 666f 726d 6978 206f 7574 7075  ransformix outpu
+00004a50: 740a 2020 2020 2020 2020 2020 2020 2320  t.            # 
+00004a60: 7769 7468 2073 6978 2064 6967 6974 7320  with six digits 
+00004a70: 6166 7465 7220 7468 6520 6465 6369 6d61  after the decima
+00004a80: 6c20 706f 696e 7420 666f 7220 616c 6c20  l point for all 
+00004a90: 636f 6f72 6469 6e61 7465 732e 290a 2020  coordinates.).  
+00004aa0: 2020 2020 2020 2020 2020 7a64 5f69 6e20            zd_in 
+00004ab0: 3d20 7265 2e66 696e 6461 6c6c 2872 275b  = re.findall(r'[
+00004ac0: 2d5c 645c 2e5d 2b27 2c20 696e 7075 745f  -\d\.]+', input_
+00004ad0: 706f 696e 7429 5b2d 315d 2e72 7370 6c69  point)[-1].rspli
+00004ae0: 7428 222e 222c 2031 295b 2d31 5d0a 2020  t(".", 1)[-1].  
+00004af0: 2020 2020 2020 2020 2020 6966 206c 656e            if len
+00004b00: 287a 645f 696e 2920 3d3d 2036 3a0a 2020  (zd_in) == 6:.  
+00004b10: 2020 2020 2020 2020 2020 2020 2020 706f                po
+00004b20: 696e 7473 5b70 6f69 6e74 5d5b 2243 6f6e  ints[point]["Con
+00004b30: 746f 7572 496e 6465 7822 5d20 3d20 696e  tourIndex"] = in
+00004b40: 7428 7a64 5f69 6e5b 333a 5d29 0a20 2020  t(zd_in[3:]).   
+00004b50: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+00004b60: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+00004b70: 6f69 6e74 735b 706f 696e 745d 5b22 436f  oints[point]["Co
+00004b80: 6e74 6f75 7249 6e64 6578 225d 203d 2030  ntourIndex"] = 0
+00004b90: 0a0a 2020 2020 2020 2020 2320 4166 7465  ..        # Afte
+00004ba0: 7220 6170 706c 6963 6174 696f 6e20 6f66  r application of
+00004bb0: 2061 2072 6567 6973 7472 6174 696f 6e20   a registration 
+00004bc0: 7472 616e 7366 6f72 6d2c 2070 6f69 6e74  transform, point
+00004bd0: 7320 6f72 6967 696e 616c 6c79 0a20 2020  s originally.   
+00004be0: 2020 2020 2023 2069 6e20 7468 6520 7361       # in the sa
+00004bf0: 6d65 206d 6179 2065 6e64 2075 7020 7769  me may end up wi
+00004c00: 7468 2073 6c69 6768 746c 7920 6469 6666  th slightly diff
+00004c10: 6572 656e 7420 7a2d 636f 6f72 6469 6e61  erent z-coordina
+00004c20: 7465 732e 0a20 2020 2020 2020 2023 2046  tes..        # F
+00004c30: 6f72 206d 6f73 7420 7075 7270 6f73 6573  or most purposes
+00004c40: 2028 616e 6420 736c 6963 6520 7468 6963   (and slice thic
+00004c50: 6b6e 6573 7365 7329 2069 7427 7320 7072  knesses) it's pr
+00004c60: 6f62 6162 6c79 0a20 2020 2020 2020 2023  obably.        #
+00004c70: 2061 2072 6561 736f 6e61 626c 6520 6170   a reasonable ap
+00004c80: 7072 6f78 696d 6174 696f 6e20 746f 206d  proximation to m
+00004c90: 6170 2061 6c6c 2070 6f69 6e74 7320 746f  ap all points to
+00004ca0: 2074 6865 206d 6561 6e0a 2020 2020 2020   the mean.      
+00004cb0: 2020 2320 7a2d 636f 6f72 6469 6e61 7465    # z-coordinate
+00004cc0: 206f 6620 616c 6c20 706f 696e 7473 206f   of all points o
+00004cd0: 7269 6769 6e61 6c6c 7920 696e 2074 6865  riginally in the
+00004ce0: 2073 616d 6520 706c 616e 652e 0a20 2020   same plane..   
+00004cf0: 2020 2020 206b 6565 705f 6f72 6967 696e       keep_origin
+00004d00: 616c 5f70 6c61 6e65 7320 3d20 6765 7461  al_planes = geta
+00004d10: 7474 7228 7365 6c66 2c20 276b 6565 705f  ttr(self, 'keep_
+00004d20: 6f72 6967 696e 616c 5f70 6c61 6e65 7327  original_planes'
+00004d30: 2c20 5472 7565 290a 2020 2020 2020 2020  , True).        
+00004d40: 6966 206b 6565 705f 6f72 6967 696e 616c  if keep_original
+00004d50: 5f70 6c61 6e65 733a 0a20 2020 2020 2020  _planes:.       
+00004d60: 2020 2020 2023 2053 6f72 7420 706f 696e       # Sort poin
+00004d70: 7473 2062 7920 736c 6963 6520 7a2d 636f  ts by slice z-co
+00004d80: 6f72 6469 6e61 7465 2c0a 2020 2020 2020  ordinate,.      
+00004d90: 2020 2020 2020 2320 6b65 6570 696e 6720        # keeping 
+00004da0: 7265 6c61 7469 7665 206f 7264 6572 2077  relative order w
+00004db0: 6974 6869 6e20 6120 736c 6963 652e 0a20  ithin a slice.. 
+00004dc0: 2020 2020 2020 2020 2020 2073 6c69 6365             slice
+00004dd0: 7320 3d20 7b7d 0a20 2020 2020 2020 2020  s = {}.         
+00004de0: 2020 2066 6f72 2070 6f69 6e74 2069 6e20     for point in 
+00004df0: 736f 7274 6564 2870 6f69 6e74 7329 3a0a  sorted(points):.
+00004e00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004e10: 692c 206a 2c20 6b20 3d20 706f 696e 7473  i, j, k = points
+00004e20: 5b70 6f69 6e74 5d5b 2249 6e70 7574 496e  [point]["InputIn
+00004e30: 6465 7822 5d0a 2020 2020 2020 2020 2020  dex"].          
+00004e40: 2020 2020 2020 782c 2079 2c20 7a20 3d20        x, y, z = 
+00004e50: 706f 696e 7473 5b70 6f69 6e74 5d5b 224f  points[point]["O
+00004e60: 7574 7075 7450 6f69 6e74 225d 0a20 2020  utputPoint"].   
+00004e70: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00004e80: 6b20 6e6f 7420 696e 2073 6c69 6365 733a  k not in slices:
+00004e90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00004ea0: 2020 2020 2073 6c69 6365 735b 6b5d 203d       slices[k] =
+00004eb0: 207b 2770 6f69 6e74 7327 3a20 5b5d 2c20   {'points': [], 
+00004ec0: 277a 5f70 6f69 6e74 7327 3a20 5b5d 7d0a  'z_points': []}.
+00004ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004ee0: 736c 6963 6573 5b6b 5d5b 2270 6f69 6e74  slices[k]["point
+00004ef0: 7322 5d2e 6170 7065 6e64 2870 6f69 6e74  s"].append(point
+00004f00: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00004f10: 2020 736c 6963 6573 5b6b 5d5b 227a 5f70    slices[k]["z_p
+00004f20: 6f69 6e74 7322 5d2e 6170 7065 6e64 287a  oints"].append(z
+00004f30: 290a 0a20 2020 2020 2020 2020 2020 2023  )..            #
+00004f40: 2046 6f72 2070 6f69 6e74 7320 696e 2065   For points in e
+00004f50: 6163 6820 736c 6963 652c 2072 6573 6574  ach slice, reset
+00004f60: 207a 2d63 6f6f 7264 696e 6174 6573 2074   z-coordinates t
+00004f70: 6f20 6d65 616e 2076 616c 7565 2e0a 2020  o mean value..  
+00004f80: 2020 2020 2020 2020 2020 666f 7220 6b20            for k 
+00004f90: 696e 2073 6f72 7465 6428 736c 6963 6573  in sorted(slices
+00004fa0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+00004fb0: 2020 207a 5f6d 6561 6e20 3d20 6e70 2e6d     z_mean = np.m
+00004fc0: 6561 6e28 736c 6963 6573 5b6b 5d5b 227a  ean(slices[k]["z
+00004fd0: 5f70 6f69 6e74 7322 5d29 0a20 2020 2020  _points"]).     
+00004fe0: 2020 2020 2020 2020 2020 2066 6f72 2070             for p
+00004ff0: 6f69 6e74 2069 6e20 736c 6963 6573 5b6b  oint in slices[k
+00005000: 5d5b 2270 6f69 6e74 7322 5d3a 0a20 2020  ]["points"]:.   
+00005010: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005020: 2078 2c20 792c 207a 203d 2070 6f69 6e74   x, y, z = point
+00005030: 735b 706f 696e 745d 5b22 4f75 7470 7574  s[point]["Output
+00005040: 506f 696e 7422 5d0a 2020 2020 2020 2020  Point"].        
+00005050: 2020 2020 2020 2020 2020 2020 706f 696e              poin
+00005060: 7473 5b70 6f69 6e74 5d5b 224f 7574 7075  ts[point]["Outpu
+00005070: 7450 6f69 6e74 225d 203d 2028 782c 2079  tPoint"] = (x, y
+00005080: 2c20 7a5f 6d65 616e 290a 0a20 2020 2020  , z_mean)..     
+00005090: 2020 2072 6574 7572 6e20 706f 696e 7473     return points
+000050a0: 0a0a 2020 2020 6465 6620 636c 6f6e 655f  ..    def clone_
+000050b0: 6174 7472 7328 7365 6c66 2c20 6f62 6a2c  attrs(self, obj,
+000050c0: 2063 6f70 795f 6461 7461 3d54 7275 6529   copy_data=True)
+000050d0: 3a0a 2020 2020 2020 2020 2222 2241 7373  :.        """Ass
+000050e0: 6967 6e20 616c 6c20 6174 7472 6962 7574  ign all attribut
+000050f0: 6573 206f 6620 3c73 656c 663e 2074 6f20  es of <self> to 
+00005100: 616e 6f74 6865 7220 6f62 6a65 6374 2c20  another object, 
+00005110: 3c6f 626a 3e2c 2020 656e 7375 7269 6e67  <obj>,  ensuring
+00005120: 200a 2020 2020 2020 2020 7468 6174 206f   .        that o
+00005130: 776e 206d 6173 6b27 7320 6461 7461 2067  wn mask's data g
+00005140: 6574 7320 636f 7272 6563 746c 7920 636f  ets correctly co
+00005150: 7069 6564 2069 6620 3c63 6f70 795f 6461  pied if <copy_da
+00005160: 7461 3e20 6973 2054 7275 652e 2222 220a  ta> is True.""".
+00005170: 0a20 2020 2020 2020 2073 6b72 742e 636f  .        skrt.co
+00005180: 7265 2e44 6174 612e 636c 6f6e 655f 6174  re.Data.clone_at
+00005190: 7472 7328 7365 6c66 2c20 6f62 6a2c 2063  trs(self, obj, c
+000051a0: 6f70 795f 6461 7461 3d63 6f70 795f 6461  opy_data=copy_da
+000051b0: 7461 290a 2020 2020 2020 2020 6966 2063  ta).        if c
+000051c0: 6f70 795f 6461 7461 2061 6e64 2073 656c  opy_data and sel
+000051d0: 662e 6d61 736b 2069 7320 6e6f 7420 4e6f  f.mask is not No
+000051e0: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+000051f0: 6f62 6a2e 6d61 736b 203d 2073 656c 662e  obj.mask = self.
+00005200: 6d61 736b 2e63 6c6f 6e65 2863 6f70 795f  mask.clone(copy_
+00005210: 6461 7461 3d54 7275 6529 0a0a 2020 2020  data=True)..    
+00005220: 6465 6620 6765 745f 6469 636f 6d5f 6461  def get_dicom_da
+00005230: 7461 7365 7428 7365 6c66 293a 0a20 2020  taset(self):.   
+00005240: 2020 2020 2022 2222 5265 7475 726e 2070       """Return p
+00005250: 7964 6963 6f6d 2e64 6174 6173 6574 2e46  ydicom.dataset.F
+00005260: 696c 6544 6174 6173 6574 206f 626a 6563  ileDataset objec
+00005270: 7420 6173 736f 6369 6174 6564 2077 6974  t associated wit
+00005280: 6820 7468 6973 2052 4f49 0a20 2020 2020  h this ROI.     
+00005290: 2020 2069 6620 6c6f 6164 6564 2066 726f     if loaded fro
+000052a0: 6d20 6469 636f 6d3b 206f 7468 6572 7769  m dicom; otherwi
+000052b0: 7365 2c20 7265 7475 726e 204e 6f6e 652e  se, return None.
+000052c0: 2222 220a 0a20 2020 2020 2020 2073 656c  """..        sel
+000052d0: 662e 6c6f 6164 2829 0a20 2020 2020 2020  f.load().       
+000052e0: 2072 6574 7572 6e20 7365 6c66 2e64 6963   return self.dic
+000052f0: 6f6d 5f64 6174 6173 6574 0a0a 2020 2020  om_dataset..    
+00005300: 6465 6620 7265 7365 745f 636f 6e74 6f75  def reset_contou
+00005310: 7273 2873 656c 662c 2063 6f6e 746f 7572  rs(self, contour
+00005320: 733d 4e6f 6e65 2c20 6d6f 7374 5f70 6f69  s=None, most_poi
+00005330: 6e74 733d 4661 6c73 6529 3a0a 2020 2020  nts=False):.    
+00005340: 2020 2020 2222 2252 6573 6574 2078 2d79      """Reset x-y
+00005350: 2063 6f6e 746f 7572 7320 746f 2061 2067   contours to a g
+00005360: 6976 656e 2064 6963 7420 6f66 2073 6c69  iven dict of sli
+00005370: 6365 7320 616e 6420 636f 6e74 6f75 7220  ces and contour 
+00005380: 6c69 7374 732c 200a 2020 2020 2020 2020  lists, .        
+00005390: 616e 6420 656e 7375 7265 2074 6861 7420  and ensure that 
+000053a0: 6d61 736b 2061 6e64 2079 2d7a 2f78 2d7a  mask and y-z/x-z
+000053b0: 2063 6f6e 746f 7572 7320 7769 6c6c 2062   contours will b
+000053c0: 6520 7265 6372 6561 7465 642e 2049 6620  e recreated. If 
+000053d0: 0a20 2020 2020 2020 2063 6f6e 746f 7572  .        contour
+000053e0: 7320 6973 204e 6f6e 652c 2063 6f6e 746f  s is None, conto
+000053f0: 7572 7320 7769 6c6c 2062 6520 7265 7365  urs will be rese
+00005400: 7420 7573 696e 6720 6f77 6e20 782d 7920  t using own x-y 
+00005410: 636f 6e74 6f75 7273 2e0a 2020 2020 2020  contours..      
+00005420: 2020 4966 206d 6f73 745f 706f 696e 7473    If most_points
+00005430: 2069 7320 5472 7565 2c20 6f6e 6c79 2074   is True, only t
+00005440: 6865 2063 6f6e 746f 7572 2077 6974 6820  he contour with 
+00005450: 6d6f 7374 2070 6f69 6e74 7320 666f 720a  most points for.
+00005460: 2020 2020 2020 2020 6561 6368 2073 6c69          each sli
+00005470: 6365 2069 7320 636f 6e73 6964 6572 6564  ce is considered
+00005480: 2e22 2222 0a0a 2020 2020 2020 2020 2320  ."""..        # 
+00005490: 4368 6563 6b20 666f 726d 6174 2069 7320  Check format is 
+000054a0: 636f 7272 6563 740a 2020 2020 2020 2020  correct.        
+000054b0: 6966 2063 6f6e 746f 7572 7320 6973 204e  if contours is N
+000054c0: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+000054d0: 2063 6f6e 746f 7572 7320 3d20 7365 6c66   contours = self
+000054e0: 2e67 6574 5f63 6f6e 746f 7572 7328 290a  .get_contours().
+000054f0: 2020 2020 2020 2020 6966 206e 6f74 2069          if not i
+00005500: 7369 6e73 7461 6e63 6528 636f 6e74 6f75  sinstance(contou
+00005510: 7273 2c20 6469 6374 293a 0a20 2020 2020  rs, dict):.     
+00005520: 2020 2020 2020 2072 6169 7365 2054 7970         raise Typ
+00005530: 6545 7272 6f72 2822 636f 6e74 6f75 7273  eError("contours
+00005540: 2073 686f 756c 6420 6265 2061 2064 6963   should be a dic
+00005550: 7422 290a 2020 2020 2020 2020 666f 7220  t").        for 
+00005560: 7a2c 2063 2069 6e20 636f 6e74 6f75 7273  z, c in contours
+00005570: 2e69 7465 6d73 2829 3a0a 2020 2020 2020  .items():.      
+00005580: 2020 2020 2020 6966 206e 6f74 2069 7369        if not isi
+00005590: 6e73 7461 6e63 6528 632c 206c 6973 7429  nstance(c, list)
+000055a0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000055b0: 2020 7261 6973 6520 5479 7065 4572 726f    raise TypeErro
+000055c0: 7228 6622 636f 6e74 6f75 7273 5b7b 7a7d  r(f"contours[{z}
+000055d0: 5d20 7368 6f75 6c64 2062 6520 6120 6c69  ] should be a li
+000055e0: 7374 206f 6620 636f 6e74 6f75 7273 2022  st of contours "
+000055f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00005600: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005610: 2066 226f 6e20 736c 6963 6520 7b7a 7d22   f"on slice {z}"
+00005620: 290a 0a20 2020 2020 2020 2023 2046 6f72  )..        # For
+00005630: 2065 6163 6820 736c 6963 652c 206b 6565   each slice, kee
+00005640: 7020 6f6e 6c79 2063 6f6e 746f 7572 2077  p only contour w
+00005650: 6974 6820 6d6f 7374 2070 6f69 6e74 732e  ith most points.
+00005660: 0a20 2020 2020 2020 2069 6620 6d6f 7374  .        if most
+00005670: 5f70 6f69 6e74 733a 0a20 2020 2020 2020  _points:.       
+00005680: 2020 2020 2063 6f6e 746f 7572 7320 3d20       contours = 
+00005690: 7b6b 6579 3a20 5b6d 6178 2876 616c 7565  {key: [max(value
+000056a0: 2c20 6b65 793d 6c65 6e29 5d0a 2020 2020  , key=len)].    
+000056b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000056c0: 666f 7220 6b65 792c 2076 616c 7565 2069  for key, value i
+000056d0: 6e20 636f 6e74 6f75 7273 2e69 7465 6d73  n contours.items
+000056e0: 2829 7d0a 0a20 2020 2020 2020 2073 656c  ()}..        sel
+000056f0: 662e 696e 7075 745f 636f 6e74 6f75 7273  f.input_contours
+00005700: 203d 2063 6f6e 746f 7572 730a 2020 2020   = contours.    
+00005710: 2020 2020 7365 6c66 2e65 6d70 7479 203d      self.empty =
+00005720: 206e 6f74 206c 656e 2873 656c 662e 696e   not len(self.in
+00005730: 7075 745f 636f 6e74 6f75 7273 290a 2020  put_contours).  
+00005740: 2020 2020 2020 7365 6c66 2e63 6f6e 746f        self.conto
+00005750: 7572 7320 3d20 7b22 782d 7922 3a20 636f  urs = {"x-y": co
+00005760: 6e74 6f75 7273 7d0a 2020 2020 2020 2020  ntours}.        
+00005770: 7365 6c66 2e6c 6f61 6465 645f 6d61 736b  self.loaded_mask
+00005780: 203d 2046 616c 7365 0a20 2020 2020 2020   = False.       
+00005790: 2073 656c 662e 6d61 736b 203d 204e 6f6e   self.mask = Non
+000057a0: 650a 0a20 2020 2064 6566 2072 6573 6574  e..    def reset
+000057b0: 5f6d 6173 6b28 7365 6c66 2c20 6d61 736b  _mask(self, mask
+000057c0: 3d4e 6f6e 6529 3a0a 2020 2020 2020 2020  =None):.        
+000057d0: 2222 2253 6574 206d 6173 6b20 746f 2065  """Set mask to e
+000057e0: 6974 6865 7220 6120 6e75 6d70 7920 6172  ither a numpy ar
+000057f0: 7261 7920 6f72 2061 6e20 496d 6167 6520  ray or an Image 
+00005800: 6f62 6a65 6374 2c20 616e 6420 656e 7375  object, and ensu
+00005810: 7265 200a 2020 2020 2020 2020 7468 6174  re .        that
+00005820: 2063 6f6e 746f 7572 7320 7769 6c6c 2062   contours will b
+00005830: 6520 7265 6372 6561 7465 642e 2049 6620  e recreated. If 
+00005840: 6d61 736b 2069 7320 4e6f 6e65 2c20 636f  mask is None, co
+00005850: 6e74 6f75 7273 2077 696c 6c20 6265 200a  ntours will be .
+00005860: 2020 2020 2020 2020 7265 7365 7420 7573          reset us
+00005870: 696e 6720 6f77 6e20 6d61 736b 2e22 2222  ing own mask."""
+00005880: 0a0a 2020 2020 2020 2020 6966 2069 7369  ..        if isi
+00005890: 6e73 7461 6e63 6528 6d61 736b 2c20 736b  nstance(mask, sk
+000058a0: 7274 2e69 6d61 6765 2e49 6d61 6765 293a  rt.image.Image):
+000058b0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+000058c0: 662e 6d61 736b 203d 206d 6173 6b0a 2020  f.mask = mask.  
+000058d0: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
+000058e0: 6666 696e 6520 3d20 6d61 736b 2e67 6574  ffine = mask.get
+000058f0: 5f61 6666 696e 6528 290a 2020 2020 2020  _affine().      
+00005900: 2020 2020 2020 7365 6c66 2e76 6f78 656c        self.voxel
+00005910: 5f73 697a 6520 3d20 6d61 736b 2e67 6574  _size = mask.get
+00005920: 5f76 6f78 656c 5f73 697a 6528 290a 2020  _voxel_size().  
+00005930: 2020 2020 2020 2020 2020 7365 6c66 2e6f            self.o
+00005940: 7269 6769 6e20 3d20 6d61 736b 2e67 6574  rigin = mask.get
+00005950: 5f6f 7269 6769 6e28 290a 2020 2020 2020  _origin().      
+00005960: 2020 2020 2020 7365 6c66 2e73 6861 7065        self.shape
+00005970: 203d 206d 6173 6b2e 6765 745f 6461 7461   = mask.get_data
+00005980: 2829 2e73 6861 7065 0a0a 2020 2020 2020  ().shape..      
+00005990: 2020 656c 6966 2069 7369 6e73 7461 6e63    elif isinstanc
+000059a0: 6528 6d61 736b 2c20 6e70 2e6e 6461 7272  e(mask, np.ndarr
+000059b0: 6179 293a 0a20 2020 2020 2020 2020 2020  ay):.           
+000059c0: 2073 656c 662e 6d61 736b 203d 2073 6b72   self.mask = skr
+000059d0: 742e 696d 6167 652e 496d 6167 6528 0a20  t.image.Image(. 
+000059e0: 2020 2020 2020 2020 2020 2020 2020 206d                 m
+000059f0: 6173 6b2c 0a20 2020 2020 2020 2020 2020  ask,.           
+00005a00: 2020 2020 2061 6666 696e 6520 3d20 7365       affine = se
+00005a10: 6c66 2e61 6666 696e 652c 0a20 2020 2020  lf.affine,.     
+00005a20: 2020 2020 2020 2020 2020 2076 6f78 656c             voxel
+00005a30: 5f73 697a 653d 7365 6c66 2e76 6f78 656c  _size=self.voxel
+00005a40: 5f73 697a 652c 0a20 2020 2020 2020 2020  _size,.         
+00005a50: 2020 2020 2020 206f 7269 6769 6e3d 7365         origin=se
+00005a60: 6c66 2e6f 7269 6769 6e2c 0a20 2020 2020  lf.origin,.     
+00005a70: 2020 2020 2020 2020 2020 2064 7479 7065             dtype
+00005a80: 3d62 6f6f 6c0a 2020 2020 2020 2020 2020  =bool.          
+00005a90: 2020 290a 0a20 2020 2020 2020 2065 6c69    )..        eli
+00005aa0: 6620 6d61 736b 2069 7320 6e6f 7420 4e6f  f mask is not No
+00005ab0: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+00005ac0: 7261 6973 6520 5479 7065 4572 726f 7228  raise TypeError(
+00005ad0: 226d 6173 6b20 7368 6f75 6c64 2062 6520  "mask should be 
+00005ae0: 616e 2049 6d61 6765 206f 7220 6120 6e75  an Image or a nu
+00005af0: 6d70 7920 6172 7261 7922 290a 0a20 2020  mpy array")..   
+00005b00: 2020 2020 2073 656c 662e 6d61 736b 2e67       self.mask.g
+00005b10: 6574 5f73 7461 6e64 6172 6469 7365 645f  et_standardised_
+00005b20: 6461 7461 2866 6f72 6365 3d54 7275 6529  data(force=True)
+00005b30: 0a20 2020 2020 2020 2073 656c 662e 6c6f  .        self.lo
+00005b40: 6164 6564 5f6d 6173 6b20 3d20 5472 7565  aded_mask = True
+00005b50: 0a20 2020 2020 2020 2073 656c 662e 636f  .        self.co
+00005b60: 6e74 6f75 7273 203d 207b 7d0a 2020 2020  ntours = {}.    
+00005b70: 2020 2020 7365 6c66 2e65 6d70 7479 203d      self.empty =
+00005b80: 206e 6f74 206e 702e 616e 7928 7365 6c66   not np.any(self
+00005b90: 2e6d 6173 6b2e 6765 745f 6461 7461 2829  .mask.get_data()
+00005ba0: 290a 2020 2020 2020 2020 7365 6c66 2e69  ).        self.i
+00005bb0: 6e70 7574 5f63 6f6e 746f 7572 7320 3d20  nput_contours = 
+00005bc0: 4e6f 6e65 0a0a 2020 2020 6465 6620 6765  None..    def ge
+00005bd0: 745f 636f 6e74 6f75 7273 2873 656c 662c  t_contours(self,
+00005be0: 2076 6965 773d 2278 2d79 222c 2069 6478   view="x-y", idx
+00005bf0: 5f61 735f 6b65 793d 4661 6c73 652c 206d  _as_key=False, m
+00005c00: 6f73 745f 706f 696e 7473 3d46 616c 7365  ost_points=False
+00005c10: 293a 0a20 2020 2020 2020 2022 2222 0a20  ):.        """. 
+00005c20: 2020 2020 2020 2047 6574 2064 6963 7420         Get dict 
+00005c30: 6f66 2063 6f6e 746f 7572 7320 696e 2061  of contours in a
+00005c40: 2067 6976 656e 206f 7269 656e 7461 7469   given orientati
+00005c50: 6f6e 2e0a 0a20 2020 2020 2020 202a 2a50  on...        **P
+00005c60: 6172 616d 6574 6572 733a 2a2a 0a0a 2020  arameters:**..  
+00005c70: 2020 2020 2020 7669 6577 203a 2073 7472        view : str
+00005c80: 2c20 6465 6661 756c 743d 2278 2d79 220a  , default="x-y".
+00005c90: 2020 2020 2020 2020 2020 2020 5669 6577              View
+00005ca0: 2069 6e20 7768 6963 6820 746f 206f 6274   in which to obt
+00005cb0: 6169 6e20 636f 6e74 6f75 7273 2e0a 0a20  ain contours... 
+00005cc0: 2020 2020 2020 2069 6478 5f61 735f 6b65         idx_as_ke
+00005cd0: 7920 3a20 626f 6f6c 2c20 6465 6661 756c  y : bool, defaul
+00005ce0: 743d 4661 6c73 650a 2020 2020 2020 2020  t=False.        
+00005cf0: 2020 2020 4966 2054 7275 652c 2075 7365      If True, use
+00005d00: 2073 6c69 6365 2069 6e64 6963 6573 2061   slice indices a
+00005d10: 7320 6469 6374 696f 6e61 7279 206b 6579  s dictionary key
+00005d20: 733b 2069 6620 4661 6c73 652c 0a20 2020  s; if False,.   
+00005d30: 2020 2020 2020 2020 2075 7365 2073 6c69           use sli
+00005d40: 6365 207a 2d63 6f6f 7264 696e 6174 6573  ce z-coordinates
+00005d50: 2061 7320 6469 6374 696f 6e61 7279 206b   as dictionary k
+00005d60: 6579 732e 0a0a 2020 2020 2020 2020 6d6f  eys...        mo
+00005d70: 7374 5f70 6f69 6e74 7320 3a20 626f 6f6c  st_points : bool
+00005d80: 2c20 6465 6661 756c 743d 4661 6c73 650a  , default=False.
+00005d90: 2020 2020 2020 2020 2020 2020 4966 2054              If T
+00005da0: 7275 652c 2072 6574 7572 6e20 6f6e 6c79  rue, return only
+00005db0: 2074 6865 2063 6f6e 746f 7572 2077 6974   the contour wit
+00005dc0: 6820 6d6f 7374 2070 6f69 6e74 7320 666f  h most points fo
+00005dd0: 7220 6561 6368 2073 6c69 6365 3b0a 2020  r each slice;.  
+00005de0: 2020 2020 2020 2020 2020 6966 2046 616c            if Fal
+00005df0: 7365 2c20 7265 7475 726e 2061 6c6c 2063  se, return all c
+00005e00: 6f6e 746f 7572 7320 666f 7220 6561 6368  ontours for each
+00005e10: 2073 6c69 6365 2e0a 2020 2020 2020 2020   slice..        
+00005e20: 2222 220a 0a20 2020 2020 2020 2073 656c  """..        sel
+00005e30: 662e 6c6f 6164 2829 0a20 2020 2020 2020  f.load().       
+00005e40: 2069 6620 7669 6577 206e 6f74 2069 6e20   if view not in 
+00005e50: 7365 6c66 2e63 6f6e 746f 7572 733a 0a20  self.contours:. 
+00005e60: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00005e70: 6372 6561 7465 5f63 6f6e 746f 7572 7328  create_contours(
+00005e80: 7669 6577 290a 2020 2020 2020 2020 636f  view).        co
+00005e90: 6e74 6f75 7273 203d 2073 656c 662e 636f  ntours = self.co
+00005ea0: 6e74 6f75 7273 5b76 6965 775d 0a0a 2020  ntours[view]..  
+00005eb0: 2020 2020 2020 2320 436f 6e76 6572 7420        # Convert 
+00005ec0: 6b65 7973 2074 6f20 696e 6469 6365 7320  keys to indices 
+00005ed0: 7261 7468 6572 2074 6861 6e20 706f 7369  rather than posi
+00005ee0: 7469 6f6e 730a 2020 2020 2020 2020 6966  tions.        if
+00005ef0: 2069 6478 5f61 735f 6b65 793a 0a20 2020   idx_as_key:.   
+00005f00: 2020 2020 2020 2020 2063 6f6e 746f 7572           contour
+00005f10: 7320 3d20 7b73 656c 662e 706f 735f 746f  s = {self.pos_to
+00005f20: 5f69 6478 286b 6579 2c20 736b 7274 2e69  _idx(key, skrt.i
+00005f30: 6d61 6765 2e5f 736c 6963 655f 6178 6573  mage._slice_axes
+00005f40: 5b76 6965 775d 293a 200a 2020 2020 2020  [view]): .      
+00005f50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005f60: 2020 7661 6c75 6520 666f 7220 6b65 792c    value for key,
+00005f70: 2076 616c 7565 2069 6e20 636f 6e74 6f75   value in contou
+00005f80: 7273 2e69 7465 6d73 2829 7d0a 0a20 2020  rs.items()}..   
+00005f90: 2020 2020 2023 2046 6f72 2065 6163 6820       # For each 
+00005fa0: 736c 6963 652c 206b 6565 7020 6f6e 6c79  slice, keep only
+00005fb0: 2063 6f6e 746f 7572 2077 6974 6820 6d6f   contour with mo
+00005fc0: 7374 2070 6f69 6e74 732e 0a20 2020 2020  st points..     
+00005fd0: 2020 2069 6620 6d6f 7374 5f70 6f69 6e74     if most_point
+00005fe0: 733a 0a20 2020 2020 2020 2020 2020 2063  s:.            c
+00005ff0: 6f6e 746f 7572 7320 3d20 7b6b 6579 3a20  ontours = {key: 
+00006000: 5b6d 6178 2876 616c 7565 2c20 6b65 793d  [max(value, key=
+00006010: 6c65 6e29 5d0a 2020 2020 2020 2020 2020  len)].          
+00006020: 2020 2020 2020 2020 2020 666f 7220 6b65            for ke
+00006030: 792c 2076 616c 7565 2069 6e20 636f 6e74  y, value in cont
+00006040: 6f75 7273 2e69 7465 6d73 2829 7d0a 0a20  ours.items()}.. 
+00006050: 2020 2020 2020 2072 6574 7572 6e20 636f         return co
+00006060: 6e74 6f75 7273 0a0a 2020 2020 6465 6620  ntours..    def 
+00006070: 6765 745f 636f 6e74 6f75 7273 5f6f 6e5f  get_contours_on_
+00006080: 736c 6963 6528 7365 6c66 2c20 7669 6577  slice(self, view
+00006090: 3d22 782d 7922 2c20 736c 3d4e 6f6e 652c  ="x-y", sl=None,
+000060a0: 2069 6478 3d4e 6f6e 652c 2070 6f73 3d4e   idx=None, pos=N
+000060b0: 6f6e 6529 3a0a 0a20 2020 2020 2020 2073  one):..        s
+000060c0: 656c 662e 6c6f 6164 2829 0a20 2020 2020  elf.load().     
+000060d0: 2020 2069 6620 736c 2069 7320 4e6f 6e65     if sl is None
+000060e0: 2061 6e64 2069 6478 2069 7320 4e6f 6e65   and idx is None
+000060f0: 2061 6e64 2070 6f73 2069 7320 4e6f 6e65   and pos is None
+00006100: 3a0a 2020 2020 2020 2020 2020 2020 6964  :.            id
+00006110: 7820 3d20 7365 6c66 2e67 6574 5f6d 6964  x = self.get_mid
+00006120: 5f69 6478 2876 6965 7729 0a20 2020 2020  _idx(view).     
+00006130: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+00006140: 2020 2020 2069 6478 203d 2073 656c 662e       idx = self.
+00006150: 6765 745f 6964 7828 7669 6577 2c20 736c  get_idx(view, sl
+00006160: 2c20 6964 782c 2070 6f73 290a 2020 2020  , idx, pos).    
+00006170: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
+00006180: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+00006190: 2e67 6574 5f63 6f6e 746f 7572 7328 7669  .get_contours(vi
+000061a0: 6577 2c20 6964 785f 6173 5f6b 6579 3d54  ew, idx_as_key=T
+000061b0: 7275 6529 5b69 6478 5d0a 2020 2020 2020  rue)[idx].      
+000061c0: 2020 6578 6365 7074 204b 6579 4572 726f    except KeyErro
+000061d0: 723a 0a20 2020 2020 2020 2020 2020 2072  r:.            r
+000061e0: 6574 7572 6e20 5b5d 0a0a 2020 2020 6465  eturn []..    de
+000061f0: 6620 6765 745f 736c 6963 655f 706f 7369  f get_slice_posi
+00006200: 7469 6f6e 7328 7365 6c66 2c20 6f74 6865  tions(self, othe
+00006210: 723d 4e6f 6e65 2c20 7669 6577 3d22 782d  r=None, view="x-
+00006220: 7922 2c20 706f 7369 7469 6f6e 5f61 735f  y", position_as_
+00006230: 6964 783d 4661 6c73 652c 0a20 2020 2020  idx=False,.     
+00006240: 2020 2020 2020 206d 6574 686f 643d 2275         method="u
+00006250: 6e69 6f6e 2229 3a0a 2020 2020 2020 2020  nion"):.        
+00006260: 2222 220a 2020 2020 2020 2020 4765 7420  """.        Get 
+00006270: 6f72 6465 7265 6420 6c69 7374 206f 6620  ordered list of 
+00006280: 736c 6963 6520 706f 7369 7469 6f6e 7320  slice positions 
+00006290: 666f 7220 7365 6c66 2061 6e64 206f 7468  for self and oth
+000062a0: 6572 2e0a 0a20 2020 2020 2020 202a 2a50  er...        **P
+000062b0: 6172 616d 6574 6572 733a 2a2a 0a0a 2020  arameters:**..  
+000062c0: 2020 2020 2020 6f74 6865 7220 3a20 736b        other : sk
+000062d0: 7274 2e73 7472 7563 7475 7265 732e 524f  rt.structures.RO
+000062e0: 492c 2064 6566 6175 6c74 3d4e 6f6e 650a  I, default=None.
+000062f0: 2020 2020 2020 2020 2020 2020 5365 636f              Seco
+00006300: 6e64 2052 4f49 206f 6620 6120 7061 6972  nd ROI of a pair
+00006310: 2066 6f72 2077 6869 6368 2073 6c69 6365   for which slice
+00006320: 2070 6f73 6974 696f 6e73 2061 7265 2062   positions are b
+00006330: 6520 6f62 7461 696e 6564 2e0a 2020 2020  e obtained..    
+00006340: 2020 2020 2020 2020 4469 7372 6567 6172          Disregar
+00006350: 6465 6420 6966 204e 6f6e 652e 0a0a 2020  ded if None...  
+00006360: 2020 2020 2020 7669 6577 203a 2073 7472        view : str
+00006370: 2c20 6465 6661 756c 743d 2278 2d79 220a  , default="x-y".
+00006380: 2020 2020 2020 2020 2020 2020 5669 6577              View
+00006390: 2069 6e20 7768 6963 6820 746f 206f 6274   in which to obt
+000063a0: 6169 6e20 736c 6963 6573 2e0a 0a20 2020  ain slices...   
+000063b0: 2020 2020 2070 6f73 6974 696f 6e5f 6173       position_as
+000063c0: 5f69 6478 203a 2062 6f6f 6c2c 2064 6566  _idx : bool, def
+000063d0: 6175 6c74 3d46 616c 7365 0a20 2020 2020  ault=False.     
+000063e0: 2020 2020 2020 2049 6620 5472 7565 2c20         If True, 
+000063f0: 7265 7475 726e 2070 6f73 6974 696f 6e73  return positions
+00006400: 2061 7320 736c 6963 6520 696e 6469 6365   as slice indice
+00006410: 733b 2069 6620 4661 6c73 652c 0a20 2020  s; if False,.   
+00006420: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00006430: 706f 7369 7469 6f6e 7320 6173 2073 6c69  positions as sli
+00006440: 6365 207a 2d63 6f6f 7264 696e 6174 6573  ce z-coordinates
+00006450: 2028 6d6d 292e 0a0a 2020 2020 2020 2020   (mm)...        
+00006460: 6d65 7468 6f64 3a20 7374 722c 2064 6566  method: str, def
+00006470: 6175 6c74 3d22 756e 696f 6e22 0a20 2020  ault="union".   
+00006480: 2020 2020 2020 2020 2053 7472 696e 6720           String 
+00006490: 7370 6563 6966 7969 6e67 2073 6c69 6365  specifying slice
+000064a0: 7320 666f 7220 7768 6963 6820 706f 7369  s for which posi
+000064b0: 7469 6f6e 7320 6172 6520 746f 2062 6520  tions are to be 
+000064c0: 6f62 7461 696e 6564 2c0a 2020 2020 2020  obtained,.      
+000064d0: 2020 2020 2020 666f 7220 524f 4973 2073        for ROIs s
+000064e0: 656c 6620 616e 6420 6f74 6865 722e 0a0a  elf and other...
+000064f0: 2020 2020 2020 2020 2020 2020 2d20 226c              - "l
+00006500: 6566 7422 2028 6f72 206f 7468 6572 2069  eft" (or other i
+00006510: 7320 4e6f 6e65 293a 2072 6574 7572 6e20  s None): return 
+00006520: 706f 7369 7469 6f6e 7320 6f66 0a20 2020  positions of.   
+00006530: 2020 2020 2020 2020 2020 2073 6c69 6365             slice
+00006540: 7320 636f 6e74 6169 6e69 6e67 2073 656c  s containing sel
+00006550: 663b 0a20 2020 2020 2020 2020 2020 202d  f;.            -
+00006560: 2022 7269 6768 7422 3a20 7265 7475 726e   "right": return
+00006570: 2070 6f73 6974 696f 6e73 206f 6620 736c   positions of sl
+00006580: 6963 6573 2063 6f6e 7461 696e 696e 6720  ices containing 
+00006590: 6f74 6865 723b 0a20 2020 2020 2020 2020  other;.         
+000065a0: 2020 202d 2022 756e 696f 6e22 3a20 7265     - "union": re
+000065b0: 7475 726e 2070 6f73 6974 696f 6e73 206f  turn positions o
+000065c0: 6620 736c 6963 6573 2063 6f6e 7461 696e  f slices contain
+000065d0: 696e 6720 6569 7468 6572 2073 656c 660a  ing either self.
+000065e0: 2020 2020 2020 2020 2020 2020 2020 6f72                or
+000065f0: 206f 7468 6572 3b0a 2020 2020 2020 2020   other;.        
+00006600: 2020 2020 2d20 2269 6e74 6572 7365 6374      - "intersect
+00006610: 696f 6e22 3a20 7265 7475 726e 2070 6f73  ion": return pos
+00006620: 6974 696f 6e73 206f 6620 736c 6963 6573  itions of slices
+00006630: 2063 6f6e 7461 696e 696e 6720 626f 7468   containing both
+00006640: 0a20 2020 2020 2020 2020 2020 2020 2073  .              s
+00006650: 656c 6620 616e 6420 6f74 6865 722e 0a20  elf and other.. 
+00006660: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+00006670: 2020 2072 6574 7572 6e20 6765 745f 736c     return get_sl
+00006680: 6963 655f 706f 7369 7469 6f6e 7328 7365  ice_positions(se
+00006690: 6c66 2c20 6f74 6865 722c 2076 6965 772c  lf, other, view,
+000066a0: 2070 6f73 6974 696f 6e5f 6173 5f69 6478   position_as_idx
+000066b0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+000066c0: 2020 6d65 7468 6f64 290a 0a20 2020 2064    method)..    d
+000066d0: 6566 2067 6574 5f61 6666 696e 6528 7365  ef get_affine(se
+000066e0: 6c66 2c20 666f 7263 655f 7374 616e 6461  lf, force_standa
+000066f0: 7264 6973 653d 4661 6c73 652c 202a 2a6b  rdise=False, **k
+00006700: 7761 7267 7329 3a0a 2020 2020 2020 2020  wargs):.        
+00006710: 2222 224c 6f61 6420 7365 6c66 2061 6e64  """Load self and
+00006720: 2067 6574 2061 6666 696e 6520 6d61 7472   get affine matr
+00006730: 6978 2e22 2222 0a0a 2020 2020 2020 2020  ix."""..        
+00006740: 7365 6c66 2e6c 6f61 6428 290a 2020 2020  self.load().    
+00006750: 2020 2020 6966 2073 656c 662e 6c6f 6164      if self.load
+00006760: 6564 5f6d 6173 6b3a 0a20 2020 2020 2020  ed_mask:.       
+00006770: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+00006780: 2e6d 6173 6b2e 6765 745f 6166 6669 6e65  .mask.get_affine
+00006790: 2866 6f72 6365 5f73 7461 6e64 6172 6469  (force_standardi
+000067a0: 7365 3d66 6f72 6365 5f73 7461 6e64 6172  se=force_standar
+000067b0: 6469 7365 2c20 0a20 2020 2020 2020 2020  dise, .         
+000067c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000067d0: 2020 2020 2020 2020 2020 2020 2020 202a                 *
+000067e0: 2a6b 7761 7267 7329 0a20 2020 2020 2020  *kwargs).       
+000067f0: 2065 6c69 6620 7365 6c66 2e69 6d61 6765   elif self.image
+00006800: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
+00006810: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00006820: 2073 656c 662e 696d 6167 652e 6765 745f   self.image.get_
+00006830: 6166 6669 6e65 2866 6f72 6365 5f73 7461  affine(force_sta
+00006840: 6e64 6172 6469 7365 3d66 6f72 6365 5f73  ndardise=force_s
+00006850: 7461 6e64 6172 6469 7365 2c0a 2020 2020  tandardise,.    
+00006860: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006870: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006880: 2020 2020 202a 2a6b 7761 7267 7329 0a20       **kwargs). 
+00006890: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
+000068a0: 6c66 2e61 6666 696e 650a 0a20 2020 2064  lf.affine..    d
+000068b0: 6566 2067 6574 5f74 7261 6e73 6c61 7469  ef get_translati
+000068c0: 6f6e 5f74 6f5f 616c 6967 6e28 0a20 2020  on_to_align(.   
+000068d0: 2020 2020 2020 2020 2073 656c 662c 206f           self, o
+000068e0: 7468 6572 2c20 7a5f 6672 6163 7469 6f6e  ther, z_fraction
+000068f0: 313d 4e6f 6e65 2c20 7a5f 6672 6163 7469  1=None, z_fracti
+00006900: 6f6e 323d 4e6f 6e65 293a 0a20 2020 2020  on2=None):.     
+00006910: 2020 2022 2222 0a20 2020 2020 2020 2044     """.        D
+00006920: 6574 6572 6d69 6e65 2074 7261 6e73 6c61  etermine transla
+00006930: 7469 6f6e 2066 6f72 2061 6c69 676e 696e  tion for alignin
+00006940: 6720 3c73 656c 663e 2074 6f20 3c6f 7468  g <self> to <oth
+00006950: 6572 3e2e 0a0a 2020 2020 2020 2020 2a2a  er>...        **
+00006960: 5061 7261 6d65 7465 7273 3a2a 2a0a 0a20  Parameters:**.. 
+00006970: 2020 2020 2020 206f 7468 6572 203a 2052         other : R
+00006980: 4f49 2f53 7472 7563 7475 7265 5365 742f  OI/StructureSet/
+00006990: 6c69 7374 0a20 2020 2020 2020 2020 2020  list.           
+000069a0: 2052 4f49 2077 6974 6820 7768 6963 6820   ROI with which 
+000069b0: 616c 6967 6e6d 656e 7420 6973 2074 6f20  alignment is to 
+000069c0: 6265 2070 6572 666f 726d 6564 2e20 2054  be performed.  T
+000069d0: 6869 7320 6361 6e20 6265 0a20 2020 2020  his can be.     
+000069e0: 2020 2020 2020 2073 7065 6369 6669 6564         specified
+000069f0: 2064 6972 6563 746c 7920 6173 2061 2073   directly as a s
+00006a00: 696e 676c 6520 524f 492e 2020 416c 7465  ingle ROI.  Alte
+00006a10: 726e 6174 6976 656c 792c 2069 7420 6361  rnatively, it ca
+00006a20: 6e0a 2020 2020 2020 2020 2020 2020 6265  n.            be
+00006a30: 2061 2053 7472 7563 7475 7265 5365 742c   a StructureSet,
+00006a40: 206f 7220 6120 6c69 7374 206f 7220 524f   or a list or RO
+00006a50: 492f 5374 7275 6374 7572 6553 6574 206f  I/StructureSet o
+00006a60: 626a 6563 7473 2c0a 2020 2020 2020 2020  bjects,.        
+00006a70: 2020 2020 696e 2077 6869 6368 2063 6173      in which cas
+00006a80: 6520 7468 6520 696e 6469 7669 6475 616c  e the individual
+00006a90: 2052 4f49 7320 7769 6c6c 2062 6520 636f   ROIs will be co
+00006aa0: 6d62 696e 6564 2e0a 0a20 2020 2020 2020  mbined...       
+00006ab0: 207a 5f66 7261 6374 696f 6e31 203a 2066   z_fraction1 : f
+00006ac0: 6c6f 6174 2c20 6465 6661 756c 743d 4e6f  loat, default=No
+00006ad0: 6e65 0a20 2020 2020 2020 2020 2020 2050  ne.            P
+00006ae0: 6f73 6974 696f 6e20 616c 6f6e 6720 7a20  osition along z 
+00006af0: 6178 6973 206f 6620 736c 6963 6520 7468  axis of slice th
+00006b00: 726f 7567 6820 3c73 656c 663e 206f 6e20  rough <self> on 
+00006b10: 7768 6963 680a 2020 2020 2020 2020 2020  which.          
+00006b20: 2020 746f 2061 6c69 676e 2e20 2049 6620    to align.  If 
+00006b30: 4e6f 6e65 2c20 616c 6967 6e6d 656e 7420  None, alignment 
+00006b40: 6973 2074 6f20 7468 6520 6365 6e74 726f  is to the centro
+00006b50: 6964 206f 6620 7468 650a 2020 2020 2020  id of the.      
+00006b60: 2020 2020 2020 7768 6f6c 6520 524f 4920        whole ROI 
+00006b70: 766f 6c75 6d65 2e20 204f 7468 6572 7769  volume.  Otherwi
+00006b80: 7365 2c20 616c 6967 6e6d 656e 7420 6973  se, alignment is
+00006b90: 2074 6f20 7468 650a 2020 2020 2020 2020   to the.        
+00006ba0: 2020 2020 6365 6e74 726f 6964 206f 6620      centroid of 
+00006bb0: 7468 6520 736c 6963 6520 6174 2074 6865  the slice at the
+00006bc0: 2073 7065 6369 6669 6564 2064 6973 7461   specified dista
+00006bd0: 6e63 650a 2020 2020 2020 2020 2020 2020  nce.            
+00006be0: 6672 6f6d 2074 6865 2052 4f49 2773 206d  from the ROI's m
+00006bf0: 6f73 742d 696e 6665 7269 6f72 2070 6f69  ost-inferior poi
+00006c00: 6e74 3a20 3020 636f 7272 6573 706f 6e64  nt: 0 correspond
+00006c10: 7320 746f 0a20 2020 2020 2020 2020 2020  s to.           
+00006c20: 2074 6865 206d 6f73 742d 696e 6665 7269   the most-inferi
+00006c30: 6f72 2070 6f69 6e74 2028 6c6f 7765 7374  or point (lowest
+00006c40: 207a 293b 2031 2063 6f72 7265 7370 6f6e   z); 1 correspon
+00006c50: 6473 2074 6f20 7468 650a 2020 2020 2020  ds to the.      
+00006c60: 2020 2020 2020 6d6f 7374 2d73 7570 6572        most-super
+00006c70: 696f 7220 706f 696e 7420 2868 6967 6865  ior point (highe
+00006c80: 7374 207a 292e 2020 5661 6c75 6573 2066  st z).  Values f
+00006c90: 6f72 207a 5f66 7261 6374 696f 6e0a 2020  or z_fraction.  
+00006ca0: 2020 2020 2020 2020 2020 6f75 7473 6964            outsid
+00006cb0: 6520 7468 6520 696e 7465 7276 616c 205b  e the interval [
+00006cc0: 302c 2031 5d20 7265 7375 6c74 2069 6e20  0, 1] result in 
+00006cd0: 6120 5275 6e74 696d 6545 7272 6f72 2e0a  a RuntimeError..
+00006ce0: 0a20 2020 2020 2020 207a 5f66 7261 6374  .        z_fract
+00006cf0: 696f 6e32 203a 2066 6c6f 6174 2c20 6465  ion2 : float, de
+00006d00: 6661 756c 743d 4e6f 6e65 0a20 2020 2020  fault=None.     
+00006d10: 2020 2020 2020 2050 6f73 6974 696f 6e20         Position 
+00006d20: 616c 6f6e 6720 7a20 6178 6973 206f 6620  along z axis of 
+00006d30: 736c 6963 6520 7468 726f 7567 6820 3c6f  slice through <o
+00006d40: 7468 6572 3e20 6f6e 2077 6869 6368 0a20  ther> on which. 
+00006d50: 2020 2020 2020 2020 2020 2074 6f20 616c             to al
+00006d60: 6967 6e2e 2020 4966 204e 6f6e 652c 2061  ign.  If None, a
+00006d70: 6c69 676e 6d65 6e74 2069 7320 746f 2074  lignment is to t
+00006d80: 6865 2063 656e 7472 6f69 6420 6f66 2074  he centroid of t
+00006d90: 6865 0a20 2020 2020 2020 2020 2020 2077  he.            w
+00006da0: 686f 6c65 2052 4f49 2076 6f6c 756d 652e  hole ROI volume.
+00006db0: 2020 4f74 6865 7277 6973 652c 2061 6c69    Otherwise, ali
+00006dc0: 676e 6d65 6e74 2069 7320 746f 2074 6865  gnment is to the
+00006dd0: 0a20 2020 2020 2020 2020 2020 2063 656e  .            cen
+00006de0: 7472 6f69 6420 6f66 2074 6865 2073 6c69  troid of the sli
+00006df0: 6365 2061 7420 7468 6520 7370 6563 6966  ce at the specif
+00006e00: 6965 6420 6469 7374 616e 6365 0a20 2020  ied distance.   
+00006e10: 2020 2020 2020 2020 2066 726f 6d20 7468           from th
+00006e20: 6520 524f 4927 7320 6d6f 7374 2d69 6e66  e ROI's most-inf
+00006e30: 6572 696f 7220 706f 696e 743a 2030 2063  erior point: 0 c
+00006e40: 6f72 7265 7370 6f6e 6473 2074 6f0a 2020  orresponds to.  
+00006e50: 2020 2020 2020 2020 2020 7468 6520 6d6f            the mo
+00006e60: 7374 2d69 6e66 6572 696f 7220 706f 696e  st-inferior poin
+00006e70: 7420 286c 6f77 6573 7420 7a29 3b20 3120  t (lowest z); 1 
+00006e80: 636f 7272 6573 706f 6e64 7320 746f 2074  corresponds to t
+00006e90: 6865 0a20 2020 2020 2020 2020 2020 206d  he.            m
+00006ea0: 6f73 742d 7375 7065 7269 6f72 2070 6f69  ost-superior poi
+00006eb0: 6e74 2028 6869 6768 6573 7420 7a29 2e20  nt (highest z). 
+00006ec0: 2056 616c 7565 7320 666f 7220 7a5f 6672   Values for z_fr
+00006ed0: 6163 7469 6f6e 0a20 2020 2020 2020 2020  action.         
+00006ee0: 2020 206f 7574 7369 6465 2074 6865 2069     outside the i
+00006ef0: 6e74 6572 7661 6c20 5b30 2c20 315d 2072  nterval [0, 1] r
+00006f00: 6573 756c 7420 696e 2061 2052 756e 7469  esult in a Runti
+00006f10: 6d65 4572 726f 722e 0a20 2020 2020 2020  meError..       
+00006f20: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+00006f30: 2072 6574 7572 6e20 6765 745f 7472 616e   return get_tran
+00006f40: 736c 6174 696f 6e5f 746f 5f61 6c69 676e  slation_to_align
+00006f50: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+00006f60: 2020 7365 6c66 2c20 6f74 6865 722c 207a    self, other, z
+00006f70: 5f66 7261 6374 696f 6e31 2c20 7a5f 6672  _fraction1, z_fr
+00006f80: 6163 7469 6f6e 3229 0a0a 2020 2020 6465  action2)..    de
+00006f90: 6620 6765 745f 766f 7865 6c5f 7369 7a65  f get_voxel_size
+00006fa0: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
+00006fb0: 2222 224c 6f61 6420 7365 6c66 2061 6e64  """Load self and
+00006fc0: 2067 6574 2076 6f78 656c 5f73 697a 652e   get voxel_size.
+00006fd0: 2222 220a 0a20 2020 2020 2020 2073 656c  """..        sel
+00006fe0: 662e 6c6f 6164 2829 0a20 2020 2020 2020  f.load().       
+00006ff0: 2072 6574 7572 6e20 7365 6c66 2e76 6f78   return self.vox
+00007000: 656c 5f73 697a 650a 0a20 2020 2064 6566  el_size..    def
+00007010: 2067 6574 5f6e 705f 766f 7865 6c5f 7369   get_np_voxel_si
+00007020: 7a65 2873 656c 662c 2076 6965 773d 4e6f  ze(self, view=No
+00007030: 6e65 293a 0a20 2020 2020 2020 2022 2222  ne):.        """
+00007040: 0a20 2020 2020 2020 2047 6574 2076 6f78  .        Get vox
+00007050: 656c 5f73 697a 6520 666f 7220 6e75 6d70  el_size for nump
+00007060: 7920 6178 6973 206f 7264 6572 696e 6720  y axis ordering 
+00007070: 616e 6420 7370 6563 6966 6965 6420 7669  and specified vi
+00007080: 6577 2e0a 0a20 2020 2020 2020 2076 6965  ew...        vie
+00007090: 7720 3a20 7374 720a 2020 2020 2020 2020  w : str.        
+000070a0: 2020 2020 4f72 6965 6e74 6174 696f 6e20      Orientation 
+000070b0: 636f 6e73 6964 6572 6564 2066 6f72 2032  considered for 2
+000070c0: 4420 696d 6167 6520 6f72 2070 726f 6a65  D image or proje
+000070d0: 6374 696f 6e2e 0a20 2020 2020 2020 2020  ction..         
+000070e0: 2020 2043 616e 2062 6520 2278 2d79 222c     Can be "x-y",
+000070f0: 2022 792d 7a22 2c20 6f72 2022 782d 7a22   "y-z", or "x-z"
+00007100: 2e0a 2020 2020 2020 2020 2222 220a 0a20  ..        """.. 
+00007110: 2020 2020 2020 2073 656c 662e 6c6f 6164         self.load
+00007120: 2829 0a20 2020 2020 2020 2069 6620 7669  ().        if vi
+00007130: 6577 2069 7320 4e6f 6e65 3a0a 2020 2020  ew is None:.    
+00007140: 2020 2020 2020 2020 7678 2c20 7679 2c20          vx, vy, 
+00007150: 767a 203d 2073 656c 662e 766f 7865 6c5f  vz = self.voxel_
+00007160: 7369 7a65 0a20 2020 2020 2020 2020 2020  size.           
+00007170: 2076 6f78 656c 5f73 697a 6520 3d20 5b76   voxel_size = [v
+00007180: 792c 2076 782c 2076 7a5d 0a20 2020 2020  y, vx, vz].     
+00007190: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+000071a0: 2020 2020 2076 6f78 656c 5f73 697a 6520       voxel_size 
+000071b0: 3d20 5b73 656c 662e 766f 7865 6c5f 7369  = [self.voxel_si
+000071c0: 7a65 5b69 5d0a 2020 2020 2020 2020 2020  ze[i].          
+000071d0: 2020 2020 2020 2020 2020 666f 7220 6920            for i 
+000071e0: 696e 2073 6b72 742e 696d 6167 652e 5f70  in skrt.image._p
+000071f0: 6c6f 745f 6178 6573 5b76 6965 775d 5d0a  lot_axes[view]].
+00007200: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00007210: 766f 7865 6c5f 7369 7a65 0a0a 2020 2020  voxel_size..    
+00007220: 6465 6620 6765 745f 6f72 6967 696e 2873  def get_origin(s
+00007230: 656c 6629 3a0a 2020 2020 2020 2020 2222  elf):.        ""
+00007240: 224c 6f61 6420 7365 6c66 2061 6e64 2067  "Load self and g
+00007250: 6574 206f 7269 6769 6e2e 2222 220a 0a20  et origin.""".. 
+00007260: 2020 2020 2020 2073 656c 662e 6c6f 6164         self.load
+00007270: 2829 0a20 2020 2020 2020 2072 6574 7572  ().        retur
+00007280: 6e20 7365 6c66 2e6f 7269 6769 6e0a 0a20  n self.origin.. 
+00007290: 2020 2064 6566 2067 6574 5f6e 616d 6528     def get_name(
+000072a0: 7365 6c66 2c20 6f72 6967 696e 616c 3d46  self, original=F
+000072b0: 616c 7365 293a 0a20 2020 2020 2020 2022  alse):.        "
+000072c0: 2222 0a20 2020 2020 2020 204c 6f61 6420  "".        Load 
+000072d0: 7365 6c66 2061 6e64 2067 6574 206e 616d  self and get nam
+000072e0: 652e 2049 6620 3c6f 7269 6769 6e61 6c3e  e. If <original>
+000072f0: 2069 7320 5472 7565 2c20 6765 7420 7468   is True, get th
+00007300: 6520 6f72 6967 696e 616c 206e 616d 652e  e original name.
+00007310: 0a20 2020 2020 2020 2022 2222 0a0a 2020  .        """..  
+00007320: 2020 2020 2020 7365 6c66 2e6c 6f61 6428        self.load(
+00007330: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
+00007340: 2028 7365 6c66 2e6f 7269 6769 6e61 6c5f   (self.original_
+00007350: 6e61 6d65 2069 6620 6f72 6967 696e 616c  name if original
+00007360: 2065 6c73 6520 7365 6c66 2e6e 616d 6529   else self.name)
+00007370: 0a0a 2020 2020 6465 6620 6765 745f 6d61  ..    def get_ma
+00007380: 736b 2873 656c 662c 2076 6965 773d 2278  sk(self, view="x
+00007390: 2d79 222c 2066 6c61 7474 656e 3d46 616c  -y", flatten=Fal
+000073a0: 7365 2c20 7374 616e 6461 7264 6973 653d  se, standardise=
+000073b0: 4661 6c73 652c 200a 2020 2020 2020 2020  False, .        
+000073c0: 2020 2020 2020 2020 2066 6f72 6365 5f73           force_s
+000073d0: 7461 6e64 6172 6469 7365 3d46 616c 7365  tandardise=False
+000073e0: 293a 0a20 2020 2020 2020 2022 2222 4765  ):.        """Ge
+000073f0: 7420 6269 6e61 7279 206d 6173 6b2c 206f  t binary mask, o
+00007400: 7074 696f 6e61 6c6c 7920 666c 6174 7465  ptionally flatte
+00007410: 6e65 6420 696e 2061 2067 6976 656e 206f  ned in a given o
+00007420: 7269 656e 7461 7469 6f6e 2e22 2222 0a0a  rientation."""..
+00007430: 2020 2020 2020 2020 7365 6c66 2e6c 6f61          self.loa
+00007440: 6428 290a 2020 2020 2020 2020 7365 6c66  d().        self
+00007450: 2e63 7265 6174 655f 6d61 736b 2829 0a20  .create_mask(). 
+00007460: 2020 2020 2020 2069 6620 6e6f 7420 666c         if not fl
+00007470: 6174 7465 6e3a 0a20 2020 2020 2020 2020  atten:.         
+00007480: 2020 2072 6574 7572 6e20 7365 6c66 2e6d     return self.m
+00007490: 6173 6b2e 6765 745f 6461 7461 2873 7461  ask.get_data(sta
+000074a0: 6e64 6172 6469 7365 3d73 7461 6e64 6172  ndardise=standar
+000074b0: 6469 7365 2c20 0a20 2020 2020 2020 2020  dise, .         
+000074c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000074d0: 2020 2020 2020 2020 2020 2020 2066 6f72               for
+000074e0: 6365 5f73 7461 6e64 6172 6469 7365 3d66  ce_standardise=f
+000074f0: 6f72 6365 5f73 7461 6e64 6172 6469 7365  orce_standardise
+00007500: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
+00007510: 206e 702e 7375 6d28 0a20 2020 2020 2020   np.sum(.       
+00007520: 2020 2020 2073 656c 662e 6d61 736b 2e67       self.mask.g
+00007530: 6574 5f64 6174 6128 7374 616e 6461 7264  et_data(standard
+00007540: 6973 653d 7374 616e 6461 7264 6973 652c  ise=standardise,
+00007550: 200a 2020 2020 2020 2020 2020 2020 2020   .              
+00007560: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007570: 2066 6f72 6365 5f73 7461 6e64 6172 6469   force_standardi
+00007580: 7365 3d66 6f72 6365 5f73 7461 6e64 6172  se=force_standar
+00007590: 6469 7365 292c 0a20 2020 2020 2020 2020  dise),.         
+000075a0: 2020 2061 7869 733d 736b 7274 2e69 6d61     axis=skrt.ima
+000075b0: 6765 2e5f 736c 6963 655f 6178 6573 5b76  ge._slice_axes[v
+000075c0: 6965 775d 0a20 2020 2020 2020 2029 2e61  iew].        ).a
+000075d0: 7374 7970 6528 626f 6f6c 290a 0a20 2020  stype(bool)..   
+000075e0: 2064 6566 2067 6574 5f6d 6173 6b5f 696d   def get_mask_im
+000075f0: 6167 6528 7365 6c66 293a 0a20 2020 2020  age(self):.     
+00007600: 2020 2022 2222 4765 7420 696d 6167 6520     """Get image 
+00007610: 6f62 6a65 6374 2072 6570 7265 7365 6e74  object represent
+00007620: 696e 6720 524f 4920 6d61 736b 2e22 2222  ing ROI mask."""
+00007630: 0a0a 2020 2020 2020 2020 7365 6c66 2e6c  ..        self.l
+00007640: 6f61 6428 290a 2020 2020 2020 2020 7365  oad().        se
+00007650: 6c66 2e63 7265 6174 655f 6d61 736b 2829  lf.create_mask()
+00007660: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00007670: 7365 6c66 2e6d 6173 6b0a 0a20 2020 2064  self.mask..    d
+00007680: 6566 2067 6574 5f70 6f6c 7967 6f6e 7328  ef get_polygons(
+00007690: 7365 6c66 2c20 7669 6577 3d22 782d 7922  self, view="x-y"
+000076a0: 2c20 6964 785f 6173 5f6b 6579 3d46 616c  , idx_as_key=Fal
+000076b0: 7365 293a 0a20 2020 2020 2020 2022 2222  se):.        """
+000076c0: 4765 7420 6469 6374 206f 6620 706f 6c79  Get dict of poly
+000076d0: 676f 6e73 2066 6f72 2065 6163 6820 736c  gons for each sl
+000076e0: 6963 652e 2222 220a 0a20 2020 2020 2020  ice."""..       
+000076f0: 2070 6f6c 7967 6f6e 7320 3d20 7b7d 0a20   polygons = {}. 
+00007700: 2020 2020 2020 2066 6f72 2069 2c20 636f         for i, co
+00007710: 6e74 6f75 7273 2069 6e20 7365 6c66 2e67  ntours in self.g
+00007720: 6574 5f63 6f6e 746f 7572 7328 7669 6577  et_contours(view
+00007730: 2c20 6964 785f 6173 5f6b 6579 292e 6974  , idx_as_key).it
+00007740: 656d 7328 293a 0a20 2020 2020 2020 2020  ems():.         
+00007750: 2020 2070 6f6c 7967 6f6e 735b 695d 203d     polygons[i] =
+00007760: 205b 636f 6e74 6f75 725f 746f 5f70 6f6c   [contour_to_pol
+00007770: 7967 6f6e 2863 2920 666f 7220 6320 696e  ygon(c) for c in
+00007780: 2063 6f6e 746f 7572 735d 0a20 2020 2020   contours].     
+00007790: 2020 2072 6574 7572 6e20 706f 6c79 676f     return polygo
+000077a0: 6e73 0a0a 2020 2020 6465 6620 6765 745f  ns..    def get_
+000077b0: 706f 6c79 676f 6e73 5f6f 6e5f 736c 6963  polygons_on_slic
+000077c0: 6528 7365 6c66 2c20 7669 6577 3d22 782d  e(self, view="x-
+000077d0: 7922 2c20 736c 3d4e 6f6e 652c 2069 6478  y", sl=None, idx
+000077e0: 3d4e 6f6e 652c 2070 6f73 3d4e 6f6e 6529  =None, pos=None)
+000077f0: 3a0a 2020 2020 2020 2020 2222 2247 6574  :.        """Get
+00007800: 2073 6861 7065 6c79 2070 6f6c 7967 6f6e   shapely polygon
+00007810: 206f 626a 6563 7473 2063 6f72 7265 7370   objects corresp
+00007820: 6f6e 6469 6e67 2074 6f20 6120 6769 7665  onding to a give
+00007830: 6e20 736c 6963 652e 2222 220a 0a20 2020  n slice."""..   
+00007840: 2020 2020 2063 6f6e 746f 7572 7320 3d20       contours = 
+00007850: 7365 6c66 2e67 6574 5f63 6f6e 746f 7572  self.get_contour
+00007860: 735f 6f6e 5f73 6c69 6365 2876 6965 772c  s_on_slice(view,
+00007870: 2073 6c2c 2069 6478 2c20 706f 7329 0a20   sl, idx, pos). 
+00007880: 2020 2020 2020 2072 6574 7572 6e20 5b63         return [c
+00007890: 6f6e 746f 7572 5f74 6f5f 706f 6c79 676f  ontour_to_polygo
+000078a0: 6e28 6329 2066 6f72 2063 2069 6e20 636f  n(c) for c in co
+000078b0: 6e74 6f75 7273 5d0a 0a20 2020 2064 6566  ntours]..    def
+000078c0: 2063 7265 6174 655f 636f 6e74 6f75 7273   create_contours
+000078d0: 2873 656c 662c 2076 6965 773d 2261 6c6c  (self, view="all
+000078e0: 222c 2066 6f72 6365 3d46 616c 7365 293a  ", force=False):
+000078f0: 0a20 2020 2020 2020 2022 2222 4372 6561  .        """Crea
+00007900: 7465 2063 6f6e 746f 7572 7320 696e 2061  te contours in a
+00007910: 6c6c 206f 7269 656e 7461 7469 6f6e 732e  ll orientations.
+00007920: 2222 220a 0a20 2020 2020 2020 2069 6620  """..        if 
+00007930: 6e6f 7420 666f 7263 653a 0a20 2020 2020  not force:.     
+00007940: 2020 2020 2020 2069 6620 7669 6577 203d         if view =
+00007950: 3d20 2261 6c6c 2220 616e 6420 616c 6c28  = "all" and all(
+00007960: 5b76 2069 6e20 7365 6c66 2e63 6f6e 746f  [v in self.conto
+00007970: 7572 7320 666f 7220 7620 696e 200a 2020  urs for v in .  
+00007980: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007990: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000079a0: 2020 2020 736b 7274 2e69 6d61 6765 2e5f      skrt.image._
+000079b0: 706c 6f74 5f61 7865 735d 293a 0a20 2020  plot_axes]):.   
+000079c0: 2020 2020 2020 2020 2020 2020 2072 6574               ret
+000079d0: 7572 6e0a 2020 2020 2020 2020 2020 2020  urn.            
+000079e0: 6966 2076 6965 7720 696e 2073 656c 662e  if view in self.
+000079f0: 636f 6e74 6f75 7273 3a0a 2020 2020 2020  contours:.      
+00007a00: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00007a10: 0a0a 2020 2020 2020 2020 6966 206e 6f74  ..        if not
+00007a20: 2073 656c 662e 6c6f 6164 6564 3a0a 2020   self.loaded:.  
+00007a30: 2020 2020 2020 2020 2020 7365 6c66 2e6c            self.l
+00007a40: 6f61 6428 290a 0a20 2020 2020 2020 2073  oad()..        s
+00007a50: 656c 662e 6372 6561 7465 5f6d 6173 6b28  elf.create_mask(
+00007a60: 290a 2020 2020 2020 2020 6966 2066 6f72  ).        if for
+00007a70: 6365 3a0a 2020 2020 2020 2020 2020 2020  ce:.            
+00007a80: 7365 6c66 2e63 6f6e 746f 7572 7320 3d20  self.contours = 
+00007a90: 7b7d 0a0a 2020 2020 2020 2020 2320 4372  {}..        # Cr
+00007aa0: 6561 7465 2063 6f6e 746f 7572 7320 696e  eate contours in
+00007ab0: 2065 7665 7279 206f 7269 656e 7461 7469   every orientati
+00007ac0: 6f6e 0a20 2020 2020 2020 2076 6965 7773  on.        views
+00007ad0: 203d 206c 6973 7428 736b 7274 2e69 6d61   = list(skrt.ima
+00007ae0: 6765 2e5f 706c 6f74 5f61 7865 732e 6b65  ge._plot_axes.ke
+00007af0: 7973 2829 2920 6966 2076 6965 7720 3d3d  ys()) if view ==
+00007b00: 2022 616c 6c22 2065 6c73 6520 5b76 6965   "all" else [vie
+00007b10: 775d 0a20 2020 2020 2020 2066 6f72 2076  w].        for v
+00007b20: 2069 6e20 7669 6577 733a 0a0a 2020 2020   in views:..    
+00007b30: 2020 2020 2020 2020 6966 2076 2069 6e20          if v in 
+00007b40: 7365 6c66 2e63 6f6e 746f 7572 733a 0a20  self.contours:. 
+00007b50: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+00007b60: 6f6e 7469 6e75 650a 0a20 2020 2020 2020  ontinue..       
+00007b70: 2020 2020 2023 204d 616b 6520 6e65 7720       # Make new 
+00007b80: 636f 6e74 6f75 7273 2066 726f 6d20 6d61  contours from ma
+00007b90: 736b 0a20 2020 2020 2020 2020 2020 207a  sk.            z
+00007ba0: 5f61 7820 3d20 736b 7274 2e69 6d61 6765  _ax = skrt.image
+00007bb0: 2e5f 736c 6963 655f 6178 6573 5b76 5d0a  ._slice_axes[v].
+00007bc0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00007bd0: 2e63 6f6e 746f 7572 735b 765d 203d 207b  .contours[v] = {
+00007be0: 7d0a 2020 2020 2020 2020 2020 2020 666f  }.            fo
+00007bf0: 7220 697a 2069 6e20 7365 6c66 2e67 6574  r iz in self.get
+00007c00: 5f69 6e64 6963 6573 2876 2c20 6d65 7468  _indices(v, meth
+00007c10: 6f64 3d22 6d61 736b 2229 3a0a 0a20 2020  od="mask"):..   
+00007c20: 2020 2020 2020 2020 2020 2020 2023 2047               # G
+00007c30: 6574 2073 6c69 6365 206f 6620 6d61 736b  et slice of mask
+00007c40: 2061 7272 6179 0a20 2020 2020 2020 2020   array.         
+00007c50: 2020 2020 2020 206d 6173 6b5f 736c 6963         mask_slic
+00007c60: 6520 3d20 7365 6c66 2e67 6574 5f73 6c69  e = self.get_sli
+00007c70: 6365 2876 2c20 6964 783d 697a 292e 540a  ce(v, idx=iz).T.
+00007c80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007c90: 6966 206d 6173 6b5f 736c 6963 652e 6d61  if mask_slice.ma
+00007ca0: 7828 2920 3c20 302e 353a 0a20 2020 2020  x() < 0.5:.     
+00007cb0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+00007cc0: 6f6e 7469 6e75 650a 0a20 2020 2020 2020  ontinue..       
+00007cd0: 2020 2020 2020 2020 2070 6f69 6e74 7320           points 
+00007ce0: 3d20 7365 6c66 2e6d 6173 6b5f 746f 5f63  = self.mask_to_c
+00007cf0: 6f6e 746f 7572 7328 6d61 736b 5f73 6c69  ontours(mask_sli
+00007d00: 6365 2c20 7629 0a20 2020 2020 2020 2020  ce, v).         
+00007d10: 2020 2020 2020 2069 6620 706f 696e 7473         if points
+00007d20: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00007d30: 2020 2020 2020 7365 6c66 2e63 6f6e 746f        self.conto
+00007d40: 7572 735b 765d 5b73 656c 662e 6964 785f  urs[v][self.idx_
+00007d50: 746f 5f70 6f73 2869 7a2c 207a 5f61 7829  to_pos(iz, z_ax)
+00007d60: 5d20 3d20 706f 696e 7473 0a0a 2020 2020  ] = points..    
+00007d70: 6465 6620 6d61 736b 5f74 6f5f 636f 6e74  def mask_to_cont
+00007d80: 6f75 7273 2873 656c 662c 206d 6173 6b2c  ours(self, mask,
+00007d90: 2076 6965 772c 2069 6e76 6572 743d 4661   view, invert=Fa
+00007da0: 6c73 6529 3a0a 2020 2020 2020 2020 2222  lse):.        ""
+00007db0: 2243 7265 6174 6520 636f 6e74 6f75 7273  "Create contours
+00007dc0: 2066 726f 6d20 6120 6d61 736b 2e22 2222   from a mask."""
+00007dd0: 0a0a 2020 2020 2020 2020 636f 6e74 6f75  ..        contou
+00007de0: 7273 203d 2073 6b69 6d61 6765 2e6d 6561  rs = skimage.mea
+00007df0: 7375 7265 2e66 696e 645f 636f 6e74 6f75  sure.find_contou
+00007e00: 7273 286d 6173 6b2c 2030 2e35 2c20 226c  rs(mask, 0.5, "l
+00007e10: 6f77 222c 2022 6c6f 7722 290a 0a20 2020  ow", "low")..   
+00007e20: 2020 2020 2023 2043 6f6e 7665 7274 2069       # Convert i
+00007e30: 6e64 6963 6573 2074 6f20 706f 7369 7469  ndices to positi
+00007e40: 6f6e 7320 696e 206d 6d0a 2020 2020 2020  ons in mm.      
+00007e50: 2020 785f 6178 2c20 795f 6178 203d 2073    x_ax, y_ax = s
+00007e60: 6b72 742e 696d 6167 652e 5f70 6c6f 745f  krt.image._plot_
+00007e70: 6178 6573 5b76 6965 775d 0a20 2020 2020  axes[view].     
+00007e80: 2020 2070 6f69 6e74 7320 3d20 5b5d 0a20     points = []. 
+00007e90: 2020 2020 2020 2066 6f72 2063 6f6e 746f         for conto
+00007ea0: 7572 2069 6e20 636f 6e74 6f75 7273 3a0a  ur in contours:.
+00007eb0: 2020 2020 2020 2020 2020 2020 636f 6e74              cont
+00007ec0: 6f75 725f 706f 696e 7473 203d 205b 5d0a  our_points = [].
+00007ed0: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+00007ee0: 6978 2c20 6979 2069 6e20 636f 6e74 6f75  ix, iy in contou
+00007ef0: 723a 0a20 2020 2020 2020 2020 2020 2020  r:.             
+00007f00: 2020 2070 7820 3d20 7365 6c66 2e69 6478     px = self.idx
+00007f10: 5f74 6f5f 706f 7328 6978 2c20 785f 6178  _to_pos(ix, x_ax
+00007f20: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00007f30: 2020 7079 203d 2073 656c 662e 6964 785f    py = self.idx_
+00007f40: 746f 5f70 6f73 2869 792c 2079 5f61 7829  to_pos(iy, y_ax)
+00007f50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00007f60: 2069 6620 696e 7665 7274 3a0a 2020 2020   if invert:.    
+00007f70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007f80: 7078 2c20 7079 203d 2070 792c 2070 780a  px, py = py, px.
+00007f90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007fa0: 636f 6e74 6f75 725f 706f 696e 7473 2e61  contour_points.a
+00007fb0: 7070 656e 6428 5b70 782c 2070 795d 290a  ppend([px, py]).
+00007fc0: 2020 2020 2020 2020 2020 2020 706f 696e              poin
+00007fd0: 7473 2e61 7070 656e 6428 6e70 2e61 7272  ts.append(np.arr
+00007fe0: 6179 2863 6f6e 746f 7572 5f70 6f69 6e74  ay(contour_point
+00007ff0: 7329 290a 0a20 2020 2020 2020 2072 6574  s))..        ret
+00008000: 7572 6e20 706f 696e 7473 0a0a 2020 2020  urn points..    
+00008010: 6465 6620 6372 6561 7465 5f6d 6173 6b28  def create_mask(
+00008020: 0a20 2020 2020 2020 2073 656c 662c 200a  .        self, .
+00008030: 2020 2020 2020 2020 666f 7263 653d 4661          force=Fa
+00008040: 6c73 652c 200a 2020 2020 2020 2020 6f76  lse, .        ov
+00008050: 6572 6c61 705f 6c65 7665 6c3d 4e6f 6e65  erlap_level=None
+00008060: 2c20 0a20 2020 2020 2020 2076 6f78 656c  , .        voxel
+00008070: 5f73 697a 653d 4e6f 6e65 2c20 0a20 2020  _size=None, .   
+00008080: 2020 2020 2073 6861 7065 3d4e 6f6e 650a       shape=None.
+00008090: 2020 2020 293a 0a20 2020 2020 2020 2022      ):.        "
+000080a0: 2222 4372 6561 7465 2062 696e 6172 7920  ""Create binary 
+000080b0: 6d61 736b 2072 6570 7265 7365 6e74 6174  mask representat
+000080c0: 696f 6e20 6f66 2074 6869 7320 524f 492e  ion of this ROI.
+000080d0: 2049 6620 7468 6520 524f 4920 7761 7320   If the ROI was 
+000080e0: 6372 6561 7465 640a 2020 2020 2020 2020  created.        
+000080f0: 6672 6f6d 2063 6f6e 746f 7572 732c 2074  from contours, t
+00008100: 6865 7365 2063 6f6e 746f 7572 7320 7769  hese contours wi
+00008110: 6c6c 2062 6520 636f 6e76 6572 7465 6420  ll be converted 
+00008120: 746f 2061 206d 6173 6b3b 2069 6620 7468  to a mask; if th
+00008130: 6520 524f 490a 2020 2020 2020 2020 7761  e ROI.        wa
+00008140: 7320 6372 6561 7465 6420 6672 6f6d 2061  s created from a
+00008150: 206d 6173 6b2c 2074 6869 7320 6d61 736b   mask, this mask
+00008160: 2077 696c 6c20 6265 2063 6173 7420 746f   will be cast to
+00008170: 2061 2062 6f6f 6c65 616e 2061 7272 6179   a boolean array
+00008180: 2061 6e64 0a20 2020 2020 2020 2069 7473   and.        its
+00008190: 2067 656f 656d 7472 6963 2070 726f 7065   geoemtric prope
+000081a0: 7274 6965 7320 7769 6c6c 2062 6520 6173  rties will be as
+000081b0: 7369 676e 6564 2074 6f20 7468 6973 2052  signed to this R
+000081c0: 4f49 2e20 4966 2061 206d 6173 6b20 6861  OI. If a mask ha
+000081d0: 7320 0a20 2020 2020 2020 2061 6c72 6561  s .        alrea
+000081e0: 6479 2062 6565 6e20 6372 6561 7465 642c  dy been created,
+000081f0: 206e 6f74 6869 6e67 2077 696c 6c20 6861   nothing will ha
+00008200: 7070 656e 2075 6e6c 6573 7320 666f 7263  ppen unless forc
+00008210: 653d 5472 7565 2e0a 0a20 2020 2020 2020  e=True...       
+00008220: 202a 2a50 6172 616d 6574 6572 733a 2a2a   **Parameters:**
+00008230: 0a20 2020 2020 2020 200a 2020 2020 2020  .        .      
+00008240: 2020 666f 7263 6520 3a20 626f 6f6c 2c20    force : bool, 
+00008250: 6465 6661 756c 743d 4661 6c73 650a 2020  default=False.  
+00008260: 2020 2020 2020 2020 2020 4966 2054 7275            If Tru
+00008270: 652c 2074 6865 206d 6173 6b20 7769 6c6c  e, the mask will
+00008280: 2062 6520 7265 6372 6561 7465 6420 6576   be recreated ev
+00008290: 656e 2069 6620 6974 2061 6c72 6561 6479  en if it already
+000082a0: 2065 7869 7374 732e 0a0a 2020 2020 2020   exists...      
+000082b0: 2020 6f76 6572 6c61 705f 6c65 7665 6c20    overlap_level 
+000082c0: 3a20 666c 6f61 742c 2064 6566 6175 6c74  : float, default
+000082d0: 3d30 2e32 350a 2020 2020 2020 2020 2020  =0.25.          
+000082e0: 2020 5265 7175 6972 6564 206f 7665 726c    Required overl
+000082f0: 6170 206f 6620 6120 7069 7865 6c20 7769  ap of a pixel wi
+00008300: 7468 2074 6865 2052 4f49 2063 6f6e 746f  th the ROI conto
+00008310: 7572 2069 6e20 6f72 6465 7220 666f 7220  ur in order for 
+00008320: 7468 6520 0a20 2020 2020 2020 2020 2020  the .           
+00008330: 2070 6978 656c 2074 6f20 6265 2061 6464   pixel to be add
+00008340: 6564 2074 6f20 7468 6520 6d61 736b 2e20  ed to the mask. 
+00008350: 4966 204e 6f6e 652c 2074 6865 2076 616c  If None, the val
+00008360: 7565 206f 660a 2020 2020 2020 2020 2020  ue of.          
+00008370: 2020 7365 6c66 2e6f 7665 726c 6170 5f6c    self.overlap_l
+00008380: 6576 656c 2077 696c 6c20 6265 2075 7365  evel will be use
+00008390: 643b 206f 7468 6572 7769 7365 2c0a 2020  d; otherwise,.  
+000083a0: 2020 2020 2020 2020 2020 7365 6c66 2e6f            self.o
+000083b0: 7665 726c 6170 5f6c 6576 656c 2077 696c  verlap_level wil
+000083c0: 6c20 6265 206f 7665 7277 7269 7474 656e  l be overwritten
+000083d0: 2077 6974 6820 7468 6973 2076 616c 7565   with this value
+000083e0: 2e20 4966 2062 6f74 6820 6172 6520 0a20  . If both are . 
+000083f0: 2020 2020 2020 2020 2020 204e 6f6e 652c             None,
+00008400: 2074 6865 206f 7574 7075 7420 6f66 2073   the output of s
+00008410: 6b69 6d61 6765 2e64 7261 772e 706f 6c79  kimage.draw.poly
+00008420: 676f 6e32 6d61 736b 2077 696c 6c20 6265  gon2mask will be
+00008430: 2072 6574 7572 6e65 6420 0a20 2020 2020   returned .     
+00008440: 2020 2020 2020 2077 6974 6820 6e6f 2062         with no b
+00008450: 6f72 6465 7220 6368 6563 6b73 2c20 7768  order checks, wh
+00008460: 6963 6820 6973 2066 6173 7465 7220 7468  ich is faster th
+00008470: 616e 2070 6572 666f 726d 696e 6720 626f  an performing bo
+00008480: 7264 6572 2063 6865 636b 732e 0a0a 2020  rder checks...  
+00008490: 2020 2020 2020 766f 7865 6c5f 7369 7a65        voxel_size
+000084a0: 203a 206c 6973 742c 2064 6566 6175 6c74   : list, default
+000084b0: 3d4e 6f6e 650a 2020 2020 2020 2020 2020  =None.          
+000084c0: 2020 566f 7865 6c20 7369 7a65 7320 6f66    Voxel sizes of
+000084d0: 2074 6865 2064 6573 6972 6564 206d 6173   the desired mas
+000084e0: 6b20 696e 2074 6865 205b 782c 2079 5d20  k in the [x, y] 
+000084f0: 6469 7265 6374 696f 6e2e 204f 6e6c 7920  direction. Only 
+00008500: 7573 6564 2069 6620 0a20 2020 2020 2020  used if .       
+00008510: 2020 2020 2074 6865 2052 4f49 2077 6173       the ROI was
+00008520: 2063 7265 6174 6564 2066 726f 6d20 636f   created from co
+00008530: 6e74 6f75 7273 3b20 6967 6e6f 7265 6420  ntours; ignored 
+00008540: 6966 2052 4f49 2077 6173 2063 7265 6174  if ROI was creat
+00008550: 6564 2066 726f 6d20 0a20 2020 2020 2020  ed from .       
+00008560: 2020 2020 206d 6173 6b2e 2043 6175 7365       mask. Cause
+00008570: 7320 7365 6c66 2e69 6d61 6765 2074 6f20  s self.image to 
+00008580: 6265 2072 6570 6c61 6365 6420 7769 7468  be replaced with
+00008590: 2061 200a 2020 2020 2020 2020 2020 2020   a .            
+000085a0: 626c 616e 6b20 6475 6d6d 7920 696d 6167  blank dummy imag
+000085b0: 6520 7769 7468 2074 6865 7365 2076 6f78  e with these vox
+000085c0: 656c 2073 697a 6573 2e0a 0a20 2020 2020  el sizes...     
+000085d0: 2020 2073 6861 7065 203a 206c 6973 742c     shape : list,
+000085e0: 2064 6566 6175 6c74 3d4e 6f6e 650a 2020   default=None.  
+000085f0: 2020 2020 2020 2020 2020 5368 6170 6520            Shape 
+00008600: 6f66 2074 6865 2064 6573 6972 6564 206d  of the desired m
+00008610: 6173 6b20 696e 2074 6865 205b 782c 2079  ask in the [x, y
+00008620: 5d20 6469 7265 6374 696f 6e2e 204f 6e6c  ] direction. Onl
+00008630: 7920 7573 6564 2069 6620 0a20 2020 2020  y used if .     
+00008640: 2020 2020 2020 203c 766f 7865 6c5f 7369         <voxel_si
+00008650: 7a65 3e20 6973 204e 6f6e 6520 616e 6420  ze> is None and 
+00008660: 7468 6520 524f 4920 7761 7320 6372 6561  the ROI was crea
+00008670: 7465 6420 6672 6f6d 2063 6f6e 746f 7572  ted from contour
+00008680: 733b 200a 2020 2020 2020 2020 2020 2020  s; .            
+00008690: 6967 6e6f 7265 6420 6966 2052 4f49 2077  ignored if ROI w
+000086a0: 6173 2063 7265 6174 6564 2066 726f 6d20  as created from 
+000086b0: 6d61 736b 2e20 4361 7573 6573 2073 656c  mask. Causes sel
+000086c0: 662e 696d 6167 6520 746f 2062 6520 0a20  f.image to be . 
+000086d0: 2020 2020 2020 2020 2020 2072 6570 6c61             repla
+000086e0: 6365 6420 7769 7468 2061 2062 6c61 6e6b  ced with a blank
+000086f0: 2064 756d 6d79 2069 6d61 6765 206f 6620   dummy image of 
+00008700: 7468 6973 2073 6861 7065 2e0a 2020 2020  this shape..    
+00008710: 2020 2020 2222 220a 0a20 2020 2020 2020      """..       
+00008720: 2069 6620 7365 6c66 2e6c 6f61 6465 645f   if self.loaded_
+00008730: 6d61 736b 2061 6e64 206e 6f74 2066 6f72  mask and not for
+00008740: 6365 3a0a 2020 2020 2020 2020 2020 2020  ce:.            
+00008750: 7265 7475 726e 0a0a 2020 2020 2020 2020  return..        
+00008760: 6966 206e 6f74 2073 656c 662e 6c6f 6164  if not self.load
+00008770: 6564 3a0a 2020 2020 2020 2020 2020 2020  ed:.            
+00008780: 7365 6c66 2e6c 6f61 6428 290a 2020 2020  self.load().    
+00008790: 2020 2020 6966 206f 7665 726c 6170 5f6c      if overlap_l
+000087a0: 6576 656c 2069 7320 6e6f 7420 4e6f 6e65  evel is not None
+000087b0: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
+000087c0: 6c66 2e6f 7665 726c 6170 5f6c 6576 656c  lf.overlap_level
+000087d0: 203d 206f 7665 726c 6170 5f6c 6576 656c   = overlap_level
+000087e0: 0a0a 2020 2020 2020 2020 2320 5365 7420  ..        # Set 
+000087f0: 696d 6167 6520 746f 2064 756d 6d79 2069  image to dummy i
+00008800: 6d61 6765 2069 6620 6e65 6564 6564 0a20  mage if needed. 
+00008810: 2020 2020 2020 2069 6620 2866 6f72 6365         if (force
+00008820: 2061 6e64 2028 7368 6170 6520 6973 206e   and (shape is n
+00008830: 6f74 204e 6f6e 6520 6f72 2076 6f78 656c  ot None or voxel
+00008840: 5f73 697a 6520 6973 206e 6f74 204e 6f6e  _size is not Non
+00008850: 6529 2920 5c0a 2020 2020 2020 2020 2020  e)) \.          
+00008860: 206f 7220 2873 656c 662e 636f 6e74 6f75   or (self.contou
+00008870: 7273 5f6f 6e6c 7920 616e 6420 7365 6c66  rs_only and self
+00008880: 2e69 6d61 6765 2069 7320 4e6f 6e65 293a  .image is None):
+00008890: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+000088a0: 662e 7365 745f 696d 6167 655f 746f 5f64  f.set_image_to_d
+000088b0: 756d 6d79 2873 6861 7065 3d73 6861 7065  ummy(shape=shape
+000088c0: 2c20 766f 7865 6c5f 7369 7a65 3d76 6f78  , voxel_size=vox
+000088d0: 656c 5f73 697a 6529 0a0a 2020 2020 2020  el_size)..      
+000088e0: 2020 2320 4372 6561 7465 206d 6173 6b20    # Create mask 
+000088f0: 6672 6f6d 2069 6e70 7574 2078 2d79 2063  from input x-y c
+00008900: 6f6e 746f 7572 7320 0a20 2020 2020 2020  ontours .       
+00008910: 2069 6620 7365 6c66 2e69 6e70 7574 5f63   if self.input_c
+00008920: 6f6e 746f 7572 733a 0a0a 2020 2020 2020  ontours:..      
+00008930: 2020 2020 2020 2320 496e 6974 6961 6c69        # Initiali
+00008940: 7365 2073 656c 662e 6d61 736b 2061 7320  se self.mask as 
+00008950: 696d 6167 650a 2020 2020 2020 2020 2020  image.          
+00008960: 2020 7365 6c66 2e6d 6173 6b20 3d20 736b    self.mask = sk
+00008970: 7274 2e69 6d61 6765 2e49 6d61 6765 280a  rt.image.Image(.
+00008980: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008990: 6e70 2e7a 6572 6f73 2828 7365 6c66 2e73  np.zeros((self.s
+000089a0: 6861 7065 5b31 5d2c 2073 656c 662e 7368  hape[1], self.sh
+000089b0: 6170 655b 305d 2c20 7365 6c66 2e73 6861  ape[0], self.sha
+000089c0: 7065 5b32 5d29 2c0a 2020 2020 2020 2020  pe[2]),.        
+000089d0: 2020 2020 2020 2020 2020 2020 6474 7970              dtyp
+000089e0: 653d 626f 6f6c 292c 0a20 2020 2020 2020  e=bool),.       
+000089f0: 2020 2020 2020 2020 2061 6666 696e 653d           affine=
+00008a00: 7365 6c66 2e61 6666 696e 652c 200a 2020  self.affine, .  
+00008a10: 2020 2020 2020 2020 2020 2020 2020 766f                vo
+00008a20: 7865 6c5f 7369 7a65 3d73 656c 662e 766f  xel_size=self.vo
+00008a30: 7865 6c5f 7369 7a65 2c0a 2020 2020 2020  xel_size,.      
+00008a40: 2020 2020 2020 2020 2020 6f72 6967 696e            origin
+00008a50: 3d73 656c 662e 6f72 6967 696e 0a20 2020  =self.origin.   
+00008a60: 2020 2020 2020 2020 2029 0a0a 2020 2020           )..    
+00008a70: 2020 2020 2020 2020 2320 4372 6561 7465          # Create
+00008a80: 206d 6173 6b20 6f6e 2065 6163 6820 7a20   mask on each z 
+00008a90: 6c61 7965 720a 2020 2020 2020 2020 2020  layer.          
+00008aa0: 2020 666f 7220 7a2c 2063 6f6e 746f 7572    for z, contour
+00008ab0: 7320 696e 2073 656c 662e 696e 7075 745f  s in self.input_
+00008ac0: 636f 6e74 6f75 7273 2e69 7465 6d73 2829  contours.items()
+00008ad0: 3a0a 0a20 2020 2020 2020 2020 2020 2020  :..             
+00008ae0: 2020 2023 204c 6f6f 7020 6f76 6572 2065     # Loop over e
+00008af0: 6163 6820 636f 6e74 6f75 7220 6f6e 2074  ach contour on t
+00008b00: 6865 207a 2073 6c69 6365 0a20 2020 2020  he z slice.     
+00008b10: 2020 2020 2020 2020 2020 2069 7a20 3d20             iz = 
+00008b20: 696e 7428 7365 6c66 2e70 6f73 5f74 6f5f  int(self.pos_to_
+00008b30: 6964 7828 7a2c 2022 7a22 2929 0a20 2020  idx(z, "z")).   
+00008b40: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00008b50: 697a 203e 3d20 7365 6c66 2e6d 6173 6b2e  iz >= self.mask.
+00008b60: 6461 7461 2e73 6861 7065 5b32 5d3a 2020  data.shape[2]:  
+00008b70: 2320 4967 6e6f 7265 2073 6c69 6365 7320  # Ignore slices 
+00008b80: 6f75 7473 6964 6520 6d61 736b 2072 616e  outside mask ran
+00008b90: 6765 0a20 2020 2020 2020 2020 2020 2020  ge.             
+00008ba0: 2020 2020 2020 2063 6f6e 7469 6e75 650a         continue.
+00008bb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00008bc0: 2070 6f73 5f74 6f5f 6964 785f 7665 6320   pos_to_idx_vec 
+00008bd0: 3d20 6e70 2e76 6563 746f 7269 7a65 2873  = np.vectorize(s
+00008be0: 656c 662e 706f 735f 746f 5f69 6478 290a  elf.pos_to_idx).
+00008bf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008c00: 666f 7220 706f 696e 7473 2069 6e20 636f  for points in co
+00008c10: 6e74 6f75 7273 3a0a 0a20 2020 2020 2020  ntours:..       
+00008c20: 2020 2020 2020 2020 2020 2020 2023 2052               # R
+00008c30: 6571 7569 7265 2061 7420 6c65 6173 7420  equire at least 
+00008c40: 3320 706f 696e 7473 2074 6f20 6465 6669  3 points to defi
+00008c50: 6e65 2061 2070 6f6c 7967 6f6e 2e0a 2020  ne a polygon..  
 00008c60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008c70: 2070 6f69 6e74 735f 6964 7820 3d20 6e70   points_idx = np
-00008c80: 2e7a 6572 6f73 2828 706f 696e 7473 2e73  .zeros((points.s
-00008c90: 6861 7065 5b30 5d2c 2032 2929 0a20 2020  hape[0], 2)).   
-00008ca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008cb0: 2066 6f72 2069 2069 6e20 7261 6e67 6528   for i in range(
-00008cc0: 3229 3a0a 2020 2020 2020 2020 2020 2020  2):.            
-00008cd0: 2020 2020 2020 2020 2020 2020 706f 696e              poin
-00008ce0: 7473 5f69 6478 5b3a 2c20 695d 203d 2070  ts_idx[:, i] = p
-00008cf0: 6f73 5f74 6f5f 6964 785f 7665 6328 0a20  os_to_idx_vec(. 
-00008d00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008d10: 2020 2020 2020 2020 2020 2070 6f69 6e74             point
-00008d20: 735b 3a2c 2069 5d2c 2069 2c20 7265 7475  s[:, i], i, retu
-00008d30: 726e 5f69 6e74 3d46 616c 7365 0a20 2020  rn_int=False.   
-00008d40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008d50: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
-00008d60: 2020 2020 2020 2020 2020 2020 2320 4372              # Cr
-00008d70: 6561 7465 2070 6f6c 7967 6f6e 2069 6e20  eate polygon in 
-00008d80: 696e 6465 7820 7370 6163 650a 2020 2020  index space.    
+00008c70: 2020 6966 206c 656e 2870 6f69 6e74 7329    if len(points)
+00008c80: 203c 2033 3a0a 2020 2020 2020 2020 2020   < 3:.          
+00008c90: 2020 2020 2020 2020 2020 2020 2020 636f                co
+00008ca0: 6e74 696e 7565 0a0a 2020 2020 2020 2020  ntinue..        
+00008cb0: 2020 2020 2020 2020 2020 2020 2320 436f              # Co
+00008cc0: 6e76 6572 7420 2878 2c20 7929 2070 6f73  nvert (x, y) pos
+00008cd0: 6974 696f 6e73 2074 6f20 6172 7261 7920  itions to array 
+00008ce0: 696e 6469 6365 730a 2020 2020 2020 2020  indices.        
+00008cf0: 2020 2020 2020 2020 2020 2020 706f 696e              poin
+00008d00: 7473 5f69 6478 203d 206e 702e 7a65 726f  ts_idx = np.zero
+00008d10: 7328 2870 6f69 6e74 732e 7368 6170 655b  s((points.shape[
+00008d20: 305d 2c20 3229 290a 2020 2020 2020 2020  0], 2)).        
+00008d30: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+00008d40: 6920 696e 2072 616e 6765 2832 293a 0a20  i in range(2):. 
+00008d50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008d60: 2020 2020 2020 2070 6f69 6e74 735f 6964         points_id
+00008d70: 785b 3a2c 2069 5d20 3d20 706f 735f 746f  x[:, i] = pos_to
+00008d80: 5f69 6478 5f76 6563 280a 2020 2020 2020  _idx_vec(.      
 00008d90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008da0: 706f 6c79 676f 6e20 3d20 636f 6e74 6f75  polygon = contou
-00008db0: 725f 746f 5f70 6f6c 7967 6f6e 2870 6f69  r_to_polygon(poi
-00008dc0: 6e74 735f 6964 7829 0a0a 2020 2020 2020  nts_idx)..      
-00008dd0: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-00008de0: 4765 7420 6d61 736b 206f 6620 616c 6c20  Get mask of all 
-00008df0: 7069 7865 6c73 2069 6e73 6964 6520 636f  pixels inside co
-00008e00: 6e74 6f75 720a 2020 2020 2020 2020 2020  ntour.          
-00008e10: 2020 2020 2020 2020 2020 6d61 736b 203d            mask =
-00008e20: 2064 7261 772e 706f 6c79 676f 6e32 6d61   draw.polygon2ma
-00008e30: 736b 285b 7365 6c66 2e6d 6173 6b2e 6461  sk([self.mask.da
-00008e40: 7461 2e73 6861 7065 5b31 5d2c 200a 2020  ta.shape[1], .  
-00008e50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008e60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008e70: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00008e80: 6d61 736b 2e64 6174 612e 7368 6170 655b  mask.data.shape[
-00008e90: 305d 5d2c 0a20 2020 2020 2020 2020 2020  0]],.           
-00008ea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008eb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008ec0: 2020 706f 696e 7473 5f69 6478 290a 0a20    points_idx).. 
-00008ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008ee0: 2020 2023 2049 6620 6e6f 2070 6978 656c     # If no pixel
-00008ef0: 2069 6465 6e74 6966 6965 6420 6173 2062   identified as b
-00008f00: 6569 6e67 2069 6e73 6964 6520 636f 6e74  eing inside cont
-00008f10: 6f75 722c 0a20 2020 2020 2020 2020 2020  our,.           
-00008f20: 2020 2020 2020 2020 2023 206c 6162 656c           # label
-00008f30: 2070 6978 656c 2063 6f6e 7461 696e 696e   pixel containin
-00008f40: 6720 636f 6e74 6f75 7220 6365 6e74 726f  g contour centro
-00008f50: 6964 2e0a 2020 2020 2020 2020 2020 2020  id..            
-00008f60: 2020 2020 2020 2020 6966 206e 6f74 206d          if not m
-00008f70: 6173 6b2e 7375 6d28 293a 0a20 2020 2020  ask.sum():.     
-00008f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008f90: 2020 2069 782c 2069 7920 3d20 5b69 6e74     ix, iy = [int
-00008fa0: 2872 6f75 6e64 2878 795b 305d 2929 0a20  (round(xy[0])). 
-00008fb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008fc0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-00008fd0: 6f72 2078 7920 696e 2070 6f6c 7967 6f6e  or xy in polygon
-00008fe0: 2e63 656e 7472 6f69 642e 7879 5d0a 2020  .centroid.xy].  
-00008ff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009000: 2020 2020 2020 6966 2028 2869 7820 3e3d        if ((ix >=
-00009010: 2030 2061 6e64 2069 7820 3c20 6d61 736b   0 and ix < mask
-00009020: 2e73 6861 7065 5b30 5d29 0a20 2020 2020  .shape[0]).     
-00009030: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009040: 2020 2020 2020 2020 2020 2061 6e64 2028             and (
-00009050: 6979 203e 3d20 3020 616e 6420 6979 203c  iy >= 0 and iy <
-00009060: 206d 6173 6b2e 7368 6170 655b 315d 2929   mask.shape[1]))
-00009070: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00009080: 2020 2020 2020 2020 2020 2020 2020 6d61                ma
-00009090: 736b 5b69 782c 2069 795d 203d 2054 7275  sk[ix, iy] = Tru
-000090a0: 650a 0a20 2020 2020 2020 2020 2020 2020  e..             
-000090b0: 2020 2020 2020 2023 2043 6865 636b 206f         # Check o
-000090c0: 7665 726c 6170 206f 6620 6564 6765 2070  verlap of edge p
-000090d0: 6978 656c 730a 2020 2020 2020 2020 2020  ixels.          
-000090e0: 2020 2020 2020 2020 2020 6966 2073 656c            if sel
-000090f0: 662e 6f76 6572 6c61 705f 6c65 7665 6c20  f.overlap_level 
-00009100: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
-00009110: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009120: 2020 2020 2063 6f6e 6e20 3d20 6e64 696d       conn = ndim
-00009130: 6167 652e 6765 6e65 7261 7465 5f62 696e  age.generate_bin
-00009140: 6172 795f 7374 7275 6374 7572 6528 0a20  ary_structure(. 
-00009150: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009160: 2020 2020 2020 2020 2020 2032 2c20 3229             2, 2)
-00009170: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00009180: 2020 2020 2020 2020 2065 6467 6520 3d20           edge = 
-00009190: 6d61 736b 205e 206e 6469 6d61 6765 2e62  mask ^ ndimage.b
-000091a0: 696e 6172 795f 6469 6c61 7469 6f6e 280a  inary_dilation(.
-000091b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000091c0: 2020 2020 2020 2020 2020 2020 6d61 736b              mask
-000091d0: 2c20 636f 6e6e 290a 2020 2020 2020 2020  , conn).        
+00008da0: 2020 2020 2020 706f 696e 7473 5b3a 2c20        points[:, 
+00008db0: 695d 2c20 692c 2072 6574 7572 6e5f 696e  i], i, return_in
+00008dc0: 743d 4661 6c73 650a 2020 2020 2020 2020  t=False.        
+00008dd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008de0: 290a 0a20 2020 2020 2020 2020 2020 2020  )..             
+00008df0: 2020 2020 2020 2023 2043 7265 6174 6520         # Create 
+00008e00: 706f 6c79 676f 6e20 696e 2069 6e64 6578  polygon in index
+00008e10: 2073 7061 6365 0a20 2020 2020 2020 2020   space.         
+00008e20: 2020 2020 2020 2020 2020 2070 6f6c 7967             polyg
+00008e30: 6f6e 203d 2063 6f6e 746f 7572 5f74 6f5f  on = contour_to_
+00008e40: 706f 6c79 676f 6e28 706f 696e 7473 5f69  polygon(points_i
+00008e50: 6478 290a 0a20 2020 2020 2020 2020 2020  dx)..           
+00008e60: 2020 2020 2020 2020 2023 2047 6574 206d           # Get m
+00008e70: 6173 6b20 6f66 2061 6c6c 2070 6978 656c  ask of all pixel
+00008e80: 7320 696e 7369 6465 2063 6f6e 746f 7572  s inside contour
+00008e90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00008ea0: 2020 2020 206d 6173 6b20 3d20 6472 6177       mask = draw
+00008eb0: 2e70 6f6c 7967 6f6e 326d 6173 6b28 5b73  .polygon2mask([s
+00008ec0: 656c 662e 6d61 736b 2e64 6174 612e 7368  elf.mask.data.sh
+00008ed0: 6170 655b 315d 2c20 0a20 2020 2020 2020  ape[1], .       
+00008ee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008ef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008f00: 2020 2020 2020 7365 6c66 2e6d 6173 6b2e        self.mask.
+00008f10: 6461 7461 2e73 6861 7065 5b30 5d5d 2c0a  data.shape[0]],.
+00008f20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008f30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008f40: 2020 2020 2020 2020 2020 2020 2070 6f69               poi
+00008f50: 6e74 735f 6964 7829 0a0a 2020 2020 2020  nts_idx)..      
+00008f60: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+00008f70: 4966 206e 6f20 7069 7865 6c20 6964 656e  If no pixel iden
+00008f80: 7469 6669 6564 2061 7320 6265 696e 6720  tified as being 
+00008f90: 696e 7369 6465 2063 6f6e 746f 7572 2c0a  inside contour,.
+00008fa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008fb0: 2020 2020 2320 6c61 6265 6c20 7069 7865      # label pixe
+00008fc0: 6c20 636f 6e74 6169 6e69 6e67 2063 6f6e  l containing con
+00008fd0: 746f 7572 2063 656e 7472 6f69 642e 0a20  tour centroid.. 
+00008fe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008ff0: 2020 2069 6620 6e6f 7420 6d61 736b 2e73     if not mask.s
+00009000: 756d 2829 3a0a 2020 2020 2020 2020 2020  um():.          
+00009010: 2020 2020 2020 2020 2020 2020 2020 6978                ix
+00009020: 2c20 6979 203d 205b 696e 7428 726f 756e  , iy = [int(roun
+00009030: 6428 7879 5b30 5d29 290a 2020 2020 2020  d(xy[0])).      
+00009040: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009050: 2020 2020 2020 2020 2020 666f 7220 7879            for xy
+00009060: 2069 6e20 706f 6c79 676f 6e2e 6365 6e74   in polygon.cent
+00009070: 726f 6964 2e78 795d 0a20 2020 2020 2020  roid.xy].       
+00009080: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009090: 2069 6620 2828 6978 203e 3d20 3020 616e   if ((ix >= 0 an
+000090a0: 6420 6978 203c 206d 6173 6b2e 7368 6170  d ix < mask.shap
+000090b0: 655b 305d 290a 2020 2020 2020 2020 2020  e[0]).          
+000090c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000090d0: 2020 2020 2020 616e 6420 2869 7920 3e3d        and (iy >=
+000090e0: 2030 2061 6e64 2069 7920 3c20 6d61 736b   0 and iy < mask
+000090f0: 2e73 6861 7065 5b31 5d29 293a 0a20 2020  .shape[1])):.   
+00009100: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009110: 2020 2020 2020 2020 206d 6173 6b5b 6978           mask[ix
+00009120: 2c20 6979 5d20 3d20 5472 7565 0a0a 2020  , iy] = True..  
+00009130: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009140: 2020 2320 4368 6563 6b20 6f76 6572 6c61    # Check overla
+00009150: 7020 6f66 2065 6467 6520 7069 7865 6c73  p of edge pixels
+00009160: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00009170: 2020 2020 2069 6620 7365 6c66 2e6f 7665       if self.ove
+00009180: 726c 6170 5f6c 6576 656c 2069 7320 6e6f  rlap_level is no
+00009190: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
+000091a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000091b0: 636f 6e6e 203d 206e 6469 6d61 6765 2e67  conn = ndimage.g
+000091c0: 656e 6572 6174 655f 6269 6e61 7279 5f73  enerate_binary_s
+000091d0: 7472 7563 7475 7265 280a 2020 2020 2020  tructure(.      
 000091e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000091f0: 6966 2073 656c 662e 6f76 6572 6c61 705f  if self.overlap_
-00009200: 6c65 7665 6c20 3e3d 2030 2e35 3a0a 2020  level >= 0.5:.  
-00009210: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009220: 2020 2020 2020 2020 2020 6564 6765 202b            edge +
-00009230: 3d20 6d61 736b 205e 206e 6469 6d61 6765  = mask ^ ndimage
-00009240: 2e62 696e 6172 795f 6572 6f73 696f 6e28  .binary_erosion(
-00009250: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00009260: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009270: 206d 6173 6b2c 2063 6f6e 6e29 0a0a 2020   mask, conn)..  
-00009280: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009290: 2020 2020 2020 2320 4368 6563 6b20 7768        # Check wh
-000092a0: 6574 6865 7220 6561 6368 2065 6467 6520  ether each edge 
-000092b0: 7069 7865 6c20 6861 7320 7375 6666 6963  pixel has suffic
-000092c0: 6965 6e74 206f 7665 726c 6170 0a20 2020  ient overlap.   
-000092d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000092e0: 2020 2020 2066 6f72 2069 782c 2069 7920       for ix, iy 
-000092f0: 696e 206e 702e 6172 6777 6865 7265 2865  in np.argwhere(e
-00009300: 6467 6529 3a0a 0a20 2020 2020 2020 2020  dge):..         
+000091f0: 2020 2020 2020 322c 2032 290a 2020 2020        2, 2).    
+00009200: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009210: 2020 2020 6564 6765 203d 206d 6173 6b20      edge = mask 
+00009220: 5e20 6e64 696d 6167 652e 6269 6e61 7279  ^ ndimage.binary
+00009230: 5f64 696c 6174 696f 6e28 0a20 2020 2020  _dilation(.     
+00009240: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009250: 2020 2020 2020 206d 6173 6b2c 2063 6f6e         mask, con
+00009260: 6e29 0a20 2020 2020 2020 2020 2020 2020  n).             
+00009270: 2020 2020 2020 2020 2020 2069 6620 7365             if se
+00009280: 6c66 2e6f 7665 726c 6170 5f6c 6576 656c  lf.overlap_level
+00009290: 203e 3d20 302e 353a 0a20 2020 2020 2020   >= 0.5:.       
+000092a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000092b0: 2020 2020 2065 6467 6520 2b3d 206d 6173       edge += mas
+000092c0: 6b20 5e20 6e64 696d 6167 652e 6269 6e61  k ^ ndimage.bina
+000092d0: 7279 5f65 726f 7369 6f6e 280a 2020 2020  ry_erosion(.    
+000092e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000092f0: 2020 2020 2020 2020 2020 2020 6d61 736b              mask
+00009300: 2c20 636f 6e6e 290a 0a20 2020 2020 2020  , conn)..       
 00009310: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009320: 2020 2023 204d 616b 6520 706f 6c79 676f     # Make polygo
-00009330: 6e20 6f66 2063 7572 7265 6e74 2070 6978  n of current pix
-00009340: 656c 0a20 2020 2020 2020 2020 2020 2020  el.             
-00009350: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-00009360: 6978 656c 203d 2067 656f 6d65 7472 792e  ixel = geometry.
-00009370: 506f 6c79 676f 6e28 0a20 2020 2020 2020  Polygon(.       
-00009380: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009390: 2020 2020 2020 2020 205b 0a20 2020 2020           [.     
-000093a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000093b0: 2020 2020 2020 2020 2020 2020 2020 205b                 [
-000093c0: 6978 202d 2030 2e35 2c20 6979 202d 2030  ix - 0.5, iy - 0
-000093d0: 2e35 5d2c 0a20 2020 2020 2020 2020 2020  .5],.           
-000093e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000093f0: 2020 2020 2020 2020 205b 6978 202d 2030           [ix - 0
-00009400: 2e35 2c20 6979 202b 2030 2e35 5d2c 0a20  .5, iy + 0.5],. 
+00009320: 2023 2043 6865 636b 2077 6865 7468 6572   # Check whether
+00009330: 2065 6163 6820 6564 6765 2070 6978 656c   each edge pixel
+00009340: 2068 6173 2073 7566 6669 6369 656e 7420   has sufficient 
+00009350: 6f76 6572 6c61 700a 2020 2020 2020 2020  overlap.        
+00009360: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009370: 666f 7220 6978 2c20 6979 2069 6e20 6e70  for ix, iy in np
+00009380: 2e61 7267 7768 6572 6528 6564 6765 293a  .argwhere(edge):
+00009390: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000093a0: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+000093b0: 4d61 6b65 2070 6f6c 7967 6f6e 206f 6620  Make polygon of 
+000093c0: 6375 7272 656e 7420 7069 7865 6c0a 2020  current pixel.  
+000093d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000093e0: 2020 2020 2020 2020 2020 7069 7865 6c20            pixel 
+000093f0: 3d20 6765 6f6d 6574 7279 2e50 6f6c 7967  = geometry.Polyg
+00009400: 6f6e 280a 2020 2020 2020 2020 2020 2020  on(.            
 00009410: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009420: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009430: 2020 205b 6978 202b 2030 2e35 2c20 6979     [ix + 0.5, iy
-00009440: 202b 2030 2e35 5d2c 0a20 2020 2020 2020   + 0.5],.       
-00009450: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009460: 2020 2020 2020 2020 2020 2020 205b 6978               [ix
-00009470: 202b 2030 2e35 2c20 6979 202d 2030 2e35   + 0.5, iy - 0.5
-00009480: 5d2c 0a20 2020 2020 2020 2020 2020 2020  ],.             
-00009490: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000094a0: 2020 205d 0a20 2020 2020 2020 2020 2020     ].           
-000094b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000094c0: 2029 0a0a 2020 2020 2020 2020 2020 2020   )..            
-000094d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000094e0: 2320 436f 6d70 7574 6520 6f76 6572 6c61  # Compute overla
-000094f0: 700a 2020 2020 2020 2020 2020 2020 2020  p.              
-00009500: 2020 2020 2020 2020 2020 2020 2020 6f76                ov
-00009510: 6572 6c61 7020 3d20 706f 6c79 676f 6e2e  erlap = polygon.
-00009520: 696e 7465 7273 6563 7469 6f6e 2870 6978  intersection(pix
-00009530: 656c 292e 6172 6561 0a20 2020 2020 2020  el).area.       
-00009540: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009550: 2020 2020 206d 6173 6b5b 6978 2c20 6979       mask[ix, iy
-00009560: 5d20 3d20 6f76 6572 6c61 7020 3e20 7365  ] = overlap > se
-00009570: 6c66 2e6f 7665 726c 6170 5f6c 6576 656c  lf.overlap_level
-00009580: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00009590: 2020 2020 2020 2320 4164 6420 746f 2033        # Add to 3
-000095a0: 4420 6d61 736b 0a20 2020 2020 2020 2020  D mask.         
-000095b0: 2020 2020 2020 2020 2020 2074 7279 3a0a             try:.
-000095c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000095d0: 2020 2020 2020 2020 7365 6c66 2e6d 6173          self.mas
-000095e0: 6b2e 6461 7461 5b3a 2c20 3a2c 2069 7a5d  k.data[:, :, iz]
-000095f0: 202b 3d20 6d61 736b 2e54 0a20 2020 2020   += mask.T.     
-00009600: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-00009610: 7863 6570 7420 496e 6465 7845 7272 6f72  xcept IndexError
-00009620: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00009630: 2020 2020 2020 2020 2020 7061 7373 0a0a            pass..
-00009640: 2020 2020 2020 2020 2320 436f 6e76 6572          # Conver
-00009650: 7420 746f 2062 6f6f 6c65 616e 206d 6173  t to boolean mas
-00009660: 6b0a 2020 2020 2020 2020 6966 2068 6173  k.        if has
-00009670: 6174 7472 2873 656c 662e 6d61 736b 2c20  attr(self.mask, 
-00009680: 2264 6174 6122 293a 0a20 2020 2020 2020  "data"):.       
-00009690: 2020 2020 2069 6620 6e6f 7420 7365 6c66       if not self
-000096a0: 2e6d 6173 6b2e 6461 7461 2e64 7479 7065  .mask.data.dtype
-000096b0: 203d 3d20 626f 6f6c 3a0a 2020 2020 2020   == bool:.      
-000096c0: 2020 2020 2020 2020 2020 7365 6c66 2e6d            self.m
-000096d0: 6173 6b2e 6461 7461 203d 2073 656c 662e  ask.data = self.
-000096e0: 6d61 736b 2e64 6174 612e 6173 7479 7065  mask.data.astype
-000096f0: 2862 6f6f 6c29 0a20 2020 2020 2020 2020  (bool).         
-00009700: 2020 2073 656c 662e 6c6f 6164 6564 5f6d     self.loaded_m
-00009710: 6173 6b20 3d20 5472 7565 0a0a 2020 2020  ask = True..    
-00009720: 2020 2020 2320 5365 7420 6f77 6e20 6765      # Set own ge
-00009730: 6f6d 6574 7269 6320 7072 6f70 6572 7469  ometric properti
-00009740: 6573 2066 726f 6d20 6d61 736b 0a20 2020  es from mask.   
-00009750: 2020 2020 2073 656c 662e 766f 7865 6c5f       self.voxel_
-00009760: 7369 7a65 203d 2073 656c 662e 6d61 736b  size = self.mask
-00009770: 2e67 6574 5f76 6f78 656c 5f73 697a 6528  .get_voxel_size(
-00009780: 290a 2020 2020 2020 2020 7365 6c66 2e6f  ).        self.o
-00009790: 7269 6769 6e20 3d20 7365 6c66 2e6d 6173  rigin = self.mas
-000097a0: 6b2e 6765 745f 6f72 6967 696e 2829 0a20  k.get_origin(). 
-000097b0: 2020 2020 2020 2073 656c 662e 6166 6669         self.affi
-000097c0: 6e65 203d 2073 656c 662e 6d61 736b 2e67  ne = self.mask.g
-000097d0: 6574 5f61 6666 696e 6528 290a 2020 2020  et_affine().    
-000097e0: 2020 2020 7365 6c66 2e73 6861 7065 203d      self.shape =
-000097f0: 2073 656c 662e 6d61 736b 2e67 6574 5f64   self.mask.get_d
-00009800: 6174 6128 292e 7368 6170 650a 0a20 2020  ata().shape..   
-00009810: 2064 6566 2069 735f 656d 7074 7928 7365   def is_empty(se
-00009820: 6c66 293a 0a20 2020 2020 2020 2022 2222  lf):.        """
-00009830: 4368 6563 6b20 7768 6574 6865 7220 7468  Check whether th
-00009840: 6973 2052 4f49 2069 7320 656d 7074 792e  is ROI is empty.
-00009850: 2222 220a 0a20 2020 2020 2020 2073 656c  """..        sel
-00009860: 662e 6c6f 6164 2829 0a20 2020 2020 2020  f.load().       
-00009870: 2069 6620 7365 6c66 2e64 6566 6175 6c74   if self.default
-00009880: 5f67 656f 6d5f 6d65 7468 6f64 203d 3d20  _geom_method == 
-00009890: 2263 6f6e 746f 7572 223a 0a20 2020 2020  "contour":.     
-000098a0: 2020 2020 2020 2072 6574 7572 6e20 6e6f         return no
-000098b0: 7420 626f 6f6c 286c 656e 2873 656c 662e  t bool(len(self.
-000098c0: 6765 745f 636f 6e74 6f75 7273 2822 782d  get_contours("x-
-000098d0: 7922 2929 290a 2020 2020 2020 2020 656c  y"))).        el
-000098e0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-000098f0: 7265 7475 726e 206e 6f74 206e 702e 616e  return not np.an
-00009900: 7928 7365 6c66 2e67 6574 5f6d 6173 6b28  y(self.get_mask(
-00009910: 2929 0a0a 2020 2020 6465 6620 7265 7361  ))..    def resa
-00009920: 6d70 6c65 2873 656c 662c 202a 6172 6773  mple(self, *args
-00009930: 2c20 2a2a 6b77 6172 6773 293a 0a20 2020  , **kwargs):.   
-00009940: 2020 2020 2073 656c 662e 6372 6561 7465       self.create
-00009950: 5f6d 6173 6b28 290a 2020 2020 2020 2020  _mask().        
-00009960: 7365 6c66 2e6d 6173 6b2e 7265 7361 6d70  self.mask.resamp
-00009970: 6c65 282a 6172 6773 2c20 2a2a 6b77 6172  le(*args, **kwar
-00009980: 6773 290a 0a20 2020 2064 6566 206d 6174  gs)..    def mat
-00009990: 6368 5f76 6f78 656c 5f73 697a 6528 7365  ch_voxel_size(se
-000099a0: 6c66 2c20 6f74 6865 722c 202a 6172 6773  lf, other, *args
-000099b0: 2c20 2a2a 6b77 6172 6773 293a 0a0a 2020  , **kwargs):..  
-000099c0: 2020 2020 2020 6966 2069 7369 6e73 7461        if isinsta
-000099d0: 6e63 6528 6f74 6865 722c 2052 4f49 293a  nce(other, ROI):
-000099e0: 0a20 2020 2020 2020 2020 2020 206f 7468  .            oth
-000099f0: 6572 2e63 7265 6174 655f 6d61 736b 2829  er.create_mask()
-00009a00: 0a20 2020 2020 2020 2020 2020 206d 6173  .            mas
-00009a10: 6b20 3d20 6f74 6865 722e 6d61 736b 0a20  k = other.mask. 
-00009a20: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-00009a30: 2020 2020 2020 2020 206d 6173 6b20 3d20           mask = 
-00009a40: 6f74 6865 720a 2020 2020 2020 2020 7365  other.        se
-00009a50: 6c66 2e63 7265 6174 655f 6d61 736b 2829  lf.create_mask()
-00009a60: 0a20 2020 2020 2020 2073 656c 662e 6d61  .        self.ma
-00009a70: 736b 2e6d 6174 6368 5f76 6f78 656c 5f73  sk.match_voxel_s
-00009a80: 697a 6528 6d61 736b 2c20 2a61 7267 732c  ize(mask, *args,
-00009a90: 202a 2a6b 7761 7267 7329 0a0a 2020 2020   **kwargs)..    
-00009aa0: 6465 6620 6765 745f 736c 6963 6528 7365  def get_slice(se
-00009ab0: 6c66 2c20 2a61 7267 732c 2066 6f72 6365  lf, *args, force
-00009ac0: 5f73 7461 6e64 6172 6469 7365 3d46 616c  _standardise=Fal
-00009ad0: 7365 2c20 2a2a 6b77 6172 6773 293a 0a0a  se, **kwargs):..
-00009ae0: 2020 2020 2020 2020 7365 6c66 2e63 7265          self.cre
-00009af0: 6174 655f 6d61 736b 2829 0a20 2020 2020  ate_mask().     
-00009b00: 2020 2064 6174 6120 3d20 7365 6c66 2e6d     data = self.m
-00009b10: 6173 6b2e 6765 745f 736c 6963 6528 2a61  ask.get_slice(*a
-00009b20: 7267 732c 2066 6f72 6365 5f73 7461 6e64  rgs, force_stand
-00009b30: 6172 6469 7365 3d66 6f72 6365 5f73 7461  ardise=force_sta
-00009b40: 6e64 6172 6469 7365 2c20 0a20 2020 2020  ndardise, .     
-00009b50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009b60: 2020 2020 2020 2020 2020 2020 2020 2a2a                **
-00009b70: 6b77 6172 6773 290a 2020 2020 2020 2020  kwargs).        
-00009b80: 6966 2064 6174 612e 6474 7970 6520 213d  if data.dtype !=
-00009b90: 2062 6f6f 6c3a 0a20 2020 2020 2020 2020   bool:.         
-00009ba0: 2020 2064 6174 6120 3d20 6461 7461 2e61     data = data.a
-00009bb0: 7374 7970 6528 626f 6f6c 290a 2020 2020  stype(bool).    
-00009bc0: 2020 2020 7265 7475 726e 2064 6174 610a      return data.
-00009bd0: 0a20 2020 2064 6566 2067 6574 5f72 6f69  .    def get_roi
-00009be0: 5f73 6c69 6365 2873 656c 662c 207a 5f66  _slice(self, z_f
-00009bf0: 7261 6374 696f 6e3d 312c 2073 7566 6669  raction=1, suffi
-00009c00: 783d 4e6f 6e65 293a 0a20 2020 2020 2020  x=None):.       
-00009c10: 2022 2222 0a20 2020 2020 2020 2047 6574   """.        Get
-00009c20: 2052 4f49 206f 626a 6563 7420 636f 7272   ROI object corr
-00009c30: 6573 706f 6e64 696e 6720 746f 2078 2d79  esponding to x-y
-00009c40: 2073 6c69 6365 2074 6872 6f75 6768 2074   slice through t
-00009c50: 6869 7320 524f 492e 0a0a 2020 2020 2020  his ROI...      
-00009c60: 2020 2a2a 5061 7261 6d65 7465 723a 2a2a    **Parameter:**
-00009c70: 0a0a 2020 2020 2020 2020 7a5f 6672 6163  ..        z_frac
-00009c80: 7469 6f6e 203a 2066 6c6f 6174 2c20 6465  tion : float, de
-00009c90: 6661 756c 743d 310a 2020 2020 2020 2020  fault=1.        
-00009ca0: 2020 2020 506f 7369 7469 6f6e 2061 6c6f      Position alo
-00009cb0: 6e67 207a 2061 7869 7320 6174 2077 6869  ng z axis at whi
-00009cc0: 6368 2074 6f20 7461 6b65 2073 6c69 6365  ch to take slice
-00009cd0: 2074 6872 6f75 6768 2052 4f49 2e0a 2020   through ROI..  
-00009ce0: 2020 2020 2020 2020 2020 5468 6520 706f            The po
-00009cf0: 7369 7469 6f6e 2069 7320 7370 6563 6966  sition is specif
-00009d00: 6965 6420 6173 2074 6865 2066 7261 6374  ied as the fract
-00009d10: 696f 6e61 6c20 6469 7374 616e 6365 0a20  ional distance. 
-00009d20: 2020 2020 2020 2020 2020 2066 726f 6d20             from 
-00009d30: 7468 6520 524f 4927 7320 6d6f 7374 2d69  the ROI's most-i
-00009d40: 6e66 6572 696f 7220 706f 696e 743a 2030  nferior point: 0
-00009d50: 2063 6f72 7265 7370 6f6e 6473 2074 6f0a   corresponds to.
-00009d60: 2020 2020 2020 2020 2020 2020 7468 6520              the 
-00009d70: 6d6f 7374 2d69 6e66 6572 696f 7220 706f  most-inferior po
-00009d80: 696e 7420 286c 6f77 6573 7420 7a29 3b20  int (lowest z); 
-00009d90: 3120 636f 7272 6573 706f 6e64 7320 746f  1 corresponds to
-00009da0: 2074 6865 0a20 2020 2020 2020 2020 2020   the.           
-00009db0: 206d 6f73 742d 7375 7065 7269 6f72 2070   most-superior p
-00009dc0: 6f69 6e74 2028 6869 6768 6573 7420 7a29  oint (highest z)
-00009dd0: 2e20 2056 616c 7565 7320 666f 7220 7a5f  .  Values for z_
-00009de0: 6672 6163 7469 6f6e 0a20 2020 2020 2020  fraction.       
-00009df0: 2020 2020 206f 7574 7369 6465 2074 6865       outside the
-00009e00: 2069 6e74 6572 7661 6c20 5b30 2c20 315d   interval [0, 1]
-00009e10: 2072 6573 756c 7420 696e 2061 2052 756e   result in a Run
-00009e20: 7469 6d65 4572 726f 722e 0a0a 2020 2020  timeError...    
-00009e30: 7375 6666 6978 203a 2073 7472 2c20 6465  suffix : str, de
-00009e40: 6661 756c 743d 4e6f 6e65 0a20 2020 2020  fault=None.     
-00009e50: 2020 2053 7566 6669 7820 746f 2061 7070     Suffix to app
-00009e60: 656e 6420 746f 206f 776e 206e 616d 652c  end to own name,
-00009e70: 2074 6f20 666f 726d 206e 616d 6520 6f66   to form name of
-00009e80: 206f 7574 7075 7420 524f 492e 2020 4966   output ROI.  If
-00009e90: 0a20 2020 2020 2020 204e 6f6e 652c 2061  .        None, a
-00009ea0: 7070 656e 6420 7a5f 6672 6163 7469 6f6e  ppend z_fraction
-00009eb0: 2c20 7769 7468 2076 616c 7565 2067 6976  , with value giv
-00009ec0: 656e 2074 6f20 7477 6f20 6465 6369 6d61  en to two decima
-00009ed0: 6c20 706c 6163 6573 2e0a 2020 2020 2020  l places..      
-00009ee0: 2020 2222 220a 2020 2020 2020 2020 7265    """.        re
-00009ef0: 7475 726e 2067 6574 5f72 6f69 5f73 6c69  turn get_roi_sli
-00009f00: 6365 2873 656c 662c 207a 5f66 7261 6374  ce(self, z_fract
-00009f10: 696f 6e29 0a0a 2020 2020 6465 6620 6765  ion)..    def ge
-00009f20: 745f 696e 6469 6365 7328 7365 6c66 2c20  t_indices(self, 
-00009f30: 7669 6577 3d22 782d 7922 2c20 6d65 7468  view="x-y", meth
-00009f40: 6f64 3d4e 6f6e 6529 3a0a 2020 2020 2020  od=None):.      
-00009f50: 2020 2222 2247 6574 206c 6973 7420 6f66    """Get list of
-00009f60: 2073 6c69 6365 2069 6e64 6963 6573 206f   slice indices o
-00009f70: 6e20 7768 6963 6820 7468 6973 2052 4f49  n which this ROI
-00009f80: 2065 7869 7374 732e 2222 220a 0a20 2020   exists."""..   
-00009f90: 2020 2020 2073 656c 662e 6c6f 6164 2829       self.load()
-00009fa0: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
-00009fb0: 2e65 6d70 7479 3a0a 2020 2020 2020 2020  .empty:.        
-00009fc0: 2020 2020 7265 7475 726e 205b 5d0a 0a20      return [].. 
-00009fd0: 2020 2020 2020 2069 6620 6d65 7468 6f64         if method
-00009fe0: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
-00009ff0: 2020 2020 2020 6d65 7468 6f64 203d 2073        method = s
-0000a000: 656c 662e 6465 6661 756c 745f 6765 6f6d  elf.default_geom
-0000a010: 5f6d 6574 686f 640a 0a20 2020 2020 2020  _method..       
-0000a020: 2069 6620 6d65 7468 6f64 203d 3d20 2263   if method == "c
-0000a030: 6f6e 746f 7572 223a 0a20 2020 2020 2020  ontour":.       
-0000a040: 2020 2020 2072 6574 7572 6e20 6c69 7374       return list
-0000a050: 2873 656c 662e 6765 745f 636f 6e74 6f75  (self.get_contou
-0000a060: 7273 2876 6965 772c 2069 6478 5f61 735f  rs(view, idx_as_
-0000a070: 6b65 793d 5472 7565 292e 6b65 7973 2829  key=True).keys()
-0000a080: 290a 2020 2020 2020 2020 656c 7365 3a0a  ).        else:.
-0000a090: 2020 2020 2020 2020 2020 2020 6178 203d              ax =
-0000a0a0: 2073 6b72 742e 696d 6167 652e 5f73 6c69   skrt.image._sli
-0000a0b0: 6365 5f61 7865 735b 7669 6577 5d0a 2020  ce_axes[view].  
-0000a0c0: 2020 2020 2020 2020 2020 6d61 736b 203d            mask =
-0000a0d0: 2073 656c 662e 6765 745f 6d61 736b 2873   self.get_mask(s
-0000a0e0: 7461 6e64 6172 6469 7365 3d54 7275 6529  tandardise=True)
-0000a0f0: 2e74 7261 6e73 706f 7365 2831 2c20 302c  .transpose(1, 0,
-0000a100: 2032 290a 2020 2020 2020 2020 2020 2020   2).            
-0000a110: 7265 7475 726e 206c 6973 7428 6e70 2e75  return list(np.u
-0000a120: 6e69 7175 6528 6e70 2e61 7267 7768 6572  nique(np.argwher
-0000a130: 6528 6d61 736b 295b 3a2c 2061 785d 2929  e(mask)[:, ax]))
-0000a140: 0a0a 2020 2020 6465 6620 6765 745f 6d69  ..    def get_mi
-0000a150: 645f 6964 7828 7365 6c66 2c20 7669 6577  d_idx(self, view
-0000a160: 3d22 782d 7922 2c20 2a2a 6b77 6172 6773  ="x-y", **kwargs
-0000a170: 293a 0a20 2020 2020 2020 2022 2222 4765  ):.        """Ge
-0000a180: 7420 6365 6e74 7261 6c20 736c 6963 6520  t central slice 
-0000a190: 696e 6465 7820 6f66 2074 6869 7320 524f  index of this RO
-0000a1a0: 4920 696e 2061 2067 6976 656e 206f 7269  I in a given ori
-0000a1b0: 656e 7461 7469 6f6e 2e22 2222 0a0a 2020  entation."""..  
-0000a1c0: 2020 2020 2020 696e 6469 6365 7320 3d20        indices = 
-0000a1d0: 7365 6c66 2e67 6574 5f69 6e64 6963 6573  self.get_indices
-0000a1e0: 2876 6965 772c 202a 2a6b 7761 7267 7329  (view, **kwargs)
-0000a1f0: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
-0000a200: 6c65 6e28 696e 6469 6365 7329 3a0a 2020  len(indices):.  
-0000a210: 2020 2020 2020 2020 2020 7265 7475 726e            return
-0000a220: 204e 6f6e 650a 2020 2020 2020 2020 6d69   None.        mi
-0000a230: 6420 3d20 696e 7428 6c65 6e28 696e 6469  d = int(len(indi
-0000a240: 6365 7329 202f 2032 290a 2020 2020 2020  ces) / 2).      
-0000a250: 2020 7265 7475 726e 2069 6e64 6963 6573    return indices
-0000a260: 5b6d 6964 5d0a 0a20 2020 2064 6566 2069  [mid]..    def i
-0000a270: 6478 5f74 6f5f 706f 7328 7365 6c66 2c20  dx_to_pos(self, 
-0000a280: 6964 782c 2061 782c 2073 7461 6e64 6172  idx, ax, standar
-0000a290: 6469 7365 3d54 7275 6529 3a0a 2020 2020  dise=True):.    
-0000a2a0: 2020 2020 2222 2243 6f6e 7665 7274 2061      """Convert a
-0000a2b0: 6e20 6172 7261 7920 696e 6465 7820 746f  n array index to
-0000a2c0: 2061 2070 6f73 6974 696f 6e20 696e 206d   a position in m
-0000a2d0: 6d20 616c 6f6e 6720 6120 6769 7665 6e20  m along a given 
-0000a2e0: 6178 6973 2e22 2222 0a0a 2020 2020 2020  axis."""..      
-0000a2f0: 2020 7365 6c66 2e6c 6f61 6428 290a 0a20    self.load().. 
-0000a300: 2020 2020 2020 2069 6620 7365 6c66 2e63         if self.c
-0000a310: 6f6e 746f 7572 735f 6f6e 6c79 3a0a 0a20  ontours_only:.. 
-0000a320: 2020 2020 2020 2020 2020 2023 2055 7365             # Use
-0000a330: 2073 656c 662e 696d 6167 6527 7320 636f   self.image's co
-0000a340: 6e76 6572 7369 6f6e 2066 756e 6374 696f  nversion functio
-0000a350: 6e0a 2020 2020 2020 2020 2020 2020 6966  n.            if
-0000a360: 2073 656c 662e 696d 6167 6520 6973 206e   self.image is n
-0000a370: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
-0000a380: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-0000a390: 7365 6c66 2e69 6d61 6765 2e69 6478 5f74  self.image.idx_t
-0000a3a0: 6f5f 706f 7328 6964 782c 2061 7829 0a0a  o_pos(idx, ax)..
-0000a3b0: 2020 2020 2020 2020 2020 2020 2320 4f74              # Ot
-0000a3c0: 6865 7277 6973 6520 636f 756e 7420 6e75  herwise count nu
-0000a3d0: 6d62 6572 206f 6620 7a20 736c 6963 6573  mber of z slices
-0000a3e0: 2069 6e20 636f 6e74 6f75 7273 2064 6963   in contours dic
-0000a3f0: 740a 2020 2020 2020 2020 2020 2020 2320  t.            # 
-0000a400: 4966 2069 6e64 6578 2064 6f65 7320 6e6f  If index does no
-0000a410: 7420 636f 7272 6573 706f 6e64 2074 6f20  t correspond to 
-0000a420: 6120 736c 6963 652c 2072 6574 7572 6e20  a slice, return 
-0000a430: 4e6f 6e65 0a20 2020 2020 2020 2020 2020  None.           
-0000a440: 2065 6c69 6620 6178 2069 6e20 5b22 7a22   elif ax in ["z"
-0000a450: 2c20 325d 3a0a 2020 2020 2020 2020 2020  , 2]:.          
-0000a460: 2020 2020 2020 636f 6e76 6572 7369 6f6e        conversion
-0000a470: 203d 207b 693a 2070 2066 6f72 2069 2c20   = {i: p for i, 
-0000a480: 7020 696e 200a 2020 2020 2020 2020 2020  p in .          
-0000a490: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a4a0: 2020 2020 656e 756d 6572 6174 6528 7365      enumerate(se
-0000a4b0: 6c66 2e67 6574 5f63 6f6e 746f 7572 7328  lf.get_contours(
-0000a4c0: 2278 2d79 2229 2e6b 6579 7328 2929 7d0a  "x-y").keys())}.
-0000a4d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a4e0: 7265 7475 726e 2063 6f6e 7665 7273 696f  return conversio
-0000a4f0: 6e2e 6765 7428 6964 782c 204e 6f6e 6529  n.get(idx, None)
-0000a500: 0a0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
-0000a510: 4f74 6865 7277 6973 652c 206e 6f74 2070  Otherwise, not p
-0000a520: 6f73 7369 626c 6520 746f 2063 6f6e 7665  ossible to conve
-0000a530: 7274 2078 2f79 2070 6f69 6e74 7320 746f  rt x/y points to
-0000a540: 2069 6e64 6963 6573 0a20 2020 2020 2020   indices.       
-0000a550: 2020 2020 2023 2066 726f 6d20 636f 6e74       # from cont
-0000a560: 6f75 7273 2061 6c6f 6e65 0a20 2020 2020  ours alone.     
-0000a570: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-0000a580: 2020 2020 2020 2020 2020 2020 2070 7269               pri
-0000a590: 6e74 2822 5761 726e 696e 673a 2063 616e  nt("Warning: can
-0000a5a0: 6e6f 7420 636f 6e76 6572 7420 696e 6465  not convert inde
-0000a5b0: 7820 746f 2070 6f73 6974 696f 6e20 696e  x to position in
-0000a5c0: 2074 6865 2078 2f79 2022 0a20 2020 2020   the x/y ".     
-0000a5d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a5e0: 2022 6469 7265 6374 696f 6e73 2077 6974   "directions wit
-0000a5f0: 686f 7574 2061 7373 6f63 6961 7465 6420  hout associated 
-0000a600: 696d 6167 6520 6765 6f6d 6574 7279 2122  image geometry!"
-0000a610: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0000a620: 2020 7265 7475 726e 0a0a 2020 2020 2020    return..      
-0000a630: 2020 2320 4f74 6865 7277 6973 652c 2074    # Otherwise, t
-0000a640: 7279 2074 6f20 7573 6520 6d61 736b 206f  ry to use mask o
-0000a650: 7220 696d 6167 6527 7320 636f 6e76 6572  r image's conver
-0000a660: 7369 6f6e 0a20 2020 2020 2020 2065 6c69  sion.        eli
-0000a670: 6620 7365 6c66 2e6d 6173 6b20 6973 206e  f self.mask is n
-0000a680: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
-0000a690: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
-0000a6a0: 2e6d 6173 6b2e 6964 785f 746f 5f70 6f73  .mask.idx_to_pos
-0000a6b0: 2869 6478 2c20 6178 290a 2020 2020 2020  (idx, ax).      
-0000a6c0: 2020 656c 6966 2073 656c 662e 696d 6167    elif self.imag
-0000a6d0: 6520 6973 206e 6f74 204e 6f6e 653a 0a20  e is not None:. 
-0000a6e0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-0000a6f0: 6e20 7365 6c66 2e69 6d61 6765 2e69 6478  n self.image.idx
-0000a700: 5f74 6f5f 706f 7328 6964 782c 2061 7829  _to_pos(idx, ax)
-0000a710: 0a0a 2020 2020 2020 2020 2320 456c 7365  ..        # Else
-0000a720: 2c20 7472 7920 746f 2063 616c 6375 6c61  , try to calcula
-0000a730: 7465 2066 726f 6d20 6f77 6e20 6765 6f6d  te from own geom
-0000a740: 6574 7269 6320 7072 6f70 6572 7469 6573  etric properties
-0000a750: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
-0000a760: 2020 2020 2020 2020 2020 2069 5f61 7820             i_ax 
-0000a770: 3d20 736b 7274 2e69 6d61 6765 2e5f 6178  = skrt.image._ax
-0000a780: 6573 2e69 6e64 6578 2861 7829 2069 6620  es.index(ax) if 
-0000a790: 6178 2069 6e20 736b 7274 2e69 6d61 6765  ax in skrt.image
-0000a7a0: 2e5f 6178 6573 2065 6c73 6520 6178 0a20  ._axes else ax. 
-0000a7b0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-0000a7c0: 6e20 7365 6c66 2e6f 7269 6769 6e5b 695f  n self.origin[i_
-0000a7d0: 6178 5d20 2b20 6964 7820 2a20 7365 6c66  ax] + idx * self
-0000a7e0: 2e76 6f78 656c 5f73 697a 655b 695f 6178  .voxel_size[i_ax
-0000a7f0: 5d0a 0a20 2020 2064 6566 2070 6f73 5f74  ]..    def pos_t
-0000a800: 6f5f 6964 7828 7365 6c66 2c20 706f 732c  o_idx(self, pos,
-0000a810: 2061 782c 2072 6574 7572 6e5f 696e 743d   ax, return_int=
-0000a820: 5472 7565 2c20 2a2a 6b77 6172 6773 293a  True, **kwargs):
-0000a830: 0a20 2020 2020 2020 2022 2222 436f 6e76  .        """Conv
-0000a840: 6572 7420 6120 706f 7369 7469 6f6e 2069  ert a position i
-0000a850: 6e20 6d6d 2074 6f20 616e 2061 7272 6179  n mm to an array
-0000a860: 2069 6e64 6578 2061 6c6f 6e67 2061 2067   index along a g
-0000a870: 6976 656e 2061 7869 732e 2222 220a 0a20  iven axis.""".. 
-0000a880: 2020 2020 2020 2073 656c 662e 6c6f 6164         self.load
-0000a890: 2829 0a20 2020 2020 2020 2069 6620 7365  ().        if se
-0000a8a0: 6c66 2e63 6f6e 746f 7572 735f 6f6e 6c79  lf.contours_only
-0000a8b0: 3a0a 0a20 2020 2020 2020 2020 2020 2023  :..            #
-0000a8c0: 2055 7365 2073 656c 662e 696d 6167 6527   Use self.image'
-0000a8d0: 7320 636f 6e76 6572 7369 6f6e 2066 756e  s conversion fun
-0000a8e0: 6374 696f 6e0a 2020 2020 2020 2020 2020  ction.          
-0000a8f0: 2020 6966 2073 656c 662e 696d 6167 6520    if self.image 
-0000a900: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
-0000a910: 2020 2020 2020 2020 2020 2020 2072 6574               ret
-0000a920: 7572 6e20 7365 6c66 2e69 6d61 6765 2e70  urn self.image.p
-0000a930: 6f73 5f74 6f5f 6964 7828 706f 732c 2061  os_to_idx(pos, a
-0000a940: 782c 2072 6574 7572 6e5f 696e 7429 0a0a  x, return_int)..
-0000a950: 2020 2020 2020 2020 2020 2020 2320 4f74              # Ot
-0000a960: 6865 7277 6973 6520 636f 756e 7420 6e75  herwise count nu
-0000a970: 6d62 6572 206f 6620 7a20 736c 6963 6573  mber of z slices
-0000a980: 2069 6e20 636f 6e74 6f75 7273 2064 6963   in contours dic
-0000a990: 740a 2020 2020 2020 2020 2020 2020 2320  t.            # 
-0000a9a0: 4966 2070 6f73 6974 696f 6e20 646f 6573  If position does
-0000a9b0: 206e 6f74 2063 6f72 7265 7370 6f6e 6420   not correspond 
-0000a9c0: 746f 2061 2073 6c69 652c 2072 6574 7572  to a slie, retur
-0000a9d0: 6e20 4e6f 6e65 0a20 2020 2020 2020 2020  n None.         
-0000a9e0: 2020 2065 6c69 6620 6178 2069 6e20 5b22     elif ax in ["
-0000a9f0: 7a22 2c20 325d 3a0a 2020 2020 2020 2020  z", 2]:.        
-0000aa00: 2020 2020 2020 2020 636f 6e76 6572 7369          conversi
-0000aa10: 6f6e 203d 207b 703a 2069 2066 6f72 2069  on = {p: i for i
-0000aa20: 2c20 7020 696e 200a 2020 2020 2020 2020  , p in .        
-0000aa30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000aa40: 2020 2020 2020 656e 756d 6572 6174 6528        enumerate(
-0000aa50: 7365 6c66 2e67 6574 5f63 6f6e 746f 7572  self.get_contour
-0000aa60: 7328 2278 2d79 2229 2e6b 6579 7328 2929  s("x-y").keys())
-0000aa70: 7d0a 2020 2020 2020 2020 2020 2020 2020  }.              
-0000aa80: 2020 6964 7820 3d20 636f 6e76 6572 7369    idx = conversi
-0000aa90: 6f6e 2e67 6574 2870 6f73 2c20 4e6f 6e65  on.get(pos, None
-0000aaa0: 290a 0a20 2020 2020 2020 2020 2020 2023  )..            #
-0000aab0: 204f 7468 6572 7769 7365 2c20 6e6f 7420   Otherwise, not 
-0000aac0: 706f 7373 6962 6c65 2074 6f20 636f 6e76  possible to conv
-0000aad0: 6572 7420 782f 7920 706f 696e 7473 2074  ert x/y points t
-0000aae0: 6f20 696e 6469 6365 730a 2020 2020 2020  o indices.      
-0000aaf0: 2020 2020 2020 2320 6672 6f6d 2063 6f6e        # from con
-0000ab00: 746f 7572 7320 616c 6f6e 650a 2020 2020  tours alone.    
-0000ab10: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-0000ab20: 2020 2020 2020 2020 2020 2020 2020 7072                pr
-0000ab30: 696e 7428 2257 6172 6e69 6e67 3a20 6361  int("Warning: ca
-0000ab40: 6e6e 6f74 2063 6f6e 7665 7274 2070 6f73  nnot convert pos
-0000ab50: 6974 696f 6e20 746f 2069 6e64 6578 2069  ition to index i
-0000ab60: 6e20 7468 6520 782f 7920 220a 2020 2020  n the x/y ".    
-0000ab70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ab80: 2020 2264 6972 6563 7469 6f6e 7320 7769    "directions wi
-0000ab90: 7468 6f75 7420 6173 736f 6369 6174 6564  thout associated
-0000aba0: 2069 6d61 6765 2067 656f 6d65 7472 7921   image geometry!
-0000abb0: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
-0000abc0: 2020 2072 6574 7572 6e0a 2020 2020 2020     return.      
-0000abd0: 2020 2020 2020 6966 2072 6574 7572 6e5f        if return_
-0000abe0: 696e 7420 616e 6420 6964 7820 6973 206e  int and idx is n
-0000abf0: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
-0000ac00: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-0000ac10: 726f 756e 6428 6964 7829 0a20 2020 2020  round(idx).     
-0000ac20: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-0000ac30: 2020 2020 2020 2020 2020 2020 2072 6574               ret
-0000ac40: 7572 6e20 6964 780a 0a20 2020 2020 2020  urn idx..       
-0000ac50: 2023 204f 7468 6572 7769 7365 2c20 7472   # Otherwise, tr
-0000ac60: 7920 746f 2075 7365 206d 6173 6b20 6f72  y to use mask or
-0000ac70: 2069 6d61 6765 2773 2063 6f6e 7665 7273   image's convers
-0000ac80: 696f 6e0a 2020 2020 2020 2020 656c 6966  ion.        elif
-0000ac90: 2073 656c 662e 6d61 736b 2069 7320 6e6f   self.mask is no
-0000aca0: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
-0000acb0: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
-0000acc0: 6d61 736b 2e70 6f73 5f74 6f5f 6964 7828  mask.pos_to_idx(
-0000acd0: 706f 732c 2061 782c 2072 6574 7572 6e5f  pos, ax, return_
-0000ace0: 696e 7429 0a20 2020 2020 2020 2065 6c69  int).        eli
-0000acf0: 6620 7365 6c66 2e69 6d61 6765 2069 7320  f self.image is 
-0000ad00: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
-0000ad10: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-0000ad20: 662e 696d 6167 652e 706f 735f 746f 5f69  f.image.pos_to_i
-0000ad30: 6478 2870 6f73 2c20 6178 2c20 7265 7475  dx(pos, ax, retu
-0000ad40: 726e 5f69 6e74 290a 0a20 2020 2020 2020  rn_int)..       
-0000ad50: 2023 2045 6c73 652c 2074 7279 2074 6f20   # Else, try to 
-0000ad60: 6361 6c63 756c 6174 6520 6672 6f6d 206f  calculate from o
-0000ad70: 776e 2067 656f 6d74 7269 6320 7072 6f70  wn geomtric prop
-0000ad80: 6572 7469 6573 0a20 2020 2020 2020 2065  erties.        e
-0000ad90: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-0000ada0: 2069 5f61 7820 3d20 736b 7274 2e69 6d61   i_ax = skrt.ima
-0000adb0: 6765 2e5f 6178 6573 2e69 6e64 6578 2861  ge._axes.index(a
-0000adc0: 7829 2069 6620 6178 2069 6e20 736b 7274  x) if ax in skrt
-0000add0: 2e69 6d61 6765 2e5f 6178 6573 2065 6c73  .image._axes els
-0000ade0: 6520 6178 0a20 2020 2020 2020 2020 2020  e ax.           
-0000adf0: 2069 6478 203d 2028 706f 7320 2d20 7365   idx = (pos - se
-0000ae00: 6c66 2e6f 7269 6769 6e5b 695f 6178 5d29  lf.origin[i_ax])
-0000ae10: 202f 2073 656c 662e 766f 7865 6c5f 7369   / self.voxel_si
-0000ae20: 7a65 5b69 5f61 785d 0a20 2020 2020 2020  ze[i_ax].       
-0000ae30: 2020 2020 2069 6620 7265 7475 726e 5f69       if return_i
-0000ae40: 6e74 3a0a 2020 2020 2020 2020 2020 2020  nt:.            
-0000ae50: 2020 2020 7265 7475 726e 2072 6f75 6e64      return round
-0000ae60: 2869 6478 290a 2020 2020 2020 2020 2020  (idx).          
-0000ae70: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-0000ae80: 2020 2020 2020 2020 7265 7475 726e 2069          return i
-0000ae90: 6478 0a0a 2020 2020 6465 6620 6964 785f  dx..    def idx_
-0000aea0: 746f 5f73 6c69 6365 2873 656c 662c 2069  to_slice(self, i
-0000aeb0: 6478 2c20 6178 293a 0a20 2020 2020 2020  dx, ax):.       
-0000aec0: 2022 2222 436f 6e76 6572 7420 616e 2061   """Convert an a
-0000aed0: 7272 6179 2069 6e64 6578 2074 6f20 6120  rray index to a 
-0000aee0: 736c 6963 6520 6e75 6d62 6572 2061 6c6f  slice number alo
-0000aef0: 6e67 2061 2067 6976 656e 2061 7869 732e  ng a given axis.
-0000af00: 2222 220a 0a20 2020 2020 2020 2073 656c  """..        sel
-0000af10: 662e 6c6f 6164 2829 0a20 2020 2020 2020  f.load().       
-0000af20: 2069 6620 7365 6c66 2e63 6f6e 746f 7572   if self.contour
-0000af30: 735f 6f6e 6c79 206f 7220 2873 656c 662e  s_only or (self.
-0000af40: 6d61 736b 2069 7320 4e6f 6e65 2061 6e64  mask is None and
-0000af50: 2073 656c 662e 696d 6167 6520 6973 204e   self.image is N
-0000af60: 6f6e 6529 3a0a 0a20 2020 2020 2020 2020  one):..         
-0000af70: 2020 2023 2043 6f75 6e74 206e 756d 6265     # Count numbe
-0000af80: 7220 6f66 207a 2073 6c69 6365 7320 696e  r of z slices in
-0000af90: 2063 6f6e 746f 7572 7320 6469 6374 0a20   contours dict. 
-0000afa0: 2020 2020 2020 2020 2020 2069 6620 6178             if ax
-0000afb0: 2069 6e20 5b22 7a22 2c20 325d 3a0a 2020   in ["z", 2]:.  
-0000afc0: 2020 2020 2020 2020 2020 2020 2020 6e7a                nz
-0000afd0: 203d 2073 656c 662e 6765 745f 6e7a 5f63   = self.get_nz_c
-0000afe0: 6f6e 746f 7572 7328 290a 2020 2020 2020  ontours().      
-0000aff0: 2020 2020 2020 2020 2020 7265 7475 726e            return
-0000b000: 206e 7a20 2d20 6964 780a 2020 2020 2020   nz - idx.      
-0000b010: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-0000b020: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-0000b030: 726e 2069 6478 202b 2031 0a0a 2020 2020  rn idx + 1..    
-0000b040: 2020 2020 2320 5472 7920 746f 2075 7365      # Try to use
-0000b050: 206d 6173 6b20 6f72 2069 6d61 6765 2773   mask or image's
-0000b060: 2063 6f6e 7665 7273 696f 6e0a 2020 2020   conversion.    
-0000b070: 2020 2020 656c 6966 2073 656c 662e 6d61      elif self.ma
-0000b080: 736b 2069 7320 6e6f 7420 4e6f 6e65 3a0a  sk is not None:.
-0000b090: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-0000b0a0: 726e 2073 656c 662e 6d61 736b 2e69 6478  rn self.mask.idx
-0000b0b0: 5f74 6f5f 736c 6963 6528 6964 782c 2061  _to_slice(idx, a
-0000b0c0: 7829 0a20 2020 2020 2020 2065 6c73 653a  x).        else:
-0000b0d0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-0000b0e0: 7572 6e20 7365 6c66 2e69 6d61 6765 2e69  urn self.image.i
-0000b0f0: 6478 5f74 6f5f 736c 6963 6528 6964 782c  dx_to_slice(idx,
-0000b100: 2061 7829 0a0a 2020 2020 6465 6620 736c   ax)..    def sl
-0000b110: 6963 655f 746f 5f69 6478 2873 656c 662c  ice_to_idx(self,
-0000b120: 2073 6c2c 2061 7829 3a0a 2020 2020 2020   sl, ax):.      
-0000b130: 2020 2222 2243 6f6e 7665 7274 2061 2073    """Convert a s
-0000b140: 6c69 6365 206e 756d 6265 7220 746f 2061  lice number to a
-0000b150: 6e20 6172 7261 7920 696e 6465 782e 2222  n array index.""
-0000b160: 220a 0a20 2020 2020 2020 2073 656c 662e  "..        self.
-0000b170: 6c6f 6164 2829 0a20 2020 2020 2020 2069  load().        i
-0000b180: 6620 7365 6c66 2e63 6f6e 746f 7572 735f  f self.contours_
-0000b190: 6f6e 6c79 206f 7220 2873 656c 662e 6d61  only or (self.ma
-0000b1a0: 736b 2069 7320 4e6f 6e65 2061 6e64 2073  sk is None and s
-0000b1b0: 656c 662e 696d 6167 6520 6973 204e 6f6e  elf.image is Non
-0000b1c0: 6529 3a0a 0a20 2020 2020 2020 2020 2020  e):..           
-0000b1d0: 2023 2043 6f75 6e74 206e 756d 6265 7220   # Count number 
-0000b1e0: 6f66 207a 2073 6c69 6365 7320 696e 2063  of z slices in c
-0000b1f0: 6f6e 746f 7572 7320 6469 6374 0a20 2020  ontours dict.   
-0000b200: 2020 2020 2020 2020 2069 6620 6178 2069           if ax i
-0000b210: 6e20 5b22 7a22 2c20 325d 3a0a 2020 2020  n ["z", 2]:.    
-0000b220: 2020 2020 2020 2020 2020 2020 6e7a 203d              nz =
-0000b230: 2073 656c 662e 6765 745f 6e7a 5f63 6f6e   self.get_nz_con
-0000b240: 746f 7572 7328 290a 2020 2020 2020 2020  tours().        
-0000b250: 2020 2020 2020 2020 7265 7475 726e 206e          return n
-0000b260: 7a20 2d20 736c 0a20 2020 2020 2020 2020  z - sl.         
-0000b270: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-0000b280: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-0000b290: 736c 202d 2031 0a0a 2020 2020 2020 2020  sl - 1..        
-0000b2a0: 2320 5472 7920 746f 2075 7365 206d 6173  # Try to use mas
-0000b2b0: 6b20 6f72 2069 6d61 6765 2773 2063 6f6e  k or image's con
-0000b2c0: 7665 7273 696f 6e0a 2020 2020 2020 2020  version.        
-0000b2d0: 656c 6966 2073 656c 662e 6d61 736b 2069  elif self.mask i
-0000b2e0: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
-0000b2f0: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-0000b300: 656c 662e 6d61 736b 2e73 6c69 6365 5f74  elf.mask.slice_t
-0000b310: 6f5f 6964 7828 736c 2c20 6178 290a 2020  o_idx(sl, ax).  
-0000b320: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-0000b330: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-0000b340: 656c 662e 696d 6167 652e 736c 6963 655f  elf.image.slice_
-0000b350: 746f 5f69 6478 2873 6c2c 2061 7829 0a0a  to_idx(sl, ax)..
-0000b360: 2020 2020 6465 6620 706f 735f 746f 5f73      def pos_to_s
-0000b370: 6c69 6365 2873 656c 662c 2070 6f73 2c20  lice(self, pos, 
-0000b380: 6178 2c20 7265 7475 726e 5f69 6e74 3d54  ax, return_int=T
-0000b390: 7275 652c 2073 7461 6e64 6172 6469 7365  rue, standardise
-0000b3a0: 3d54 7275 6529 3a0a 2020 2020 2020 2020  =True):.        
-0000b3b0: 2222 2243 6f6e 7665 7274 2061 2070 6f73  """Convert a pos
-0000b3c0: 6974 696f 6e20 696e 206d 6d20 746f 2061  ition in mm to a
-0000b3d0: 2073 6c69 6365 206e 756d 6265 7220 616c   slice number al
-0000b3e0: 6f6e 6720 6120 6769 7665 6e20 6178 6973  ong a given axis
-0000b3f0: 2e22 2222 0a0a 2020 2020 2020 2020 7265  ."""..        re
-0000b400: 7475 726e 2073 6b72 742e 696d 6167 652e  turn skrt.image.
-0000b410: 496d 6167 652e 706f 735f 746f 5f73 6c69  Image.pos_to_sli
-0000b420: 6365 2873 656c 662c 2070 6f73 2c20 6178  ce(self, pos, ax
-0000b430: 2c20 7265 7475 726e 5f69 6e74 290a 0a20  , return_int).. 
-0000b440: 2020 2064 6566 2073 6c69 6365 5f74 6f5f     def slice_to_
-0000b450: 706f 7328 7365 6c66 2c20 736c 2c20 6178  pos(self, sl, ax
-0000b460: 2c20 7374 616e 6461 7264 6973 653d 5472  , standardise=Tr
-0000b470: 7565 293a 0a20 2020 2020 2020 2022 2222  ue):.        """
-0000b480: 436f 6e76 6572 7420 6120 736c 6963 6520  Convert a slice 
-0000b490: 6e75 6d62 6572 2074 6f20 6120 706f 7369  number to a posi
-0000b4a0: 7469 6f6e 2069 6e20 6d6d 2061 6c6f 6e67  tion in mm along
-0000b4b0: 2061 2067 6976 656e 2061 7869 732e 2222   a given axis.""
-0000b4c0: 220a 0a20 2020 2020 2020 2072 6574 7572  "..        retur
-0000b4d0: 6e20 736b 7274 2e69 6d61 6765 2e49 6d61  n skrt.image.Ima
-0000b4e0: 6765 2e73 6c69 6365 5f74 6f5f 706f 7328  ge.slice_to_pos(
-0000b4f0: 7365 6c66 2c20 736c 2c20 6178 290a 0a20  self, sl, ax).. 
-0000b500: 2020 2064 6566 2067 6574 5f69 6478 2873     def get_idx(s
-0000b510: 656c 662c 2076 6965 772c 2073 6c3d 4e6f  elf, view, sl=No
-0000b520: 6e65 2c20 6964 783d 4e6f 6e65 2c20 706f  ne, idx=None, po
-0000b530: 733d 4e6f 6e65 293a 0a20 2020 2020 2020  s=None):.       
-0000b540: 2022 2222 4765 7420 616e 2061 7272 6179   """Get an array
-0000b550: 2069 6e64 6578 2066 726f 6d20 6569 7468   index from eith
-0000b560: 6572 2061 2073 6c69 6365 206e 756d 6265  er a slice numbe
-0000b570: 722c 2069 6e64 6578 2c20 6f72 0a20 2020  r, index, or.   
-0000b580: 2020 2020 2070 6f73 6974 696f 6e2e 2222       position.""
-0000b590: 220a 0a20 2020 2020 2020 2072 6574 7572  "..        retur
-0000b5a0: 6e20 736b 7274 2e69 6d61 6765 2e49 6d61  n skrt.image.Ima
-0000b5b0: 6765 2e67 6574 5f69 6478 2873 656c 662c  ge.get_idx(self,
-0000b5c0: 2076 6965 772c 2073 6c3d 736c 2c20 6964   view, sl=sl, id
-0000b5d0: 783d 6964 782c 2070 6f73 3d70 6f73 290a  x=idx, pos=pos).
-0000b5e0: 0a20 2020 2064 6566 206f 6e5f 736c 6963  .    def on_slic
-0000b5f0: 6528 7365 6c66 2c20 7669 6577 2c20 736c  e(self, view, sl
-0000b600: 3d4e 6f6e 652c 2069 6478 3d4e 6f6e 652c  =None, idx=None,
-0000b610: 2070 6f73 3d4e 6f6e 6529 3a0a 2020 2020   pos=None):.    
-0000b620: 2020 2020 2222 2243 6865 636b 2077 6865      """Check whe
-0000b630: 7468 6572 2074 6869 7320 524f 4920 6578  ther this ROI ex
-0000b640: 6973 7473 206f 6e20 6120 6769 7665 6e20  ists on a given 
-0000b650: 736c 6963 652e 2222 220a 0a20 2020 2020  slice."""..     
-0000b660: 2020 2069 6620 736c 2069 7320 4e6f 6e65     if sl is None
-0000b670: 2061 6e64 2069 6478 2069 7320 4e6f 6e65   and idx is None
-0000b680: 2061 6e64 2070 6f73 2069 7320 4e6f 6e65   and pos is None
-0000b690: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
-0000b6a0: 7475 726e 2046 616c 7365 0a20 2020 2020  turn False.     
-0000b6b0: 2020 2069 6478 203d 2073 656c 662e 6765     idx = self.ge
-0000b6c0: 745f 6964 7828 7669 6577 2c20 736c 2c20  t_idx(view, sl, 
-0000b6d0: 6964 782c 2070 6f73 290a 2020 2020 2020  idx, pos).      
-0000b6e0: 2020 6966 2069 6478 2069 7320 4e6f 6e65    if idx is None
-0000b6f0: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
-0000b700: 7475 726e 2046 616c 7365 0a20 2020 2020  turn False.     
-0000b710: 2020 2072 6574 7572 6e20 6964 7820 696e     return idx in
-0000b720: 2073 656c 662e 6765 745f 696e 6469 6365   self.get_indice
-0000b730: 7328 7669 6577 290a 0a20 2020 2064 6566  s(view)..    def
-0000b740: 2069 6e74 6572 706f 6c61 7465 5f70 6f69   interpolate_poi
-0000b750: 6e74 7328 7365 6c66 2c20 6e5f 706f 696e  nts(self, n_poin
-0000b760: 743d 4e6f 6e65 2c20 6478 793d 4e6f 6e65  t=None, dxy=None
-0000b770: 2c0a 2020 2020 2020 2020 736d 6f6f 7468  ,.        smooth
-0000b780: 6e65 7373 5f70 6572 5f70 6f69 6e74 3d30  ness_per_point=0
-0000b790: 293a 0a20 2020 2020 2020 2027 2727 0a20  ):.        '''. 
-0000b7a0: 2020 2020 2020 2052 6574 7572 6e20 6e65         Return ne
-0000b7b0: 7720 524f 4920 6f62 6a65 6374 2c20 7769  w ROI object, wi
-0000b7c0: 7468 2069 6e74 6572 706f 6c61 7465 6420  th interpolated 
-0000b7d0: 636f 6e74 6f75 7220 706f 696e 7473 2e0a  contour points..
-0000b7e0: 0a20 2020 2020 2020 202a 2a50 6172 616d  .        **Param
-0000b7f0: 6574 6572 733a 2a2a 0a0a 2020 2020 2020  eters:**..      
-0000b800: 2020 6e5f 706f 696e 7420 3a20 696e 742c    n_point : int,
-0000b810: 2064 6566 6175 6c74 3d4e 6f6e 650a 2020   default=None.  
-0000b820: 2020 2020 2020 2020 2020 4e75 6d62 6572            Number
-0000b830: 206f 6620 706f 696e 7473 2070 6572 2063   of points per c
-0000b840: 6f6e 746f 7572 2c20 6166 7465 7220 696e  ontour, after in
-0000b850: 7465 7270 6f6c 6174 696f 6e2e 2020 5468  terpolation.  Th
-0000b860: 6973 206d 7573 740a 2020 2020 2020 2020  is must.        
-0000b870: 2020 2020 6265 2073 6574 2074 6f20 4e6f      be set to No
-0000b880: 6e65 2066 6f72 2064 7879 2074 6f20 6265  ne for dxy to be
-0000b890: 2063 6f6e 7369 6465 7265 642e 0a0a 2020   considered...  
-0000b8a0: 2020 2020 2020 6478 7920 3a20 666c 6f61        dxy : floa
-0000b8b0: 742c 2064 6566 6175 6c74 3d4e 6f6e 650a  t, default=None.
-0000b8c0: 2020 2020 2020 2020 2020 2020 4170 7072              Appr
-0000b8d0: 6f78 696d 6174 6520 6469 7374 616e 6365  oximate distance
-0000b8e0: 2072 6571 7569 7265 6420 6265 7477 6565   required betwee
-0000b8f0: 6e20 636f 6e74 6f75 7220 706f 696e 7473  n contour points
-0000b900: 2e20 2054 6869 7320 6973 2074 616b 656e  .  This is taken
-0000b910: 0a20 2020 2020 2020 2020 2020 2069 6e74  .            int
-0000b920: 6f20 6163 636f 756e 7420 6f6e 6c79 2069  o account only i
-0000b930: 6620 6e5f 706f 696e 7420 6973 2073 6574  f n_point is set
-0000b940: 2074 6f20 4e6f 6e65 2e20 2046 6f72 2061   to None.  For a
-0000b950: 2063 6f6e 746f 7572 206f 660a 2020 2020   contour of.    
-0000b960: 2020 2020 2020 2020 6c65 6e67 7468 2063          length c
-0000b970: 6f6e 746f 7572 5f6c 656e 6774 682c 2074  ontour_length, t
-0000b980: 6865 206e 756d 6265 7220 6f66 2063 6f6e  he number of con
-0000b990: 746f 7572 2070 6f69 6e74 7320 6973 2074  tour points is t
-0000b9a0: 6865 6e20 7461 6b65 6e0a 2020 2020 2020  hen taken.      
-0000b9b0: 2020 2020 2020 746f 2062 6520 6d61 7828        to be max(
-0000b9c0: 696e 7428 636f 6e74 6f75 725f 6c65 6e67  int(contour_leng
-0000b9d0: 7468 202f 2064 7879 292c 2033 292e 2020  th / dxy), 3).  
-0000b9e0: 0a0a 2020 2020 2020 2020 736d 6f6f 7468  ..        smooth
-0000b9f0: 6e65 7373 5f70 6572 5f70 6f69 6e74 203a  ness_per_point :
-0000ba00: 2066 6c6f 6174 2c20 6465 6661 756c 743d   float, default=
-0000ba10: 300a 2020 2020 2020 2020 2020 2020 5061  0.            Pa
-0000ba20: 7261 6d65 7465 7220 6465 7465 726d 696e  rameter determin
-0000ba30: 696e 6720 7468 6520 736d 6f6f 7468 6e65  ing the smoothne
-0000ba40: 7373 206f 6620 7468 6520 422d 7370 6c69  ss of the B-spli
-0000ba50: 6e65 2063 7572 7665 2075 7365 640a 2020  ne curve used.  
-0000ba60: 2020 2020 2020 2020 2020 696e 2063 6f6e            in con
-0000ba70: 746f 7572 2061 7070 726f 7869 6d61 7469  tour approximati
-0000ba80: 6f6e 2066 6f72 2069 6e74 6572 706f 6c61  on for interpola
-0000ba90: 7469 6f6e 2e20 2054 6865 2070 726f 6475  tion.  The produ
-0000baa0: 6374 206f 660a 2020 2020 2020 2020 2020  ct of.          
-0000bab0: 2020 736d 6f6f 7468 6e65 7373 5f70 6572    smoothness_per
-0000bac0: 5f70 6f69 6e74 2061 6e64 2074 6865 206e  _point and the n
-0000bad0: 756d 6265 7220 6f66 2063 6f6e 746f 7572  umber of contour
-0000bae0: 2070 6f69 6e74 7320 2873 7065 6369 6669   points (specifi
-0000baf0: 6564 0a20 2020 2020 2020 2020 2020 2064  ed.            d
-0000bb00: 6972 6563 746c 7920 7669 6120 6e5f 706f  irectly via n_po
-0000bb10: 696e 742c 206f 7220 696e 6469 7265 6374  int, or indirect
-0000bb20: 6c79 2076 6961 2064 7879 2920 636f 7272  ly via dxy) corr
-0000bb30: 6573 706f 6e64 7320 746f 2074 6865 0a20  esponds to the. 
-0000bb40: 2020 2020 2020 2020 2020 2070 6172 616d             param
-0000bb50: 6574 6572 2073 206f 6620 7363 6970 792e  eter s of scipy.
-0000bb60: 696e 7465 7270 6f6c 6174 652e 7370 6c70  interpolate.splp
-0000bb70: 7265 7020 2d20 7365 6520 646f 6375 6d65  rep - see docume
-0000bb80: 6e74 6174 696f 6e20 6174 3a0a 2020 2020  ntation at:.    
-0000bb90: 2020 2020 0a20 2020 2020 2020 2020 2020      .           
-0000bba0: 2068 7474 7073 3a2f 2f73 6369 7079 2e67   https://scipy.g
-0000bbb0: 6974 6875 622e 696f 2f64 6576 646f 6373  ithub.io/devdocs
-0000bbc0: 2f72 6566 6572 656e 6365 2f67 656e 6572  /reference/gener
-0000bbd0: 6174 6564 2f73 6369 7079 2e69 6e74 6572  ated/scipy.inter
-0000bbe0: 706f 6c61 7465 2e73 706c 7072 6570 2e68  polate.splprep.h
-0000bbf0: 746d 6c23 7363 6970 792e 696e 7465 7270  tml#scipy.interp
-0000bc00: 6f6c 6174 652e 7370 6c70 7265 700a 0a20  olate.splprep.. 
-0000bc10: 2020 2020 2020 2020 2020 2041 2073 6d6f             A smo
-0000bc20: 6f74 686e 6573 735f 7065 725f 706f 696e  othness_per_poin
-0000bc30: 7420 6f66 2030 2066 6f72 6365 7320 7468  t of 0 forces th
-0000bc40: 6520 422d 7370 6c69 6e65 2074 6f20 7061  e B-spline to pa
-0000bc50: 7373 2074 6872 6f75 6768 0a20 2020 2020  ss through.     
-0000bc60: 2020 2020 2020 2061 6c6c 206f 6620 7468         all of th
-0000bc70: 6520 7072 652d 696e 7465 7270 6f6c 6174  e pre-interpolat
-0000bc80: 696f 6e20 636f 6e74 6f75 7220 706f 696e  ion contour poin
-0000bc90: 7473 2e0a 2020 2020 2020 2020 2727 270a  ts..        '''.
-0000bca0: 0a20 2020 2020 2020 206e 6577 5f63 6f6e  .        new_con
-0000bcb0: 746f 7572 7320 3d20 7b7d 0a20 2020 2020  tours = {}.     
-0000bcc0: 2020 2066 6f72 207a 2c20 636f 6e74 6f75     for z, contou
-0000bcd0: 7273 2069 6e20 7365 6c66 2e67 6574 5f63  rs in self.get_c
-0000bce0: 6f6e 746f 7572 7328 292e 6974 656d 7328  ontours().items(
-0000bcf0: 293a 0a20 2020 2020 2020 2020 2020 206e  ):.            n
-0000bd00: 6577 5f63 6f6e 746f 7572 735b 7a5d 203d  ew_contours[z] =
-0000bd10: 205b 5d0a 2020 2020 2020 2020 2020 2020   [].            
-0000bd20: 666f 7220 636f 6e74 6f75 7220 696e 2063  for contour in c
-0000bd30: 6f6e 746f 7572 733a 0a20 2020 2020 2020  ontours:.       
-0000bd40: 2020 2020 2020 2020 206e 6577 5f63 6f6e           new_con
-0000bd50: 746f 7572 203d 2069 6e74 6572 706f 6c61  tour = interpola
-0000bd60: 7465 5f70 6f69 6e74 735f 7369 6e67 6c65  te_points_single
-0000bd70: 5f63 6f6e 746f 7572 280a 2020 2020 2020  _contour(.      
-0000bd80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bd90: 2020 636f 6e74 6f75 722c 206e 5f70 6f69    contour, n_poi
-0000bda0: 6e74 2c20 6478 792c 2073 6d6f 6f74 686e  nt, dxy, smoothn
-0000bdb0: 6573 735f 7065 725f 706f 696e 7429 0a20  ess_per_point). 
-0000bdc0: 2020 2020 2020 2020 2020 2020 2020 206e                 n
-0000bdd0: 6577 5f63 6f6e 746f 7572 735b 7a5d 2e61  ew_contours[z].a
-0000bde0: 7070 656e 6428 6e65 775f 636f 6e74 6f75  ppend(new_contou
-0000bdf0: 7229 0a0a 2020 2020 2020 2020 2320 436c  r)..        # Cl
-0000be00: 6f6e 6520 7365 6c66 2c20 7468 656e 2063  one self, then c
-0000be10: 6c65 6172 206d 6173 6b20 616e 6420 7265  lear mask and re
-0000be20: 7365 7420 636f 6e74 6f75 7273 206f 6620  set contours of 
-0000be30: 636c 6f6e 650a 2020 2020 2020 2020 726f  clone.        ro
-0000be40: 6920 3d20 524f 4928 7365 6c66 290a 2020  i = ROI(self).  
-0000be50: 2020 2020 2020 726f 692e 696e 7075 745f        roi.input_
-0000be60: 636f 6e74 6f75 7273 203d 206e 6577 5f63  contours = new_c
-0000be70: 6f6e 746f 7572 730a 2020 2020 2020 2020  ontours.        
-0000be80: 726f 692e 636f 6e74 6f75 7273 203d 207b  roi.contours = {
-0000be90: 2278 2d79 223a 206e 6577 5f63 6f6e 746f  "x-y": new_conto
-0000bea0: 7572 737d 0a20 2020 2020 2020 2072 6f69  urs}.        roi
-0000beb0: 2e6c 6f61 6465 645f 6d61 736b 203d 2046  .loaded_mask = F
-0000bec0: 616c 7365 0a20 2020 2020 2020 2072 6f69  alse.        roi
-0000bed0: 2e6d 6173 6b20 3d20 4e6f 6e65 0a0a 2020  .mask = None..  
-0000bee0: 2020 2020 2020 7265 7475 726e 2072 6f69        return roi
-0000bef0: 0a0a 2020 2020 6465 6620 6765 745f 6365  ..    def get_ce
-0000bf00: 6e74 726f 6964 280a 2020 2020 2020 2020  ntroid(.        
-0000bf10: 7365 6c66 2c0a 2020 2020 2020 2020 7669  self,.        vi
-0000bf20: 6577 3d22 782d 7922 2c0a 2020 2020 2020  ew="x-y",.      
-0000bf30: 2020 7369 6e67 6c65 5f73 6c69 6365 3d46    single_slice=F
-0000bf40: 616c 7365 2c0a 2020 2020 2020 2020 736c  alse,.        sl
-0000bf50: 3d4e 6f6e 652c 0a20 2020 2020 2020 2069  =None,.        i
-0000bf60: 6478 3d4e 6f6e 652c 0a20 2020 2020 2020  dx=None,.       
-0000bf70: 2070 6f73 3d4e 6f6e 652c 0a20 2020 2020   pos=None,.     
-0000bf80: 2020 2075 6e69 7473 3d22 6d6d 222c 0a20     units="mm",. 
-0000bf90: 2020 2020 2020 206d 6574 686f 643d 4e6f         method=No
-0000bfa0: 6e65 2c0a 2020 2020 2020 2020 666f 7263  ne,.        forc
-0000bfb0: 653d 5472 7565 2c0a 2020 2020 293a 0a20  e=True,.    ):. 
-0000bfc0: 2020 2020 2020 2022 2222 4765 7420 6569         """Get ei
-0000bfd0: 7468 6572 2033 4420 676c 6f62 616c 2063  ther 3D global c
-0000bfe0: 656e 7472 6f69 6420 706f 7369 7469 6f6e  entroid position
-0000bff0: 206f 7220 3244 2063 656e 7472 6f69 6420   or 2D centroid 
-0000c000: 706f 7369 7469 6f6e 206f 6e20 0a20 2020  position on .   
-0000c010: 2020 2020 2061 2073 696e 676c 6520 736c       a single sl
-0000c020: 6963 652e 2049 6620 7369 6e67 6c65 5f73  ice. If single_s
-0000c030: 6c69 6365 3d46 616c 7365 2c20 7468 6520  lice=False, the 
-0000c040: 6361 6c63 756c 6174 6564 2067 6c6f 6261  calculated globa
-0000c050: 6c20 6365 6e74 726f 6964 200a 2020 2020  l centroid .    
-0000c060: 2020 2020 7769 6c6c 2062 6520 6361 6368      will be cach
-0000c070: 6564 2069 6e20 7365 6c66 2e5f 6365 6e74  ed in self._cent
-0000c080: 726f 6964 5b75 6e69 7473 5d20 616e 6420  roid[units] and 
-0000c090: 7265 7475 726e 6564 2069 6620 6361 6c6c  returned if call
-0000c0a0: 6564 2061 6761 696e 2c0a 2020 2020 2020  ed again,.      
-0000c0b0: 2020 756e 6c65 7373 2066 6f72 6365 3d54    unless force=T
-0000c0c0: 7275 652e 0a0a 2020 2020 2020 2020 2a2a  rue...        **
-0000c0d0: 5061 7261 6d65 7465 7273 3a2a 2a0a 2020  Parameters:**.  
-0000c0e0: 2020 2020 2020 0a20 2020 2020 2020 2073        .        s
-0000c0f0: 696e 676c 655f 736c 6963 6520 3a20 626f  ingle_slice : bo
-0000c100: 6f6c 2c20 6465 6661 756c 743d 4661 6c73  ol, default=Fals
-0000c110: 650a 2020 2020 2020 2020 2020 2020 4966  e.            If
-0000c120: 2046 616c 7365 2c20 7468 6520 676c 6f62   False, the glob
-0000c130: 616c 2033 4420 6365 6e74 726f 6964 206f  al 3D centroid o
-0000c140: 6620 7468 6520 656e 7469 7265 2052 4f49  f the entire ROI
-0000c150: 2077 696c 6c20 6265 2072 6574 7572 6e65   will be returne
-0000c160: 643b 0a20 2020 2020 2020 2020 2020 206f  d;.            o
-0000c170: 7468 6572 7769 7365 2c20 7468 6520 3244  therwise, the 2D
-0000c180: 2063 656e 7472 6f69 6420 6f6e 2061 2073   centroid on a s
-0000c190: 696e 676c 6520 736c 6963 6520 7769 6c6c  ingle slice will
-0000c1a0: 2062 6520 7265 7475 726e 6564 2e0a 0a20   be returned... 
-0000c1b0: 2020 2020 2020 2076 6965 7720 3a20 7374         view : st
-0000c1c0: 722c 2064 6566 6175 6c74 3d22 782d 7922  r, default="x-y"
-0000c1d0: 0a20 2020 2020 2020 2020 2020 204f 7269  .            Ori
-0000c1e0: 656e 7461 7469 6f6e 206f 6620 736c 6963  entation of slic
-0000c1f0: 6520 6f6e 2077 6869 6368 2074 6f20 6765  e on which to ge
-0000c200: 7420 6365 6e74 726f 6964 2e20 4f6e 6c79  t centroid. Only
-0000c210: 2075 7365 6420 6966 200a 2020 2020 2020   used if .      
-0000c220: 2020 2020 2020 7369 6e67 6c65 5f73 6c69        single_sli
-0000c230: 6365 3d54 7275 652e 2049 6620 7573 696e  ce=True. If usin
-0000c240: 672c 203c 6178 3e20 6d75 7374 2062 6520  g, <ax> must be 
-0000c250: 616e 2061 7869 7320 7468 6174 206c 6965  an axis that lie
-0000c260: 7320 616c 6f6e 670a 2020 2020 2020 2020  s along.        
-0000c270: 2020 2020 7468 6520 736c 6963 6520 696e      the slice in
-0000c280: 2074 6869 7320 6f72 6965 6e74 6174 696f   this orientatio
-0000c290: 6e2e 0a0a 2020 2020 2020 2020 736c 203a  n...        sl :
-0000c2a0: 2069 6e74 2c20 6465 6661 756c 743d 4e6f   int, default=No
-0000c2b0: 6e65 0a20 2020 2020 2020 2020 2020 2053  ne.            S
-0000c2c0: 6c69 6365 206e 756d 6265 722e 2049 6620  lice number. If 
-0000c2d0: 6e6f 6e65 206f 6620 3c73 6c3e 2c20 3c69  none of <sl>, <i
-0000c2e0: 6478 3e20 6f72 203c 706f 733e 2061 7265  dx> or <pos> are
-0000c2f0: 2073 7570 706c 6965 6420 6275 740a 2020   supplied but.  
-0000c300: 2020 2020 2020 2020 2020 3c73 696e 676c            <singl
-0000c310: 655f 736c 6963 653e 2069 7320 5472 7565  e_slice> is True
-0000c320: 2c20 7468 6520 6365 6e74 7261 6c20 736c  , the central sl
-0000c330: 6963 6520 6f66 2074 6865 2052 4f49 2077  ice of the ROI w
-0000c340: 696c 6c20 6265 2075 7365 642e 0a0a 2020  ill be used...  
-0000c350: 2020 2020 2020 6964 7820 3a20 696e 742c        idx : int,
-0000c360: 2064 6566 6175 6c74 3d4e 6f6e 650a 2020   default=None.  
-0000c370: 2020 2020 2020 2020 2020 4172 7261 7920            Array 
-0000c380: 696e 6465 7820 6f66 2073 6c69 6365 2e20  index of slice. 
-0000c390: 4966 206e 6f6e 6520 6f66 203c 736c 3e2c  If none of <sl>,
-0000c3a0: 203c 6964 783e 206f 7220 3c70 6f73 3e20   <idx> or <pos> 
-0000c3b0: 6172 6520 7375 7070 6c69 6564 2062 7574  are supplied but
-0000c3c0: 0a20 2020 2020 2020 2020 2020 203c 7369  .            <si
-0000c3d0: 6e67 6c65 5f73 6c69 6365 3e20 6973 2054  ngle_slice> is T
-0000c3e0: 7275 652c 2074 6865 2063 656e 7472 616c  rue, the central
-0000c3f0: 2073 6c69 6365 206f 6620 7468 6520 524f   slice of the RO
-0000c400: 4920 7769 6c6c 2062 6520 7573 6564 2e0a  I will be used..
-0000c410: 0a20 2020 2020 2020 2070 6f73 203a 2066  .        pos : f
-0000c420: 6c6f 6174 2c20 6465 6661 756c 743d 4e6f  loat, default=No
-0000c430: 6e65 0a20 2020 2020 2020 2020 2020 2053  ne.            S
-0000c440: 6c69 6365 2070 6f73 6974 696f 6e20 696e  lice position in
-0000c450: 206d 6d2e 2049 6620 6e6f 6e65 206f 6620   mm. If none of 
-0000c460: 3c73 6c3e 2c20 3c69 6478 3e20 6f72 203c  <sl>, <idx> or <
-0000c470: 706f 733e 2061 7265 2073 7570 706c 6965  pos> are supplie
-0000c480: 6420 6275 740a 2020 2020 2020 2020 2020  d but.          
-0000c490: 2020 3c73 696e 676c 655f 736c 6963 653e    <single_slice>
-0000c4a0: 2069 7320 5472 7565 2c20 7468 6520 6365   is True, the ce
-0000c4b0: 6e74 7261 6c20 736c 6963 6520 6f66 2074  ntral slice of t
-0000c4c0: 6865 2052 4f49 2077 696c 6c20 6265 2075  he ROI will be u
-0000c4d0: 7365 642e 0a0a 2020 2020 2020 2020 756e  sed...        un
-0000c4e0: 6974 7320 3a20 7374 722c 2064 6566 6175  its : str, defau
-0000c4f0: 6c74 3d22 6d6d 220a 2020 2020 2020 2020  lt="mm".        
-0000c500: 2020 2020 556e 6974 7320 6f66 2063 656e      Units of cen
-0000c510: 7472 6f69 642e 2043 616e 2062 6520 6569  troid. Can be ei
-0000c520: 7468 6572 206f 663a 0a20 2020 2020 2020  ther of:.       
-0000c530: 2020 2020 2020 2020 202d 2022 6d6d 223a           - "mm":
-0000c540: 2072 6574 7572 6e20 6365 6e74 726f 6964   return centroid
-0000c550: 2070 6f73 6974 696f 6e20 696e 206d 696c   position in mil
-0000c560: 6c69 6d65 7472 6573 2e0a 2020 2020 2020  limetres..      
-0000c570: 2020 2020 2020 2020 2020 2d20 2276 6f78            - "vox
-0000c580: 656c 7322 3a20 7265 7475 726e 2063 656e  els": return cen
-0000c590: 7472 6f69 6420 706f 7369 7469 6f6e 2069  troid position i
-0000c5a0: 6e20 7465 726d 7320 6f66 2061 7272 6179  n terms of array
-0000c5b0: 2069 6e64 6963 6573 2e0a 2020 2020 2020   indices..      
-0000c5c0: 2020 2020 2020 2020 2020 2d20 2273 6c69            - "sli
-0000c5d0: 6365 223a 2072 6574 7572 6e20 6365 6e74  ce": return cent
-0000c5e0: 726f 6964 2070 6f73 6974 696f 6e20 696e  roid position in
-0000c5f0: 2074 6572 6d73 206f 6620 736c 6963 6520   terms of slice 
-0000c600: 6e75 6d62 6572 732e 0a0a 2020 2020 2020  numbers...      
-0000c610: 2020 2020 2020 4966 2075 6e69 7473 3d22        If units="
-0000c620: 766f 7865 6c73 2220 6f72 2022 736c 6963  voxels" or "slic
-0000c630: 6522 2069 7320 7265 7175 6573 7465 6420  e" is requested 
-0000c640: 6275 7420 7468 6973 2052 4f49 206f 6e6c  but this ROI onl
-0000c650: 7920 6861 7320 0a20 2020 2020 2020 2020  y has .         
-0000c660: 2020 2063 6f6e 746f 7572 7320 616e 6420     contours and 
-0000c670: 6e6f 206d 6173 6b20 7368 6170 652f 766f  no mask shape/vo
-0000c680: 7865 6c20 7369 7a65 2069 6e66 6f72 6d61  xel size informa
-0000c690: 7469 6f6e 2c20 616e 2065 7272 6f72 2077  tion, an error w
-0000c6a0: 696c 6c20 6265 200a 2020 2020 2020 2020  ill be .        
-0000c6b0: 2020 2020 7261 6973 6564 2028 756e 6c65      raised (unle
-0000c6c0: 7373 2061 783d 227a 222c 2069 6e20 7768  ss ax="z", in wh
-0000c6d0: 6963 6820 6361 7365 2076 6f78 656c 2073  ich case voxel s
-0000c6e0: 697a 6520 7769 6c6c 2062 6520 696e 6665  ize will be infe
-0000c6f0: 7272 6564 200a 2020 2020 2020 2020 2020  rred .          
-0000c700: 2020 6672 6f6d 2073 7061 6369 6e67 2062    from spacing b
-0000c710: 6574 7765 656e 2073 6c69 6365 7329 2e0a  etween slices)..
-0000c720: 0a20 2020 2020 2020 206d 6574 686f 6420  .        method 
-0000c730: 3a20 7374 722c 2064 6566 6175 6c74 3d4e  : str, default=N
-0000c740: 6f6e 650a 2020 2020 2020 2020 2020 2020  one.            
-0000c750: 4d65 7468 6f64 2074 6f20 7573 6520 666f  Method to use fo
-0000c760: 7220 6365 6e74 726f 6964 2063 616c 6375  r centroid calcu
-0000c770: 6c61 7469 6f6e 2e20 4361 6e20 6265 3a20  lation. Can be: 
-0000c780: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000c790: 202d 2022 636f 6e74 6f75 7222 3a20 6765   - "contour": ge
-0000c7a0: 7420 6365 6e74 726f 6964 206f 6620 7368  t centroid of sh
-0000c7b0: 6170 656c 7920 636f 6e74 6f75 7228 7329  apely contour(s)
-0000c7c0: 2e0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000c7d0: 2020 2d20 226d 6173 6b22 3a20 6765 7420    - "mask": get 
-0000c7e0: 6176 6572 6167 6520 706f 7369 7469 6f6e  average position
-0000c7f0: 206f 6620 766f 7865 6c73 2069 6e20 6269   of voxels in bi
-0000c800: 6e61 7279 206d 6173 6b2e 0a20 2020 2020  nary mask..     
-0000c810: 2020 2020 2020 2020 2020 202d 204e 6f6e             - Non
-0000c820: 653a 2075 7365 2074 6865 206d 6574 686f  e: use the metho
-0000c830: 6420 7365 7420 696e 2073 656c 662e 6465  d set in self.de
-0000c840: 6661 756c 745f 6765 6f6d 5f6d 6574 686f  fault_geom_metho
-0000c850: 642e 0a0a 2020 2020 2020 2020 666f 7263  d...        forc
-0000c860: 6520 3a20 626f 6f6c 2c20 6465 6661 756c  e : bool, defaul
-0000c870: 743d 5472 7565 0a20 2020 2020 2020 2020  t=True.         
-0000c880: 2020 2049 6620 5472 7565 2c20 7468 6520     If True, the 
-0000c890: 676c 6f62 616c 2063 656e 7472 6f69 6420  global centroid 
-0000c8a0: 7769 6c6c 2061 6c77 6179 7320 6265 2072  will always be r
-0000c8b0: 6563 616c 6375 6c61 7465 643b 200a 2020  ecalculated; .  
-0000c8c0: 2020 2020 2020 2020 2020 6f74 6865 7277            otherw
-0000c8d0: 6973 652c 2069 7420 7769 6c6c 206f 6e6c  ise, it will onl
-0000c8e0: 7920 6265 2063 616c 6375 6c61 7465 6420  y be calculated 
-0000c8f0: 6966 2069 7420 6861 7320 6e6f 7420 7965  if it has not ye
-0000c900: 7420 6265 656e 2063 6163 6865 6420 0a20  t been cached . 
-0000c910: 2020 2020 2020 2020 2020 2069 6e20 7365             in se
-0000c920: 6c66 2e5f 766f 6c75 6d65 2e20 204e 6f74  lf._volume.  Not
-0000c930: 6520 7468 6174 2069 6620 7369 6e67 6c65  e that if single
-0000c940: 5f73 6c69 6365 3d54 7275 652c 2074 6865  _slice=True, the
-0000c950: 2063 656e 7472 6f69 6420 7769 6c6c 200a   centroid will .
-0000c960: 2020 2020 2020 2020 2020 2020 616c 7761              alwa
-0000c970: 7973 2062 6520 7265 6361 6c63 756c 6174  ys be recalculat
-0000c980: 6564 2e0a 2020 2020 2020 2020 2222 220a  ed..        """.
-0000c990: 0a20 2020 2020 2020 2023 2049 6620 676c  .        # If gl
-0000c9a0: 6f62 616c 2063 656e 7472 6f69 6420 616c  obal centroid al
-0000c9b0: 7265 6164 7920 6361 6368 6564 2c20 7265  ready cached, re
-0000c9c0: 7475 726e 2063 6163 6865 6420 7661 6c75  turn cached valu
-0000c9d0: 650a 2020 2020 2020 2020 6966 206e 6f74  e.        if not
-0000c9e0: 2073 696e 676c 655f 736c 6963 6520 616e   single_slice an
-0000c9f0: 6420 6e6f 7420 666f 7263 653a 0a20 2020  d not force:.   
-0000ca00: 2020 2020 2020 2020 2069 6620 6861 7361           if hasa
-0000ca10: 7474 7228 7365 6c66 2c20 225f 6365 6e74  ttr(self, "_cent
-0000ca20: 726f 6964 2229 2061 6e64 2075 6e69 7473  roid") and units
-0000ca30: 2069 6e20 7365 6c66 2e5f 6365 6e74 726f   in self._centro
-0000ca40: 6964 3a0a 2020 2020 2020 2020 2020 2020  id:.            
-0000ca50: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
-0000ca60: 5f63 656e 7472 6f69 645b 756e 6974 735d  _centroid[units]
-0000ca70: 0a0a 2020 2020 2020 2020 2320 4765 7420  ..        # Get 
-0000ca80: 6465 6661 756c 7420 736c 6963 6520 616e  default slice an
-0000ca90: 6420 6d65 7468 6f64 0a20 2020 2020 2020  d method.       
-0000caa0: 2073 656c 662e 6c6f 6164 2829 0a20 2020   self.load().   
-0000cab0: 2020 2020 2069 6620 6d65 7468 6f64 2069       if method i
-0000cac0: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
-0000cad0: 2020 2020 6d65 7468 6f64 203d 2073 656c      method = sel
-0000cae0: 662e 6465 6661 756c 745f 6765 6f6d 5f6d  f.default_geom_m
-0000caf0: 6574 686f 640a 2020 2020 2020 2020 6966  ethod.        if
-0000cb00: 2073 696e 676c 655f 736c 6963 6520 616e   single_slice an
-0000cb10: 6420 706f 7320 6973 204e 6f6e 6520 616e  d pos is None an
-0000cb20: 6420 736c 2069 7320 4e6f 6e65 2061 6e64  d sl is None and
-0000cb30: 2069 6478 2069 7320 4e6f 6e65 3a0a 2020   idx is None:.  
-0000cb40: 2020 2020 2020 2020 2020 6964 7820 3d20            idx = 
-0000cb50: 7365 6c66 2e67 6574 5f6d 6964 5f69 6478  self.get_mid_idx
-0000cb60: 2876 6965 7729 0a0a 2020 2020 2020 2020  (view)..        
-0000cb70: 2320 4966 2073 696e 676c 6520 736c 6963  # If single slic
-0000cb80: 6520 7265 7175 6573 7465 6420 616e 6420  e requested and 
-0000cb90: 6e6f 7420 6f6e 2063 7572 7265 6e74 2073  not on current s
-0000cba0: 6c69 6365 2c20 7265 7475 726e 204e 6f6e  lice, return Non
-0000cbb0: 652c 204e 6f6e 650a 2020 2020 2020 2020  e, None.        
-0000cbc0: 6966 2073 696e 676c 655f 736c 6963 6520  if single_slice 
-0000cbd0: 616e 6420 6e6f 7420 7365 6c66 2e6f 6e5f  and not self.on_
-0000cbe0: 736c 6963 6528 7669 6577 2c20 736c 3d73  slice(view, sl=s
-0000cbf0: 6c2c 2069 6478 3d69 6478 2c20 706f 733d  l, idx=idx, pos=
-0000cc00: 706f 7329 3a0a 2020 2020 2020 2020 2020  pos):.          
-0000cc10: 2020 7265 7475 726e 206e 702e 6172 7261    return np.arra
-0000cc20: 7928 5b4e 6f6e 652c 204e 6f6e 655d 290a  y([None, None]).
-0000cc30: 0a20 2020 2020 2020 2023 2043 616c 6375  .        # Calcu
-0000cc40: 6c61 7465 2063 656e 7472 6f69 6420 6672  late centroid fr
-0000cc50: 6f6d 2053 6861 7065 6c79 2070 6f6c 7967  om Shapely polyg
-0000cc60: 6f6e 730a 2020 2020 2020 2020 6365 6e74  ons.        cent
-0000cc70: 726f 6964 203d 207b 7d0a 2020 2020 2020  roid = {}.      
-0000cc80: 2020 6966 206d 6574 686f 6420 3d3d 2022    if method == "
-0000cc90: 636f 6e74 6f75 7222 3a0a 0a20 2020 2020  contour":..     
-0000cca0: 2020 2020 2020 2023 2047 6574 2032 4420         # Get 2D 
-0000ccb0: 6f72 2033 4420 6365 6e74 726f 6964 7320  or 3D centroids 
-0000ccc0: 616e 6420 6172 6561 7320 6f66 2065 6163  and areas of eac
-0000ccd0: 6820 706f 6c79 676f 6e20 6f6e 2074 6865  h polygon on the
-0000cce0: 2064 6573 6972 6564 0a20 2020 2020 2020   desired.       
-0000ccf0: 2020 2020 2023 2073 6c69 6365 2873 290a       # slice(s).
-0000cd00: 2020 2020 2020 2020 2020 2020 6966 2073              if s
-0000cd10: 696e 676c 655f 736c 6963 653a 0a20 2020  ingle_slice:.   
-0000cd20: 2020 2020 2020 2020 2020 2020 2070 6f6c               pol
-0000cd30: 7967 6f6e 7320 3d20 7365 6c66 2e67 6574  ygons = self.get
-0000cd40: 5f70 6f6c 7967 6f6e 735f 6f6e 5f73 6c69  _polygons_on_sli
-0000cd50: 6365 2876 6965 772c 2073 6c2c 2069 6478  ce(view, sl, idx
-0000cd60: 2c20 706f 7329 0a20 2020 2020 2020 2020  , pos).         
-0000cd70: 2020 2020 2020 2063 656e 7472 6f69 6473         centroids
-0000cd80: 203d 205b 5d0a 2020 2020 2020 2020 2020   = [].          
-0000cd90: 2020 2020 2020 6172 6561 7320 3d20 5b5d        areas = []
-0000cda0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000cdb0: 2066 6f72 2070 2069 6e20 706f 6c79 676f   for p in polygo
-0000cdc0: 6e73 3a0a 2020 2020 2020 2020 2020 2020  ns:.            
-0000cdd0: 2020 2020 2020 2020 6365 6e74 726f 6964          centroid
-0000cde0: 5f78 7920 3d20 702e 6365 6e74 726f 6964  _xy = p.centroid
-0000cdf0: 2e78 790a 2020 2020 2020 2020 2020 2020  .xy.            
-0000ce00: 2020 2020 2020 2020 6365 6e74 726f 6964          centroid
-0000ce10: 732e 6170 7065 6e64 286e 702e 6172 7261  s.append(np.arra
-0000ce20: 7928 5b0a 2020 2020 2020 2020 2020 2020  y([.            
-0000ce30: 2020 2020 2020 2020 2020 2020 6365 6e74              cent
-0000ce40: 726f 6964 5f78 795b 305d 5b30 5d2c 2063  roid_xy[0][0], c
-0000ce50: 656e 7472 6f69 645f 7879 5b31 5d5b 305d  entroid_xy[1][0]
-0000ce60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000ce70: 2020 2020 205d 2929 0a20 2020 2020 2020       ])).       
-0000ce80: 2020 2020 2020 2020 2020 2020 2061 7265               are
-0000ce90: 6173 2e61 7070 656e 6428 702e 6172 6561  as.append(p.area
-0000cea0: 290a 2020 2020 2020 2020 2020 2020 656c  ).            el
-0000ceb0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-0000cec0: 2020 2020 6365 6e74 726f 6964 7320 3d20      centroids = 
-0000ced0: 5b5d 0a20 2020 2020 2020 2020 2020 2020  [].             
-0000cee0: 2020 2061 7265 6173 203d 205b 5d0a 2020     areas = [].  
-0000cef0: 2020 2020 2020 2020 2020 2020 2020 706f                po
-0000cf00: 6c79 676f 6e5f 6469 6374 203d 2073 656c  lygon_dict = sel
-0000cf10: 662e 6765 745f 706f 6c79 676f 6e73 2829  f.get_polygons()
-0000cf20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000cf30: 2066 6f72 207a 2c20 706f 6c79 676f 6e73   for z, polygons
-0000cf40: 2069 6e20 706f 6c79 676f 6e5f 6469 6374   in polygon_dict
-0000cf50: 2e69 7465 6d73 2829 3a0a 2020 2020 2020  .items():.      
-0000cf60: 2020 2020 2020 2020 2020 2020 2020 666f                fo
-0000cf70: 7220 7020 696e 2070 6f6c 7967 6f6e 733a  r p in polygons:
-0000cf80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000cf90: 2020 2020 2020 2020 2063 656e 7472 6f69           centroi
-0000cfa0: 645f 7879 203d 2070 2e63 656e 7472 6f69  d_xy = p.centroi
-0000cfb0: 642e 7879 0a20 2020 2020 2020 2020 2020  d.xy.           
-0000cfc0: 2020 2020 2020 2020 2020 2020 2063 656e               cen
-0000cfd0: 7472 6f69 6473 2e61 7070 656e 6428 6e70  troids.append(np
-0000cfe0: 2e61 7272 6179 285b 0a20 2020 2020 2020  .array([.       
-0000cff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d000: 2020 2020 2063 656e 7472 6f69 645f 7879       centroid_xy
-0000d010: 5b30 5d5b 305d 2c20 6365 6e74 726f 6964  [0][0], centroid
-0000d020: 5f78 795b 315d 5b30 5d2c 207a 0a20 2020  _xy[1][0], z.   
-0000d030: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d040: 2020 2020 205d 2929 0a20 2020 2020 2020       ])).       
-0000d050: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d060: 2061 7265 6173 2e61 7070 656e 6428 702e   areas.append(p.
-0000d070: 6172 6561 290a 0a20 2020 2020 2020 2020  area)..         
-0000d080: 2020 2023 2047 6574 2077 6569 6768 7465     # Get weighte
-0000d090: 6420 6176 6572 6167 6520 6f66 2070 6f6c  d average of pol
-0000d0a0: 7967 6f6e 2063 656e 7472 6f69 6473 0a20  ygon centroids. 
-0000d0b0: 2020 2020 2020 2020 2020 2077 6569 6768             weigh
-0000d0c0: 7465 645f 7375 6d20 3d20 6e70 2e73 756d  ted_sum = np.sum
-0000d0d0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-0000d0e0: 2020 5b63 656e 7472 6f69 6473 5b69 5d20    [centroids[i] 
-0000d0f0: 2a20 6172 6561 735b 695d 2066 6f72 2069  * areas[i] for i
-0000d100: 2069 6e20 7261 6e67 6528 6c65 6e28 6365   in range(len(ce
-0000d110: 6e74 726f 6964 7329 295d 2c0a 2020 2020  ntroids))],.    
-0000d120: 2020 2020 2020 2020 2020 2020 6178 6973              axis
-0000d130: 3d30 0a20 2020 2020 2020 2020 2020 2029  =0.            )
-0000d140: 0a20 2020 2020 2020 2020 2020 2063 656e  .            cen
-0000d150: 7472 6f69 645b 226d 6d22 5d20 3d20 7765  troid["mm"] = we
-0000d160: 6967 6874 6564 5f73 756d 202f 2073 756d  ighted_sum / sum
-0000d170: 2861 7265 6173 290a 0a20 2020 2020 2020  (areas)..       
-0000d180: 2020 2020 2023 2043 616c 6375 6c61 7465       # Calculate
-0000d190: 2069 6e20 766f 7865 6c73 2061 6e64 2073   in voxels and s
-0000d1a0: 6c69 6365 7320 6966 2070 6f73 7369 626c  lices if possibl
-0000d1b0: 650a 2020 2020 2020 2020 2020 2020 6966  e.            if
-0000d1c0: 2073 656c 662e 766f 7865 6c5f 7369 7a65   self.voxel_size
-0000d1d0: 2069 7320 4e6f 6e65 2061 6e64 2073 656c   is None and sel
-0000d1e0: 662e 7368 6170 6520 6973 204e 6f6e 653a  f.shape is None:
-0000d1f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000d200: 2069 6620 756e 6974 7320 696e 205b 2276   if units in ["v
-0000d210: 6f78 656c 7322 2c20 2273 6c69 6365 225d  oxels", "slice"]
-0000d220: 2020 616e 6420 7365 6c66 2e73 6861 7065    and self.shape
-0000d230: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
-0000d240: 2020 2020 2020 2020 2020 2020 2020 7261                ra
-0000d250: 6973 6520 5275 6e74 696d 6545 7272 6f72  ise RuntimeError
-0000d260: 2822 4361 6e6e 6f74 2063 6f6d 7075 7465  ("Cannot compute
-0000d270: 2063 656e 7472 6f69 6420 696e 2076 6f78   centroid in vox
-0000d280: 656c 732f 736c 6963 6522 0a20 2020 2020  els/slice".     
-0000d290: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d2a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d2b0: 2020 2220 6e75 6d62 6572 7320 6672 6f6d    " numbers from
-0000d2c0: 2063 6f6e 746f 7572 7320 7769 7468 6f75   contours withou
-0000d2d0: 7420 6b6e 6f77 696e 6720 766f 7865 6c22  t knowing voxel"
-0000d2e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000d2f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d300: 2020 2020 2020 2020 2220 7369 7a65 7320          " sizes 
-0000d310: 616e 6420 6d61 736b 2073 6861 7065 2122  and mask shape!"
-0000d320: 290a 2020 2020 2020 2020 2020 2020 656c  ).            el
-0000d330: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-0000d340: 2020 2020 7669 6577 5f61 7865 7320 3d20      view_axes = 
-0000d350: 285b 302c 2031 2c20 325d 2069 6620 6c65  ([0, 1, 2] if le
-0000d360: 6e28 6365 6e74 726f 6964 5b27 6d6d 275d  n(centroid['mm']
-0000d370: 2920 3d3d 2033 2065 6c73 650a 2020 2020  ) == 3 else.    
+00009420: 2020 2020 5b0a 2020 2020 2020 2020 2020      [.          
+00009430: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009440: 2020 2020 2020 2020 2020 5b69 7820 2d20            [ix - 
+00009450: 302e 352c 2069 7920 2d20 302e 355d 2c0a  0.5, iy - 0.5],.
+00009460: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009470: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009480: 2020 2020 5b69 7820 2d20 302e 352c 2069      [ix - 0.5, i
+00009490: 7920 2b20 302e 355d 2c0a 2020 2020 2020  y + 0.5],.      
+000094a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000094b0: 2020 2020 2020 2020 2020 2020 2020 5b69                [i
+000094c0: 7820 2b20 302e 352c 2069 7920 2b20 302e  x + 0.5, iy + 0.
+000094d0: 355d 2c0a 2020 2020 2020 2020 2020 2020  5],.            
+000094e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000094f0: 2020 2020 2020 2020 5b69 7820 2b20 302e          [ix + 0.
+00009500: 352c 2069 7920 2d20 302e 355d 2c0a 2020  5, iy - 0.5],.  
+00009510: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009520: 2020 2020 2020 2020 2020 2020 2020 5d0a                ].
+00009530: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009540: 2020 2020 2020 2020 2020 2020 290a 0a20              ).. 
+00009550: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009560: 2020 2020 2020 2020 2020 2023 2043 6f6d             # Com
+00009570: 7075 7465 206f 7665 726c 6170 0a20 2020  pute overlap.   
+00009580: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009590: 2020 2020 2020 2020 206f 7665 726c 6170           overlap
+000095a0: 203d 2070 6f6c 7967 6f6e 2e69 6e74 6572   = polygon.inter
+000095b0: 7365 6374 696f 6e28 7069 7865 6c29 2e61  section(pixel).a
+000095c0: 7265 610a 2020 2020 2020 2020 2020 2020  rea.            
+000095d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000095e0: 6d61 736b 5b69 782c 2069 795d 203d 206f  mask[ix, iy] = o
+000095f0: 7665 726c 6170 203e 2073 656c 662e 6f76  verlap > self.ov
+00009600: 6572 6c61 705f 6c65 7665 6c0a 0a20 2020  erlap_level..   
+00009610: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009620: 2023 2041 6464 2074 6f20 3344 206d 6173   # Add to 3D mas
+00009630: 6b0a 2020 2020 2020 2020 2020 2020 2020  k.              
+00009640: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
+00009650: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009660: 2020 2073 656c 662e 6d61 736b 2e64 6174     self.mask.dat
+00009670: 615b 3a2c 203a 2c20 697a 5d20 2b3d 206d  a[:, :, iz] += m
+00009680: 6173 6b2e 540a 2020 2020 2020 2020 2020  ask.T.          
+00009690: 2020 2020 2020 2020 2020 6578 6365 7074            except
+000096a0: 2049 6e64 6578 4572 726f 723a 0a20 2020   IndexError:.   
+000096b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000096c0: 2020 2020 2070 6173 730a 0a20 2020 2020       pass..     
+000096d0: 2020 2023 2043 6f6e 7665 7274 2074 6f20     # Convert to 
+000096e0: 626f 6f6c 6561 6e20 6d61 736b 0a20 2020  boolean mask.   
+000096f0: 2020 2020 2069 6620 6861 7361 7474 7228       if hasattr(
+00009700: 7365 6c66 2e6d 6173 6b2c 2022 6461 7461  self.mask, "data
+00009710: 2229 3a0a 2020 2020 2020 2020 2020 2020  "):.            
+00009720: 6966 206e 6f74 2073 656c 662e 6d61 736b  if not self.mask
+00009730: 2e64 6174 612e 6474 7970 6520 3d3d 2062  .data.dtype == b
+00009740: 6f6f 6c3a 0a20 2020 2020 2020 2020 2020  ool:.           
+00009750: 2020 2020 2073 656c 662e 6d61 736b 2e64       self.mask.d
+00009760: 6174 6120 3d20 7365 6c66 2e6d 6173 6b2e  ata = self.mask.
+00009770: 6461 7461 2e61 7374 7970 6528 626f 6f6c  data.astype(bool
+00009780: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
+00009790: 6c66 2e6c 6f61 6465 645f 6d61 736b 203d  lf.loaded_mask =
+000097a0: 2054 7275 650a 0a20 2020 2020 2020 2023   True..        #
+000097b0: 2053 6574 206f 776e 2067 656f 6d65 7472   Set own geometr
+000097c0: 6963 2070 726f 7065 7274 6965 7320 6672  ic properties fr
+000097d0: 6f6d 206d 6173 6b0a 2020 2020 2020 2020  om mask.        
+000097e0: 7365 6c66 2e76 6f78 656c 5f73 697a 6520  self.voxel_size 
+000097f0: 3d20 7365 6c66 2e6d 6173 6b2e 6765 745f  = self.mask.get_
+00009800: 766f 7865 6c5f 7369 7a65 2829 0a20 2020  voxel_size().   
+00009810: 2020 2020 2073 656c 662e 6f72 6967 696e       self.origin
+00009820: 203d 2073 656c 662e 6d61 736b 2e67 6574   = self.mask.get
+00009830: 5f6f 7269 6769 6e28 290a 2020 2020 2020  _origin().      
+00009840: 2020 7365 6c66 2e61 6666 696e 6520 3d20    self.affine = 
+00009850: 7365 6c66 2e6d 6173 6b2e 6765 745f 6166  self.mask.get_af
+00009860: 6669 6e65 2829 0a20 2020 2020 2020 2073  fine().        s
+00009870: 656c 662e 7368 6170 6520 3d20 7365 6c66  elf.shape = self
+00009880: 2e6d 6173 6b2e 6765 745f 6461 7461 2829  .mask.get_data()
+00009890: 2e73 6861 7065 0a0a 2020 2020 6465 6620  .shape..    def 
+000098a0: 6973 5f65 6d70 7479 2873 656c 6629 3a0a  is_empty(self):.
+000098b0: 2020 2020 2020 2020 2222 2243 6865 636b          """Check
+000098c0: 2077 6865 7468 6572 2074 6869 7320 524f   whether this RO
+000098d0: 4920 6973 2065 6d70 7479 2e22 2222 0a0a  I is empty."""..
+000098e0: 2020 2020 2020 2020 7365 6c66 2e6c 6f61          self.loa
+000098f0: 6428 290a 2020 2020 2020 2020 6966 2073  d().        if s
+00009900: 656c 662e 6465 6661 756c 745f 6765 6f6d  elf.default_geom
+00009910: 5f6d 6574 686f 6420 3d3d 2022 636f 6e74  _method == "cont
+00009920: 6f75 7222 3a0a 2020 2020 2020 2020 2020  our":.          
+00009930: 2020 7265 7475 726e 206e 6f74 2062 6f6f    return not boo
+00009940: 6c28 6c65 6e28 7365 6c66 2e67 6574 5f63  l(len(self.get_c
+00009950: 6f6e 746f 7572 7328 2278 2d79 2229 2929  ontours("x-y")))
+00009960: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
+00009970: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00009980: 6e20 6e6f 7420 6e70 2e61 6e79 2873 656c  n not np.any(sel
+00009990: 662e 6765 745f 6d61 736b 2829 290a 0a20  f.get_mask()).. 
+000099a0: 2020 2064 6566 2072 6573 616d 706c 6528     def resample(
+000099b0: 7365 6c66 2c20 2a61 7267 732c 202a 2a6b  self, *args, **k
+000099c0: 7761 7267 7329 3a0a 2020 2020 2020 2020  wargs):.        
+000099d0: 7365 6c66 2e63 7265 6174 655f 6d61 736b  self.create_mask
+000099e0: 2829 0a20 2020 2020 2020 2073 656c 662e  ().        self.
+000099f0: 6d61 736b 2e72 6573 616d 706c 6528 2a61  mask.resample(*a
+00009a00: 7267 732c 202a 2a6b 7761 7267 7329 0a0a  rgs, **kwargs)..
+00009a10: 2020 2020 6465 6620 6d61 7463 685f 766f      def match_vo
+00009a20: 7865 6c5f 7369 7a65 2873 656c 662c 206f  xel_size(self, o
+00009a30: 7468 6572 2c20 2a61 7267 732c 202a 2a6b  ther, *args, **k
+00009a40: 7761 7267 7329 3a0a 0a20 2020 2020 2020  wargs):..       
+00009a50: 2069 6620 6973 696e 7374 616e 6365 286f   if isinstance(o
+00009a60: 7468 6572 2c20 524f 4929 3a0a 2020 2020  ther, ROI):.    
+00009a70: 2020 2020 2020 2020 6f74 6865 722e 6372          other.cr
+00009a80: 6561 7465 5f6d 6173 6b28 290a 2020 2020  eate_mask().    
+00009a90: 2020 2020 2020 2020 6d61 736b 203d 206f          mask = o
+00009aa0: 7468 6572 2e6d 6173 6b0a 2020 2020 2020  ther.mask.      
+00009ab0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+00009ac0: 2020 2020 6d61 736b 203d 206f 7468 6572      mask = other
+00009ad0: 0a20 2020 2020 2020 2073 656c 662e 6372  .        self.cr
+00009ae0: 6561 7465 5f6d 6173 6b28 290a 2020 2020  eate_mask().    
+00009af0: 2020 2020 7365 6c66 2e6d 6173 6b2e 6d61      self.mask.ma
+00009b00: 7463 685f 766f 7865 6c5f 7369 7a65 286d  tch_voxel_size(m
+00009b10: 6173 6b2c 202a 6172 6773 2c20 2a2a 6b77  ask, *args, **kw
+00009b20: 6172 6773 290a 0a20 2020 2064 6566 2067  args)..    def g
+00009b30: 6574 5f73 6c69 6365 2873 656c 662c 202a  et_slice(self, *
+00009b40: 6172 6773 2c20 666f 7263 655f 7374 616e  args, force_stan
+00009b50: 6461 7264 6973 653d 4661 6c73 652c 202a  dardise=False, *
+00009b60: 2a6b 7761 7267 7329 3a0a 0a20 2020 2020  *kwargs):..     
+00009b70: 2020 2073 656c 662e 6372 6561 7465 5f6d     self.create_m
+00009b80: 6173 6b28 290a 2020 2020 2020 2020 6461  ask().        da
+00009b90: 7461 203d 2073 656c 662e 6d61 736b 2e67  ta = self.mask.g
+00009ba0: 6574 5f73 6c69 6365 282a 6172 6773 2c20  et_slice(*args, 
+00009bb0: 666f 7263 655f 7374 616e 6461 7264 6973  force_standardis
+00009bc0: 653d 666f 7263 655f 7374 616e 6461 7264  e=force_standard
+00009bd0: 6973 652c 200a 2020 2020 2020 2020 2020  ise, .          
+00009be0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009bf0: 2020 2020 2020 2020 202a 2a6b 7761 7267           **kwarg
+00009c00: 7329 0a20 2020 2020 2020 2069 6620 6461  s).        if da
+00009c10: 7461 2e64 7479 7065 2021 3d20 626f 6f6c  ta.dtype != bool
+00009c20: 3a0a 2020 2020 2020 2020 2020 2020 6461  :.            da
+00009c30: 7461 203d 2064 6174 612e 6173 7479 7065  ta = data.astype
+00009c40: 2862 6f6f 6c29 0a20 2020 2020 2020 2072  (bool).        r
+00009c50: 6574 7572 6e20 6461 7461 0a0a 2020 2020  eturn data..    
+00009c60: 6465 6620 6765 745f 726f 695f 736c 6963  def get_roi_slic
+00009c70: 6528 7365 6c66 2c20 7a5f 6672 6163 7469  e(self, z_fracti
+00009c80: 6f6e 3d31 2c20 7375 6666 6978 3d4e 6f6e  on=1, suffix=Non
+00009c90: 6529 3a0a 2020 2020 2020 2020 2222 220a  e):.        """.
+00009ca0: 2020 2020 2020 2020 4765 7420 524f 4920          Get ROI 
+00009cb0: 6f62 6a65 6374 2063 6f72 7265 7370 6f6e  object correspon
+00009cc0: 6469 6e67 2074 6f20 782d 7920 736c 6963  ding to x-y slic
+00009cd0: 6520 7468 726f 7567 6820 7468 6973 2052  e through this R
+00009ce0: 4f49 2e0a 0a20 2020 2020 2020 202a 2a50  OI...        **P
+00009cf0: 6172 616d 6574 6572 3a2a 2a0a 0a20 2020  arameter:**..   
+00009d00: 2020 2020 207a 5f66 7261 6374 696f 6e20       z_fraction 
+00009d10: 3a20 666c 6f61 742c 2064 6566 6175 6c74  : float, default
+00009d20: 3d31 0a20 2020 2020 2020 2020 2020 2050  =1.            P
+00009d30: 6f73 6974 696f 6e20 616c 6f6e 6720 7a20  osition along z 
+00009d40: 6178 6973 2061 7420 7768 6963 6820 746f  axis at which to
+00009d50: 2074 616b 6520 736c 6963 6520 7468 726f   take slice thro
+00009d60: 7567 6820 524f 492e 0a20 2020 2020 2020  ugh ROI..       
+00009d70: 2020 2020 2054 6865 2070 6f73 6974 696f       The positio
+00009d80: 6e20 6973 2073 7065 6369 6669 6564 2061  n is specified a
+00009d90: 7320 7468 6520 6672 6163 7469 6f6e 616c  s the fractional
+00009da0: 2064 6973 7461 6e63 650a 2020 2020 2020   distance.      
+00009db0: 2020 2020 2020 6672 6f6d 2074 6865 2052        from the R
+00009dc0: 4f49 2773 206d 6f73 742d 696e 6665 7269  OI's most-inferi
+00009dd0: 6f72 2070 6f69 6e74 3a20 3020 636f 7272  or point: 0 corr
+00009de0: 6573 706f 6e64 7320 746f 0a20 2020 2020  esponds to.     
+00009df0: 2020 2020 2020 2074 6865 206d 6f73 742d         the most-
+00009e00: 696e 6665 7269 6f72 2070 6f69 6e74 2028  inferior point (
+00009e10: 6c6f 7765 7374 207a 293b 2031 2063 6f72  lowest z); 1 cor
+00009e20: 7265 7370 6f6e 6473 2074 6f20 7468 650a  responds to the.
+00009e30: 2020 2020 2020 2020 2020 2020 6d6f 7374              most
+00009e40: 2d73 7570 6572 696f 7220 706f 696e 7420  -superior point 
+00009e50: 2868 6967 6865 7374 207a 292e 2020 5661  (highest z).  Va
+00009e60: 6c75 6573 2066 6f72 207a 5f66 7261 6374  lues for z_fract
+00009e70: 696f 6e0a 2020 2020 2020 2020 2020 2020  ion.            
+00009e80: 6f75 7473 6964 6520 7468 6520 696e 7465  outside the inte
+00009e90: 7276 616c 205b 302c 2031 5d20 7265 7375  rval [0, 1] resu
+00009ea0: 6c74 2069 6e20 6120 5275 6e74 696d 6545  lt in a RuntimeE
+00009eb0: 7272 6f72 2e0a 0a20 2020 2073 7566 6669  rror...    suffi
+00009ec0: 7820 3a20 7374 722c 2064 6566 6175 6c74  x : str, default
+00009ed0: 3d4e 6f6e 650a 2020 2020 2020 2020 5375  =None.        Su
+00009ee0: 6666 6978 2074 6f20 6170 7065 6e64 2074  ffix to append t
+00009ef0: 6f20 6f77 6e20 6e61 6d65 2c20 746f 2066  o own name, to f
+00009f00: 6f72 6d20 6e61 6d65 206f 6620 6f75 7470  orm name of outp
+00009f10: 7574 2052 4f49 2e20 2049 660a 2020 2020  ut ROI.  If.    
+00009f20: 2020 2020 4e6f 6e65 2c20 6170 7065 6e64      None, append
+00009f30: 207a 5f66 7261 6374 696f 6e2c 2077 6974   z_fraction, wit
+00009f40: 6820 7661 6c75 6520 6769 7665 6e20 746f  h value given to
+00009f50: 2074 776f 2064 6563 696d 616c 2070 6c61   two decimal pla
+00009f60: 6365 732e 0a20 2020 2020 2020 2022 2222  ces..        """
+00009f70: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00009f80: 6765 745f 726f 695f 736c 6963 6528 7365  get_roi_slice(se
+00009f90: 6c66 2c20 7a5f 6672 6163 7469 6f6e 290a  lf, z_fraction).
+00009fa0: 0a20 2020 2064 6566 2067 6574 5f69 6e64  .    def get_ind
+00009fb0: 6963 6573 2873 656c 662c 2076 6965 773d  ices(self, view=
+00009fc0: 2278 2d79 222c 206d 6574 686f 643d 4e6f  "x-y", method=No
+00009fd0: 6e65 293a 0a20 2020 2020 2020 2022 2222  ne):.        """
+00009fe0: 4765 7420 6c69 7374 206f 6620 736c 6963  Get list of slic
+00009ff0: 6520 696e 6469 6365 7320 6f6e 2077 6869  e indices on whi
+0000a000: 6368 2074 6869 7320 524f 4920 6578 6973  ch this ROI exis
+0000a010: 7473 2e22 2222 0a0a 2020 2020 2020 2020  ts."""..        
+0000a020: 7365 6c66 2e6c 6f61 6428 290a 2020 2020  self.load().    
+0000a030: 2020 2020 6966 2073 656c 662e 656d 7074      if self.empt
+0000a040: 793a 0a20 2020 2020 2020 2020 2020 2072  y:.            r
+0000a050: 6574 7572 6e20 5b5d 0a0a 2020 2020 2020  eturn []..      
+0000a060: 2020 6966 206d 6574 686f 6420 6973 204e    if method is N
+0000a070: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+0000a080: 206d 6574 686f 6420 3d20 7365 6c66 2e64   method = self.d
+0000a090: 6566 6175 6c74 5f67 656f 6d5f 6d65 7468  efault_geom_meth
+0000a0a0: 6f64 0a0a 2020 2020 2020 2020 6966 206d  od..        if m
+0000a0b0: 6574 686f 6420 3d3d 2022 636f 6e74 6f75  ethod == "contou
+0000a0c0: 7222 3a0a 2020 2020 2020 2020 2020 2020  r":.            
+0000a0d0: 7265 7475 726e 206c 6973 7428 7365 6c66  return list(self
+0000a0e0: 2e67 6574 5f63 6f6e 746f 7572 7328 7669  .get_contours(vi
+0000a0f0: 6577 2c20 6964 785f 6173 5f6b 6579 3d54  ew, idx_as_key=T
+0000a100: 7275 6529 2e6b 6579 7328 2929 0a20 2020  rue).keys()).   
+0000a110: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+0000a120: 2020 2020 2020 2061 7820 3d20 736b 7274         ax = skrt
+0000a130: 2e69 6d61 6765 2e5f 736c 6963 655f 6178  .image._slice_ax
+0000a140: 6573 5b76 6965 775d 0a20 2020 2020 2020  es[view].       
+0000a150: 2020 2020 206d 6173 6b20 3d20 7365 6c66       mask = self
+0000a160: 2e67 6574 5f6d 6173 6b28 7374 616e 6461  .get_mask(standa
+0000a170: 7264 6973 653d 5472 7565 292e 7472 616e  rdise=True).tran
+0000a180: 7370 6f73 6528 312c 2030 2c20 3229 0a20  spose(1, 0, 2). 
+0000a190: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+0000a1a0: 6e20 6c69 7374 286e 702e 756e 6971 7565  n list(np.unique
+0000a1b0: 286e 702e 6172 6777 6865 7265 286d 6173  (np.argwhere(mas
+0000a1c0: 6b29 5b3a 2c20 6178 5d29 290a 0a20 2020  k)[:, ax]))..   
+0000a1d0: 2064 6566 2067 6574 5f6d 6964 5f69 6478   def get_mid_idx
+0000a1e0: 2873 656c 662c 2076 6965 773d 2278 2d79  (self, view="x-y
+0000a1f0: 222c 202a 2a6b 7761 7267 7329 3a0a 2020  ", **kwargs):.  
+0000a200: 2020 2020 2020 2222 2247 6574 2063 656e        """Get cen
+0000a210: 7472 616c 2073 6c69 6365 2069 6e64 6578  tral slice index
+0000a220: 206f 6620 7468 6973 2052 4f49 2069 6e20   of this ROI in 
+0000a230: 6120 6769 7665 6e20 6f72 6965 6e74 6174  a given orientat
+0000a240: 696f 6e2e 2222 220a 0a20 2020 2020 2020  ion."""..       
+0000a250: 2069 6e64 6963 6573 203d 2073 656c 662e   indices = self.
+0000a260: 6765 745f 696e 6469 6365 7328 7669 6577  get_indices(view
+0000a270: 2c20 2a2a 6b77 6172 6773 290a 2020 2020  , **kwargs).    
+0000a280: 2020 2020 6966 206e 6f74 206c 656e 2869      if not len(i
+0000a290: 6e64 6963 6573 293a 0a20 2020 2020 2020  ndices):.       
+0000a2a0: 2020 2020 2072 6574 7572 6e20 4e6f 6e65       return None
+0000a2b0: 0a20 2020 2020 2020 206d 6964 203d 2069  .        mid = i
+0000a2c0: 6e74 286c 656e 2869 6e64 6963 6573 2920  nt(len(indices) 
+0000a2d0: 2f20 3229 0a20 2020 2020 2020 2072 6574  / 2).        ret
+0000a2e0: 7572 6e20 696e 6469 6365 735b 6d69 645d  urn indices[mid]
+0000a2f0: 0a0a 2020 2020 6465 6620 6964 785f 746f  ..    def idx_to
+0000a300: 5f70 6f73 2873 656c 662c 2069 6478 2c20  _pos(self, idx, 
+0000a310: 6178 2c20 7374 616e 6461 7264 6973 653d  ax, standardise=
+0000a320: 5472 7565 293a 0a20 2020 2020 2020 2022  True):.        "
+0000a330: 2222 436f 6e76 6572 7420 616e 2061 7272  ""Convert an arr
+0000a340: 6179 2069 6e64 6578 2074 6f20 6120 706f  ay index to a po
+0000a350: 7369 7469 6f6e 2069 6e20 6d6d 2061 6c6f  sition in mm alo
+0000a360: 6e67 2061 2067 6976 656e 2061 7869 732e  ng a given axis.
+0000a370: 2222 220a 0a20 2020 2020 2020 2073 656c  """..        sel
+0000a380: 662e 6c6f 6164 2829 0a0a 2020 2020 2020  f.load()..      
+0000a390: 2020 6966 2073 656c 662e 636f 6e74 6f75    if self.contou
+0000a3a0: 7273 5f6f 6e6c 793a 0a0a 2020 2020 2020  rs_only:..      
+0000a3b0: 2020 2020 2020 2320 5573 6520 7365 6c66        # Use self
+0000a3c0: 2e69 6d61 6765 2773 2063 6f6e 7665 7273  .image's convers
+0000a3d0: 696f 6e20 6675 6e63 7469 6f6e 0a20 2020  ion function.   
+0000a3e0: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
+0000a3f0: 2e69 6d61 6765 2069 7320 6e6f 7420 4e6f  .image is not No
+0000a400: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+0000a410: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
+0000a420: 696d 6167 652e 6964 785f 746f 5f70 6f73  image.idx_to_pos
+0000a430: 2869 6478 2c20 6178 290a 0a20 2020 2020  (idx, ax)..     
+0000a440: 2020 2020 2020 2023 204f 7468 6572 7769         # Otherwi
+0000a450: 7365 2063 6f75 6e74 206e 756d 6265 7220  se count number 
+0000a460: 6f66 207a 2073 6c69 6365 7320 696e 2063  of z slices in c
+0000a470: 6f6e 746f 7572 7320 6469 6374 0a20 2020  ontours dict.   
+0000a480: 2020 2020 2020 2020 2023 2049 6620 696e           # If in
+0000a490: 6465 7820 646f 6573 206e 6f74 2063 6f72  dex does not cor
+0000a4a0: 7265 7370 6f6e 6420 746f 2061 2073 6c69  respond to a sli
+0000a4b0: 6365 2c20 7265 7475 726e 204e 6f6e 650a  ce, return None.
+0000a4c0: 2020 2020 2020 2020 2020 2020 656c 6966              elif
+0000a4d0: 2061 7820 696e 205b 227a 222c 2032 5d3a   ax in ["z", 2]:
+0000a4e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000a4f0: 2063 6f6e 7665 7273 696f 6e20 3d20 7b69   conversion = {i
+0000a500: 3a20 7020 666f 7220 692c 2070 2069 6e20  : p for i, p in 
+0000a510: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000a520: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+0000a530: 6e75 6d65 7261 7465 2873 656c 662e 6765  numerate(self.ge
+0000a540: 745f 636f 6e74 6f75 7273 2822 782d 7922  t_contours("x-y"
+0000a550: 292e 6b65 7973 2829 297d 0a20 2020 2020  ).keys())}.     
+0000a560: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+0000a570: 6e20 636f 6e76 6572 7369 6f6e 2e67 6574  n conversion.get
+0000a580: 2869 6478 2c20 4e6f 6e65 290a 0a20 2020  (idx, None)..   
+0000a590: 2020 2020 2020 2020 2023 204f 7468 6572           # Other
+0000a5a0: 7769 7365 2c20 6e6f 7420 706f 7373 6962  wise, not possib
+0000a5b0: 6c65 2074 6f20 636f 6e76 6572 7420 782f  le to convert x/
+0000a5c0: 7920 706f 696e 7473 2074 6f20 696e 6469  y points to indi
+0000a5d0: 6365 730a 2020 2020 2020 2020 2020 2020  ces.            
+0000a5e0: 2320 6672 6f6d 2063 6f6e 746f 7572 7320  # from contours 
+0000a5f0: 616c 6f6e 650a 2020 2020 2020 2020 2020  alone.          
+0000a600: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+0000a610: 2020 2020 2020 2020 7072 696e 7428 2257          print("W
+0000a620: 6172 6e69 6e67 3a20 6361 6e6e 6f74 2063  arning: cannot c
+0000a630: 6f6e 7665 7274 2069 6e64 6578 2074 6f20  onvert index to 
+0000a640: 706f 7369 7469 6f6e 2069 6e20 7468 6520  position in the 
+0000a650: 782f 7920 220a 2020 2020 2020 2020 2020  x/y ".          
+0000a660: 2020 2020 2020 2020 2020 2020 2264 6972              "dir
+0000a670: 6563 7469 6f6e 7320 7769 7468 6f75 7420  ections without 
+0000a680: 6173 736f 6369 6174 6564 2069 6d61 6765  associated image
+0000a690: 2067 656f 6d65 7472 7921 2229 0a20 2020   geometry!").   
+0000a6a0: 2020 2020 2020 2020 2020 2020 2072 6574               ret
+0000a6b0: 7572 6e0a 0a20 2020 2020 2020 2023 204f  urn..        # O
+0000a6c0: 7468 6572 7769 7365 2c20 7472 7920 746f  therwise, try to
+0000a6d0: 2075 7365 206d 6173 6b20 6f72 2069 6d61   use mask or ima
+0000a6e0: 6765 2773 2063 6f6e 7665 7273 696f 6e0a  ge's conversion.
+0000a6f0: 2020 2020 2020 2020 656c 6966 2073 656c          elif sel
+0000a700: 662e 6d61 736b 2069 7320 6e6f 7420 4e6f  f.mask is not No
+0000a710: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+0000a720: 7265 7475 726e 2073 656c 662e 6d61 736b  return self.mask
+0000a730: 2e69 6478 5f74 6f5f 706f 7328 6964 782c  .idx_to_pos(idx,
+0000a740: 2061 7829 0a20 2020 2020 2020 2065 6c69   ax).        eli
+0000a750: 6620 7365 6c66 2e69 6d61 6765 2069 7320  f self.image is 
+0000a760: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
+0000a770: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
+0000a780: 662e 696d 6167 652e 6964 785f 746f 5f70  f.image.idx_to_p
+0000a790: 6f73 2869 6478 2c20 6178 290a 0a20 2020  os(idx, ax)..   
+0000a7a0: 2020 2020 2023 2045 6c73 652c 2074 7279       # Else, try
+0000a7b0: 2074 6f20 6361 6c63 756c 6174 6520 6672   to calculate fr
+0000a7c0: 6f6d 206f 776e 2067 656f 6d65 7472 6963  om own geometric
+0000a7d0: 2070 726f 7065 7274 6965 730a 2020 2020   properties.    
+0000a7e0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+0000a7f0: 2020 2020 2020 695f 6178 203d 2073 6b72        i_ax = skr
+0000a800: 742e 696d 6167 652e 5f61 7865 732e 696e  t.image._axes.in
+0000a810: 6465 7828 6178 2920 6966 2061 7820 696e  dex(ax) if ax in
+0000a820: 2073 6b72 742e 696d 6167 652e 5f61 7865   skrt.image._axe
+0000a830: 7320 656c 7365 2061 780a 2020 2020 2020  s else ax.      
+0000a840: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
+0000a850: 662e 6f72 6967 696e 5b69 5f61 785d 202b  f.origin[i_ax] +
+0000a860: 2069 6478 202a 2073 656c 662e 766f 7865   idx * self.voxe
+0000a870: 6c5f 7369 7a65 5b69 5f61 785d 0a0a 2020  l_size[i_ax]..  
+0000a880: 2020 6465 6620 706f 735f 746f 5f69 6478    def pos_to_idx
+0000a890: 2873 656c 662c 2070 6f73 2c20 6178 2c20  (self, pos, ax, 
+0000a8a0: 7265 7475 726e 5f69 6e74 3d54 7275 652c  return_int=True,
+0000a8b0: 202a 2a6b 7761 7267 7329 3a0a 2020 2020   **kwargs):.    
+0000a8c0: 2020 2020 2222 2243 6f6e 7665 7274 2061      """Convert a
+0000a8d0: 2070 6f73 6974 696f 6e20 696e 206d 6d20   position in mm 
+0000a8e0: 746f 2061 6e20 6172 7261 7920 696e 6465  to an array inde
+0000a8f0: 7820 616c 6f6e 6720 6120 6769 7665 6e20  x along a given 
+0000a900: 6178 6973 2e22 2222 0a0a 2020 2020 2020  axis."""..      
+0000a910: 2020 7365 6c66 2e6c 6f61 6428 290a 2020    self.load().  
+0000a920: 2020 2020 2020 6966 2073 656c 662e 636f        if self.co
+0000a930: 6e74 6f75 7273 5f6f 6e6c 793a 0a0a 2020  ntours_only:..  
+0000a940: 2020 2020 2020 2020 2020 2320 5573 6520            # Use 
+0000a950: 7365 6c66 2e69 6d61 6765 2773 2063 6f6e  self.image's con
+0000a960: 7665 7273 696f 6e20 6675 6e63 7469 6f6e  version function
+0000a970: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+0000a980: 7365 6c66 2e69 6d61 6765 2069 7320 6e6f  self.image is no
+0000a990: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
+0000a9a0: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+0000a9b0: 656c 662e 696d 6167 652e 706f 735f 746f  elf.image.pos_to
+0000a9c0: 5f69 6478 2870 6f73 2c20 6178 2c20 7265  _idx(pos, ax, re
+0000a9d0: 7475 726e 5f69 6e74 290a 0a20 2020 2020  turn_int)..     
+0000a9e0: 2020 2020 2020 2023 204f 7468 6572 7769         # Otherwi
+0000a9f0: 7365 2063 6f75 6e74 206e 756d 6265 7220  se count number 
+0000aa00: 6f66 207a 2073 6c69 6365 7320 696e 2063  of z slices in c
+0000aa10: 6f6e 746f 7572 7320 6469 6374 0a20 2020  ontours dict.   
+0000aa20: 2020 2020 2020 2020 2023 2049 6620 706f           # If po
+0000aa30: 7369 7469 6f6e 2064 6f65 7320 6e6f 7420  sition does not 
+0000aa40: 636f 7272 6573 706f 6e64 2074 6f20 6120  correspond to a 
+0000aa50: 736c 6965 2c20 7265 7475 726e 204e 6f6e  slie, return Non
+0000aa60: 650a 2020 2020 2020 2020 2020 2020 656c  e.            el
+0000aa70: 6966 2061 7820 696e 205b 227a 222c 2032  if ax in ["z", 2
+0000aa80: 5d3a 0a20 2020 2020 2020 2020 2020 2020  ]:.             
+0000aa90: 2020 2063 6f6e 7665 7273 696f 6e20 3d20     conversion = 
+0000aaa0: 7b70 3a20 6920 666f 7220 692c 2070 2069  {p: i for i, p i
+0000aab0: 6e20 0a20 2020 2020 2020 2020 2020 2020  n .             
+0000aac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000aad0: 2065 6e75 6d65 7261 7465 2873 656c 662e   enumerate(self.
+0000aae0: 6765 745f 636f 6e74 6f75 7273 2822 782d  get_contours("x-
+0000aaf0: 7922 292e 6b65 7973 2829 297d 0a20 2020  y").keys())}.   
+0000ab00: 2020 2020 2020 2020 2020 2020 2069 6478               idx
+0000ab10: 203d 2063 6f6e 7665 7273 696f 6e2e 6765   = conversion.ge
+0000ab20: 7428 706f 732c 204e 6f6e 6529 0a0a 2020  t(pos, None)..  
+0000ab30: 2020 2020 2020 2020 2020 2320 4f74 6865            # Othe
+0000ab40: 7277 6973 652c 206e 6f74 2070 6f73 7369  rwise, not possi
+0000ab50: 626c 6520 746f 2063 6f6e 7665 7274 2078  ble to convert x
+0000ab60: 2f79 2070 6f69 6e74 7320 746f 2069 6e64  /y points to ind
+0000ab70: 6963 6573 0a20 2020 2020 2020 2020 2020  ices.           
+0000ab80: 2023 2066 726f 6d20 636f 6e74 6f75 7273   # from contours
+0000ab90: 2061 6c6f 6e65 0a20 2020 2020 2020 2020   alone.         
+0000aba0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+0000abb0: 2020 2020 2020 2020 2070 7269 6e74 2822           print("
+0000abc0: 5761 726e 696e 673a 2063 616e 6e6f 7420  Warning: cannot 
+0000abd0: 636f 6e76 6572 7420 706f 7369 7469 6f6e  convert position
+0000abe0: 2074 6f20 696e 6465 7820 696e 2074 6865   to index in the
+0000abf0: 2078 2f79 2022 0a20 2020 2020 2020 2020   x/y ".         
+0000ac00: 2020 2020 2020 2020 2020 2020 2022 6469               "di
+0000ac10: 7265 6374 696f 6e73 2077 6974 686f 7574  rections without
+0000ac20: 2061 7373 6f63 6961 7465 6420 696d 6167   associated imag
+0000ac30: 6520 6765 6f6d 6574 7279 2122 290a 2020  e geometry!").  
+0000ac40: 2020 2020 2020 2020 2020 2020 2020 7265                re
+0000ac50: 7475 726e 0a20 2020 2020 2020 2020 2020  turn.           
+0000ac60: 2069 6620 7265 7475 726e 5f69 6e74 2061   if return_int a
+0000ac70: 6e64 2069 6478 2069 7320 6e6f 7420 4e6f  nd idx is not No
+0000ac80: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+0000ac90: 2020 2020 7265 7475 726e 2072 6f75 6e64      return round
+0000aca0: 2869 6478 290a 2020 2020 2020 2020 2020  (idx).          
+0000acb0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+0000acc0: 2020 2020 2020 2020 7265 7475 726e 2069          return i
+0000acd0: 6478 0a0a 2020 2020 2020 2020 2320 4f74  dx..        # Ot
+0000ace0: 6865 7277 6973 652c 2074 7279 2074 6f20  herwise, try to 
+0000acf0: 7573 6520 6d61 736b 206f 7220 696d 6167  use mask or imag
+0000ad00: 6527 7320 636f 6e76 6572 7369 6f6e 0a20  e's conversion. 
+0000ad10: 2020 2020 2020 2065 6c69 6620 7365 6c66         elif self
+0000ad20: 2e6d 6173 6b20 6973 206e 6f74 204e 6f6e  .mask is not Non
+0000ad30: 653a 0a20 2020 2020 2020 2020 2020 2072  e:.            r
+0000ad40: 6574 7572 6e20 7365 6c66 2e6d 6173 6b2e  eturn self.mask.
+0000ad50: 706f 735f 746f 5f69 6478 2870 6f73 2c20  pos_to_idx(pos, 
+0000ad60: 6178 2c20 7265 7475 726e 5f69 6e74 290a  ax, return_int).
+0000ad70: 2020 2020 2020 2020 656c 6966 2073 656c          elif sel
+0000ad80: 662e 696d 6167 6520 6973 206e 6f74 204e  f.image is not N
+0000ad90: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+0000ada0: 2072 6574 7572 6e20 7365 6c66 2e69 6d61   return self.ima
+0000adb0: 6765 2e70 6f73 5f74 6f5f 6964 7828 706f  ge.pos_to_idx(po
+0000adc0: 732c 2061 782c 2072 6574 7572 6e5f 696e  s, ax, return_in
+0000add0: 7429 0a0a 2020 2020 2020 2020 2320 456c  t)..        # El
+0000ade0: 7365 2c20 7472 7920 746f 2063 616c 6375  se, try to calcu
+0000adf0: 6c61 7465 2066 726f 6d20 6f77 6e20 6765  late from own ge
+0000ae00: 6f6d 7472 6963 2070 726f 7065 7274 6965  omtric propertie
+0000ae10: 730a 2020 2020 2020 2020 656c 7365 3a0a  s.        else:.
+0000ae20: 2020 2020 2020 2020 2020 2020 695f 6178              i_ax
+0000ae30: 203d 2073 6b72 742e 696d 6167 652e 5f61   = skrt.image._a
+0000ae40: 7865 732e 696e 6465 7828 6178 2920 6966  xes.index(ax) if
+0000ae50: 2061 7820 696e 2073 6b72 742e 696d 6167   ax in skrt.imag
+0000ae60: 652e 5f61 7865 7320 656c 7365 2061 780a  e._axes else ax.
+0000ae70: 2020 2020 2020 2020 2020 2020 6964 7820              idx 
+0000ae80: 3d20 2870 6f73 202d 2073 656c 662e 6f72  = (pos - self.or
+0000ae90: 6967 696e 5b69 5f61 785d 2920 2f20 7365  igin[i_ax]) / se
+0000aea0: 6c66 2e76 6f78 656c 5f73 697a 655b 695f  lf.voxel_size[i_
+0000aeb0: 6178 5d0a 2020 2020 2020 2020 2020 2020  ax].            
+0000aec0: 6966 2072 6574 7572 6e5f 696e 743a 0a20  if return_int:. 
+0000aed0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+0000aee0: 6574 7572 6e20 726f 756e 6428 6964 7829  eturn round(idx)
+0000aef0: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
+0000af00: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+0000af10: 2020 2072 6574 7572 6e20 6964 780a 0a20     return idx.. 
+0000af20: 2020 2064 6566 2069 6478 5f74 6f5f 736c     def idx_to_sl
+0000af30: 6963 6528 7365 6c66 2c20 6964 782c 2061  ice(self, idx, a
+0000af40: 7829 3a0a 2020 2020 2020 2020 2222 2243  x):.        """C
+0000af50: 6f6e 7665 7274 2061 6e20 6172 7261 7920  onvert an array 
+0000af60: 696e 6465 7820 746f 2061 2073 6c69 6365  index to a slice
+0000af70: 206e 756d 6265 7220 616c 6f6e 6720 6120   number along a 
+0000af80: 6769 7665 6e20 6178 6973 2e22 2222 0a0a  given axis."""..
+0000af90: 2020 2020 2020 2020 7365 6c66 2e6c 6f61          self.loa
+0000afa0: 6428 290a 2020 2020 2020 2020 6966 2073  d().        if s
+0000afb0: 656c 662e 636f 6e74 6f75 7273 5f6f 6e6c  elf.contours_onl
+0000afc0: 7920 6f72 2028 7365 6c66 2e6d 6173 6b20  y or (self.mask 
+0000afd0: 6973 204e 6f6e 6520 616e 6420 7365 6c66  is None and self
+0000afe0: 2e69 6d61 6765 2069 7320 4e6f 6e65 293a  .image is None):
+0000aff0: 0a0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
+0000b000: 436f 756e 7420 6e75 6d62 6572 206f 6620  Count number of 
+0000b010: 7a20 736c 6963 6573 2069 6e20 636f 6e74  z slices in cont
+0000b020: 6f75 7273 2064 6963 740a 2020 2020 2020  ours dict.      
+0000b030: 2020 2020 2020 6966 2061 7820 696e 205b        if ax in [
+0000b040: 227a 222c 2032 5d3a 0a20 2020 2020 2020  "z", 2]:.       
+0000b050: 2020 2020 2020 2020 206e 7a20 3d20 7365           nz = se
+0000b060: 6c66 2e67 6574 5f6e 7a5f 636f 6e74 6f75  lf.get_nz_contou
+0000b070: 7273 2829 0a20 2020 2020 2020 2020 2020  rs().           
+0000b080: 2020 2020 2072 6574 7572 6e20 6e7a 202d       return nz -
+0000b090: 2069 6478 0a20 2020 2020 2020 2020 2020   idx.           
+0000b0a0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+0000b0b0: 2020 2020 2020 2072 6574 7572 6e20 6964         return id
+0000b0c0: 7820 2b20 310a 0a20 2020 2020 2020 2023  x + 1..        #
+0000b0d0: 2054 7279 2074 6f20 7573 6520 6d61 736b   Try to use mask
+0000b0e0: 206f 7220 696d 6167 6527 7320 636f 6e76   or image's conv
+0000b0f0: 6572 7369 6f6e 0a20 2020 2020 2020 2065  ersion.        e
+0000b100: 6c69 6620 7365 6c66 2e6d 6173 6b20 6973  lif self.mask is
+0000b110: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
+0000b120: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
+0000b130: 6c66 2e6d 6173 6b2e 6964 785f 746f 5f73  lf.mask.idx_to_s
+0000b140: 6c69 6365 2869 6478 2c20 6178 290a 2020  lice(idx, ax).  
+0000b150: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+0000b160: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+0000b170: 656c 662e 696d 6167 652e 6964 785f 746f  elf.image.idx_to
+0000b180: 5f73 6c69 6365 2869 6478 2c20 6178 290a  _slice(idx, ax).
+0000b190: 0a20 2020 2064 6566 2073 6c69 6365 5f74  .    def slice_t
+0000b1a0: 6f5f 6964 7828 7365 6c66 2c20 736c 2c20  o_idx(self, sl, 
+0000b1b0: 6178 293a 0a20 2020 2020 2020 2022 2222  ax):.        """
+0000b1c0: 436f 6e76 6572 7420 6120 736c 6963 6520  Convert a slice 
+0000b1d0: 6e75 6d62 6572 2074 6f20 616e 2061 7272  number to an arr
+0000b1e0: 6179 2069 6e64 6578 2e22 2222 0a0a 2020  ay index."""..  
+0000b1f0: 2020 2020 2020 7365 6c66 2e6c 6f61 6428        self.load(
+0000b200: 290a 2020 2020 2020 2020 6966 2073 656c  ).        if sel
+0000b210: 662e 636f 6e74 6f75 7273 5f6f 6e6c 7920  f.contours_only 
+0000b220: 6f72 2028 7365 6c66 2e6d 6173 6b20 6973  or (self.mask is
+0000b230: 204e 6f6e 6520 616e 6420 7365 6c66 2e69   None and self.i
+0000b240: 6d61 6765 2069 7320 4e6f 6e65 293a 0a0a  mage is None):..
+0000b250: 2020 2020 2020 2020 2020 2020 2320 436f              # Co
+0000b260: 756e 7420 6e75 6d62 6572 206f 6620 7a20  unt number of z 
+0000b270: 736c 6963 6573 2069 6e20 636f 6e74 6f75  slices in contou
+0000b280: 7273 2064 6963 740a 2020 2020 2020 2020  rs dict.        
+0000b290: 2020 2020 6966 2061 7820 696e 205b 227a      if ax in ["z
+0000b2a0: 222c 2032 5d3a 0a20 2020 2020 2020 2020  ", 2]:.         
+0000b2b0: 2020 2020 2020 206e 7a20 3d20 7365 6c66         nz = self
+0000b2c0: 2e67 6574 5f6e 7a5f 636f 6e74 6f75 7273  .get_nz_contours
+0000b2d0: 2829 0a20 2020 2020 2020 2020 2020 2020  ().             
+0000b2e0: 2020 2072 6574 7572 6e20 6e7a 202d 2073     return nz - s
+0000b2f0: 6c0a 2020 2020 2020 2020 2020 2020 656c  l.            el
+0000b300: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+0000b310: 2020 2020 7265 7475 726e 2073 6c20 2d20      return sl - 
+0000b320: 310a 0a20 2020 2020 2020 2023 2054 7279  1..        # Try
+0000b330: 2074 6f20 7573 6520 6d61 736b 206f 7220   to use mask or 
+0000b340: 696d 6167 6527 7320 636f 6e76 6572 7369  image's conversi
+0000b350: 6f6e 0a20 2020 2020 2020 2065 6c69 6620  on.        elif 
+0000b360: 7365 6c66 2e6d 6173 6b20 6973 206e 6f74  self.mask is not
+0000b370: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+0000b380: 2020 2072 6574 7572 6e20 7365 6c66 2e6d     return self.m
+0000b390: 6173 6b2e 736c 6963 655f 746f 5f69 6478  ask.slice_to_idx
+0000b3a0: 2873 6c2c 2061 7829 0a20 2020 2020 2020  (sl, ax).       
+0000b3b0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+0000b3c0: 2020 2072 6574 7572 6e20 7365 6c66 2e69     return self.i
+0000b3d0: 6d61 6765 2e73 6c69 6365 5f74 6f5f 6964  mage.slice_to_id
+0000b3e0: 7828 736c 2c20 6178 290a 0a20 2020 2064  x(sl, ax)..    d
+0000b3f0: 6566 2070 6f73 5f74 6f5f 736c 6963 6528  ef pos_to_slice(
+0000b400: 7365 6c66 2c20 706f 732c 2061 782c 2072  self, pos, ax, r
+0000b410: 6574 7572 6e5f 696e 743d 5472 7565 2c20  eturn_int=True, 
+0000b420: 7374 616e 6461 7264 6973 653d 5472 7565  standardise=True
+0000b430: 293a 0a20 2020 2020 2020 2022 2222 436f  ):.        """Co
+0000b440: 6e76 6572 7420 6120 706f 7369 7469 6f6e  nvert a position
+0000b450: 2069 6e20 6d6d 2074 6f20 6120 736c 6963   in mm to a slic
+0000b460: 6520 6e75 6d62 6572 2061 6c6f 6e67 2061  e number along a
+0000b470: 2067 6976 656e 2061 7869 732e 2222 220a   given axis.""".
+0000b480: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0000b490: 736b 7274 2e69 6d61 6765 2e49 6d61 6765  skrt.image.Image
+0000b4a0: 2e70 6f73 5f74 6f5f 736c 6963 6528 7365  .pos_to_slice(se
+0000b4b0: 6c66 2c20 706f 732c 2061 782c 2072 6574  lf, pos, ax, ret
+0000b4c0: 7572 6e5f 696e 7429 0a0a 2020 2020 6465  urn_int)..    de
+0000b4d0: 6620 736c 6963 655f 746f 5f70 6f73 2873  f slice_to_pos(s
+0000b4e0: 656c 662c 2073 6c2c 2061 782c 2073 7461  elf, sl, ax, sta
+0000b4f0: 6e64 6172 6469 7365 3d54 7275 6529 3a0a  ndardise=True):.
+0000b500: 2020 2020 2020 2020 2222 2243 6f6e 7665          """Conve
+0000b510: 7274 2061 2073 6c69 6365 206e 756d 6265  rt a slice numbe
+0000b520: 7220 746f 2061 2070 6f73 6974 696f 6e20  r to a position 
+0000b530: 696e 206d 6d20 616c 6f6e 6720 6120 6769  in mm along a gi
+0000b540: 7665 6e20 6178 6973 2e22 2222 0a0a 2020  ven axis."""..  
+0000b550: 2020 2020 2020 7265 7475 726e 2073 6b72        return skr
+0000b560: 742e 696d 6167 652e 496d 6167 652e 736c  t.image.Image.sl
+0000b570: 6963 655f 746f 5f70 6f73 2873 656c 662c  ice_to_pos(self,
+0000b580: 2073 6c2c 2061 7829 0a0a 2020 2020 6465   sl, ax)..    de
+0000b590: 6620 6765 745f 6964 7828 7365 6c66 2c20  f get_idx(self, 
+0000b5a0: 7669 6577 2c20 736c 3d4e 6f6e 652c 2069  view, sl=None, i
+0000b5b0: 6478 3d4e 6f6e 652c 2070 6f73 3d4e 6f6e  dx=None, pos=Non
+0000b5c0: 6529 3a0a 2020 2020 2020 2020 2222 2247  e):.        """G
+0000b5d0: 6574 2061 6e20 6172 7261 7920 696e 6465  et an array inde
+0000b5e0: 7820 6672 6f6d 2065 6974 6865 7220 6120  x from either a 
+0000b5f0: 736c 6963 6520 6e75 6d62 6572 2c20 696e  slice number, in
+0000b600: 6465 782c 206f 720a 2020 2020 2020 2020  dex, or.        
+0000b610: 706f 7369 7469 6f6e 2e22 2222 0a0a 2020  position."""..  
+0000b620: 2020 2020 2020 7265 7475 726e 2073 6b72        return skr
+0000b630: 742e 696d 6167 652e 496d 6167 652e 6765  t.image.Image.ge
+0000b640: 745f 6964 7828 7365 6c66 2c20 7669 6577  t_idx(self, view
+0000b650: 2c20 736c 3d73 6c2c 2069 6478 3d69 6478  , sl=sl, idx=idx
+0000b660: 2c20 706f 733d 706f 7329 0a0a 2020 2020  , pos=pos)..    
+0000b670: 6465 6620 6f6e 5f73 6c69 6365 2873 656c  def on_slice(sel
+0000b680: 662c 2076 6965 772c 2073 6c3d 4e6f 6e65  f, view, sl=None
+0000b690: 2c20 6964 783d 4e6f 6e65 2c20 706f 733d  , idx=None, pos=
+0000b6a0: 4e6f 6e65 293a 0a20 2020 2020 2020 2022  None):.        "
+0000b6b0: 2222 4368 6563 6b20 7768 6574 6865 7220  ""Check whether 
+0000b6c0: 7468 6973 2052 4f49 2065 7869 7374 7320  this ROI exists 
+0000b6d0: 6f6e 2061 2067 6976 656e 2073 6c69 6365  on a given slice
+0000b6e0: 2e22 2222 0a0a 2020 2020 2020 2020 6966  ."""..        if
+0000b6f0: 2073 6c20 6973 204e 6f6e 6520 616e 6420   sl is None and 
+0000b700: 6964 7820 6973 204e 6f6e 6520 616e 6420  idx is None and 
+0000b710: 706f 7320 6973 204e 6f6e 653a 0a20 2020  pos is None:.   
+0000b720: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+0000b730: 4661 6c73 650a 2020 2020 2020 2020 6964  False.        id
+0000b740: 7820 3d20 7365 6c66 2e67 6574 5f69 6478  x = self.get_idx
+0000b750: 2876 6965 772c 2073 6c2c 2069 6478 2c20  (view, sl, idx, 
+0000b760: 706f 7329 0a20 2020 2020 2020 2069 6620  pos).        if 
+0000b770: 6964 7820 6973 204e 6f6e 653a 0a20 2020  idx is None:.   
+0000b780: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+0000b790: 4661 6c73 650a 2020 2020 2020 2020 7265  False.        re
+0000b7a0: 7475 726e 2069 6478 2069 6e20 7365 6c66  turn idx in self
+0000b7b0: 2e67 6574 5f69 6e64 6963 6573 2876 6965  .get_indices(vie
+0000b7c0: 7729 0a0a 2020 2020 6465 6620 696e 7465  w)..    def inte
+0000b7d0: 7270 6f6c 6174 655f 706f 696e 7473 2873  rpolate_points(s
+0000b7e0: 656c 662c 206e 5f70 6f69 6e74 3d4e 6f6e  elf, n_point=Non
+0000b7f0: 652c 2064 7879 3d4e 6f6e 652c 0a20 2020  e, dxy=None,.   
+0000b800: 2020 2020 2073 6d6f 6f74 686e 6573 735f       smoothness_
+0000b810: 7065 725f 706f 696e 743d 3029 3a0a 2020  per_point=0):.  
+0000b820: 2020 2020 2020 2727 270a 2020 2020 2020        '''.      
+0000b830: 2020 5265 7475 726e 206e 6577 2052 4f49    Return new ROI
+0000b840: 206f 626a 6563 742c 2077 6974 6820 696e   object, with in
+0000b850: 7465 7270 6f6c 6174 6564 2063 6f6e 746f  terpolated conto
+0000b860: 7572 2070 6f69 6e74 732e 0a0a 2020 2020  ur points...    
+0000b870: 2020 2020 2a2a 5061 7261 6d65 7465 7273      **Parameters
+0000b880: 3a2a 2a0a 0a20 2020 2020 2020 206e 5f70  :**..        n_p
+0000b890: 6f69 6e74 203a 2069 6e74 2c20 6465 6661  oint : int, defa
+0000b8a0: 756c 743d 4e6f 6e65 0a20 2020 2020 2020  ult=None.       
+0000b8b0: 2020 2020 204e 756d 6265 7220 6f66 2070       Number of p
+0000b8c0: 6f69 6e74 7320 7065 7220 636f 6e74 6f75  oints per contou
+0000b8d0: 722c 2061 6674 6572 2069 6e74 6572 706f  r, after interpo
+0000b8e0: 6c61 7469 6f6e 2e20 2054 6869 7320 6d75  lation.  This mu
+0000b8f0: 7374 0a20 2020 2020 2020 2020 2020 2062  st.            b
+0000b900: 6520 7365 7420 746f 204e 6f6e 6520 666f  e set to None fo
+0000b910: 7220 6478 7920 746f 2062 6520 636f 6e73  r dxy to be cons
+0000b920: 6964 6572 6564 2e0a 0a20 2020 2020 2020  idered...       
+0000b930: 2064 7879 203a 2066 6c6f 6174 2c20 6465   dxy : float, de
+0000b940: 6661 756c 743d 4e6f 6e65 0a20 2020 2020  fault=None.     
+0000b950: 2020 2020 2020 2041 7070 726f 7869 6d61         Approxima
+0000b960: 7465 2064 6973 7461 6e63 6520 7265 7175  te distance requ
+0000b970: 6972 6564 2062 6574 7765 656e 2063 6f6e  ired between con
+0000b980: 746f 7572 2070 6f69 6e74 732e 2020 5468  tour points.  Th
+0000b990: 6973 2069 7320 7461 6b65 6e0a 2020 2020  is is taken.    
+0000b9a0: 2020 2020 2020 2020 696e 746f 2061 6363          into acc
+0000b9b0: 6f75 6e74 206f 6e6c 7920 6966 206e 5f70  ount only if n_p
+0000b9c0: 6f69 6e74 2069 7320 7365 7420 746f 204e  oint is set to N
+0000b9d0: 6f6e 652e 2020 466f 7220 6120 636f 6e74  one.  For a cont
+0000b9e0: 6f75 7220 6f66 0a20 2020 2020 2020 2020  our of.         
+0000b9f0: 2020 206c 656e 6774 6820 636f 6e74 6f75     length contou
+0000ba00: 725f 6c65 6e67 7468 2c20 7468 6520 6e75  r_length, the nu
+0000ba10: 6d62 6572 206f 6620 636f 6e74 6f75 7220  mber of contour 
+0000ba20: 706f 696e 7473 2069 7320 7468 656e 2074  points is then t
+0000ba30: 616b 656e 0a20 2020 2020 2020 2020 2020  aken.           
+0000ba40: 2074 6f20 6265 206d 6178 2869 6e74 2863   to be max(int(c
+0000ba50: 6f6e 746f 7572 5f6c 656e 6774 6820 2f20  ontour_length / 
+0000ba60: 6478 7929 2c20 3329 2e20 200a 0a20 2020  dxy), 3).  ..   
+0000ba70: 2020 2020 2073 6d6f 6f74 686e 6573 735f       smoothness_
+0000ba80: 7065 725f 706f 696e 7420 3a20 666c 6f61  per_point : floa
+0000ba90: 742c 2064 6566 6175 6c74 3d30 0a20 2020  t, default=0.   
+0000baa0: 2020 2020 2020 2020 2050 6172 616d 6574           Paramet
+0000bab0: 6572 2064 6574 6572 6d69 6e69 6e67 2074  er determining t
+0000bac0: 6865 2073 6d6f 6f74 686e 6573 7320 6f66  he smoothness of
+0000bad0: 2074 6865 2042 2d73 706c 696e 6520 6375   the B-spline cu
+0000bae0: 7276 6520 7573 6564 0a20 2020 2020 2020  rve used.       
+0000baf0: 2020 2020 2069 6e20 636f 6e74 6f75 7220       in contour 
+0000bb00: 6170 7072 6f78 696d 6174 696f 6e20 666f  approximation fo
+0000bb10: 7220 696e 7465 7270 6f6c 6174 696f 6e2e  r interpolation.
+0000bb20: 2020 5468 6520 7072 6f64 7563 7420 6f66    The product of
+0000bb30: 0a20 2020 2020 2020 2020 2020 2073 6d6f  .            smo
+0000bb40: 6f74 686e 6573 735f 7065 725f 706f 696e  othness_per_poin
+0000bb50: 7420 616e 6420 7468 6520 6e75 6d62 6572  t and the number
+0000bb60: 206f 6620 636f 6e74 6f75 7220 706f 696e   of contour poin
+0000bb70: 7473 2028 7370 6563 6966 6965 640a 2020  ts (specified.  
+0000bb80: 2020 2020 2020 2020 2020 6469 7265 6374            direct
+0000bb90: 6c79 2076 6961 206e 5f70 6f69 6e74 2c20  ly via n_point, 
+0000bba0: 6f72 2069 6e64 6972 6563 746c 7920 7669  or indirectly vi
+0000bbb0: 6120 6478 7929 2063 6f72 7265 7370 6f6e  a dxy) correspon
+0000bbc0: 6473 2074 6f20 7468 650a 2020 2020 2020  ds to the.      
+0000bbd0: 2020 2020 2020 7061 7261 6d65 7465 7220        parameter 
+0000bbe0: 7320 6f66 2073 6369 7079 2e69 6e74 6572  s of scipy.inter
+0000bbf0: 706f 6c61 7465 2e73 706c 7072 6570 202d  polate.splprep -
+0000bc00: 2073 6565 2064 6f63 756d 656e 7461 7469   see documentati
+0000bc10: 6f6e 2061 743a 0a20 2020 2020 2020 200a  on at:.        .
+0000bc20: 2020 2020 2020 2020 2020 2020 6874 7470              http
+0000bc30: 733a 2f2f 7363 6970 792e 6769 7468 7562  s://scipy.github
+0000bc40: 2e69 6f2f 6465 7664 6f63 732f 7265 6665  .io/devdocs/refe
+0000bc50: 7265 6e63 652f 6765 6e65 7261 7465 642f  rence/generated/
+0000bc60: 7363 6970 792e 696e 7465 7270 6f6c 6174  scipy.interpolat
+0000bc70: 652e 7370 6c70 7265 702e 6874 6d6c 2373  e.splprep.html#s
+0000bc80: 6369 7079 2e69 6e74 6572 706f 6c61 7465  cipy.interpolate
+0000bc90: 2e73 706c 7072 6570 0a0a 2020 2020 2020  .splprep..      
+0000bca0: 2020 2020 2020 4120 736d 6f6f 7468 6e65        A smoothne
+0000bcb0: 7373 5f70 6572 5f70 6f69 6e74 206f 6620  ss_per_point of 
+0000bcc0: 3020 666f 7263 6573 2074 6865 2042 2d73  0 forces the B-s
+0000bcd0: 706c 696e 6520 746f 2070 6173 7320 7468  pline to pass th
+0000bce0: 726f 7567 680a 2020 2020 2020 2020 2020  rough.          
+0000bcf0: 2020 616c 6c20 6f66 2074 6865 2070 7265    all of the pre
+0000bd00: 2d69 6e74 6572 706f 6c61 7469 6f6e 2063  -interpolation c
+0000bd10: 6f6e 746f 7572 2070 6f69 6e74 732e 0a20  ontour points.. 
+0000bd20: 2020 2020 2020 2027 2727 0a0a 2020 2020         '''..    
+0000bd30: 2020 2020 6e65 775f 636f 6e74 6f75 7273      new_contours
+0000bd40: 203d 207b 7d0a 2020 2020 2020 2020 666f   = {}.        fo
+0000bd50: 7220 7a2c 2063 6f6e 746f 7572 7320 696e  r z, contours in
+0000bd60: 2073 656c 662e 6765 745f 636f 6e74 6f75   self.get_contou
+0000bd70: 7273 2829 2e69 7465 6d73 2829 3a0a 2020  rs().items():.  
+0000bd80: 2020 2020 2020 2020 2020 6e65 775f 636f            new_co
+0000bd90: 6e74 6f75 7273 5b7a 5d20 3d20 5b5d 0a20  ntours[z] = []. 
+0000bda0: 2020 2020 2020 2020 2020 2066 6f72 2063             for c
+0000bdb0: 6f6e 746f 7572 2069 6e20 636f 6e74 6f75  ontour in contou
+0000bdc0: 7273 3a0a 2020 2020 2020 2020 2020 2020  rs:.            
+0000bdd0: 2020 2020 6e65 775f 636f 6e74 6f75 7220      new_contour 
+0000bde0: 3d20 696e 7465 7270 6f6c 6174 655f 706f  = interpolate_po
+0000bdf0: 696e 7473 5f73 696e 676c 655f 636f 6e74  ints_single_cont
+0000be00: 6f75 7228 0a20 2020 2020 2020 2020 2020  our(.           
+0000be10: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
+0000be20: 746f 7572 2c20 6e5f 706f 696e 742c 2064  tour, n_point, d
+0000be30: 7879 2c20 736d 6f6f 7468 6e65 7373 5f70  xy, smoothness_p
+0000be40: 6572 5f70 6f69 6e74 290a 2020 2020 2020  er_point).      
+0000be50: 2020 2020 2020 2020 2020 6e65 775f 636f            new_co
+0000be60: 6e74 6f75 7273 5b7a 5d2e 6170 7065 6e64  ntours[z].append
+0000be70: 286e 6577 5f63 6f6e 746f 7572 290a 0a20  (new_contour).. 
+0000be80: 2020 2020 2020 2023 2043 6c6f 6e65 2073         # Clone s
+0000be90: 656c 662c 2074 6865 6e20 636c 6561 7220  elf, then clear 
+0000bea0: 6d61 736b 2061 6e64 2072 6573 6574 2063  mask and reset c
+0000beb0: 6f6e 746f 7572 7320 6f66 2063 6c6f 6e65  ontours of clone
+0000bec0: 0a20 2020 2020 2020 2072 6f69 203d 2052  .        roi = R
+0000bed0: 4f49 2873 656c 6629 0a20 2020 2020 2020  OI(self).       
+0000bee0: 2072 6f69 2e69 6e70 7574 5f63 6f6e 746f   roi.input_conto
+0000bef0: 7572 7320 3d20 6e65 775f 636f 6e74 6f75  urs = new_contou
+0000bf00: 7273 0a20 2020 2020 2020 2072 6f69 2e63  rs.        roi.c
+0000bf10: 6f6e 746f 7572 7320 3d20 7b22 782d 7922  ontours = {"x-y"
+0000bf20: 3a20 6e65 775f 636f 6e74 6f75 7273 7d0a  : new_contours}.
+0000bf30: 2020 2020 2020 2020 726f 692e 6c6f 6164          roi.load
+0000bf40: 6564 5f6d 6173 6b20 3d20 4661 6c73 650a  ed_mask = False.
+0000bf50: 2020 2020 2020 2020 726f 692e 6d61 736b          roi.mask
+0000bf60: 203d 204e 6f6e 650a 0a20 2020 2020 2020   = None..       
+0000bf70: 2072 6574 7572 6e20 726f 690a 0a20 2020   return roi..   
+0000bf80: 2064 6566 2067 6574 5f63 656e 7472 6f69   def get_centroi
+0000bf90: 6428 0a20 2020 2020 2020 2073 656c 662c  d(.        self,
+0000bfa0: 0a20 2020 2020 2020 2076 6965 773d 2278  .        view="x
+0000bfb0: 2d79 222c 0a20 2020 2020 2020 2073 696e  -y",.        sin
+0000bfc0: 676c 655f 736c 6963 653d 4661 6c73 652c  gle_slice=False,
+0000bfd0: 0a20 2020 2020 2020 2073 6c3d 4e6f 6e65  .        sl=None
+0000bfe0: 2c0a 2020 2020 2020 2020 6964 783d 4e6f  ,.        idx=No
+0000bff0: 6e65 2c0a 2020 2020 2020 2020 706f 733d  ne,.        pos=
+0000c000: 4e6f 6e65 2c0a 2020 2020 2020 2020 756e  None,.        un
+0000c010: 6974 733d 226d 6d22 2c0a 2020 2020 2020  its="mm",.      
+0000c020: 2020 6d65 7468 6f64 3d4e 6f6e 652c 0a20    method=None,. 
+0000c030: 2020 2020 2020 2066 6f72 6365 3d54 7275         force=Tru
+0000c040: 652c 0a20 2020 2029 3a0a 2020 2020 2020  e,.    ):.      
+0000c050: 2020 2222 2247 6574 2065 6974 6865 7220    """Get either 
+0000c060: 3344 2067 6c6f 6261 6c20 6365 6e74 726f  3D global centro
+0000c070: 6964 2070 6f73 6974 696f 6e20 6f72 2032  id position or 2
+0000c080: 4420 6365 6e74 726f 6964 2070 6f73 6974  D centroid posit
+0000c090: 696f 6e20 6f6e 200a 2020 2020 2020 2020  ion on .        
+0000c0a0: 6120 7369 6e67 6c65 2073 6c69 6365 2e20  a single slice. 
+0000c0b0: 4966 2073 696e 676c 655f 736c 6963 653d  If single_slice=
+0000c0c0: 4661 6c73 652c 2074 6865 2063 616c 6375  False, the calcu
+0000c0d0: 6c61 7465 6420 676c 6f62 616c 2063 656e  lated global cen
+0000c0e0: 7472 6f69 6420 0a20 2020 2020 2020 2077  troid .        w
+0000c0f0: 696c 6c20 6265 2063 6163 6865 6420 696e  ill be cached in
+0000c100: 2073 656c 662e 5f63 656e 7472 6f69 645b   self._centroid[
+0000c110: 756e 6974 735d 2061 6e64 2072 6574 7572  units] and retur
+0000c120: 6e65 6420 6966 2063 616c 6c65 6420 6167  ned if called ag
+0000c130: 6169 6e2c 0a20 2020 2020 2020 2075 6e6c  ain,.        unl
+0000c140: 6573 7320 666f 7263 653d 5472 7565 2e0a  ess force=True..
+0000c150: 0a20 2020 2020 2020 202a 2a50 6172 616d  .        **Param
+0000c160: 6574 6572 733a 2a2a 0a20 2020 2020 2020  eters:**.       
+0000c170: 200a 2020 2020 2020 2020 7369 6e67 6c65   .        single
+0000c180: 5f73 6c69 6365 203a 2062 6f6f 6c2c 2064  _slice : bool, d
+0000c190: 6566 6175 6c74 3d46 616c 7365 0a20 2020  efault=False.   
+0000c1a0: 2020 2020 2020 2020 2049 6620 4661 6c73           If Fals
+0000c1b0: 652c 2074 6865 2067 6c6f 6261 6c20 3344  e, the global 3D
+0000c1c0: 2063 656e 7472 6f69 6420 6f66 2074 6865   centroid of the
+0000c1d0: 2065 6e74 6972 6520 524f 4920 7769 6c6c   entire ROI will
+0000c1e0: 2062 6520 7265 7475 726e 6564 3b0a 2020   be returned;.  
+0000c1f0: 2020 2020 2020 2020 2020 6f74 6865 7277            otherw
+0000c200: 6973 652c 2074 6865 2032 4420 6365 6e74  ise, the 2D cent
+0000c210: 726f 6964 206f 6e20 6120 7369 6e67 6c65  roid on a single
+0000c220: 2073 6c69 6365 2077 696c 6c20 6265 2072   slice will be r
+0000c230: 6574 7572 6e65 642e 0a0a 2020 2020 2020  eturned...      
+0000c240: 2020 7669 6577 203a 2073 7472 2c20 6465    view : str, de
+0000c250: 6661 756c 743d 2278 2d79 220a 2020 2020  fault="x-y".    
+0000c260: 2020 2020 2020 2020 4f72 6965 6e74 6174          Orientat
+0000c270: 696f 6e20 6f66 2073 6c69 6365 206f 6e20  ion of slice on 
+0000c280: 7768 6963 6820 746f 2067 6574 2063 656e  which to get cen
+0000c290: 7472 6f69 642e 204f 6e6c 7920 7573 6564  troid. Only used
+0000c2a0: 2069 6620 0a20 2020 2020 2020 2020 2020   if .           
+0000c2b0: 2073 696e 676c 655f 736c 6963 653d 5472   single_slice=Tr
+0000c2c0: 7565 2e20 4966 2075 7369 6e67 2c20 3c61  ue. If using, <a
+0000c2d0: 783e 206d 7573 7420 6265 2061 6e20 6178  x> must be an ax
+0000c2e0: 6973 2074 6861 7420 6c69 6573 2061 6c6f  is that lies alo
+0000c2f0: 6e67 0a20 2020 2020 2020 2020 2020 2074  ng.            t
+0000c300: 6865 2073 6c69 6365 2069 6e20 7468 6973  he slice in this
+0000c310: 206f 7269 656e 7461 7469 6f6e 2e0a 0a20   orientation... 
+0000c320: 2020 2020 2020 2073 6c20 3a20 696e 742c         sl : int,
+0000c330: 2064 6566 6175 6c74 3d4e 6f6e 650a 2020   default=None.  
+0000c340: 2020 2020 2020 2020 2020 536c 6963 6520            Slice 
+0000c350: 6e75 6d62 6572 2e20 4966 206e 6f6e 6520  number. If none 
+0000c360: 6f66 203c 736c 3e2c 203c 6964 783e 206f  of <sl>, <idx> o
+0000c370: 7220 3c70 6f73 3e20 6172 6520 7375 7070  r <pos> are supp
+0000c380: 6c69 6564 2062 7574 0a20 2020 2020 2020  lied but.       
+0000c390: 2020 2020 203c 7369 6e67 6c65 5f73 6c69       <single_sli
+0000c3a0: 6365 3e20 6973 2054 7275 652c 2074 6865  ce> is True, the
+0000c3b0: 2063 656e 7472 616c 2073 6c69 6365 206f   central slice o
+0000c3c0: 6620 7468 6520 524f 4920 7769 6c6c 2062  f the ROI will b
+0000c3d0: 6520 7573 6564 2e0a 0a20 2020 2020 2020  e used...       
+0000c3e0: 2069 6478 203a 2069 6e74 2c20 6465 6661   idx : int, defa
+0000c3f0: 756c 743d 4e6f 6e65 0a20 2020 2020 2020  ult=None.       
+0000c400: 2020 2020 2041 7272 6179 2069 6e64 6578       Array index
+0000c410: 206f 6620 736c 6963 652e 2049 6620 6e6f   of slice. If no
+0000c420: 6e65 206f 6620 3c73 6c3e 2c20 3c69 6478  ne of <sl>, <idx
+0000c430: 3e20 6f72 203c 706f 733e 2061 7265 2073  > or <pos> are s
+0000c440: 7570 706c 6965 6420 6275 740a 2020 2020  upplied but.    
+0000c450: 2020 2020 2020 2020 3c73 696e 676c 655f          <single_
+0000c460: 736c 6963 653e 2069 7320 5472 7565 2c20  slice> is True, 
+0000c470: 7468 6520 6365 6e74 7261 6c20 736c 6963  the central slic
+0000c480: 6520 6f66 2074 6865 2052 4f49 2077 696c  e of the ROI wil
+0000c490: 6c20 6265 2075 7365 642e 0a0a 2020 2020  l be used...    
+0000c4a0: 2020 2020 706f 7320 3a20 666c 6f61 742c      pos : float,
+0000c4b0: 2064 6566 6175 6c74 3d4e 6f6e 650a 2020   default=None.  
+0000c4c0: 2020 2020 2020 2020 2020 536c 6963 6520            Slice 
+0000c4d0: 706f 7369 7469 6f6e 2069 6e20 6d6d 2e20  position in mm. 
+0000c4e0: 4966 206e 6f6e 6520 6f66 203c 736c 3e2c  If none of <sl>,
+0000c4f0: 203c 6964 783e 206f 7220 3c70 6f73 3e20   <idx> or <pos> 
+0000c500: 6172 6520 7375 7070 6c69 6564 2062 7574  are supplied but
+0000c510: 0a20 2020 2020 2020 2020 2020 203c 7369  .            <si
+0000c520: 6e67 6c65 5f73 6c69 6365 3e20 6973 2054  ngle_slice> is T
+0000c530: 7275 652c 2074 6865 2063 656e 7472 616c  rue, the central
+0000c540: 2073 6c69 6365 206f 6620 7468 6520 524f   slice of the RO
+0000c550: 4920 7769 6c6c 2062 6520 7573 6564 2e0a  I will be used..
+0000c560: 0a20 2020 2020 2020 2075 6e69 7473 203a  .        units :
+0000c570: 2073 7472 2c20 6465 6661 756c 743d 226d   str, default="m
+0000c580: 6d22 0a20 2020 2020 2020 2020 2020 2055  m".            U
+0000c590: 6e69 7473 206f 6620 6365 6e74 726f 6964  nits of centroid
+0000c5a0: 2e20 4361 6e20 6265 2065 6974 6865 7220  . Can be either 
+0000c5b0: 6f66 3a0a 2020 2020 2020 2020 2020 2020  of:.            
+0000c5c0: 2020 2020 2d20 226d 6d22 3a20 7265 7475      - "mm": retu
+0000c5d0: 726e 2063 656e 7472 6f69 6420 706f 7369  rn centroid posi
+0000c5e0: 7469 6f6e 2069 6e20 6d69 6c6c 696d 6574  tion in millimet
+0000c5f0: 7265 732e 0a20 2020 2020 2020 2020 2020  res..           
+0000c600: 2020 2020 202d 2022 766f 7865 6c73 223a       - "voxels":
+0000c610: 2072 6574 7572 6e20 6365 6e74 726f 6964   return centroid
+0000c620: 2070 6f73 6974 696f 6e20 696e 2074 6572   position in ter
+0000c630: 6d73 206f 6620 6172 7261 7920 696e 6469  ms of array indi
+0000c640: 6365 732e 0a20 2020 2020 2020 2020 2020  ces..           
+0000c650: 2020 2020 202d 2022 736c 6963 6522 3a20       - "slice": 
+0000c660: 7265 7475 726e 2063 656e 7472 6f69 6420  return centroid 
+0000c670: 706f 7369 7469 6f6e 2069 6e20 7465 726d  position in term
+0000c680: 7320 6f66 2073 6c69 6365 206e 756d 6265  s of slice numbe
+0000c690: 7273 2e0a 0a20 2020 2020 2020 2020 2020  rs...           
+0000c6a0: 2049 6620 756e 6974 733d 2276 6f78 656c   If units="voxel
+0000c6b0: 7322 206f 7220 2273 6c69 6365 2220 6973  s" or "slice" is
+0000c6c0: 2072 6571 7565 7374 6564 2062 7574 2074   requested but t
+0000c6d0: 6869 7320 524f 4920 6f6e 6c79 2068 6173  his ROI only has
+0000c6e0: 200a 2020 2020 2020 2020 2020 2020 636f   .            co
+0000c6f0: 6e74 6f75 7273 2061 6e64 206e 6f20 6d61  ntours and no ma
+0000c700: 736b 2073 6861 7065 2f76 6f78 656c 2073  sk shape/voxel s
+0000c710: 697a 6520 696e 666f 726d 6174 696f 6e2c  ize information,
+0000c720: 2061 6e20 6572 726f 7220 7769 6c6c 2062   an error will b
+0000c730: 6520 0a20 2020 2020 2020 2020 2020 2072  e .            r
+0000c740: 6169 7365 6420 2875 6e6c 6573 7320 6178  aised (unless ax
+0000c750: 3d22 7a22 2c20 696e 2077 6869 6368 2063  ="z", in which c
+0000c760: 6173 6520 766f 7865 6c20 7369 7a65 2077  ase voxel size w
+0000c770: 696c 6c20 6265 2069 6e66 6572 7265 6420  ill be inferred 
+0000c780: 0a20 2020 2020 2020 2020 2020 2066 726f  .            fro
+0000c790: 6d20 7370 6163 696e 6720 6265 7477 6565  m spacing betwee
+0000c7a0: 6e20 736c 6963 6573 292e 0a0a 2020 2020  n slices)...    
+0000c7b0: 2020 2020 6d65 7468 6f64 203a 2073 7472      method : str
+0000c7c0: 2c20 6465 6661 756c 743d 4e6f 6e65 0a20  , default=None. 
+0000c7d0: 2020 2020 2020 2020 2020 204d 6574 686f             Metho
+0000c7e0: 6420 746f 2075 7365 2066 6f72 2063 656e  d to use for cen
+0000c7f0: 7472 6f69 6420 6361 6c63 756c 6174 696f  troid calculatio
+0000c800: 6e2e 2043 616e 2062 653a 200a 2020 2020  n. Can be: .    
+0000c810: 2020 2020 2020 2020 2020 2020 2d20 2263              - "c
+0000c820: 6f6e 746f 7572 223a 2067 6574 2063 656e  ontour": get cen
+0000c830: 7472 6f69 6420 6f66 2073 6861 7065 6c79  troid of shapely
+0000c840: 2063 6f6e 746f 7572 2873 292e 0a20 2020   contour(s)..   
+0000c850: 2020 2020 2020 2020 2020 2020 202d 2022               - "
+0000c860: 6d61 736b 223a 2067 6574 2061 7665 7261  mask": get avera
+0000c870: 6765 2070 6f73 6974 696f 6e20 6f66 2076  ge position of v
+0000c880: 6f78 656c 7320 696e 2062 696e 6172 7920  oxels in binary 
+0000c890: 6d61 736b 2e0a 2020 2020 2020 2020 2020  mask..          
+0000c8a0: 2020 2020 2020 2d20 4e6f 6e65 3a20 7573        - None: us
+0000c8b0: 6520 7468 6520 6d65 7468 6f64 2073 6574  e the method set
+0000c8c0: 2069 6e20 7365 6c66 2e64 6566 6175 6c74   in self.default
+0000c8d0: 5f67 656f 6d5f 6d65 7468 6f64 2e0a 0a20  _geom_method... 
+0000c8e0: 2020 2020 2020 2066 6f72 6365 203a 2062         force : b
+0000c8f0: 6f6f 6c2c 2064 6566 6175 6c74 3d54 7275  ool, default=Tru
+0000c900: 650a 2020 2020 2020 2020 2020 2020 4966  e.            If
+0000c910: 2054 7275 652c 2074 6865 2067 6c6f 6261   True, the globa
+0000c920: 6c20 6365 6e74 726f 6964 2077 696c 6c20  l centroid will 
+0000c930: 616c 7761 7973 2062 6520 7265 6361 6c63  always be recalc
+0000c940: 756c 6174 6564 3b20 0a20 2020 2020 2020  ulated; .       
+0000c950: 2020 2020 206f 7468 6572 7769 7365 2c20       otherwise, 
+0000c960: 6974 2077 696c 6c20 6f6e 6c79 2062 6520  it will only be 
+0000c970: 6361 6c63 756c 6174 6564 2069 6620 6974  calculated if it
+0000c980: 2068 6173 206e 6f74 2079 6574 2062 6565   has not yet bee
+0000c990: 6e20 6361 6368 6564 200a 2020 2020 2020  n cached .      
+0000c9a0: 2020 2020 2020 696e 2073 656c 662e 5f76        in self._v
+0000c9b0: 6f6c 756d 652e 2020 4e6f 7465 2074 6861  olume.  Note tha
+0000c9c0: 7420 6966 2073 696e 676c 655f 736c 6963  t if single_slic
+0000c9d0: 653d 5472 7565 2c20 7468 6520 6365 6e74  e=True, the cent
+0000c9e0: 726f 6964 2077 696c 6c20 0a20 2020 2020  roid will .     
+0000c9f0: 2020 2020 2020 2061 6c77 6179 7320 6265         always be
+0000ca00: 2072 6563 616c 6375 6c61 7465 642e 0a20   recalculated.. 
+0000ca10: 2020 2020 2020 2022 2222 0a0a 2020 2020         """..    
+0000ca20: 2020 2020 2320 4966 2067 6c6f 6261 6c20      # If global 
+0000ca30: 6365 6e74 726f 6964 2061 6c72 6561 6479  centroid already
+0000ca40: 2063 6163 6865 642c 2072 6574 7572 6e20   cached, return 
+0000ca50: 6361 6368 6564 2076 616c 7565 0a20 2020  cached value.   
+0000ca60: 2020 2020 2069 6620 6e6f 7420 7369 6e67       if not sing
+0000ca70: 6c65 5f73 6c69 6365 2061 6e64 206e 6f74  le_slice and not
+0000ca80: 2066 6f72 6365 3a0a 2020 2020 2020 2020   force:.        
+0000ca90: 2020 2020 6966 2068 6173 6174 7472 2873      if hasattr(s
+0000caa0: 656c 662c 2022 5f63 656e 7472 6f69 6422  elf, "_centroid"
+0000cab0: 2920 616e 6420 756e 6974 7320 696e 2073  ) and units in s
+0000cac0: 656c 662e 5f63 656e 7472 6f69 643a 0a20  elf._centroid:. 
+0000cad0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+0000cae0: 6574 7572 6e20 7365 6c66 2e5f 6365 6e74  eturn self._cent
+0000caf0: 726f 6964 5b75 6e69 7473 5d0a 0a20 2020  roid[units]..   
+0000cb00: 2020 2020 2023 2047 6574 2064 6566 6175       # Get defau
+0000cb10: 6c74 2073 6c69 6365 2061 6e64 206d 6574  lt slice and met
+0000cb20: 686f 640a 2020 2020 2020 2020 7365 6c66  hod.        self
+0000cb30: 2e6c 6f61 6428 290a 2020 2020 2020 2020  .load().        
+0000cb40: 6966 206d 6574 686f 6420 6973 204e 6f6e  if method is Non
+0000cb50: 653a 0a20 2020 2020 2020 2020 2020 206d  e:.            m
+0000cb60: 6574 686f 6420 3d20 7365 6c66 2e64 6566  ethod = self.def
+0000cb70: 6175 6c74 5f67 656f 6d5f 6d65 7468 6f64  ault_geom_method
+0000cb80: 0a20 2020 2020 2020 2069 6620 7369 6e67  .        if sing
+0000cb90: 6c65 5f73 6c69 6365 2061 6e64 2070 6f73  le_slice and pos
+0000cba0: 2069 7320 4e6f 6e65 2061 6e64 2073 6c20   is None and sl 
+0000cbb0: 6973 204e 6f6e 6520 616e 6420 6964 7820  is None and idx 
+0000cbc0: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
+0000cbd0: 2020 2020 2069 6478 203d 2073 656c 662e       idx = self.
+0000cbe0: 6765 745f 6d69 645f 6964 7828 7669 6577  get_mid_idx(view
+0000cbf0: 290a 0a20 2020 2020 2020 2023 2049 6620  )..        # If 
+0000cc00: 7369 6e67 6c65 2073 6c69 6365 2072 6571  single slice req
+0000cc10: 7565 7374 6564 2061 6e64 206e 6f74 206f  uested and not o
+0000cc20: 6e20 6375 7272 656e 7420 736c 6963 652c  n current slice,
+0000cc30: 2072 6574 7572 6e20 4e6f 6e65 2c20 4e6f   return None, No
+0000cc40: 6e65 0a20 2020 2020 2020 2069 6620 7369  ne.        if si
+0000cc50: 6e67 6c65 5f73 6c69 6365 2061 6e64 206e  ngle_slice and n
+0000cc60: 6f74 2073 656c 662e 6f6e 5f73 6c69 6365  ot self.on_slice
+0000cc70: 2876 6965 772c 2073 6c3d 736c 2c20 6964  (view, sl=sl, id
+0000cc80: 783d 6964 782c 2070 6f73 3d70 6f73 293a  x=idx, pos=pos):
+0000cc90: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+0000cca0: 7572 6e20 6e70 2e61 7272 6179 285b 4e6f  urn np.array([No
+0000ccb0: 6e65 2c20 4e6f 6e65 5d29 0a0a 2020 2020  ne, None])..    
+0000ccc0: 2020 2020 2320 4361 6c63 756c 6174 6520      # Calculate 
+0000ccd0: 6365 6e74 726f 6964 2066 726f 6d20 5368  centroid from Sh
+0000cce0: 6170 656c 7920 706f 6c79 676f 6e73 0a20  apely polygons. 
+0000ccf0: 2020 2020 2020 2063 656e 7472 6f69 6420         centroid 
+0000cd00: 3d20 7b7d 0a20 2020 2020 2020 2069 6620  = {}.        if 
+0000cd10: 6d65 7468 6f64 203d 3d20 2263 6f6e 746f  method == "conto
+0000cd20: 7572 223a 0a0a 2020 2020 2020 2020 2020  ur":..          
+0000cd30: 2020 2320 4765 7420 3244 206f 7220 3344    # Get 2D or 3D
+0000cd40: 2063 656e 7472 6f69 6473 2061 6e64 2061   centroids and a
+0000cd50: 7265 6173 206f 6620 6561 6368 2070 6f6c  reas of each pol
+0000cd60: 7967 6f6e 206f 6e20 7468 6520 6465 7369  ygon on the desi
+0000cd70: 7265 640a 2020 2020 2020 2020 2020 2020  red.            
+0000cd80: 2320 736c 6963 6528 7329 0a20 2020 2020  # slice(s).     
+0000cd90: 2020 2020 2020 2069 6620 7369 6e67 6c65         if single
+0000cda0: 5f73 6c69 6365 3a0a 2020 2020 2020 2020  _slice:.        
+0000cdb0: 2020 2020 2020 2020 706f 6c79 676f 6e73          polygons
+0000cdc0: 203d 2073 656c 662e 6765 745f 706f 6c79   = self.get_poly
+0000cdd0: 676f 6e73 5f6f 6e5f 736c 6963 6528 7669  gons_on_slice(vi
+0000cde0: 6577 2c20 736c 2c20 6964 782c 2070 6f73  ew, sl, idx, pos
+0000cdf0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0000ce00: 2020 6365 6e74 726f 6964 7320 3d20 5b5d    centroids = []
+0000ce10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000ce20: 2061 7265 6173 203d 205b 5d0a 2020 2020   areas = [].    
+0000ce30: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+0000ce40: 7020 696e 2070 6f6c 7967 6f6e 733a 0a20  p in polygons:. 
+0000ce50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ce60: 2020 2063 656e 7472 6f69 645f 7879 203d     centroid_xy =
+0000ce70: 2070 2e63 656e 7472 6f69 642e 7879 0a20   p.centroid.xy. 
+0000ce80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ce90: 2020 2063 656e 7472 6f69 6473 2e61 7070     centroids.app
+0000cea0: 656e 6428 6e70 2e61 7272 6179 285b 0a20  end(np.array([. 
+0000ceb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cec0: 2020 2020 2020 2063 656e 7472 6f69 645f         centroid_
+0000ced0: 7879 5b30 5d5b 305d 2c20 6365 6e74 726f  xy[0][0], centro
+0000cee0: 6964 5f78 795b 315d 5b30 5d0a 2020 2020  id_xy[1][0].    
+0000cef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cf00: 5d29 290a 2020 2020 2020 2020 2020 2020  ])).            
+0000cf10: 2020 2020 2020 2020 6172 6561 732e 6170          areas.ap
+0000cf20: 7065 6e64 2870 2e61 7265 6129 0a20 2020  pend(p.area).   
+0000cf30: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+0000cf40: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+0000cf50: 656e 7472 6f69 6473 203d 205b 5d0a 2020  entroids = [].  
+0000cf60: 2020 2020 2020 2020 2020 2020 2020 6172                ar
+0000cf70: 6561 7320 3d20 5b5d 0a20 2020 2020 2020  eas = [].       
+0000cf80: 2020 2020 2020 2020 2070 6f6c 7967 6f6e           polygon
+0000cf90: 5f64 6963 7420 3d20 7365 6c66 2e67 6574  _dict = self.get
+0000cfa0: 5f70 6f6c 7967 6f6e 7328 290a 2020 2020  _polygons().    
+0000cfb0: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+0000cfc0: 7a2c 2070 6f6c 7967 6f6e 7320 696e 2070  z, polygons in p
+0000cfd0: 6f6c 7967 6f6e 5f64 6963 742e 6974 656d  olygon_dict.item
+0000cfe0: 7328 293a 0a20 2020 2020 2020 2020 2020  s():.           
+0000cff0: 2020 2020 2020 2020 2066 6f72 2070 2069           for p i
+0000d000: 6e20 706f 6c79 676f 6e73 3a0a 2020 2020  n polygons:.    
+0000d010: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d020: 2020 2020 6365 6e74 726f 6964 5f78 7920      centroid_xy 
+0000d030: 3d20 702e 6365 6e74 726f 6964 2e78 790a  = p.centroid.xy.
+0000d040: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d050: 2020 2020 2020 2020 6365 6e74 726f 6964          centroid
+0000d060: 732e 6170 7065 6e64 286e 702e 6172 7261  s.append(np.arra
+0000d070: 7928 5b0a 2020 2020 2020 2020 2020 2020  y([.            
+0000d080: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d090: 6365 6e74 726f 6964 5f78 795b 305d 5b30  centroid_xy[0][0
+0000d0a0: 5d2c 2063 656e 7472 6f69 645f 7879 5b31  ], centroid_xy[1
+0000d0b0: 5d5b 305d 2c20 7a0a 2020 2020 2020 2020  ][0], z.        
+0000d0c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d0d0: 5d29 290a 2020 2020 2020 2020 2020 2020  ])).            
+0000d0e0: 2020 2020 2020 2020 2020 2020 6172 6561              area
+0000d0f0: 732e 6170 7065 6e64 2870 2e61 7265 6129  s.append(p.area)
+0000d100: 0a0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
+0000d110: 4765 7420 7765 6967 6874 6564 2061 7665  Get weighted ave
+0000d120: 7261 6765 206f 6620 706f 6c79 676f 6e20  rage of polygon 
+0000d130: 6365 6e74 726f 6964 730a 2020 2020 2020  centroids.      
+0000d140: 2020 2020 2020 7765 6967 6874 6564 5f73        weighted_s
+0000d150: 756d 203d 206e 702e 7375 6d28 0a20 2020  um = np.sum(.   
+0000d160: 2020 2020 2020 2020 2020 2020 205b 6365               [ce
+0000d170: 6e74 726f 6964 735b 695d 202a 2061 7265  ntroids[i] * are
+0000d180: 6173 5b69 5d20 666f 7220 6920 696e 2072  as[i] for i in r
+0000d190: 616e 6765 286c 656e 2863 656e 7472 6f69  ange(len(centroi
+0000d1a0: 6473 2929 5d2c 0a20 2020 2020 2020 2020  ds))],.         
+0000d1b0: 2020 2020 2020 2061 7869 733d 300a 2020         axis=0.  
+0000d1c0: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+0000d1d0: 2020 2020 2020 2020 6365 6e74 726f 6964          centroid
+0000d1e0: 5b22 6d6d 225d 203d 2077 6569 6768 7465  ["mm"] = weighte
+0000d1f0: 645f 7375 6d20 2f20 7375 6d28 6172 6561  d_sum / sum(area
+0000d200: 7329 0a0a 2020 2020 2020 2020 2020 2020  s)..            
+0000d210: 2320 4361 6c63 756c 6174 6520 696e 2076  # Calculate in v
+0000d220: 6f78 656c 7320 616e 6420 736c 6963 6573  oxels and slices
+0000d230: 2069 6620 706f 7373 6962 6c65 0a20 2020   if possible.   
+0000d240: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
+0000d250: 2e76 6f78 656c 5f73 697a 6520 6973 204e  .voxel_size is N
+0000d260: 6f6e 6520 616e 6420 7365 6c66 2e73 6861  one and self.sha
+0000d270: 7065 2069 7320 4e6f 6e65 3a0a 2020 2020  pe is None:.    
+0000d280: 2020 2020 2020 2020 2020 2020 6966 2075              if u
+0000d290: 6e69 7473 2069 6e20 5b22 766f 7865 6c73  nits in ["voxels
+0000d2a0: 222c 2022 736c 6963 6522 5d20 2061 6e64  ", "slice"]  and
+0000d2b0: 2073 656c 662e 7368 6170 6520 6973 204e   self.shape is N
+0000d2c0: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+0000d2d0: 2020 2020 2020 2020 2072 6169 7365 2052           raise R
+0000d2e0: 756e 7469 6d65 4572 726f 7228 2243 616e  untimeError("Can
+0000d2f0: 6e6f 7420 636f 6d70 7574 6520 6365 6e74  not compute cent
+0000d300: 726f 6964 2069 6e20 766f 7865 6c73 2f73  roid in voxels/s
+0000d310: 6c69 6365 220a 2020 2020 2020 2020 2020  lice".          
+0000d320: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d330: 2020 2020 2020 2020 2020 2020 2022 206e               " n
+0000d340: 756d 6265 7273 2066 726f 6d20 636f 6e74  umbers from cont
+0000d350: 6f75 7273 2077 6974 686f 7574 206b 6e6f  ours without kno
+0000d360: 7769 6e67 2076 6f78 656c 220a 2020 2020  wing voxel".    
+0000d370: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0000d380: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d390: 2020 2020 736b 7274 2e69 6d61 6765 2e5f      skrt.image._
-0000d3a0: 706c 6f74 5f61 7865 735b 7669 6577 5d29  plot_axes[view])
-0000d3b0: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000d3c0: 2020 6365 6e74 726f 6964 5b22 766f 7865    centroid["voxe
-0000d3d0: 6c73 225d 203d 206e 702e 6172 7261 7928  ls"] = np.array(
-0000d3e0: 5b0a 2020 2020 2020 2020 2020 2020 2020  [.              
-0000d3f0: 2020 2020 2020 7365 6c66 2e70 6f73 5f74        self.pos_t
-0000d400: 6f5f 6964 7828 632c 2061 783d 692c 2072  o_idx(c, ax=i, r
-0000d410: 6574 7572 6e5f 696e 743d 4661 6c73 6529  eturn_int=False)
-0000d420: 200a 2020 2020 2020 2020 2020 2020 2020   .              
-0000d430: 2020 2020 2020 666f 7220 692c 2063 2069        for i, c i
-0000d440: 6e20 7a69 7028 7669 6577 5f61 7865 732c  n zip(view_axes,
-0000d450: 2063 656e 7472 6f69 645b 226d 6d22 5d29   centroid["mm"])
-0000d460: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000d470: 205d 290a 0a20 2020 2020 2020 2020 2020   ])..           
-0000d480: 2020 2020 2063 656e 7472 6f69 645b 2273       centroid["s
-0000d490: 6c69 6365 225d 203d 206e 702e 6172 7261  lice"] = np.arra
-0000d4a0: 7928 5b0a 2020 2020 2020 2020 2020 2020  y([.            
-0000d4b0: 2020 2020 2020 2020 7365 6c66 2e70 6f73          self.pos
-0000d4c0: 5f74 6f5f 736c 6963 6528 632c 2061 783d  _to_slice(c, ax=
-0000d4d0: 692c 2072 6574 7572 6e5f 696e 743d 4661  i, return_int=Fa
-0000d4e0: 6c73 6529 200a 2020 2020 2020 2020 2020  lse) .          
-0000d4f0: 2020 2020 2020 2020 2020 666f 7220 692c            for i,
-0000d500: 2063 2069 6e20 7a69 7028 7669 6577 5f61   c in zip(view_a
-0000d510: 7865 732c 2063 656e 7472 6f69 645b 226d  xes, centroid["m
-0000d520: 6d22 5d29 0a20 2020 2020 2020 2020 2020  m"]).           
-0000d530: 2020 2020 205d 290a 0a20 2020 2020 2020       ])..       
-0000d540: 2023 204f 7468 6572 7769 7365 2c20 6361   # Otherwise, ca
-0000d550: 6c63 756c 6174 6520 6365 6e74 726f 6964  lculate centroid
-0000d560: 2066 726f 6d20 6269 6e61 7279 206d 6173   from binary mas
-0000d570: 6b0a 2020 2020 2020 2020 656c 7365 3a20  k.        else: 
-0000d580: 0a0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
-0000d590: 4765 7420 3244 206f 7220 3344 2064 6174  Get 2D or 3D dat
-0000d5a0: 6120 6672 6f6d 2077 6869 6368 2074 6f20  a from which to 
-0000d5b0: 6361 6c63 756c 6174 6520 6365 6e74 726f  calculate centro
-0000d5c0: 6964 0a20 2020 2020 2020 2020 2020 2069  id.            i
-0000d5d0: 6620 7369 6e67 6c65 5f73 6c69 6365 3a0a  f single_slice:.
-0000d5e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d5f0: 6966 206e 6f74 2073 656c 662e 6f6e 5f73  if not self.on_s
-0000d600: 6c69 6365 2876 6965 772c 2073 6c3d 736c  lice(view, sl=sl
-0000d610: 2c20 6964 783d 6964 782c 2070 6f73 3d70  , idx=idx, pos=p
-0000d620: 6f73 293a 0a20 2020 2020 2020 2020 2020  os):.           
-0000d630: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-0000d640: 6e70 2e61 7272 6179 285b 4e6f 6e65 2c20  np.array([None, 
-0000d650: 4e6f 6e65 5d29 0a20 2020 2020 2020 2020  None]).         
-0000d660: 2020 2020 2020 2064 6174 6120 3d20 7365         data = se
-0000d670: 6c66 2e67 6574 5f73 6c69 6365 2876 6965  lf.get_slice(vie
-0000d680: 772c 2073 6c3d 736c 2c20 6964 783d 6964  w, sl=sl, idx=id
-0000d690: 782c 2070 6f73 3d70 6f73 290a 2020 2020  x, pos=pos).    
-0000d6a0: 2020 2020 2020 2020 2020 2020 6178 6573              axes
-0000d6b0: 203d 2073 6b72 742e 696d 6167 652e 5f70   = skrt.image._p
-0000d6c0: 6c6f 745f 6178 6573 5b76 6965 775d 0a20  lot_axes[view]. 
-0000d6d0: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-0000d6e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000d6f0: 2073 656c 662e 6372 6561 7465 5f6d 6173   self.create_mas
-0000d700: 6b28 290a 2020 2020 2020 2020 2020 2020  k().            
-0000d710: 2020 2020 6461 7461 203d 2073 656c 662e      data = self.
-0000d720: 6765 745f 6d61 736b 2873 7461 6e64 6172  get_mask(standar
-0000d730: 6469 7365 3d54 7275 6529 0a20 2020 2020  dise=True).     
-0000d740: 2020 2020 2020 2020 2020 2061 7865 7320             axes 
-0000d750: 3d20 736b 7274 2e69 6d61 6765 2e5f 6178  = skrt.image._ax
-0000d760: 6573 0a0a 2020 2020 2020 2020 2020 2020  es..            
-0000d770: 2320 436f 6d70 7574 6520 6365 6e74 726f  # Compute centro
-0000d780: 6964 2066 726f 6d20 3244 206f 7220 3344  id from 2D or 3D
-0000d790: 2062 696e 6172 7920 6d61 736b 0a20 2020   binary mask.   
-0000d7a0: 2020 2020 2020 2020 206e 6f6e 5f7a 6572           non_zer
-0000d7b0: 6f20 3d20 6e70 2e61 7267 7768 6572 6528  o = np.argwhere(
-0000d7c0: 6461 7461 290a 2020 2020 2020 2020 2020  data).          
-0000d7d0: 2020 6966 206e 6f74 206c 656e 286e 6f6e    if not len(non
-0000d7e0: 5f7a 6572 6f29 3a0a 2020 2020 2020 2020  _zero):.        
-0000d7f0: 2020 2020 2020 2020 6966 2064 6174 612e          if data.
-0000d800: 6e64 696d 203d 3d20 323a 0a20 2020 2020  ndim == 2:.     
-0000d810: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-0000d820: 6574 7572 6e20 4e6f 6e65 2c20 4e6f 6e65  eturn None, None
-0000d830: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000d840: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-0000d850: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-0000d860: 6e20 4e6f 6e65 2c20 4e6f 6e65 2c20 4e6f  n None, None, No
-0000d870: 6e65 0a20 2020 2020 2020 2020 2020 2063  ne.            c
-0000d880: 656e 7472 6f69 645f 726f 7763 6f6c 203d  entroid_rowcol =
-0000d890: 206c 6973 7428 6e6f 6e5f 7a65 726f 2e6d   list(non_zero.m
-0000d8a0: 6561 6e28 3029 290a 2020 2020 2020 2020  ean(0)).        
-0000d8b0: 2020 2020 6365 6e74 726f 6964 5f76 6f78      centroid_vox
-0000d8c0: 656c 7320 3d20 5b63 656e 7472 6f69 645f  els = [centroid_
-0000d8d0: 726f 7763 6f6c 5b31 5d2c 2063 656e 7472  rowcol[1], centr
-0000d8e0: 6f69 645f 726f 7763 6f6c 5b30 5d5d 205c  oid_rowcol[0]] \
-0000d8f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000d900: 2020 2020 202b 2063 656e 7472 6f69 645f       + centroid_
-0000d910: 726f 7763 6f6c 5b32 3a5d 0a20 2020 2020  rowcol[2:].     
-0000d920: 2020 2020 2020 2063 656e 7472 6f69 645b         centroid[
-0000d930: 2276 6f78 656c 7322 5d20 3d20 6e70 2e61  "voxels"] = np.a
-0000d940: 7272 6179 2863 656e 7472 6f69 645f 766f  rray(centroid_vo
-0000d950: 7865 6c73 290a 0a20 2020 2020 2020 2020  xels)..         
-0000d960: 2020 2023 2043 6f6e 7665 7274 2074 6f20     # Convert to 
-0000d970: 6d6d 2061 6e64 2073 6c69 6365 730a 2020  mm and slices.  
-0000d980: 2020 2020 2020 2020 2020 7669 6577 5f61            view_a
-0000d990: 7865 7320 3d20 285b 302c 2031 2c20 325d  xes = ([0, 1, 2]
-0000d9a0: 2069 6620 6c65 6e28 6365 6e74 726f 6964   if len(centroid
-0000d9b0: 5b27 766f 7865 6c73 275d 2920 3d3d 2033  ['voxels']) == 3
-0000d9c0: 2065 6c73 650a 2020 2020 2020 2020 2020   else.          
-0000d9d0: 2020 2020 2020 2020 2020 736b 7274 2e69            skrt.i
-0000d9e0: 6d61 6765 2e5f 706c 6f74 5f61 7865 735b  mage._plot_axes[
-0000d9f0: 7669 6577 5d29 0a0a 2020 2020 2020 2020  view])..        
-0000da00: 2020 2020 6365 6e74 726f 6964 5b22 6d6d      centroid["mm
-0000da10: 225d 203d 206e 702e 6172 7261 7928 5b0a  "] = np.array([.
-0000da20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000da30: 7365 6c66 2e69 6478 5f74 6f5f 706f 7328  self.idx_to_pos(
-0000da40: 632c 2061 783d 6929 0a20 2020 2020 2020  c, ax=i).       
-0000da50: 2020 2020 2020 2020 2066 6f72 2069 2c20           for i, 
-0000da60: 6320 696e 207a 6970 2876 6965 775f 6178  c in zip(view_ax
-0000da70: 6573 2c20 6365 6e74 726f 6964 5b22 766f  es, centroid["vo
-0000da80: 7865 6c73 225d 290a 2020 2020 2020 2020  xels"]).        
-0000da90: 2020 2020 5d29 0a0a 2020 2020 2020 2020      ])..        
-0000daa0: 2020 2020 6365 6e74 726f 6964 5b22 736c      centroid["sl
-0000dab0: 6963 6522 5d20 3d20 6e70 2e61 7272 6179  ice"] = np.array
-0000dac0: 285b 0a20 2020 2020 2020 2020 2020 2020  ([.             
-0000dad0: 2020 2073 656c 662e 6964 785f 746f 5f73     self.idx_to_s
-0000dae0: 6c69 6365 2863 2c20 6178 3d69 290a 2020  lice(c, ax=i).  
-0000daf0: 2020 2020 2020 2020 2020 2020 2020 666f                fo
-0000db00: 7220 692c 2063 2069 6e20 7a69 7028 7669  r i, c in zip(vi
-0000db10: 6577 5f61 7865 732c 2063 656e 7472 6f69  ew_axes, centroi
-0000db20: 645b 2276 6f78 656c 7322 5d29 0a20 2020  d["voxels"]).   
-0000db30: 2020 2020 2020 2020 205d 290a 0a20 2020           ])..   
-0000db40: 2020 2020 2023 2043 6163 6865 2067 6c6f       # Cache glo
-0000db50: 6261 6c20 6365 6e74 726f 6964 0a20 2020  bal centroid.   
-0000db60: 2020 2020 2069 6620 6e6f 7420 7369 6e67       if not sing
-0000db70: 6c65 5f73 6c69 6365 3a0a 2020 2020 2020  le_slice:.      
-0000db80: 2020 2020 2020 7365 6c66 2e5f 6365 6e74        self._cent
-0000db90: 726f 6964 203d 2063 656e 7472 6f69 640a  roid = centroid.
-0000dba0: 0a20 2020 2020 2020 2023 2052 6574 7572  .        # Retur
-0000dbb0: 6e20 6365 6e74 726f 6964 2069 6e20 7265  n centroid in re
-0000dbc0: 7175 6573 7465 6420 756e 6974 730a 2020  quested units.  
-0000dbd0: 2020 2020 2020 7265 7475 726e 2063 656e        return cen
-0000dbe0: 7472 6f69 645b 756e 6974 735d 0a0a 2020  troid[units]..  
-0000dbf0: 2020 6465 6620 7365 745f 736c 6963 655f    def set_slice_
-0000dc00: 7468 6963 6b6e 6573 735f 636f 6e74 6f75  thickness_contou
-0000dc10: 7273 2873 656c 662c 2064 7a29 3a0a 2020  rs(self, dz):.  
-0000dc20: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-0000dc30: 2020 5365 7420 6e6f 6d69 6e61 6c20 7a20    Set nominal z 
-0000dc40: 7370 6163 696e 6720 6f66 2063 6f6e 746f  spacing of conto
-0000dc50: 7572 732e 0a0a 2020 2020 2020 2020 5468  urs...        Th
-0000dc60: 6973 206d 6179 2062 6520 7573 6566 756c  is may be useful
-0000dc70: 2069 6e20 7061 7274 6963 756c 6172 2066   in particular f
-0000dc80: 6f72 2020 7369 6e67 6c65 2d73 6c69 6365  or  single-slice
-0000dc90: 2052 4f49 732e 0a20 2020 2020 2020 2022   ROIs..        "
-0000dca0: 2222 0a0a 2020 2020 2020 2020 7365 6c66  ""..        self
-0000dcb0: 2e73 6c69 6365 5f74 6869 636b 6e65 7373  .slice_thickness
-0000dcc0: 5f63 6f6e 746f 7572 7320 3d20 647a 0a0a  _contours = dz..
-0000dcd0: 2020 2020 6465 6620 6765 745f 736c 6963      def get_slic
-0000dce0: 655f 7468 6963 6b6e 6573 735f 636f 6e74  e_thickness_cont
-0000dcf0: 6f75 7273 2873 656c 6629 3a0a 2020 2020  ours(self):.    
-0000dd00: 2020 2020 2222 2247 6574 207a 2076 6f78      """Get z vox
-0000dd10: 656c 2073 697a 6520 7573 696e 6720 706f  el size using po
-0000dd20: 7369 7469 6f6e 7320 6f66 2063 6f6e 746f  sitions of conto
-0000dd30: 7572 732e 2222 220a 0a20 2020 2020 2020  urs."""..       
-0000dd40: 2063 6f6e 746f 7572 7320 3d20 7365 6c66   contours = self
-0000dd50: 2e67 6574 5f63 6f6e 746f 7572 7328 2278  .get_contours("x
-0000dd60: 2d79 2229 0a20 2020 2020 2020 207a 5f6b  -y").        z_k
-0000dd70: 6579 7320 3d20 736f 7274 6564 2863 6f6e  eys = sorted(con
-0000dd80: 746f 7572 732e 6b65 7973 2829 290a 2020  tours.keys()).  
-0000dd90: 2020 2020 2020 6966 206c 656e 287a 5f6b        if len(z_k
-0000dda0: 6579 7329 203c 2032 3a0a 2020 2020 2020  eys) < 2:.      
-0000ddb0: 2020 2020 2020 6966 2073 656c 662e 736f        if self.so
-0000ddc0: 7572 6365 5f74 7970 6520 3d3d 2022 636f  urce_type == "co
-0000ddd0: 6e74 6f75 7222 2061 6e64 2073 656c 662e  ntour" and self.
-0000dde0: 736c 6963 655f 7468 6963 6b6e 6573 735f  slice_thickness_
-0000ddf0: 636f 6e74 6f75 7273 3a0a 2020 2020 2020  contours:.      
-0000de00: 2020 2020 2020 2020 2020 7265 7475 726e            return
-0000de10: 2073 656c 662e 736c 6963 655f 7468 6963   self.slice_thic
-0000de20: 6b6e 6573 735f 636f 6e74 6f75 7273 0a20  kness_contours. 
-0000de30: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-0000de40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000de50: 2076 6f78 656c 5f73 697a 6520 3d20 7365   voxel_size = se
-0000de60: 6c66 2e67 6574 5f76 6f78 656c 5f73 697a  lf.get_voxel_siz
-0000de70: 6528 290a 2020 2020 2020 2020 2020 2020  e().            
-0000de80: 2020 2020 6966 2076 6f78 656c 5f73 697a      if voxel_siz
-0000de90: 6520 6973 206e 6f74 204e 6f6e 653a 0a20  e is not None:. 
-0000dea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000deb0: 2020 2072 6574 7572 6e20 766f 7865 6c5f     return voxel_
-0000dec0: 7369 7a65 5b32 5d0a 2020 2020 2020 2020  size[2].        
-0000ded0: 2020 2020 2020 2020 7265 7475 726e 0a20          return. 
-0000dee0: 2020 2020 2020 2064 6966 6673 203d 205b         diffs = [
-0000def0: 7a5f 6b65 7973 5b69 5d20 2d20 7a5f 6b65  z_keys[i] - z_ke
-0000df00: 7973 5b69 202d 2031 5d20 666f 7220 6920  ys[i - 1] for i 
-0000df10: 696e 2072 616e 6765 2831 2c20 6c65 6e28  in range(1, len(
-0000df20: 7a5f 6b65 7973 2929 5d0a 2020 2020 2020  z_keys))].      
-0000df30: 2020 7265 7475 726e 206d 696e 2864 6966    return min(dif
-0000df40: 6673 290a 0a20 2020 2064 6566 2067 6574  fs)..    def get
-0000df50: 5f6e 7a5f 636f 6e74 6f75 7273 2873 656c  _nz_contours(sel
-0000df60: 6629 3a0a 2020 2020 2020 2020 2222 2247  f):.        """G
-0000df70: 6574 206e 756d 6265 7220 6f66 2076 6f78  et number of vox
-0000df80: 656c 7320 696e 2074 6865 207a 2064 6972  els in the z dir
-0000df90: 6563 7469 6f6e 2075 7369 6e67 2070 6f73  ection using pos
-0000dfa0: 6974 696f 6e73 206f 6620 636f 6e74 6f75  itions of contou
-0000dfb0: 7273 2e22 2222 0a0a 2020 2020 2020 2020  rs."""..        
-0000dfc0: 767a 203d 2073 656c 662e 6765 745f 736c  vz = self.get_sl
-0000dfd0: 6963 655f 7468 6963 6b6e 6573 735f 636f  ice_thickness_co
-0000dfe0: 6e74 6f75 7273 2829 0a20 2020 2020 2020  ntours().       
-0000dff0: 207a 5f6b 6579 7320 3d20 6c69 7374 2873   z_keys = list(s
-0000e000: 656c 662e 6765 745f 636f 6e74 6f75 7273  elf.get_contours
-0000e010: 2822 782d 7922 292e 6b65 7973 2829 290a  ("x-y").keys()).
-0000e020: 2020 2020 2020 2020 7265 7475 726e 2069          return i
-0000e030: 6e74 2828 6d61 7828 7a5f 6b65 7973 2920  nt((max(z_keys) 
-0000e040: 2d20 6d69 6e28 7a5f 6b65 7973 2929 202f  - min(z_keys)) /
-0000e050: 2076 7a29 202b 2031 0a0a 2020 2020 6465   vz) + 1..    de
-0000e060: 6620 6765 745f 6365 6e74 7265 280a 2020  f get_centre(.  
-0000e070: 2020 2020 2020 7365 6c66 2c20 0a20 2020        self, .   
-0000e080: 2020 2020 2076 6965 773d 2278 2d79 222c       view="x-y",
-0000e090: 200a 2020 2020 2020 2020 7369 6e67 6c65   .        single
-0000e0a0: 5f73 6c69 6365 3d46 616c 7365 2c0a 2020  _slice=False,.  
-0000e0b0: 2020 2020 2020 736c 3d4e 6f6e 652c 200a        sl=None, .
-0000e0c0: 2020 2020 2020 2020 6964 783d 4e6f 6e65          idx=None
-0000e0d0: 2c20 0a20 2020 2020 2020 2070 6f73 3d4e  , .        pos=N
-0000e0e0: 6f6e 652c 200a 2020 2020 2020 2020 6d65  one, .        me
-0000e0f0: 7468 6f64 3d4e 6f6e 652c 0a20 2020 2029  thod=None,.    )
-0000e100: 3a0a 2020 2020 2020 2020 2222 2247 6574  :.        """Get
-0000e110: 2063 656e 7472 6520 706f 7369 7469 6f6e   centre position
-0000e120: 2069 6e20 3244 206f 7220 3344 2069 6e20   in 2D or 3D in 
-0000e130: 6d6d 2e22 2222 0a0a 2020 2020 2020 2020  mm."""..        
-0000e140: 2320 4765 7420 6465 6661 756c 7420 736c  # Get default sl
-0000e150: 6963 6520 696e 6465 7820 616e 6420 6d65  ice index and me
-0000e160: 7468 6f64 0a20 2020 2020 2020 2073 656c  thod.        sel
-0000e170: 662e 6c6f 6164 2829 0a20 2020 2020 2020  f.load().       
-0000e180: 2069 6620 736c 2069 7320 4e6f 6e65 2061   if sl is None a
-0000e190: 6e64 2069 6478 2069 7320 4e6f 6e65 2061  nd idx is None a
-0000e1a0: 6e64 2070 6f73 2069 7320 4e6f 6e65 3a20  nd pos is None: 
-0000e1b0: 0a20 2020 2020 2020 2020 2020 2069 6478  .            idx
-0000e1c0: 203d 2073 656c 662e 6765 745f 6d69 645f   = self.get_mid_
-0000e1d0: 6964 7828 7669 6577 290a 2020 2020 2020  idx(view).      
-0000e1e0: 2020 6966 206d 6574 686f 6420 6973 204e    if method is N
-0000e1f0: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-0000e200: 206d 6574 686f 6420 3d20 7365 6c66 2e64   method = self.d
-0000e210: 6566 6175 6c74 5f67 656f 6d5f 6d65 7468  efault_geom_meth
-0000e220: 6f64 0a0a 2020 2020 2020 2020 2320 4765  od..        # Ge
-0000e230: 7420 6c69 7374 206f 6620 6178 6573 2074  t list of axes t
-0000e240: 6f20 636f 6e73 6964 6572 0a20 2020 2020  o consider.     
-0000e250: 2020 2069 6620 7369 6e67 6c65 5f73 6c69     if single_sli
-0000e260: 6365 3a0a 2020 2020 2020 2020 2020 2020  ce:.            
-0000e270: 6178 6573 203d 2073 6b72 742e 696d 6167  axes = skrt.imag
-0000e280: 652e 5f70 6c6f 745f 6178 6573 5b76 6965  e._plot_axes[vie
-0000e290: 775d 0a20 2020 2020 2020 2065 6c73 653a  w].        else:
-0000e2a0: 0a20 2020 2020 2020 2020 2020 2061 7865  .            axe
-0000e2b0: 7320 3d20 736b 7274 2e69 6d61 6765 2e5f  s = skrt.image._
-0000e2c0: 6178 6573 0a0a 2020 2020 2020 2020 2320  axes..        # 
-0000e2d0: 4765 7420 6365 6e74 7265 2069 6e20 6d6d  Get centre in mm
-0000e2e0: 0a20 2020 2020 2020 2063 656e 7472 6520  .        centre 
-0000e2f0: 3d20 5b5d 0a20 2020 2020 2020 2066 6f72  = [].        for
-0000e300: 2061 7820 696e 2061 7865 733a 0a20 2020   ax in axes:.   
-0000e310: 2020 2020 2020 2020 2065 7874 656e 7420           extent 
-0000e320: 3d20 7365 6c66 2e67 6574 5f65 7874 656e  = self.get_exten
-0000e330: 7428 0a20 2020 2020 2020 2020 2020 2020  t(.             
-0000e340: 2020 2061 783d 6178 2c0a 2020 2020 2020     ax=ax,.      
-0000e350: 2020 2020 2020 2020 2020 7369 6e67 6c65            single
-0000e360: 5f73 6c69 6365 3d73 696e 676c 655f 736c  _slice=single_sl
-0000e370: 6963 652c 0a20 2020 2020 2020 2020 2020  ice,.           
-0000e380: 2020 2020 2076 6965 773d 7669 6577 2c0a       view=view,.
-0000e390: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e3a0: 736c 3d73 6c2c 0a20 2020 2020 2020 2020  sl=sl,.         
-0000e3b0: 2020 2020 2020 2069 6478 3d69 6478 2c0a         idx=idx,.
-0000e3c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e3d0: 706f 733d 706f 732c 0a20 2020 2020 2020  pos=pos,.       
-0000e3e0: 2020 2020 2020 2020 206d 6574 686f 643d           method=
-0000e3f0: 6d65 7468 6f64 2c0a 2020 2020 2020 2020  method,.        
-0000e400: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
-0000e410: 2020 6966 204e 6f6e 6520 696e 2065 7874    if None in ext
-0000e420: 656e 743a 0a20 2020 2020 2020 2020 2020  ent:.           
-0000e430: 2020 2020 2063 656e 7472 652e 6170 7065       centre.appe
-0000e440: 6e64 284e 6f6e 6529 0a20 2020 2020 2020  nd(None).       
-0000e450: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-0000e460: 2020 2020 2020 2020 2020 2063 656e 7472             centr
-0000e470: 652e 6170 7065 6e64 286e 702e 6d65 616e  e.append(np.mean
-0000e480: 2865 7874 656e 7429 290a 0a20 2020 2020  (extent))..     
-0000e490: 2020 2072 6574 7572 6e20 6e70 2e61 7272     return np.arr
-0000e4a0: 6179 2863 656e 7472 6529 0a0a 2020 2020  ay(centre)..    
-0000e4b0: 6465 6620 6765 745f 766f 6c75 6d65 280a  def get_volume(.
-0000e4c0: 2020 2020 2020 2020 7365 6c66 2c20 0a20          self, . 
-0000e4d0: 2020 2020 2020 2075 6e69 7473 3d22 6d6d         units="mm
-0000e4e0: 222c 200a 2020 2020 2020 2020 6d65 7468  ", .        meth
-0000e4f0: 6f64 3d4e 6f6e 652c 200a 2020 2020 2020  od=None, .      
-0000e500: 2020 666f 7263 653d 5472 7565 0a20 2020    force=True.   
-0000e510: 2029 3a0a 2020 2020 2020 2020 2222 2247   ):.        """G
-0000e520: 6574 2052 4f49 2076 6f6c 756d 652e 2054  et ROI volume. T
-0000e530: 6865 2063 616c 6375 6c61 7465 6420 766f  he calculated vo
-0000e540: 6c75 6d65 2077 696c 6c20 6265 2063 6163  lume will be cac
-0000e550: 6865 6420 696e 200a 2020 2020 2020 2020  hed in .        
-0000e560: 7365 6c66 2e5f 766f 6c75 6d65 5b75 6e69  self._volume[uni
-0000e570: 7473 5d20 616e 6420 7265 7475 726e 6564  ts] and returned
-0000e580: 2069 6620 6361 6c6c 6564 2061 6761 696e   if called again
-0000e590: 2c20 756e 6c65 7373 2066 6f72 6365 3d54  , unless force=T
-0000e5a0: 7275 652e 0a0a 2020 2020 2020 2020 2a2a  rue...        **
-0000e5b0: 5061 7261 6d65 7465 7273 3a2a 2a0a 2020  Parameters:**.  
-0000e5c0: 2020 2020 2020 0a20 2020 2020 2020 2075        .        u
-0000e5d0: 6e69 7473 203a 2073 7472 2c20 6465 6661  nits : str, defa
-0000e5e0: 756c 743d 226d 6d22 0a20 2020 2020 2020  ult="mm".       
-0000e5f0: 2020 2020 2055 6e69 7473 206f 6620 766f       Units of vo
-0000e600: 6c75 6d65 2e20 4361 6e20 6265 2061 6e79  lume. Can be any
-0000e610: 206f 663a 0a20 2020 2020 2020 2020 2020   of:.           
-0000e620: 2020 2020 202d 2022 6d6d 223a 2072 6574       - "mm": ret
-0000e630: 7572 6e20 766f 6c75 6d65 2069 6e20 6d69  urn volume in mi
-0000e640: 6c6c 696d 6574 7265 7320 6375 6265 642e  llimetres cubed.
-0000e650: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000e660: 202d 2022 6d6c 223a 2072 6574 7572 6e20   - "ml": return 
-0000e670: 766f 6c75 6d65 2069 6e20 6d69 6c6c 696c  volume in millil
-0000e680: 6974 7265 732e 0a20 2020 2020 2020 2020  itres..         
-0000e690: 2020 2020 2020 202d 2022 6363 223a 2072         - "cc": r
-0000e6a0: 6574 7572 6e20 766f 6c75 6d65 2069 6e20  eturn volume in 
-0000e6b0: 6375 6269 6320 6365 6e74 696d 6574 7265  cubic centimetre
-0000e6c0: 7320 2865 7175 6976 616c 656e 7420 746f  s (equivalent to
-0000e6d0: 2022 6d6c 2229 0a20 2020 2020 2020 2020   "ml").         
-0000e6e0: 2020 2020 2020 202d 2022 766f 7865 6c73         - "voxels
-0000e6f0: 223a 2072 6574 7572 6e20 766f 6c75 6d65  ": return volume
-0000e700: 2069 6e20 6e75 6d62 6572 206f 6620 766f   in number of vo
-0000e710: 7865 6c73 2e0a 0a20 2020 2020 2020 2020  xels...         
-0000e720: 2020 2049 6620 756e 6974 733d 2276 6f78     If units="vox
-0000e730: 656c 7322 2069 7320 7265 7175 6573 7465  els" is requeste
-0000e740: 6420 6275 7420 7468 6973 2052 4f49 206f  d but this ROI o
-0000e750: 6e6c 7920 6861 7320 636f 6e74 6f75 7273  nly has contours
-0000e760: 2061 6e64 206e 6f0a 2020 2020 2020 2020   and no.        
-0000e770: 2020 2020 766f 7865 6c20 7369 7a65 2069      voxel size i
-0000e780: 6e66 6f72 6d61 7469 6f6e 2c20 616e 2065  nformation, an e
-0000e790: 7272 6f72 2077 696c 6c20 6265 2072 6169  rror will be rai
-0000e7a0: 7365 642e 0a0a 2020 2020 2020 2020 6d65  sed...        me
-0000e7b0: 7468 6f64 203a 2073 7472 2c20 6465 6661  thod : str, defa
-0000e7c0: 756c 743d 4e6f 6e65 0a20 2020 2020 2020  ult=None.       
-0000e7d0: 2020 2020 204d 6574 686f 6420 746f 2075       Method to u
-0000e7e0: 7365 2066 6f72 2076 6f6c 756d 6520 6361  se for volume ca
-0000e7f0: 6c63 756c 6174 696f 6e2e 2043 616e 2062  lculation. Can b
-0000e800: 653a 200a 2020 2020 2020 2020 2020 2020  e: .            
-0000e810: 2020 2020 2d20 2263 6f6e 746f 7572 223a      - "contour":
-0000e820: 2063 6f6d 7075 7465 2076 6f6c 756d 6520   compute volume 
-0000e830: 6279 2073 756d 6d69 6e67 2061 7265 6173  by summing areas
-0000e840: 206f 6620 7368 6170 656c 790a 2020 2020   of shapely.    
-0000e850: 2020 2020 2020 2020 2020 2020 2020 706f                po
-0000e860: 6c79 676f 6e73 206f 6e20 6561 6368 2073  lygons on each s
-0000e870: 6c69 6365 2061 6e64 206d 756c 7469 706c  lice and multipl
-0000e880: 7969 6e67 2062 7920 736c 6963 6520 7468  ying by slice th
-0000e890: 6963 6b6e 6573 732e 0a20 2020 2020 2020  ickness..       
-0000e8a0: 2020 2020 2020 2020 202d 2022 6d61 736b           - "mask
-0000e8b0: 223a 2063 6f6d 7075 7465 2076 6f6c 756d  ": compute volum
-0000e8c0: 6520 6279 2073 756d 6d69 6e67 2076 6f78  e by summing vox
-0000e8d0: 656c 7320 696e 7369 6465 2074 6865 2052  els inside the R
-0000e8e0: 4f49 2061 6e64 0a20 2020 2020 2020 2020  OI and.         
-0000e8f0: 2020 2020 2020 2020 206d 756c 7469 706c           multipl
-0000e900: 7969 6e67 2062 7920 7468 6520 766f 6c75  ying by the volu
-0000e910: 6d65 206f 6620 6f6e 6520 766f 7865 6c2e  me of one voxel.
-0000e920: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000e930: 202d 204e 6f6e 653a 2075 7365 2074 6865   - None: use the
-0000e940: 206d 6574 686f 6420 7365 7420 696e 2073   method set in s
-0000e950: 656c 662e 6465 6661 756c 745f 6765 6f6d  elf.default_geom
-0000e960: 5f6d 6574 686f 642e 0a0a 2020 2020 2020  _method...      
-0000e970: 2020 2020 2020 4e6f 7465 2074 6861 7420        Note that 
-0000e980: 6966 2073 656c 662e 6765 745f 766f 6c75  if self.get_volu
-0000e990: 6d65 2068 6173 2061 6c72 6561 6479 2062  me has already b
-0000e9a0: 6565 6e20 6361 6c6c 6564 2077 6974 6820  een called with 
-0000e9b0: 6f6e 6520 0a20 2020 2020 2020 2020 2020  one .           
-0000e9c0: 206d 6574 686f 642c 2074 6865 2073 616d   method, the sam
-0000e9d0: 6520 6361 6368 6564 2072 6573 756c 7420  e cached result 
-0000e9e0: 7769 6c6c 2062 6520 7265 7475 726e 6564  will be returned
-0000e9f0: 2069 6620 6361 6c6c 696e 6720 7769 7468   if calling with
-0000ea00: 2061 200a 2020 2020 2020 2020 2020 2020   a .            
-0000ea10: 6469 6666 6572 656e 7420 6d65 7468 6f64  different method
-0000ea20: 2075 6e6c 6573 7320 666f 7263 653d 5472   unless force=Tr
-0000ea30: 7565 2e0a 0a20 2020 2020 2020 2066 6f72  ue...        for
-0000ea40: 6365 203a 2062 6f6f 6c2c 2064 6566 6175  ce : bool, defau
-0000ea50: 6c74 3d54 7275 650a 2020 2020 2020 2020  lt=True.        
-0000ea60: 2020 2020 4966 2054 7275 652c 2074 6865      If True, the
-0000ea70: 2076 6f6c 756d 6520 7769 6c6c 2061 6c77   volume will alw
-0000ea80: 6179 7320 6265 2072 6563 616c 6375 6c61  ays be recalcula
-0000ea90: 7465 643b 206f 7468 6572 7769 7365 2c20  ted; otherwise, 
-0000eaa0: 6974 2077 696c 6c0a 2020 2020 2020 2020  it will.        
-0000eab0: 2020 2020 6f6e 6c79 2062 6520 6361 6c63      only be calc
-0000eac0: 756c 6174 6564 2069 6620 6974 2068 6173  ulated if it has
-0000ead0: 206e 6f74 2079 6574 2062 6565 6e20 6361   not yet been ca
-0000eae0: 6368 6564 2069 6e20 7365 6c66 2e5f 766f  ched in self._vo
-0000eaf0: 6c75 6d65 2e0a 2020 2020 2020 2020 2222  lume..        ""
-0000eb00: 220a 0a20 2020 2020 2020 2023 2049 6620  "..        # If 
-0000eb10: 616c 7265 6164 7920 6361 6368 6564 2061  already cached a
-0000eb20: 6e64 206e 6f74 2066 6f72 6369 6e67 2c20  nd not forcing, 
-0000eb30: 7265 7475 726e 0a20 2020 2020 2020 2069  return.        i
-0000eb40: 6620 6861 7361 7474 7228 7365 6c66 2c20  f hasattr(self, 
-0000eb50: 225f 766f 6c75 6d65 2229 2061 6e64 206e  "_volume") and n
-0000eb60: 6f74 2066 6f72 6365 3a0a 2020 2020 2020  ot force:.      
-0000eb70: 2020 2020 2020 6966 2075 6e69 7473 2069        if units i
-0000eb80: 6e20 7365 6c66 2e5f 766f 6c75 6d65 3a0a  n self._volume:.
-0000eb90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000eba0: 7265 7475 726e 2073 656c 662e 5f76 6f6c  return self._vol
-0000ebb0: 756d 655b 756e 6974 735d 0a0a 2020 2020  ume[units]..    
-0000ebc0: 2020 2020 7365 6c66 2e6c 6f61 6428 290a      self.load().
-0000ebd0: 2020 2020 2020 2020 6966 206d 6574 686f          if metho
-0000ebe0: 6420 6973 204e 6f6e 653a 0a20 2020 2020  d is None:.     
-0000ebf0: 2020 2020 2020 206d 6574 686f 6420 3d20         method = 
-0000ec00: 7365 6c66 2e64 6566 6175 6c74 5f67 656f  self.default_geo
-0000ec10: 6d5f 6d65 7468 6f64 0a0a 2020 2020 2020  m_method..      
-0000ec20: 2020 2320 4d61 6b65 2063 6163 6865 6420    # Make cached 
-0000ec30: 7072 6f70 6572 7479 0a20 2020 2020 2020  property.       
-0000ec40: 2073 656c 662e 5f76 6f6c 756d 6520 3d20   self._volume = 
-0000ec50: 7b7d 0a0a 2020 2020 2020 2020 2320 4361  {}..        # Ca
-0000ec60: 6c63 756c 6174 6520 6672 6f6d 2070 6f6c  lculate from pol
-0000ec70: 7967 6f6e 2061 7265 6173 0a20 2020 2020  ygon areas.     
-0000ec80: 2020 2069 6620 6d65 7468 6f64 203d 3d20     if method == 
-0000ec90: 2263 6f6e 746f 7572 223a 0a0a 2020 2020  "contour":..    
-0000eca0: 2020 2020 2020 2020 2320 4368 6563 6b20          # Check 
-0000ecb0: 6974 2773 2070 6f73 7369 626c 6520 746f  it's possible to
-0000ecc0: 2063 616c 6375 6c61 7465 2076 6f6c 756d   calculate volum
-0000ecd0: 6520 7769 7468 2074 6865 2072 6571 7565  e with the reque
-0000ece0: 7374 6564 2075 6e69 7473 0a20 2020 2020  sted units.     
-0000ecf0: 2020 2020 2020 2069 6620 7365 6c66 2e76         if self.v
-0000ed00: 6f78 656c 5f73 697a 6520 6973 204e 6f6e  oxel_size is Non
-0000ed10: 6520 616e 6420 756e 6974 7320 3d3d 2022  e and units == "
-0000ed20: 766f 7865 6c73 223a 0a20 2020 2020 2020  voxels":.       
-0000ed30: 2020 2020 2020 2020 2072 6169 7365 2052           raise R
-0000ed40: 756e 7469 6d65 4572 726f 7228 2243 616e  untimeError("Can
-0000ed50: 6e6f 7420 636f 6d70 7574 6520 766f 6c75  not compute volu
-0000ed60: 6d65 2069 6e20 766f 7865 6c73 2066 726f  me in voxels fro
-0000ed70: 6d20 220a 2020 2020 2020 2020 2020 2020  m ".            
-0000ed80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ed90: 2020 2020 2020 2022 636f 6e74 6f75 7273         "contours
-0000eda0: 2077 6974 686f 7574 206b 6e6f 7769 6e67   without knowing
-0000edb0: 2076 6f78 656c 2073 697a 6573 2122 290a   voxel sizes!").
-0000edc0: 0a20 2020 2020 2020 2020 2020 2023 2043  .            # C
-0000edd0: 616c 6375 6c61 7465 2061 7265 6120 6f6e  alculate area on
-0000ede0: 2065 6163 6820 736c 6963 650a 2020 2020   each slice.    
-0000edf0: 2020 2020 2020 2020 736c 6963 655f 6172          slice_ar
-0000ee00: 6561 7320 3d20 5b5d 0a20 2020 2020 2020  eas = [].       
-0000ee10: 2020 2020 2066 6f72 2069 6478 2069 6e20       for idx in 
-0000ee20: 7365 6c66 2e67 6574 5f63 6f6e 746f 7572  self.get_contour
-0000ee30: 7328 2278 2d79 222c 2069 6478 5f61 735f  s("x-y", idx_as_
-0000ee40: 6b65 793d 5472 7565 293a 0a20 2020 2020  key=True):.     
-0000ee50: 2020 2020 2020 2020 2020 2073 6c69 6365             slice
-0000ee60: 5f61 7265 6173 2e61 7070 656e 6428 7365  _areas.append(se
-0000ee70: 6c66 2e67 6574 5f61 7265 6128 2278 2d79  lf.get_area("x-y
-0000ee80: 222c 2069 6478 3d69 6478 2c20 6d65 7468  ", idx=idx, meth
-0000ee90: 6f64 3d6d 6574 686f 6429 290a 0a20 2020  od=method))..   
-0000eea0: 2020 2020 2020 2020 2023 2043 6f6e 7665           # Conve
-0000eeb0: 7274 2074 6f20 766f 6c75 6d65 2069 6e20  rt to volume in 
-0000eec0: 6d6d 0a20 2020 2020 2020 2020 2020 2061  mm.            a
-0000eed0: 7265 615f 7375 6d20 3d20 7375 6d28 736c  rea_sum = sum(sl
-0000eee0: 6963 655f 6172 6561 7329 0a20 2020 2020  ice_areas).     
-0000eef0: 2020 2020 2020 2073 656c 662e 5f76 6f6c         self._vol
-0000ef00: 756d 655b 226d 6d22 5d20 3d20 6172 6561  ume["mm"] = area
-0000ef10: 5f73 756d 202a 2073 656c 662e 6765 745f  _sum * self.get_
-0000ef20: 736c 6963 655f 7468 6963 6b6e 6573 735f  slice_thickness_
-0000ef30: 636f 6e74 6f75 7273 2829 0a0a 2020 2020  contours()..    
-0000ef40: 2020 2020 2020 2020 2320 4966 2070 6f73          # If pos
-0000ef50: 7369 626c 652c 2063 6f6e 7665 7274 2074  sible, convert t
-0000ef60: 6f20 766f 6c75 6d65 2069 6e20 766f 7865  o volume in voxe
-0000ef70: 6c73 0a20 2020 2020 2020 2020 2020 2069  ls.            i
-0000ef80: 6620 7365 6c66 2e76 6f78 656c 5f73 697a  f self.voxel_siz
-0000ef90: 6520 6973 206e 6f74 204e 6f6e 653a 0a20  e is not None:. 
-0000efa0: 2020 2020 2020 2020 2020 2020 2020 2078                 x
-0000efb0: 795f 766f 7865 6c5f 6172 6561 203d 2073  y_voxel_area = s
-0000efc0: 656c 662e 766f 7865 6c5f 7369 7a65 5b30  elf.voxel_size[0
-0000efd0: 5d20 2a20 7365 6c66 2e76 6f78 656c 5f73  ] * self.voxel_s
-0000efe0: 697a 655b 315d 0a20 2020 2020 2020 2020  ize[1].         
-0000eff0: 2020 2020 2020 2073 656c 662e 5f76 6f6c         self._vol
-0000f000: 756d 655b 2276 6f78 656c 7322 5d20 3d20  ume["voxels"] = 
-0000f010: 6172 6561 5f73 756d 202f 2078 795f 766f  area_sum / xy_vo
-0000f020: 7865 6c5f 6172 6561 0a0a 2020 2020 2020  xel_area..      
-0000f030: 2020 2320 4f74 6865 7277 6973 652c 2063    # Otherwise, c
-0000f040: 616c 6375 6c61 7465 2066 726f 6d20 6e75  alculate from nu
-0000f050: 6d62 6572 206f 6620 766f 7865 6c73 2069  mber of voxels i
-0000f060: 6e20 6d61 736b 0a20 2020 2020 2020 2065  n mask.        e
-0000f070: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-0000f080: 2073 656c 662e 6372 6561 7465 5f6d 6173   self.create_mas
-0000f090: 6b28 290a 2020 2020 2020 2020 2020 2020  k().            
-0000f0a0: 7365 6c66 2e5f 766f 6c75 6d65 5b22 766f  self._volume["vo
-0000f0b0: 7865 6c73 225d 203d 2073 656c 662e 6d61  xels"] = self.ma
-0000f0c0: 736b 2e64 6174 612e 6173 7479 7065 2862  sk.data.astype(b
-0000f0d0: 6f6f 6c29 2e73 756d 2829 0a20 2020 2020  ool).sum().     
-0000f0e0: 2020 2020 2020 2076 6f78 656c 5f76 6f6c         voxel_vol
-0000f0f0: 203d 2061 6273 286e 702e 7072 6f64 2873   = abs(np.prod(s
-0000f100: 656c 662e 6765 745f 766f 7865 6c5f 7369  elf.get_voxel_si
-0000f110: 7a65 2829 2929 0a20 2020 2020 2020 2020  ze())).         
-0000f120: 2020 2073 656c 662e 5f76 6f6c 756d 655b     self._volume[
-0000f130: 226d 6d22 5d20 3d20 7365 6c66 2e5f 766f  "mm"] = self._vo
-0000f140: 6c75 6d65 5b22 766f 7865 6c73 225d 202a  lume["voxels"] *
-0000f150: 2076 6f78 656c 5f76 6f6c 0a0a 2020 2020   voxel_vol..    
-0000f160: 2020 2020 2320 4765 7420 766f 6c75 6d65      # Get volume
-0000f170: 2069 6e20 6d6c 206f 7220 6571 7569 7661   in ml or equiva
-0000f180: 6c65 6e74 6c79 2063 630a 2020 2020 2020  lently cc.      
-0000f190: 2020 7365 6c66 2e5f 766f 6c75 6d65 5b22    self._volume["
-0000f1a0: 6d6c 225d 203d 2073 656c 662e 5f76 6f6c  ml"] = self._vol
-0000f1b0: 756d 655b 226d 6d22 5d20 2f20 3130 3030  ume["mm"] / 1000
-0000f1c0: 0a20 2020 2020 2020 2073 656c 662e 5f76  .        self._v
-0000f1d0: 6f6c 756d 655b 2263 6322 5d20 3d20 7365  olume["cc"] = se
-0000f1e0: 6c66 2e5f 766f 6c75 6d65 5b22 6d6c 225d  lf._volume["ml"]
-0000f1f0: 0a0a 2020 2020 2020 2020 2320 5265 7475  ..        # Retu
-0000f200: 726e 2076 6f6c 756d 6520 696e 2074 6865  rn volume in the
-0000f210: 2072 6571 7565 7374 6564 2075 6e69 7473   requested units
-0000f220: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-0000f230: 7365 6c66 2e5f 766f 6c75 6d65 5b75 6e69  self._volume[uni
-0000f240: 7473 5d0a 0a20 2020 2064 6566 2067 6574  ts]..    def get
-0000f250: 5f6d 6173 6b5f 746f 5f63 6f6e 746f 7572  _mask_to_contour
-0000f260: 5f76 6f6c 756d 655f 7261 7469 6f28 7365  _volume_ratio(se
-0000f270: 6c66 293a 0a20 2020 2020 2020 2022 2222  lf):.        """
-0000f280: 0a20 2020 2020 2020 2047 6574 2072 6174  .        Get rat
-0000f290: 696f 2074 6f20 524f 4920 226d 6173 6b22  io to ROI "mask"
-0000f2a0: 2076 6f6c 756d 6520 746f 2052 4f49 2022   volume to ROI "
-0000f2b0: 636f 6e74 6f75 7222 2076 6f6c 756d 652e  contour" volume.
-0000f2c0: 0a0a 2020 2020 2020 2020 496e 2070 7269  ..        In pri
-0000f2d0: 6e63 6970 6c65 2c20 766f 6c75 6d65 2065  nciple, volume e
-0000f2e0: 7374 696d 6174 6573 2066 726f 6d20 226d  stimates from "m
-0000f2f0: 6173 6b22 2061 6e64 2022 636f 6e74 6f75  ask" and "contou
-0000f300: 7222 206d 6574 686f 6473 0a20 2020 2020  r" methods.     
-0000f310: 2020 2073 686f 756c 6420 6265 2073 696d     should be sim
-0000f320: 696c 6172 2e20 2054 6865 2074 776f 2065  ilar.  The two e
-0000f330: 7374 696d 6174 6573 206d 6179 2062 6520  stimates may be 
-0000f340: 6469 6666 6572 656e 7420 6966 2c20 666f  different if, fo
-0000f350: 720a 2020 2020 2020 2020 6578 616d 706c  r.        exampl
-0000f360: 652c 2074 6865 2069 6d61 6765 2066 726f  e, the image fro
-0000f370: 6d20 7768 6963 6820 6120 6d61 736b 2069  m which a mask i
-0000f380: 7320 6372 6561 7465 6420 646f 6573 6e27  s created doesn'
-0000f390: 7420 6675 6c6c 7920 636f 7665 720a 2020  t fully cover.  
-0000f3a0: 2020 2020 2020 7468 6520 636f 6e74 6f75        the contou
-0000f3b0: 7220 6578 7465 6e74 732e 0a20 2020 2020  r extents..     
-0000f3c0: 2020 2022 2222 0a20 2020 2020 2020 2072     """.        r
-0000f3d0: 6574 7572 6e20 2873 656c 662e 6765 745f  eturn (self.get_
-0000f3e0: 766f 6c75 6d65 286d 6574 686f 643d 226d  volume(method="m
-0000f3f0: 6173 6b22 2c20 666f 7263 653d 5472 7565  ask", force=True
-0000f400: 2920 2f0a 2020 2020 2020 2020 2020 2020  ) /.            
-0000f410: 2020 2020 7365 6c66 2e67 6574 5f76 6f6c      self.get_vol
-0000f420: 756d 6528 6d65 7468 6f64 3d22 636f 6e74  ume(method="cont
-0000f430: 6f75 7222 2c20 666f 7263 653d 5472 7565  our", force=True
-0000f440: 2929 0a0a 2020 2020 6465 6620 6765 745f  ))..    def get_
-0000f450: 6172 6561 280a 2020 2020 2020 2020 7365  area(.        se
-0000f460: 6c66 2c20 0a20 2020 2020 2020 2076 6965  lf, .        vie
-0000f470: 773d 2278 2d79 222c 200a 2020 2020 2020  w="x-y", .      
-0000f480: 2020 736c 3d4e 6f6e 652c 200a 2020 2020    sl=None, .    
-0000f490: 2020 2020 6964 783d 4e6f 6e65 2c20 0a20      idx=None, . 
-0000f4a0: 2020 2020 2020 2070 6f73 3d4e 6f6e 652c         pos=None,
-0000f4b0: 200a 2020 2020 2020 2020 756e 6974 733d   .        units=
-0000f4c0: 226d 6d22 2c20 0a20 2020 2020 2020 206d  "mm", .        m
-0000f4d0: 6574 686f 643d 4e6f 6e65 2c0a 2020 2020  ethod=None,.    
-0000f4e0: 2020 2020 666c 6174 7465 6e3d 4661 6c73      flatten=Fals
-0000f4f0: 652c 0a20 2020 2029 3a0a 2020 2020 2020  e,.    ):.      
-0000f500: 2020 2222 2247 6574 2074 6865 2061 7265    """Get the are
-0000f510: 6120 6f66 2074 6865 2052 4f49 206f 6e20  a of the ROI on 
-0000f520: 6120 6769 7665 6e20 736c 6963 652e 0a0a  a given slice...
-0000f530: 2020 2020 2020 2020 2a2a 5061 7261 6d65          **Parame
-0000f540: 7465 7273 3a2a 2a0a 2020 2020 2020 2020  ters:**.        
-0000f550: 0a20 2020 2020 2020 2076 6965 7720 3a20  .        view : 
-0000f560: 7374 722c 2064 6566 6175 6c74 3d22 782d  str, default="x-
-0000f570: 7922 0a20 2020 2020 2020 2020 2020 204f  y".            O
-0000f580: 7269 656e 7461 7469 6f6e 206f 6620 736c  rientation of sl
-0000f590: 6963 6520 666f 7220 7768 6963 6820 746f  ice for which to
-0000f5a0: 2067 6574 2061 7265 612e 0a0a 2020 2020   get area...    
-0000f5b0: 2020 2020 736c 203a 2069 6e74 2c20 6465      sl : int, de
-0000f5c0: 6661 756c 743d 4e6f 6e65 0a20 2020 2020  fault=None.     
-0000f5d0: 2020 2020 2020 2053 6c69 6365 206e 756d         Slice num
-0000f5e0: 6265 722e 2049 6620 6e6f 6e65 206f 6620  ber. If none of 
-0000f5f0: 3c73 6c3e 2c20 3c69 6478 3e20 6f72 203c  <sl>, <idx> or <
-0000f600: 706f 733e 2061 7265 2073 7570 706c 6965  pos> are supplie
-0000f610: 6420 6275 740a 2020 2020 2020 2020 2020  d but.          
-0000f620: 2020 3c73 696e 676c 655f 736c 6963 653e    <single_slice>
-0000f630: 2069 7320 5472 7565 2c20 7468 6520 6365   is True, the ce
-0000f640: 6e74 7261 6c20 736c 6963 6520 6f66 2074  ntral slice of t
-0000f650: 6865 2052 4f49 2077 696c 6c20 6265 2075  he ROI will be u
-0000f660: 7365 642e 0a0a 2020 2020 2020 2020 6964  sed...        id
-0000f670: 7820 3a20 696e 742c 2064 6566 6175 6c74  x : int, default
-0000f680: 3d4e 6f6e 650a 2020 2020 2020 2020 2020  =None.          
-0000f690: 2020 4172 7261 7920 696e 6465 7820 6f66    Array index of
-0000f6a0: 2073 6c69 6365 2e20 4966 206e 6f6e 6520   slice. If none 
-0000f6b0: 6f66 203c 736c 3e2c 203c 6964 783e 206f  of <sl>, <idx> o
-0000f6c0: 7220 3c70 6f73 3e20 6172 6520 7375 7070  r <pos> are supp
-0000f6d0: 6c69 6564 2062 7574 0a20 2020 2020 2020  lied but.       
-0000f6e0: 2020 2020 203c 7369 6e67 6c65 5f73 6c69       <single_sli
-0000f6f0: 6365 3e20 6973 2054 7275 652c 2074 6865  ce> is True, the
-0000f700: 2063 656e 7472 616c 2073 6c69 6365 206f   central slice o
-0000f710: 6620 7468 6520 524f 4920 7769 6c6c 2062  f the ROI will b
-0000f720: 6520 7573 6564 2e0a 0a20 2020 2020 2020  e used...       
-0000f730: 2070 6f73 203a 2066 6c6f 6174 2c20 6465   pos : float, de
-0000f740: 6661 756c 743d 4e6f 6e65 0a20 2020 2020  fault=None.     
-0000f750: 2020 2020 2020 2053 6c69 6365 2070 6f73         Slice pos
-0000f760: 6974 696f 6e20 696e 206d 6d2e 2049 6620  ition in mm. If 
-0000f770: 6e6f 6e65 206f 6620 3c73 6c3e 2c20 3c69  none of <sl>, <i
-0000f780: 6478 3e20 6f72 203c 706f 733e 2061 7265  dx> or <pos> are
-0000f790: 2073 7570 706c 6965 6420 6275 740a 2020   supplied but.  
-0000f7a0: 2020 2020 2020 2020 2020 3c73 696e 676c            <singl
-0000f7b0: 655f 736c 6963 653e 2069 7320 5472 7565  e_slice> is True
-0000f7c0: 2c20 7468 6520 6365 6e74 7261 6c20 736c  , the central sl
-0000f7d0: 6963 6520 6f66 2074 6865 2052 4f49 2077  ice of the ROI w
-0000f7e0: 696c 6c20 6265 2075 7365 642e 0a0a 2020  ill be used...  
-0000f7f0: 2020 2020 2020 756e 6974 7320 3a20 7374        units : st
-0000f800: 722c 2064 6566 6175 6c74 3d22 6d6d 220a  r, default="mm".
-0000f810: 2020 2020 2020 2020 2020 2020 556e 6974              Unit
-0000f820: 7320 6f66 2061 7265 612e 2043 616e 2062  s of area. Can b
-0000f830: 6520 6569 7468 6572 206f 663a 0a0a 2020  e either of:..  
-0000f840: 2020 2020 2020 2020 2020 2020 2020 2a20                * 
-0000f850: 226d 6d22 3a20 7265 7475 726e 2061 7265  "mm": return are
-0000f860: 6120 696e 206d 696c 6c69 6d65 7472 6573  a in millimetres
-0000f870: 2073 7175 6172 6564 2e0a 2020 2020 2020   squared..      
-0000f880: 2020 2020 2020 2020 2020 2a20 2276 6f78            * "vox
-0000f890: 656c 7322 3a20 7265 7475 726e 2061 7265  els": return are
-0000f8a0: 6120 696e 206e 756d 6265 7220 6f66 2076  a in number of v
-0000f8b0: 6f78 656c 732e 0a0a 2020 2020 2020 2020  oxels...        
-0000f8c0: 2020 2020 4966 2075 6e69 7473 3d22 766f      If units="vo
-0000f8d0: 7865 6c73 2220 6973 2072 6571 7565 7374  xels" is request
-0000f8e0: 6564 2062 7574 2074 6869 7320 524f 4920  ed but this ROI 
-0000f8f0: 6f6e 6c79 2068 6173 2063 6f6e 746f 7572  only has contour
-0000f900: 7320 616e 6420 6e6f 0a20 2020 2020 2020  s and no.       
-0000f910: 2020 2020 2076 6f78 656c 2073 697a 6520       voxel size 
-0000f920: 696e 666f 726d 6174 696f 6e2c 2061 6e20  information, an 
-0000f930: 6572 726f 7220 7769 6c6c 2062 6520 7261  error will be ra
-0000f940: 6973 6564 2e0a 0a20 2020 2020 2020 206d  ised...        m
-0000f950: 6574 686f 6420 3a20 7374 722c 2064 6566  ethod : str, def
-0000f960: 6175 6c74 3d4e 6f6e 650a 2020 2020 2020  ault=None.      
-0000f970: 2020 2020 2020 4d65 7468 6f64 2074 6f20        Method to 
-0000f980: 7573 6520 666f 7220 6172 6561 2063 616c  use for area cal
-0000f990: 6375 6c61 7469 6f6e 2e20 4361 6e20 6265  culation. Can be
-0000f9a0: 3a20 0a0a 2020 2020 2020 2020 2020 2020  : ..            
-0000f9b0: 2020 2020 2a20 2263 6f6e 746f 7572 223a      * "contour":
-0000f9c0: 2063 6f6d 7075 7465 2061 7265 6120 6672   compute area fr
-0000f9d0: 6f6d 2073 6861 7065 6c79 2070 6f6c 7967  om shapely polyg
-0000f9e0: 6f6e 206f 6e20 7468 6520 736c 6963 652e  on on the slice.
-0000f9f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000fa00: 202a 2022 6d61 736b 223a 2063 6f6d 7075   * "mask": compu
-0000fa10: 7465 2061 7265 6120 6279 2073 756d 6d69  te area by summi
-0000fa20: 6e67 2070 6978 656c 7320 6f6e 2074 6865  ng pixels on the
-0000fa30: 2073 6c69 6365 2061 6e64 200a 2020 2020   slice and .    
-0000fa40: 2020 2020 2020 2020 2020 2020 2020 6d75                mu
-0000fa50: 6c74 6970 6c79 696e 6720 6279 2074 6865  ltiplying by the
-0000fa60: 2061 7265 6120 6f66 206f 6e65 2070 6978   area of one pix
-0000fa70: 656c 2e0a 2020 2020 2020 2020 2020 2020  el..            
-0000fa80: 2020 2020 2a20 4e6f 6e65 3a20 7573 6520      * None: use 
-0000fa90: 7468 6520 6d65 7468 6f64 2073 6574 2069  the method set i
-0000faa0: 6e20 7365 6c66 2e64 6566 6175 6c74 5f67  n self.default_g
-0000fab0: 656f 6d5f 6d65 7468 6f64 2e0a 0a20 2020  eom_method...   
-0000fac0: 2020 2020 2066 6c61 7474 656e 203a 2062       flatten : b
-0000fad0: 6f6f 6c2c 2064 6566 6175 6c74 3d46 616c  ool, default=Fal
-0000fae0: 7365 0a20 2020 2020 2020 2020 2020 2049  se.            I
-0000faf0: 6620 5472 7565 2c20 616c 6c20 736c 6963  f True, all slic
-0000fb00: 6573 2077 696c 6c20 6265 2066 6c61 7474  es will be flatt
-0000fb10: 656e 6564 2069 6e20 7468 6520 6769 7665  ened in the give
-0000fb20: 6e20 6f72 6965 6e74 6174 696f 6e20 616e  n orientation an
-0000fb30: 640a 2020 2020 2020 2020 2020 2020 7468  d.            th
-0000fb40: 6520 6172 6561 206f 6620 7468 6520 666c  e area of the fl
-0000fb50: 6174 7465 6e65 6420 736c 6963 6520 7769  attened slice wi
-0000fb60: 6c6c 2062 6520 7265 7475 726e 6564 2e20  ll be returned. 
-0000fb70: 4f6e 6c79 2061 7661 696c 6162 6c65 0a20  Only available. 
-0000fb80: 2020 2020 2020 2020 2020 2069 6620 6d65             if me
-0000fb90: 7468 6f64 3d22 6d61 736b 222e 0a20 2020  thod="mask"..   
-0000fba0: 2020 2020 2022 2222 0a0a 2020 2020 2020       """..      
-0000fbb0: 2020 2320 4765 7420 6465 6661 756c 7420    # Get default 
-0000fbc0: 736c 6963 6520 696e 6465 7820 616e 6420  slice index and 
-0000fbd0: 6d65 7468 6f64 0a20 2020 2020 2020 2073  method.        s
-0000fbe0: 656c 662e 6c6f 6164 2829 0a20 2020 2020  elf.load().     
-0000fbf0: 2020 2069 6620 736c 2069 7320 4e6f 6e65     if sl is None
-0000fc00: 2061 6e64 2069 6478 2069 7320 4e6f 6e65   and idx is None
-0000fc10: 2061 6e64 2070 6f73 2069 7320 4e6f 6e65   and pos is None
-0000fc20: 3a20 0a20 2020 2020 2020 2020 2020 2069  : .            i
-0000fc30: 6478 203d 2073 656c 662e 6765 745f 6d69  dx = self.get_mi
-0000fc40: 645f 6964 7828 7669 6577 290a 2020 2020  d_idx(view).    
-0000fc50: 2020 2020 6966 206d 6574 686f 6420 6973      if method is
-0000fc60: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-0000fc70: 2020 206d 6574 686f 6420 3d20 7365 6c66     method = self
-0000fc80: 2e64 6566 6175 6c74 5f67 656f 6d5f 6d65  .default_geom_me
-0000fc90: 7468 6f64 0a0a 2020 2020 2020 2020 2320  thod..        # 
-0000fca0: 4966 2052 4f49 2069 7320 6e6f 7420 6f6e  If ROI is not on
-0000fcb0: 2074 6865 2067 6976 656e 2073 6c69 6365   the given slice
-0000fcc0: 2c20 7265 7475 726e 204e 6f6e 650a 2020  , return None.  
-0000fcd0: 2020 2020 2020 6966 206e 6f74 2073 656c        if not sel
-0000fce0: 662e 6f6e 5f73 6c69 6365 2876 6965 772c  f.on_slice(view,
-0000fcf0: 2073 6c3d 736c 2c20 6964 783d 6964 782c   sl=sl, idx=idx,
-0000fd00: 2070 6f73 3d70 6f73 293a 0a20 2020 2020   pos=pos):.     
-0000fd10: 2020 2020 2020 2072 6574 7572 6e0a 0a20         return.. 
-0000fd20: 2020 2020 2020 2069 6620 666c 6174 7465         if flatte
-0000fd30: 6e3a 2020 2320 466c 6174 7465 6e69 6e67  n:  # Flattening
-0000fd40: 206f 6e6c 7920 706f 7373 6962 6c65 2077   only possible w
-0000fd50: 6974 6820 226d 6173 6b22 0a20 2020 2020  ith "mask".     
-0000fd60: 2020 2020 2020 206d 6574 686f 6420 3d20         method = 
-0000fd70: 226d 6173 6b22 0a0a 2020 2020 2020 2020  "mask"..        
-0000fd80: 2320 4361 6c63 756c 6174 6520 6172 6561  # Calculate area
-0000fd90: 2066 726f 6d20 7368 6170 656c 7920 706f   from shapely po
-0000fda0: 6c79 676f 6e28 7329 0a20 2020 2020 2020  lygon(s).       
-0000fdb0: 2069 6620 6d65 7468 6f64 203d 3d20 2263   if method == "c
-0000fdc0: 6f6e 746f 7572 223a 0a0a 2020 2020 2020  ontour":..      
-0000fdd0: 2020 2020 2020 2320 4368 6563 6b20 6974        # Check it
-0000fde0: 2773 2070 6f73 7369 626c 6520 746f 2063  's possible to c
-0000fdf0: 616c 6375 6c61 7465 2061 7265 6120 7769  alculate area wi
-0000fe00: 7468 2074 6865 2072 6571 7565 7374 6564  th the requested
-0000fe10: 2075 6e69 7473 0a20 2020 2020 2020 2020   units.         
-0000fe20: 2020 2069 6620 7365 6c66 2e76 6f78 656c     if self.voxel
-0000fe30: 5f73 697a 6520 6973 204e 6f6e 6520 616e  _size is None an
-0000fe40: 6420 756e 6974 7320 3d3d 2022 766f 7865  d units == "voxe
-0000fe50: 6c73 223a 0a20 2020 2020 2020 2020 2020  ls":.           
-0000fe60: 2020 2020 2072 6169 7365 2052 756e 7469       raise Runti
-0000fe70: 6d65 4572 726f 7228 2243 616e 6e6f 7420  meError("Cannot 
-0000fe80: 636f 6d70 7574 6520 6172 6561 2069 6e20  compute area in 
-0000fe90: 766f 7865 6c73 2066 726f 6d20 220a 2020  voxels from ".  
-0000fea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000feb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fec0: 2022 636f 6e74 6f75 7273 2077 6974 686f   "contours witho
-0000fed0: 7574 206b 6e6f 7769 6e67 2076 6f78 656c  ut knowing voxel
-0000fee0: 2073 697a 6573 2122 290a 0a20 2020 2020   sizes!")..     
-0000fef0: 2020 2020 2020 2070 6f6c 7967 6f6e 7320         polygons 
-0000ff00: 3d20 7365 6c66 2e67 6574 5f70 6f6c 7967  = self.get_polyg
-0000ff10: 6f6e 735f 6f6e 5f73 6c69 6365 2876 6965  ons_on_slice(vie
-0000ff20: 772c 2073 6c2c 2069 6478 2c20 706f 7329  w, sl, idx, pos)
-0000ff30: 0a20 2020 2020 2020 2020 2020 2061 7265  .            are
-0000ff40: 6120 3d20 7375 6d28 5b70 2e61 7265 6120  a = sum([p.area 
-0000ff50: 666f 7220 7020 696e 2070 6f6c 7967 6f6e  for p in polygon
-0000ff60: 735d 290a 2020 2020 2020 2020 2020 2020  s]).            
-0000ff70: 6966 2075 6e69 7473 203d 3d20 2276 6f78  if units == "vox
-0000ff80: 656c 7322 3a0a 2020 2020 2020 2020 2020  els":.          
-0000ff90: 2020 2020 2020 785f 6178 2c20 795f 6178        x_ax, y_ax
-0000ffa0: 203d 2073 6b72 742e 696d 6167 652e 5f70   = skrt.image._p
-0000ffb0: 6c6f 745f 6178 6573 5b76 6965 775d 0a20  lot_axes[view]. 
-0000ffc0: 2020 2020 2020 2020 2020 2020 2020 2078                 x
-0000ffd0: 795f 6172 6561 203d 2061 6273 2873 656c  y_area = abs(sel
-0000ffe0: 662e 766f 7865 6c5f 7369 7a65 5b78 5f61  f.voxel_size[x_a
-0000fff0: 785d 202a 2073 656c 662e 766f 7865 6c5f  x] * self.voxel_
-00010000: 7369 7a65 5b79 5f61 785d 290a 2020 2020  size[y_ax]).    
-00010010: 2020 2020 2020 2020 2020 2020 6172 6561              area
-00010020: 202f 3d20 7879 5f61 7265 610a 2020 2020   /= xy_area.    
-00010030: 2020 2020 2020 2020 7265 7475 726e 2061          return a
-00010040: 7265 610a 0a20 2020 2020 2020 2023 204f  rea..        # O
-00010050: 7468 6572 7769 7365 2c20 6361 6c63 756c  therwise, calcul
-00010060: 6174 6520 6172 6561 2066 726f 6d20 6269  ate area from bi
-00010070: 6e61 7279 206d 6173 6b0a 2020 2020 2020  nary mask.      
-00010080: 2020 696d 5f73 6c69 6365 203d 2073 656c    im_slice = sel
-00010090: 662e 6765 745f 736c 6963 6528 7669 6577  f.get_slice(view
-000100a0: 2c20 736c 3d73 6c2c 2069 6478 3d69 6478  , sl=sl, idx=idx
-000100b0: 2c20 706f 733d 706f 732c 200a 2020 2020  , pos=pos, .    
-000100c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000100d0: 2020 2020 2020 2020 2020 2020 2020 666c                fl
-000100e0: 6174 7465 6e3d 666c 6174 7465 6e29 0a20  atten=flatten). 
-000100f0: 2020 2020 2020 2061 7265 6120 3d20 696d         area = im
-00010100: 5f73 6c69 6365 2e61 7374 7970 6528 626f  _slice.astype(bo
-00010110: 6f6c 292e 7375 6d28 290a 2020 2020 2020  ol).sum().      
-00010120: 2020 6966 2075 6e69 7473 203d 3d20 226d    if units == "m
-00010130: 6d22 3a0a 2020 2020 2020 2020 2020 2020  m":.            
-00010140: 785f 6178 2c20 795f 6178 203d 2073 6b72  x_ax, y_ax = skr
-00010150: 742e 696d 6167 652e 5f70 6c6f 745f 6178  t.image._plot_ax
-00010160: 6573 5b76 6965 775d 0a20 2020 2020 2020  es[view].       
-00010170: 2020 2020 2078 795f 6172 6561 203d 2061       xy_area = a
-00010180: 6273 2873 656c 662e 766f 7865 6c5f 7369  bs(self.voxel_si
-00010190: 7a65 5b78 5f61 785d 202a 2073 656c 662e  ze[x_ax] * self.
-000101a0: 766f 7865 6c5f 7369 7a65 5b79 5f61 785d  voxel_size[y_ax]
-000101b0: 290a 2020 2020 2020 2020 2020 2020 6172  ).            ar
-000101c0: 6561 202a 3d20 7879 5f61 7265 610a 2020  ea *= xy_area.  
-000101d0: 2020 2020 2020 7265 7475 726e 2061 7265        return are
-000101e0: 610a 0a20 2020 2064 6566 2067 6574 5f62  a..    def get_b
-000101f0: 626f 785f 6365 6e74 7265 5f61 6e64 5f77  box_centre_and_w
-00010200: 6964 7468 7328 7365 6c66 2c0a 2020 2020  idths(self,.    
-00010210: 2020 2020 2020 2020 6275 6666 6572 3d4e          buffer=N
-00010220: 6f6e 652c 2062 7566 6665 725f 756e 6974  one, buffer_unit
-00010230: 733d 226d 6d22 2c20 6d65 7468 6f64 3d4e  s="mm", method=N
-00010240: 6f6e 6529 3a0a 2020 2020 2020 2020 2222  one):.        ""
-00010250: 220a 2020 2020 2020 2020 4765 7420 6365  ".        Get ce
-00010260: 6e74 7265 2061 6e64 2077 6964 7468 7320  ntre and widths 
-00010270: 696e 206d 6d20 616c 6f6e 6720 616c 6c20  in mm along all 
-00010280: 7468 7265 6520 6178 6573 206f 6620 610a  three axes of a.
-00010290: 2020 2020 2020 2020 626f 756e 6469 6e67          bounding
-000102a0: 2062 6f78 2065 6e63 6c6f 7369 6e67 2074   box enclosing t
-000102b0: 6865 2052 4f49 2061 6e64 206f 7074 696f  he ROI and optio
-000102c0: 6e61 6c20 6275 6666 6572 2e20 2043 656e  nal buffer.  Cen
-000102d0: 7472 650a 2020 2020 2020 2020 616e 6420  tre.        and 
-000102e0: 7769 6474 6873 2061 7265 2072 6574 7572  widths are retur
-000102f0: 6e65 6420 6173 2061 2074 7570 6c65 2028  ned as a tuple (
-00010300: 5b78 2c20 792c 207a 5d2c 205b 6478 2c20  [x, y, z], [dx, 
-00010310: 6479 2c20 647a 5d29 2e0a 0a20 2020 2020  dy, dz])...     
-00010320: 2020 204d 6574 686f 6420 7061 7261 6d65     Method parame
-00010330: 7465 7273 2061 7265 2070 6173 7365 6420  ters are passed 
-00010340: 746f 2073 6b72 742e 7374 7275 6374 7572  to skrt.structur
-00010350: 6573 2e52 4f49 2e67 6574 5f65 7874 656e  es.ROI.get_exten
-00010360: 7473 2829 0a20 2020 2020 2020 2074 6f20  ts().        to 
-00010370: 6f62 7461 696e 2052 4f49 2065 7874 656e  obtain ROI exten
-00010380: 7473 2e20 2046 6f72 2070 6172 616d 6574  ts.  For paramet
-00010390: 6572 2065 7870 6c61 6e61 7469 6f6e 732c  er explanations,
-000103a0: 2073 6565 0a20 2020 2020 2020 2073 6b72   see.        skr
-000103b0: 742e 7374 7275 6374 7572 6573 2e52 4f49  t.structures.ROI
-000103c0: 2e67 6574 5f65 7874 656e 7473 2829 2064  .get_extents() d
-000103d0: 6f63 756d 656e 7461 7469 6f6e 2e0a 2020  ocumentation..  
-000103e0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-000103f0: 2020 6578 7465 6e74 7320 3d20 7365 6c66    extents = self
-00010400: 2e67 6574 5f65 7874 656e 7473 2862 7566  .get_extents(buf
-00010410: 6665 722c 2062 7566 6665 725f 756e 6974  fer, buffer_unit
-00010420: 732c 206d 6574 686f 6429 200a 2020 2020  s, method) .    
-00010430: 2020 2020 6365 6e74 7265 203d 205b 302e      centre = [0.
-00010440: 3520 2a20 2865 7874 656e 745b 305d 202b  5 * (extent[0] +
-00010450: 2065 7874 656e 745b 315d 2920 666f 7220   extent[1]) for 
-00010460: 6578 7465 6e74 2069 6e20 6578 7465 6e74  extent in extent
-00010470: 735d 0a20 2020 2020 2020 2077 6964 7468  s].        width
-00010480: 7320 3d20 5b28 6578 7465 6e74 5b31 5d20  s = [(extent[1] 
-00010490: 2d20 6578 7465 6e74 5b30 5d29 2066 6f72  - extent[0]) for
-000104a0: 2065 7874 656e 7420 696e 2065 7874 656e   extent in exten
-000104b0: 7473 5d0a 2020 2020 2020 2020 7265 7475  ts].        retu
-000104c0: 726e 2028 6365 6e74 7265 2c20 7769 6474  rn (centre, widt
-000104d0: 6873 290a 0a20 2020 2064 6566 2067 6574  hs)..    def get
-000104e0: 5f65 7874 656e 7473 2873 656c 662c 2062  _extents(self, b
-000104f0: 7566 6665 723d 4e6f 6e65 2c20 6275 6666  uffer=None, buff
-00010500: 6572 5f75 6e69 7473 3d22 6d6d 222c 206d  er_units="mm", m
-00010510: 6574 686f 643d 4e6f 6e65 2c0a 2020 2020  ethod=None,.    
-00010520: 2020 2020 2020 2020 6f72 6967 696e 3d4e          origin=N
-00010530: 6f6e 6529 3a0a 2020 2020 2020 2020 2222  one):.        ""
-00010540: 220a 2020 2020 2020 2020 4765 7420 6d69  ".        Get mi
-00010550: 6e69 6d75 6d20 616e 6420 6d61 7869 6d75  nimum and maximu
-00010560: 6d20 6578 7465 6e74 206f 6620 7468 6520  m extent of the 
-00010570: 524f 4920 696e 206d 6d20 616c 6f6e 6720  ROI in mm along 
-00010580: 616c 6c20 7468 7265 6520 6178 6573 2c0a  all three axes,.
-00010590: 2020 2020 2020 2020 7265 7475 726e 6564          returned
-000105a0: 2069 6e20 6f72 6465 7220 5b78 2c20 792c   in order [x, y,
-000105b0: 207a 5d2e 204f 7074 696f 6e61 6c6c 7920   z]. Optionally 
-000105c0: 6170 706c 7920 6120 6275 6666 6572 2074  apply a buffer t
-000105d0: 6f20 7468 6520 6578 7465 6e74 730a 2020  o the extents.  
-000105e0: 2020 2020 2020 7375 6368 2074 6861 7420        such that 
-000105f0: 7468 6579 2063 6f76 6572 206d 6f72 6520  they cover more 
-00010600: 7468 616e 2074 6865 2052 4f49 2773 2061  than the ROI's a
-00010610: 7265 612e 0a0a 2020 2020 2020 2020 2a2a  rea...        **
-00010620: 5061 7261 6d65 7465 7273 3a2a 2a0a 0a20  Parameters:**.. 
-00010630: 2020 2020 2020 2062 7566 6665 7220 3a20         buffer : 
-00010640: 666c 6f61 742c 2064 6566 6175 6c74 3d4e  float, default=N
-00010650: 6f6e 650a 2020 2020 2020 2020 2020 2020  one.            
-00010660: 4f70 7469 6f6e 616c 2062 7566 6665 7220  Optional buffer 
-00010670: 746f 2061 6464 2074 6f20 7468 6520 6578  to add to the ex
-00010680: 7465 6e74 732e 2055 6e69 7473 2073 6574  tents. Units set
-00010690: 2062 7920 6062 7566 6665 725f 756e 6974   by `buffer_unit
-000106a0: 7360 2e0a 0a20 2020 2020 2020 2062 7566  s`...        buf
-000106b0: 6665 725f 756e 6974 7320 3a20 7374 722c  fer_units : str,
-000106c0: 2064 6566 6175 6c74 3d22 6d6d 220a 2020   default="mm".  
-000106d0: 2020 2020 2020 2020 2020 556e 6974 7320            Units 
-000106e0: 666f 7220 6275 6666 6572 2c20 6966 2075  for buffer, if u
-000106f0: 7369 6e67 2e20 4361 6e20 6265 2022 6d6d  sing. Can be "mm
-00010700: 222c 2022 766f 7865 6c73 222c 206f 7220  ", "voxels", or 
-00010710: 2266 7261 6322 2028 7768 6963 680a 2020  "frac" (which.  
-00010720: 2020 2020 2020 2020 2020 6170 706c 6965            applie
-00010730: 7320 6275 6666 6572 2061 7320 6120 6672  s buffer as a fr
-00010740: 6163 7469 6f6e 206f 6620 746f 7461 6c20  action of total 
-00010750: 6c65 6e67 7468 2069 6e20 6561 6368 2064  length in each d
-00010760: 696d 656e 7369 6f6e 292e 0a0a 2020 2020  imension)...    
-00010770: 2020 2020 6d65 7468 6f64 203a 2073 7472      method : str
-00010780: 2c20 6465 6661 756c 743d 4e6f 6e65 0a20  , default=None. 
-00010790: 2020 2020 2020 2020 2020 204d 6574 686f             Metho
-000107a0: 6420 746f 2075 7365 2066 6f72 2065 7874  d to use for ext
-000107b0: 656e 7420 6361 6c63 756c 6174 696f 6e2e  ent calculation.
-000107c0: 2043 616e 2062 653a 200a 0a20 2020 2020   Can be: ..     
-000107d0: 2020 2020 2020 2020 2020 202a 2022 636f             * "co
-000107e0: 6e74 6f75 7222 3a20 6765 7420 6578 7465  ntour": get exte
-000107f0: 6e74 2066 726f 6d20 6d69 6e2f 6d61 7820  nt from min/max 
-00010800: 706f 7369 7469 6f6e 7320 6f66 2063 6f6e  positions of con
-00010810: 746f 7572 2873 292e 0a20 2020 2020 2020  tour(s)..       
-00010820: 2020 2020 2020 2020 202a 2022 6d61 736b           * "mask
-00010830: 223a 2067 6574 2065 7874 656e 7420 6672  ": get extent fr
-00010840: 6f6d 206d 696e 2f6d 6178 2070 6f73 6974  om min/max posit
-00010850: 696f 6e73 206f 6620 766f 7865 6c73 2069  ions of voxels i
-00010860: 6e20 7468 6520 0a20 2020 2020 2020 2020  n the .         
-00010870: 2020 2020 2020 2020 2062 696e 6172 7920           binary 
-00010880: 6d61 736b 2e0a 2020 2020 2020 2020 2020  mask..          
-00010890: 2020 2020 2020 2a20 4e6f 6e65 3a20 7573        * None: us
-000108a0: 6520 7468 6520 6d65 7468 6f64 2073 6574  e the method set
-000108b0: 2069 6e20 7365 6c66 2e64 6566 6175 6c74   in self.default
-000108c0: 5f67 656f 6d5f 6d65 7468 6f64 2e0a 0a20  _geom_method... 
-000108d0: 2020 2020 2020 206f 7269 6769 6e20 3a20         origin : 
-000108e0: 7475 706c 652c 2064 6566 6175 6c74 3d4e  tuple, default=N
-000108f0: 6f6e 650a 2020 2020 2020 2020 2020 2020  one.            
-00010900: 5475 706c 6520 7370 6563 6966 7969 6e67  Tuple specifying
-00010910: 2074 6865 2028 782c 2079 2c20 7a29 2063   the (x, y, z) c
-00010920: 6f6f 7264 696e 6174 6573 206f 6620 7468  oordinates of th
-00010930: 6520 706f 696e 740a 2020 2020 2020 2020  e point.        
-00010940: 2020 2020 7769 7468 2072 6573 7065 6374      with respect
-00010950: 2074 6f20 7768 6963 6820 6578 7465 6e74   to which extent
-00010960: 7320 6172 6520 746f 2062 6520 6465 7465  s are to be dete
-00010970: 726d 696e 6564 2e0a 2020 2020 2020 2020  rmined..        
-00010980: 2020 2020 4966 204e 6f6e 652c 2074 6865      If None, the
-00010990: 6e20 2830 2c20 302c 2030 2920 6973 2075  n (0, 0, 0) is u
-000109a0: 7365 642e 0a20 2020 2020 2020 2022 2222  sed..        """
-000109b0: 0a20 2020 2020 2020 2023 2045 6e73 7572  .        # Ensur
-000109c0: 6520 7468 6174 206f 7269 6769 6e20 6973  e that origin is
-000109d0: 2064 6566 696e 6564 2e0a 2020 2020 2020   defined..      
-000109e0: 2020 6f72 6967 696e 203d 206f 7269 6769    origin = origi
-000109f0: 6e20 6f72 2028 302c 2030 2c20 3029 0a0a  n or (0, 0, 0)..
-00010a00: 2020 2020 2020 2020 2320 4765 7420 6578          # Get ex
-00010a10: 7465 6e74 2069 6e20 6561 6368 2064 6972  tent in each dir
-00010a20: 6563 7469 6f6e 0a20 2020 2020 2020 2065  ection.        e
-00010a30: 7874 656e 7473 203d 205b 5d0a 2020 2020  xtents = [].    
-00010a40: 2020 2020 666f 7220 6178 2069 6e20 736b      for ax in sk
-00010a50: 7274 2e69 6d61 6765 2e5f 6178 6573 3a0a  rt.image._axes:.
-00010a60: 2020 2020 2020 2020 2020 2020 6578 7465              exte
-00010a70: 6e74 732e 6170 7065 6e64 2873 656c 662e  nts.append(self.
-00010a80: 6765 745f 6578 7465 6e74 2861 782c 206d  get_extent(ax, m
-00010a90: 6574 686f 643d 6d65 7468 6f64 2c20 6f72  ethod=method, or
-00010aa0: 6967 696e 3d6f 7269 6769 6e29 290a 0a20  igin=origin)).. 
-00010ab0: 2020 2020 2020 2023 2041 7070 6c79 2062         # Apply b
-00010ac0: 7566 6665 7220 6966 2072 6571 7565 7374  uffer if request
-00010ad0: 6564 0a20 2020 2020 2020 2069 6620 6275  ed.        if bu
-00010ae0: 6666 6572 3a0a 2020 2020 2020 2020 2020  ffer:.          
-00010af0: 2020 666f 7220 6178 2069 6e20 7261 6e67    for ax in rang
-00010b00: 6528 3329 3a0a 2020 2020 2020 2020 2020  e(3):.          
-00010b10: 2020 2020 2020 6966 2062 7566 6665 725f        if buffer_
-00010b20: 756e 6974 7320 3d3d 2022 6d6d 223a 0a20  units == "mm":. 
-00010b30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010b40: 2020 2064 656c 7461 203d 2062 7566 6665     delta = buffe
-00010b50: 720a 2020 2020 2020 2020 2020 2020 2020  r.              
-00010b60: 2020 656c 6966 2062 7566 6665 725f 756e    elif buffer_un
-00010b70: 6974 7320 3d3d 2022 766f 7865 6c73 223a  its == "voxels":
-00010b80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00010b90: 2020 2020 2064 656c 7461 203d 2061 6273       delta = abs
-00010ba0: 2862 7566 6665 7220 2a20 7365 6c66 2e76  (buffer * self.v
-00010bb0: 6f78 656c 5f73 697a 655b 6178 5d29 0a20  oxel_size[ax]). 
-00010bc0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-00010bd0: 6c69 6620 6275 6666 6572 5f75 6e69 7473  lif buffer_units
-00010be0: 203d 3d20 2266 7261 6322 3a0a 2020 2020   == "frac":.    
-00010bf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010c00: 6465 6c74 6120 3d20 6275 6666 6572 202a  delta = buffer *
-00010c10: 2061 6273 2865 7874 656e 7473 5b61 785d   abs(extents[ax]
-00010c20: 5b31 5d20 2d20 6578 7465 6e74 735b 6178  [1] - extents[ax
-00010c30: 5d5b 305d 290a 2020 2020 2020 2020 2020  ][0]).          
-00010c40: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-00010c50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010c60: 7072 696e 7428 6622 556e 7265 636f 676e  print(f"Unrecogn
-00010c70: 6973 6564 2062 7566 6665 7220 756e 6974  ised buffer unit
-00010c80: 7320 7b62 7566 6665 725f 756e 6974 737d  s {buffer_units}
-00010c90: 2e20 5368 6f75 6c64 2022 0a20 2020 2020  . Should ".     
-00010ca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010cb0: 2020 2020 2027 6265 2022 6d6d 222c 2022       'be "mm", "
-00010cc0: 766f 7865 6c73 222c 206f 7220 2266 7261  voxels", or "fra
-00010cd0: 6322 2e27 290a 2020 2020 2020 2020 2020  c".').          
-00010ce0: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00010cf0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00010d00: 2065 7874 656e 7473 5b61 785d 5b30 5d20   extents[ax][0] 
-00010d10: 2d3d 2064 656c 7461 0a20 2020 2020 2020  -= delta.       
-00010d20: 2020 2020 2020 2020 2065 7874 656e 7473           extents
-00010d30: 5b61 785d 5b31 5d20 2b3d 2064 656c 7461  [ax][1] += delta
-00010d40: 0a0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-00010d50: 2065 7874 656e 7473 0a0a 2020 2020 6465   extents..    de
-00010d60: 6620 6765 745f 6578 7465 6e74 2873 656c  f get_extent(sel
-00010d70: 662c 200a 2020 2020 2020 2020 2020 2020  f, .            
-00010d80: 2020 2020 2020 2061 783d 227a 222c 200a         ax="z", .
-00010d90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010da0: 2020 2073 696e 676c 655f 736c 6963 653d     single_slice=
-00010db0: 4661 6c73 652c 0a20 2020 2020 2020 2020  False,.         
-00010dc0: 2020 2020 2020 2020 2020 7669 6577 3d22            view="
-00010dd0: 782d 7922 2c0a 2020 2020 2020 2020 2020  x-y",.          
-00010de0: 2020 2020 2020 2020 2073 6c3d 4e6f 6e65           sl=None
-00010df0: 2c20 0a20 2020 2020 2020 2020 2020 2020  , .             
-00010e00: 2020 2020 2020 6964 783d 4e6f 6e65 2c20        idx=None, 
-00010e10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00010e20: 2020 2020 706f 733d 4e6f 6e65 2c20 0a20      pos=None, . 
-00010e30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010e40: 2020 6d65 7468 6f64 3d4e 6f6e 652c 200a    method=None, .
-00010e50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010e60: 2020 206f 7269 6769 6e3d 4e6f 6e65 2c0a     origin=None,.
-00010e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010e80: 2020 293a 0a20 2020 2020 2020 2022 2222    ):.        """
-00010e90: 4765 7420 6d69 6e69 6d75 6d20 616e 6420  Get minimum and 
-00010ea0: 6d61 7869 6d75 6d20 6578 7465 6e74 206f  maximum extent o
-00010eb0: 6620 7468 6520 524f 4920 696e 206d 6d20  f the ROI in mm 
-00010ec0: 616c 6f6e 6720 6120 6769 7665 6e20 6178  along a given ax
-00010ed0: 6973 2e0a 0a20 2020 2020 2020 2061 7820  is...        ax 
-00010ee0: 3a20 7374 722f 696e 742c 2064 6566 6175  : str/int, defau
-00010ef0: 6c74 3d22 7a22 0a20 2020 2020 2020 2020  lt="z".         
-00010f00: 2020 2041 7869 7320 616c 6f6e 6720 7768     Axis along wh
-00010f10: 6963 6820 746f 2072 6574 7572 6e20 6578  ich to return ex
-00010f20: 7465 6e74 2e20 5368 6f75 6c64 2062 6520  tent. Should be 
-00010f30: 6f6e 6520 6f66 205b 2278 222c 2022 7922  one of ["x", "y"
-00010f40: 2c20 227a 225d 200a 2020 2020 2020 2020  , "z"] .        
-00010f50: 2020 2020 6f72 205b 302c 2031 2c20 325d      or [0, 1, 2]
-00010f60: 0a0a 2020 2020 2020 2020 7369 6e67 6c65  ..        single
-00010f70: 5f73 6c69 6365 203a 2062 6f6f 6c2c 2064  _slice : bool, d
-00010f80: 6566 6175 6c74 3d46 616c 7365 0a20 2020  efault=False.   
-00010f90: 2020 2020 2020 2020 2049 6620 4661 6c73           If Fals
-00010fa0: 652c 2074 6865 2033 4420 6578 7465 6e74  e, the 3D extent
-00010fb0: 206f 6620 7468 6520 656e 7469 7265 2052   of the entire R
-00010fc0: 4f49 2077 696c 6c20 6265 2072 6574 7572  OI will be retur
-00010fd0: 6e65 643b 0a20 2020 2020 2020 2020 2020  ned;.           
-00010fe0: 206f 7468 6572 7769 7365 2c20 7468 6520   otherwise, the 
-00010ff0: 3244 2065 7874 656e 7420 6f66 2061 2073  2D extent of a s
-00011000: 696e 676c 6520 736c 6963 6520 7769 6c6c  ingle slice will
-00011010: 2062 6520 7265 7475 726e 6564 2e0a 0a20   be returned... 
-00011020: 2020 2020 2020 2076 6965 7720 3a20 7374         view : st
-00011030: 722c 2064 6566 6175 6c74 3d22 782d 7922  r, default="x-y"
-00011040: 0a20 2020 2020 2020 2020 2020 204f 7269  .            Ori
-00011050: 656e 7461 7469 6f6e 206f 6620 736c 6963  entation of slic
-00011060: 6520 6f6e 2077 6869 6368 2074 6f20 6765  e on which to ge
-00011070: 7420 6578 7465 6e74 2e20 4f6e 6c79 2075  t extent. Only u
-00011080: 7365 6420 6966 200a 2020 2020 2020 2020  sed if .        
-00011090: 2020 2020 7369 6e67 6c65 5f73 6c69 6365      single_slice
-000110a0: 3d54 7275 652e 2049 6620 7573 696e 672c  =True. If using,
-000110b0: 203c 6178 3e20 6d75 7374 2062 6520 616e   <ax> must be an
-000110c0: 2061 7869 7320 7468 6174 206c 6965 7320   axis that lies 
-000110d0: 616c 6f6e 670a 2020 2020 2020 2020 2020  along.          
-000110e0: 2020 7468 6520 736c 6963 6520 696e 2074    the slice in t
-000110f0: 6869 7320 6f72 6965 6e74 6174 696f 6e2e  his orientation.
-00011100: 0a0a 2020 2020 2020 2020 736c 203a 2069  ..        sl : i
-00011110: 6e74 2c20 6465 6661 756c 743d 4e6f 6e65  nt, default=None
-00011120: 0a20 2020 2020 2020 2020 2020 2053 6c69  .            Sli
-00011130: 6365 206e 756d 6265 722e 2049 6620 6e6f  ce number. If no
-00011140: 6e65 206f 6620 3c73 6c3e 2c20 3c69 6478  ne of <sl>, <idx
-00011150: 3e20 6f72 203c 706f 733e 2061 7265 2073  > or <pos> are s
-00011160: 7570 706c 6965 6420 6275 740a 2020 2020  upplied but.    
-00011170: 2020 2020 2020 2020 3c73 696e 676c 655f          <single_
-00011180: 736c 6963 653e 2069 7320 5472 7565 2c20  slice> is True, 
-00011190: 7468 6520 6365 6e74 7261 6c20 736c 6963  the central slic
-000111a0: 6520 6f66 2074 6865 2052 4f49 2077 696c  e of the ROI wil
-000111b0: 6c20 6265 2075 7365 642e 0a0a 2020 2020  l be used...    
-000111c0: 2020 2020 6964 7820 3a20 696e 742c 2064      idx : int, d
-000111d0: 6566 6175 6c74 3d4e 6f6e 650a 2020 2020  efault=None.    
-000111e0: 2020 2020 2020 2020 4172 7261 7920 696e          Array in
-000111f0: 6465 7820 6f66 2073 6c69 6365 2e20 4966  dex of slice. If
-00011200: 206e 6f6e 6520 6f66 203c 736c 3e2c 203c   none of <sl>, <
-00011210: 6964 783e 206f 7220 3c70 6f73 3e20 6172  idx> or <pos> ar
-00011220: 6520 7375 7070 6c69 6564 2062 7574 0a20  e supplied but. 
-00011230: 2020 2020 2020 2020 2020 203c 7369 6e67             <sing
-00011240: 6c65 5f73 6c69 6365 3e20 6973 2054 7275  le_slice> is Tru
-00011250: 652c 2074 6865 2063 656e 7472 616c 2073  e, the central s
-00011260: 6c69 6365 206f 6620 7468 6520 524f 4920  lice of the ROI 
-00011270: 7769 6c6c 2062 6520 7573 6564 2e0a 0a20  will be used... 
-00011280: 2020 2020 2020 2070 6f73 203a 2066 6c6f         pos : flo
-00011290: 6174 2c20 6465 6661 756c 743d 4e6f 6e65  at, default=None
-000112a0: 0a20 2020 2020 2020 2020 2020 2053 6c69  .            Sli
-000112b0: 6365 2070 6f73 6974 696f 6e20 696e 206d  ce position in m
-000112c0: 6d2e 2049 6620 6e6f 6e65 206f 6620 3c73  m. If none of <s
-000112d0: 6c3e 2c20 3c69 6478 3e20 6f72 203c 706f  l>, <idx> or <po
-000112e0: 733e 2061 7265 2073 7570 706c 6965 6420  s> are supplied 
-000112f0: 6275 740a 2020 2020 2020 2020 2020 2020  but.            
-00011300: 3c73 696e 676c 655f 736c 6963 653e 2069  <single_slice> i
-00011310: 7320 5472 7565 2c20 7468 6520 6365 6e74  s True, the cent
-00011320: 7261 6c20 736c 6963 6520 6f66 2074 6865  ral slice of the
-00011330: 2052 4f49 2077 696c 6c20 6265 2075 7365   ROI will be use
-00011340: 642e 0a0a 2020 2020 2020 2020 6d65 7468  d...        meth
-00011350: 6f64 203a 2073 7472 2c20 6465 6661 756c  od : str, defaul
-00011360: 743d 4e6f 6e65 0a20 2020 2020 2020 2020  t=None.         
-00011370: 2020 204d 6574 686f 6420 746f 2075 7365     Method to use
-00011380: 2066 6f72 2065 7874 656e 7420 6361 6c63   for extent calc
-00011390: 756c 6174 696f 6e2e 2043 616e 2062 653a  ulation. Can be:
-000113a0: 200a 0a20 2020 2020 2020 2020 2020 2020   ..             
-000113b0: 2020 202a 2022 636f 6e74 6f75 7222 3a20     * "contour": 
-000113c0: 6765 7420 6578 7465 6e74 2066 726f 6d20  get extent from 
-000113d0: 6d69 6e2f 6d61 7820 706f 7369 7469 6f6e  min/max position
-000113e0: 7320 6f66 2063 6f6e 746f 7572 2873 292e  s of contour(s).
-000113f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00011400: 202a 2022 6d61 736b 223a 2067 6574 2065   * "mask": get e
-00011410: 7874 656e 7420 6672 6f6d 206d 696e 2f6d  xtent from min/m
-00011420: 6178 2070 6f73 6974 696f 6e73 206f 6620  ax positions of 
-00011430: 766f 7865 6c73 2069 6e20 7468 6520 0a20  voxels in the . 
-00011440: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011450: 2062 696e 6172 7920 6d61 736b 2e0a 2020   binary mask..  
-00011460: 2020 2020 2020 2020 2020 2020 2020 2a20                * 
-00011470: 4e6f 6e65 3a20 7573 6520 7468 6520 6d65  None: use the me
-00011480: 7468 6f64 2073 6574 2069 6e20 7365 6c66  thod set in self
-00011490: 2e64 6566 6175 6c74 5f67 656f 6d5f 6d65  .default_geom_me
-000114a0: 7468 6f64 2e0a 0a20 2020 2020 2020 206f  thod...        o
-000114b0: 7269 6769 6e20 3a20 696e 742f 666c 6f61  rigin : int/floa
-000114c0: 742f 7475 706c 652c 2064 6566 6175 6c74  t/tuple, default
-000114d0: 3d4e 6f6e 650a 2020 2020 2020 2020 2020  =None.          
-000114e0: 2020 506f 696e 7420 7769 7468 2072 6573    Point with res
-000114f0: 7065 6374 2074 6f20 7768 6963 6820 6578  pect to which ex
-00011500: 7465 6e74 7320 6172 6520 746f 2062 6520  tents are to be 
-00011510: 6465 7465 726d 696e 6564 2e0a 2020 2020  determined..    
-00011520: 2020 2020 2020 2020 5468 6973 2063 616e          This can
-00011530: 2062 6520 616e 2069 6e74 6567 6572 206f   be an integer o
-00011540: 7220 666c 6f61 7420 7370 6563 6966 7969  r float specifyi
-00011550: 6e67 2074 6865 2070 6f69 6e74 2773 0a20  ng the point's. 
-00011560: 2020 2020 2020 2020 2020 2063 6f6f 7264             coord
-00011570: 696e 6174 6520 616c 6f6e 6720 6178 6973  inate along axis
-00011580: 203c 6178 3e3b 206f 7220 6974 2063 616e   <ax>; or it can
-00011590: 2062 6520 6120 7475 706c 6520 7370 6563   be a tuple spec
-000115a0: 6966 7969 6e67 0a20 2020 2020 2020 2020  ifying.         
-000115b0: 2020 2074 6865 2070 6f69 6e74 2773 2028     the point's (
-000115c0: 782c 2079 2c20 7a29 2063 6f6f 7264 696e  x, y, z) coordin
-000115d0: 6174 6573 2c20 7768 6572 6520 6f6e 6c79  ates, where only
-000115e0: 2074 6865 2063 6f6f 7264 696e 6174 650a   the coordinate.
-000115f0: 2020 2020 2020 2020 2020 2020 616c 6f6e              alon
-00011600: 6720 6178 6973 203c 6178 3e20 7769 6c6c  g axis <ax> will
-00011610: 2062 6520 636f 6e73 6964 6572 6564 2e20   be considered. 
-00011620: 2049 6620 4e6f 6e65 2c20 7468 6520 6f72   If None, the or
-00011630: 6967 696e 0a20 2020 2020 2020 2020 2020  igin.           
-00011640: 2063 6f6f 7264 696e 6174 6520 6973 2074   coordinate is t
-00011650: 616b 656e 2074 6f20 6265 2030 2e0a 2020  aken to be 0..  
-00011660: 2020 2020 2020 2222 220a 0a20 2020 2020        """..     
-00011670: 2020 2023 2047 6574 2064 6566 6175 6c74     # Get default
-00011680: 2073 6c69 6365 2061 6e64 206d 6574 686f   slice and metho
-00011690: 640a 2020 2020 2020 2020 7365 6c66 2e6c  d.        self.l
-000116a0: 6f61 6428 290a 2020 2020 2020 2020 6966  oad().        if
-000116b0: 206d 6574 686f 6420 6973 204e 6f6e 653a   method is None:
-000116c0: 0a20 2020 2020 2020 2020 2020 206d 6574  .            met
-000116d0: 686f 6420 3d20 7365 6c66 2e64 6566 6175  hod = self.defau
-000116e0: 6c74 5f67 656f 6d5f 6d65 7468 6f64 0a20  lt_geom_method. 
-000116f0: 2020 2020 2020 2069 6620 7369 6e67 6c65         if single
-00011700: 5f73 6c69 6365 3a0a 2020 2020 2020 2020  _slice:.        
-00011710: 2020 2020 6966 2069 6478 2069 7320 4e6f      if idx is No
-00011720: 6e65 2061 6e64 2073 6c20 6973 204e 6f6e  ne and sl is Non
-00011730: 6520 616e 6420 706f 7320 6973 204e 6f6e  e and pos is Non
-00011740: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-00011750: 2020 2069 6478 203d 2073 656c 662e 6765     idx = self.ge
-00011760: 745f 6d69 645f 6964 7828 290a 0a20 2020  t_mid_idx()..   
-00011770: 2020 2020 2023 2049 6620 7573 696e 6720       # If using 
-00011780: 7369 6e67 6c65 2073 6c69 6365 2c20 6368  single slice, ch
-00011790: 6563 6b20 7468 6520 6178 6973 206c 6965  eck the axis lie
-000117a0: 7320 616c 6f6e 6720 7468 6520 736c 6963  s along the slic
-000117b0: 650a 2020 2020 2020 2020 695f 6178 203d  e.        i_ax =
-000117c0: 2073 6b72 742e 696d 6167 652e 5f61 7865   skrt.image._axe
-000117d0: 732e 696e 6465 7828 6178 2920 6966 2069  s.index(ax) if i
-000117e0: 7369 6e73 7461 6e63 6528 6178 2c20 7374  sinstance(ax, st
-000117f0: 7229 2065 6c73 6520 6178 0a20 2020 2020  r) else ax.     
-00011800: 2020 2069 6620 7369 6e67 6c65 5f73 6c69     if single_sli
-00011810: 6365 3a0a 2020 2020 2020 2020 2020 2020  ce:.            
-00011820: 6966 2069 5f61 7820 6e6f 7420 696e 2073  if i_ax not in s
-00011830: 6b72 742e 696d 6167 652e 5f70 6c6f 745f  krt.image._plot_
-00011840: 6178 6573 5b76 6965 775d 3a0a 2020 2020  axes[view]:.    
-00011850: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-00011860: 6520 5275 6e74 696d 6545 7272 6f72 280a  e RuntimeError(.
-00011870: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011880: 2020 2020 6622 4361 6e6e 6f74 2063 6f6d      f"Cannot com
-00011890: 7075 7465 2065 7874 656e 7420 6f66 2061  pute extent of a
-000118a0: 7869 7320 7b61 787d 2069 6e20 7468 6520  xis {ax} in the 
-000118b0: 7b76 6965 777d 2070 6c61 6e65 2122 290a  {view} plane!").
-000118c0: 2020 2020 2020 2020 2020 2020 695f 6178              i_ax
-000118d0: 203d 2073 6b72 742e 696d 6167 652e 5f70   = skrt.image._p
-000118e0: 6c6f 745f 6178 6573 5b76 6965 775d 2e69  lot_axes[view].i
-000118f0: 6e64 6578 2869 5f61 7829 0a0a 2020 2020  ndex(i_ax)..    
-00011900: 2020 2020 2320 456e 7375 7265 2074 6861      # Ensure tha
-00011910: 7420 6f72 6967 696e 2069 7320 6120 7369  t origin is a si
-00011920: 6e67 6c65 206e 756d 6572 6963 2076 616c  ngle numeric val
-00011930: 7565 2e0a 2020 2020 2020 2020 6f72 6967  ue..        orig
-00011940: 696e 203d 206f 7269 6769 6e20 6f72 2030  in = origin or 0
-00011950: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
-00011960: 6973 696e 7374 616e 6365 286f 7269 6769  isinstance(origi
-00011970: 6e2c 2028 666c 6f61 742c 2069 6e74 2929  n, (float, int))
-00011980: 3a0a 2020 2020 2020 2020 2020 2020 6f72  :.            or
-00011990: 6967 696e 203d 206f 7269 6769 6e5b 695f  igin = origin[i_
-000119a0: 6178 5d0a 0a20 2020 2020 2020 2023 2043  ax]..        # C
-000119b0: 616c 6375 6c61 7465 2065 7874 656e 7420  alculate extent 
-000119c0: 6672 6f6d 2063 6f6e 746f 7572 730a 2020  from contours.  
-000119d0: 2020 2020 2020 6966 206d 6574 686f 6420        if method 
-000119e0: 3d3d 2022 636f 6e74 6f75 7222 3a0a 0a20  == "contour":.. 
-000119f0: 2020 2020 2020 2020 2020 2023 2043 616c             # Cal
-00011a00: 6375 6c61 7465 2066 756c 6c20 7a20 6578  culate full z ex
-00011a10: 7465 6e74 2066 726f 6d20 636f 6e74 6f75  tent from contou
-00011a20: 7220 706f 7369 7469 6f6e 730a 2020 2020  r positions.    
-00011a30: 2020 2020 2020 2020 6966 2028 6178 203d          if (ax =
-00011a40: 3d20 227a 2220 6f72 2061 7820 3d3d 2032  = "z" or ax == 2
-00011a50: 2920 616e 6420 6e6f 7420 7369 6e67 6c65  ) and not single
-00011a60: 5f73 6c69 6365 3a0a 2020 2020 2020 2020  _slice:.        
-00011a70: 2020 2020 2020 2020 7a5f 6b65 7973 203d          z_keys =
-00011a80: 206c 6973 7428 7365 6c66 2e67 6574 5f63   list(self.get_c
-00011a90: 6f6e 746f 7572 7328 2278 2d79 2229 2e6b  ontours("x-y").k
-00011aa0: 6579 7328 2929 0a20 2020 2020 2020 2020  eys()).         
-00011ab0: 2020 2020 2020 2076 7a20 3d20 7365 6c66         vz = self
-00011ac0: 2e67 6574 5f73 6c69 6365 5f74 6869 636b  .get_slice_thick
-00011ad0: 6e65 7373 5f63 6f6e 746f 7572 7328 290a  ness_contours().
-00011ae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011af0: 6966 207a 5f6b 6579 733a 0a20 2020 2020  if z_keys:.     
-00011b00: 2020 2020 2020 2020 2020 2020 2020 207a                 z
-00011b10: 5f6d 6178 203d 206d 6178 287a 5f6b 6579  _max = max(z_key
-00011b20: 7329 202b 2020 767a 202f 2032 0a20 2020  s) +  vz / 2.   
-00011b30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011b40: 207a 5f6d 696e 203d 206d 696e 287a 5f6b   z_min = min(z_k
-00011b50: 6579 7329 202d 2076 7a20 2f20 320a 2020  eys) - vz / 2.  
-00011b60: 2020 2020 2020 2020 2020 2020 2020 656c                el
-00011b70: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-00011b80: 2020 2020 2020 2020 7a5f 6d69 6e20 3d20          z_min = 
-00011b90: 4e6f 6e65 0a20 2020 2020 2020 2020 2020  None.           
-00011ba0: 2020 2020 2020 2020 207a 5f6d 6178 203d           z_max =
-00011bb0: 204e 6f6e 650a 2020 2020 2020 2020 2020   None.          
-00011bc0: 2020 2020 2020 7265 7475 726e 205b 7a5f        return [z_
-00011bd0: 6d69 6e2c 207a 5f6d 6178 5d0a 0a20 2020  min, z_max]..   
-00011be0: 2020 2020 2020 2020 2023 204f 7468 6572           # Other
-00011bf0: 7769 7365 2c20 6361 6c63 756c 6174 6520  wise, calculate 
-00011c00: 6578 7465 6e74 2066 726f 6d20 6d69 6e2f  extent from min/
-00011c10: 6d61 7820 636f 6e74 6f75 7220 706f 7369  max contour posi
-00011c20: 7469 6f6e 7320 0a20 2020 2020 2020 2020  tions .         
-00011c30: 2020 2070 6f69 6e74 7320 3d20 5b5d 0a0a     points = []..
-00011c40: 2020 2020 2020 2020 2020 2020 2320 476c              # Gl
-00011c50: 6f62 616c 3a20 7573 6520 6576 6572 7920  obal: use every 
-00011c60: 636f 6e74 6f75 720a 2020 2020 2020 2020  contour.        
-00011c70: 2020 2020 6966 206e 6f74 2073 696e 676c      if not singl
-00011c80: 655f 736c 6963 653a 0a20 2020 2020 2020  e_slice:.       
-00011c90: 2020 2020 2020 2020 2066 6f72 2069 2c20           for i, 
-00011ca0: 636f 6e74 6f75 7273 2069 6e20 7365 6c66  contours in self
-00011cb0: 2e67 6574 5f63 6f6e 746f 7572 7328 2278  .get_contours("x
-00011cc0: 2d79 2229 2e69 7465 6d73 2829 3a0a 2020  -y").items():.  
-00011cd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011ce0: 2020 666f 7220 636f 6e74 6f75 7220 696e    for contour in
-00011cf0: 2063 6f6e 746f 7572 733a 0a20 2020 2020   contours:.     
-00011d00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011d10: 2020 2070 6f69 6e74 732e 6578 7465 6e64     points.extend
-00011d20: 285b 705b 695f 6178 5d20 666f 7220 7020  ([p[i_ax] for p 
-00011d30: 696e 2063 6f6e 746f 7572 5d29 0a0a 2020  in contour])..  
-00011d40: 2020 2020 2020 2020 2020 2320 5369 6e67            # Sing
-00011d50: 6c65 2073 6c69 6365 3a20 6a75 7374 2075  le slice: just u
-00011d60: 7365 2074 6865 2063 6f6e 746f 7572 206f  se the contour o
-00011d70: 6e20 7468 6520 736c 6963 650a 2020 2020  n the slice.    
-00011d80: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-00011d90: 2020 2020 2020 2020 2020 2020 2020 666f                fo
-00011da0: 7220 636f 6e74 6f75 7220 696e 2073 656c  r contour in sel
-00011db0: 662e 6765 745f 636f 6e74 6f75 7273 5f6f  f.get_contours_o
-00011dc0: 6e5f 736c 6963 6528 0a20 2020 2020 2020  n_slice(.       
-00011dd0: 2020 2020 2020 2020 2020 2020 2076 6965               vie
-00011de0: 772c 2073 6c3d 736c 2c20 6964 783d 6964  w, sl=sl, idx=id
-00011df0: 782c 2070 6f73 3d70 6f73 293a 0a20 2020  x, pos=pos):.   
-00011e00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011e10: 2070 6f69 6e74 732e 6578 7465 6e64 285b   points.extend([
-00011e20: 705b 695f 6178 5d20 666f 7220 7020 696e  p[i_ax] for p in
-00011e30: 2063 6f6e 746f 7572 5d29 0a0a 2020 2020   contour])..    
-00011e40: 2020 2020 2020 2020 2320 5265 7475 726e          # Return
-00011e50: 206d 696e 2061 6e64 206d 6178 206f 6620   min and max of 
-00011e60: 7468 6520 706f 696e 7473 2069 6e20 7468  the points in th
-00011e70: 6520 636f 6e74 6f75 7228 7329 0a20 2020  e contour(s).   
-00011e80: 2020 2020 2020 2020 2069 6620 6c65 6e28           if len(
-00011e90: 706f 696e 7473 293a 0a20 2020 2020 2020  points):.       
-00011ea0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-00011eb0: 5b6d 696e 2870 6f69 6e74 7329 202d 206f  [min(points) - o
-00011ec0: 7269 6769 6e2c 206d 6178 2870 6f69 6e74  rigin, max(point
-00011ed0: 7329 202d 206f 7269 6769 6e5d 0a20 2020  s) - origin].   
-00011ee0: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
-00011ef0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00011f00: 6574 7572 6e20 5b4e 6f6e 652c 204e 6f6e  eturn [None, Non
-00011f10: 655d 0a0a 2020 2020 2020 2020 2320 4f74  e]..        # Ot
-00011f20: 6865 7277 6973 652c 2067 6574 2065 7874  herwise, get ext
-00011f30: 656e 7420 6672 6f6d 206d 6173 6b0a 2020  ent from mask.  
-00011f40: 2020 2020 2020 7365 6c66 2e63 7265 6174        self.creat
-00011f50: 655f 6d61 736b 2829 0a20 2020 2020 2020  e_mask().       
-00011f60: 2069 6620 695f 6178 2021 3d20 323a 2020   if i_ax != 2:  
-00011f70: 2320 5472 616e 7370 6f73 6520 782d 7920  # Transpose x-y 
-00011f80: 6178 6573 0a20 2020 2020 2020 2020 2020  axes.           
-00011f90: 2069 5f61 7820 3d20 3120 2d20 695f 6178   i_ax = 1 - i_ax
-00011fa0: 0a0a 2020 2020 2020 2020 2320 4765 7420  ..        # Get 
-00011fb0: 706f 7369 7469 6f6e 7320 6f66 2076 6f78  positions of vox
-00011fc0: 656c 7320 696e 7369 6465 2074 6865 206d  els inside the m
-00011fd0: 6173 6b0a 2020 2020 2020 2020 6966 206e  ask.        if n
-00011fe0: 6f74 2073 696e 676c 655f 736c 6963 653a  ot single_slice:
-00011ff0: 0a20 2020 2020 2020 2020 2020 206e 6f6e  .            non
-00012000: 7a65 726f 203d 206e 702e 6172 6777 6865  zero = np.argwhe
-00012010: 7265 2873 656c 662e 6765 745f 6d61 736b  re(self.get_mask
-00012020: 2873 7461 6e64 6172 6469 7365 3d54 7275  (standardise=Tru
-00012030: 6529 290a 2020 2020 2020 2020 656c 7365  e)).        else
-00012040: 3a0a 2020 2020 2020 2020 2020 2020 6e6f  :.            no
-00012050: 6e7a 6572 6f20 3d20 6e70 2e61 7267 7768  nzero = np.argwh
-00012060: 6572 6528 7365 6c66 2e67 6574 5f73 6c69  ere(self.get_sli
-00012070: 6365 280a 2020 2020 2020 2020 2020 2020  ce(.            
-00012080: 2020 2020 7669 6577 2c20 736c 3d73 6c2c      view, sl=sl,
-00012090: 2069 6478 3d69 6478 2c20 706f 733d 706f   idx=idx, pos=po
-000120a0: 7329 290a 2020 2020 2020 2020 7661 6c73  s)).        vals
-000120b0: 203d 206e 6f6e 7a65 726f 5b3a 2c20 695f   = nonzero[:, i_
-000120c0: 6178 5d0a 2020 2020 2020 2020 6966 206e  ax].        if n
-000120d0: 6f74 206c 656e 2876 616c 7329 3a0a 2020  ot len(vals):.  
-000120e0: 2020 2020 2020 2020 2020 7265 7475 726e            return
-000120f0: 205b 4e6f 6e65 2c20 4e6f 6e65 5d0a 0a20   [None, None].. 
-00012100: 2020 2020 2020 2023 2046 696e 6420 6d69         # Find mi
-00012110: 6e20 616e 6420 6d61 7820 766f 7865 6c73  n and max voxels
-00012120: 3b20 6164 6420 6861 6c66 2061 2076 6f78  ; add half a vox
-00012130: 656c 2065 6974 6865 7220 7369 6465 2074  el either side t
-00012140: 6f20 6765 7420 0a20 2020 2020 2020 2023  o get .        #
-00012150: 2066 756c 6c20 6578 7465 6e74 0a20 2020   full extent.   
-00012160: 2020 2020 206d 696e 5f70 6f73 203d 206d       min_pos = m
-00012170: 696e 2876 616c 7329 202d 2030 2e35 0a20  in(vals) - 0.5. 
-00012180: 2020 2020 2020 206d 6178 5f70 6f73 203d         max_pos =
-00012190: 206d 6178 2876 616c 7329 202b 2030 2e35   max(vals) + 0.5
-000121a0: 0a0a 2020 2020 2020 2020 2320 436f 6e76  ..        # Conv
-000121b0: 6572 7420 706f 7369 7469 6f6e 7320 746f  ert positions to
-000121c0: 206d 6d0a 2020 2020 2020 2020 7265 7475   mm.        retu
-000121d0: 726e 205b 7365 6c66 2e69 6478 5f74 6f5f  rn [self.idx_to_
-000121e0: 706f 7328 6d69 6e5f 706f 732c 2061 7829  pos(min_pos, ax)
-000121f0: 202d 206f 7269 6769 6e2c 0a20 2020 2020   - origin,.     
-00012200: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00012210: 6964 785f 746f 5f70 6f73 286d 6178 5f70  idx_to_pos(max_p
-00012220: 6f73 2c20 6178 2920 2d20 6f72 6967 696e  os, ax) - origin
-00012230: 5d0a 0a20 2020 2064 6566 2067 6574 5f63  ]..    def get_c
-00012240: 726f 705f 6c69 6d69 7473 2873 656c 662c  rop_limits(self,
-00012250: 2063 726f 705f 6d61 7267 696e 733d 4e6f   crop_margins=No
-00012260: 6e65 2c20 6d65 7468 6f64 3d4e 6f6e 6529  ne, method=None)
-00012270: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
-00012280: 2020 2020 2020 4765 7420 6372 6f70 206c        Get crop l
-00012290: 696d 6974 7320 636f 7272 6573 706f 6e64  imits correspond
-000122a0: 696e 6720 746f 2052 4f49 2065 7874 656e  ing to ROI exten
-000122b0: 7473 2070 6c75 7320 6d61 7267 696e 732e  ts plus margins.
-000122c0: 0a0a 2020 2020 2020 2020 5468 6520 7475  ..        The tu
-000122d0: 706c 6573 206f 6620 6c69 6d69 7473 2072  ples of limits r
-000122e0: 6574 7572 6e65 642c 2069 6e20 7468 6520  eturned, in the 
-000122f0: 6f72 6465 7220 2878 2c20 792c 207a 2920  order (x, y, z) 
-00012300: 6361 6e0a 2020 2020 2020 2020 6265 2075  can.        be u
-00012310: 7365 642c 2066 6f72 2065 7861 6d70 6c65  sed, for example
-00012320: 2c20 6173 2069 6e70 7574 7320 746f 2073  , as inputs to s
-00012330: 6b72 742e 696d 6167 652e 496d 6167 652e  krt.image.Image.
-00012340: 6372 6f70 2829 2e0a 0a20 2020 2020 2020  crop()...       
-00012350: 2054 6869 7320 6d65 7468 6f64 2069 7320   This method is 
-00012360: 7369 6d69 6c61 7220 746f 2074 6865 206d  similar to the m
-00012370: 6574 686f 6420 6765 745f 6578 7465 6e74  ethod get_extent
-00012380: 7328 292c 2062 7574 2061 6c6c 6f77 730a  s(), but allows.
-00012390: 2020 2020 2020 2020 6469 6666 6572 656e          differen
-000123a0: 7420 6d61 7267 696e 7320 6f6e 2065 6163  t margins on eac
-000123b0: 6820 7369 6465 206f 6620 7468 6520 524f  h side of the RO
-000123c0: 492e 0a0a 2020 2020 2020 2020 2a2a 5061  I...        **Pa
-000123d0: 7261 6d65 7465 7273 3a2a 2a0a 0a20 2020  rameters:**..   
-000123e0: 2020 2020 2063 726f 705f 6d61 7267 696e       crop_margin
-000123f0: 7320 3a20 666c 6f61 742f 7475 706c 652c  s : float/tuple,
-00012400: 2064 6566 6175 6c74 3d4e 6f6e 650a 2020   default=None.  
-00012410: 2020 2020 2020 2020 2020 466c 6f61 7420            Float 
-00012420: 6f72 2074 6872 6565 2d65 6c65 6d65 6e74  or three-element
-00012430: 2074 7570 6c65 2073 7065 6369 6679 696e   tuple specifyin
-00012440: 6720 7468 6520 6d61 7267 696e 732c 2069  g the margins, i
-00012450: 6e20 6d6d 2c0a 2020 2020 2020 2020 2020  n mm,.          
-00012460: 2020 746f 2062 6520 6164 6465 6420 746f    to be added to
-00012470: 2052 4f49 2065 7874 656e 7473 2e20 2049   ROI extents.  I
-00012480: 6620 6120 666c 6f61 742c 206d 696e 7573  f a float, minus
-00012490: 2061 6e64 2070 6c75 7320 7468 650a 2020   and plus the.  
-000124a0: 2020 2020 2020 2020 2020 7661 6c75 6520            value 
-000124b0: 7370 6563 6966 6965 6420 6172 6520 6164  specified are ad
-000124c0: 6465 6420 746f 206c 6f77 6572 2061 6e64  ded to lower and
-000124d0: 2075 7070 6572 2065 7874 656e 7473 2072   upper extents r
-000124e0: 6573 7065 6374 6976 656c 790a 2020 2020  espectively.    
-000124f0: 2020 2020 2020 2020 616c 6f6e 6720 6561          along ea
-00012500: 6368 2061 7869 732e 2020 4966 2061 2074  ch axis.  If a t
-00012510: 6872 6565 2d65 6c65 6d65 6e74 2074 7570  hree-element tup
-00012520: 6c65 2c20 656c 656d 656e 7473 2061 7265  le, elements are
-00012530: 0a20 2020 2020 2020 2020 2020 2074 616b  .            tak
-00012540: 656e 2074 6f20 7370 6563 6966 7920 6d61  en to specify ma
-00012550: 7267 696e 7320 696e 2074 6865 206f 7264  rgins in the ord
-00012560: 6572 2028 782c 2079 2c20 7a29 2e20 2045  er (x, y, z).  E
-00012570: 6c65 6d65 6e74 730a 2020 2020 2020 2020  lements.        
-00012580: 2020 2020 6361 6e20 6265 2065 6974 6865      can be eithe
-00012590: 7220 666c 6f61 7473 2028 6d69 6e75 7320  r floats (minus 
-000125a0: 616e 6420 706c 7573 2074 6865 2076 616c  and plus the val
-000125b0: 7565 2061 6464 6564 2072 6573 7065 6374  ue added respect
-000125c0: 6976 656c 790a 2020 2020 2020 2020 2020  ively.          
-000125d0: 2020 746f 206c 6f77 6572 2061 6e64 2075    to lower and u
-000125e0: 7070 6572 2065 7874 656e 7473 2920 6f72  pper extents) or
-000125f0: 2074 776f 2d65 6c65 6d65 6e74 2074 7570   two-element tup
-00012600: 6c65 7320 2865 6c65 6d65 6e74 7320 3020  les (elements 0 
-00012610: 616e 6420 310a 2020 2020 2020 2020 2020  and 1.          
-00012620: 2020 6164 6465 6420 7265 7370 6563 7469    added respecti
-00012630: 7665 6c79 2074 6f20 6c6f 7765 7220 616e  vely to lower an
-00012640: 6420 7570 7065 7220 6578 7465 6e74 7329  d upper extents)
-00012650: 2e0a 0a20 2020 2020 2020 206d 6574 686f  ...        metho
-00012660: 6420 3a20 7374 722c 2064 6566 6175 6c74  d : str, default
-00012670: 3d4e 6f6e 650a 2020 2020 2020 2020 2020  =None.          
-00012680: 2020 4d65 7468 6f64 2074 6f20 7573 6520    Method to use 
-00012690: 666f 7220 6578 7465 6e74 2063 616c 6375  for extent calcu
-000126a0: 6c61 7469 6f6e 2e20 4361 6e20 6265 3a0a  lation. Can be:.
-000126b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000126c0: 202a 2022 636f 6e74 6f75 7222 3a20 6765   * "contour": ge
-000126d0: 7420 6578 7465 6e74 2066 726f 6d20 6d69  t extent from mi
-000126e0: 6e2f 6d61 7820 706f 7369 7469 6f6e 7320  n/max positions 
-000126f0: 6f66 2063 6f6e 746f 7572 2873 292e 0a20  of contour(s).. 
-00012700: 2020 2020 2020 2020 2020 2020 2020 202a                 *
-00012710: 2022 6d61 736b 223a 2067 6574 2065 7874   "mask": get ext
-00012720: 656e 7420 6672 6f6d 206d 696e 2f6d 6178  ent from min/max
-00012730: 2070 6f73 6974 696f 6e73 206f 6620 766f   positions of vo
-00012740: 7865 6c73 2069 6e20 7468 650a 2020 2020  xels in the.    
-00012750: 2020 2020 2020 2020 2020 2020 2020 6269                bi
-00012760: 6e61 7279 206d 6173 6b2e 0a20 2020 2020  nary mask..     
-00012770: 2020 2020 2020 2020 2020 202a 204e 6f6e             * Non
-00012780: 653a 2075 7365 2074 6865 206d 6574 686f  e: use the metho
-00012790: 6420 7365 7420 696e 2073 656c 662e 6465  d set in self.de
-000127a0: 6661 756c 745f 6765 6f6d 5f6d 6574 686f  fault_geom_metho
-000127b0: 642e 0a20 2020 2020 2020 2022 2222 0a20  d..        """. 
-000127c0: 2020 2020 2020 2063 726f 705f 6c69 6d69         crop_limi
-000127d0: 7473 203d 2073 656c 662e 6765 745f 6578  ts = self.get_ex
-000127e0: 7465 6e74 7328 6d65 7468 6f64 3d6d 6574  tents(method=met
-000127f0: 686f 6429 0a20 2020 2020 2020 206d 6172  hod).        mar
-00012800: 6769 6e73 203d 2073 6b72 742e 696d 6167  gins = skrt.imag
-00012810: 652e 6368 6563 6b65 645f 6372 6f70 5f6c  e.checked_crop_l
-00012820: 696d 6974 7328 6372 6f70 5f6d 6172 6769  imits(crop_margi
-00012830: 6e73 290a 2020 2020 2020 2020 666f 7220  ns).        for 
-00012840: 6964 7831 2069 6e20 7261 6e67 6528 3329  idx1 in range(3)
-00012850: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
-00012860: 206d 6172 6769 6e73 5b69 6478 315d 2069   margins[idx1] i
-00012870: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
-00012880: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-00012890: 6964 7832 2069 6e20 7261 6e67 6528 3229  idx2 in range(2)
-000128a0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000128b0: 2020 2020 2020 6372 6f70 5f6c 696d 6974        crop_limit
-000128c0: 735b 6964 7831 5d5b 6964 7832 5d20 2b3d  s[idx1][idx2] +=
-000128d0: 206d 6172 6769 6e73 5b69 6478 315d 5b69   margins[idx1][i
-000128e0: 6478 325d 0a0a 2020 2020 2020 2020 7265  dx2]..        re
-000128f0: 7475 726e 2063 726f 705f 6c69 6d69 7473  turn crop_limits
-00012900: 0a0a 2020 2020 6465 6620 6765 745f 6c65  ..    def get_le
-00012910: 6e67 7468 280a 2020 2020 2020 2020 7365  ngth(.        se
-00012920: 6c66 2c20 0a20 2020 2020 2020 2061 783d  lf, .        ax=
-00012930: 227a 222c 200a 2020 2020 2020 2020 7369  "z", .        si
-00012940: 6e67 6c65 5f73 6c69 6365 3d46 616c 7365  ngle_slice=False
-00012950: 2c0a 2020 2020 2020 2020 7669 6577 3d22  ,.        view="
-00012960: 782d 7922 2c0a 2020 2020 2020 2020 736c  x-y",.        sl
-00012970: 3d4e 6f6e 652c 200a 2020 2020 2020 2020  =None, .        
-00012980: 6964 783d 4e6f 6e65 2c20 0a20 2020 2020  idx=None, .     
-00012990: 2020 2070 6f73 3d4e 6f6e 652c 200a 2020     pos=None, .  
-000129a0: 2020 2020 2020 756e 6974 733d 226d 6d22        units="mm"
-000129b0: 2c0a 2020 2020 2020 2020 6d65 7468 6f64  ,.        method
-000129c0: 3d4e 6f6e 652c 200a 2020 2020 2020 2020  =None, .        
-000129d0: 666f 7263 653d 5472 7565 0a20 2020 2029  force=True.    )
-000129e0: 3a0a 2020 2020 2020 2020 2222 2247 6574  :.        """Get
-000129f0: 2052 4f49 206c 656e 6774 6820 616c 6f6e   ROI length alon
-00012a00: 6720 6120 6769 7665 6e20 6178 6973 2e20  g a given axis. 
-00012a10: 4966 2073 696e 676c 655f 736c 6963 653d  If single_slice=
-00012a20: 4661 6c73 6520 2869 2e65 2e20 6120 0a20  False (i.e. a . 
-00012a30: 2020 2020 2020 2067 6c6f 6261 6c20 6c65         global le
-00012a40: 6e67 7468 2069 7320 7265 7175 6573 7465  ngth is requeste
-00012a50: 6429 2c20 6361 6c63 756c 6174 6564 206c  d), calculated l
-00012a60: 656e 6774 6820 7769 6c6c 2062 6520 6361  ength will be ca
-00012a70: 6368 6564 2069 6e20 0a20 2020 2020 2020  ched in .       
-00012a80: 2073 656c 662e 5f6c 656e 6774 685b 6178   self._length[ax
-00012a90: 5d5b 756e 6974 735d 2061 6e64 2072 6574  ][units] and ret
-00012aa0: 7572 6e65 6420 6966 2063 616c 6c65 6420  urned if called 
-00012ab0: 6167 6169 6e2c 2075 6e6c 6573 7320 666f  again, unless fo
-00012ac0: 7263 653d 5472 7565 2e0a 0a20 2020 2020  rce=True...     
-00012ad0: 2020 202a 2a50 6172 616d 6574 6572 733a     **Parameters:
-00012ae0: 2a2a 0a20 2020 2020 2020 200a 2020 2020  **.        .    
-00012af0: 2020 2020 6178 203a 2073 7472 2f69 6e74      ax : str/int
-00012b00: 2c20 6465 6661 756c 743d 227a 220a 2020  , default="z".  
-00012b10: 2020 2020 2020 2020 2020 4178 6973 2061            Axis a
-00012b20: 6c6f 6e67 2077 6869 6368 2074 6f20 7265  long which to re
-00012b30: 7475 726e 206c 656e 6774 683b 2073 686f  turn length; sho
-00012b40: 756c 6420 6265 206f 6e65 206f 6620 5b22  uld be one of ["
-00012b50: 7822 2c20 2279 222c 2022 7a22 5d0a 2020  x", "y", "z"].  
-00012b60: 2020 2020 2020 2020 2020 6f72 205b 302c            or [0,
-00012b70: 2031 2c20 325d 2e0a 0a20 2020 2020 2020   1, 2]...       
-00012b80: 2073 696e 676c 655f 736c 6963 6520 3a20   single_slice : 
-00012b90: 626f 6f6c 2c20 6465 6661 756c 743d 4661  bool, default=Fa
-00012ba0: 6c73 650a 2020 2020 2020 2020 2020 2020  lse.            
-00012bb0: 4966 2046 616c 7365 2c20 7468 6520 6c65  If False, the le
-00012bc0: 6e67 7468 206f 6620 7468 6520 656e 7469  ngth of the enti
-00012bd0: 7265 2052 4f49 2077 696c 6c20 6265 2072  re ROI will be r
-00012be0: 6574 7572 6e65 643b 0a20 2020 2020 2020  eturned;.       
-00012bf0: 2020 2020 206f 7468 6572 7769 7365 2c20       otherwise, 
-00012c00: 7468 6520 6c65 6e67 7468 206f 6e20 6120  the length on a 
-00012c10: 7369 6e67 6c65 2073 6c69 6365 2077 696c  single slice wil
-00012c20: 6c20 6265 2072 6574 7572 6e65 642e 0a0a  l be returned...
-00012c30: 2020 2020 2020 2020 7669 6577 203a 2073          view : s
-00012c40: 7472 2c20 6465 6661 756c 743d 2278 2d79  tr, default="x-y
-00012c50: 220a 2020 2020 2020 2020 2020 2020 4f72  ".            Or
-00012c60: 6965 6e74 6174 696f 6e20 6f66 2073 6c69  ientation of sli
-00012c70: 6365 206f 6e20 7768 6963 6820 746f 2067  ce on which to g
-00012c80: 6574 206c 656e 6774 682e 204f 6e6c 7920  et length. Only 
-00012c90: 7573 6564 2069 6620 0a20 2020 2020 2020  used if .       
-00012ca0: 2020 2020 2073 696e 676c 655f 736c 6963       single_slic
-00012cb0: 653d 5472 7565 2e20 4966 2075 7369 6e67  e=True. If using
-00012cc0: 2c20 3c61 783e 206d 7573 7420 6265 2061  , <ax> must be a
-00012cd0: 6e20 6178 6973 2074 6861 7420 6c69 6573  n axis that lies
-00012ce0: 2061 6c6f 6e67 0a20 2020 2020 2020 2020   along.         
-00012cf0: 2020 2074 6865 2073 6c69 6365 2069 6e20     the slice in 
-00012d00: 7468 6973 206f 7269 656e 7461 7469 6f6e  this orientation
-00012d10: 2e0a 0a20 2020 2020 2020 2073 6c20 3a20  ...        sl : 
-00012d20: 696e 742c 2064 6566 6175 6c74 3d4e 6f6e  int, default=Non
-00012d30: 650a 2020 2020 2020 2020 2020 2020 536c  e.            Sl
-00012d40: 6963 6520 6e75 6d62 6572 2e20 4966 206e  ice number. If n
-00012d50: 6f6e 6520 6f66 203c 736c 3e2c 203c 6964  one of <sl>, <id
-00012d60: 783e 206f 7220 3c70 6f73 3e20 6172 6520  x> or <pos> are 
-00012d70: 7375 7070 6c69 6564 2062 7574 0a20 2020  supplied but.   
-00012d80: 2020 2020 2020 2020 203c 7369 6e67 6c65           <single
-00012d90: 5f73 6c69 6365 3e20 6973 2054 7275 652c  _slice> is True,
-00012da0: 2074 6865 2063 656e 7472 616c 2073 6c69   the central sli
-00012db0: 6365 206f 6620 7468 6520 524f 4920 7769  ce of the ROI wi
-00012dc0: 6c6c 2062 6520 7573 6564 2e0a 0a20 2020  ll be used...   
-00012dd0: 2020 2020 2069 6478 203a 2069 6e74 2c20       idx : int, 
-00012de0: 6465 6661 756c 743d 4e6f 6e65 0a20 2020  default=None.   
-00012df0: 2020 2020 2020 2020 2041 7272 6179 2069           Array i
-00012e00: 6e64 6578 206f 6620 736c 6963 652e 2049  ndex of slice. I
-00012e10: 6620 6e6f 6e65 206f 6620 3c73 6c3e 2c20  f none of <sl>, 
-00012e20: 3c69 6478 3e20 6f72 203c 706f 733e 2061  <idx> or <pos> a
-00012e30: 7265 2073 7570 706c 6965 6420 6275 740a  re supplied but.
-00012e40: 2020 2020 2020 2020 2020 2020 3c73 696e              <sin
-00012e50: 676c 655f 736c 6963 653e 2069 7320 5472  gle_slice> is Tr
-00012e60: 7565 2c20 7468 6520 6365 6e74 7261 6c20  ue, the central 
-00012e70: 736c 6963 6520 6f66 2074 6865 2052 4f49  slice of the ROI
-00012e80: 2077 696c 6c20 6265 2075 7365 642e 0a0a   will be used...
-00012e90: 2020 2020 2020 2020 706f 7320 3a20 666c          pos : fl
-00012ea0: 6f61 742c 2064 6566 6175 6c74 3d4e 6f6e  oat, default=Non
-00012eb0: 650a 2020 2020 2020 2020 2020 2020 536c  e.            Sl
-00012ec0: 6963 6520 706f 7369 7469 6f6e 2069 6e20  ice position in 
-00012ed0: 6d6d 2e20 4966 206e 6f6e 6520 6f66 203c  mm. If none of <
-00012ee0: 736c 3e2c 203c 6964 783e 206f 7220 3c70  sl>, <idx> or <p
-00012ef0: 6f73 3e20 6172 6520 7375 7070 6c69 6564  os> are supplied
-00012f00: 2062 7574 0a20 2020 2020 2020 2020 2020   but.           
-00012f10: 203c 7369 6e67 6c65 5f73 6c69 6365 3e20   <single_slice> 
-00012f20: 6973 2054 7275 652c 2074 6865 2063 656e  is True, the cen
-00012f30: 7472 616c 2073 6c69 6365 206f 6620 7468  tral slice of th
-00012f40: 6520 524f 4920 7769 6c6c 2062 6520 7573  e ROI will be us
-00012f50: 6564 2e0a 0a20 2020 2020 2020 2075 6e69  ed...        uni
-00012f60: 7473 203a 2073 7472 2c20 6465 6661 756c  ts : str, defaul
-00012f70: 743d 226d 6d22 0a20 2020 2020 2020 2020  t="mm".         
-00012f80: 2020 2055 6e69 7473 206f 6620 6c65 6e67     Units of leng
-00012f90: 7468 2e20 4361 6e20 6265 2065 6974 6865  th. Can be eithe
-00012fa0: 7220 6f66 3a0a 2020 2020 2020 2020 2020  r of:.          
-00012fb0: 2020 2020 2020 2d20 226d 6d22 3a20 7265        - "mm": re
-00012fc0: 7475 726e 206c 656e 6774 6820 696e 206d  turn length in m
-00012fd0: 696c 6c69 6d65 7472 6573 2e0a 2020 2020  illimetres..    
-00012fe0: 2020 2020 2020 2020 2020 2020 2d20 2276              - "v
-00012ff0: 6f78 656c 7322 3a20 7265 7475 726e 206c  oxels": return l
-00013000: 656e 6774 6820 696e 206e 756d 6265 7220  ength in number 
-00013010: 6f66 2076 6f78 656c 732e 0a0a 2020 2020  of voxels...    
-00013020: 2020 2020 2020 2020 4966 2075 6e69 7473          If units
-00013030: 3d22 766f 7865 6c73 2220 6973 2072 6571  ="voxels" is req
-00013040: 7565 7374 6564 2062 7574 2074 6869 7320  uested but this 
-00013050: 524f 4920 6f6e 6c79 2068 6173 2063 6f6e  ROI only has con
-00013060: 746f 7572 7320 616e 6420 6e6f 0a20 2020  tours and no.   
-00013070: 2020 2020 2020 2020 2076 6f78 656c 2073           voxel s
-00013080: 697a 6520 696e 666f 726d 6174 696f 6e2c  ize information,
-00013090: 2061 6e20 6572 726f 7220 7769 6c6c 2062   an error will b
-000130a0: 6520 7261 6973 6564 2028 756e 6c65 7373  e raised (unless
-000130b0: 2061 783d 227a 222c 200a 2020 2020 2020   ax="z", .      
-000130c0: 2020 2020 2020 696e 2077 6869 6368 2063        in which c
-000130d0: 6173 6520 766f 7865 6c20 7369 7a65 2077  ase voxel size w
-000130e0: 696c 6c20 6265 2069 6e66 6572 7265 6420  ill be inferred 
-000130f0: 6672 6f6d 2073 7061 6369 6e67 2062 6574  from spacing bet
-00013100: 7765 656e 0a20 2020 2020 2020 2020 2020  ween.           
-00013110: 2073 6c69 6365 7329 2e0a 0a20 2020 2020   slices)...     
-00013120: 2020 206d 6574 686f 6420 3a20 7374 722c     method : str,
-00013130: 2064 6566 6175 6c74 3d4e 6f6e 650a 2020   default=None.  
-00013140: 2020 2020 2020 2020 2020 4d65 7468 6f64            Method
-00013150: 2074 6f20 7573 6520 666f 7220 6c65 6e67   to use for leng
-00013160: 7468 2063 616c 6375 6c61 7469 6f6e 2e20  th calculation. 
-00013170: 4361 6e20 6265 3a20 0a20 2020 2020 2020  Can be: .       
-00013180: 2020 2020 2020 2020 202d 2022 636f 6e74           - "cont
-00013190: 6f75 7222 3a20 6765 7420 6c65 6e67 7468  our": get length
-000131a0: 2066 726f 6d20 6d69 6e2f 6d61 7820 706f   from min/max po
-000131b0: 7369 7469 6f6e 7320 6f66 2063 6f6e 746f  sitions of conto
-000131c0: 7572 2873 292e 0a20 2020 2020 2020 2020  ur(s)..         
-000131d0: 2020 2020 2020 202d 2022 6d61 736b 223a         - "mask":
-000131e0: 2067 6574 206c 656e 6774 6820 6672 6f6d   get length from
-000131f0: 206d 696e 2f6d 6178 2070 6f73 6974 696f   min/max positio
-00013200: 6e73 206f 6620 766f 7865 6c73 2069 6e20  ns of voxels in 
-00013210: 7468 6520 0a20 2020 2020 2020 2020 2020  the .           
-00013220: 2020 2020 2020 2062 696e 6172 7920 6d61         binary ma
-00013230: 736b 2e0a 2020 2020 2020 2020 2020 2020  sk..            
-00013240: 2020 2020 2d20 4e6f 6e65 3a20 7573 6520      - None: use 
-00013250: 7468 6520 6d65 7468 6f64 2073 6574 2069  the method set i
-00013260: 6e20 7365 6c66 2e64 6566 6175 6c74 5f67  n self.default_g
-00013270: 656f 6d5f 6d65 7468 6f64 2e0a 0a20 2020  eom_method...   
-00013280: 2020 2020 2066 6f72 6365 203a 2062 6f6f       force : boo
-00013290: 6c2c 2064 6566 6175 6c74 3d54 7275 650a  l, default=True.
-000132a0: 2020 2020 2020 2020 2020 2020 4966 2054              If T
-000132b0: 7275 652c 2074 6865 206c 656e 6774 6820  rue, the length 
-000132c0: 7769 6c6c 2061 6c77 6179 7320 6265 2072  will always be r
-000132d0: 6563 616c 6375 6c61 7465 643b 206f 7468  ecalculated; oth
-000132e0: 6572 7769 7365 2c20 6974 2077 696c 6c0a  erwise, it will.
-000132f0: 2020 2020 2020 2020 2020 2020 6f6e 6c79              only
-00013300: 2062 6520 6361 6c63 756c 6174 6564 2069   be calculated i
-00013310: 6620 6974 2068 6173 206e 6f74 2079 6574  f it has not yet
-00013320: 2062 6565 6e20 6361 6368 6564 2069 6e20   been cached in 
-00013330: 7365 6c66 2e5f 766f 6c75 6d65 2e0a 2020  self._volume..  
-00013340: 2020 2020 2020 2020 2020 4e6f 7465 2074            Note t
-00013350: 6861 7420 6966 2073 696e 676c 655f 736c  hat if single_sl
-00013360: 6963 653d 5472 7565 2c20 7468 6520 6c65  ice=True, the le
-00013370: 6e67 7468 2077 696c 6c20 616c 7761 7973  ngth will always
-00013380: 2062 6520 0a20 2020 2020 2020 2020 2020   be .           
-00013390: 2072 6563 616c 6375 6c61 7465 642e 0a20   recalculated.. 
-000133a0: 2020 2020 2020 2022 2222 0a0a 2020 2020         """..    
-000133b0: 2020 2020 2320 4966 2067 6c6f 6261 6c20      # If global 
-000133c0: 6c65 6e67 7468 2061 6c72 6561 6479 2063  length already c
-000133d0: 6163 6865 642c 2072 6574 7572 6e20 6361  ached, return ca
-000133e0: 6368 6564 2076 616c 7565 0a20 2020 2020  ched value.     
-000133f0: 2020 2069 6620 6e6f 7420 7369 6e67 6c65     if not single
-00013400: 5f73 6c69 6365 2061 6e64 206e 6f74 2066  _slice and not f
-00013410: 6f72 6365 3a0a 2020 2020 2020 2020 2020  orce:.          
-00013420: 2020 6966 2068 6173 6174 7472 2873 656c    if hasattr(sel
-00013430: 662c 2022 5f6c 656e 6774 6822 2920 616e  f, "_length") an
-00013440: 6420 6178 2069 6e20 7365 6c66 2e5f 6c65  d ax in self._le
-00013450: 6e67 7468 205c 0a20 2020 2020 2020 2020  ngth \.         
-00013460: 2020 2020 2020 616e 6420 756e 6974 7320        and units 
-00013470: 696e 2073 656c 662e 5f6c 656e 6774 685b  in self._length[
-00013480: 6178 5d3a 0a20 2020 2020 2020 2020 2020  ax]:.           
-00013490: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
-000134a0: 2e5f 6c65 6e67 7468 5b61 785d 5b75 6e69  ._length[ax][uni
-000134b0: 7473 5d0a 0a20 2020 2020 2020 2023 2049  ts]..        # I
-000134c0: 6620 7369 6e67 6c65 2073 6c69 6365 2072  f single slice r
-000134d0: 6571 7565 7374 6564 2061 6e64 206e 6f74  equested and not
-000134e0: 206f 6e20 6375 7272 656e 7420 736c 6963   on current slic
-000134f0: 652c 2072 6574 7572 6e20 4e6f 6e65 0a20  e, return None. 
-00013500: 2020 2020 2020 2069 6620 7369 6e67 6c65         if single
-00013510: 5f73 6c69 6365 2061 6e64 206e 6f74 2073  _slice and not s
-00013520: 656c 662e 6f6e 5f73 6c69 6365 2876 6965  elf.on_slice(vie
-00013530: 772c 2073 6c3d 736c 2c20 6964 783d 6964  w, sl=sl, idx=id
-00013540: 782c 2070 6f73 3d70 6f73 293a 0a20 2020  x, pos=pos):.   
-00013550: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-00013560: 4e6f 6e65 0a0a 2020 2020 2020 2020 2320  None..        # 
-00013570: 4765 7420 6c65 6e67 7468 2069 6e20 6d6d  Get length in mm
-00013580: 2066 726f 6d20 6d69 6e20 616e 6420 6d61   from min and ma
-00013590: 7820 706f 7369 7469 6f6e 730a 2020 2020  x positions.    
-000135a0: 2020 2020 7365 6c66 2e6c 6f61 6428 290a      self.load().
-000135b0: 2020 2020 2020 2020 6d69 6e5f 706f 732c          min_pos,
-000135c0: 206d 6178 5f70 6f73 203d 2073 656c 662e   max_pos = self.
-000135d0: 6765 745f 6578 7465 6e74 280a 2020 2020  get_extent(.    
-000135e0: 2020 2020 2020 2020 6178 3d61 782c 200a          ax=ax, .
-000135f0: 2020 2020 2020 2020 2020 2020 7369 6e67              sing
-00013600: 6c65 5f73 6c69 6365 3d73 696e 676c 655f  le_slice=single_
-00013610: 736c 6963 652c 0a20 2020 2020 2020 2020  slice,.         
-00013620: 2020 2076 6965 773d 7669 6577 2c0a 2020     view=view,.  
-00013630: 2020 2020 2020 2020 2020 736c 3d73 6c2c            sl=sl,
-00013640: 0a20 2020 2020 2020 2020 2020 2069 6478  .            idx
-00013650: 3d69 6478 2c0a 2020 2020 2020 2020 2020  =idx,.          
-00013660: 2020 706f 733d 706f 732c 0a20 2020 2020    pos=pos,.     
-00013670: 2020 2020 2020 206d 6574 686f 643d 6d65         method=me
-00013680: 7468 6f64 0a20 2020 2020 2020 2029 0a20  thod.        ). 
-00013690: 2020 2020 2020 206c 656e 6774 6820 3d20         length = 
-000136a0: 7b0a 2020 2020 2020 2020 2020 2020 226d  {.            "m
-000136b0: 6d22 3a20 6162 7328 6d61 785f 706f 7320  m": abs(max_pos 
-000136c0: 2d20 6d69 6e5f 706f 7329 0a20 2020 2020  - min_pos).     
-000136d0: 2020 207d 0a0a 2020 2020 2020 2020 2320     }..        # 
-000136e0: 4765 7420 6c65 6e67 7468 2069 6e20 766f  Get length in vo
-000136f0: 7865 6c73 0a20 2020 2020 2020 2023 2043  xels.        # C
-00013700: 6173 6520 7768 6572 6520 766f 7865 6c20  ase where voxel 
-00013710: 7369 7a65 2069 7320 6b6e 6f77 6e0a 2020  size is known.  
-00013720: 2020 2020 2020 695f 6178 203d 2073 6b72        i_ax = skr
-00013730: 742e 696d 6167 652e 5f61 7865 732e 696e  t.image._axes.in
-00013740: 6465 7828 6178 2920 6966 2069 7369 6e73  dex(ax) if isins
-00013750: 7461 6e63 6528 6178 2c20 7374 7229 2065  tance(ax, str) e
-00013760: 6c73 6520 6178 0a20 2020 2020 2020 2069  lse ax.        i
-00013770: 6620 7365 6c66 2e76 6f78 656c 5f73 697a  f self.voxel_siz
-00013780: 6520 6973 206e 6f74 204e 6f6e 653a 0a20  e is not None:. 
-00013790: 2020 2020 2020 2020 2020 206c 656e 6774             lengt
-000137a0: 685b 2276 6f78 656c 7322 5d20 3d20 6c65  h["voxels"] = le
-000137b0: 6e67 7468 5b22 6d6d 225d 202f 2073 656c  ngth["mm"] / sel
-000137c0: 662e 766f 7865 6c5f 7369 7a65 5b69 5f61  f.voxel_size[i_a
-000137d0: 785d 0a0a 2020 2020 2020 2020 2320 4465  x]..        # De
-000137e0: 616c 2077 6974 6820 6361 7365 2077 6865  al with case whe
-000137f0: 7265 2073 656c 662e 766f 7865 6c5f 7369  re self.voxel_si
-00013800: 7a65 2069 7320 4e6f 6e65 0a20 2020 2020  ze is None.     
-00013810: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00013820: 2020 2020 2069 6620 695f 6178 203d 3d20       if i_ax == 
-00013830: 323a 0a20 2020 2020 2020 2020 2020 2020  2:.             
-00013840: 2020 206c 656e 6774 685b 2276 6f78 656c     length["voxel
-00013850: 7322 5d20 3d20 6c65 6e67 7468 5b22 6d6d  s"] = length["mm
-00013860: 225d 202f 2073 656c 662e 6765 745f 736c  "] / self.get_sl
-00013870: 6963 655f 7468 6963 6b6e 6573 735f 636f  ice_thickness_co
-00013880: 6e74 6f75 7273 2829 0a20 2020 2020 2020  ntours().       
-00013890: 2020 2020 2065 6c69 6620 756e 6974 7320       elif units 
-000138a0: 3d3d 2022 766f 7865 6c73 223a 0a20 2020  == "voxels":.   
-000138b0: 2020 2020 2020 2020 2020 2020 2072 6169               rai
-000138c0: 7365 2052 756e 7469 6d65 4572 726f 7228  se RuntimeError(
-000138d0: 2243 616e 6e6f 7420 636f 6d70 7574 6520  "Cannot compute 
-000138e0: 6c65 6e67 7468 2069 6e20 766f 7865 6c73  length in voxels
-000138f0: 2066 726f 6d20 220a 2020 2020 2020 2020   from ".        
-00013900: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013910: 2020 2020 2020 2020 2020 2022 636f 6e74             "cont
-00013920: 6f75 7273 2077 6974 686f 7574 206b 6e6f  ours without kno
-00013930: 7769 6e67 2076 6f78 656c 2073 697a 6573  wing voxel sizes
-00013940: 2122 290a 0a20 2020 2020 2020 200a 2020  !")..        .  
-00013950: 2020 2020 2020 2320 4361 6368 6520 7468        # Cache th
-00013960: 6520 7072 6f70 6572 7479 2069 6620 676c  e property if gl
-00013970: 6f62 616c 0a20 2020 2020 2020 2069 6620  obal.        if 
-00013980: 6e6f 7420 7369 6e67 6c65 5f73 6c69 6365  not single_slice
-00013990: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
-000139a0: 206e 6f74 2068 6173 6174 7472 2873 656c   not hasattr(sel
-000139b0: 662c 2022 5f6c 656e 6774 6822 293a 0a20  f, "_length"):. 
-000139c0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-000139d0: 656c 662e 5f6c 656e 6774 6820 3d20 7b7d  elf._length = {}
-000139e0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-000139f0: 662e 5f6c 656e 6774 685b 736b 7274 2e69  f._length[skrt.i
-00013a00: 6d61 6765 2e5f 6178 6573 5b69 5f61 785d  mage._axes[i_ax]
-00013a10: 5d20 3d20 6c65 6e67 7468 0a20 2020 2020  ] = length.     
-00013a20: 2020 200a 2020 2020 2020 2020 2320 5265     .        # Re
-00013a30: 7475 726e 2064 6573 6972 6564 2075 6e69  turn desired uni
-00013a40: 7473 0a20 2020 2020 2020 2072 6574 7572  ts.        retur
-00013a50: 6e20 6c65 6e67 7468 5b75 6e69 7473 5d0a  n length[units].
-00013a60: 0a20 2020 2064 6566 2067 6574 5f67 656f  .    def get_geo
-00013a70: 6d65 7472 7928 0a20 2020 2020 2020 2073  metry(.        s
-00013a80: 656c 662c 0a20 2020 2020 2020 206d 6574  elf,.        met
-00013a90: 7269 6373 3d4e 6f6e 652c 0a20 2020 2020  rics=None,.     
-00013aa0: 2020 2076 6f6c 5f75 6e69 7473 3d22 6d6d     vol_units="mm
-00013ab0: 222c 0a20 2020 2020 2020 2061 7265 615f  ",.        area_
-00013ac0: 756e 6974 733d 226d 6d22 2c0a 2020 2020  units="mm",.    
-00013ad0: 2020 2020 6c65 6e67 7468 5f75 6e69 7473      length_units
-00013ae0: 3d22 6d6d 222c 0a20 2020 2020 2020 2063  ="mm",.        c
-00013af0: 656e 7472 6f69 645f 756e 6974 733d 226d  entroid_units="m
-00013b00: 6d22 2c0a 2020 2020 2020 2020 7669 6577  m",.        view
-00013b10: 3d22 782d 7922 2c0a 2020 2020 2020 2020  ="x-y",.        
-00013b20: 736c 3d4e 6f6e 652c 0a20 2020 2020 2020  sl=None,.       
-00013b30: 2070 6f73 3d4e 6f6e 652c 0a20 2020 2020   pos=None,.     
-00013b40: 2020 2069 6478 3d4e 6f6e 652c 0a20 2020     idx=None,.   
-00013b50: 2020 2020 206d 6574 686f 643d 4e6f 6e65       method=None
-00013b60: 2c0a 2020 2020 2020 2020 756e 6974 735f  ,.        units_
-00013b70: 696e 5f68 6561 6465 723d 4661 6c73 652c  in_header=False,
-00013b80: 0a20 2020 2020 2020 2067 6c6f 6261 6c5f  .        global_
-00013b90: 7673 5f73 6c69 6365 5f68 6561 6465 723d  vs_slice_header=
-00013ba0: 4661 6c73 652c 0a20 2020 2020 2020 206e  False,.        n
-00013bb0: 616d 655f 6173 5f69 6e64 6578 3d54 7275  ame_as_index=Tru
-00013bc0: 652c 0a20 2020 2020 2020 206e 6963 655f  e,.        nice_
-00013bd0: 636f 6c75 6d6e 733d 4661 6c73 652c 0a20  columns=False,. 
-00013be0: 2020 2020 2020 2064 6563 696d 616c 5f70         decimal_p
-00013bf0: 6c61 6365 733d 4e6f 6e65 2c0a 2020 2020  laces=None,.    
-00013c00: 2020 2020 666f 7263 653d 5472 7565 2c0a      force=True,.
-00013c10: 2020 2020 2020 2020 6874 6d6c 3d46 616c          html=Fal
-00013c20: 7365 0a20 2020 2029 3a0a 2020 2020 2020  se.    ):.      
-00013c30: 2020 2222 2252 6574 7572 6e20 6120 7061    """Return a pa
-00013c40: 6e64 6173 2044 6174 6146 7261 6d65 206f  ndas DataFrame o
-00013c50: 7220 6874 6d6c 2074 6162 6c65 206f 6620  r html table of 
-00013c60: 7468 6520 6765 6f6d 6574 7269 6320 7072  the geometric pr
-00013c70: 6f70 6572 7469 6573 200a 2020 2020 2020  operties .      
-00013c80: 2020 6c69 7374 6564 2069 6e20 3c6d 6574    listed in <met
-00013c90: 7269 6373 3e2e 0a0a 2020 2020 2020 2020  rics>...        
-00013ca0: 2a2a 5061 7261 6d65 7465 7273 3a2a 2a0a  **Parameters:**.
-00013cb0: 2020 2020 2020 2020 0a20 2020 2020 2020          .       
-00013cc0: 206d 6574 7269 6373 203a 206c 6973 742c   metrics : list,
-00013cd0: 2064 6566 6175 6c74 3d4e 6f6e 650a 2020   default=None.  
-00013ce0: 2020 2020 2020 2020 2020 4c69 7374 206f            List o
-00013cf0: 6620 6d65 7472 6963 7320 746f 2069 6e63  f metrics to inc
-00013d00: 6c75 6465 2069 6e20 7468 6520 7461 626c  lude in the tabl
-00013d10: 652e 204f 7074 696f 6e73 3a0a 0a20 2020  e. Options:..   
-00013d20: 2020 2020 2020 2020 2020 2020 202d 2022               - "
-00013d30: 766f 6c75 6d65 2220 3a20 766f 6c75 6d65  volume" : volume
-00013d40: 206f 6620 656e 7469 7265 2052 4f49 2e0a   of entire ROI..
-00013d50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013d60: 2d20 2261 7265 6122 3a20 6172 6561 206f  - "area": area o
-00013d70: 6620 524f 4920 6f6e 2061 2073 696e 676c  f ROI on a singl
-00013d80: 6520 736c 6963 652e 0a0a 2020 2020 2020  e slice...      
-00013d90: 2020 2020 2020 2020 2020 2d20 2263 656e            - "cen
-00013da0: 7472 6f69 6422 3a20 3344 2063 656e 7472  troid": 3D centr
-00013db0: 652d 6f66 2d6d 6173 7320 6f66 2052 4f49  e-of-mass of ROI
-00013dc0: 3b20 7769 6c6c 2062 6520 7370 6c69 7420  ; will be split 
-00013dd0: 696e 746f 0a20 2020 2020 2020 2020 2020  into.           
-00013de0: 2020 2020 2020 2074 6872 6565 2063 6f6c         three col
-00013df0: 756d 6e73 2063 6f72 7265 7370 6f6e 6469  umns correspondi
-00013e00: 6e67 2074 6f20 7468 6520 7468 7265 6520  ng to the three 
-00013e10: 6178 6573 2e0a 2020 2020 2020 2020 2020  axes..          
-00013e20: 2020 2020 2020 2d20 2263 656e 7472 6f69        - "centroi
-00013e30: 645f 736c 6963 6522 3a20 3244 2063 656e  d_slice": 2D cen
-00013e40: 7472 6520 6f66 206d 6173 7320 6f6e 2061  tre of mass on a
-00013e50: 2073 696e 676c 6520 736c 6963 652e 2057   single slice. W
-00013e60: 696c 6c0a 2020 2020 2020 2020 2020 2020  ill.            
-00013e70: 2020 2020 2020 6265 2073 706c 6974 2069        be split i
-00013e80: 6e74 6f20 7477 6f20 636f 6c75 6d6e 7320  nto two columns 
-00013e90: 636f 7272 6573 706f 6e64 696e 6720 746f  corresponding to
-00013ea0: 2074 6865 2074 776f 2061 7865 7320 6f6e   the two axes on
-00013eb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00013ec0: 2020 2074 6865 2073 6c69 6365 2e0a 0a20     the slice... 
-00013ed0: 2020 2020 2020 2020 2020 2020 2020 202d                 -
-00013ee0: 2022 6c65 6e67 7468 223a 206c 656e 6774   "length": lengt
-00013ef0: 6873 206f 6620 7468 6520 524f 4920 696e  hs of the ROI in
-00013f00: 2065 6163 6820 6469 7265 6374 696f 6e3b   each direction;
-00013f10: 2077 696c 6c20 6265 2073 706c 6974 0a20   will be split. 
-00013f20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013f30: 2069 6e74 6f20 7468 7265 6520 636f 6c75   into three colu
-00013f40: 6d6e 7320 636f 7272 6573 706f 6e64 696e  mns correspondin
-00013f50: 6720 746f 2074 6865 2074 6872 6565 2061  g to the three a
-00013f60: 7865 732e 0a20 2020 2020 2020 2020 2020  xes..           
-00013f70: 2020 2020 202d 2022 6c65 6e67 7468 5f73       - "length_s
-00013f80: 6c69 6365 223a 206c 656e 6774 6820 6f66  lice": length of
-00013f90: 2074 6865 2052 4f49 206f 6e20 6120 7369   the ROI on a si
-00013fa0: 6e67 6c65 2073 6c69 6365 3b20 7769 6c6c  ngle slice; will
-00013fb0: 2062 650a 2020 2020 2020 2020 2020 2020   be.            
-00013fc0: 2020 2020 2020 7370 6c69 7420 696e 746f        split into
-00013fd0: 2074 776f 2063 6f6c 756d 6e73 2063 6f72   two columns cor
-00013fe0: 7265 7370 6f6e 6469 6e67 2074 6f20 7468  responding to th
-00013ff0: 6520 7477 6f20 6178 6573 206f 6e20 7468  e two axes on th
-00014000: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
-00014010: 2020 2020 736c 6963 652e 0a0a 2020 2020      slice...    
-00014020: 2020 2020 2020 2020 4966 204e 6f6e 652c          If None,
-00014030: 2064 6566 6175 6c74 7320 746f 205b 2276   defaults to ["v
-00014040: 6f6c 756d 6522 2c20 2263 656e 7472 6f69  olume", "centroi
-00014050: 6422 5d0a 0a20 2020 2020 2020 2076 6f6c  d"]..        vol
-00014060: 5f75 6e69 7473 203a 2073 7472 2c20 6465  _units : str, de
-00014070: 6661 756c 743d 226d 6d22 0a20 2020 2020  fault="mm".     
-00014080: 2020 2020 2020 2055 6e69 7473 2074 6f20         Units to 
-00014090: 7573 6520 666f 7220 766f 6c75 6d65 2e20  use for volume. 
-000140a0: 4361 6e20 6265 2022 6d6d 2220 283d 6d6d  Can be "mm" (=mm
-000140b0: 5e33 292c 2022 6d6c 222c 0a20 2020 2020  ^3), "ml",.     
-000140c0: 2020 2020 2020 206f 7220 2276 6f78 656c         or "voxel
-000140d0: 7322 2e0a 0a20 2020 2020 2020 2061 7265  s"...        are
-000140e0: 615f 756e 6974 7320 3a20 7374 722c 2064  a_units : str, d
-000140f0: 6566 6175 6c74 3d22 6d6d 220a 2020 2020  efault="mm".    
-00014100: 2020 2020 2020 2020 556e 6974 7320 746f          Units to
-00014110: 2075 7365 2066 6f72 2061 7265 6173 2e20   use for areas. 
-00014120: 4361 6e20 6265 2022 6d6d 2220 283d 6d6d  Can be "mm" (=mm
-00014130: 5e32 2920 6f72 2022 766f 7865 6c73 222e  ^2) or "voxels".
-00014140: 0a0a 2020 2020 2020 2020 6c65 6e67 7468  ..        length
-00014150: 5f75 6e69 7473 203a 2073 7472 2c20 6465  _units : str, de
-00014160: 6661 756c 743d 226d 6d22 3a0a 2020 2020  fault="mm":.    
-00014170: 2020 2020 2020 2020 556e 6974 7320 746f          Units to
-00014180: 2075 7365 2066 6f72 206c 656e 6774 6873   use for lengths
-00014190: 2e20 4361 6e20 6265 2022 6d6d 2220 6f72  . Can be "mm" or
-000141a0: 2022 766f 7865 6c73 222e 0a0a 2020 2020   "voxels"...    
-000141b0: 2020 2020 6365 6e74 726f 6964 5f75 6e69      centroid_uni
-000141c0: 7473 3a0a 2020 2020 2020 2020 2020 2020  ts:.            
-000141d0: 556e 6974 7320 746f 2075 7365 2066 6f72  Units to use for
-000141e0: 2063 656e 7472 6f69 6473 2e20 4361 6e20   centroids. Can 
-000141f0: 6265 2022 6d6d 2220 6f72 2022 766f 7865  be "mm" or "voxe
-00014200: 6c73 222e 0a0a 2020 2020 2020 2020 7669  ls"...        vi
-00014210: 6577 203a 2073 7472 2c20 6465 6661 756c  ew : str, defaul
-00014220: 743d 2278 2d79 220a 2020 2020 2020 2020  t="x-y".        
-00014230: 2020 2020 4f72 6965 6e74 6174 696f 6e20      Orientation 
-00014240: 696e 2077 6869 6368 2074 6f20 636f 6d70  in which to comp
-00014250: 7574 6520 6d65 7472 6963 732e 204f 6e6c  ute metrics. Onl
-00014260: 7920 7265 6c65 7661 6e74 2066 6f72 200a  y relevant for .
-00014270: 2020 2020 2020 2020 2020 2020 7369 6e67              sing
-00014280: 6c65 2d73 6c69 6365 206d 6574 7269 6373  le-slice metrics
-00014290: 2028 6172 6561 2c20 6365 6e74 726f 6964   (area, centroid
-000142a0: 5f73 6c69 6365 2c20 6c65 6e67 7468 5f73  _slice, length_s
-000142b0: 6c69 6365 292e 0a0a 2020 2020 2020 2020  lice)...        
-000142c0: 736c 203a 2069 6e74 2c20 6465 6661 756c  sl : int, defaul
-000142d0: 743d 4e6f 6e65 0a20 2020 2020 2020 2020  t=None.         
-000142e0: 2020 2053 6c69 6365 206e 756d 6265 7220     Slice number 
-000142f0: 6f6e 2077 6869 6368 2074 6f20 636f 6d70  on which to comp
-00014300: 7574 6520 6d65 7472 6963 732e 204f 6e6c  ute metrics. Onl
-00014310: 7920 7265 6c65 7661 6e74 2066 6f72 200a  y relevant for .
-00014320: 2020 2020 2020 2020 2020 2020 7369 6e67              sing
-00014330: 6c65 2d73 6c69 6365 206d 6574 7269 6373  le-slice metrics
-00014340: 2028 6172 6561 2c20 6365 6e74 726f 6964   (area, centroid
-00014350: 5f73 6c69 6365 2c20 6c65 6e67 7468 5f73  _slice, length_s
-00014360: 6c69 6365 292e 0a20 2020 2020 2020 2020  lice)..         
-00014370: 2020 2049 6620 3c73 6c3e 2c20 3c69 6478     If <sl>, <idx
-00014380: 3e2c 2061 6e64 203c 706f 733e 2061 7265  >, and <pos> are
-00014390: 2061 6c6c 204e 6f6e 652c 2074 6865 2063   all None, the c
-000143a0: 656e 7472 616c 2073 6c69 6365 206f 6620  entral slice of 
-000143b0: 7468 650a 2020 2020 2020 2020 2020 2020  the.            
-000143c0: 524f 4920 7769 6c6c 2062 6520 7573 6564  ROI will be used
-000143d0: 2e0a 0a20 2020 2020 2020 2069 6478 203a  ...        idx :
-000143e0: 2069 6e74 2c20 6465 6661 756c 743d 4e6f   int, default=No
-000143f0: 6e65 0a20 2020 2020 2020 2020 2020 2053  ne.            S
-00014400: 6c69 6365 2069 6e64 6578 2061 7272 6179  lice index array
-00014410: 206f 6e20 7768 6963 6820 746f 2063 6f6d   on which to com
-00014420: 7075 7465 206d 6574 7269 6373 2e20 4f6e  pute metrics. On
-00014430: 6c79 2072 656c 6576 616e 7420 666f 7220  ly relevant for 
-00014440: 0a20 2020 2020 2020 2020 2020 2073 696e  .            sin
-00014450: 676c 652d 736c 6963 6520 6d65 7472 6963  gle-slice metric
-00014460: 7320 2861 7265 612c 2063 656e 7472 6f69  s (area, centroi
-00014470: 645f 736c 6963 652c 206c 656e 6774 685f  d_slice, length_
-00014480: 736c 6963 6529 2e0a 2020 2020 2020 2020  slice)..        
-00014490: 2020 2020 5573 6564 2069 6620 3c73 6c3e      Used if <sl>
-000144a0: 2069 7320 4e6f 6e65 2e0a 0a20 2020 2020   is None...     
-000144b0: 2020 2070 6f73 203a 2066 6c6f 6174 2c20     pos : float, 
-000144c0: 6465 6661 756c 743d 4e6f 6e65 0a20 2020  default=None.   
-000144d0: 2020 2020 2020 2020 2053 6c69 6365 2070           Slice p
-000144e0: 6f73 6974 696f 6e20 696e 206d 6d20 6f6e  osition in mm on
-000144f0: 2077 6869 6368 2074 6f20 636f 6d70 7574   which to comput
-00014500: 6520 6d65 7472 6963 732e 204f 6e6c 7920  e metrics. Only 
-00014510: 7265 6c65 7661 6e74 2066 6f72 200a 2020  relevant for .  
-00014520: 2020 2020 2020 2020 2020 7369 6e67 6c65            single
-00014530: 2d73 6c69 6365 206d 6574 7269 6373 2028  -slice metrics (
-00014540: 6172 6561 2c20 6365 6e74 726f 6964 5f73  area, centroid_s
-00014550: 6c69 6365 2c20 6c65 6e67 7468 5f73 6c69  lice, length_sli
-00014560: 6365 292e 0a20 2020 2020 2020 2020 2020  ce)..           
-00014570: 2055 7365 6420 6966 203c 736c 3e20 616e   Used if <sl> an
-00014580: 6420 3c69 6478 3e20 6172 6520 626f 7468  d <idx> are both
-00014590: 204e 6f6e 652e 0a0a 2020 2020 2020 2020   None...        
-000145a0: 6d65 7468 6f64 203a 2073 7472 2c20 6465  method : str, de
-000145b0: 6661 756c 743d 4e6f 6e65 0a20 2020 2020  fault=None.     
-000145c0: 2020 2020 2020 204d 6574 686f 6420 746f         Method to
-000145d0: 2075 7365 2066 6f72 206d 6574 7269 6320   use for metric 
-000145e0: 6361 6c63 756c 6174 696f 6e2e 2043 616e  calculation. Can
-000145f0: 2062 6520 6569 7468 6572 2022 636f 6e74   be either "cont
-00014600: 6f75 7222 200a 2020 2020 2020 2020 2020  our" .          
-00014610: 2020 2875 7365 2073 6861 7065 6c79 2070    (use shapely p
-00014620: 6f6c 7967 6f6e 7329 206f 7220 226d 6173  olygons) or "mas
-00014630: 6b22 2028 7573 6520 6269 6e61 7279 206d  k" (use binary m
-00014640: 6173 6b29 2e20 4966 204e 6f6e 652c 0a20  ask). If None,. 
-00014650: 2020 2020 2020 2020 2020 2074 6865 2076             the v
-00014660: 616c 7565 2073 6574 2069 6e20 7365 6c66  alue set in self
-00014670: 2e64 6566 6175 6c74 5f67 656f 6d5f 6d65  .default_geom_me
-00014680: 7468 6f64 2077 696c 6c20 6265 2075 7365  thod will be use
-00014690: 642e 0a0a 2020 2020 2020 2020 756e 6974  d...        unit
-000146a0: 735f 696e 5f68 6561 6465 7220 3a20 626f  s_in_header : bo
-000146b0: 6f6c 2c20 6465 6661 756c 743d 4661 6c73  ol, default=Fals
-000146c0: 650a 2020 2020 2020 2020 2020 2020 4966  e.            If
-000146d0: 2054 7275 652c 2075 6e69 7473 2077 696c   True, units wil
-000146e0: 6c20 6265 2069 6e63 6c75 6465 6420 696e  l be included in
-000146f0: 2063 6f6c 756d 6e20 6865 6164 6572 732e   column headers.
-00014700: 0a0a 2020 2020 2020 2020 676c 6f62 616c  ..        global
-00014710: 5f76 735f 736c 6963 655f 6865 6164 6572  _vs_slice_header
-00014720: 203a 2062 6f6f 6c2c 2064 6566 6175 6c74   : bool, default
-00014730: 3d46 616c 7365 0a20 2020 2020 2020 2020  =False.         
-00014740: 2020 2049 6620 5472 7565 2c20 7468 6520     If True, the 
-00014750: 7265 7475 726e 6564 2044 6174 6146 7261  returned DataFra
-00014760: 6d65 2077 696c 6c20 6861 7665 2061 6e20  me will have an 
-00014770: 6578 7472 6120 7365 7420 6f66 2068 6561  extra set of hea
-00014780: 6465 7273 0a20 2020 2020 2020 2020 2020  ders.           
-00014790: 2073 706c 6974 7469 6e67 2074 6865 2074   splitting the t
-000147a0: 6162 6c65 2069 6e74 6f20 2267 6c6f 6261  able into "globa
-000147b0: 6c22 2061 6e64 2022 736c 6963 6522 206d  l" and "slice" m
-000147c0: 6574 7269 6373 2e0a 0a20 2020 2020 2020  etrics...       
-000147d0: 206e 616d 655f 6173 5f69 6e64 6578 203a   name_as_index :
-000147e0: 2062 6f6f 6c2c 2064 6566 6175 6c74 3d54   bool, default=T
-000147f0: 7275 650a 2020 2020 2020 2020 2020 2020  rue.            
-00014800: 4966 2054 7275 652c 2074 6865 2069 6e64  If True, the ind
-00014810: 6578 2063 6f6c 756d 6e20 6f66 2074 6865  ex column of the
-00014820: 2070 616e 6461 7320 4461 7461 4672 616d   pandas DataFram
-00014830: 6520 7769 6c6c 200a 2020 2020 2020 2020  e will .        
-00014840: 2020 2020 636f 6e74 6169 6e20 7468 6520      contain the 
-00014850: 524f 4927 7320 6e61 6d65 3b20 6f74 6865  ROI's name; othe
-00014860: 7277 6973 652c 2074 6865 206e 616d 6520  rwise, the name 
-00014870: 7769 6c6c 2061 7070 6561 7220 696e 2061  will appear in a
-00014880: 2063 6f6c 756d 6e0a 2020 2020 2020 2020   column.        
-00014890: 2020 2020 6e61 6d65 6420 2252 4f49 222e      named "ROI".
-000148a0: 0a0a 2020 2020 2020 2020 6e69 6365 5f63  ..        nice_c
-000148b0: 6f6c 756d 6e73 203a 2062 6f6f 6c2c 2064  olumns : bool, d
-000148c0: 6566 6175 6c74 3d46 616c 7365 0a20 2020  efault=False.   
-000148d0: 2020 2020 2020 2020 2049 6620 4661 6c73           If Fals
-000148e0: 652c 2063 6f6c 756d 6e20 6e61 6d65 7320  e, column names 
-000148f0: 7769 6c6c 2062 6520 7468 6520 7361 6d65  will be the same
-00014900: 2061 7320 7468 6520 696e 7075 7420 6d65   as the input me
-00014910: 7472 6963 7320 6e61 6d65 733b 0a20 2020  trics names;.   
-00014920: 2020 2020 2020 2020 2069 6620 5472 7565           if True
-00014930: 2c20 7468 6520 6e61 6d65 7320 7769 6c6c  , the names will
-00014940: 2062 6520 6361 7069 7461 6c69 7a65 6420   be capitalized 
-00014950: 616e 6420 756e 6465 7273 636f 7265 7320  and underscores 
-00014960: 7769 6c6c 2062 6520 0a20 2020 2020 2020  will be .       
-00014970: 2020 2020 2072 6570 6c61 6365 6420 7769       replaced wi
-00014980: 7468 2073 7061 6365 732e 0a0a 2020 2020  th spaces...    
-00014990: 2020 2020 6465 6369 6d61 6c5f 706c 6163      decimal_plac
-000149a0: 6573 203a 2069 6e74 2c20 6465 6661 756c  es : int, defaul
-000149b0: 743d 4e6f 6e65 0a20 2020 2020 2020 2020  t=None.         
-000149c0: 2020 204e 756d 6265 7220 6f66 2064 6563     Number of dec
-000149d0: 696d 616c 2070 6c61 6365 7320 746f 206b  imal places to k
-000149e0: 6565 7020 666f 7220 6561 6368 206d 6574  eep for each met
-000149f0: 7269 632e 2049 6620 4e6f 6e65 2c20 6675  ric. If None, fu
-00014a00: 6c6c 0a20 2020 2020 2020 2020 2020 2070  ll.            p
-00014a10: 7265 6369 7369 6f6e 2077 696c 6c20 6265  recision will be
-00014a20: 2075 7365 642e 0a0a 2020 2020 2020 2020   used...        
-00014a30: 666f 7263 6520 3a20 626f 6f6c 2c20 6465  force : bool, de
-00014a40: 6661 756c 743d 5472 7565 0a20 2020 2020  fault=True.     
-00014a50: 2020 2020 2020 2049 6620 4661 6c73 652c         If False,
-00014a60: 2067 6c6f 6261 6c20 6d65 7472 6963 7320   global metrics 
-00014a70: 2876 6f6c 756d 652c 2033 4420 6365 6e74  (volume, 3D cent
-00014a80: 726f 6964 2c20 3344 206c 656e 6774 6873  roid, 3D lengths
-00014a90: 2920 7769 6c6c 0a20 2020 2020 2020 2020  ) will.         
-00014aa0: 2020 206f 6e6c 7920 6265 2063 616c 6375     only be calcu
-00014ab0: 6c61 7465 6420 6966 2074 6865 7920 6861  lated if they ha
-00014ac0: 7665 206e 6f74 2062 6565 6e20 6361 6c63  ve not been calc
-00014ad0: 756c 6174 6564 2062 6566 6f72 653b 0a20  ulated before;. 
-00014ae0: 2020 2020 2020 2020 2020 2069 6620 5472             if Tr
-00014af0: 7565 2c20 616c 6c20 6d65 7472 6963 7320  ue, all metrics 
-00014b00: 7769 6c6c 2062 6520 7265 6361 6c63 756c  will be recalcul
-00014b10: 6174 6564 2e0a 2020 2020 2020 2020 2222  ated..        ""
-00014b20: 220a 0a20 2020 2020 2020 2023 2049 6620  "..        # If 
-00014b30: 6e6f 2069 6e64 6578 2067 6976 656e 2c20  no index given, 
-00014b40: 7573 6520 6365 6e74 7261 6c20 736c 6963  use central slic
-00014b50: 650a 2020 2020 2020 2020 6966 2073 6c20  e.        if sl 
-00014b60: 6973 204e 6f6e 6520 616e 6420 6964 7820  is None and idx 
-00014b70: 6973 204e 6f6e 6520 616e 6420 706f 7320  is None and pos 
-00014b80: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
-00014b90: 2020 2020 2069 6478 203d 2073 656c 662e       idx = self.
-00014ba0: 6765 745f 6d69 645f 6964 7828 7669 6577  get_mid_idx(view
-00014bb0: 290a 0a20 2020 2020 2020 2023 2044 6566  )..        # Def
-00014bc0: 6175 6c74 206d 6574 7269 6373 0a20 2020  ault metrics.   
-00014bd0: 2020 2020 2069 6620 6d65 7472 6963 7320       if metrics 
-00014be0: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
-00014bf0: 2020 2020 206d 6574 7269 6373 203d 205b       metrics = [
-00014c00: 2276 6f6c 756d 6522 2c20 2263 656e 7472  "volume", "centr
-00014c10: 6f69 6422 5d0a 0a20 2020 2020 2020 2023  oid"]..        #
-00014c20: 2043 6f6d 7075 7465 206d 6574 7269 6373   Compute metrics
-00014c30: 0a20 2020 2020 2020 2067 656f 6d20 3d20  .        geom = 
-00014c40: 7b7d 0a20 2020 2020 2020 2073 6c69 6365  {}.        slice
-00014c50: 5f6b 7761 7267 7320 3d20 7b0a 2020 2020  _kwargs = {.    
-00014c60: 2020 2020 2020 2020 2273 696e 676c 655f          "single_
-00014c70: 736c 6963 6522 3a20 5472 7565 2c0a 2020  slice": True,.  
-00014c80: 2020 2020 2020 2020 2020 2276 6965 7722            "view"
-00014c90: 3a20 7669 6577 2c0a 2020 2020 2020 2020  : view,.        
-00014ca0: 2020 2020 2273 6c22 3a20 736c 2c0a 2020      "sl": sl,.  
-00014cb0: 2020 2020 2020 2020 2020 2269 6478 223a            "idx":
-00014cc0: 2069 6478 2c0a 2020 2020 2020 2020 2020   idx,.          
-00014cd0: 2020 2270 6f73 223a 2070 6f73 0a20 2020    "pos": pos.   
-00014ce0: 2020 2020 207d 0a20 2020 2020 2020 2066       }.        f
-00014cf0: 6f72 206d 2069 6e20 6d65 7472 6963 733a  or m in metrics:
-00014d00: 0a0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
-00014d10: 3344 2076 6f6c 756d 650a 2020 2020 2020  3D volume.      
-00014d20: 2020 2020 2020 6966 206d 203d 3d20 2276        if m == "v
-00014d30: 6f6c 756d 6522 3a0a 2020 2020 2020 2020  olume":.        
-00014d40: 2020 2020 2020 2020 6765 6f6d 5b6d 5d20          geom[m] 
-00014d50: 3d20 7365 6c66 2e67 6574 5f76 6f6c 756d  = self.get_volum
-00014d60: 6528 0a20 2020 2020 2020 2020 2020 2020  e(.             
-00014d70: 2020 2020 2020 2075 6e69 7473 3d76 6f6c         units=vol
-00014d80: 5f75 6e69 7473 2c20 0a20 2020 2020 2020  _units, .       
-00014d90: 2020 2020 2020 2020 2020 2020 206d 6574               met
-00014da0: 686f 643d 6d65 7468 6f64 2c0a 2020 2020  hod=method,.    
-00014db0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014dc0: 666f 7263 653d 666f 7263 650a 2020 2020  force=force.    
-00014dd0: 2020 2020 2020 2020 2020 2020 290a 0a20              ).. 
-00014de0: 2020 2020 2020 2020 2020 2023 2041 7265             # Are
-00014df0: 6120 6f6e 2061 2073 6c69 6365 0a20 2020  a on a slice.   
-00014e00: 2020 2020 2020 2020 2065 6c69 6620 6d20           elif m 
-00014e10: 3d3d 2022 6172 6561 223a 0a20 2020 2020  == "area":.     
-00014e20: 2020 2020 2020 2020 2020 2067 656f 6d5b             geom[
-00014e30: 6d5d 203d 2073 656c 662e 6765 745f 6172  m] = self.get_ar
-00014e40: 6561 280a 2020 2020 2020 2020 2020 2020  ea(.            
-00014e50: 2020 2020 2020 2020 756e 6974 733d 6172          units=ar
-00014e60: 6561 5f75 6e69 7473 2c20 0a20 2020 2020  ea_units, .     
-00014e70: 2020 2020 2020 2020 2020 2020 2020 206d                 m
-00014e80: 6574 686f 643d 6d65 7468 6f64 2c0a 2020  ethod=method,.  
-00014e90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014ea0: 2020 2a2a 736c 6963 655f 6b77 6172 6773    **slice_kwargs
-00014eb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00014ec0: 2029 0a0a 2020 2020 2020 2020 2020 2020   )..            
-00014ed0: 2320 3344 2063 656e 7472 6f69 640a 2020  # 3D centroid.  
-00014ee0: 2020 2020 2020 2020 2020 656c 6966 206d            elif m
-00014ef0: 203d 3d20 2263 656e 7472 6f69 6422 3a0a   == "centroid":.
-00014f00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014f10: 6365 6e74 726f 6964 203d 2073 656c 662e  centroid = self.
-00014f20: 6765 745f 6365 6e74 726f 6964 280a 2020  get_centroid(.  
-00014f30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014f40: 2020 756e 6974 733d 6365 6e74 726f 6964    units=centroid
-00014f50: 5f75 6e69 7473 2c20 0a20 2020 2020 2020  _units, .       
-00014f60: 2020 2020 2020 2020 2020 2020 206d 6574               met
-00014f70: 686f 643d 6d65 7468 6f64 2c0a 2020 2020  hod=method,.    
-00014f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014f90: 666f 7263 653d 666f 7263 650a 2020 2020  force=force.    
-00014fa0: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
-00014fb0: 2020 2020 2020 2020 2020 2020 2020 666f                fo
-00014fc0: 7220 692c 2061 7820 696e 2065 6e75 6d65  r i, ax in enume
-00014fd0: 7261 7465 2873 6b72 742e 696d 6167 652e  rate(skrt.image.
-00014fe0: 5f61 7865 7329 3a0a 2020 2020 2020 2020  _axes):.        
-00014ff0: 2020 2020 2020 2020 2020 2020 6765 6f6d              geom
-00015000: 5b66 2263 656e 7472 6f69 645f 7b61 787d  [f"centroid_{ax}
-00015010: 225d 203d 2063 656e 7472 6f69 645b 695d  "] = centroid[i]
-00015020: 0a0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
-00015030: 3244 2063 656e 7472 6f69 640a 2020 2020  2D centroid.    
-00015040: 2020 2020 2020 2020 656c 6966 206d 203d          elif m =
-00015050: 3d20 2263 656e 7472 6f69 645f 736c 6963  = "centroid_slic
-00015060: 6522 3a0a 2020 2020 2020 2020 2020 2020  e":.            
-00015070: 2020 2020 6365 6e74 726f 6964 203d 2073      centroid = s
-00015080: 656c 662e 6765 745f 6365 6e74 726f 6964  elf.get_centroid
-00015090: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-000150a0: 2020 2020 2020 756e 6974 733d 6365 6e74        units=cent
-000150b0: 726f 6964 5f75 6e69 7473 2c20 0a20 2020  roid_units, .   
-000150c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000150d0: 206d 6574 686f 643d 6d65 7468 6f64 2c0a   method=method,.
-000150e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000150f0: 2020 2020 2a2a 736c 6963 655f 6b77 6172      **slice_kwar
-00015100: 6773 0a20 2020 2020 2020 2020 2020 2020  gs.             
-00015110: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
-00015120: 2020 2020 2066 6f72 2069 2c20 695f 6178       for i, i_ax
-00015130: 2069 6e20 656e 756d 6572 6174 6528 736b   in enumerate(sk
-00015140: 7274 2e69 6d61 6765 2e5f 706c 6f74 5f61  rt.image._plot_a
-00015150: 7865 735b 7669 6577 5d29 3a0a 2020 2020  xes[view]):.    
-00015160: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015170: 6178 203d 2073 6b72 742e 696d 6167 652e  ax = skrt.image.
-00015180: 5f61 7865 735b 695f 6178 5d0a 2020 2020  _axes[i_ax].    
-00015190: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000151a0: 6765 6f6d 5b66 2263 656e 7472 6f69 645f  geom[f"centroid_
-000151b0: 736c 6963 655f 7b61 787d 225d 203d 2063  slice_{ax}"] = c
-000151c0: 656e 7472 6f69 645b 695d 0a0a 2020 2020  entroid[i]..    
-000151d0: 2020 2020 2020 2020 2320 4675 6c6c 206c          # Full l
-000151e0: 656e 6774 6873 2061 6c6f 6e67 2065 6163  engths along eac
-000151f0: 6820 6178 6973 0a20 2020 2020 2020 2020  h axis.         
-00015200: 2020 2065 6c69 6620 6d20 3d3d 2022 6c65     elif m == "le
-00015210: 6e67 7468 223a 0a20 2020 2020 2020 2020  ngth":.         
-00015220: 2020 2020 2020 2066 6f72 2061 7820 696e         for ax in
-00015230: 2073 6b72 742e 696d 6167 652e 5f61 7865   skrt.image._axe
-00015240: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
-00015250: 2020 2020 2020 2067 656f 6d5b 6622 6c65         geom[f"le
-00015260: 6e67 7468 5f7b 6178 7d22 5d20 3d20 7365  ngth_{ax}"] = se
-00015270: 6c66 2e67 6574 5f6c 656e 6774 6828 0a20  lf.get_length(. 
-00015280: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015290: 2020 2020 2020 2061 783d 6178 2c20 0a20         ax=ax, . 
-000152a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000152b0: 2020 2020 2020 2075 6e69 7473 3d6c 656e         units=len
-000152c0: 6774 685f 756e 6974 732c 0a20 2020 2020  gth_units,.     
-000152d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000152e0: 2020 206d 6574 686f 643d 6d65 7468 6f64     method=method
-000152f0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00015300: 2020 2020 2020 2020 2020 666f 7263 653d            force=
-00015310: 666f 7263 650a 2020 2020 2020 2020 2020  force.          
-00015320: 2020 2020 2020 2020 2020 290a 0a20 2020            )..   
-00015330: 2020 2020 2020 2020 2023 204c 656e 6774           # Lengt
-00015340: 6873 206f 6e20 6120 736c 6963 650a 2020  hs on a slice.  
-00015350: 2020 2020 2020 2020 2020 656c 6966 206d            elif m
-00015360: 203d 3d20 226c 656e 6774 685f 736c 6963   == "length_slic
-00015370: 6522 3a0a 2020 2020 2020 2020 2020 2020  e":.            
-00015380: 2020 2020 666f 7220 695f 6178 2069 6e20      for i_ax in 
-00015390: 736b 7274 2e69 6d61 6765 2e5f 706c 6f74  skrt.image._plot
-000153a0: 5f61 7865 735b 7669 6577 5d3a 0a20 2020  _axes[view]:.   
-000153b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000153c0: 2061 7820 3d20 736b 7274 2e69 6d61 6765   ax = skrt.image
-000153d0: 2e5f 6178 6573 5b69 5f61 785d 0a20 2020  ._axes[i_ax].   
-000153e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000153f0: 2067 656f 6d5b 6622 6c65 6e67 7468 5f73   geom[f"length_s
-00015400: 6c69 6365 5f7b 6178 7d22 5d20 3d20 7365  lice_{ax}"] = se
-00015410: 6c66 2e67 6574 5f6c 656e 6774 6828 0a20  lf.get_length(. 
-00015420: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015430: 2020 2020 2020 2061 783d 6178 2c20 0a20         ax=ax, . 
+0000d390: 2020 2022 2073 697a 6573 2061 6e64 206d     " sizes and m
+0000d3a0: 6173 6b20 7368 6170 6521 2229 0a20 2020  ask shape!").   
+0000d3b0: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+0000d3c0: 2020 2020 2020 2020 2020 2020 2020 2076                 v
+0000d3d0: 6965 775f 6178 6573 203d 2028 5b30 2c20  iew_axes = ([0, 
+0000d3e0: 312c 2032 5d20 6966 206c 656e 2863 656e  1, 2] if len(cen
+0000d3f0: 7472 6f69 645b 276d 6d27 5d29 203d 3d20  troid['mm']) == 
+0000d400: 3320 656c 7365 0a20 2020 2020 2020 2020  3 else.         
+0000d410: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0000d420: 6b72 742e 696d 6167 652e 5f70 6c6f 745f  krt.image._plot_
+0000d430: 6178 6573 5b76 6965 775d 290a 0a20 2020  axes[view])..   
+0000d440: 2020 2020 2020 2020 2020 2020 2063 656e               cen
+0000d450: 7472 6f69 645b 2276 6f78 656c 7322 5d20  troid["voxels"] 
+0000d460: 3d20 6e70 2e61 7272 6179 285b 0a20 2020  = np.array([.   
+0000d470: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d480: 2073 656c 662e 706f 735f 746f 5f69 6478   self.pos_to_idx
+0000d490: 2863 2c20 6178 3d69 2c20 7265 7475 726e  (c, ax=i, return
+0000d4a0: 5f69 6e74 3d46 616c 7365 2920 0a20 2020  _int=False) .   
+0000d4b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d4c0: 2066 6f72 2069 2c20 6320 696e 207a 6970   for i, c in zip
+0000d4d0: 2876 6965 775f 6178 6573 2c20 6365 6e74  (view_axes, cent
+0000d4e0: 726f 6964 5b22 6d6d 225d 290a 2020 2020  roid["mm"]).    
+0000d4f0: 2020 2020 2020 2020 2020 2020 5d29 0a0a              ])..
+0000d500: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d510: 6365 6e74 726f 6964 5b22 736c 6963 6522  centroid["slice"
+0000d520: 5d20 3d20 6e70 2e61 7272 6179 285b 0a20  ] = np.array([. 
+0000d530: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d540: 2020 2073 656c 662e 706f 735f 746f 5f73     self.pos_to_s
+0000d550: 6c69 6365 2863 2c20 6178 3d69 2c20 7265  lice(c, ax=i, re
+0000d560: 7475 726e 5f69 6e74 3d46 616c 7365 2920  turn_int=False) 
+0000d570: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000d580: 2020 2020 2066 6f72 2069 2c20 6320 696e       for i, c in
+0000d590: 207a 6970 2876 6965 775f 6178 6573 2c20   zip(view_axes, 
+0000d5a0: 6365 6e74 726f 6964 5b22 6d6d 225d 290a  centroid["mm"]).
+0000d5b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d5c0: 5d29 0a0a 2020 2020 2020 2020 2320 4f74  ])..        # Ot
+0000d5d0: 6865 7277 6973 652c 2063 616c 6375 6c61  herwise, calcula
+0000d5e0: 7465 2063 656e 7472 6f69 6420 6672 6f6d  te centroid from
+0000d5f0: 2062 696e 6172 7920 6d61 736b 0a20 2020   binary mask.   
+0000d600: 2020 2020 2065 6c73 653a 200a 0a20 2020       else: ..   
+0000d610: 2020 2020 2020 2020 2023 2047 6574 2032           # Get 2
+0000d620: 4420 6f72 2033 4420 6461 7461 2066 726f  D or 3D data fro
+0000d630: 6d20 7768 6963 6820 746f 2063 616c 6375  m which to calcu
+0000d640: 6c61 7465 2063 656e 7472 6f69 640a 2020  late centroid.  
+0000d650: 2020 2020 2020 2020 2020 6966 2073 696e            if sin
+0000d660: 676c 655f 736c 6963 653a 0a20 2020 2020  gle_slice:.     
+0000d670: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
+0000d680: 7420 7365 6c66 2e6f 6e5f 736c 6963 6528  t self.on_slice(
+0000d690: 7669 6577 2c20 736c 3d73 6c2c 2069 6478  view, sl=sl, idx
+0000d6a0: 3d69 6478 2c20 706f 733d 706f 7329 3a0a  =idx, pos=pos):.
+0000d6b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d6c0: 2020 2020 7265 7475 726e 206e 702e 6172      return np.ar
+0000d6d0: 7261 7928 5b4e 6f6e 652c 204e 6f6e 655d  ray([None, None]
+0000d6e0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0000d6f0: 2020 6461 7461 203d 2073 656c 662e 6765    data = self.ge
+0000d700: 745f 736c 6963 6528 7669 6577 2c20 736c  t_slice(view, sl
+0000d710: 3d73 6c2c 2069 6478 3d69 6478 2c20 706f  =sl, idx=idx, po
+0000d720: 733d 706f 7329 0a20 2020 2020 2020 2020  s=pos).         
+0000d730: 2020 2020 2020 2061 7865 7320 3d20 736b         axes = sk
+0000d740: 7274 2e69 6d61 6765 2e5f 706c 6f74 5f61  rt.image._plot_a
+0000d750: 7865 735b 7669 6577 5d0a 2020 2020 2020  xes[view].      
+0000d760: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+0000d770: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0000d780: 2e63 7265 6174 655f 6d61 736b 2829 0a20  .create_mask(). 
+0000d790: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+0000d7a0: 6174 6120 3d20 7365 6c66 2e67 6574 5f6d  ata = self.get_m
+0000d7b0: 6173 6b28 7374 616e 6461 7264 6973 653d  ask(standardise=
+0000d7c0: 5472 7565 290a 2020 2020 2020 2020 2020  True).          
+0000d7d0: 2020 2020 2020 6178 6573 203d 2073 6b72        axes = skr
+0000d7e0: 742e 696d 6167 652e 5f61 7865 730a 0a20  t.image._axes.. 
+0000d7f0: 2020 2020 2020 2020 2020 2023 2043 6f6d             # Com
+0000d800: 7075 7465 2063 656e 7472 6f69 6420 6672  pute centroid fr
+0000d810: 6f6d 2032 4420 6f72 2033 4420 6269 6e61  om 2D or 3D bina
+0000d820: 7279 206d 6173 6b0a 2020 2020 2020 2020  ry mask.        
+0000d830: 2020 2020 6e6f 6e5f 7a65 726f 203d 206e      non_zero = n
+0000d840: 702e 6172 6777 6865 7265 2864 6174 6129  p.argwhere(data)
+0000d850: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+0000d860: 6e6f 7420 6c65 6e28 6e6f 6e5f 7a65 726f  not len(non_zero
+0000d870: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+0000d880: 2020 2069 6620 6461 7461 2e6e 6469 6d20     if data.ndim 
+0000d890: 3d3d 2032 3a0a 2020 2020 2020 2020 2020  == 2:.          
+0000d8a0: 2020 2020 2020 2020 2020 7265 7475 726e            return
+0000d8b0: 204e 6f6e 652c 204e 6f6e 650a 2020 2020   None, None.    
+0000d8c0: 2020 2020 2020 2020 2020 2020 656c 7365              else
+0000d8d0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0000d8e0: 2020 2020 2020 7265 7475 726e 204e 6f6e        return Non
+0000d8f0: 652c 204e 6f6e 652c 204e 6f6e 650a 2020  e, None, None.  
+0000d900: 2020 2020 2020 2020 2020 6365 6e74 726f            centro
+0000d910: 6964 5f72 6f77 636f 6c20 3d20 6c69 7374  id_rowcol = list
+0000d920: 286e 6f6e 5f7a 6572 6f2e 6d65 616e 2830  (non_zero.mean(0
+0000d930: 2929 0a20 2020 2020 2020 2020 2020 2063  )).            c
+0000d940: 656e 7472 6f69 645f 766f 7865 6c73 203d  entroid_voxels =
+0000d950: 205b 6365 6e74 726f 6964 5f72 6f77 636f   [centroid_rowco
+0000d960: 6c5b 315d 2c20 6365 6e74 726f 6964 5f72  l[1], centroid_r
+0000d970: 6f77 636f 6c5b 305d 5d20 5c0a 2020 2020  owcol[0]] \.    
+0000d980: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d990: 2b20 6365 6e74 726f 6964 5f72 6f77 636f  + centroid_rowco
+0000d9a0: 6c5b 323a 5d0a 2020 2020 2020 2020 2020  l[2:].          
+0000d9b0: 2020 6365 6e74 726f 6964 5b22 766f 7865    centroid["voxe
+0000d9c0: 6c73 225d 203d 206e 702e 6172 7261 7928  ls"] = np.array(
+0000d9d0: 6365 6e74 726f 6964 5f76 6f78 656c 7329  centroid_voxels)
+0000d9e0: 0a0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
+0000d9f0: 436f 6e76 6572 7420 746f 206d 6d20 616e  Convert to mm an
+0000da00: 6420 736c 6963 6573 0a20 2020 2020 2020  d slices.       
+0000da10: 2020 2020 2076 6965 775f 6178 6573 203d       view_axes =
+0000da20: 2028 5b30 2c20 312c 2032 5d20 6966 206c   ([0, 1, 2] if l
+0000da30: 656e 2863 656e 7472 6f69 645b 2776 6f78  en(centroid['vox
+0000da40: 656c 7327 5d29 203d 3d20 3320 656c 7365  els']) == 3 else
+0000da50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000da60: 2020 2020 2073 6b72 742e 696d 6167 652e       skrt.image.
+0000da70: 5f70 6c6f 745f 6178 6573 5b76 6965 775d  _plot_axes[view]
+0000da80: 290a 0a20 2020 2020 2020 2020 2020 2063  )..            c
+0000da90: 656e 7472 6f69 645b 226d 6d22 5d20 3d20  entroid["mm"] = 
+0000daa0: 6e70 2e61 7272 6179 285b 0a20 2020 2020  np.array([.     
+0000dab0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0000dac0: 6964 785f 746f 5f70 6f73 2863 2c20 6178  idx_to_pos(c, ax
+0000dad0: 3d69 290a 2020 2020 2020 2020 2020 2020  =i).            
+0000dae0: 2020 2020 666f 7220 692c 2063 2069 6e20      for i, c in 
+0000daf0: 7a69 7028 7669 6577 5f61 7865 732c 2063  zip(view_axes, c
+0000db00: 656e 7472 6f69 645b 2276 6f78 656c 7322  entroid["voxels"
+0000db10: 5d29 0a20 2020 2020 2020 2020 2020 205d  ]).            ]
+0000db20: 290a 0a20 2020 2020 2020 2020 2020 2063  )..            c
+0000db30: 656e 7472 6f69 645b 2273 6c69 6365 225d  entroid["slice"]
+0000db40: 203d 206e 702e 6172 7261 7928 5b0a 2020   = np.array([.  
+0000db50: 2020 2020 2020 2020 2020 2020 2020 7365                se
+0000db60: 6c66 2e69 6478 5f74 6f5f 736c 6963 6528  lf.idx_to_slice(
+0000db70: 632c 2061 783d 6929 0a20 2020 2020 2020  c, ax=i).       
+0000db80: 2020 2020 2020 2020 2066 6f72 2069 2c20           for i, 
+0000db90: 6320 696e 207a 6970 2876 6965 775f 6178  c in zip(view_ax
+0000dba0: 6573 2c20 6365 6e74 726f 6964 5b22 766f  es, centroid["vo
+0000dbb0: 7865 6c73 225d 290a 2020 2020 2020 2020  xels"]).        
+0000dbc0: 2020 2020 5d29 0a0a 2020 2020 2020 2020      ])..        
+0000dbd0: 2320 4361 6368 6520 676c 6f62 616c 2063  # Cache global c
+0000dbe0: 656e 7472 6f69 640a 2020 2020 2020 2020  entroid.        
+0000dbf0: 6966 206e 6f74 2073 696e 676c 655f 736c  if not single_sl
+0000dc00: 6963 653a 0a20 2020 2020 2020 2020 2020  ice:.           
+0000dc10: 2073 656c 662e 5f63 656e 7472 6f69 6420   self._centroid 
+0000dc20: 3d20 6365 6e74 726f 6964 0a0a 2020 2020  = centroid..    
+0000dc30: 2020 2020 2320 5265 7475 726e 2063 656e      # Return cen
+0000dc40: 7472 6f69 6420 696e 2072 6571 7565 7374  troid in request
+0000dc50: 6564 2075 6e69 7473 0a20 2020 2020 2020  ed units.       
+0000dc60: 2072 6574 7572 6e20 6365 6e74 726f 6964   return centroid
+0000dc70: 5b75 6e69 7473 5d0a 0a20 2020 2064 6566  [units]..    def
+0000dc80: 2073 6574 5f73 6c69 6365 5f74 6869 636b   set_slice_thick
+0000dc90: 6e65 7373 5f63 6f6e 746f 7572 7328 7365  ness_contours(se
+0000dca0: 6c66 2c20 647a 293a 0a20 2020 2020 2020  lf, dz):.       
+0000dcb0: 2022 2222 0a20 2020 2020 2020 2053 6574   """.        Set
+0000dcc0: 206e 6f6d 696e 616c 207a 2073 7061 6369   nominal z spaci
+0000dcd0: 6e67 206f 6620 636f 6e74 6f75 7273 2e0a  ng of contours..
+0000dce0: 0a20 2020 2020 2020 2054 6869 7320 6d61  .        This ma
+0000dcf0: 7920 6265 2075 7365 6675 6c20 696e 2070  y be useful in p
+0000dd00: 6172 7469 6375 6c61 7220 666f 7220 2073  articular for  s
+0000dd10: 696e 676c 652d 736c 6963 6520 524f 4973  ingle-slice ROIs
+0000dd20: 2e0a 2020 2020 2020 2020 2222 220a 0a20  ..        """.. 
+0000dd30: 2020 2020 2020 2073 656c 662e 736c 6963         self.slic
+0000dd40: 655f 7468 6963 6b6e 6573 735f 636f 6e74  e_thickness_cont
+0000dd50: 6f75 7273 203d 2064 7a0a 0a20 2020 2064  ours = dz..    d
+0000dd60: 6566 2067 6574 5f73 6c69 6365 5f74 6869  ef get_slice_thi
+0000dd70: 636b 6e65 7373 5f63 6f6e 746f 7572 7328  ckness_contours(
+0000dd80: 7365 6c66 293a 0a20 2020 2020 2020 2022  self):.        "
+0000dd90: 2222 4765 7420 7a20 766f 7865 6c20 7369  ""Get z voxel si
+0000dda0: 7a65 2075 7369 6e67 2070 6f73 6974 696f  ze using positio
+0000ddb0: 6e73 206f 6620 636f 6e74 6f75 7273 2e22  ns of contours."
+0000ddc0: 2222 0a0a 2020 2020 2020 2020 636f 6e74  ""..        cont
+0000ddd0: 6f75 7273 203d 2073 656c 662e 6765 745f  ours = self.get_
+0000dde0: 636f 6e74 6f75 7273 2822 782d 7922 290a  contours("x-y").
+0000ddf0: 2020 2020 2020 2020 7a5f 6b65 7973 203d          z_keys =
+0000de00: 2073 6f72 7465 6428 636f 6e74 6f75 7273   sorted(contours
+0000de10: 2e6b 6579 7328 2929 0a20 2020 2020 2020  .keys()).       
+0000de20: 2069 6620 6c65 6e28 7a5f 6b65 7973 2920   if len(z_keys) 
+0000de30: 3c20 323a 0a20 2020 2020 2020 2020 2020  < 2:.           
+0000de40: 2069 6620 7365 6c66 2e73 6f75 7263 655f   if self.source_
+0000de50: 7479 7065 203d 3d20 2263 6f6e 746f 7572  type == "contour
+0000de60: 2220 616e 6420 7365 6c66 2e73 6c69 6365  " and self.slice
+0000de70: 5f74 6869 636b 6e65 7373 5f63 6f6e 746f  _thickness_conto
+0000de80: 7572 733a 0a20 2020 2020 2020 2020 2020  urs:.           
+0000de90: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+0000dea0: 2e73 6c69 6365 5f74 6869 636b 6e65 7373  .slice_thickness
+0000deb0: 5f63 6f6e 746f 7572 730a 2020 2020 2020  _contours.      
+0000dec0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+0000ded0: 2020 2020 2020 2020 2020 2020 766f 7865              voxe
+0000dee0: 6c5f 7369 7a65 203d 2073 656c 662e 6765  l_size = self.ge
+0000def0: 745f 766f 7865 6c5f 7369 7a65 2829 0a20  t_voxel_size(). 
+0000df00: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0000df10: 6620 766f 7865 6c5f 7369 7a65 2069 7320  f voxel_size is 
+0000df20: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
+0000df30: 2020 2020 2020 2020 2020 2020 2020 7265                re
+0000df40: 7475 726e 2076 6f78 656c 5f73 697a 655b  turn voxel_size[
+0000df50: 325d 0a20 2020 2020 2020 2020 2020 2020  2].             
+0000df60: 2020 2072 6574 7572 6e0a 2020 2020 2020     return.      
+0000df70: 2020 6469 6666 7320 3d20 5b7a 5f6b 6579    diffs = [z_key
+0000df80: 735b 695d 202d 207a 5f6b 6579 735b 6920  s[i] - z_keys[i 
+0000df90: 2d20 315d 2066 6f72 2069 2069 6e20 7261  - 1] for i in ra
+0000dfa0: 6e67 6528 312c 206c 656e 287a 5f6b 6579  nge(1, len(z_key
+0000dfb0: 7329 295d 0a20 2020 2020 2020 2072 6574  s))].        ret
+0000dfc0: 7572 6e20 6d69 6e28 6469 6666 7329 0a0a  urn min(diffs)..
+0000dfd0: 2020 2020 6465 6620 6765 745f 6e7a 5f63      def get_nz_c
+0000dfe0: 6f6e 746f 7572 7328 7365 6c66 293a 0a20  ontours(self):. 
+0000dff0: 2020 2020 2020 2022 2222 4765 7420 6e75         """Get nu
+0000e000: 6d62 6572 206f 6620 766f 7865 6c73 2069  mber of voxels i
+0000e010: 6e20 7468 6520 7a20 6469 7265 6374 696f  n the z directio
+0000e020: 6e20 7573 696e 6720 706f 7369 7469 6f6e  n using position
+0000e030: 7320 6f66 2063 6f6e 746f 7572 732e 2222  s of contours.""
+0000e040: 220a 0a20 2020 2020 2020 2076 7a20 3d20  "..        vz = 
+0000e050: 7365 6c66 2e67 6574 5f73 6c69 6365 5f74  self.get_slice_t
+0000e060: 6869 636b 6e65 7373 5f63 6f6e 746f 7572  hickness_contour
+0000e070: 7328 290a 2020 2020 2020 2020 7a5f 6b65  s().        z_ke
+0000e080: 7973 203d 206c 6973 7428 7365 6c66 2e67  ys = list(self.g
+0000e090: 6574 5f63 6f6e 746f 7572 7328 2278 2d79  et_contours("x-y
+0000e0a0: 2229 2e6b 6579 7328 2929 0a20 2020 2020  ").keys()).     
+0000e0b0: 2020 2072 6574 7572 6e20 696e 7428 286d     return int((m
+0000e0c0: 6178 287a 5f6b 6579 7329 202d 206d 696e  ax(z_keys) - min
+0000e0d0: 287a 5f6b 6579 7329 2920 2f20 767a 2920  (z_keys)) / vz) 
+0000e0e0: 2b20 310a 0a20 2020 2064 6566 2067 6574  + 1..    def get
+0000e0f0: 5f63 656e 7472 6528 0a20 2020 2020 2020  _centre(.       
+0000e100: 2073 656c 662c 200a 2020 2020 2020 2020   self, .        
+0000e110: 7669 6577 3d22 782d 7922 2c20 0a20 2020  view="x-y", .   
+0000e120: 2020 2020 2073 696e 676c 655f 736c 6963       single_slic
+0000e130: 653d 4661 6c73 652c 0a20 2020 2020 2020  e=False,.       
+0000e140: 2073 6c3d 4e6f 6e65 2c20 0a20 2020 2020   sl=None, .     
+0000e150: 2020 2069 6478 3d4e 6f6e 652c 200a 2020     idx=None, .  
+0000e160: 2020 2020 2020 706f 733d 4e6f 6e65 2c20        pos=None, 
+0000e170: 0a20 2020 2020 2020 206d 6574 686f 643d  .        method=
+0000e180: 4e6f 6e65 2c0a 2020 2020 293a 0a20 2020  None,.    ):.   
+0000e190: 2020 2020 2022 2222 4765 7420 6365 6e74       """Get cent
+0000e1a0: 7265 2070 6f73 6974 696f 6e20 696e 2032  re position in 2
+0000e1b0: 4420 6f72 2033 4420 696e 206d 6d2e 2222  D or 3D in mm.""
+0000e1c0: 220a 0a20 2020 2020 2020 2023 2047 6574  "..        # Get
+0000e1d0: 2064 6566 6175 6c74 2073 6c69 6365 2069   default slice i
+0000e1e0: 6e64 6578 2061 6e64 206d 6574 686f 640a  ndex and method.
+0000e1f0: 2020 2020 2020 2020 7365 6c66 2e6c 6f61          self.loa
+0000e200: 6428 290a 2020 2020 2020 2020 6966 2073  d().        if s
+0000e210: 6c20 6973 204e 6f6e 6520 616e 6420 6964  l is None and id
+0000e220: 7820 6973 204e 6f6e 6520 616e 6420 706f  x is None and po
+0000e230: 7320 6973 204e 6f6e 653a 200a 2020 2020  s is None: .    
+0000e240: 2020 2020 2020 2020 6964 7820 3d20 7365          idx = se
+0000e250: 6c66 2e67 6574 5f6d 6964 5f69 6478 2876  lf.get_mid_idx(v
+0000e260: 6965 7729 0a20 2020 2020 2020 2069 6620  iew).        if 
+0000e270: 6d65 7468 6f64 2069 7320 4e6f 6e65 3a0a  method is None:.
+0000e280: 2020 2020 2020 2020 2020 2020 6d65 7468              meth
+0000e290: 6f64 203d 2073 656c 662e 6465 6661 756c  od = self.defaul
+0000e2a0: 745f 6765 6f6d 5f6d 6574 686f 640a 0a20  t_geom_method.. 
+0000e2b0: 2020 2020 2020 2023 2047 6574 206c 6973         # Get lis
+0000e2c0: 7420 6f66 2061 7865 7320 746f 2063 6f6e  t of axes to con
+0000e2d0: 7369 6465 720a 2020 2020 2020 2020 6966  sider.        if
+0000e2e0: 2073 696e 676c 655f 736c 6963 653a 0a20   single_slice:. 
+0000e2f0: 2020 2020 2020 2020 2020 2061 7865 7320             axes 
+0000e300: 3d20 736b 7274 2e69 6d61 6765 2e5f 706c  = skrt.image._pl
+0000e310: 6f74 5f61 7865 735b 7669 6577 5d0a 2020  ot_axes[view].  
+0000e320: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+0000e330: 2020 2020 2020 2020 6178 6573 203d 2073          axes = s
+0000e340: 6b72 742e 696d 6167 652e 5f61 7865 730a  krt.image._axes.
+0000e350: 0a20 2020 2020 2020 2023 2047 6574 2063  .        # Get c
+0000e360: 656e 7472 6520 696e 206d 6d0a 2020 2020  entre in mm.    
+0000e370: 2020 2020 6365 6e74 7265 203d 205b 5d0a      centre = [].
+0000e380: 2020 2020 2020 2020 666f 7220 6178 2069          for ax i
+0000e390: 6e20 6178 6573 3a0a 2020 2020 2020 2020  n axes:.        
+0000e3a0: 2020 2020 6578 7465 6e74 203d 2073 656c      extent = sel
+0000e3b0: 662e 6765 745f 6578 7465 6e74 280a 2020  f.get_extent(.  
+0000e3c0: 2020 2020 2020 2020 2020 2020 2020 6178                ax
+0000e3d0: 3d61 782c 0a20 2020 2020 2020 2020 2020  =ax,.           
+0000e3e0: 2020 2020 2073 696e 676c 655f 736c 6963       single_slic
+0000e3f0: 653d 7369 6e67 6c65 5f73 6c69 6365 2c0a  e=single_slice,.
+0000e400: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e410: 7669 6577 3d76 6965 772c 0a20 2020 2020  view=view,.     
+0000e420: 2020 2020 2020 2020 2020 2073 6c3d 736c             sl=sl
+0000e430: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0000e440: 2020 6964 783d 6964 782c 0a20 2020 2020    idx=idx,.     
+0000e450: 2020 2020 2020 2020 2020 2070 6f73 3d70             pos=p
+0000e460: 6f73 2c0a 2020 2020 2020 2020 2020 2020  os,.            
+0000e470: 2020 2020 6d65 7468 6f64 3d6d 6574 686f      method=metho
+0000e480: 642c 0a20 2020 2020 2020 2020 2020 2029  d,.            )
+0000e490: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+0000e4a0: 4e6f 6e65 2069 6e20 6578 7465 6e74 3a0a  None in extent:.
+0000e4b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e4c0: 6365 6e74 7265 2e61 7070 656e 6428 4e6f  centre.append(No
+0000e4d0: 6e65 290a 2020 2020 2020 2020 2020 2020  ne).            
+0000e4e0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+0000e4f0: 2020 2020 2020 6365 6e74 7265 2e61 7070        centre.app
+0000e500: 656e 6428 6e70 2e6d 6561 6e28 6578 7465  end(np.mean(exte
+0000e510: 6e74 2929 0a0a 2020 2020 2020 2020 7265  nt))..        re
+0000e520: 7475 726e 206e 702e 6172 7261 7928 6365  turn np.array(ce
+0000e530: 6e74 7265 290a 0a20 2020 2064 6566 2067  ntre)..    def g
+0000e540: 6574 5f76 6f6c 756d 6528 0a20 2020 2020  et_volume(.     
+0000e550: 2020 2073 656c 662c 200a 2020 2020 2020     self, .      
+0000e560: 2020 756e 6974 733d 226d 6d22 2c20 0a20    units="mm", . 
+0000e570: 2020 2020 2020 206d 6574 686f 643d 4e6f         method=No
+0000e580: 6e65 2c20 0a20 2020 2020 2020 2066 6f72  ne, .        for
+0000e590: 6365 3d54 7275 650a 2020 2020 293a 0a20  ce=True.    ):. 
+0000e5a0: 2020 2020 2020 2022 2222 4765 7420 524f         """Get RO
+0000e5b0: 4920 766f 6c75 6d65 2e20 5468 6520 6361  I volume. The ca
+0000e5c0: 6c63 756c 6174 6564 2076 6f6c 756d 6520  lculated volume 
+0000e5d0: 7769 6c6c 2062 6520 6361 6368 6564 2069  will be cached i
+0000e5e0: 6e20 0a20 2020 2020 2020 2073 656c 662e  n .        self.
+0000e5f0: 5f76 6f6c 756d 655b 756e 6974 735d 2061  _volume[units] a
+0000e600: 6e64 2072 6574 7572 6e65 6420 6966 2063  nd returned if c
+0000e610: 616c 6c65 6420 6167 6169 6e2c 2075 6e6c  alled again, unl
+0000e620: 6573 7320 666f 7263 653d 5472 7565 2e0a  ess force=True..
+0000e630: 0a20 2020 2020 2020 202a 2a50 6172 616d  .        **Param
+0000e640: 6574 6572 733a 2a2a 0a20 2020 2020 2020  eters:**.       
+0000e650: 200a 2020 2020 2020 2020 756e 6974 7320   .        units 
+0000e660: 3a20 7374 722c 2064 6566 6175 6c74 3d22  : str, default="
+0000e670: 6d6d 220a 2020 2020 2020 2020 2020 2020  mm".            
+0000e680: 556e 6974 7320 6f66 2076 6f6c 756d 652e  Units of volume.
+0000e690: 2043 616e 2062 6520 616e 7920 6f66 3a0a   Can be any of:.
+0000e6a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e6b0: 2d20 226d 6d22 3a20 7265 7475 726e 2076  - "mm": return v
+0000e6c0: 6f6c 756d 6520 696e 206d 696c 6c69 6d65  olume in millime
+0000e6d0: 7472 6573 2063 7562 6564 2e0a 2020 2020  tres cubed..    
+0000e6e0: 2020 2020 2020 2020 2020 2020 2d20 226d              - "m
+0000e6f0: 6c22 3a20 7265 7475 726e 2076 6f6c 756d  l": return volum
+0000e700: 6520 696e 206d 696c 6c69 6c69 7472 6573  e in millilitres
+0000e710: 2e0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000e720: 2020 2d20 2263 6322 3a20 7265 7475 726e    - "cc": return
+0000e730: 2076 6f6c 756d 6520 696e 2063 7562 6963   volume in cubic
+0000e740: 2063 656e 7469 6d65 7472 6573 2028 6571   centimetres (eq
+0000e750: 7569 7661 6c65 6e74 2074 6f20 226d 6c22  uivalent to "ml"
+0000e760: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0000e770: 2020 2d20 2276 6f78 656c 7322 3a20 7265    - "voxels": re
+0000e780: 7475 726e 2076 6f6c 756d 6520 696e 206e  turn volume in n
+0000e790: 756d 6265 7220 6f66 2076 6f78 656c 732e  umber of voxels.
+0000e7a0: 0a0a 2020 2020 2020 2020 2020 2020 4966  ..            If
+0000e7b0: 2075 6e69 7473 3d22 766f 7865 6c73 2220   units="voxels" 
+0000e7c0: 6973 2072 6571 7565 7374 6564 2062 7574  is requested but
+0000e7d0: 2074 6869 7320 524f 4920 6f6e 6c79 2068   this ROI only h
+0000e7e0: 6173 2063 6f6e 746f 7572 7320 616e 6420  as contours and 
+0000e7f0: 6e6f 0a20 2020 2020 2020 2020 2020 2076  no.            v
+0000e800: 6f78 656c 2073 697a 6520 696e 666f 726d  oxel size inform
+0000e810: 6174 696f 6e2c 2061 6e20 6572 726f 7220  ation, an error 
+0000e820: 7769 6c6c 2062 6520 7261 6973 6564 2e0a  will be raised..
+0000e830: 0a20 2020 2020 2020 206d 6574 686f 6420  .        method 
+0000e840: 3a20 7374 722c 2064 6566 6175 6c74 3d4e  : str, default=N
+0000e850: 6f6e 650a 2020 2020 2020 2020 2020 2020  one.            
+0000e860: 4d65 7468 6f64 2074 6f20 7573 6520 666f  Method to use fo
+0000e870: 7220 766f 6c75 6d65 2063 616c 6375 6c61  r volume calcula
+0000e880: 7469 6f6e 2e20 4361 6e20 6265 3a20 0a20  tion. Can be: . 
+0000e890: 2020 2020 2020 2020 2020 2020 2020 202d                 -
+0000e8a0: 2022 636f 6e74 6f75 7222 3a20 636f 6d70   "contour": comp
+0000e8b0: 7574 6520 766f 6c75 6d65 2062 7920 7375  ute volume by su
+0000e8c0: 6d6d 696e 6720 6172 6561 7320 6f66 2073  mming areas of s
+0000e8d0: 6861 7065 6c79 0a20 2020 2020 2020 2020  hapely.         
+0000e8e0: 2020 2020 2020 2020 2070 6f6c 7967 6f6e           polygon
+0000e8f0: 7320 6f6e 2065 6163 6820 736c 6963 6520  s on each slice 
+0000e900: 616e 6420 6d75 6c74 6970 6c79 696e 6720  and multiplying 
+0000e910: 6279 2073 6c69 6365 2074 6869 636b 6e65  by slice thickne
+0000e920: 7373 2e0a 2020 2020 2020 2020 2020 2020  ss..            
+0000e930: 2020 2020 2d20 226d 6173 6b22 3a20 636f      - "mask": co
+0000e940: 6d70 7574 6520 766f 6c75 6d65 2062 7920  mpute volume by 
+0000e950: 7375 6d6d 696e 6720 766f 7865 6c73 2069  summing voxels i
+0000e960: 6e73 6964 6520 7468 6520 524f 4920 616e  nside the ROI an
+0000e970: 640a 2020 2020 2020 2020 2020 2020 2020  d.              
+0000e980: 2020 2020 6d75 6c74 6970 6c79 696e 6720      multiplying 
+0000e990: 6279 2074 6865 2076 6f6c 756d 6520 6f66  by the volume of
+0000e9a0: 206f 6e65 2076 6f78 656c 2e0a 2020 2020   one voxel..    
+0000e9b0: 2020 2020 2020 2020 2020 2020 2d20 4e6f              - No
+0000e9c0: 6e65 3a20 7573 6520 7468 6520 6d65 7468  ne: use the meth
+0000e9d0: 6f64 2073 6574 2069 6e20 7365 6c66 2e64  od set in self.d
+0000e9e0: 6566 6175 6c74 5f67 656f 6d5f 6d65 7468  efault_geom_meth
+0000e9f0: 6f64 2e0a 0a20 2020 2020 2020 2020 2020  od...           
+0000ea00: 204e 6f74 6520 7468 6174 2069 6620 7365   Note that if se
+0000ea10: 6c66 2e67 6574 5f76 6f6c 756d 6520 6861  lf.get_volume ha
+0000ea20: 7320 616c 7265 6164 7920 6265 656e 2063  s already been c
+0000ea30: 616c 6c65 6420 7769 7468 206f 6e65 200a  alled with one .
+0000ea40: 2020 2020 2020 2020 2020 2020 6d65 7468              meth
+0000ea50: 6f64 2c20 7468 6520 7361 6d65 2063 6163  od, the same cac
+0000ea60: 6865 6420 7265 7375 6c74 2077 696c 6c20  hed result will 
+0000ea70: 6265 2072 6574 7572 6e65 6420 6966 2063  be returned if c
+0000ea80: 616c 6c69 6e67 2077 6974 6820 6120 0a20  alling with a . 
+0000ea90: 2020 2020 2020 2020 2020 2064 6966 6665             diffe
+0000eaa0: 7265 6e74 206d 6574 686f 6420 756e 6c65  rent method unle
+0000eab0: 7373 2066 6f72 6365 3d54 7275 652e 0a0a  ss force=True...
+0000eac0: 2020 2020 2020 2020 666f 7263 6520 3a20          force : 
+0000ead0: 626f 6f6c 2c20 6465 6661 756c 743d 5472  bool, default=Tr
+0000eae0: 7565 0a20 2020 2020 2020 2020 2020 2049  ue.            I
+0000eaf0: 6620 5472 7565 2c20 7468 6520 766f 6c75  f True, the volu
+0000eb00: 6d65 2077 696c 6c20 616c 7761 7973 2062  me will always b
+0000eb10: 6520 7265 6361 6c63 756c 6174 6564 3b20  e recalculated; 
+0000eb20: 6f74 6865 7277 6973 652c 2069 7420 7769  otherwise, it wi
+0000eb30: 6c6c 0a20 2020 2020 2020 2020 2020 206f  ll.            o
+0000eb40: 6e6c 7920 6265 2063 616c 6375 6c61 7465  nly be calculate
+0000eb50: 6420 6966 2069 7420 6861 7320 6e6f 7420  d if it has not 
+0000eb60: 7965 7420 6265 656e 2063 6163 6865 6420  yet been cached 
+0000eb70: 696e 2073 656c 662e 5f76 6f6c 756d 652e  in self._volume.
+0000eb80: 0a20 2020 2020 2020 2022 2222 0a0a 2020  .        """..  
+0000eb90: 2020 2020 2020 2320 4966 2061 6c72 6561        # If alrea
+0000eba0: 6479 2063 6163 6865 6420 616e 6420 6e6f  dy cached and no
+0000ebb0: 7420 666f 7263 696e 672c 2072 6574 7572  t forcing, retur
+0000ebc0: 6e0a 2020 2020 2020 2020 6966 2068 6173  n.        if has
+0000ebd0: 6174 7472 2873 656c 662c 2022 5f76 6f6c  attr(self, "_vol
+0000ebe0: 756d 6522 2920 616e 6420 6e6f 7420 666f  ume") and not fo
+0000ebf0: 7263 653a 0a20 2020 2020 2020 2020 2020  rce:.           
+0000ec00: 2069 6620 756e 6974 7320 696e 2073 656c   if units in sel
+0000ec10: 662e 5f76 6f6c 756d 653a 0a20 2020 2020  f._volume:.     
+0000ec20: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+0000ec30: 6e20 7365 6c66 2e5f 766f 6c75 6d65 5b75  n self._volume[u
+0000ec40: 6e69 7473 5d0a 0a20 2020 2020 2020 2073  nits]..        s
+0000ec50: 656c 662e 6c6f 6164 2829 0a20 2020 2020  elf.load().     
+0000ec60: 2020 2069 6620 6d65 7468 6f64 2069 7320     if method is 
+0000ec70: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+0000ec80: 2020 6d65 7468 6f64 203d 2073 656c 662e    method = self.
+0000ec90: 6465 6661 756c 745f 6765 6f6d 5f6d 6574  default_geom_met
+0000eca0: 686f 640a 0a20 2020 2020 2020 2023 204d  hod..        # M
+0000ecb0: 616b 6520 6361 6368 6564 2070 726f 7065  ake cached prope
+0000ecc0: 7274 790a 2020 2020 2020 2020 7365 6c66  rty.        self
+0000ecd0: 2e5f 766f 6c75 6d65 203d 207b 7d0a 0a20  ._volume = {}.. 
+0000ece0: 2020 2020 2020 2023 2043 616c 6375 6c61         # Calcula
+0000ecf0: 7465 2066 726f 6d20 706f 6c79 676f 6e20  te from polygon 
+0000ed00: 6172 6561 730a 2020 2020 2020 2020 6966  areas.        if
+0000ed10: 206d 6574 686f 6420 3d3d 2022 636f 6e74   method == "cont
+0000ed20: 6f75 7222 3a0a 0a20 2020 2020 2020 2020  our":..         
+0000ed30: 2020 2023 2043 6865 636b 2069 7427 7320     # Check it's 
+0000ed40: 706f 7373 6962 6c65 2074 6f20 6361 6c63  possible to calc
+0000ed50: 756c 6174 6520 766f 6c75 6d65 2077 6974  ulate volume wit
+0000ed60: 6820 7468 6520 7265 7175 6573 7465 6420  h the requested 
+0000ed70: 756e 6974 730a 2020 2020 2020 2020 2020  units.          
+0000ed80: 2020 6966 2073 656c 662e 766f 7865 6c5f    if self.voxel_
+0000ed90: 7369 7a65 2069 7320 4e6f 6e65 2061 6e64  size is None and
+0000eda0: 2075 6e69 7473 203d 3d20 2276 6f78 656c   units == "voxel
+0000edb0: 7322 3a0a 2020 2020 2020 2020 2020 2020  s":.            
+0000edc0: 2020 2020 7261 6973 6520 5275 6e74 696d      raise Runtim
+0000edd0: 6545 7272 6f72 2822 4361 6e6e 6f74 2063  eError("Cannot c
+0000ede0: 6f6d 7075 7465 2076 6f6c 756d 6520 696e  ompute volume in
+0000edf0: 2076 6f78 656c 7320 6672 6f6d 2022 0a20   voxels from ". 
+0000ee00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ee10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ee20: 2020 2263 6f6e 746f 7572 7320 7769 7468    "contours with
+0000ee30: 6f75 7420 6b6e 6f77 696e 6720 766f 7865  out knowing voxe
+0000ee40: 6c20 7369 7a65 7321 2229 0a0a 2020 2020  l sizes!")..    
+0000ee50: 2020 2020 2020 2020 2320 4361 6c63 756c          # Calcul
+0000ee60: 6174 6520 6172 6561 206f 6e20 6561 6368  ate area on each
+0000ee70: 2073 6c69 6365 0a20 2020 2020 2020 2020   slice.         
+0000ee80: 2020 2073 6c69 6365 5f61 7265 6173 203d     slice_areas =
+0000ee90: 205b 5d0a 2020 2020 2020 2020 2020 2020   [].            
+0000eea0: 666f 7220 6964 7820 696e 2073 656c 662e  for idx in self.
+0000eeb0: 6765 745f 636f 6e74 6f75 7273 2822 782d  get_contours("x-
+0000eec0: 7922 2c20 6964 785f 6173 5f6b 6579 3d54  y", idx_as_key=T
+0000eed0: 7275 6529 3a0a 2020 2020 2020 2020 2020  rue):.          
+0000eee0: 2020 2020 2020 736c 6963 655f 6172 6561        slice_area
+0000eef0: 732e 6170 7065 6e64 2873 656c 662e 6765  s.append(self.ge
+0000ef00: 745f 6172 6561 2822 782d 7922 2c20 6964  t_area("x-y", id
+0000ef10: 783d 6964 782c 206d 6574 686f 643d 6d65  x=idx, method=me
+0000ef20: 7468 6f64 2929 0a0a 2020 2020 2020 2020  thod))..        
+0000ef30: 2020 2020 2320 436f 6e76 6572 7420 746f      # Convert to
+0000ef40: 2076 6f6c 756d 6520 696e 206d 6d0a 2020   volume in mm.  
+0000ef50: 2020 2020 2020 2020 2020 6172 6561 5f73            area_s
+0000ef60: 756d 203d 2073 756d 2873 6c69 6365 5f61  um = sum(slice_a
+0000ef70: 7265 6173 290a 2020 2020 2020 2020 2020  reas).          
+0000ef80: 2020 7365 6c66 2e5f 766f 6c75 6d65 5b22    self._volume["
+0000ef90: 6d6d 225d 203d 2061 7265 615f 7375 6d20  mm"] = area_sum 
+0000efa0: 2a20 7365 6c66 2e67 6574 5f73 6c69 6365  * self.get_slice
+0000efb0: 5f74 6869 636b 6e65 7373 5f63 6f6e 746f  _thickness_conto
+0000efc0: 7572 7328 290a 0a20 2020 2020 2020 2020  urs()..         
+0000efd0: 2020 2023 2049 6620 706f 7373 6962 6c65     # If possible
+0000efe0: 2c20 636f 6e76 6572 7420 746f 2076 6f6c  , convert to vol
+0000eff0: 756d 6520 696e 2076 6f78 656c 730a 2020  ume in voxels.  
+0000f000: 2020 2020 2020 2020 2020 6966 2073 656c            if sel
+0000f010: 662e 766f 7865 6c5f 7369 7a65 2069 7320  f.voxel_size is 
+0000f020: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
+0000f030: 2020 2020 2020 2020 2020 7879 5f76 6f78            xy_vox
+0000f040: 656c 5f61 7265 6120 3d20 7365 6c66 2e76  el_area = self.v
+0000f050: 6f78 656c 5f73 697a 655b 305d 202a 2073  oxel_size[0] * s
+0000f060: 656c 662e 766f 7865 6c5f 7369 7a65 5b31  elf.voxel_size[1
+0000f070: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
+0000f080: 2020 7365 6c66 2e5f 766f 6c75 6d65 5b22    self._volume["
+0000f090: 766f 7865 6c73 225d 203d 2061 7265 615f  voxels"] = area_
+0000f0a0: 7375 6d20 2f20 7879 5f76 6f78 656c 5f61  sum / xy_voxel_a
+0000f0b0: 7265 610a 0a20 2020 2020 2020 2023 204f  rea..        # O
+0000f0c0: 7468 6572 7769 7365 2c20 6361 6c63 756c  therwise, calcul
+0000f0d0: 6174 6520 6672 6f6d 206e 756d 6265 7220  ate from number 
+0000f0e0: 6f66 2076 6f78 656c 7320 696e 206d 6173  of voxels in mas
+0000f0f0: 6b0a 2020 2020 2020 2020 656c 7365 3a0a  k.        else:.
+0000f100: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0000f110: 2e63 7265 6174 655f 6d61 736b 2829 0a20  .create_mask(). 
+0000f120: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0000f130: 5f76 6f6c 756d 655b 2276 6f78 656c 7322  _volume["voxels"
+0000f140: 5d20 3d20 7365 6c66 2e6d 6173 6b2e 6461  ] = self.mask.da
+0000f150: 7461 2e61 7374 7970 6528 626f 6f6c 292e  ta.astype(bool).
+0000f160: 7375 6d28 290a 2020 2020 2020 2020 2020  sum().          
+0000f170: 2020 766f 7865 6c5f 766f 6c20 3d20 6162    voxel_vol = ab
+0000f180: 7328 6e70 2e70 726f 6428 7365 6c66 2e67  s(np.prod(self.g
+0000f190: 6574 5f76 6f78 656c 5f73 697a 6528 2929  et_voxel_size())
+0000f1a0: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
+0000f1b0: 6c66 2e5f 766f 6c75 6d65 5b22 6d6d 225d  lf._volume["mm"]
+0000f1c0: 203d 2073 656c 662e 5f76 6f6c 756d 655b   = self._volume[
+0000f1d0: 2276 6f78 656c 7322 5d20 2a20 766f 7865  "voxels"] * voxe
+0000f1e0: 6c5f 766f 6c0a 0a20 2020 2020 2020 2023  l_vol..        #
+0000f1f0: 2047 6574 2076 6f6c 756d 6520 696e 206d   Get volume in m
+0000f200: 6c20 6f72 2065 7175 6976 616c 656e 746c  l or equivalentl
+0000f210: 7920 6363 0a20 2020 2020 2020 2073 656c  y cc.        sel
+0000f220: 662e 5f76 6f6c 756d 655b 226d 6c22 5d20  f._volume["ml"] 
+0000f230: 3d20 7365 6c66 2e5f 766f 6c75 6d65 5b22  = self._volume["
+0000f240: 6d6d 225d 202f 2031 3030 300a 2020 2020  mm"] / 1000.    
+0000f250: 2020 2020 7365 6c66 2e5f 766f 6c75 6d65      self._volume
+0000f260: 5b22 6363 225d 203d 2073 656c 662e 5f76  ["cc"] = self._v
+0000f270: 6f6c 756d 655b 226d 6c22 5d0a 0a20 2020  olume["ml"]..   
+0000f280: 2020 2020 2023 2052 6574 7572 6e20 766f       # Return vo
+0000f290: 6c75 6d65 2069 6e20 7468 6520 7265 7175  lume in the requ
+0000f2a0: 6573 7465 6420 756e 6974 730a 2020 2020  ested units.    
+0000f2b0: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
+0000f2c0: 5f76 6f6c 756d 655b 756e 6974 735d 0a0a  _volume[units]..
+0000f2d0: 2020 2020 6465 6620 6765 745f 6d61 736b      def get_mask
+0000f2e0: 5f74 6f5f 636f 6e74 6f75 725f 766f 6c75  _to_contour_volu
+0000f2f0: 6d65 5f72 6174 696f 2873 656c 6629 3a0a  me_ratio(self):.
+0000f300: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+0000f310: 2020 2020 4765 7420 7261 7469 6f20 746f      Get ratio to
+0000f320: 2052 4f49 2022 6d61 736b 2220 766f 6c75   ROI "mask" volu
+0000f330: 6d65 2074 6f20 524f 4920 2263 6f6e 746f  me to ROI "conto
+0000f340: 7572 2220 766f 6c75 6d65 2e0a 0a20 2020  ur" volume...   
+0000f350: 2020 2020 2049 6e20 7072 696e 6369 706c       In principl
+0000f360: 652c 2076 6f6c 756d 6520 6573 7469 6d61  e, volume estima
+0000f370: 7465 7320 6672 6f6d 2022 6d61 736b 2220  tes from "mask" 
+0000f380: 616e 6420 2263 6f6e 746f 7572 2220 6d65  and "contour" me
+0000f390: 7468 6f64 730a 2020 2020 2020 2020 7368  thods.        sh
+0000f3a0: 6f75 6c64 2062 6520 7369 6d69 6c61 722e  ould be similar.
+0000f3b0: 2020 5468 6520 7477 6f20 6573 7469 6d61    The two estima
+0000f3c0: 7465 7320 6d61 7920 6265 2064 6966 6665  tes may be diffe
+0000f3d0: 7265 6e74 2069 662c 2066 6f72 0a20 2020  rent if, for.   
+0000f3e0: 2020 2020 2065 7861 6d70 6c65 2c20 7468       example, th
+0000f3f0: 6520 696d 6167 6520 6672 6f6d 2077 6869  e image from whi
+0000f400: 6368 2061 206d 6173 6b20 6973 2063 7265  ch a mask is cre
+0000f410: 6174 6564 2064 6f65 736e 2774 2066 756c  ated doesn't ful
+0000f420: 6c79 2063 6f76 6572 0a20 2020 2020 2020  ly cover.       
+0000f430: 2074 6865 2063 6f6e 746f 7572 2065 7874   the contour ext
+0000f440: 656e 7473 2e0a 2020 2020 2020 2020 2222  ents..        ""
+0000f450: 220a 2020 2020 2020 2020 7265 7475 726e  ".        return
+0000f460: 2028 7365 6c66 2e67 6574 5f76 6f6c 756d   (self.get_volum
+0000f470: 6528 6d65 7468 6f64 3d22 6d61 736b 222c  e(method="mask",
+0000f480: 2066 6f72 6365 3d54 7275 6529 202f 0a20   force=True) /. 
+0000f490: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0000f4a0: 656c 662e 6765 745f 766f 6c75 6d65 286d  elf.get_volume(m
+0000f4b0: 6574 686f 643d 2263 6f6e 746f 7572 222c  ethod="contour",
+0000f4c0: 2066 6f72 6365 3d54 7275 6529 290a 0a20   force=True)).. 
+0000f4d0: 2020 2064 6566 2067 6574 5f61 7265 6128     def get_area(
+0000f4e0: 0a20 2020 2020 2020 2073 656c 662c 200a  .        self, .
+0000f4f0: 2020 2020 2020 2020 7669 6577 3d22 782d          view="x-
+0000f500: 7922 2c20 0a20 2020 2020 2020 2073 6c3d  y", .        sl=
+0000f510: 4e6f 6e65 2c20 0a20 2020 2020 2020 2069  None, .        i
+0000f520: 6478 3d4e 6f6e 652c 200a 2020 2020 2020  dx=None, .      
+0000f530: 2020 706f 733d 4e6f 6e65 2c20 0a20 2020    pos=None, .   
+0000f540: 2020 2020 2075 6e69 7473 3d22 6d6d 222c       units="mm",
+0000f550: 200a 2020 2020 2020 2020 6d65 7468 6f64   .        method
+0000f560: 3d4e 6f6e 652c 0a20 2020 2020 2020 2066  =None,.        f
+0000f570: 6c61 7474 656e 3d46 616c 7365 2c0a 2020  latten=False,.  
+0000f580: 2020 293a 0a20 2020 2020 2020 2022 2222    ):.        """
+0000f590: 4765 7420 7468 6520 6172 6561 206f 6620  Get the area of 
+0000f5a0: 7468 6520 524f 4920 6f6e 2061 2067 6976  the ROI on a giv
+0000f5b0: 656e 2073 6c69 6365 2e0a 0a20 2020 2020  en slice...     
+0000f5c0: 2020 202a 2a50 6172 616d 6574 6572 733a     **Parameters:
+0000f5d0: 2a2a 0a20 2020 2020 2020 200a 2020 2020  **.        .    
+0000f5e0: 2020 2020 7669 6577 203a 2073 7472 2c20      view : str, 
+0000f5f0: 6465 6661 756c 743d 2278 2d79 220a 2020  default="x-y".  
+0000f600: 2020 2020 2020 2020 2020 4f72 6965 6e74            Orient
+0000f610: 6174 696f 6e20 6f66 2073 6c69 6365 2066  ation of slice f
+0000f620: 6f72 2077 6869 6368 2074 6f20 6765 7420  or which to get 
+0000f630: 6172 6561 2e0a 0a20 2020 2020 2020 2073  area...        s
+0000f640: 6c20 3a20 696e 742c 2064 6566 6175 6c74  l : int, default
+0000f650: 3d4e 6f6e 650a 2020 2020 2020 2020 2020  =None.          
+0000f660: 2020 536c 6963 6520 6e75 6d62 6572 2e20    Slice number. 
+0000f670: 4966 206e 6f6e 6520 6f66 203c 736c 3e2c  If none of <sl>,
+0000f680: 203c 6964 783e 206f 7220 3c70 6f73 3e20   <idx> or <pos> 
+0000f690: 6172 6520 7375 7070 6c69 6564 2062 7574  are supplied but
+0000f6a0: 0a20 2020 2020 2020 2020 2020 203c 7369  .            <si
+0000f6b0: 6e67 6c65 5f73 6c69 6365 3e20 6973 2054  ngle_slice> is T
+0000f6c0: 7275 652c 2074 6865 2063 656e 7472 616c  rue, the central
+0000f6d0: 2073 6c69 6365 206f 6620 7468 6520 524f   slice of the RO
+0000f6e0: 4920 7769 6c6c 2062 6520 7573 6564 2e0a  I will be used..
+0000f6f0: 0a20 2020 2020 2020 2069 6478 203a 2069  .        idx : i
+0000f700: 6e74 2c20 6465 6661 756c 743d 4e6f 6e65  nt, default=None
+0000f710: 0a20 2020 2020 2020 2020 2020 2041 7272  .            Arr
+0000f720: 6179 2069 6e64 6578 206f 6620 736c 6963  ay index of slic
+0000f730: 652e 2049 6620 6e6f 6e65 206f 6620 3c73  e. If none of <s
+0000f740: 6c3e 2c20 3c69 6478 3e20 6f72 203c 706f  l>, <idx> or <po
+0000f750: 733e 2061 7265 2073 7570 706c 6965 6420  s> are supplied 
+0000f760: 6275 740a 2020 2020 2020 2020 2020 2020  but.            
+0000f770: 3c73 696e 676c 655f 736c 6963 653e 2069  <single_slice> i
+0000f780: 7320 5472 7565 2c20 7468 6520 6365 6e74  s True, the cent
+0000f790: 7261 6c20 736c 6963 6520 6f66 2074 6865  ral slice of the
+0000f7a0: 2052 4f49 2077 696c 6c20 6265 2075 7365   ROI will be use
+0000f7b0: 642e 0a0a 2020 2020 2020 2020 706f 7320  d...        pos 
+0000f7c0: 3a20 666c 6f61 742c 2064 6566 6175 6c74  : float, default
+0000f7d0: 3d4e 6f6e 650a 2020 2020 2020 2020 2020  =None.          
+0000f7e0: 2020 536c 6963 6520 706f 7369 7469 6f6e    Slice position
+0000f7f0: 2069 6e20 6d6d 2e20 4966 206e 6f6e 6520   in mm. If none 
+0000f800: 6f66 203c 736c 3e2c 203c 6964 783e 206f  of <sl>, <idx> o
+0000f810: 7220 3c70 6f73 3e20 6172 6520 7375 7070  r <pos> are supp
+0000f820: 6c69 6564 2062 7574 0a20 2020 2020 2020  lied but.       
+0000f830: 2020 2020 203c 7369 6e67 6c65 5f73 6c69       <single_sli
+0000f840: 6365 3e20 6973 2054 7275 652c 2074 6865  ce> is True, the
+0000f850: 2063 656e 7472 616c 2073 6c69 6365 206f   central slice o
+0000f860: 6620 7468 6520 524f 4920 7769 6c6c 2062  f the ROI will b
+0000f870: 6520 7573 6564 2e0a 0a20 2020 2020 2020  e used...       
+0000f880: 2075 6e69 7473 203a 2073 7472 2c20 6465   units : str, de
+0000f890: 6661 756c 743d 226d 6d22 0a20 2020 2020  fault="mm".     
+0000f8a0: 2020 2020 2020 2055 6e69 7473 206f 6620         Units of 
+0000f8b0: 6172 6561 2e20 4361 6e20 6265 2065 6974  area. Can be eit
+0000f8c0: 6865 7220 6f66 3a0a 0a20 2020 2020 2020  her of:..       
+0000f8d0: 2020 2020 2020 2020 202a 2022 6d6d 223a           * "mm":
+0000f8e0: 2072 6574 7572 6e20 6172 6561 2069 6e20   return area in 
+0000f8f0: 6d69 6c6c 696d 6574 7265 7320 7371 7561  millimetres squa
+0000f900: 7265 642e 0a20 2020 2020 2020 2020 2020  red..           
+0000f910: 2020 2020 202a 2022 766f 7865 6c73 223a       * "voxels":
+0000f920: 2072 6574 7572 6e20 6172 6561 2069 6e20   return area in 
+0000f930: 6e75 6d62 6572 206f 6620 766f 7865 6c73  number of voxels
+0000f940: 2e0a 0a20 2020 2020 2020 2020 2020 2049  ...            I
+0000f950: 6620 756e 6974 733d 2276 6f78 656c 7322  f units="voxels"
+0000f960: 2069 7320 7265 7175 6573 7465 6420 6275   is requested bu
+0000f970: 7420 7468 6973 2052 4f49 206f 6e6c 7920  t this ROI only 
+0000f980: 6861 7320 636f 6e74 6f75 7273 2061 6e64  has contours and
+0000f990: 206e 6f0a 2020 2020 2020 2020 2020 2020   no.            
+0000f9a0: 766f 7865 6c20 7369 7a65 2069 6e66 6f72  voxel size infor
+0000f9b0: 6d61 7469 6f6e 2c20 616e 2065 7272 6f72  mation, an error
+0000f9c0: 2077 696c 6c20 6265 2072 6169 7365 642e   will be raised.
+0000f9d0: 0a0a 2020 2020 2020 2020 6d65 7468 6f64  ..        method
+0000f9e0: 203a 2073 7472 2c20 6465 6661 756c 743d   : str, default=
+0000f9f0: 4e6f 6e65 0a20 2020 2020 2020 2020 2020  None.           
+0000fa00: 204d 6574 686f 6420 746f 2075 7365 2066   Method to use f
+0000fa10: 6f72 2061 7265 6120 6361 6c63 756c 6174  or area calculat
+0000fa20: 696f 6e2e 2043 616e 2062 653a 200a 0a20  ion. Can be: .. 
+0000fa30: 2020 2020 2020 2020 2020 2020 2020 202a                 *
+0000fa40: 2022 636f 6e74 6f75 7222 3a20 636f 6d70   "contour": comp
+0000fa50: 7574 6520 6172 6561 2066 726f 6d20 7368  ute area from sh
+0000fa60: 6170 656c 7920 706f 6c79 676f 6e20 6f6e  apely polygon on
+0000fa70: 2074 6865 2073 6c69 6365 2e0a 2020 2020   the slice..    
+0000fa80: 2020 2020 2020 2020 2020 2020 2a20 226d              * "m
+0000fa90: 6173 6b22 3a20 636f 6d70 7574 6520 6172  ask": compute ar
+0000faa0: 6561 2062 7920 7375 6d6d 696e 6720 7069  ea by summing pi
+0000fab0: 7865 6c73 206f 6e20 7468 6520 736c 6963  xels on the slic
+0000fac0: 6520 616e 6420 0a20 2020 2020 2020 2020  e and .         
+0000fad0: 2020 2020 2020 2020 206d 756c 7469 706c           multipl
+0000fae0: 7969 6e67 2062 7920 7468 6520 6172 6561  ying by the area
+0000faf0: 206f 6620 6f6e 6520 7069 7865 6c2e 0a20   of one pixel.. 
+0000fb00: 2020 2020 2020 2020 2020 2020 2020 202a                 *
+0000fb10: 204e 6f6e 653a 2075 7365 2074 6865 206d   None: use the m
+0000fb20: 6574 686f 6420 7365 7420 696e 2073 656c  ethod set in sel
+0000fb30: 662e 6465 6661 756c 745f 6765 6f6d 5f6d  f.default_geom_m
+0000fb40: 6574 686f 642e 0a0a 2020 2020 2020 2020  ethod...        
+0000fb50: 666c 6174 7465 6e20 3a20 626f 6f6c 2c20  flatten : bool, 
+0000fb60: 6465 6661 756c 743d 4661 6c73 650a 2020  default=False.  
+0000fb70: 2020 2020 2020 2020 2020 4966 2054 7275            If Tru
+0000fb80: 652c 2061 6c6c 2073 6c69 6365 7320 7769  e, all slices wi
+0000fb90: 6c6c 2062 6520 666c 6174 7465 6e65 6420  ll be flattened 
+0000fba0: 696e 2074 6865 2067 6976 656e 206f 7269  in the given ori
+0000fbb0: 656e 7461 7469 6f6e 2061 6e64 0a20 2020  entation and.   
+0000fbc0: 2020 2020 2020 2020 2074 6865 2061 7265           the are
+0000fbd0: 6120 6f66 2074 6865 2066 6c61 7474 656e  a of the flatten
+0000fbe0: 6564 2073 6c69 6365 2077 696c 6c20 6265  ed slice will be
+0000fbf0: 2072 6574 7572 6e65 642e 204f 6e6c 7920   returned. Only 
+0000fc00: 6176 6169 6c61 626c 650a 2020 2020 2020  available.      
+0000fc10: 2020 2020 2020 6966 206d 6574 686f 643d        if method=
+0000fc20: 226d 6173 6b22 2e0a 2020 2020 2020 2020  "mask"..        
+0000fc30: 2222 220a 0a20 2020 2020 2020 2023 2047  """..        # G
+0000fc40: 6574 2064 6566 6175 6c74 2073 6c69 6365  et default slice
+0000fc50: 2069 6e64 6578 2061 6e64 206d 6574 686f   index and metho
+0000fc60: 640a 2020 2020 2020 2020 7365 6c66 2e6c  d.        self.l
+0000fc70: 6f61 6428 290a 2020 2020 2020 2020 6966  oad().        if
+0000fc80: 2073 6c20 6973 204e 6f6e 6520 616e 6420   sl is None and 
+0000fc90: 6964 7820 6973 204e 6f6e 6520 616e 6420  idx is None and 
+0000fca0: 706f 7320 6973 204e 6f6e 653a 200a 2020  pos is None: .  
+0000fcb0: 2020 2020 2020 2020 2020 6964 7820 3d20            idx = 
+0000fcc0: 7365 6c66 2e67 6574 5f6d 6964 5f69 6478  self.get_mid_idx
+0000fcd0: 2876 6965 7729 0a20 2020 2020 2020 2069  (view).        i
+0000fce0: 6620 6d65 7468 6f64 2069 7320 4e6f 6e65  f method is None
+0000fcf0: 3a0a 2020 2020 2020 2020 2020 2020 6d65  :.            me
+0000fd00: 7468 6f64 203d 2073 656c 662e 6465 6661  thod = self.defa
+0000fd10: 756c 745f 6765 6f6d 5f6d 6574 686f 640a  ult_geom_method.
+0000fd20: 0a20 2020 2020 2020 2023 2049 6620 524f  .        # If RO
+0000fd30: 4920 6973 206e 6f74 206f 6e20 7468 6520  I is not on the 
+0000fd40: 6769 7665 6e20 736c 6963 652c 2072 6574  given slice, ret
+0000fd50: 7572 6e20 4e6f 6e65 0a20 2020 2020 2020  urn None.       
+0000fd60: 2069 6620 6e6f 7420 7365 6c66 2e6f 6e5f   if not self.on_
+0000fd70: 736c 6963 6528 7669 6577 2c20 736c 3d73  slice(view, sl=s
+0000fd80: 6c2c 2069 6478 3d69 6478 2c20 706f 733d  l, idx=idx, pos=
+0000fd90: 706f 7329 3a0a 2020 2020 2020 2020 2020  pos):.          
+0000fda0: 2020 7265 7475 726e 0a0a 2020 2020 2020    return..      
+0000fdb0: 2020 6966 2066 6c61 7474 656e 3a20 2023    if flatten:  #
+0000fdc0: 2046 6c61 7474 656e 696e 6720 6f6e 6c79   Flattening only
+0000fdd0: 2070 6f73 7369 626c 6520 7769 7468 2022   possible with "
+0000fde0: 6d61 736b 220a 2020 2020 2020 2020 2020  mask".          
+0000fdf0: 2020 6d65 7468 6f64 203d 2022 6d61 736b    method = "mask
+0000fe00: 220a 0a20 2020 2020 2020 2023 2043 616c  "..        # Cal
+0000fe10: 6375 6c61 7465 2061 7265 6120 6672 6f6d  culate area from
+0000fe20: 2073 6861 7065 6c79 2070 6f6c 7967 6f6e   shapely polygon
+0000fe30: 2873 290a 2020 2020 2020 2020 6966 206d  (s).        if m
+0000fe40: 6574 686f 6420 3d3d 2022 636f 6e74 6f75  ethod == "contou
+0000fe50: 7222 3a0a 0a20 2020 2020 2020 2020 2020  r":..           
+0000fe60: 2023 2043 6865 636b 2069 7427 7320 706f   # Check it's po
+0000fe70: 7373 6962 6c65 2074 6f20 6361 6c63 756c  ssible to calcul
+0000fe80: 6174 6520 6172 6561 2077 6974 6820 7468  ate area with th
+0000fe90: 6520 7265 7175 6573 7465 6420 756e 6974  e requested unit
+0000fea0: 730a 2020 2020 2020 2020 2020 2020 6966  s.            if
+0000feb0: 2073 656c 662e 766f 7865 6c5f 7369 7a65   self.voxel_size
+0000fec0: 2069 7320 4e6f 6e65 2061 6e64 2075 6e69   is None and uni
+0000fed0: 7473 203d 3d20 2276 6f78 656c 7322 3a0a  ts == "voxels":.
+0000fee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fef0: 7261 6973 6520 5275 6e74 696d 6545 7272  raise RuntimeErr
+0000ff00: 6f72 2822 4361 6e6e 6f74 2063 6f6d 7075  or("Cannot compu
+0000ff10: 7465 2061 7265 6120 696e 2076 6f78 656c  te area in voxel
+0000ff20: 7320 6672 6f6d 2022 0a20 2020 2020 2020  s from ".       
+0000ff30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ff40: 2020 2020 2020 2020 2020 2020 2263 6f6e              "con
+0000ff50: 746f 7572 7320 7769 7468 6f75 7420 6b6e  tours without kn
+0000ff60: 6f77 696e 6720 766f 7865 6c20 7369 7a65  owing voxel size
+0000ff70: 7321 2229 0a0a 2020 2020 2020 2020 2020  s!")..          
+0000ff80: 2020 706f 6c79 676f 6e73 203d 2073 656c    polygons = sel
+0000ff90: 662e 6765 745f 706f 6c79 676f 6e73 5f6f  f.get_polygons_o
+0000ffa0: 6e5f 736c 6963 6528 7669 6577 2c20 736c  n_slice(view, sl
+0000ffb0: 2c20 6964 782c 2070 6f73 290a 2020 2020  , idx, pos).    
+0000ffc0: 2020 2020 2020 2020 6172 6561 203d 2073          area = s
+0000ffd0: 756d 285b 702e 6172 6561 2066 6f72 2070  um([p.area for p
+0000ffe0: 2069 6e20 706f 6c79 676f 6e73 5d29 0a20   in polygons]). 
+0000fff0: 2020 2020 2020 2020 2020 2069 6620 756e             if un
+00010000: 6974 7320 3d3d 2022 766f 7865 6c73 223a  its == "voxels":
+00010010: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00010020: 2078 5f61 782c 2079 5f61 7820 3d20 736b   x_ax, y_ax = sk
+00010030: 7274 2e69 6d61 6765 2e5f 706c 6f74 5f61  rt.image._plot_a
+00010040: 7865 735b 7669 6577 5d0a 2020 2020 2020  xes[view].      
+00010050: 2020 2020 2020 2020 2020 7879 5f61 7265            xy_are
+00010060: 6120 3d20 6162 7328 7365 6c66 2e76 6f78  a = abs(self.vox
+00010070: 656c 5f73 697a 655b 785f 6178 5d20 2a20  el_size[x_ax] * 
+00010080: 7365 6c66 2e76 6f78 656c 5f73 697a 655b  self.voxel_size[
+00010090: 795f 6178 5d29 0a20 2020 2020 2020 2020  y_ax]).         
+000100a0: 2020 2020 2020 2061 7265 6120 2f3d 2078         area /= x
+000100b0: 795f 6172 6561 0a20 2020 2020 2020 2020  y_area.         
+000100c0: 2020 2072 6574 7572 6e20 6172 6561 0a0a     return area..
+000100d0: 2020 2020 2020 2020 2320 4f74 6865 7277          # Otherw
+000100e0: 6973 652c 2063 616c 6375 6c61 7465 2061  ise, calculate a
+000100f0: 7265 6120 6672 6f6d 2062 696e 6172 7920  rea from binary 
+00010100: 6d61 736b 0a20 2020 2020 2020 2069 6d5f  mask.        im_
+00010110: 736c 6963 6520 3d20 7365 6c66 2e67 6574  slice = self.get
+00010120: 5f73 6c69 6365 2876 6965 772c 2073 6c3d  _slice(view, sl=
+00010130: 736c 2c20 6964 783d 6964 782c 2070 6f73  sl, idx=idx, pos
+00010140: 3d70 6f73 2c20 0a20 2020 2020 2020 2020  =pos, .         
+00010150: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010160: 2020 2020 2020 2020 2066 6c61 7474 656e           flatten
+00010170: 3d66 6c61 7474 656e 290a 2020 2020 2020  =flatten).      
+00010180: 2020 6172 6561 203d 2069 6d5f 736c 6963    area = im_slic
+00010190: 652e 6173 7479 7065 2862 6f6f 6c29 2e73  e.astype(bool).s
+000101a0: 756d 2829 0a20 2020 2020 2020 2069 6620  um().        if 
+000101b0: 756e 6974 7320 3d3d 2022 6d6d 223a 0a20  units == "mm":. 
+000101c0: 2020 2020 2020 2020 2020 2078 5f61 782c             x_ax,
+000101d0: 2079 5f61 7820 3d20 736b 7274 2e69 6d61   y_ax = skrt.ima
+000101e0: 6765 2e5f 706c 6f74 5f61 7865 735b 7669  ge._plot_axes[vi
+000101f0: 6577 5d0a 2020 2020 2020 2020 2020 2020  ew].            
+00010200: 7879 5f61 7265 6120 3d20 6162 7328 7365  xy_area = abs(se
+00010210: 6c66 2e76 6f78 656c 5f73 697a 655b 785f  lf.voxel_size[x_
+00010220: 6178 5d20 2a20 7365 6c66 2e76 6f78 656c  ax] * self.voxel
+00010230: 5f73 697a 655b 795f 6178 5d29 0a20 2020  _size[y_ax]).   
+00010240: 2020 2020 2020 2020 2061 7265 6120 2a3d           area *=
+00010250: 2078 795f 6172 6561 0a20 2020 2020 2020   xy_area.       
+00010260: 2072 6574 7572 6e20 6172 6561 0a0a 2020   return area..  
+00010270: 2020 6465 6620 6765 745f 6262 6f78 5f63    def get_bbox_c
+00010280: 656e 7472 655f 616e 645f 7769 6474 6873  entre_and_widths
+00010290: 2873 656c 662c 0a20 2020 2020 2020 2020  (self,.         
+000102a0: 2020 2062 7566 6665 723d 4e6f 6e65 2c20     buffer=None, 
+000102b0: 6275 6666 6572 5f75 6e69 7473 3d22 6d6d  buffer_units="mm
+000102c0: 222c 206d 6574 686f 643d 4e6f 6e65 293a  ", method=None):
+000102d0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+000102e0: 2020 2020 2047 6574 2063 656e 7472 6520       Get centre 
+000102f0: 616e 6420 7769 6474 6873 2069 6e20 6d6d  and widths in mm
+00010300: 2061 6c6f 6e67 2061 6c6c 2074 6872 6565   along all three
+00010310: 2061 7865 7320 6f66 2061 0a20 2020 2020   axes of a.     
+00010320: 2020 2062 6f75 6e64 696e 6720 626f 7820     bounding box 
+00010330: 656e 636c 6f73 696e 6720 7468 6520 524f  enclosing the RO
+00010340: 4920 616e 6420 6f70 7469 6f6e 616c 2062  I and optional b
+00010350: 7566 6665 722e 2020 4365 6e74 7265 0a20  uffer.  Centre. 
+00010360: 2020 2020 2020 2061 6e64 2077 6964 7468         and width
+00010370: 7320 6172 6520 7265 7475 726e 6564 2061  s are returned a
+00010380: 7320 6120 7475 706c 6520 285b 782c 2079  s a tuple ([x, y
+00010390: 2c20 7a5d 2c20 5b64 782c 2064 792c 2064  , z], [dx, dy, d
+000103a0: 7a5d 292e 0a0a 2020 2020 2020 2020 4d65  z])...        Me
+000103b0: 7468 6f64 2070 6172 616d 6574 6572 7320  thod parameters 
+000103c0: 6172 6520 7061 7373 6564 2074 6f20 736b  are passed to sk
+000103d0: 7274 2e73 7472 7563 7475 7265 732e 524f  rt.structures.RO
+000103e0: 492e 6765 745f 6578 7465 6e74 7328 290a  I.get_extents().
+000103f0: 2020 2020 2020 2020 746f 206f 6274 6169          to obtai
+00010400: 6e20 524f 4920 6578 7465 6e74 732e 2020  n ROI extents.  
+00010410: 466f 7220 7061 7261 6d65 7465 7220 6578  For parameter ex
+00010420: 706c 616e 6174 696f 6e73 2c20 7365 650a  planations, see.
+00010430: 2020 2020 2020 2020 736b 7274 2e73 7472          skrt.str
+00010440: 7563 7475 7265 732e 524f 492e 6765 745f  uctures.ROI.get_
+00010450: 6578 7465 6e74 7328 2920 646f 6375 6d65  extents() docume
+00010460: 6e74 6174 696f 6e2e 0a20 2020 2020 2020  ntation..       
+00010470: 2022 2222 0a20 2020 2020 2020 2065 7874   """.        ext
+00010480: 656e 7473 203d 2073 656c 662e 6765 745f  ents = self.get_
+00010490: 6578 7465 6e74 7328 6275 6666 6572 2c20  extents(buffer, 
+000104a0: 6275 6666 6572 5f75 6e69 7473 2c20 6d65  buffer_units, me
+000104b0: 7468 6f64 2920 0a20 2020 2020 2020 2063  thod) .        c
+000104c0: 656e 7472 6520 3d20 5b30 2e35 202a 2028  entre = [0.5 * (
+000104d0: 6578 7465 6e74 5b30 5d20 2b20 6578 7465  extent[0] + exte
+000104e0: 6e74 5b31 5d29 2066 6f72 2065 7874 656e  nt[1]) for exten
+000104f0: 7420 696e 2065 7874 656e 7473 5d0a 2020  t in extents].  
+00010500: 2020 2020 2020 7769 6474 6873 203d 205b        widths = [
+00010510: 2865 7874 656e 745b 315d 202d 2065 7874  (extent[1] - ext
+00010520: 656e 745b 305d 2920 666f 7220 6578 7465  ent[0]) for exte
+00010530: 6e74 2069 6e20 6578 7465 6e74 735d 0a20  nt in extents]. 
+00010540: 2020 2020 2020 2072 6574 7572 6e20 2863         return (c
+00010550: 656e 7472 652c 2077 6964 7468 7329 0a0a  entre, widths)..
+00010560: 2020 2020 6465 6620 6765 745f 6578 7465      def get_exte
+00010570: 6e74 7328 7365 6c66 2c20 6275 6666 6572  nts(self, buffer
+00010580: 3d4e 6f6e 652c 2062 7566 6665 725f 756e  =None, buffer_un
+00010590: 6974 733d 226d 6d22 2c20 6d65 7468 6f64  its="mm", method
+000105a0: 3d4e 6f6e 652c 0a20 2020 2020 2020 2020  =None,.         
+000105b0: 2020 206f 7269 6769 6e3d 4e6f 6e65 293a     origin=None):
+000105c0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+000105d0: 2020 2020 2047 6574 206d 696e 696d 756d       Get minimum
+000105e0: 2061 6e64 206d 6178 696d 756d 2065 7874   and maximum ext
+000105f0: 656e 7420 6f66 2074 6865 2052 4f49 2069  ent of the ROI i
+00010600: 6e20 6d6d 2061 6c6f 6e67 2061 6c6c 2074  n mm along all t
+00010610: 6872 6565 2061 7865 732c 0a20 2020 2020  hree axes,.     
+00010620: 2020 2072 6574 7572 6e65 6420 696e 206f     returned in o
+00010630: 7264 6572 205b 782c 2079 2c20 7a5d 2e20  rder [x, y, z]. 
+00010640: 4f70 7469 6f6e 616c 6c79 2061 7070 6c79  Optionally apply
+00010650: 2061 2062 7566 6665 7220 746f 2074 6865   a buffer to the
+00010660: 2065 7874 656e 7473 0a20 2020 2020 2020   extents.       
+00010670: 2073 7563 6820 7468 6174 2074 6865 7920   such that they 
+00010680: 636f 7665 7220 6d6f 7265 2074 6861 6e20  cover more than 
+00010690: 7468 6520 524f 4927 7320 6172 6561 2e0a  the ROI's area..
+000106a0: 0a20 2020 2020 2020 202a 2a50 6172 616d  .        **Param
+000106b0: 6574 6572 733a 2a2a 0a0a 2020 2020 2020  eters:**..      
+000106c0: 2020 6275 6666 6572 203a 2066 6c6f 6174    buffer : float
+000106d0: 2c20 6465 6661 756c 743d 4e6f 6e65 0a20  , default=None. 
+000106e0: 2020 2020 2020 2020 2020 204f 7074 696f             Optio
+000106f0: 6e61 6c20 6275 6666 6572 2074 6f20 6164  nal buffer to ad
+00010700: 6420 746f 2074 6865 2065 7874 656e 7473  d to the extents
+00010710: 2e20 556e 6974 7320 7365 7420 6279 2060  . Units set by `
+00010720: 6275 6666 6572 5f75 6e69 7473 602e 0a0a  buffer_units`...
+00010730: 2020 2020 2020 2020 6275 6666 6572 5f75          buffer_u
+00010740: 6e69 7473 203a 2073 7472 2c20 6465 6661  nits : str, defa
+00010750: 756c 743d 226d 6d22 0a20 2020 2020 2020  ult="mm".       
+00010760: 2020 2020 2055 6e69 7473 2066 6f72 2062       Units for b
+00010770: 7566 6665 722c 2069 6620 7573 696e 672e  uffer, if using.
+00010780: 2043 616e 2062 6520 226d 6d22 2c20 2276   Can be "mm", "v
+00010790: 6f78 656c 7322 2c20 6f72 2022 6672 6163  oxels", or "frac
+000107a0: 2220 2877 6869 6368 0a20 2020 2020 2020  " (which.       
+000107b0: 2020 2020 2061 7070 6c69 6573 2062 7566       applies buf
+000107c0: 6665 7220 6173 2061 2066 7261 6374 696f  fer as a fractio
+000107d0: 6e20 6f66 2074 6f74 616c 206c 656e 6774  n of total lengt
+000107e0: 6820 696e 2065 6163 6820 6469 6d65 6e73  h in each dimens
+000107f0: 696f 6e29 2e0a 0a20 2020 2020 2020 206d  ion)...        m
+00010800: 6574 686f 6420 3a20 7374 722c 2064 6566  ethod : str, def
+00010810: 6175 6c74 3d4e 6f6e 650a 2020 2020 2020  ault=None.      
+00010820: 2020 2020 2020 4d65 7468 6f64 2074 6f20        Method to 
+00010830: 7573 6520 666f 7220 6578 7465 6e74 2063  use for extent c
+00010840: 616c 6375 6c61 7469 6f6e 2e20 4361 6e20  alculation. Can 
+00010850: 6265 3a20 0a0a 2020 2020 2020 2020 2020  be: ..          
+00010860: 2020 2020 2020 2a20 2263 6f6e 746f 7572        * "contour
+00010870: 223a 2067 6574 2065 7874 656e 7420 6672  ": get extent fr
+00010880: 6f6d 206d 696e 2f6d 6178 2070 6f73 6974  om min/max posit
+00010890: 696f 6e73 206f 6620 636f 6e74 6f75 7228  ions of contour(
+000108a0: 7329 2e0a 2020 2020 2020 2020 2020 2020  s)..            
+000108b0: 2020 2020 2a20 226d 6173 6b22 3a20 6765      * "mask": ge
+000108c0: 7420 6578 7465 6e74 2066 726f 6d20 6d69  t extent from mi
+000108d0: 6e2f 6d61 7820 706f 7369 7469 6f6e 7320  n/max positions 
+000108e0: 6f66 2076 6f78 656c 7320 696e 2074 6865  of voxels in the
+000108f0: 200a 2020 2020 2020 2020 2020 2020 2020   .              
+00010900: 2020 2020 6269 6e61 7279 206d 6173 6b2e      binary mask.
+00010910: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00010920: 202a 204e 6f6e 653a 2075 7365 2074 6865   * None: use the
+00010930: 206d 6574 686f 6420 7365 7420 696e 2073   method set in s
+00010940: 656c 662e 6465 6661 756c 745f 6765 6f6d  elf.default_geom
+00010950: 5f6d 6574 686f 642e 0a0a 2020 2020 2020  _method...      
+00010960: 2020 6f72 6967 696e 203a 2074 7570 6c65    origin : tuple
+00010970: 2c20 6465 6661 756c 743d 4e6f 6e65 0a20  , default=None. 
+00010980: 2020 2020 2020 2020 2020 2054 7570 6c65             Tuple
+00010990: 2073 7065 6369 6679 696e 6720 7468 6520   specifying the 
+000109a0: 2878 2c20 792c 207a 2920 636f 6f72 6469  (x, y, z) coordi
+000109b0: 6e61 7465 7320 6f66 2074 6865 2070 6f69  nates of the poi
+000109c0: 6e74 0a20 2020 2020 2020 2020 2020 2077  nt.            w
+000109d0: 6974 6820 7265 7370 6563 7420 746f 2077  ith respect to w
+000109e0: 6869 6368 2065 7874 656e 7473 2061 7265  hich extents are
+000109f0: 2074 6f20 6265 2064 6574 6572 6d69 6e65   to be determine
+00010a00: 642e 0a20 2020 2020 2020 2020 2020 2049  d..            I
+00010a10: 6620 4e6f 6e65 2c20 7468 656e 2028 302c  f None, then (0,
+00010a20: 2030 2c20 3029 2069 7320 7573 6564 2e0a   0, 0) is used..
+00010a30: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00010a40: 2020 2020 2320 456e 7375 7265 2074 6861      # Ensure tha
+00010a50: 7420 6f72 6967 696e 2069 7320 6465 6669  t origin is defi
+00010a60: 6e65 642e 0a20 2020 2020 2020 206f 7269  ned..        ori
+00010a70: 6769 6e20 3d20 6f72 6967 696e 206f 7220  gin = origin or 
+00010a80: 2830 2c20 302c 2030 290a 0a20 2020 2020  (0, 0, 0)..     
+00010a90: 2020 2023 2047 6574 2065 7874 656e 7420     # Get extent 
+00010aa0: 696e 2065 6163 6820 6469 7265 6374 696f  in each directio
+00010ab0: 6e0a 2020 2020 2020 2020 6578 7465 6e74  n.        extent
+00010ac0: 7320 3d20 5b5d 0a20 2020 2020 2020 2066  s = [].        f
+00010ad0: 6f72 2061 7820 696e 2073 6b72 742e 696d  or ax in skrt.im
+00010ae0: 6167 652e 5f61 7865 733a 0a20 2020 2020  age._axes:.     
+00010af0: 2020 2020 2020 2065 7874 656e 7473 2e61         extents.a
+00010b00: 7070 656e 6428 7365 6c66 2e67 6574 5f65  ppend(self.get_e
+00010b10: 7874 656e 7428 6178 2c20 6d65 7468 6f64  xtent(ax, method
+00010b20: 3d6d 6574 686f 642c 206f 7269 6769 6e3d  =method, origin=
+00010b30: 6f72 6967 696e 2929 0a0a 2020 2020 2020  origin))..      
+00010b40: 2020 2320 4170 706c 7920 6275 6666 6572    # Apply buffer
+00010b50: 2069 6620 7265 7175 6573 7465 640a 2020   if requested.  
+00010b60: 2020 2020 2020 6966 2062 7566 6665 723a        if buffer:
+00010b70: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
+00010b80: 2061 7820 696e 2072 616e 6765 2833 293a   ax in range(3):
+00010b90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00010ba0: 2069 6620 6275 6666 6572 5f75 6e69 7473   if buffer_units
+00010bb0: 203d 3d20 226d 6d22 3a0a 2020 2020 2020   == "mm":.      
+00010bc0: 2020 2020 2020 2020 2020 2020 2020 6465                de
+00010bd0: 6c74 6120 3d20 6275 6666 6572 0a20 2020  lta = buffer.   
+00010be0: 2020 2020 2020 2020 2020 2020 2065 6c69               eli
+00010bf0: 6620 6275 6666 6572 5f75 6e69 7473 203d  f buffer_units =
+00010c00: 3d20 2276 6f78 656c 7322 3a0a 2020 2020  = "voxels":.    
+00010c10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010c20: 6465 6c74 6120 3d20 6162 7328 6275 6666  delta = abs(buff
+00010c30: 6572 202a 2073 656c 662e 766f 7865 6c5f  er * self.voxel_
+00010c40: 7369 7a65 5b61 785d 290a 2020 2020 2020  size[ax]).      
+00010c50: 2020 2020 2020 2020 2020 656c 6966 2062            elif b
+00010c60: 7566 6665 725f 756e 6974 7320 3d3d 2022  uffer_units == "
+00010c70: 6672 6163 223a 0a20 2020 2020 2020 2020  frac":.         
+00010c80: 2020 2020 2020 2020 2020 2064 656c 7461             delta
+00010c90: 203d 2062 7566 6665 7220 2a20 6162 7328   = buffer * abs(
+00010ca0: 6578 7465 6e74 735b 6178 5d5b 315d 202d  extents[ax][1] -
+00010cb0: 2065 7874 656e 7473 5b61 785d 5b30 5d29   extents[ax][0])
+00010cc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00010cd0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+00010ce0: 2020 2020 2020 2020 2020 2070 7269 6e74             print
+00010cf0: 2866 2255 6e72 6563 6f67 6e69 7365 6420  (f"Unrecognised 
+00010d00: 6275 6666 6572 2075 6e69 7473 207b 6275  buffer units {bu
+00010d10: 6666 6572 5f75 6e69 7473 7d2e 2053 686f  ffer_units}. Sho
+00010d20: 756c 6420 220a 2020 2020 2020 2020 2020  uld ".          
+00010d30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010d40: 2762 6520 226d 6d22 2c20 2276 6f78 656c  'be "mm", "voxel
+00010d50: 7322 2c20 6f72 2022 6672 6163 222e 2729  s", or "frac".')
+00010d60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00010d70: 2020 2020 2072 6574 7572 6e0a 2020 2020       return.    
+00010d80: 2020 2020 2020 2020 2020 2020 6578 7465              exte
+00010d90: 6e74 735b 6178 5d5b 305d 202d 3d20 6465  nts[ax][0] -= de
+00010da0: 6c74 610a 2020 2020 2020 2020 2020 2020  lta.            
+00010db0: 2020 2020 6578 7465 6e74 735b 6178 5d5b      extents[ax][
+00010dc0: 315d 202b 3d20 6465 6c74 610a 0a20 2020  1] += delta..   
+00010dd0: 2020 2020 2072 6574 7572 6e20 6578 7465       return exte
+00010de0: 6e74 730a 0a20 2020 2064 6566 2067 6574  nts..    def get
+00010df0: 5f65 7874 656e 7428 7365 6c66 2c20 0a20  _extent(self, . 
+00010e00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010e10: 2020 6178 3d22 7a22 2c20 0a20 2020 2020    ax="z", .     
+00010e20: 2020 2020 2020 2020 2020 2020 2020 7369                si
+00010e30: 6e67 6c65 5f73 6c69 6365 3d46 616c 7365  ngle_slice=False
+00010e40: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00010e50: 2020 2020 2076 6965 773d 2278 2d79 222c       view="x-y",
+00010e60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00010e70: 2020 2020 736c 3d4e 6f6e 652c 200a 2020      sl=None, .  
+00010e80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010e90: 2069 6478 3d4e 6f6e 652c 200a 2020 2020   idx=None, .    
+00010ea0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+00010eb0: 6f73 3d4e 6f6e 652c 200a 2020 2020 2020  os=None, .      
+00010ec0: 2020 2020 2020 2020 2020 2020 206d 6574               met
+00010ed0: 686f 643d 4e6f 6e65 2c20 0a20 2020 2020  hod=None, .     
+00010ee0: 2020 2020 2020 2020 2020 2020 2020 6f72                or
+00010ef0: 6967 696e 3d4e 6f6e 652c 0a20 2020 2020  igin=None,.     
+00010f00: 2020 2020 2020 2020 2020 2020 2029 3a0a               ):.
+00010f10: 2020 2020 2020 2020 2222 2247 6574 206d          """Get m
+00010f20: 696e 696d 756d 2061 6e64 206d 6178 696d  inimum and maxim
+00010f30: 756d 2065 7874 656e 7420 6f66 2074 6865  um extent of the
+00010f40: 2052 4f49 2069 6e20 6d6d 2061 6c6f 6e67   ROI in mm along
+00010f50: 2061 2067 6976 656e 2061 7869 732e 0a0a   a given axis...
+00010f60: 2020 2020 2020 2020 6178 203a 2073 7472          ax : str
+00010f70: 2f69 6e74 2c20 6465 6661 756c 743d 227a  /int, default="z
+00010f80: 220a 2020 2020 2020 2020 2020 2020 4178  ".            Ax
+00010f90: 6973 2061 6c6f 6e67 2077 6869 6368 2074  is along which t
+00010fa0: 6f20 7265 7475 726e 2065 7874 656e 742e  o return extent.
+00010fb0: 2053 686f 756c 6420 6265 206f 6e65 206f   Should be one o
+00010fc0: 6620 5b22 7822 2c20 2279 222c 2022 7a22  f ["x", "y", "z"
+00010fd0: 5d20 0a20 2020 2020 2020 2020 2020 206f  ] .            o
+00010fe0: 7220 5b30 2c20 312c 2032 5d0a 0a20 2020  r [0, 1, 2]..   
+00010ff0: 2020 2020 2073 696e 676c 655f 736c 6963       single_slic
+00011000: 6520 3a20 626f 6f6c 2c20 6465 6661 756c  e : bool, defaul
+00011010: 743d 4661 6c73 650a 2020 2020 2020 2020  t=False.        
+00011020: 2020 2020 4966 2046 616c 7365 2c20 7468      If False, th
+00011030: 6520 3344 2065 7874 656e 7420 6f66 2074  e 3D extent of t
+00011040: 6865 2065 6e74 6972 6520 524f 4920 7769  he entire ROI wi
+00011050: 6c6c 2062 6520 7265 7475 726e 6564 3b0a  ll be returned;.
+00011060: 2020 2020 2020 2020 2020 2020 6f74 6865              othe
+00011070: 7277 6973 652c 2074 6865 2032 4420 6578  rwise, the 2D ex
+00011080: 7465 6e74 206f 6620 6120 7369 6e67 6c65  tent of a single
+00011090: 2073 6c69 6365 2077 696c 6c20 6265 2072   slice will be r
+000110a0: 6574 7572 6e65 642e 0a0a 2020 2020 2020  eturned...      
+000110b0: 2020 7669 6577 203a 2073 7472 2c20 6465    view : str, de
+000110c0: 6661 756c 743d 2278 2d79 220a 2020 2020  fault="x-y".    
+000110d0: 2020 2020 2020 2020 4f72 6965 6e74 6174          Orientat
+000110e0: 696f 6e20 6f66 2073 6c69 6365 206f 6e20  ion of slice on 
+000110f0: 7768 6963 6820 746f 2067 6574 2065 7874  which to get ext
+00011100: 656e 742e 204f 6e6c 7920 7573 6564 2069  ent. Only used i
+00011110: 6620 0a20 2020 2020 2020 2020 2020 2073  f .            s
+00011120: 696e 676c 655f 736c 6963 653d 5472 7565  ingle_slice=True
+00011130: 2e20 4966 2075 7369 6e67 2c20 3c61 783e  . If using, <ax>
+00011140: 206d 7573 7420 6265 2061 6e20 6178 6973   must be an axis
+00011150: 2074 6861 7420 6c69 6573 2061 6c6f 6e67   that lies along
+00011160: 0a20 2020 2020 2020 2020 2020 2074 6865  .            the
+00011170: 2073 6c69 6365 2069 6e20 7468 6973 206f   slice in this o
+00011180: 7269 656e 7461 7469 6f6e 2e0a 0a20 2020  rientation...   
+00011190: 2020 2020 2073 6c20 3a20 696e 742c 2064       sl : int, d
+000111a0: 6566 6175 6c74 3d4e 6f6e 650a 2020 2020  efault=None.    
+000111b0: 2020 2020 2020 2020 536c 6963 6520 6e75          Slice nu
+000111c0: 6d62 6572 2e20 4966 206e 6f6e 6520 6f66  mber. If none of
+000111d0: 203c 736c 3e2c 203c 6964 783e 206f 7220   <sl>, <idx> or 
+000111e0: 3c70 6f73 3e20 6172 6520 7375 7070 6c69  <pos> are suppli
+000111f0: 6564 2062 7574 0a20 2020 2020 2020 2020  ed but.         
+00011200: 2020 203c 7369 6e67 6c65 5f73 6c69 6365     <single_slice
+00011210: 3e20 6973 2054 7275 652c 2074 6865 2063  > is True, the c
+00011220: 656e 7472 616c 2073 6c69 6365 206f 6620  entral slice of 
+00011230: 7468 6520 524f 4920 7769 6c6c 2062 6520  the ROI will be 
+00011240: 7573 6564 2e0a 0a20 2020 2020 2020 2069  used...        i
+00011250: 6478 203a 2069 6e74 2c20 6465 6661 756c  dx : int, defaul
+00011260: 743d 4e6f 6e65 0a20 2020 2020 2020 2020  t=None.         
+00011270: 2020 2041 7272 6179 2069 6e64 6578 206f     Array index o
+00011280: 6620 736c 6963 652e 2049 6620 6e6f 6e65  f slice. If none
+00011290: 206f 6620 3c73 6c3e 2c20 3c69 6478 3e20   of <sl>, <idx> 
+000112a0: 6f72 203c 706f 733e 2061 7265 2073 7570  or <pos> are sup
+000112b0: 706c 6965 6420 6275 740a 2020 2020 2020  plied but.      
+000112c0: 2020 2020 2020 3c73 696e 676c 655f 736c        <single_sl
+000112d0: 6963 653e 2069 7320 5472 7565 2c20 7468  ice> is True, th
+000112e0: 6520 6365 6e74 7261 6c20 736c 6963 6520  e central slice 
+000112f0: 6f66 2074 6865 2052 4f49 2077 696c 6c20  of the ROI will 
+00011300: 6265 2075 7365 642e 0a0a 2020 2020 2020  be used...      
+00011310: 2020 706f 7320 3a20 666c 6f61 742c 2064    pos : float, d
+00011320: 6566 6175 6c74 3d4e 6f6e 650a 2020 2020  efault=None.    
+00011330: 2020 2020 2020 2020 536c 6963 6520 706f          Slice po
+00011340: 7369 7469 6f6e 2069 6e20 6d6d 2e20 4966  sition in mm. If
+00011350: 206e 6f6e 6520 6f66 203c 736c 3e2c 203c   none of <sl>, <
+00011360: 6964 783e 206f 7220 3c70 6f73 3e20 6172  idx> or <pos> ar
+00011370: 6520 7375 7070 6c69 6564 2062 7574 0a20  e supplied but. 
+00011380: 2020 2020 2020 2020 2020 203c 7369 6e67             <sing
+00011390: 6c65 5f73 6c69 6365 3e20 6973 2054 7275  le_slice> is Tru
+000113a0: 652c 2074 6865 2063 656e 7472 616c 2073  e, the central s
+000113b0: 6c69 6365 206f 6620 7468 6520 524f 4920  lice of the ROI 
+000113c0: 7769 6c6c 2062 6520 7573 6564 2e0a 0a20  will be used... 
+000113d0: 2020 2020 2020 206d 6574 686f 6420 3a20         method : 
+000113e0: 7374 722c 2064 6566 6175 6c74 3d4e 6f6e  str, default=Non
+000113f0: 650a 2020 2020 2020 2020 2020 2020 4d65  e.            Me
+00011400: 7468 6f64 2074 6f20 7573 6520 666f 7220  thod to use for 
+00011410: 6578 7465 6e74 2063 616c 6375 6c61 7469  extent calculati
+00011420: 6f6e 2e20 4361 6e20 6265 3a20 0a0a 2020  on. Can be: ..  
+00011430: 2020 2020 2020 2020 2020 2020 2020 2a20                * 
+00011440: 2263 6f6e 746f 7572 223a 2067 6574 2065  "contour": get e
+00011450: 7874 656e 7420 6672 6f6d 206d 696e 2f6d  xtent from min/m
+00011460: 6178 2070 6f73 6974 696f 6e73 206f 6620  ax positions of 
+00011470: 636f 6e74 6f75 7228 7329 2e0a 2020 2020  contour(s)..    
+00011480: 2020 2020 2020 2020 2020 2020 2a20 226d              * "m
+00011490: 6173 6b22 3a20 6765 7420 6578 7465 6e74  ask": get extent
+000114a0: 2066 726f 6d20 6d69 6e2f 6d61 7820 706f   from min/max po
+000114b0: 7369 7469 6f6e 7320 6f66 2076 6f78 656c  sitions of voxel
+000114c0: 7320 696e 2074 6865 200a 2020 2020 2020  s in the .      
+000114d0: 2020 2020 2020 2020 2020 2020 6269 6e61              bina
+000114e0: 7279 206d 6173 6b2e 0a20 2020 2020 2020  ry mask..       
+000114f0: 2020 2020 2020 2020 202a 204e 6f6e 653a           * None:
+00011500: 2075 7365 2074 6865 206d 6574 686f 6420   use the method 
+00011510: 7365 7420 696e 2073 656c 662e 6465 6661  set in self.defa
+00011520: 756c 745f 6765 6f6d 5f6d 6574 686f 642e  ult_geom_method.
+00011530: 0a0a 2020 2020 2020 2020 6f72 6967 696e  ..        origin
+00011540: 203a 2069 6e74 2f66 6c6f 6174 2f74 7570   : int/float/tup
+00011550: 6c65 2c20 6465 6661 756c 743d 4e6f 6e65  le, default=None
+00011560: 0a20 2020 2020 2020 2020 2020 2050 6f69  .            Poi
+00011570: 6e74 2077 6974 6820 7265 7370 6563 7420  nt with respect 
+00011580: 746f 2077 6869 6368 2065 7874 656e 7473  to which extents
+00011590: 2061 7265 2074 6f20 6265 2064 6574 6572   are to be deter
+000115a0: 6d69 6e65 642e 0a20 2020 2020 2020 2020  mined..         
+000115b0: 2020 2054 6869 7320 6361 6e20 6265 2061     This can be a
+000115c0: 6e20 696e 7465 6765 7220 6f72 2066 6c6f  n integer or flo
+000115d0: 6174 2073 7065 6369 6679 696e 6720 7468  at specifying th
+000115e0: 6520 706f 696e 7427 730a 2020 2020 2020  e point's.      
+000115f0: 2020 2020 2020 636f 6f72 6469 6e61 7465        coordinate
+00011600: 2061 6c6f 6e67 2061 7869 7320 3c61 783e   along axis <ax>
+00011610: 3b20 6f72 2069 7420 6361 6e20 6265 2061  ; or it can be a
+00011620: 2074 7570 6c65 2073 7065 6369 6679 696e   tuple specifyin
+00011630: 670a 2020 2020 2020 2020 2020 2020 7468  g.            th
+00011640: 6520 706f 696e 7427 7320 2878 2c20 792c  e point's (x, y,
+00011650: 207a 2920 636f 6f72 6469 6e61 7465 732c   z) coordinates,
+00011660: 2077 6865 7265 206f 6e6c 7920 7468 6520   where only the 
+00011670: 636f 6f72 6469 6e61 7465 0a20 2020 2020  coordinate.     
+00011680: 2020 2020 2020 2061 6c6f 6e67 2061 7869         along axi
+00011690: 7320 3c61 783e 2077 696c 6c20 6265 2063  s <ax> will be c
+000116a0: 6f6e 7369 6465 7265 642e 2020 4966 204e  onsidered.  If N
+000116b0: 6f6e 652c 2074 6865 206f 7269 6769 6e0a  one, the origin.
+000116c0: 2020 2020 2020 2020 2020 2020 636f 6f72              coor
+000116d0: 6469 6e61 7465 2069 7320 7461 6b65 6e20  dinate is taken 
+000116e0: 746f 2062 6520 302e 0a20 2020 2020 2020  to be 0..       
+000116f0: 2022 2222 0a0a 2020 2020 2020 2020 2320   """..        # 
+00011700: 4765 7420 6465 6661 756c 7420 736c 6963  Get default slic
+00011710: 6520 616e 6420 6d65 7468 6f64 0a20 2020  e and method.   
+00011720: 2020 2020 2073 656c 662e 6c6f 6164 2829       self.load()
+00011730: 0a20 2020 2020 2020 2069 6620 6d65 7468  .        if meth
+00011740: 6f64 2069 7320 4e6f 6e65 3a0a 2020 2020  od is None:.    
+00011750: 2020 2020 2020 2020 6d65 7468 6f64 203d          method =
+00011760: 2073 656c 662e 6465 6661 756c 745f 6765   self.default_ge
+00011770: 6f6d 5f6d 6574 686f 640a 2020 2020 2020  om_method.      
+00011780: 2020 6966 2073 696e 676c 655f 736c 6963    if single_slic
+00011790: 653a 0a20 2020 2020 2020 2020 2020 2069  e:.            i
+000117a0: 6620 6964 7820 6973 204e 6f6e 6520 616e  f idx is None an
+000117b0: 6420 736c 2069 7320 4e6f 6e65 2061 6e64  d sl is None and
+000117c0: 2070 6f73 2069 7320 4e6f 6e65 3a0a 2020   pos is None:.  
+000117d0: 2020 2020 2020 2020 2020 2020 2020 6964                id
+000117e0: 7820 3d20 7365 6c66 2e67 6574 5f6d 6964  x = self.get_mid
+000117f0: 5f69 6478 2829 0a0a 2020 2020 2020 2020  _idx()..        
+00011800: 2320 4966 2075 7369 6e67 2073 696e 676c  # If using singl
+00011810: 6520 736c 6963 652c 2063 6865 636b 2074  e slice, check t
+00011820: 6865 2061 7869 7320 6c69 6573 2061 6c6f  he axis lies alo
+00011830: 6e67 2074 6865 2073 6c69 6365 0a20 2020  ng the slice.   
+00011840: 2020 2020 2069 5f61 7820 3d20 736b 7274       i_ax = skrt
+00011850: 2e69 6d61 6765 2e5f 6178 6573 2e69 6e64  .image._axes.ind
+00011860: 6578 2861 7829 2069 6620 6973 696e 7374  ex(ax) if isinst
+00011870: 616e 6365 2861 782c 2073 7472 2920 656c  ance(ax, str) el
+00011880: 7365 2061 780a 2020 2020 2020 2020 6966  se ax.        if
+00011890: 2073 696e 676c 655f 736c 6963 653a 0a20   single_slice:. 
+000118a0: 2020 2020 2020 2020 2020 2069 6620 695f             if i_
+000118b0: 6178 206e 6f74 2069 6e20 736b 7274 2e69  ax not in skrt.i
+000118c0: 6d61 6765 2e5f 706c 6f74 5f61 7865 735b  mage._plot_axes[
+000118d0: 7669 6577 5d3a 0a20 2020 2020 2020 2020  view]:.         
+000118e0: 2020 2020 2020 2072 6169 7365 2052 756e         raise Run
+000118f0: 7469 6d65 4572 726f 7228 0a20 2020 2020  timeError(.     
+00011900: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+00011910: 2243 616e 6e6f 7420 636f 6d70 7574 6520  "Cannot compute 
+00011920: 6578 7465 6e74 206f 6620 6178 6973 207b  extent of axis {
+00011930: 6178 7d20 696e 2074 6865 207b 7669 6577  ax} in the {view
+00011940: 7d20 706c 616e 6521 2229 0a20 2020 2020  } plane!").     
+00011950: 2020 2020 2020 2069 5f61 7820 3d20 736b         i_ax = sk
+00011960: 7274 2e69 6d61 6765 2e5f 706c 6f74 5f61  rt.image._plot_a
+00011970: 7865 735b 7669 6577 5d2e 696e 6465 7828  xes[view].index(
+00011980: 695f 6178 290a 0a20 2020 2020 2020 2023  i_ax)..        #
+00011990: 2045 6e73 7572 6520 7468 6174 206f 7269   Ensure that ori
+000119a0: 6769 6e20 6973 2061 2073 696e 676c 6520  gin is a single 
+000119b0: 6e75 6d65 7269 6320 7661 6c75 652e 0a20  numeric value.. 
+000119c0: 2020 2020 2020 206f 7269 6769 6e20 3d20         origin = 
+000119d0: 6f72 6967 696e 206f 7220 300a 2020 2020  origin or 0.    
+000119e0: 2020 2020 6966 206e 6f74 2069 7369 6e73      if not isins
+000119f0: 7461 6e63 6528 6f72 6967 696e 2c20 2866  tance(origin, (f
+00011a00: 6c6f 6174 2c20 696e 7429 293a 0a20 2020  loat, int)):.   
+00011a10: 2020 2020 2020 2020 206f 7269 6769 6e20           origin 
+00011a20: 3d20 6f72 6967 696e 5b69 5f61 785d 0a0a  = origin[i_ax]..
+00011a30: 2020 2020 2020 2020 2320 4361 6c63 756c          # Calcul
+00011a40: 6174 6520 6578 7465 6e74 2066 726f 6d20  ate extent from 
+00011a50: 636f 6e74 6f75 7273 0a20 2020 2020 2020  contours.       
+00011a60: 2069 6620 6d65 7468 6f64 203d 3d20 2263   if method == "c
+00011a70: 6f6e 746f 7572 223a 0a0a 2020 2020 2020  ontour":..      
+00011a80: 2020 2020 2020 2320 4361 6c63 756c 6174        # Calculat
+00011a90: 6520 6675 6c6c 207a 2065 7874 656e 7420  e full z extent 
+00011aa0: 6672 6f6d 2063 6f6e 746f 7572 2070 6f73  from contour pos
+00011ab0: 6974 696f 6e73 0a20 2020 2020 2020 2020  itions.         
+00011ac0: 2020 2069 6620 2861 7820 3d3d 2022 7a22     if (ax == "z"
+00011ad0: 206f 7220 6178 203d 3d20 3229 2061 6e64   or ax == 2) and
+00011ae0: 206e 6f74 2073 696e 676c 655f 736c 6963   not single_slic
+00011af0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+00011b00: 2020 207a 5f6b 6579 7320 3d20 6c69 7374     z_keys = list
+00011b10: 2873 656c 662e 6765 745f 636f 6e74 6f75  (self.get_contou
+00011b20: 7273 2822 782d 7922 292e 6b65 7973 2829  rs("x-y").keys()
+00011b30: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00011b40: 2020 767a 203d 2073 656c 662e 6765 745f    vz = self.get_
+00011b50: 736c 6963 655f 7468 6963 6b6e 6573 735f  slice_thickness_
+00011b60: 636f 6e74 6f75 7273 2829 0a20 2020 2020  contours().     
+00011b70: 2020 2020 2020 2020 2020 2069 6620 7a5f             if z_
+00011b80: 6b65 7973 3a0a 2020 2020 2020 2020 2020  keys:.          
+00011b90: 2020 2020 2020 2020 2020 7a5f 6d61 7820            z_max 
+00011ba0: 3d20 6d61 7828 7a5f 6b65 7973 2920 2b20  = max(z_keys) + 
+00011bb0: 2076 7a20 2f20 320a 2020 2020 2020 2020   vz / 2.        
+00011bc0: 2020 2020 2020 2020 2020 2020 7a5f 6d69              z_mi
+00011bd0: 6e20 3d20 6d69 6e28 7a5f 6b65 7973 2920  n = min(z_keys) 
+00011be0: 2d20 767a 202f 2032 0a20 2020 2020 2020  - vz / 2.       
+00011bf0: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+00011c00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011c10: 2020 207a 5f6d 696e 203d 204e 6f6e 650a     z_min = None.
+00011c20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011c30: 2020 2020 7a5f 6d61 7820 3d20 4e6f 6e65      z_max = None
+00011c40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00011c50: 2072 6574 7572 6e20 5b7a 5f6d 696e 2c20   return [z_min, 
+00011c60: 7a5f 6d61 785d 0a0a 2020 2020 2020 2020  z_max]..        
+00011c70: 2020 2020 2320 4f74 6865 7277 6973 652c      # Otherwise,
+00011c80: 2063 616c 6375 6c61 7465 2065 7874 656e   calculate exten
+00011c90: 7420 6672 6f6d 206d 696e 2f6d 6178 2063  t from min/max c
+00011ca0: 6f6e 746f 7572 2070 6f73 6974 696f 6e73  ontour positions
+00011cb0: 200a 2020 2020 2020 2020 2020 2020 706f   .            po
+00011cc0: 696e 7473 203d 205b 5d0a 0a20 2020 2020  ints = []..     
+00011cd0: 2020 2020 2020 2023 2047 6c6f 6261 6c3a         # Global:
+00011ce0: 2075 7365 2065 7665 7279 2063 6f6e 746f   use every conto
+00011cf0: 7572 0a20 2020 2020 2020 2020 2020 2069  ur.            i
+00011d00: 6620 6e6f 7420 7369 6e67 6c65 5f73 6c69  f not single_sli
+00011d10: 6365 3a0a 2020 2020 2020 2020 2020 2020  ce:.            
+00011d20: 2020 2020 666f 7220 692c 2063 6f6e 746f      for i, conto
+00011d30: 7572 7320 696e 2073 656c 662e 6765 745f  urs in self.get_
+00011d40: 636f 6e74 6f75 7273 2822 782d 7922 292e  contours("x-y").
+00011d50: 6974 656d 7328 293a 0a20 2020 2020 2020  items():.       
+00011d60: 2020 2020 2020 2020 2020 2020 2066 6f72               for
+00011d70: 2063 6f6e 746f 7572 2069 6e20 636f 6e74   contour in cont
+00011d80: 6f75 7273 3a0a 2020 2020 2020 2020 2020  ours:.          
+00011d90: 2020 2020 2020 2020 2020 2020 2020 706f                po
+00011da0: 696e 7473 2e65 7874 656e 6428 5b70 5b69  ints.extend([p[i
+00011db0: 5f61 785d 2066 6f72 2070 2069 6e20 636f  _ax] for p in co
+00011dc0: 6e74 6f75 725d 290a 0a20 2020 2020 2020  ntour])..       
+00011dd0: 2020 2020 2023 2053 696e 676c 6520 736c       # Single sl
+00011de0: 6963 653a 206a 7573 7420 7573 6520 7468  ice: just use th
+00011df0: 6520 636f 6e74 6f75 7220 6f6e 2074 6865  e contour on the
+00011e00: 2073 6c69 6365 0a20 2020 2020 2020 2020   slice.         
+00011e10: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+00011e20: 2020 2020 2020 2020 2066 6f72 2063 6f6e           for con
+00011e30: 746f 7572 2069 6e20 7365 6c66 2e67 6574  tour in self.get
+00011e40: 5f63 6f6e 746f 7572 735f 6f6e 5f73 6c69  _contours_on_sli
+00011e50: 6365 280a 2020 2020 2020 2020 2020 2020  ce(.            
+00011e60: 2020 2020 2020 2020 7669 6577 2c20 736c          view, sl
+00011e70: 3d73 6c2c 2069 6478 3d69 6478 2c20 706f  =sl, idx=idx, po
+00011e80: 733d 706f 7329 3a0a 2020 2020 2020 2020  s=pos):.        
+00011e90: 2020 2020 2020 2020 2020 2020 706f 696e              poin
+00011ea0: 7473 2e65 7874 656e 6428 5b70 5b69 5f61  ts.extend([p[i_a
+00011eb0: 785d 2066 6f72 2070 2069 6e20 636f 6e74  x] for p in cont
+00011ec0: 6f75 725d 290a 0a20 2020 2020 2020 2020  our])..         
+00011ed0: 2020 2023 2052 6574 7572 6e20 6d69 6e20     # Return min 
+00011ee0: 616e 6420 6d61 7820 6f66 2074 6865 2070  and max of the p
+00011ef0: 6f69 6e74 7320 696e 2074 6865 2063 6f6e  oints in the con
+00011f00: 746f 7572 2873 290a 2020 2020 2020 2020  tour(s).        
+00011f10: 2020 2020 6966 206c 656e 2870 6f69 6e74      if len(point
+00011f20: 7329 3a0a 2020 2020 2020 2020 2020 2020  s):.            
+00011f30: 2020 2020 7265 7475 726e 205b 6d69 6e28      return [min(
+00011f40: 706f 696e 7473 2920 2d20 6f72 6967 696e  points) - origin
+00011f50: 2c20 6d61 7828 706f 696e 7473 2920 2d20  , max(points) - 
+00011f60: 6f72 6967 696e 5d0a 2020 2020 2020 2020  origin].        
+00011f70: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00011f80: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00011f90: 205b 4e6f 6e65 2c20 4e6f 6e65 5d0a 0a20   [None, None].. 
+00011fa0: 2020 2020 2020 2023 204f 7468 6572 7769         # Otherwi
+00011fb0: 7365 2c20 6765 7420 6578 7465 6e74 2066  se, get extent f
+00011fc0: 726f 6d20 6d61 736b 0a20 2020 2020 2020  rom mask.       
+00011fd0: 2073 656c 662e 6372 6561 7465 5f6d 6173   self.create_mas
+00011fe0: 6b28 290a 2020 2020 2020 2020 6966 2069  k().        if i
+00011ff0: 5f61 7820 213d 2032 3a20 2023 2054 7261  _ax != 2:  # Tra
+00012000: 6e73 706f 7365 2078 2d79 2061 7865 730a  nspose x-y axes.
+00012010: 2020 2020 2020 2020 2020 2020 695f 6178              i_ax
+00012020: 203d 2031 202d 2069 5f61 780a 0a20 2020   = 1 - i_ax..   
+00012030: 2020 2020 2023 2047 6574 2070 6f73 6974       # Get posit
+00012040: 696f 6e73 206f 6620 766f 7865 6c73 2069  ions of voxels i
+00012050: 6e73 6964 6520 7468 6520 6d61 736b 0a20  nside the mask. 
+00012060: 2020 2020 2020 2069 6620 6e6f 7420 7369         if not si
+00012070: 6e67 6c65 5f73 6c69 6365 3a0a 2020 2020  ngle_slice:.    
+00012080: 2020 2020 2020 2020 6e6f 6e7a 6572 6f20          nonzero 
+00012090: 3d20 6e70 2e61 7267 7768 6572 6528 7365  = np.argwhere(se
+000120a0: 6c66 2e67 6574 5f6d 6173 6b28 7374 616e  lf.get_mask(stan
+000120b0: 6461 7264 6973 653d 5472 7565 2929 0a20  dardise=True)). 
+000120c0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+000120d0: 2020 2020 2020 2020 206e 6f6e 7a65 726f           nonzero
+000120e0: 203d 206e 702e 6172 6777 6865 7265 2873   = np.argwhere(s
+000120f0: 656c 662e 6765 745f 736c 6963 6528 0a20  elf.get_slice(. 
+00012100: 2020 2020 2020 2020 2020 2020 2020 2076                 v
+00012110: 6965 772c 2073 6c3d 736c 2c20 6964 783d  iew, sl=sl, idx=
+00012120: 6964 782c 2070 6f73 3d70 6f73 2929 0a20  idx, pos=pos)). 
+00012130: 2020 2020 2020 2076 616c 7320 3d20 6e6f         vals = no
+00012140: 6e7a 6572 6f5b 3a2c 2069 5f61 785d 0a20  nzero[:, i_ax]. 
+00012150: 2020 2020 2020 2069 6620 6e6f 7420 6c65         if not le
+00012160: 6e28 7661 6c73 293a 0a20 2020 2020 2020  n(vals):.       
+00012170: 2020 2020 2072 6574 7572 6e20 5b4e 6f6e       return [Non
+00012180: 652c 204e 6f6e 655d 0a0a 2020 2020 2020  e, None]..      
+00012190: 2020 2320 4669 6e64 206d 696e 2061 6e64    # Find min and
+000121a0: 206d 6178 2076 6f78 656c 733b 2061 6464   max voxels; add
+000121b0: 2068 616c 6620 6120 766f 7865 6c20 6569   half a voxel ei
+000121c0: 7468 6572 2073 6964 6520 746f 2067 6574  ther side to get
+000121d0: 200a 2020 2020 2020 2020 2320 6675 6c6c   .        # full
+000121e0: 2065 7874 656e 740a 2020 2020 2020 2020   extent.        
+000121f0: 6d69 6e5f 706f 7320 3d20 6d69 6e28 7661  min_pos = min(va
+00012200: 6c73 2920 2d20 302e 350a 2020 2020 2020  ls) - 0.5.      
+00012210: 2020 6d61 785f 706f 7320 3d20 6d61 7828    max_pos = max(
+00012220: 7661 6c73 2920 2b20 302e 350a 0a20 2020  vals) + 0.5..   
+00012230: 2020 2020 2023 2043 6f6e 7665 7274 2070       # Convert p
+00012240: 6f73 6974 696f 6e73 2074 6f20 6d6d 0a20  ositions to mm. 
+00012250: 2020 2020 2020 2072 6574 7572 6e20 5b73         return [s
+00012260: 656c 662e 6964 785f 746f 5f70 6f73 286d  elf.idx_to_pos(m
+00012270: 696e 5f70 6f73 2c20 6178 2920 2d20 6f72  in_pos, ax) - or
+00012280: 6967 696e 2c0a 2020 2020 2020 2020 2020  igin,.          
+00012290: 2020 2020 2020 7365 6c66 2e69 6478 5f74        self.idx_t
+000122a0: 6f5f 706f 7328 6d61 785f 706f 732c 2061  o_pos(max_pos, a
+000122b0: 7829 202d 206f 7269 6769 6e5d 0a0a 2020  x) - origin]..  
+000122c0: 2020 6465 6620 6765 745f 6372 6f70 5f6c    def get_crop_l
+000122d0: 696d 6974 7328 7365 6c66 2c20 6372 6f70  imits(self, crop
+000122e0: 5f6d 6172 6769 6e73 3d4e 6f6e 652c 206d  _margins=None, m
+000122f0: 6574 686f 643d 4e6f 6e65 293a 0a20 2020  ethod=None):.   
+00012300: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+00012310: 2047 6574 2063 726f 7020 6c69 6d69 7473   Get crop limits
+00012320: 2063 6f72 7265 7370 6f6e 6469 6e67 2074   corresponding t
+00012330: 6f20 524f 4920 6578 7465 6e74 7320 706c  o ROI extents pl
+00012340: 7573 206d 6172 6769 6e73 2e0a 0a20 2020  us margins...   
+00012350: 2020 2020 2054 6865 2074 7570 6c65 7320       The tuples 
+00012360: 6f66 206c 696d 6974 7320 7265 7475 726e  of limits return
+00012370: 6564 2c20 696e 2074 6865 206f 7264 6572  ed, in the order
+00012380: 2028 782c 2079 2c20 7a29 2063 616e 0a20   (x, y, z) can. 
+00012390: 2020 2020 2020 2062 6520 7573 6564 2c20         be used, 
+000123a0: 666f 7220 6578 616d 706c 652c 2061 7320  for example, as 
+000123b0: 696e 7075 7473 2074 6f20 736b 7274 2e69  inputs to skrt.i
+000123c0: 6d61 6765 2e49 6d61 6765 2e63 726f 7028  mage.Image.crop(
+000123d0: 292e 0a0a 2020 2020 2020 2020 5468 6973  )...        This
+000123e0: 206d 6574 686f 6420 6973 2073 696d 696c   method is simil
+000123f0: 6172 2074 6f20 7468 6520 6d65 7468 6f64  ar to the method
+00012400: 2067 6574 5f65 7874 656e 7473 2829 2c20   get_extents(), 
+00012410: 6275 7420 616c 6c6f 7773 0a20 2020 2020  but allows.     
+00012420: 2020 2064 6966 6665 7265 6e74 206d 6172     different mar
+00012430: 6769 6e73 206f 6e20 6561 6368 2073 6964  gins on each sid
+00012440: 6520 6f66 2074 6865 2052 4f49 2e0a 0a20  e of the ROI... 
+00012450: 2020 2020 2020 202a 2a50 6172 616d 6574         **Paramet
+00012460: 6572 733a 2a2a 0a0a 2020 2020 2020 2020  ers:**..        
+00012470: 6372 6f70 5f6d 6172 6769 6e73 203a 2066  crop_margins : f
+00012480: 6c6f 6174 2f74 7570 6c65 2c20 6465 6661  loat/tuple, defa
+00012490: 756c 743d 4e6f 6e65 0a20 2020 2020 2020  ult=None.       
+000124a0: 2020 2020 2046 6c6f 6174 206f 7220 7468       Float or th
+000124b0: 7265 652d 656c 656d 656e 7420 7475 706c  ree-element tupl
+000124c0: 6520 7370 6563 6966 7969 6e67 2074 6865  e specifying the
+000124d0: 206d 6172 6769 6e73 2c20 696e 206d 6d2c   margins, in mm,
+000124e0: 0a20 2020 2020 2020 2020 2020 2074 6f20  .            to 
+000124f0: 6265 2061 6464 6564 2074 6f20 524f 4920  be added to ROI 
+00012500: 6578 7465 6e74 732e 2020 4966 2061 2066  extents.  If a f
+00012510: 6c6f 6174 2c20 6d69 6e75 7320 616e 6420  loat, minus and 
+00012520: 706c 7573 2074 6865 0a20 2020 2020 2020  plus the.       
+00012530: 2020 2020 2076 616c 7565 2073 7065 6369       value speci
+00012540: 6669 6564 2061 7265 2061 6464 6564 2074  fied are added t
+00012550: 6f20 6c6f 7765 7220 616e 6420 7570 7065  o lower and uppe
+00012560: 7220 6578 7465 6e74 7320 7265 7370 6563  r extents respec
+00012570: 7469 7665 6c79 0a20 2020 2020 2020 2020  tively.         
+00012580: 2020 2061 6c6f 6e67 2065 6163 6820 6178     along each ax
+00012590: 6973 2e20 2049 6620 6120 7468 7265 652d  is.  If a three-
+000125a0: 656c 656d 656e 7420 7475 706c 652c 2065  element tuple, e
+000125b0: 6c65 6d65 6e74 7320 6172 650a 2020 2020  lements are.    
+000125c0: 2020 2020 2020 2020 7461 6b65 6e20 746f          taken to
+000125d0: 2073 7065 6369 6679 206d 6172 6769 6e73   specify margins
+000125e0: 2069 6e20 7468 6520 6f72 6465 7220 2878   in the order (x
+000125f0: 2c20 792c 207a 292e 2020 456c 656d 656e  , y, z).  Elemen
+00012600: 7473 0a20 2020 2020 2020 2020 2020 2063  ts.            c
+00012610: 616e 2062 6520 6569 7468 6572 2066 6c6f  an be either flo
+00012620: 6174 7320 286d 696e 7573 2061 6e64 2070  ats (minus and p
+00012630: 6c75 7320 7468 6520 7661 6c75 6520 6164  lus the value ad
+00012640: 6465 6420 7265 7370 6563 7469 7665 6c79  ded respectively
+00012650: 0a20 2020 2020 2020 2020 2020 2074 6f20  .            to 
+00012660: 6c6f 7765 7220 616e 6420 7570 7065 7220  lower and upper 
+00012670: 6578 7465 6e74 7329 206f 7220 7477 6f2d  extents) or two-
+00012680: 656c 656d 656e 7420 7475 706c 6573 2028  element tuples (
+00012690: 656c 656d 656e 7473 2030 2061 6e64 2031  elements 0 and 1
+000126a0: 0a20 2020 2020 2020 2020 2020 2061 6464  .            add
+000126b0: 6564 2072 6573 7065 6374 6976 656c 7920  ed respectively 
+000126c0: 746f 206c 6f77 6572 2061 6e64 2075 7070  to lower and upp
+000126d0: 6572 2065 7874 656e 7473 292e 0a0a 2020  er extents)...  
+000126e0: 2020 2020 2020 6d65 7468 6f64 203a 2073        method : s
+000126f0: 7472 2c20 6465 6661 756c 743d 4e6f 6e65  tr, default=None
+00012700: 0a20 2020 2020 2020 2020 2020 204d 6574  .            Met
+00012710: 686f 6420 746f 2075 7365 2066 6f72 2065  hod to use for e
+00012720: 7874 656e 7420 6361 6c63 756c 6174 696f  xtent calculatio
+00012730: 6e2e 2043 616e 2062 653a 0a0a 2020 2020  n. Can be:..    
+00012740: 2020 2020 2020 2020 2020 2020 2a20 2263              * "c
+00012750: 6f6e 746f 7572 223a 2067 6574 2065 7874  ontour": get ext
+00012760: 656e 7420 6672 6f6d 206d 696e 2f6d 6178  ent from min/max
+00012770: 2070 6f73 6974 696f 6e73 206f 6620 636f   positions of co
+00012780: 6e74 6f75 7228 7329 2e0a 2020 2020 2020  ntour(s)..      
+00012790: 2020 2020 2020 2020 2020 2a20 226d 6173            * "mas
+000127a0: 6b22 3a20 6765 7420 6578 7465 6e74 2066  k": get extent f
+000127b0: 726f 6d20 6d69 6e2f 6d61 7820 706f 7369  rom min/max posi
+000127c0: 7469 6f6e 7320 6f66 2076 6f78 656c 7320  tions of voxels 
+000127d0: 696e 2074 6865 0a20 2020 2020 2020 2020  in the.         
+000127e0: 2020 2020 2020 2020 2062 696e 6172 7920           binary 
+000127f0: 6d61 736b 2e0a 2020 2020 2020 2020 2020  mask..          
+00012800: 2020 2020 2020 2a20 4e6f 6e65 3a20 7573        * None: us
+00012810: 6520 7468 6520 6d65 7468 6f64 2073 6574  e the method set
+00012820: 2069 6e20 7365 6c66 2e64 6566 6175 6c74   in self.default
+00012830: 5f67 656f 6d5f 6d65 7468 6f64 2e0a 2020  _geom_method..  
+00012840: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+00012850: 2020 6372 6f70 5f6c 696d 6974 7320 3d20    crop_limits = 
+00012860: 7365 6c66 2e67 6574 5f65 7874 656e 7473  self.get_extents
+00012870: 286d 6574 686f 643d 6d65 7468 6f64 290a  (method=method).
+00012880: 2020 2020 2020 2020 6d61 7267 696e 7320          margins 
+00012890: 3d20 736b 7274 2e69 6d61 6765 2e63 6865  = skrt.image.che
+000128a0: 636b 6564 5f63 726f 705f 6c69 6d69 7473  cked_crop_limits
+000128b0: 2863 726f 705f 6d61 7267 696e 7329 0a20  (crop_margins). 
+000128c0: 2020 2020 2020 2066 6f72 2069 6478 3120         for idx1 
+000128d0: 696e 2072 616e 6765 2833 293a 0a20 2020  in range(3):.   
+000128e0: 2020 2020 2020 2020 2069 6620 6d61 7267           if marg
+000128f0: 696e 735b 6964 7831 5d20 6973 206e 6f74  ins[idx1] is not
+00012900: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+00012910: 2020 2020 2020 2066 6f72 2069 6478 3220         for idx2 
+00012920: 696e 2072 616e 6765 2832 293a 0a20 2020  in range(2):.   
+00012930: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012940: 2063 726f 705f 6c69 6d69 7473 5b69 6478   crop_limits[idx
+00012950: 315d 5b69 6478 325d 202b 3d20 6d61 7267  1][idx2] += marg
+00012960: 696e 735b 6964 7831 5d5b 6964 7832 5d0a  ins[idx1][idx2].
+00012970: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00012980: 6372 6f70 5f6c 696d 6974 730a 0a20 2020  crop_limits..   
+00012990: 2064 6566 2067 6574 5f6c 656e 6774 6828   def get_length(
+000129a0: 0a20 2020 2020 2020 2073 656c 662c 200a  .        self, .
+000129b0: 2020 2020 2020 2020 6178 3d22 7a22 2c20          ax="z", 
+000129c0: 0a20 2020 2020 2020 2073 696e 676c 655f  .        single_
+000129d0: 736c 6963 653d 4661 6c73 652c 0a20 2020  slice=False,.   
+000129e0: 2020 2020 2076 6965 773d 2278 2d79 222c       view="x-y",
+000129f0: 0a20 2020 2020 2020 2073 6c3d 4e6f 6e65  .        sl=None
+00012a00: 2c20 0a20 2020 2020 2020 2069 6478 3d4e  , .        idx=N
+00012a10: 6f6e 652c 200a 2020 2020 2020 2020 706f  one, .        po
+00012a20: 733d 4e6f 6e65 2c20 0a20 2020 2020 2020  s=None, .       
+00012a30: 2075 6e69 7473 3d22 6d6d 222c 0a20 2020   units="mm",.   
+00012a40: 2020 2020 206d 6574 686f 643d 4e6f 6e65       method=None
+00012a50: 2c20 0a20 2020 2020 2020 2066 6f72 6365  , .        force
+00012a60: 3d54 7275 650a 2020 2020 293a 0a20 2020  =True.    ):.   
+00012a70: 2020 2020 2022 2222 4765 7420 524f 4920       """Get ROI 
+00012a80: 6c65 6e67 7468 2061 6c6f 6e67 2061 2067  length along a g
+00012a90: 6976 656e 2061 7869 732e 2049 6620 7369  iven axis. If si
+00012aa0: 6e67 6c65 5f73 6c69 6365 3d46 616c 7365  ngle_slice=False
+00012ab0: 2028 692e 652e 2061 200a 2020 2020 2020   (i.e. a .      
+00012ac0: 2020 676c 6f62 616c 206c 656e 6774 6820    global length 
+00012ad0: 6973 2072 6571 7565 7374 6564 292c 2063  is requested), c
+00012ae0: 616c 6375 6c61 7465 6420 6c65 6e67 7468  alculated length
+00012af0: 2077 696c 6c20 6265 2063 6163 6865 6420   will be cached 
+00012b00: 696e 200a 2020 2020 2020 2020 7365 6c66  in .        self
+00012b10: 2e5f 6c65 6e67 7468 5b61 785d 5b75 6e69  ._length[ax][uni
+00012b20: 7473 5d20 616e 6420 7265 7475 726e 6564  ts] and returned
+00012b30: 2069 6620 6361 6c6c 6564 2061 6761 696e   if called again
+00012b40: 2c20 756e 6c65 7373 2066 6f72 6365 3d54  , unless force=T
+00012b50: 7275 652e 0a0a 2020 2020 2020 2020 2a2a  rue...        **
+00012b60: 5061 7261 6d65 7465 7273 3a2a 2a0a 2020  Parameters:**.  
+00012b70: 2020 2020 2020 0a20 2020 2020 2020 2061        .        a
+00012b80: 7820 3a20 7374 722f 696e 742c 2064 6566  x : str/int, def
+00012b90: 6175 6c74 3d22 7a22 0a20 2020 2020 2020  ault="z".       
+00012ba0: 2020 2020 2041 7869 7320 616c 6f6e 6720       Axis along 
+00012bb0: 7768 6963 6820 746f 2072 6574 7572 6e20  which to return 
+00012bc0: 6c65 6e67 7468 3b20 7368 6f75 6c64 2062  length; should b
+00012bd0: 6520 6f6e 6520 6f66 205b 2278 222c 2022  e one of ["x", "
+00012be0: 7922 2c20 227a 225d 0a20 2020 2020 2020  y", "z"].       
+00012bf0: 2020 2020 206f 7220 5b30 2c20 312c 2032       or [0, 1, 2
+00012c00: 5d2e 0a0a 2020 2020 2020 2020 7369 6e67  ]...        sing
+00012c10: 6c65 5f73 6c69 6365 203a 2062 6f6f 6c2c  le_slice : bool,
+00012c20: 2064 6566 6175 6c74 3d46 616c 7365 0a20   default=False. 
+00012c30: 2020 2020 2020 2020 2020 2049 6620 4661             If Fa
+00012c40: 6c73 652c 2074 6865 206c 656e 6774 6820  lse, the length 
+00012c50: 6f66 2074 6865 2065 6e74 6972 6520 524f  of the entire RO
+00012c60: 4920 7769 6c6c 2062 6520 7265 7475 726e  I will be return
+00012c70: 6564 3b0a 2020 2020 2020 2020 2020 2020  ed;.            
+00012c80: 6f74 6865 7277 6973 652c 2074 6865 206c  otherwise, the l
+00012c90: 656e 6774 6820 6f6e 2061 2073 696e 676c  ength on a singl
+00012ca0: 6520 736c 6963 6520 7769 6c6c 2062 6520  e slice will be 
+00012cb0: 7265 7475 726e 6564 2e0a 0a20 2020 2020  returned...     
+00012cc0: 2020 2076 6965 7720 3a20 7374 722c 2064     view : str, d
+00012cd0: 6566 6175 6c74 3d22 782d 7922 0a20 2020  efault="x-y".   
+00012ce0: 2020 2020 2020 2020 204f 7269 656e 7461           Orienta
+00012cf0: 7469 6f6e 206f 6620 736c 6963 6520 6f6e  tion of slice on
+00012d00: 2077 6869 6368 2074 6f20 6765 7420 6c65   which to get le
+00012d10: 6e67 7468 2e20 4f6e 6c79 2075 7365 6420  ngth. Only used 
+00012d20: 6966 200a 2020 2020 2020 2020 2020 2020  if .            
+00012d30: 7369 6e67 6c65 5f73 6c69 6365 3d54 7275  single_slice=Tru
+00012d40: 652e 2049 6620 7573 696e 672c 203c 6178  e. If using, <ax
+00012d50: 3e20 6d75 7374 2062 6520 616e 2061 7869  > must be an axi
+00012d60: 7320 7468 6174 206c 6965 7320 616c 6f6e  s that lies alon
+00012d70: 670a 2020 2020 2020 2020 2020 2020 7468  g.            th
+00012d80: 6520 736c 6963 6520 696e 2074 6869 7320  e slice in this 
+00012d90: 6f72 6965 6e74 6174 696f 6e2e 0a0a 2020  orientation...  
+00012da0: 2020 2020 2020 736c 203a 2069 6e74 2c20        sl : int, 
+00012db0: 6465 6661 756c 743d 4e6f 6e65 0a20 2020  default=None.   
+00012dc0: 2020 2020 2020 2020 2053 6c69 6365 206e           Slice n
+00012dd0: 756d 6265 722e 2049 6620 6e6f 6e65 206f  umber. If none o
+00012de0: 6620 3c73 6c3e 2c20 3c69 6478 3e20 6f72  f <sl>, <idx> or
+00012df0: 203c 706f 733e 2061 7265 2073 7570 706c   <pos> are suppl
+00012e00: 6965 6420 6275 740a 2020 2020 2020 2020  ied but.        
+00012e10: 2020 2020 3c73 696e 676c 655f 736c 6963      <single_slic
+00012e20: 653e 2069 7320 5472 7565 2c20 7468 6520  e> is True, the 
+00012e30: 6365 6e74 7261 6c20 736c 6963 6520 6f66  central slice of
+00012e40: 2074 6865 2052 4f49 2077 696c 6c20 6265   the ROI will be
+00012e50: 2075 7365 642e 0a0a 2020 2020 2020 2020   used...        
+00012e60: 6964 7820 3a20 696e 742c 2064 6566 6175  idx : int, defau
+00012e70: 6c74 3d4e 6f6e 650a 2020 2020 2020 2020  lt=None.        
+00012e80: 2020 2020 4172 7261 7920 696e 6465 7820      Array index 
+00012e90: 6f66 2073 6c69 6365 2e20 4966 206e 6f6e  of slice. If non
+00012ea0: 6520 6f66 203c 736c 3e2c 203c 6964 783e  e of <sl>, <idx>
+00012eb0: 206f 7220 3c70 6f73 3e20 6172 6520 7375   or <pos> are su
+00012ec0: 7070 6c69 6564 2062 7574 0a20 2020 2020  pplied but.     
+00012ed0: 2020 2020 2020 203c 7369 6e67 6c65 5f73         <single_s
+00012ee0: 6c69 6365 3e20 6973 2054 7275 652c 2074  lice> is True, t
+00012ef0: 6865 2063 656e 7472 616c 2073 6c69 6365  he central slice
+00012f00: 206f 6620 7468 6520 524f 4920 7769 6c6c   of the ROI will
+00012f10: 2062 6520 7573 6564 2e0a 0a20 2020 2020   be used...     
+00012f20: 2020 2070 6f73 203a 2066 6c6f 6174 2c20     pos : float, 
+00012f30: 6465 6661 756c 743d 4e6f 6e65 0a20 2020  default=None.   
+00012f40: 2020 2020 2020 2020 2053 6c69 6365 2070           Slice p
+00012f50: 6f73 6974 696f 6e20 696e 206d 6d2e 2049  osition in mm. I
+00012f60: 6620 6e6f 6e65 206f 6620 3c73 6c3e 2c20  f none of <sl>, 
+00012f70: 3c69 6478 3e20 6f72 203c 706f 733e 2061  <idx> or <pos> a
+00012f80: 7265 2073 7570 706c 6965 6420 6275 740a  re supplied but.
+00012f90: 2020 2020 2020 2020 2020 2020 3c73 696e              <sin
+00012fa0: 676c 655f 736c 6963 653e 2069 7320 5472  gle_slice> is Tr
+00012fb0: 7565 2c20 7468 6520 6365 6e74 7261 6c20  ue, the central 
+00012fc0: 736c 6963 6520 6f66 2074 6865 2052 4f49  slice of the ROI
+00012fd0: 2077 696c 6c20 6265 2075 7365 642e 0a0a   will be used...
+00012fe0: 2020 2020 2020 2020 756e 6974 7320 3a20          units : 
+00012ff0: 7374 722c 2064 6566 6175 6c74 3d22 6d6d  str, default="mm
+00013000: 220a 2020 2020 2020 2020 2020 2020 556e  ".            Un
+00013010: 6974 7320 6f66 206c 656e 6774 682e 2043  its of length. C
+00013020: 616e 2062 6520 6569 7468 6572 206f 663a  an be either of:
+00013030: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00013040: 202d 2022 6d6d 223a 2072 6574 7572 6e20   - "mm": return 
+00013050: 6c65 6e67 7468 2069 6e20 6d69 6c6c 696d  length in millim
+00013060: 6574 7265 732e 0a20 2020 2020 2020 2020  etres..         
+00013070: 2020 2020 2020 202d 2022 766f 7865 6c73         - "voxels
+00013080: 223a 2072 6574 7572 6e20 6c65 6e67 7468  ": return length
+00013090: 2069 6e20 6e75 6d62 6572 206f 6620 766f   in number of vo
+000130a0: 7865 6c73 2e0a 0a20 2020 2020 2020 2020  xels...         
+000130b0: 2020 2049 6620 756e 6974 733d 2276 6f78     If units="vox
+000130c0: 656c 7322 2069 7320 7265 7175 6573 7465  els" is requeste
+000130d0: 6420 6275 7420 7468 6973 2052 4f49 206f  d but this ROI o
+000130e0: 6e6c 7920 6861 7320 636f 6e74 6f75 7273  nly has contours
+000130f0: 2061 6e64 206e 6f0a 2020 2020 2020 2020   and no.        
+00013100: 2020 2020 766f 7865 6c20 7369 7a65 2069      voxel size i
+00013110: 6e66 6f72 6d61 7469 6f6e 2c20 616e 2065  nformation, an e
+00013120: 7272 6f72 2077 696c 6c20 6265 2072 6169  rror will be rai
+00013130: 7365 6420 2875 6e6c 6573 7320 6178 3d22  sed (unless ax="
+00013140: 7a22 2c20 0a20 2020 2020 2020 2020 2020  z", .           
+00013150: 2069 6e20 7768 6963 6820 6361 7365 2076   in which case v
+00013160: 6f78 656c 2073 697a 6520 7769 6c6c 2062  oxel size will b
+00013170: 6520 696e 6665 7272 6564 2066 726f 6d20  e inferred from 
+00013180: 7370 6163 696e 6720 6265 7477 6565 6e0a  spacing between.
+00013190: 2020 2020 2020 2020 2020 2020 736c 6963              slic
+000131a0: 6573 292e 0a0a 2020 2020 2020 2020 6d65  es)...        me
+000131b0: 7468 6f64 203a 2073 7472 2c20 6465 6661  thod : str, defa
+000131c0: 756c 743d 4e6f 6e65 0a20 2020 2020 2020  ult=None.       
+000131d0: 2020 2020 204d 6574 686f 6420 746f 2075       Method to u
+000131e0: 7365 2066 6f72 206c 656e 6774 6820 6361  se for length ca
+000131f0: 6c63 756c 6174 696f 6e2e 2043 616e 2062  lculation. Can b
+00013200: 653a 200a 2020 2020 2020 2020 2020 2020  e: .            
+00013210: 2020 2020 2d20 2263 6f6e 746f 7572 223a      - "contour":
+00013220: 2067 6574 206c 656e 6774 6820 6672 6f6d   get length from
+00013230: 206d 696e 2f6d 6178 2070 6f73 6974 696f   min/max positio
+00013240: 6e73 206f 6620 636f 6e74 6f75 7228 7329  ns of contour(s)
+00013250: 2e0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00013260: 2020 2d20 226d 6173 6b22 3a20 6765 7420    - "mask": get 
+00013270: 6c65 6e67 7468 2066 726f 6d20 6d69 6e2f  length from min/
+00013280: 6d61 7820 706f 7369 7469 6f6e 7320 6f66  max positions of
+00013290: 2076 6f78 656c 7320 696e 2074 6865 200a   voxels in the .
+000132a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000132b0: 2020 6269 6e61 7279 206d 6173 6b2e 0a20    binary mask.. 
+000132c0: 2020 2020 2020 2020 2020 2020 2020 202d                 -
+000132d0: 204e 6f6e 653a 2075 7365 2074 6865 206d   None: use the m
+000132e0: 6574 686f 6420 7365 7420 696e 2073 656c  ethod set in sel
+000132f0: 662e 6465 6661 756c 745f 6765 6f6d 5f6d  f.default_geom_m
+00013300: 6574 686f 642e 0a0a 2020 2020 2020 2020  ethod...        
+00013310: 666f 7263 6520 3a20 626f 6f6c 2c20 6465  force : bool, de
+00013320: 6661 756c 743d 5472 7565 0a20 2020 2020  fault=True.     
+00013330: 2020 2020 2020 2049 6620 5472 7565 2c20         If True, 
+00013340: 7468 6520 6c65 6e67 7468 2077 696c 6c20  the length will 
+00013350: 616c 7761 7973 2062 6520 7265 6361 6c63  always be recalc
+00013360: 756c 6174 6564 3b20 6f74 6865 7277 6973  ulated; otherwis
+00013370: 652c 2069 7420 7769 6c6c 0a20 2020 2020  e, it will.     
+00013380: 2020 2020 2020 206f 6e6c 7920 6265 2063         only be c
+00013390: 616c 6375 6c61 7465 6420 6966 2069 7420  alculated if it 
+000133a0: 6861 7320 6e6f 7420 7965 7420 6265 656e  has not yet been
+000133b0: 2063 6163 6865 6420 696e 2073 656c 662e   cached in self.
+000133c0: 5f76 6f6c 756d 652e 0a20 2020 2020 2020  _volume..       
+000133d0: 2020 2020 204e 6f74 6520 7468 6174 2069       Note that i
+000133e0: 6620 7369 6e67 6c65 5f73 6c69 6365 3d54  f single_slice=T
+000133f0: 7275 652c 2074 6865 206c 656e 6774 6820  rue, the length 
+00013400: 7769 6c6c 2061 6c77 6179 7320 6265 200a  will always be .
+00013410: 2020 2020 2020 2020 2020 2020 7265 6361              reca
+00013420: 6c63 756c 6174 6564 2e0a 2020 2020 2020  lculated..      
+00013430: 2020 2222 220a 0a20 2020 2020 2020 2023    """..        #
+00013440: 2049 6620 676c 6f62 616c 206c 656e 6774   If global lengt
+00013450: 6820 616c 7265 6164 7920 6361 6368 6564  h already cached
+00013460: 2c20 7265 7475 726e 2063 6163 6865 6420  , return cached 
+00013470: 7661 6c75 650a 2020 2020 2020 2020 6966  value.        if
+00013480: 206e 6f74 2073 696e 676c 655f 736c 6963   not single_slic
+00013490: 6520 616e 6420 6e6f 7420 666f 7263 653a  e and not force:
+000134a0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+000134b0: 6861 7361 7474 7228 7365 6c66 2c20 225f  hasattr(self, "_
+000134c0: 6c65 6e67 7468 2229 2061 6e64 2061 7820  length") and ax 
+000134d0: 696e 2073 656c 662e 5f6c 656e 6774 6820  in self._length 
+000134e0: 5c0a 2020 2020 2020 2020 2020 2020 2020  \.              
+000134f0: 2061 6e64 2075 6e69 7473 2069 6e20 7365   and units in se
+00013500: 6c66 2e5f 6c65 6e67 7468 5b61 785d 3a0a  lf._length[ax]:.
+00013510: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013520: 7265 7475 726e 2073 656c 662e 5f6c 656e  return self._len
+00013530: 6774 685b 6178 5d5b 756e 6974 735d 0a0a  gth[ax][units]..
+00013540: 2020 2020 2020 2020 2320 4966 2073 696e          # If sin
+00013550: 676c 6520 736c 6963 6520 7265 7175 6573  gle slice reques
+00013560: 7465 6420 616e 6420 6e6f 7420 6f6e 2063  ted and not on c
+00013570: 7572 7265 6e74 2073 6c69 6365 2c20 7265  urrent slice, re
+00013580: 7475 726e 204e 6f6e 650a 2020 2020 2020  turn None.      
+00013590: 2020 6966 2073 696e 676c 655f 736c 6963    if single_slic
+000135a0: 6520 616e 6420 6e6f 7420 7365 6c66 2e6f  e and not self.o
+000135b0: 6e5f 736c 6963 6528 7669 6577 2c20 736c  n_slice(view, sl
+000135c0: 3d73 6c2c 2069 6478 3d69 6478 2c20 706f  =sl, idx=idx, po
+000135d0: 733d 706f 7329 3a0a 2020 2020 2020 2020  s=pos):.        
+000135e0: 2020 2020 7265 7475 726e 204e 6f6e 650a      return None.
+000135f0: 0a20 2020 2020 2020 2023 2047 6574 206c  .        # Get l
+00013600: 656e 6774 6820 696e 206d 6d20 6672 6f6d  ength in mm from
+00013610: 206d 696e 2061 6e64 206d 6178 2070 6f73   min and max pos
+00013620: 6974 696f 6e73 0a20 2020 2020 2020 2073  itions.        s
+00013630: 656c 662e 6c6f 6164 2829 0a20 2020 2020  elf.load().     
+00013640: 2020 206d 696e 5f70 6f73 2c20 6d61 785f     min_pos, max_
+00013650: 706f 7320 3d20 7365 6c66 2e67 6574 5f65  pos = self.get_e
+00013660: 7874 656e 7428 0a20 2020 2020 2020 2020  xtent(.         
+00013670: 2020 2061 783d 6178 2c20 0a20 2020 2020     ax=ax, .     
+00013680: 2020 2020 2020 2073 696e 676c 655f 736c         single_sl
+00013690: 6963 653d 7369 6e67 6c65 5f73 6c69 6365  ice=single_slice
+000136a0: 2c0a 2020 2020 2020 2020 2020 2020 7669  ,.            vi
+000136b0: 6577 3d76 6965 772c 0a20 2020 2020 2020  ew=view,.       
+000136c0: 2020 2020 2073 6c3d 736c 2c0a 2020 2020       sl=sl,.    
+000136d0: 2020 2020 2020 2020 6964 783d 6964 782c          idx=idx,
+000136e0: 0a20 2020 2020 2020 2020 2020 2070 6f73  .            pos
+000136f0: 3d70 6f73 2c0a 2020 2020 2020 2020 2020  =pos,.          
+00013700: 2020 6d65 7468 6f64 3d6d 6574 686f 640a    method=method.
+00013710: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+00013720: 2020 6c65 6e67 7468 203d 207b 0a20 2020    length = {.   
+00013730: 2020 2020 2020 2020 2022 6d6d 223a 2061           "mm": a
+00013740: 6273 286d 6178 5f70 6f73 202d 206d 696e  bs(max_pos - min
+00013750: 5f70 6f73 290a 2020 2020 2020 2020 7d0a  _pos).        }.
+00013760: 0a20 2020 2020 2020 2023 2047 6574 206c  .        # Get l
+00013770: 656e 6774 6820 696e 2076 6f78 656c 730a  ength in voxels.
+00013780: 2020 2020 2020 2020 2320 4361 7365 2077          # Case w
+00013790: 6865 7265 2076 6f78 656c 2073 697a 6520  here voxel size 
+000137a0: 6973 206b 6e6f 776e 0a20 2020 2020 2020  is known.       
+000137b0: 2069 5f61 7820 3d20 736b 7274 2e69 6d61   i_ax = skrt.ima
+000137c0: 6765 2e5f 6178 6573 2e69 6e64 6578 2861  ge._axes.index(a
+000137d0: 7829 2069 6620 6973 696e 7374 616e 6365  x) if isinstance
+000137e0: 2861 782c 2073 7472 2920 656c 7365 2061  (ax, str) else a
+000137f0: 780a 2020 2020 2020 2020 6966 2073 656c  x.        if sel
+00013800: 662e 766f 7865 6c5f 7369 7a65 2069 7320  f.voxel_size is 
+00013810: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
+00013820: 2020 2020 2020 6c65 6e67 7468 5b22 766f        length["vo
+00013830: 7865 6c73 225d 203d 206c 656e 6774 685b  xels"] = length[
+00013840: 226d 6d22 5d20 2f20 7365 6c66 2e76 6f78  "mm"] / self.vox
+00013850: 656c 5f73 697a 655b 695f 6178 5d0a 0a20  el_size[i_ax].. 
+00013860: 2020 2020 2020 2023 2044 6561 6c20 7769         # Deal wi
+00013870: 7468 2063 6173 6520 7768 6572 6520 7365  th case where se
+00013880: 6c66 2e76 6f78 656c 5f73 697a 6520 6973  lf.voxel_size is
+00013890: 204e 6f6e 650a 2020 2020 2020 2020 656c   None.        el
+000138a0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+000138b0: 6966 2069 5f61 7820 3d3d 2032 3a0a 2020  if i_ax == 2:.  
+000138c0: 2020 2020 2020 2020 2020 2020 2020 6c65                le
+000138d0: 6e67 7468 5b22 766f 7865 6c73 225d 203d  ngth["voxels"] =
+000138e0: 206c 656e 6774 685b 226d 6d22 5d20 2f20   length["mm"] / 
+000138f0: 7365 6c66 2e67 6574 5f73 6c69 6365 5f74  self.get_slice_t
+00013900: 6869 636b 6e65 7373 5f63 6f6e 746f 7572  hickness_contour
+00013910: 7328 290a 2020 2020 2020 2020 2020 2020  s().            
+00013920: 656c 6966 2075 6e69 7473 203d 3d20 2276  elif units == "v
+00013930: 6f78 656c 7322 3a0a 2020 2020 2020 2020  oxels":.        
+00013940: 2020 2020 2020 2020 7261 6973 6520 5275          raise Ru
+00013950: 6e74 696d 6545 7272 6f72 2822 4361 6e6e  ntimeError("Cann
+00013960: 6f74 2063 6f6d 7075 7465 206c 656e 6774  ot compute lengt
+00013970: 6820 696e 2076 6f78 656c 7320 6672 6f6d  h in voxels from
+00013980: 2022 0a20 2020 2020 2020 2020 2020 2020   ".             
+00013990: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000139a0: 2020 2020 2020 2263 6f6e 746f 7572 7320        "contours 
+000139b0: 7769 7468 6f75 7420 6b6e 6f77 696e 6720  without knowing 
+000139c0: 766f 7865 6c20 7369 7a65 7321 2229 0a0a  voxel sizes!")..
+000139d0: 2020 2020 2020 2020 0a20 2020 2020 2020          .       
+000139e0: 2023 2043 6163 6865 2074 6865 2070 726f   # Cache the pro
+000139f0: 7065 7274 7920 6966 2067 6c6f 6261 6c0a  perty if global.
+00013a00: 2020 2020 2020 2020 6966 206e 6f74 2073          if not s
+00013a10: 696e 676c 655f 736c 6963 653a 0a20 2020  ingle_slice:.   
+00013a20: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
+00013a30: 6861 7361 7474 7228 7365 6c66 2c20 225f  hasattr(self, "_
+00013a40: 6c65 6e67 7468 2229 3a0a 2020 2020 2020  length"):.      
+00013a50: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
+00013a60: 6c65 6e67 7468 203d 207b 7d0a 2020 2020  length = {}.    
+00013a70: 2020 2020 2020 2020 7365 6c66 2e5f 6c65          self._le
+00013a80: 6e67 7468 5b73 6b72 742e 696d 6167 652e  ngth[skrt.image.
+00013a90: 5f61 7865 735b 695f 6178 5d5d 203d 206c  _axes[i_ax]] = l
+00013aa0: 656e 6774 680a 2020 2020 2020 2020 0a20  ength.        . 
+00013ab0: 2020 2020 2020 2023 2052 6574 7572 6e20         # Return 
+00013ac0: 6465 7369 7265 6420 756e 6974 730a 2020  desired units.  
+00013ad0: 2020 2020 2020 7265 7475 726e 206c 656e        return len
+00013ae0: 6774 685b 756e 6974 735d 0a0a 2020 2020  gth[units]..    
+00013af0: 6465 6620 6765 745f 6765 6f6d 6574 7279  def get_geometry
+00013b00: 280a 2020 2020 2020 2020 7365 6c66 2c0a  (.        self,.
+00013b10: 2020 2020 2020 2020 6d65 7472 6963 733d          metrics=
+00013b20: 4e6f 6e65 2c0a 2020 2020 2020 2020 766f  None,.        vo
+00013b30: 6c5f 756e 6974 733d 226d 6d22 2c0a 2020  l_units="mm",.  
+00013b40: 2020 2020 2020 6172 6561 5f75 6e69 7473        area_units
+00013b50: 3d22 6d6d 222c 0a20 2020 2020 2020 206c  ="mm",.        l
+00013b60: 656e 6774 685f 756e 6974 733d 226d 6d22  ength_units="mm"
+00013b70: 2c0a 2020 2020 2020 2020 6365 6e74 726f  ,.        centro
+00013b80: 6964 5f75 6e69 7473 3d22 6d6d 222c 0a20  id_units="mm",. 
+00013b90: 2020 2020 2020 2076 6965 773d 2278 2d79         view="x-y
+00013ba0: 222c 0a20 2020 2020 2020 2073 6c3d 4e6f  ",.        sl=No
+00013bb0: 6e65 2c0a 2020 2020 2020 2020 706f 733d  ne,.        pos=
+00013bc0: 4e6f 6e65 2c0a 2020 2020 2020 2020 6964  None,.        id
+00013bd0: 783d 4e6f 6e65 2c0a 2020 2020 2020 2020  x=None,.        
+00013be0: 6d65 7468 6f64 3d4e 6f6e 652c 0a20 2020  method=None,.   
+00013bf0: 2020 2020 2075 6e69 7473 5f69 6e5f 6865       units_in_he
+00013c00: 6164 6572 3d46 616c 7365 2c0a 2020 2020  ader=False,.    
+00013c10: 2020 2020 676c 6f62 616c 5f76 735f 736c      global_vs_sl
+00013c20: 6963 655f 6865 6164 6572 3d46 616c 7365  ice_header=False
+00013c30: 2c0a 2020 2020 2020 2020 6e61 6d65 5f61  ,.        name_a
+00013c40: 735f 696e 6465 783d 5472 7565 2c0a 2020  s_index=True,.  
+00013c50: 2020 2020 2020 6e69 6365 5f63 6f6c 756d        nice_colum
+00013c60: 6e73 3d46 616c 7365 2c0a 2020 2020 2020  ns=False,.      
+00013c70: 2020 6465 6369 6d61 6c5f 706c 6163 6573    decimal_places
+00013c80: 3d4e 6f6e 652c 0a20 2020 2020 2020 2066  =None,.        f
+00013c90: 6f72 6365 3d54 7275 652c 0a20 2020 2020  orce=True,.     
+00013ca0: 2020 2068 746d 6c3d 4661 6c73 650a 2020     html=False.  
+00013cb0: 2020 293a 0a20 2020 2020 2020 2022 2222    ):.        """
+00013cc0: 5265 7475 726e 2061 2070 616e 6461 7320  Return a pandas 
+00013cd0: 4461 7461 4672 616d 6520 6f72 2068 746d  DataFrame or htm
+00013ce0: 6c20 7461 626c 6520 6f66 2074 6865 2067  l table of the g
+00013cf0: 656f 6d65 7472 6963 2070 726f 7065 7274  eometric propert
+00013d00: 6965 7320 0a20 2020 2020 2020 206c 6973  ies .        lis
+00013d10: 7465 6420 696e 203c 6d65 7472 6963 733e  ted in <metrics>
+00013d20: 2e0a 0a20 2020 2020 2020 202a 2a50 6172  ...        **Par
+00013d30: 616d 6574 6572 733a 2a2a 0a20 2020 2020  ameters:**.     
+00013d40: 2020 200a 2020 2020 2020 2020 6d65 7472     .        metr
+00013d50: 6963 7320 3a20 6c69 7374 2c20 6465 6661  ics : list, defa
+00013d60: 756c 743d 4e6f 6e65 0a20 2020 2020 2020  ult=None.       
+00013d70: 2020 2020 204c 6973 7420 6f66 206d 6574       List of met
+00013d80: 7269 6373 2074 6f20 696e 636c 7564 6520  rics to include 
+00013d90: 696e 2074 6865 2074 6162 6c65 2e20 4f70  in the table. Op
+00013da0: 7469 6f6e 733a 0a0a 2020 2020 2020 2020  tions:..        
+00013db0: 2020 2020 2020 2020 2d20 2276 6f6c 756d          - "volum
+00013dc0: 6522 203a 2076 6f6c 756d 6520 6f66 2065  e" : volume of e
+00013dd0: 6e74 6972 6520 524f 492e 0a20 2020 2020  ntire ROI..     
+00013de0: 2020 2020 2020 2020 2020 202d 2022 6172             - "ar
+00013df0: 6561 223a 2061 7265 6120 6f66 2052 4f49  ea": area of ROI
+00013e00: 206f 6e20 6120 7369 6e67 6c65 2073 6c69   on a single sli
+00013e10: 6365 2e0a 0a20 2020 2020 2020 2020 2020  ce...           
+00013e20: 2020 2020 202d 2022 6365 6e74 726f 6964       - "centroid
+00013e30: 223a 2033 4420 6365 6e74 7265 2d6f 662d  ": 3D centre-of-
+00013e40: 6d61 7373 206f 6620 524f 493b 2077 696c  mass of ROI; wil
+00013e50: 6c20 6265 2073 706c 6974 2069 6e74 6f0a  l be split into.
+00013e60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013e70: 2020 7468 7265 6520 636f 6c75 6d6e 7320    three columns 
+00013e80: 636f 7272 6573 706f 6e64 696e 6720 746f  corresponding to
+00013e90: 2074 6865 2074 6872 6565 2061 7865 732e   the three axes.
+00013ea0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00013eb0: 202d 2022 6365 6e74 726f 6964 5f73 6c69   - "centroid_sli
+00013ec0: 6365 223a 2032 4420 6365 6e74 7265 206f  ce": 2D centre o
+00013ed0: 6620 6d61 7373 206f 6e20 6120 7369 6e67  f mass on a sing
+00013ee0: 6c65 2073 6c69 6365 2e20 5769 6c6c 0a20  le slice. Will. 
+00013ef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013f00: 2062 6520 7370 6c69 7420 696e 746f 2074   be split into t
+00013f10: 776f 2063 6f6c 756d 6e73 2063 6f72 7265  wo columns corre
+00013f20: 7370 6f6e 6469 6e67 2074 6f20 7468 6520  sponding to the 
+00013f30: 7477 6f20 6178 6573 206f 6e0a 2020 2020  two axes on.    
+00013f40: 2020 2020 2020 2020 2020 2020 2020 7468                th
+00013f50: 6520 736c 6963 652e 0a0a 2020 2020 2020  e slice...      
+00013f60: 2020 2020 2020 2020 2020 2d20 226c 656e            - "len
+00013f70: 6774 6822 3a20 6c65 6e67 7468 7320 6f66  gth": lengths of
+00013f80: 2074 6865 2052 4f49 2069 6e20 6561 6368   the ROI in each
+00013f90: 2064 6972 6563 7469 6f6e 3b20 7769 6c6c   direction; will
+00013fa0: 2062 6520 7370 6c69 740a 2020 2020 2020   be split.      
+00013fb0: 2020 2020 2020 2020 2020 2020 696e 746f              into
+00013fc0: 2074 6872 6565 2063 6f6c 756d 6e73 2063   three columns c
+00013fd0: 6f72 7265 7370 6f6e 6469 6e67 2074 6f20  orresponding to 
+00013fe0: 7468 6520 7468 7265 6520 6178 6573 2e0a  the three axes..
+00013ff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014000: 2d20 226c 656e 6774 685f 736c 6963 6522  - "length_slice"
+00014010: 3a20 6c65 6e67 7468 206f 6620 7468 6520  : length of the 
+00014020: 524f 4920 6f6e 2061 2073 696e 676c 6520  ROI on a single 
+00014030: 736c 6963 653b 2077 696c 6c20 6265 0a20  slice; will be. 
+00014040: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014050: 2073 706c 6974 2069 6e74 6f20 7477 6f20   split into two 
+00014060: 636f 6c75 6d6e 7320 636f 7272 6573 706f  columns correspo
+00014070: 6e64 696e 6720 746f 2074 6865 2074 776f  nding to the two
+00014080: 2061 7865 7320 6f6e 2074 6865 0a20 2020   axes on the.   
+00014090: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+000140a0: 6c69 6365 2e0a 0a20 2020 2020 2020 2020  lice...         
+000140b0: 2020 2049 6620 4e6f 6e65 2c20 6465 6661     If None, defa
+000140c0: 756c 7473 2074 6f20 5b22 766f 6c75 6d65  ults to ["volume
+000140d0: 222c 2022 6365 6e74 726f 6964 225d 0a0a  ", "centroid"]..
+000140e0: 2020 2020 2020 2020 766f 6c5f 756e 6974          vol_unit
+000140f0: 7320 3a20 7374 722c 2064 6566 6175 6c74  s : str, default
+00014100: 3d22 6d6d 220a 2020 2020 2020 2020 2020  ="mm".          
+00014110: 2020 556e 6974 7320 746f 2075 7365 2066    Units to use f
+00014120: 6f72 2076 6f6c 756d 652e 2043 616e 2062  or volume. Can b
+00014130: 6520 226d 6d22 2028 3d6d 6d5e 3329 2c20  e "mm" (=mm^3), 
+00014140: 226d 6c22 2c0a 2020 2020 2020 2020 2020  "ml",.          
+00014150: 2020 6f72 2022 766f 7865 6c73 222e 0a0a    or "voxels"...
+00014160: 2020 2020 2020 2020 6172 6561 5f75 6e69          area_uni
+00014170: 7473 203a 2073 7472 2c20 6465 6661 756c  ts : str, defaul
+00014180: 743d 226d 6d22 0a20 2020 2020 2020 2020  t="mm".         
+00014190: 2020 2055 6e69 7473 2074 6f20 7573 6520     Units to use 
+000141a0: 666f 7220 6172 6561 732e 2043 616e 2062  for areas. Can b
+000141b0: 6520 226d 6d22 2028 3d6d 6d5e 3229 206f  e "mm" (=mm^2) o
+000141c0: 7220 2276 6f78 656c 7322 2e0a 0a20 2020  r "voxels"...   
+000141d0: 2020 2020 206c 656e 6774 685f 756e 6974       length_unit
+000141e0: 7320 3a20 7374 722c 2064 6566 6175 6c74  s : str, default
+000141f0: 3d22 6d6d 223a 0a20 2020 2020 2020 2020  ="mm":.         
+00014200: 2020 2055 6e69 7473 2074 6f20 7573 6520     Units to use 
+00014210: 666f 7220 6c65 6e67 7468 732e 2043 616e  for lengths. Can
+00014220: 2062 6520 226d 6d22 206f 7220 2276 6f78   be "mm" or "vox
+00014230: 656c 7322 2e0a 0a20 2020 2020 2020 2063  els"...        c
+00014240: 656e 7472 6f69 645f 756e 6974 733a 0a20  entroid_units:. 
+00014250: 2020 2020 2020 2020 2020 2055 6e69 7473             Units
+00014260: 2074 6f20 7573 6520 666f 7220 6365 6e74   to use for cent
+00014270: 726f 6964 732e 2043 616e 2062 6520 226d  roids. Can be "m
+00014280: 6d22 206f 7220 2276 6f78 656c 7322 2e0a  m" or "voxels"..
+00014290: 0a20 2020 2020 2020 2076 6965 7720 3a20  .        view : 
+000142a0: 7374 722c 2064 6566 6175 6c74 3d22 782d  str, default="x-
+000142b0: 7922 0a20 2020 2020 2020 2020 2020 204f  y".            O
+000142c0: 7269 656e 7461 7469 6f6e 2069 6e20 7768  rientation in wh
+000142d0: 6963 6820 746f 2063 6f6d 7075 7465 206d  ich to compute m
+000142e0: 6574 7269 6373 2e20 4f6e 6c79 2072 656c  etrics. Only rel
+000142f0: 6576 616e 7420 666f 7220 0a20 2020 2020  evant for .     
+00014300: 2020 2020 2020 2073 696e 676c 652d 736c         single-sl
+00014310: 6963 6520 6d65 7472 6963 7320 2861 7265  ice metrics (are
+00014320: 612c 2063 656e 7472 6f69 645f 736c 6963  a, centroid_slic
+00014330: 652c 206c 656e 6774 685f 736c 6963 6529  e, length_slice)
+00014340: 2e0a 0a20 2020 2020 2020 2073 6c20 3a20  ...        sl : 
+00014350: 696e 742c 2064 6566 6175 6c74 3d4e 6f6e  int, default=Non
+00014360: 650a 2020 2020 2020 2020 2020 2020 536c  e.            Sl
+00014370: 6963 6520 6e75 6d62 6572 206f 6e20 7768  ice number on wh
+00014380: 6963 6820 746f 2063 6f6d 7075 7465 206d  ich to compute m
+00014390: 6574 7269 6373 2e20 4f6e 6c79 2072 656c  etrics. Only rel
+000143a0: 6576 616e 7420 666f 7220 0a20 2020 2020  evant for .     
+000143b0: 2020 2020 2020 2073 696e 676c 652d 736c         single-sl
+000143c0: 6963 6520 6d65 7472 6963 7320 2861 7265  ice metrics (are
+000143d0: 612c 2063 656e 7472 6f69 645f 736c 6963  a, centroid_slic
+000143e0: 652c 206c 656e 6774 685f 736c 6963 6529  e, length_slice)
+000143f0: 2e0a 2020 2020 2020 2020 2020 2020 4966  ..            If
+00014400: 203c 736c 3e2c 203c 6964 783e 2c20 616e   <sl>, <idx>, an
+00014410: 6420 3c70 6f73 3e20 6172 6520 616c 6c20  d <pos> are all 
+00014420: 4e6f 6e65 2c20 7468 6520 6365 6e74 7261  None, the centra
+00014430: 6c20 736c 6963 6520 6f66 2074 6865 0a20  l slice of the. 
+00014440: 2020 2020 2020 2020 2020 2052 4f49 2077             ROI w
+00014450: 696c 6c20 6265 2075 7365 642e 0a0a 2020  ill be used...  
+00014460: 2020 2020 2020 6964 7820 3a20 696e 742c        idx : int,
+00014470: 2064 6566 6175 6c74 3d4e 6f6e 650a 2020   default=None.  
+00014480: 2020 2020 2020 2020 2020 536c 6963 6520            Slice 
+00014490: 696e 6465 7820 6172 7261 7920 6f6e 2077  index array on w
+000144a0: 6869 6368 2074 6f20 636f 6d70 7574 6520  hich to compute 
+000144b0: 6d65 7472 6963 732e 204f 6e6c 7920 7265  metrics. Only re
+000144c0: 6c65 7661 6e74 2066 6f72 200a 2020 2020  levant for .    
+000144d0: 2020 2020 2020 2020 7369 6e67 6c65 2d73          single-s
+000144e0: 6c69 6365 206d 6574 7269 6373 2028 6172  lice metrics (ar
+000144f0: 6561 2c20 6365 6e74 726f 6964 5f73 6c69  ea, centroid_sli
+00014500: 6365 2c20 6c65 6e67 7468 5f73 6c69 6365  ce, length_slice
+00014510: 292e 0a20 2020 2020 2020 2020 2020 2055  )..            U
+00014520: 7365 6420 6966 203c 736c 3e20 6973 204e  sed if <sl> is N
+00014530: 6f6e 652e 0a0a 2020 2020 2020 2020 706f  one...        po
+00014540: 7320 3a20 666c 6f61 742c 2064 6566 6175  s : float, defau
+00014550: 6c74 3d4e 6f6e 650a 2020 2020 2020 2020  lt=None.        
+00014560: 2020 2020 536c 6963 6520 706f 7369 7469      Slice positi
+00014570: 6f6e 2069 6e20 6d6d 206f 6e20 7768 6963  on in mm on whic
+00014580: 6820 746f 2063 6f6d 7075 7465 206d 6574  h to compute met
+00014590: 7269 6373 2e20 4f6e 6c79 2072 656c 6576  rics. Only relev
+000145a0: 616e 7420 666f 7220 0a20 2020 2020 2020  ant for .       
+000145b0: 2020 2020 2073 696e 676c 652d 736c 6963       single-slic
+000145c0: 6520 6d65 7472 6963 7320 2861 7265 612c  e metrics (area,
+000145d0: 2063 656e 7472 6f69 645f 736c 6963 652c   centroid_slice,
+000145e0: 206c 656e 6774 685f 736c 6963 6529 2e0a   length_slice)..
+000145f0: 2020 2020 2020 2020 2020 2020 5573 6564              Used
+00014600: 2069 6620 3c73 6c3e 2061 6e64 203c 6964   if <sl> and <id
+00014610: 783e 2061 7265 2062 6f74 6820 4e6f 6e65  x> are both None
+00014620: 2e0a 0a20 2020 2020 2020 206d 6574 686f  ...        metho
+00014630: 6420 3a20 7374 722c 2064 6566 6175 6c74  d : str, default
+00014640: 3d4e 6f6e 650a 2020 2020 2020 2020 2020  =None.          
+00014650: 2020 4d65 7468 6f64 2074 6f20 7573 6520    Method to use 
+00014660: 666f 7220 6d65 7472 6963 2063 616c 6375  for metric calcu
+00014670: 6c61 7469 6f6e 2e20 4361 6e20 6265 2065  lation. Can be e
+00014680: 6974 6865 7220 2263 6f6e 746f 7572 2220  ither "contour" 
+00014690: 0a20 2020 2020 2020 2020 2020 2028 7573  .            (us
+000146a0: 6520 7368 6170 656c 7920 706f 6c79 676f  e shapely polygo
+000146b0: 6e73 2920 6f72 2022 6d61 736b 2220 2875  ns) or "mask" (u
+000146c0: 7365 2062 696e 6172 7920 6d61 736b 292e  se binary mask).
+000146d0: 2049 6620 4e6f 6e65 2c0a 2020 2020 2020   If None,.      
+000146e0: 2020 2020 2020 7468 6520 7661 6c75 6520        the value 
+000146f0: 7365 7420 696e 2073 656c 662e 6465 6661  set in self.defa
+00014700: 756c 745f 6765 6f6d 5f6d 6574 686f 6420  ult_geom_method 
+00014710: 7769 6c6c 2062 6520 7573 6564 2e0a 0a20  will be used... 
+00014720: 2020 2020 2020 2075 6e69 7473 5f69 6e5f         units_in_
+00014730: 6865 6164 6572 203a 2062 6f6f 6c2c 2064  header : bool, d
+00014740: 6566 6175 6c74 3d46 616c 7365 0a20 2020  efault=False.   
+00014750: 2020 2020 2020 2020 2049 6620 5472 7565           If True
+00014760: 2c20 756e 6974 7320 7769 6c6c 2062 6520  , units will be 
+00014770: 696e 636c 7564 6564 2069 6e20 636f 6c75  included in colu
+00014780: 6d6e 2068 6561 6465 7273 2e0a 0a20 2020  mn headers...   
+00014790: 2020 2020 2067 6c6f 6261 6c5f 7673 5f73       global_vs_s
+000147a0: 6c69 6365 5f68 6561 6465 7220 3a20 626f  lice_header : bo
+000147b0: 6f6c 2c20 6465 6661 756c 743d 4661 6c73  ol, default=Fals
+000147c0: 650a 2020 2020 2020 2020 2020 2020 4966  e.            If
+000147d0: 2054 7275 652c 2074 6865 2072 6574 7572   True, the retur
+000147e0: 6e65 6420 4461 7461 4672 616d 6520 7769  ned DataFrame wi
+000147f0: 6c6c 2068 6176 6520 616e 2065 7874 7261  ll have an extra
+00014800: 2073 6574 206f 6620 6865 6164 6572 730a   set of headers.
+00014810: 2020 2020 2020 2020 2020 2020 7370 6c69              spli
+00014820: 7474 696e 6720 7468 6520 7461 626c 6520  tting the table 
+00014830: 696e 746f 2022 676c 6f62 616c 2220 616e  into "global" an
+00014840: 6420 2273 6c69 6365 2220 6d65 7472 6963  d "slice" metric
+00014850: 732e 0a0a 2020 2020 2020 2020 6e61 6d65  s...        name
+00014860: 5f61 735f 696e 6465 7820 3a20 626f 6f6c  _as_index : bool
+00014870: 2c20 6465 6661 756c 743d 5472 7565 0a20  , default=True. 
+00014880: 2020 2020 2020 2020 2020 2049 6620 5472             If Tr
+00014890: 7565 2c20 7468 6520 696e 6465 7820 636f  ue, the index co
+000148a0: 6c75 6d6e 206f 6620 7468 6520 7061 6e64  lumn of the pand
+000148b0: 6173 2044 6174 6146 7261 6d65 2077 696c  as DataFrame wil
+000148c0: 6c20 0a20 2020 2020 2020 2020 2020 2063  l .            c
+000148d0: 6f6e 7461 696e 2074 6865 2052 4f49 2773  ontain the ROI's
+000148e0: 206e 616d 653b 206f 7468 6572 7769 7365   name; otherwise
+000148f0: 2c20 7468 6520 6e61 6d65 2077 696c 6c20  , the name will 
+00014900: 6170 7065 6172 2069 6e20 6120 636f 6c75  appear in a colu
+00014910: 6d6e 0a20 2020 2020 2020 2020 2020 206e  mn.            n
+00014920: 616d 6564 2022 524f 4922 2e0a 0a20 2020  amed "ROI"...   
+00014930: 2020 2020 206e 6963 655f 636f 6c75 6d6e       nice_column
+00014940: 7320 3a20 626f 6f6c 2c20 6465 6661 756c  s : bool, defaul
+00014950: 743d 4661 6c73 650a 2020 2020 2020 2020  t=False.        
+00014960: 2020 2020 4966 2046 616c 7365 2c20 636f      If False, co
+00014970: 6c75 6d6e 206e 616d 6573 2077 696c 6c20  lumn names will 
+00014980: 6265 2074 6865 2073 616d 6520 6173 2074  be the same as t
+00014990: 6865 2069 6e70 7574 206d 6574 7269 6373  he input metrics
+000149a0: 206e 616d 6573 3b0a 2020 2020 2020 2020   names;.        
+000149b0: 2020 2020 6966 2054 7275 652c 2074 6865      if True, the
+000149c0: 206e 616d 6573 2077 696c 6c20 6265 2063   names will be c
+000149d0: 6170 6974 616c 697a 6564 2061 6e64 2075  apitalized and u
+000149e0: 6e64 6572 7363 6f72 6573 2077 696c 6c20  nderscores will 
+000149f0: 6265 200a 2020 2020 2020 2020 2020 2020  be .            
+00014a00: 7265 706c 6163 6564 2077 6974 6820 7370  replaced with sp
+00014a10: 6163 6573 2e0a 0a20 2020 2020 2020 2064  aces...        d
+00014a20: 6563 696d 616c 5f70 6c61 6365 7320 3a20  ecimal_places : 
+00014a30: 696e 742c 2064 6566 6175 6c74 3d4e 6f6e  int, default=Non
+00014a40: 650a 2020 2020 2020 2020 2020 2020 4e75  e.            Nu
+00014a50: 6d62 6572 206f 6620 6465 6369 6d61 6c20  mber of decimal 
+00014a60: 706c 6163 6573 2074 6f20 6b65 6570 2066  places to keep f
+00014a70: 6f72 2065 6163 6820 6d65 7472 6963 2e20  or each metric. 
+00014a80: 4966 204e 6f6e 652c 2066 756c 6c0a 2020  If None, full.  
+00014a90: 2020 2020 2020 2020 2020 7072 6563 6973            precis
+00014aa0: 696f 6e20 7769 6c6c 2062 6520 7573 6564  ion will be used
+00014ab0: 2e0a 0a20 2020 2020 2020 2066 6f72 6365  ...        force
+00014ac0: 203a 2062 6f6f 6c2c 2064 6566 6175 6c74   : bool, default
+00014ad0: 3d54 7275 650a 2020 2020 2020 2020 2020  =True.          
+00014ae0: 2020 4966 2046 616c 7365 2c20 676c 6f62    If False, glob
+00014af0: 616c 206d 6574 7269 6373 2028 766f 6c75  al metrics (volu
+00014b00: 6d65 2c20 3344 2063 656e 7472 6f69 642c  me, 3D centroid,
+00014b10: 2033 4420 6c65 6e67 7468 7329 2077 696c   3D lengths) wil
+00014b20: 6c0a 2020 2020 2020 2020 2020 2020 6f6e  l.            on
+00014b30: 6c79 2062 6520 6361 6c63 756c 6174 6564  ly be calculated
+00014b40: 2069 6620 7468 6579 2068 6176 6520 6e6f   if they have no
+00014b50: 7420 6265 656e 2063 616c 6375 6c61 7465  t been calculate
+00014b60: 6420 6265 666f 7265 3b0a 2020 2020 2020  d before;.      
+00014b70: 2020 2020 2020 6966 2054 7275 652c 2061        if True, a
+00014b80: 6c6c 206d 6574 7269 6373 2077 696c 6c20  ll metrics will 
+00014b90: 6265 2072 6563 616c 6375 6c61 7465 642e  be recalculated.
+00014ba0: 0a20 2020 2020 2020 2022 2222 0a0a 2020  .        """..  
+00014bb0: 2020 2020 2020 2320 4966 206e 6f20 696e        # If no in
+00014bc0: 6465 7820 6769 7665 6e2c 2075 7365 2063  dex given, use c
+00014bd0: 656e 7472 616c 2073 6c69 6365 0a20 2020  entral slice.   
+00014be0: 2020 2020 2069 6620 736c 2069 7320 4e6f       if sl is No
+00014bf0: 6e65 2061 6e64 2069 6478 2069 7320 4e6f  ne and idx is No
+00014c00: 6e65 2061 6e64 2070 6f73 2069 7320 4e6f  ne and pos is No
+00014c10: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+00014c20: 6964 7820 3d20 7365 6c66 2e67 6574 5f6d  idx = self.get_m
+00014c30: 6964 5f69 6478 2876 6965 7729 0a0a 2020  id_idx(view)..  
+00014c40: 2020 2020 2020 2320 4465 6661 756c 7420        # Default 
+00014c50: 6d65 7472 6963 730a 2020 2020 2020 2020  metrics.        
+00014c60: 6966 206d 6574 7269 6373 2069 7320 4e6f  if metrics is No
+00014c70: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+00014c80: 6d65 7472 6963 7320 3d20 5b22 766f 6c75  metrics = ["volu
+00014c90: 6d65 222c 2022 6365 6e74 726f 6964 225d  me", "centroid"]
+00014ca0: 0a0a 2020 2020 2020 2020 2320 436f 6d70  ..        # Comp
+00014cb0: 7574 6520 6d65 7472 6963 730a 2020 2020  ute metrics.    
+00014cc0: 2020 2020 6765 6f6d 203d 207b 7d0a 2020      geom = {}.  
+00014cd0: 2020 2020 2020 736c 6963 655f 6b77 6172        slice_kwar
+00014ce0: 6773 203d 207b 0a20 2020 2020 2020 2020  gs = {.         
+00014cf0: 2020 2022 7669 6577 223a 2076 6965 772c     "view": view,
+00014d00: 0a20 2020 2020 2020 2020 2020 2022 736c  .            "sl
+00014d10: 223a 2073 6c2c 0a20 2020 2020 2020 2020  ": sl,.         
+00014d20: 2020 2022 6964 7822 3a20 6964 782c 0a20     "idx": idx,. 
+00014d30: 2020 2020 2020 2020 2020 2022 706f 7322             "pos"
+00014d40: 3a20 706f 730a 2020 2020 2020 2020 7d0a  : pos.        }.
+00014d50: 2020 2020 2020 2020 666f 7220 6d20 696e          for m in
+00014d60: 206d 6574 7269 6373 3a0a 0a20 2020 2020   metrics:..     
+00014d70: 2020 2020 2020 2023 2033 4420 766f 6c75         # 3D volu
+00014d80: 6d65 0a20 2020 2020 2020 2020 2020 2069  me.            i
+00014d90: 6620 6d20 3d3d 2022 766f 6c75 6d65 223a  f m == "volume":
+00014da0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00014db0: 2067 656f 6d5b 6d5d 203d 2073 656c 662e   geom[m] = self.
+00014dc0: 6765 745f 766f 6c75 6d65 280a 2020 2020  get_volume(.    
+00014dd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014de0: 756e 6974 733d 766f 6c5f 756e 6974 732c  units=vol_units,
+00014df0: 200a 2020 2020 2020 2020 2020 2020 2020   .              
+00014e00: 2020 2020 2020 6d65 7468 6f64 3d6d 6574        method=met
+00014e10: 686f 642c 0a20 2020 2020 2020 2020 2020  hod,.           
+00014e20: 2020 2020 2020 2020 2066 6f72 6365 3d66           force=f
+00014e30: 6f72 6365 0a20 2020 2020 2020 2020 2020  orce.           
+00014e40: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
+00014e50: 2020 2020 2320 4172 6561 206f 6e20 6120      # Area on a 
+00014e60: 736c 6963 650a 2020 2020 2020 2020 2020  slice.          
+00014e70: 2020 656c 6966 206d 203d 3d20 2261 7265    elif m == "are
+00014e80: 6122 3a0a 2020 2020 2020 2020 2020 2020  a":.            
+00014e90: 2020 2020 6765 6f6d 5b6d 5d20 3d20 7365      geom[m] = se
+00014ea0: 6c66 2e67 6574 5f61 7265 6128 0a20 2020  lf.get_area(.   
+00014eb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014ec0: 2075 6e69 7473 3d61 7265 615f 756e 6974   units=area_unit
+00014ed0: 732c 200a 2020 2020 2020 2020 2020 2020  s, .            
+00014ee0: 2020 2020 2020 2020 6d65 7468 6f64 3d6d          method=m
+00014ef0: 6574 686f 642c 0a20 2020 2020 2020 2020  ethod,.         
+00014f00: 2020 2020 2020 2020 2020 202a 2a73 6c69             **sli
+00014f10: 6365 5f6b 7761 7267 730a 2020 2020 2020  ce_kwargs.      
+00014f20: 2020 2020 2020 2020 2020 290a 0a20 2020            )..   
+00014f30: 2020 2020 2020 2020 2023 2033 4420 6365           # 3D ce
+00014f40: 6e74 726f 6964 0a20 2020 2020 2020 2020  ntroid.         
+00014f50: 2020 2065 6c69 6620 6d20 3d3d 2022 6365     elif m == "ce
+00014f60: 6e74 726f 6964 223a 0a20 2020 2020 2020  ntroid":.       
+00014f70: 2020 2020 2020 2020 2063 656e 7472 6f69           centroi
+00014f80: 6420 3d20 7365 6c66 2e67 6574 5f63 656e  d = self.get_cen
+00014f90: 7472 6f69 6428 0a20 2020 2020 2020 2020  troid(.         
+00014fa0: 2020 2020 2020 2020 2020 2075 6e69 7473             units
+00014fb0: 3d63 656e 7472 6f69 645f 756e 6974 732c  =centroid_units,
+00014fc0: 200a 2020 2020 2020 2020 2020 2020 2020   .              
+00014fd0: 2020 2020 2020 6d65 7468 6f64 3d6d 6574        method=met
+00014fe0: 686f 642c 0a20 2020 2020 2020 2020 2020  hod,.           
+00014ff0: 2020 2020 2020 2020 2066 6f72 6365 3d66           force=f
+00015000: 6f72 6365 0a20 2020 2020 2020 2020 2020  orce.           
+00015010: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
+00015020: 2020 2020 2020 2066 6f72 2069 2c20 6178         for i, ax
+00015030: 2069 6e20 656e 756d 6572 6174 6528 736b   in enumerate(sk
+00015040: 7274 2e69 6d61 6765 2e5f 6178 6573 293a  rt.image._axes):
+00015050: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00015060: 2020 2020 2067 656f 6d5b 6622 6365 6e74       geom[f"cent
+00015070: 726f 6964 5f7b 6178 7d22 5d20 3d20 6365  roid_{ax}"] = ce
+00015080: 6e74 726f 6964 5b69 5d0a 0a20 2020 2020  ntroid[i]..     
+00015090: 2020 2020 2020 2023 2032 4420 6365 6e74         # 2D cent
+000150a0: 726f 6964 0a20 2020 2020 2020 2020 2020  roid.           
+000150b0: 2065 6c69 6620 6d20 3d3d 2022 6365 6e74   elif m == "cent
+000150c0: 726f 6964 5f73 6c69 6365 223a 0a20 2020  roid_slice":.   
+000150d0: 2020 2020 2020 2020 2020 2020 2063 656e               cen
+000150e0: 7472 6f69 6420 3d20 7365 6c66 2e67 6574  troid = self.get
+000150f0: 5f63 656e 7472 6f69 6428 0a20 2020 2020  _centroid(.     
+00015100: 2020 2020 2020 2020 2020 2020 2020 2075                 u
+00015110: 6e69 7473 3d63 656e 7472 6f69 645f 756e  nits=centroid_un
+00015120: 6974 732c 200a 2020 2020 2020 2020 2020  its, .          
+00015130: 2020 2020 2020 2020 2020 6d65 7468 6f64            method
+00015140: 3d6d 6574 686f 642c 0a20 2020 2020 2020  =method,.       
+00015150: 2020 2020 2020 2020 2020 2020 2073 696e               sin
+00015160: 676c 655f 736c 6963 653d 5472 7565 2c0a  gle_slice=True,.
+00015170: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015180: 2020 2020 2a2a 736c 6963 655f 6b77 6172      **slice_kwar
+00015190: 6773 0a20 2020 2020 2020 2020 2020 2020  gs.             
+000151a0: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
+000151b0: 2020 2020 2066 6f72 2069 2c20 695f 6178       for i, i_ax
+000151c0: 2069 6e20 656e 756d 6572 6174 6528 736b   in enumerate(sk
+000151d0: 7274 2e69 6d61 6765 2e5f 706c 6f74 5f61  rt.image._plot_a
+000151e0: 7865 735b 7669 6577 5d29 3a0a 2020 2020  xes[view]):.    
+000151f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015200: 6178 203d 2073 6b72 742e 696d 6167 652e  ax = skrt.image.
+00015210: 5f61 7865 735b 695f 6178 5d0a 2020 2020  _axes[i_ax].    
+00015220: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015230: 6765 6f6d 5b66 2263 656e 7472 6f69 645f  geom[f"centroid_
+00015240: 736c 6963 655f 7b61 787d 225d 203d 2063  slice_{ax}"] = c
+00015250: 656e 7472 6f69 645b 695d 0a0a 2020 2020  entroid[i]..    
+00015260: 2020 2020 2020 2020 2320 4675 6c6c 206c          # Full l
+00015270: 656e 6774 6873 2061 6c6f 6e67 2065 6163  engths along eac
+00015280: 6820 6178 6973 0a20 2020 2020 2020 2020  h axis.         
+00015290: 2020 2065 6c69 6620 6d20 3d3d 2022 6c65     elif m == "le
+000152a0: 6e67 7468 223a 0a20 2020 2020 2020 2020  ngth":.         
+000152b0: 2020 2020 2020 2066 6f72 2061 7820 696e         for ax in
+000152c0: 2073 6b72 742e 696d 6167 652e 5f61 7865   skrt.image._axe
+000152d0: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
+000152e0: 2020 2020 2020 2067 656f 6d5b 6622 6c65         geom[f"le
+000152f0: 6e67 7468 5f7b 6178 7d22 5d20 3d20 7365  ngth_{ax}"] = se
+00015300: 6c66 2e67 6574 5f6c 656e 6774 6828 0a20  lf.get_length(. 
+00015310: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015320: 2020 2020 2020 2061 783d 6178 2c20 0a20         ax=ax, . 
+00015330: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015340: 2020 2020 2020 2075 6e69 7473 3d6c 656e         units=len
+00015350: 6774 685f 756e 6974 732c 0a20 2020 2020  gth_units,.     
+00015360: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015370: 2020 206d 6574 686f 643d 6d65 7468 6f64     method=method
+00015380: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00015390: 2020 2020 2020 2020 2020 666f 7263 653d            force=
+000153a0: 666f 7263 650a 2020 2020 2020 2020 2020  force.          
+000153b0: 2020 2020 2020 2020 2020 290a 0a20 2020            )..   
+000153c0: 2020 2020 2020 2020 2023 204c 656e 6774           # Lengt
+000153d0: 6873 206f 6e20 6120 736c 6963 650a 2020  hs on a slice.  
+000153e0: 2020 2020 2020 2020 2020 656c 6966 206d            elif m
+000153f0: 203d 3d20 226c 656e 6774 685f 736c 6963   == "length_slic
+00015400: 6522 3a0a 2020 2020 2020 2020 2020 2020  e":.            
+00015410: 2020 2020 666f 7220 695f 6178 2069 6e20      for i_ax in 
+00015420: 736b 7274 2e69 6d61 6765 2e5f 706c 6f74  skrt.image._plot
+00015430: 5f61 7865 735b 7669 6577 5d3a 0a20 2020  _axes[view]:.   
 00015440: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015450: 2020 2020 2020 2075 6e69 7473 3d6c 656e         units=len
-00015460: 6774 685f 756e 6974 732c 0a20 2020 2020  gth_units,.     
+00015450: 2061 7820 3d20 736b 7274 2e69 6d61 6765   ax = skrt.image
+00015460: 2e5f 6178 6573 5b69 5f61 785d 0a20 2020  ._axes[i_ax].   
 00015470: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015480: 2020 206d 6574 686f 643d 6d65 7468 6f64     method=method
-00015490: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-000154a0: 2020 2020 2020 2020 2020 2a2a 736c 6963            **slic
-000154b0: 655f 6b77 6172 6773 0a20 2020 2020 2020  e_kwargs.       
-000154c0: 2020 2020 2020 2020 2020 2020 2029 0a0a               )..
-000154d0: 2020 2020 2020 2020 2020 2020 656c 7365              else
-000154e0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000154f0: 2020 666f 756e 6420 3d20 4661 6c73 650a    found = False.
-00015500: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00015510: 2023 2041 7869 732d 7370 6563 6966 6963   # Axis-specific
-00015520: 206d 6574 7269 6373 0a20 2020 2020 2020   metrics.       
-00015530: 2020 2020 2020 2020 2066 6f72 2069 2c20           for i, 
-00015540: 6178 2069 6e20 656e 756d 6572 6174 6528  ax in enumerate(
-00015550: 736b 7274 2e69 6d61 6765 2e5f 6178 6573  skrt.image._axes
-00015560: 293a 0a0a 2020 2020 2020 2020 2020 2020  ):..            
-00015570: 2020 2020 2020 2020 2320 476c 6f62 616c          # Global
-00015580: 2063 656e 7472 6f69 6420 706f 7369 7469   centroid positi
-00015590: 6f6e 206f 6e20 6120 6769 7665 6e20 6178  on on a given ax
-000155a0: 6973 0a20 2020 2020 2020 2020 2020 2020  is.             
-000155b0: 2020 2020 2020 2069 6620 6d20 3d3d 2066         if m == f
-000155c0: 2263 656e 7472 6f69 645f 7b61 787d 223a  "centroid_{ax}":
-000155d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000155e0: 2020 2020 2020 2020 2067 656f 6d5b 6d5d           geom[m]
-000155f0: 203d 2073 656c 662e 6765 745f 6365 6e74   = self.get_cent
-00015600: 726f 6964 280a 2020 2020 2020 2020 2020  roid(.          
-00015610: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015620: 2020 756e 6974 733d 6365 6e74 726f 6964    units=centroid
-00015630: 5f75 6e69 7473 2c0a 2020 2020 2020 2020  _units,.        
-00015640: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015650: 2020 2020 6d65 7468 6f64 3d6d 6574 686f      method=metho
-00015660: 642c 0a20 2020 2020 2020 2020 2020 2020  d,.             
-00015670: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-00015680: 6f72 6365 3d66 6f72 6365 0a20 2020 2020  orce=force.     
+00015480: 2067 656f 6d5b 6622 6c65 6e67 7468 5f73   geom[f"length_s
+00015490: 6c69 6365 5f7b 6178 7d22 5d20 3d20 7365  lice_{ax}"] = se
+000154a0: 6c66 2e67 6574 5f6c 656e 6774 6828 0a20  lf.get_length(. 
+000154b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000154c0: 2020 2020 2020 2061 783d 6178 2c20 0a20         ax=ax, . 
+000154d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000154e0: 2020 2020 2020 2075 6e69 7473 3d6c 656e         units=len
+000154f0: 6774 685f 756e 6974 732c 0a20 2020 2020  gth_units,.     
+00015500: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015510: 2020 206d 6574 686f 643d 6d65 7468 6f64     method=method
+00015520: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00015530: 2020 2020 2020 2020 2020 7369 6e67 6c65            single
+00015540: 5f73 6c69 6365 3d54 7275 652c 0a20 2020  _slice=True,.   
+00015550: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015560: 2020 2020 202a 2a73 6c69 6365 5f6b 7761       **slice_kwa
+00015570: 7267 730a 2020 2020 2020 2020 2020 2020  rgs.            
+00015580: 2020 2020 2020 2020 290a 0a20 2020 2020          )..     
+00015590: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+000155a0: 2020 2020 2020 2020 2020 2020 2066 6f75               fou
+000155b0: 6e64 203d 2046 616c 7365 0a0a 2020 2020  nd = False..    
+000155c0: 2020 2020 2020 2020 2020 2020 2320 4178              # Ax
+000155d0: 6973 2d73 7065 6369 6669 6320 6d65 7472  is-specific metr
+000155e0: 6963 730a 2020 2020 2020 2020 2020 2020  ics.            
+000155f0: 2020 2020 666f 7220 692c 2061 7820 696e      for i, ax in
+00015600: 2065 6e75 6d65 7261 7465 2873 6b72 742e   enumerate(skrt.
+00015610: 696d 6167 652e 5f61 7865 7329 3a0a 0a20  image._axes):.. 
+00015620: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015630: 2020 2023 2047 6c6f 6261 6c20 6365 6e74     # Global cent
+00015640: 726f 6964 2070 6f73 6974 696f 6e20 6f6e  roid position on
+00015650: 2061 2067 6976 656e 2061 7869 730a 2020   a given axis.  
+00015660: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015670: 2020 6966 206d 203d 3d20 6622 6365 6e74    if m == f"cent
+00015680: 726f 6964 5f7b 6178 7d22 3a0a 2020 2020  roid_{ax}":.    
 00015690: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000156a0: 2020 2029 5b69 5d0a 2020 2020 2020 2020     )[i].        
-000156b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000156c0: 666f 756e 6420 3d20 5472 7565 0a0a 2020  found = True..  
-000156d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000156e0: 2020 2320 4675 6c6c 206c 656e 6774 6820    # Full length 
-000156f0: 616c 6f6e 6720 6120 6769 7665 6e20 6178  along a given ax
-00015700: 6973 0a20 2020 2020 2020 2020 2020 2020  is.             
-00015710: 2020 2020 2020 2065 6c69 6620 6d20 3d3d         elif m ==
-00015720: 2066 226c 656e 6774 685f 7b61 787d 223a   f"length_{ax}":
-00015730: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00015740: 2020 2020 2020 2020 2067 656f 6d5b 6d5d           geom[m]
-00015750: 203d 2073 656c 662e 6765 745f 6c65 6e67   = self.get_leng
-00015760: 7468 280a 2020 2020 2020 2020 2020 2020  th(.            
-00015770: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015780: 6178 3d61 782c 0a20 2020 2020 2020 2020  ax=ax,.         
-00015790: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000157a0: 2020 2075 6e69 7473 3d6c 656e 6774 685f     units=length_
-000157b0: 756e 6974 732c 200a 2020 2020 2020 2020  units, .        
+000156a0: 2020 2020 6765 6f6d 5b6d 5d20 3d20 7365      geom[m] = se
+000156b0: 6c66 2e67 6574 5f63 656e 7472 6f69 6428  lf.get_centroid(
+000156c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000156d0: 2020 2020 2020 2020 2020 2020 2075 6e69               uni
+000156e0: 7473 3d63 656e 7472 6f69 645f 756e 6974  ts=centroid_unit
+000156f0: 732c 0a20 2020 2020 2020 2020 2020 2020  s,.             
+00015700: 2020 2020 2020 2020 2020 2020 2020 206d                 m
+00015710: 6574 686f 643d 6d65 7468 6f64 2c0a 2020  ethod=method,.  
+00015720: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015730: 2020 2020 2020 2020 2020 666f 7263 653d            force=
+00015740: 666f 7263 650a 2020 2020 2020 2020 2020  force.          
+00015750: 2020 2020 2020 2020 2020 2020 2020 295b                )[
+00015760: 695d 0a20 2020 2020 2020 2020 2020 2020  i].             
+00015770: 2020 2020 2020 2020 2020 2066 6f75 6e64             found
+00015780: 203d 2054 7275 650a 0a20 2020 2020 2020   = True..       
+00015790: 2020 2020 2020 2020 2020 2020 2023 2046               # F
+000157a0: 756c 6c20 6c65 6e67 7468 2061 6c6f 6e67  ull length along
+000157b0: 2061 2067 6976 656e 2061 7869 730a 2020   a given axis.  
 000157c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000157d0: 2020 2020 6d65 7468 6f64 3d6d 6574 686f      method=metho
-000157e0: 642c 0a20 2020 2020 2020 2020 2020 2020  d,.             
-000157f0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-00015800: 6f72 6365 3d66 6f72 6365 0a20 2020 2020  orce=force.     
-00015810: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015820: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
-00015830: 2020 2020 2020 2020 2020 2020 2066 6f75               fou
-00015840: 6e64 203d 2054 7275 650a 0a20 2020 2020  nd = True..     
-00015850: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
-00015860: 7420 666f 756e 643a 0a20 2020 2020 2020  t found:.       
-00015870: 2020 2020 2020 2020 2020 2020 2072 6169               rai
-00015880: 7365 2052 756e 7469 6d65 4572 726f 7228  se RuntimeError(
-00015890: 6622 4d65 7472 6963 207b 6d7d 206e 6f74  f"Metric {m} not
-000158a0: 2072 6563 6f67 6e69 7365 6420 6279 2022   recognised by "
-000158b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000158c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000158d0: 2020 2020 2020 2020 2252 4f49 2e67 6574          "ROI.get
-000158e0: 5f67 656f 6d65 7472 7928 2922 290a 0a20  _geometry()").. 
-000158f0: 2020 2020 2020 2023 2041 6464 2075 6e69         # Add uni
-00015900: 7473 2074 6f20 6d65 7472 6963 206e 616d  ts to metric nam
-00015910: 6573 2069 6620 7265 7175 6573 7465 640a  es if requested.
-00015920: 2020 2020 2020 2020 6765 6f6d 5f6e 616d          geom_nam
-00015930: 6564 203d 207b 7d0a 2020 2020 2020 2020  ed = {}.        
-00015940: 6966 206e 6f74 2075 6e69 7473 5f69 6e5f  if not units_in_
-00015950: 6865 6164 6572 3a0a 2020 2020 2020 2020  header:.        
-00015960: 2020 2020 6765 6f6d 5f6e 616d 6564 203d      geom_named =
-00015970: 2067 656f 6d0a 2020 2020 2020 2020 656c   geom.        el
-00015980: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-00015990: 666f 7220 6d65 7472 6963 2c20 7661 6c20  for metric, val 
-000159a0: 696e 2067 656f 6d2e 6974 656d 7328 293a  in geom.items():
-000159b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000159c0: 206e 616d 6520 3d20 6d65 7472 6963 0a20   name = metric. 
-000159d0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-000159e0: 6620 2276 6f6c 756d 6522 2069 6e20 6d65  f "volume" in me
-000159f0: 7472 6963 3a0a 2020 2020 2020 2020 2020  tric:.          
-00015a00: 2020 2020 2020 2020 2020 6966 2076 6f6c            if vol
-00015a10: 5f75 6e69 7473 203d 3d20 226d 6d22 3a0a  _units == "mm":.
-00015a20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015a30: 2020 2020 2020 2020 6e61 6d65 202b 3d20          name += 
-00015a40: 2220 286d 6d5e 3329 220a 2020 2020 2020  " (mm^3)".      
-00015a50: 2020 2020 2020 2020 2020 2020 2020 656c                el
-00015a60: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+000157d0: 2020 656c 6966 206d 203d 3d20 6622 6c65    elif m == f"le
+000157e0: 6e67 7468 5f7b 6178 7d22 3a0a 2020 2020  ngth_{ax}":.    
+000157f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015800: 2020 2020 6765 6f6d 5b6d 5d20 3d20 7365      geom[m] = se
+00015810: 6c66 2e67 6574 5f6c 656e 6774 6828 0a20  lf.get_length(. 
+00015820: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015830: 2020 2020 2020 2020 2020 2061 783d 6178             ax=ax
+00015840: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00015850: 2020 2020 2020 2020 2020 2020 2020 756e                un
+00015860: 6974 733d 6c65 6e67 7468 5f75 6e69 7473  its=length_units
+00015870: 2c20 0a20 2020 2020 2020 2020 2020 2020  , .             
+00015880: 2020 2020 2020 2020 2020 2020 2020 206d                 m
+00015890: 6574 686f 643d 6d65 7468 6f64 2c0a 2020  ethod=method,.  
+000158a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000158b0: 2020 2020 2020 2020 2020 666f 7263 653d            force=
+000158c0: 666f 7263 650a 2020 2020 2020 2020 2020  force.          
+000158d0: 2020 2020 2020 2020 2020 2020 2020 290a                ).
+000158e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000158f0: 2020 2020 2020 2020 666f 756e 6420 3d20          found = 
+00015900: 5472 7565 0a0a 2020 2020 2020 2020 2020  True..          
+00015910: 2020 2020 2020 6966 206e 6f74 2066 6f75        if not fou
+00015920: 6e64 3a0a 2020 2020 2020 2020 2020 2020  nd:.            
+00015930: 2020 2020 2020 2020 7261 6973 6520 5275          raise Ru
+00015940: 6e74 696d 6545 7272 6f72 2866 224d 6574  ntimeError(f"Met
+00015950: 7269 6320 7b6d 7d20 6e6f 7420 7265 636f  ric {m} not reco
+00015960: 676e 6973 6564 2062 7920 220a 2020 2020  gnised by ".    
+00015970: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015980: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015990: 2020 2022 524f 492e 6765 745f 6765 6f6d     "ROI.get_geom
+000159a0: 6574 7279 2829 2229 0a0a 2020 2020 2020  etry()")..      
+000159b0: 2020 2320 4164 6420 756e 6974 7320 746f    # Add units to
+000159c0: 206d 6574 7269 6320 6e61 6d65 7320 6966   metric names if
+000159d0: 2072 6571 7565 7374 6564 0a20 2020 2020   requested.     
+000159e0: 2020 2067 656f 6d5f 6e61 6d65 6420 3d20     geom_named = 
+000159f0: 7b7d 0a20 2020 2020 2020 2069 6620 6e6f  {}.        if no
+00015a00: 7420 756e 6974 735f 696e 5f68 6561 6465  t units_in_heade
+00015a10: 723a 0a20 2020 2020 2020 2020 2020 2067  r:.            g
+00015a20: 656f 6d5f 6e61 6d65 6420 3d20 6765 6f6d  eom_named = geom
+00015a30: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
+00015a40: 2020 2020 2020 2020 2020 2066 6f72 206d             for m
+00015a50: 6574 7269 632c 2076 616c 2069 6e20 6765  etric, val in ge
+00015a60: 6f6d 2e69 7465 6d73 2829 3a0a 2020 2020  om.items():.    
 00015a70: 2020 2020 2020 2020 2020 2020 6e61 6d65              name
-00015a80: 202b 3d20 2220 2822 202b 2076 6f6c 5f75   += " (" + vol_u
-00015a90: 6e69 7473 202b 2022 2922 0a20 2020 2020  nits + ")".     
-00015aa0: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
-00015ab0: 2261 7265 6122 2069 6e20 6d65 7472 6963  "area" in metric
-00015ac0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00015ad0: 2020 2020 2020 6966 2061 7265 615f 756e        if area_un
-00015ae0: 6974 7320 3d3d 2022 6d6d 223a 0a20 2020  its == "mm":.   
-00015af0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015b00: 2020 2020 206e 616d 6520 2b3d 2022 2028       name += " (
-00015b10: 6d6d 5e32 2922 0a20 2020 2020 2020 2020  mm^2)".         
-00015b20: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-00015b30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00015b40: 2020 2020 2020 2020 206e 616d 6520 2b3d           name +=
-00015b50: 2022 2028 2220 2b20 6172 6561 5f75 6e69   " (" + area_uni
-00015b60: 7473 202b 2022 2922 0a20 2020 2020 2020  ts + ")".       
-00015b70: 2020 2020 2020 2020 2065 6c69 6620 226c           elif "l
-00015b80: 656e 6774 6822 2069 6e20 6d65 7472 6963  ength" in metric
-00015b90: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00015ba0: 2020 2020 2020 6e61 6d65 202b 3d20 2220        name += " 
-00015bb0: 2822 202b 206c 656e 6774 685f 756e 6974  (" + length_unit
-00015bc0: 7320 2b20 2229 220a 2020 2020 2020 2020  s + ")".        
-00015bd0: 2020 2020 2020 2020 656c 6966 2022 6365          elif "ce
-00015be0: 6e74 726f 6964 2220 696e 206d 6574 7269  ntroid" in metri
-00015bf0: 633a 0a20 2020 2020 2020 2020 2020 2020  c:.             
-00015c00: 2020 2020 2020 206e 616d 6520 2b3d 2022         name += "
-00015c10: 2028 2220 2b20 6365 6e74 726f 6964 5f75   (" + centroid_u
-00015c20: 6e69 7473 202b 2022 2922 0a20 2020 2020  nits + ")".     
-00015c30: 2020 2020 2020 2020 2020 2067 656f 6d5f             geom_
-00015c40: 6e61 6d65 645b 6e61 6d65 5d20 3d20 7661  named[name] = va
-00015c50: 6c0a 0a20 2020 2020 2020 2023 2041 646a  l..        # Adj
-00015c60: 7573 7420 6e75 6d62 6572 206f 6620 6465  ust number of de
-00015c70: 6369 6d61 6c20 706c 6163 6573 0a20 2020  cimal places.   
-00015c80: 2020 2020 2069 6620 6465 6369 6d61 6c5f       if decimal_
-00015c90: 706c 6163 6573 2069 7320 6e6f 7420 4e6f  places is not No
-00015ca0: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-00015cb0: 666f 7220 6d65 7472 6963 2c20 7661 6c20  for metric, val 
-00015cc0: 696e 2067 656f 6d5f 6e61 6d65 642e 6974  in geom_named.it
-00015cd0: 656d 7328 293a 0a20 2020 2020 2020 2020  ems():.         
-00015ce0: 2020 2020 2020 2066 6d74 203d 2066 227b         fmt = f"{
-00015cf0: 7b76 616c 3a2e 7b64 6563 696d 616c 5f70  {val:.{decimal_p
-00015d00: 6c61 6365 737d 667d 7d22 0a20 2020 2020  laces}f}}".     
-00015d10: 2020 2020 2020 2020 2020 2069 6620 6765             if ge
-00015d20: 6f6d 5f6e 616d 6564 5b6d 6574 7269 635d  om_named[metric]
-00015d30: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
-00015d40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015d50: 2020 6765 6f6d 5f6e 616d 6564 5b6d 6574    geom_named[met
-00015d60: 7269 635d 203d 2066 6c6f 6174 2866 6d74  ric] = float(fmt
-00015d70: 2e66 6f72 6d61 7428 7661 6c3d 7661 6c29  .format(val=val)
-00015d80: 290a 0a20 2020 2020 2020 2023 2043 6f6e  )..        # Con
-00015d90: 7665 7274 2074 6f20 7061 6e64 6173 2044  vert to pandas D
-00015da0: 6174 6146 7261 6d65 0a20 2020 2020 2020  ataFrame.       
-00015db0: 2064 6620 3d20 7064 2e44 6174 6146 7261   df = pd.DataFra
-00015dc0: 6d65 2867 656f 6d5f 6e61 6d65 642c 2069  me(geom_named, i
-00015dd0: 6e64 6578 3d5b 7365 6c66 2e6e 616d 655d  ndex=[self.name]
-00015de0: 290a 0a20 2020 2020 2020 2023 2043 6170  )..        # Cap
-00015df0: 6974 616c 697a 6520 636f 6c75 6d6e 206e  italize column n
-00015e00: 616d 6573 2061 6e64 2072 656d 6f76 6520  ames and remove 
-00015e10: 756e 6465 7273 636f 7265 7320 6966 2072  underscores if r
-00015e20: 6571 7565 7374 6564 0a20 2020 2020 2020  equested.       
-00015e30: 2069 6620 6e69 6365 5f63 6f6c 756d 6e73   if nice_columns
-00015e40: 2061 6e64 206e 6f74 2067 6c6f 6261 6c5f   and not global_
-00015e50: 7673 5f73 6c69 6365 5f68 6561 6465 723a  vs_slice_header:
-00015e60: 0a20 2020 2020 2020 2020 2020 2064 662e  .            df.
-00015e70: 636f 6c75 6d6e 7320 3d20 5b63 6f6c 2e63  columns = [col.c
-00015e80: 6170 6974 616c 697a 6528 292e 7265 706c  apitalize().repl
-00015e90: 6163 6528 225f 222c 2022 2022 2920 0a20  ace("_", " ") . 
-00015ea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015eb0: 2020 2020 2020 2020 2066 6f72 2063 6f6c           for col
-00015ec0: 2069 6e20 6466 2e63 6f6c 756d 6e73 5d0a   in df.columns].
-00015ed0: 0a20 2020 2020 2020 2023 2054 7572 6e20  .        # Turn 
-00015ee0: 6e61 6d65 2069 6e74 6f20 6120 7265 6775  name into a regu
-00015ef0: 6c61 7220 636f 6c75 6d6e 2069 6620 7265  lar column if re
-00015f00: 7175 6573 7465 640a 2020 2020 2020 2020  quested.        
-00015f10: 6966 206e 6f74 206e 616d 655f 6173 5f69  if not name_as_i
-00015f20: 6e64 6578 3a0a 2020 2020 2020 2020 2020  ndex:.          
-00015f30: 2020 6466 203d 2064 662e 7265 7365 745f    df = df.reset_
-00015f40: 696e 6465 7828 292e 7265 6e61 6d65 287b  index().rename({
-00015f50: 2269 6e64 6578 223a 2022 524f 4922 7d2c  "index": "ROI"},
-00015f60: 2061 7869 733d 3129 0a0a 2020 2020 2020   axis=1)..      
-00015f70: 2020 2320 4164 6420 676c 6f62 616c 2f73    # Add global/s
-00015f80: 6c69 6365 2068 6561 6465 7273 0a20 2020  lice headers.   
-00015f90: 2020 2020 2069 6620 676c 6f62 616c 5f76       if global_v
-00015fa0: 735f 736c 6963 655f 6865 6164 6572 3a0a  s_slice_header:.
-00015fb0: 0a20 2020 2020 2020 2020 2020 2023 2053  .            # S
-00015fc0: 6f72 7420 636f 6c75 6d6e 7320 696e 746f  ort columns into
-00015fd0: 2067 6c6f 6261 6c20 6f72 2073 6c69 6365   global or slice
-00015fe0: 0a20 2020 2020 2020 2020 2020 2068 6561  .            hea
-00015ff0: 6465 7273 203d 205b 5d0a 2020 2020 2020  ders = [].      
-00016000: 2020 2020 2020 736c 6963 655f 636f 6c73        slice_cols
-00016010: 203d 205b 5d0a 2020 2020 2020 2020 2020   = [].          
-00016020: 2020 676c 6f62 616c 5f63 6f6c 7320 3d20    global_cols = 
-00016030: 5b5d 0a20 2020 2020 2020 2020 2020 2073  [].            s
-00016040: 6c69 6365 5f6e 616d 6520 3d20 2273 6c69  lice_name = "sli
-00016050: 6365 2220 6966 206e 6f74 206e 6963 655f  ce" if not nice_
-00016060: 636f 6c75 6d6e 7320 656c 7365 2022 536c  columns else "Sl
-00016070: 6963 6522 0a20 2020 2020 2020 2020 2020  ice".           
-00016080: 2067 6c6f 6261 6c5f 6e61 6d65 203d 2022   global_name = "
-00016090: 676c 6f62 616c 2220 6966 206e 6f74 206e  global" if not n
-000160a0: 6963 655f 636f 6c75 6d6e 7320 656c 7365  ice_columns else
-000160b0: 2022 476c 6f62 616c 220a 2020 2020 2020   "Global".      
-000160c0: 2020 2020 2020 666f 7220 6d65 7472 6963        for metric
-000160d0: 2069 6e20 6765 6f6d 5f6e 616d 6564 3a0a   in geom_named:.
-000160e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000160f0: 6e61 6d65 203d 206d 6574 7269 6320 6966  name = metric if
-00016100: 206e 6f74 206e 6963 655f 636f 6c75 6d6e   not nice_column
-00016110: 7320 656c 7365 205c 0a20 2020 2020 2020  s else \.       
-00016120: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016130: 206d 6574 7269 632e 6361 7069 7461 6c69   metric.capitali
-00016140: 7a65 2829 2e72 6570 6c61 6365 2822 5f22  ze().replace("_"
-00016150: 2c20 2222 290a 2020 2020 2020 2020 2020  , "").          
-00016160: 2020 2020 2020 6966 2022 6172 6561 2220        if "area" 
-00016170: 696e 206d 6574 7269 6320 6f72 2022 736c  in metric or "sl
-00016180: 6963 6522 2069 6e20 6d65 7472 6963 3a0a  ice" in metric:.
-00016190: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000161a0: 2020 2020 6865 6164 6572 732e 6170 7065      headers.appe
-000161b0: 6e64 2828 736c 6963 655f 6e61 6d65 2c20  nd((slice_name, 
-000161c0: 6d65 7472 6963 2929 0a20 2020 2020 2020  metric)).       
-000161d0: 2020 2020 2020 2020 2020 2020 2073 6c69               sli
-000161e0: 6365 5f63 6f6c 732e 6170 7065 6e64 286d  ce_cols.append(m
-000161f0: 6574 7269 6329 0a20 2020 2020 2020 2020  etric).         
-00016200: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-00016210: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016220: 2068 6561 6465 7273 2e61 7070 656e 6428   headers.append(
-00016230: 2867 6c6f 6261 6c5f 6e61 6d65 2c20 6d65  (global_name, me
-00016240: 7472 6963 2929 0a20 2020 2020 2020 2020  tric)).         
-00016250: 2020 2020 2020 2020 2020 2067 6c6f 6261             globa
-00016260: 6c5f 636f 6c73 2e61 7070 656e 6428 6d65  l_cols.append(me
-00016270: 7472 6963 290a 0a20 2020 2020 2020 2020  tric)..         
-00016280: 2020 2023 2052 656f 7264 6572 2063 6f6c     # Reorder col
-00016290: 756d 6e73 0a20 2020 2020 2020 2020 2020  umns.           
-000162a0: 2064 6673 5f6f 7264 6572 6564 203d 205b   dfs_ordered = [
-000162b0: 6466 5b67 6c6f 6261 6c5f 636f 6c73 5d2c  df[global_cols],
-000162c0: 2064 665b 736c 6963 655f 636f 6c73 5d5d   df[slice_cols]]
-000162d0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-000162e0: 6e6f 7420 6e61 6d65 5f61 735f 696e 6465  not name_as_inde
-000162f0: 783a 0a20 2020 2020 2020 2020 2020 2020  x:.             
-00016300: 2020 2064 6673 5f6f 7264 6572 6564 2e69     dfs_ordered.i
-00016310: 6e73 6572 7428 302c 2064 665b 2252 4f49  nsert(0, df["ROI
-00016320: 225d 290a 2020 2020 2020 2020 2020 2020  "]).            
-00016330: 6466 203d 2070 642e 636f 6e63 6174 2864  df = pd.concat(d
-00016340: 6673 5f6f 7264 6572 6564 2c20 6178 6973  fs_ordered, axis
-00016350: 3d31 290a 0a20 2020 2020 2020 2020 2020  =1)..           
-00016360: 2023 2053 6f72 7420 6865 6164 6572 7320   # Sort headers 
-00016370: 6279 2067 6c6f 6261 6c2f 736c 6963 650a  by global/slice.
-00016380: 2020 2020 2020 2020 2020 2020 6865 6164              head
-00016390: 6572 7320 3d20 5b68 2066 6f72 2068 2069  ers = [h for h i
-000163a0: 6e20 6865 6164 6572 7320 6966 2068 5b30  n headers if h[0
-000163b0: 5d20 3d3d 2067 6c6f 6261 6c5f 6e61 6d65  ] == global_name
-000163c0: 5d20 5c0a 2020 2020 2020 2020 2020 2020  ] \.            
-000163d0: 2020 2020 2020 2020 2b20 5b68 2066 6f72          + [h for
-000163e0: 2068 2069 6e20 6865 6164 6572 7320 6966   h in headers if
-000163f0: 2068 5b30 5d20 3d3d 2073 6c69 6365 5f6e   h[0] == slice_n
-00016400: 616d 655d 0a20 2020 2020 2020 2020 2020  ame].           
-00016410: 2069 6620 6e6f 7420 6e61 6d65 5f61 735f   if not name_as_
-00016420: 696e 6465 783a 0a20 2020 2020 2020 2020  index:.         
-00016430: 2020 2020 2020 2068 6561 6465 7273 2e69         headers.i
-00016440: 6e73 6572 7428 302c 2028 2222 2c20 2252  nsert(0, ("", "R
-00016450: 4f49 2229 290a 0a20 2020 2020 2020 2020  OI"))..         
-00016460: 2020 2023 2041 6464 204d 756c 7469 496e     # Add MultiIn
-00016470: 6465 780a 2020 2020 2020 2020 2020 2020  dex.            
-00016480: 6466 2e63 6f6c 756d 6e73 203d 2070 642e  df.columns = pd.
-00016490: 4d75 6c74 6949 6e64 6578 2e66 726f 6d5f  MultiIndex.from_
-000164a0: 7475 706c 6573 2868 6561 6465 7273 290a  tuples(headers).
-000164b0: 0a20 2020 2020 2020 2069 6620 6874 6d6c  .        if html
-000164c0: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
-000164d0: 7475 726e 2064 665f 746f 5f68 746d 6c28  turn df_to_html(
-000164e0: 6466 290a 2020 2020 2020 2020 7265 7475  df).        retu
-000164f0: 726e 2064 660a 0a20 2020 2064 6566 2067  rn df..    def g
-00016500: 6574 5f63 656e 7472 6f69 645f 6469 7374  et_centroid_dist
-00016510: 616e 6365 2873 656c 662c 2072 6f69 2c20  ance(self, roi, 
-00016520: 7369 6e67 6c65 5f73 6c69 6365 3d46 616c  single_slice=Fal
-00016530: 7365 2c20 7669 6577 3d22 782d 7922 2c0a  se, view="x-y",.
-00016540: 2020 2020 2020 2020 2020 2020 736c 3d4e              sl=N
-00016550: 6f6e 652c 2069 6478 3d4e 6f6e 652c 2070  one, idx=None, p
-00016560: 6f73 3d4e 6f6e 652c 2075 6e69 7473 3d22  os=None, units="
-00016570: 6d6d 222c 206d 6574 686f 643d 4e6f 6e65  mm", method=None
-00016580: 2c20 666f 7263 653d 5472 7565 2c0a 2020  , force=True,.  
-00016590: 2020 2020 2020 2020 2020 6279 5f73 6c69            by_sli
-000165a0: 6365 3d4e 6f6e 652c 2076 616c 7565 5f66  ce=None, value_f
-000165b0: 6f72 5f6e 6f6e 653d 4e6f 6e65 2c20 736c  or_none=None, sl
-000165c0: 6963 655f 7374 6174 3d4e 6f6e 652c 0a20  ice_stat=None,. 
-000165d0: 2020 2020 2020 2020 2020 202a 2a73 6c69             **sli
-000165e0: 6365 5f73 7461 745f 6b77 6172 6773 293a  ce_stat_kwargs):
-000165f0: 0a20 2020 2020 2020 2022 2222 4765 7420  .        """Get 
-00016600: 6365 6e74 726f 6964 2064 6973 706c 6163  centroid displac
-00016610: 656d 656e 7420 7665 6374 6f72 2077 6974  ement vector wit
-00016620: 6820 7265 7370 6563 7420 746f 2061 6e6f  h respect to ano
-00016630: 7468 6572 2052 4f49 2e0a 0a20 2020 2020  ther ROI...     
-00016640: 2020 202a 2a50 6172 616d 6574 6572 733a     **Parameters:
-00016650: 2a2a 0a20 2020 2020 2020 200a 2020 2020  **.        .    
-00016660: 2020 2020 726f 6920 3a20 524f 490a 2020      roi : ROI.  
-00016670: 2020 2020 2020 2020 2020 4f74 6865 7220            Other 
-00016680: 524f 4920 7769 7468 2077 6869 6368 2074  ROI with which t
-00016690: 6f20 636f 6d70 6172 6520 6365 6e74 726f  o compare centro
-000166a0: 6964 2e0a 0a20 2020 2020 2020 2073 696e  id...        sin
-000166b0: 676c 655f 736c 6963 6520 3a20 626f 6f6c  gle_slice : bool
-000166c0: 2c20 6465 6661 756c 743d 4661 6c73 650a  , default=False.
-000166d0: 2020 2020 2020 2020 2020 2020 4966 2054              If T
-000166e0: 7275 652c 2074 6865 2063 656e 7472 6f69  rue, the centroi
-000166f0: 6420 7769 6c6c 2062 6520 7265 7475 726e  d will be return
-00016700: 6564 2066 6f72 2061 2073 696e 676c 6520  ed for a single 
-00016710: 736c 6963 652e 0a0a 2020 2020 2020 2020  slice...        
-00016720: 7669 6577 203a 2073 7472 2c20 6465 6661  view : str, defa
-00016730: 756c 743d 2278 2d79 220a 2020 2020 2020  ult="x-y".      
-00016740: 2020 2020 2020 4f72 6965 6e74 6174 696f        Orientatio
-00016750: 6e20 696e 2077 6869 6368 2074 6f20 6765  n in which to ge
-00016760: 7420 6365 6e74 726f 6964 7320 6966 2075  t centroids if u
-00016770: 7369 6e67 2061 2073 696e 676c 6520 736c  sing a single sl
-00016780: 6963 6520 6f72 0a20 2020 2020 2020 2020  ice or.         
-00016790: 2020 2066 6c61 7474 656e 696e 672e 0a0a     flattening...
-000167a0: 2020 2020 2020 2020 666c 6174 7465 6e20          flatten 
-000167b0: 3a20 626f 6f6c 2c20 6465 6661 756c 743d  : bool, default=
-000167c0: 4661 6c73 650a 2020 2020 2020 2020 2020  False.          
-000167d0: 2020 4966 2054 7275 652c 2074 6865 2033    If True, the 3
-000167e0: 4420 6365 6e74 726f 6964 2077 696c 6c20  D centroid will 
-000167f0: 6265 206f 6274 6169 6e65 6420 616e 6420  be obtained and 
-00016800: 7468 656e 2074 6865 2061 6273 6f6c 7574  then the absolut
-00016810: 6520 0a20 2020 2020 2020 2020 2020 2076  e .            v
-00016820: 616c 7565 2061 6c6f 6e67 206f 6e6c 7920  alue along only 
-00016830: 7468 6520 3244 2061 7865 7320 696e 2074  the 2D axes in t
-00016840: 6865 206f 7269 656e 7461 7469 6f6e 2069  he orientation i
-00016850: 6e20 3c76 6965 773e 2077 696c 6c0a 2020  n <view> will.  
-00016860: 2020 2020 2020 2020 2020 6265 2072 6574            be ret
-00016870: 7572 6e65 642e 0a0a 2020 2020 2020 2020  urned...        
-00016880: 736c 203a 2069 6e74 2c20 6465 6661 756c  sl : int, defaul
-00016890: 743d 4e6f 6e65 0a20 2020 2020 2020 2020  t=None.         
-000168a0: 2020 2053 6c69 6365 206e 756d 6265 722e     Slice number.
-000168b0: 2049 6620 6e6f 6e65 206f 6620 3c73 6c3e   If none of <sl>
-000168c0: 2c20 3c69 6478 3e20 6f72 203c 706f 733e  , <idx> or <pos>
-000168d0: 2061 7265 2073 7570 706c 6965 6420 6275   are supplied bu
-000168e0: 740a 2020 2020 2020 2020 2020 2020 3c73  t.            <s
-000168f0: 696e 676c 655f 736c 6963 653e 2069 7320  ingle_slice> is 
-00016900: 5472 7565 2c20 7468 6520 6365 6e74 7261  True, the centra
-00016910: 6c20 736c 6963 6520 6f66 2065 6163 6820  l slice of each 
-00016920: 524f 490a 2020 2020 2020 2020 2020 2020  ROI.            
-00016930: 7769 6c6c 2062 6520 7573 6564 2e0a 0a20  will be used... 
-00016940: 2020 2020 2020 2069 6478 203a 2069 6e74         idx : int
-00016950: 2c20 6465 6661 756c 743d 4e6f 6e65 0a20  , default=None. 
-00016960: 2020 2020 2020 2020 2020 2041 7272 6179             Array
-00016970: 2069 6e64 6578 206f 6620 736c 6963 652e   index of slice.
-00016980: 2049 6620 6e6f 6e65 206f 6620 3c73 6c3e   If none of <sl>
-00016990: 2c20 3c69 6478 3e20 6f72 203c 706f 733e  , <idx> or <pos>
-000169a0: 2061 7265 2073 7570 706c 6965 640a 2020   are supplied.  
-000169b0: 2020 2020 2020 2020 2020 6275 7420 3c73            but <s
-000169c0: 696e 676c 655f 736c 6963 653e 2069 7320  ingle_slice> is 
-000169d0: 5472 7565 2c20 7468 6520 6365 6e74 7261  True, the centra
-000169e0: 6c20 736c 6963 6520 6f66 2065 6163 6820  l slice of each 
-000169f0: 524f 490a 2020 2020 2020 2020 2020 2020  ROI.            
-00016a00: 7769 6c6c 2062 6520 7573 6564 2e0a 0a20  will be used... 
-00016a10: 2020 2020 2020 2070 6f73 203a 2066 6c6f         pos : flo
-00016a20: 6174 2c20 6465 6661 756c 743d 4e6f 6e65  at, default=None
-00016a30: 0a20 2020 2020 2020 2020 2020 2053 6c69  .            Sli
-00016a40: 6365 2070 6f73 6974 696f 6e20 696e 206d  ce position in m
-00016a50: 6d2e 2049 6620 6e6f 6e65 206f 6620 3c73  m. If none of <s
-00016a60: 6c3e 2c20 3c69 6478 3e20 6f72 203c 706f  l>, <idx> or <po
-00016a70: 733e 2061 7265 2073 7570 706c 6965 640a  s> are supplied.
-00016a80: 2020 2020 2020 2020 2020 2020 6275 7420              but 
-00016a90: 3c73 696e 676c 655f 736c 6963 653e 2069  <single_slice> i
-00016aa0: 7320 5472 7565 2c20 7468 6520 6365 6e74  s True, the cent
-00016ab0: 7261 6c20 736c 6963 6520 6f66 2065 6163  ral slice of eac
-00016ac0: 6820 524f 490a 2020 2020 2020 2020 2020  h ROI.          
-00016ad0: 2020 7769 6c6c 2062 6520 7573 6564 2e0a    will be used..
-00016ae0: 0a20 2020 2020 2020 2075 6e69 7473 203a  .        units :
-00016af0: 2073 7472 2c20 6465 6661 756c 743d 226d   str, default="m
-00016b00: 6d22 0a20 2020 2020 2020 2020 2020 2055  m".            U
-00016b10: 6e69 7473 206f 6620 6162 736f 6c75 7465  nits of absolute
-00016b20: 2063 656e 7472 6f69 6420 6469 7374 616e   centroid distan
-00016b30: 6365 2e20 4361 6e20 6265 2061 6e79 206f  ce. Can be any o
-00016b40: 663a 0a20 2020 2020 2020 2020 2020 2020  f:.             
-00016b50: 2020 202d 2022 6d6d 223a 2072 6574 7572     - "mm": retur
-00016b60: 6e20 6365 6e74 726f 6964 2070 6f73 6974  n centroid posit
-00016b70: 696f 6e20 696e 206d 696c 6c69 6d65 7472  ion in millimetr
-00016b80: 6573 2e0a 2020 2020 2020 2020 2020 2020  es..            
-00016b90: 2020 2020 2d20 2276 6f78 656c 7322 3a20      - "voxels": 
-00016ba0: 7265 7475 726e 2063 656e 7472 6f69 6420  return centroid 
-00016bb0: 706f 7369 7469 6f6e 2069 6e20 7465 726d  position in term
-00016bc0: 7320 6f66 2061 7272 6179 2069 6e64 6963  s of array indic
-00016bd0: 6573 2e0a 2020 2020 2020 2020 2020 2020  es..            
-00016be0: 2020 2020 2d20 2273 6c69 6365 223a 2072      - "slice": r
-00016bf0: 6574 7572 6e20 6365 6e74 726f 6964 2070  eturn centroid p
-00016c00: 6f73 6974 696f 6e20 696e 2074 6572 6d73  osition in terms
-00016c10: 206f 6620 736c 6963 6520 6e75 6d62 6572   of slice number
-00016c20: 732e 0a0a 2020 2020 2020 2020 2020 2020  s...            
-00016c30: 4966 2075 6e69 7473 3d22 766f 7865 6c73  If units="voxels
-00016c40: 2220 6f72 2022 736c 6963 6522 2069 7320  " or "slice" is 
-00016c50: 7265 7175 6573 7465 6420 6275 7420 6569  requested but ei
-00016c60: 7468 6572 2052 4f49 206f 6e6c 7920 6861  ther ROI only ha
-00016c70: 7320 0a20 2020 2020 2020 2020 2020 2063  s .            c
-00016c80: 6f6e 746f 7572 7320 616e 6420 6e6f 206d  ontours and no m
-00016c90: 6173 6b20 7368 6170 652f 766f 7865 6c20  ask shape/voxel 
-00016ca0: 7369 7a65 2069 6e66 6f72 6d61 7469 6f6e  size information
-00016cb0: 2c20 616e 2065 7272 6f72 2077 696c 6c20  , an error will 
-00016cc0: 6265 200a 2020 2020 2020 2020 2020 2020  be .            
-00016cd0: 7261 6973 6564 2028 756e 6c65 7373 2061  raised (unless a
-00016ce0: 783d 227a 222c 2069 6e20 7768 6963 6820  x="z", in which 
-00016cf0: 6361 7365 2076 6f78 656c 2073 697a 6520  case voxel size 
-00016d00: 7769 6c6c 2062 6520 696e 6665 7272 6564  will be inferred
-00016d10: 200a 2020 2020 2020 2020 2020 2020 6672   .            fr
-00016d20: 6f6d 2073 7061 6369 6e67 2062 6574 7765  om spacing betwe
-00016d30: 656e 2073 6c69 6365 7329 2e0a 0a20 2020  en slices)...   
-00016d40: 2020 2020 206d 6574 686f 6420 3a20 7374       method : st
-00016d50: 722c 2064 6566 6175 6c74 3d4e 6f6e 650a  r, default=None.
-00016d60: 2020 2020 2020 2020 2020 2020 4d65 7468              Meth
-00016d70: 6f64 2074 6f20 7573 6520 666f 7220 6365  od to use for ce
-00016d80: 6e74 726f 6964 2063 616c 6375 6c61 7469  ntroid calculati
-00016d90: 6f6e 2e20 4361 6e20 6265 3a20 0a20 2020  on. Can be: .   
-00016da0: 2020 2020 2020 2020 2020 2020 202d 2022               - "
-00016db0: 636f 6e74 6f75 7222 3a20 6765 7420 6365  contour": get ce
-00016dc0: 6e74 726f 6964 206f 6620 7368 6170 656c  ntroid of shapel
-00016dd0: 7920 636f 6e74 6f75 7228 7329 2e0a 2020  y contour(s)..  
-00016de0: 2020 2020 2020 2020 2020 2020 2020 2d20                - 
-00016df0: 226d 6173 6b22 3a20 6765 7420 6176 6572  "mask": get aver
-00016e00: 6167 6520 706f 7369 7469 6f6e 206f 6620  age position of 
-00016e10: 766f 7865 6c73 2069 6e20 6269 6e61 7279  voxels in binary
-00016e20: 206d 6173 6b2e 0a20 2020 2020 2020 2020   mask..         
-00016e30: 2020 2020 2020 202d 204e 6f6e 653a 2075         - None: u
-00016e40: 7365 2074 6865 206d 6574 686f 6420 7365  se the method se
-00016e50: 7420 696e 2073 656c 662e 6465 6661 756c  t in self.defaul
-00016e60: 745f 6765 6f6d 5f6d 6574 686f 642e 0a0a  t_geom_method...
-00016e70: 2020 2020 2020 2020 666f 7263 6520 3a20          force : 
-00016e80: 626f 6f6c 2c20 6465 6661 756c 743d 5472  bool, default=Tr
-00016e90: 7565 0a20 2020 2020 2020 2020 2020 2049  ue.            I
-00016ea0: 6620 5472 7565 2c20 7468 6520 676c 6f62  f True, the glob
-00016eb0: 616c 2063 656e 7472 6f69 6420 7769 6c6c  al centroid will
-00016ec0: 2061 6c77 6179 7320 6265 2072 6563 616c   always be recal
-00016ed0: 6375 6c61 7465 643b 200a 2020 2020 2020  culated; .      
-00016ee0: 2020 2020 2020 6f74 6865 7277 6973 652c        otherwise,
-00016ef0: 2069 7420 7769 6c6c 206f 6e6c 7920 6265   it will only be
-00016f00: 2063 616c 6375 6c61 7465 6420 6966 2069   calculated if i
-00016f10: 7420 6861 7320 6e6f 7420 7965 7420 6265  t has not yet be
-00016f20: 656e 2063 6163 6865 6420 0a20 2020 2020  en cached .     
-00016f30: 2020 2020 2020 2069 6e20 7365 6c66 2e5f         in self._
-00016f40: 766f 6c75 6d65 2e20 204e 6f74 6520 7468  volume.  Note th
-00016f50: 6174 2069 6620 7369 6e67 6c65 5f73 6c69  at if single_sli
-00016f60: 6365 3d54 7275 652c 2074 6865 2063 656e  ce=True, the cen
-00016f70: 7472 6f69 6420 7769 6c6c 200a 2020 2020  troid will .    
-00016f80: 2020 2020 2020 2020 616c 7761 7973 2062          always b
-00016f90: 6520 7265 6361 6c63 756c 6174 6564 2e0a  e recalculated..
-00016fa0: 0a20 2020 2020 2020 2062 795f 736c 6963  .        by_slic
-00016fb0: 6520 3a20 7374 722c 2064 6566 6175 6c74  e : str, default
-00016fc0: 3d4e 6f6e 650a 2020 2020 2020 2020 2020  =None.          
-00016fd0: 2020 4966 206f 6e65 206f 6620 226c 6566    If one of "lef
-00016fe0: 7422 2c20 2272 6967 6874 222c 2022 756e  t", "right", "un
-00016ff0: 696f 6e22 2c20 2269 6e74 6572 7365 6374  ion", "intersect
-00017000: 696f 6e22 2c20 6361 6c63 756c 6174 650a  ion", calculate.
-00017010: 2020 2020 2020 2020 2020 2020 4469 6365              Dice
-00017020: 2073 636f 7265 7320 736c 6963 6520 6279   scores slice by
-00017030: 2073 6c69 6365 2066 6f72 2065 6163 6820   slice for each 
-00017040: 736c 6963 6520 636f 6e74 6169 6e69 6e67  slice containing
-00017050: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00017060: 6620 616e 642f 6f72 206f 7468 6572 3a0a  f and/or other:.
-00017070: 0a20 2020 2020 2020 2020 2020 202d 2022  .            - "
-00017080: 6c65 6674 223a 2063 6f6e 7369 6465 7220  left": consider 
-00017090: 6f6e 6c79 2073 6c69 6365 7320 636f 6e74  only slices cont
-000170a0: 6169 6e69 6e67 2073 656c 663b 0a20 2020  aining self;.   
-000170b0: 2020 2020 2020 2020 202d 2022 7269 6768           - "righ
-000170c0: 7422 3a20 636f 6e73 6964 6572 206f 6e6c  t": consider onl
-000170d0: 7920 736c 6963 6573 2063 6f6e 7461 696e  y slices contain
-000170e0: 696e 6720 6f74 6865 723b 0a20 2020 2020  ing other;.     
-000170f0: 2020 2020 2020 202d 2022 756e 696f 6e22         - "union"
-00017100: 3a20 636f 6e73 6964 6572 2073 6c69 6365  : consider slice
-00017110: 7320 636f 6e74 6169 6e69 6e67 2065 6974  s containing eit
-00017120: 6865 7220 6f66 2073 656c 6620 616e 6420  her of self and 
-00017130: 6f74 6865 723b 0a20 2020 2020 2020 2020  other;.         
-00017140: 2020 202d 2022 696e 7465 7273 6563 7469     - "intersecti
-00017150: 6f6e 223a 2063 6f6e 7369 6465 7220 736c  on": consider sl
-00017160: 6963 6573 2063 6f6e 7461 696e 696e 6720  ices containing 
-00017170: 626f 7468 206f 6620 7365 6c66 2061 6e64  both of self and
-00017180: 206f 7468 6572 2e0a 0a20 2020 2020 2020   other...       
-00017190: 2020 2020 2049 6620 736c 6963 655f 7374       If slice_st
-000171a0: 6174 2069 7320 4e6f 6e65 2c20 7265 7475  at is None, retu
-000171b0: 726e 2061 2064 6963 7469 6f6e 6172 7920  rn a dictionary 
-000171c0: 7768 6572 6520 6b65 7973 2061 7265 0a20  where keys are. 
-000171d0: 2020 2020 2020 2020 2020 2073 6c69 6365             slice
-000171e0: 2070 6f73 6974 696f 6e73 2061 6e64 2076   positions and v
-000171f0: 616c 7565 7320 6172 6520 7468 6520 6361  alues are the ca
-00017200: 6c63 756c 6174 6564 2044 6963 6520 7363  lculated Dice sc
-00017210: 6f72 6573 2e0a 2020 2020 2020 2020 2020  ores..          
-00017220: 2020 4f74 6865 7277 6973 652c 2072 6574    Otherwise, ret
-00017230: 7572 6e20 666f 7220 7468 6520 6361 6c63  urn for the calc
-00017240: 756c 6174 6564 2044 6963 6520 7363 6f72  ulated Dice scor
-00017250: 6573 2074 6865 2073 7461 7469 7374 6963  es the statistic
-00017260: 0a20 2020 2020 2020 2020 2020 2073 7065  .            spe
-00017270: 6369 6669 6564 2062 7920 736c 6963 655f  cified by slice_
-00017280: 7374 6174 2e0a 0a20 2020 2020 2020 2076  stat...        v
-00017290: 616c 7565 5f66 6f72 5f6e 6f6e 6520 3a20  alue_for_none : 
-000172a0: 666c 6f61 742c 2064 6566 6175 6c74 3d4e  float, default=N
-000172b0: 6f6e 650a 2020 2020 2020 2020 2020 2020  one.            
-000172c0: 466f 7220 7369 6e67 6c65 5f73 6c69 6365  For single_slice
-000172d0: 2061 6e64 2062 795f 736c 6963 652c 2076   and by_slice, v
-000172e0: 616c 7565 2074 6f20 6265 2072 6574 7572  alue to be retur
-000172f0: 6e65 6420 666f 720a 2020 2020 2020 2020  ned for.        
-00017300: 2020 2020 736c 6963 6573 2077 6865 7265      slices where
-00017310: 2044 6963 6520 7363 6f72 6520 6973 2075   Dice score is u
-00017320: 6e64 6574 6572 6d69 6e65 6420 284e 6f6e  ndetermined (Non
-00017330: 6529 2e20 2046 6f72 2073 6c69 6365 5f73  e).  For slice_s
-00017340: 7461 742c 0a20 2020 2020 2020 2020 2020  tat,.           
-00017350: 2076 616c 7565 2074 6f20 7375 6273 7469   value to substi
-00017360: 7475 7465 2066 6f72 2061 6e79 204e 6f6e  tute for any Non
-00017370: 6520 7661 6c75 6573 2061 6d6f 6e67 2074  e values among t
-00017380: 6865 2069 6e70 7574 730a 2020 2020 2020  he inputs.      
-00017390: 2020 2020 2020 666f 7220 6361 6c63 756c        for calcul
-000173a0: 6174 696e 6720 736c 6963 652d 6261 7365  ating slice-base
-000173b0: 6420 7374 6174 6973 7469 632e 2020 4966  d statistic.  If
-000173c0: 204e 6f6e 6520 696e 2074 6865 206c 6174   None in the lat
-000173d0: 7465 720a 2020 2020 2020 2020 2020 2020  ter.            
-000173e0: 6361 7365 2c20 4e6f 6e65 2076 616c 7565  case, None value
-000173f0: 7320 616d 6f6e 6720 7468 6520 696e 7075  s among the inpu
-00017400: 7473 2061 7265 206f 6d69 7474 6564 2e0a  ts are omitted..
-00017410: 0a20 2020 2020 2020 2073 6c69 6365 5f73  .        slice_s
-00017420: 7461 7420 3a20 7374 722c 2064 6566 6175  tat : str, defau
-00017430: 6c74 3d4e 6f6e 650a 2020 2020 2020 2020  lt=None.        
-00017440: 2020 2020 5369 6e67 6c65 2d76 6172 6961      Single-varia
-00017450: 626c 6520 7374 6174 6973 7469 6328 7329  ble statistic(s)
-00017460: 2074 6f20 6265 2072 6574 7572 6e65 6420   to be returned 
-00017470: 666f 7220 736c 6963 652d 6279 2d73 6c69  for slice-by-sli
-00017480: 6365 0a20 2020 2020 2020 2020 2020 2044  ce.            D
-00017490: 6963 6520 7363 6f72 6573 2e20 2054 6869  ice scores.  Thi
-000174a0: 7320 7368 6f75 6c64 2062 6520 7468 6520  s should be the 
-000174b0: 6e61 6d65 206f 6620 7468 6520 6675 6e63  name of the func
-000174c0: 7469 6f6e 2066 6f72 0a20 2020 2020 2020  tion for.       
-000174d0: 2020 2020 2063 616c 6375 6c61 7469 6f6e       calculation
-000174e0: 206f 6620 7468 6520 7374 6174 6973 7469   of the statisti
-000174f0: 6328 7329 2069 6e20 7468 6520 5079 7468  c(s) in the Pyth
-00017500: 6f6e 2073 7461 7469 7374 6963 7320 6d6f  on statistics mo
-00017510: 6475 6c65 3a0a 0a20 2020 2020 2020 2020  dule:..         
-00017520: 2020 2068 7474 7073 3a2f 2f64 6f63 732e     https://docs.
-00017530: 7079 7468 6f6e 2e6f 7267 2f33 2f6c 6962  python.org/3/lib
-00017540: 7261 7279 2f73 7461 7469 7374 6963 732e  rary/statistics.
-00017550: 6874 6d6c 0a0a 2020 2020 2020 2020 2020  html..          
-00017560: 2020 4176 6169 6c61 626c 6520 6f70 7469    Available opti
-00017570: 6f6e 7320 696e 636c 7564 653a 2022 6d65  ons include: "me
-00017580: 616e 222c 2022 6d65 6469 616e 222c 2022  an", "median", "
-00017590: 6d6f 6465 222c 0a20 2020 2020 2020 2020  mode",.         
-000175a0: 2020 2022 7374 6465 7622 2c20 2271 7561     "stdev", "qua
-000175b0: 6e74 696c 6573 222e 2020 4469 7372 6567  ntiles".  Disreg
-000175c0: 6172 6465 6420 6966 204e 6f6e 652e 0a0a  arded if None...
-000175d0: 2020 2020 2020 2020 2020 2020 4966 2062              If b
-000175e0: 795f 736c 6963 6520 6973 204e 6f6e 6520  y_slice is None 
-000175f0: 616e 6420 736c 6963 655f 7374 6174 2069  and slice_stat i
-00017600: 7320 6469 6666 6572 656e 7420 6672 6f6d  s different from
-00017610: 204e 6f6e 652c 0a20 2020 2020 2020 2020   None,.         
-00017620: 2020 2073 6b72 742e 636f 7265 2e44 6566     skrt.core.Def
-00017630: 6175 6c74 7328 292e 6279 5f73 6c69 6365  aults().by_slice
-00017640: 2069 7320 7573 6564 2066 6f72 2074 6865   is used for the
-00017650: 2066 6f72 6d65 722e 0a0a 2020 2020 2020   former...      
-00017660: 2020 736c 6963 655f 7374 6174 5f6b 7761    slice_stat_kwa
-00017670: 7267 7320 3a20 6469 6374 2c20 6465 6661  rgs : dict, defa
-00017680: 756c 743d 4e6f 6e65 0a20 2020 2020 2020  ult=None.       
-00017690: 2020 2020 204b 6579 776f 7264 2061 7267       Keyword arg
-000176a0: 756d 656e 7473 2074 6f20 6265 2070 6173  uments to be pas
-000176b0: 7365 6420 746f 2066 756e 6374 696f 6e20  sed to function 
-000176c0: 6f66 2073 7461 7469 7374 6963 730a 2020  of statistics.  
-000176d0: 2020 2020 2020 2020 2020 6d6f 6475 6c65            module
-000176e0: 2066 6f72 2063 616c 6375 6c61 7469 6f6e   for calculation
-000176f0: 2072 656c 6174 6976 6520 746f 2073 6c69   relative to sli
-00017700: 6365 2076 616c 7565 732e 2020 466f 7220  ce values.  For 
-00017710: 6578 616d 706c 652c 0a20 2020 2020 2020  example,.       
-00017720: 2020 2020 2069 6620 7175 616e 7469 6c65       if quantile
-00017730: 7320 6172 6520 7265 7175 6972 6564 2066  s are required f
-00017740: 6f72 2031 3020 696e 7465 7276 616c 732c  or 10 intervals,
-00017750: 2072 6174 6865 7220 7468 616e 2066 6f72   rather than for
-00017760: 0a20 2020 2020 2020 2020 2020 2074 6865  .            the
-00017770: 2064 6566 6175 6c74 206f 6620 342c 2074   default of 4, t
-00017780: 6869 7320 6361 6e20 6265 2073 7065 6369  his can be speci
-00017790: 6669 6564 2075 7369 6e67 3a0a 0a20 2020  fied using:..   
-000177a0: 2020 2020 2020 2020 2073 6c69 6365 5f73           slice_s
-000177b0: 7461 745f 6b77 6172 6773 7b22 6e22 203a  tat_kwargs{"n" :
-000177c0: 2031 307d 0a0a 2020 2020 2020 2020 2020   10}..          
-000177d0: 2020 466f 7220 6176 6169 6c61 626c 6520    For available 
-000177e0: 6b65 7977 6f72 6420 6f70 7469 6f6e 732c  keyword options,
-000177f0: 2073 6565 2064 6f63 756d 656e 7461 7469   see documentati
-00017800: 6f6e 206f 6620 7374 6174 6973 7469 6373  on of statistics
-00017810: 0a20 2020 2020 2020 2020 2020 206d 6f64  .            mod
-00017820: 756c 6520 6174 3a0a 0a20 2020 2020 2020  ule at:..       
-00017830: 2020 2020 2068 7474 7073 3a2f 2f64 6f63       https://doc
-00017840: 732e 7079 7468 6f6e 2e6f 7267 2f33 2f6c  s.python.org/3/l
-00017850: 6962 7261 7279 2f73 7461 7469 7374 6963  ibrary/statistic
-00017860: 732e 6874 6d6c 0a20 2020 2020 2020 2022  s.html.        "
-00017870: 2222 0a20 2020 2020 2020 2069 6620 736c  "".        if sl
-00017880: 6963 655f 7374 6174 3a0a 2020 2020 2020  ice_stat:.      
-00017890: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-000178a0: 662e 6765 745f 736c 6963 655f 7374 6174  f.get_slice_stat
-000178b0: 2872 6f69 2c20 2263 656e 7472 6f69 6422  (roi, "centroid"
-000178c0: 2c20 736c 6963 655f 7374 6174 2c0a 2020  , slice_stat,.  
-000178d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000178e0: 2020 6279 5f73 6c69 6365 2c20 7661 6c75    by_slice, valu
-000178f0: 655f 666f 725f 6e6f 6e65 2c20 7669 6577  e_for_none, view
-00017900: 2c20 6d65 7468 6f64 2c0a 2020 2020 2020  , method,.      
-00017910: 2020 2020 2020 2020 2020 2020 2020 2a2a                **
-00017920: 2873 6c69 6365 5f73 7461 745f 6b77 6172  (slice_stat_kwar
-00017930: 6773 206f 7220 7b7d 2929 0a0a 2020 2020  gs or {}))..    
-00017940: 2020 2020 6966 2062 795f 736c 6963 653a      if by_slice:
-00017950: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-00017960: 7572 6e20 7365 6c66 2e67 6574 5f6d 6574  urn self.get_met
-00017970: 7269 635f 6279 5f73 6c69 6365 2872 6f69  ric_by_slice(roi
-00017980: 2c20 2263 656e 7472 6f69 6422 2c20 6279  , "centroid", by
-00017990: 5f73 6c69 6365 2c0a 2020 2020 2020 2020  _slice,.        
-000179a0: 2020 2020 2020 2020 2020 2020 7669 6577              view
-000179b0: 2c20 6d65 7468 6f64 290a 0a20 2020 2020  , method)..     
-000179c0: 2020 2074 6869 735f 6365 6e74 726f 6964     this_centroid
-000179d0: 203d 206e 702e 6172 7261 7928 7365 6c66   = np.array(self
-000179e0: 2e67 6574 5f63 656e 7472 6f69 6428 0a20  .get_centroid(. 
-000179f0: 2020 2020 2020 2020 2020 2073 696e 676c             singl
-00017a00: 655f 736c 6963 653d 7369 6e67 6c65 5f73  e_slice=single_s
-00017a10: 6c69 6365 2c20 7669 6577 3d76 6965 772c  lice, view=view,
-00017a20: 2073 6c3d 736c 2c20 6964 783d 6964 782c   sl=sl, idx=idx,
-00017a30: 2070 6f73 3d70 6f73 2c0a 2020 2020 2020   pos=pos,.      
-00017a40: 2020 2020 2020 756e 6974 733d 756e 6974        units=unit
-00017a50: 732c 206d 6574 686f 643d 6d65 7468 6f64  s, method=method
-00017a60: 2c20 666f 7263 653d 666f 7263 6529 0a20  , force=force). 
-00017a70: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-00017a80: 206f 7468 6572 5f63 656e 7472 6f69 6420   other_centroid 
-00017a90: 3d20 6e70 2e61 7272 6179 2872 6f69 2e67  = np.array(roi.g
-00017aa0: 6574 5f63 656e 7472 6f69 6428 0a20 2020  et_centroid(.   
-00017ab0: 2020 2020 2020 2020 2073 696e 676c 655f           single_
-00017ac0: 736c 6963 653d 7369 6e67 6c65 5f73 6c69  slice=single_sli
-00017ad0: 6365 2c20 7669 6577 3d76 6965 772c 2073  ce, view=view, s
-00017ae0: 6c3d 736c 2c20 6964 783d 6964 782c 2070  l=sl, idx=idx, p
-00017af0: 6f73 3d70 6f73 2c0a 2020 2020 2020 2020  os=pos,.        
-00017b00: 2020 2020 756e 6974 733d 756e 6974 732c      units=units,
-00017b10: 206d 6574 686f 643d 6d65 7468 6f64 2c20   method=method, 
-00017b20: 666f 7263 653d 666f 7263 6529 0a20 2020  force=force).   
-00017b30: 2020 2020 2029 0a20 2020 2020 2020 2069       ).        i
-00017b40: 6620 4e6f 6e65 2069 6e20 7468 6973 5f63  f None in this_c
-00017b50: 656e 7472 6f69 6420 6f72 204e 6f6e 6520  entroid or None 
-00017b60: 696e 206f 7468 6572 5f63 656e 7472 6f69  in other_centroi
-00017b70: 643a 0a20 2020 2020 2020 2020 2020 2069  d:.            i
-00017b80: 6620 7369 6e67 6c65 5f73 6c69 6365 3a0a  f single_slice:.
-00017b90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017ba0: 7265 7475 726e 206e 702e 6172 7261 7928  return np.array(
-00017bb0: 5b76 616c 7565 5f66 6f72 5f6e 6f6e 652c  [value_for_none,
-00017bc0: 2076 616c 7565 5f66 6f72 5f6e 6f6e 655d   value_for_none]
-00017bd0: 290a 2020 2020 2020 2020 2020 2020 656c  ).            el
-00017be0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-00017bf0: 2020 2020 7265 7475 726e 206e 702e 6172      return np.ar
-00017c00: 7261 7928 5b76 616c 7565 5f66 6f72 5f6e  ray([value_for_n
-00017c10: 6f6e 652c 2076 616c 7565 5f66 6f72 5f6e  one, value_for_n
-00017c20: 6f6e 652c 0a20 2020 2020 2020 2020 2020  one,.           
-00017c30: 2020 2020 2020 2020 2076 616c 7565 5f66           value_f
-00017c40: 6f72 5f6e 6f6e 655d 290a 2020 2020 2020  or_none]).      
-00017c50: 2020 7265 7475 726e 206f 7468 6572 5f63    return other_c
-00017c60: 656e 7472 6f69 6420 2d20 7468 6973 5f63  entroid - this_c
-00017c70: 656e 7472 6f69 640a 0a20 2020 2064 6566  entroid..    def
-00017c80: 2067 6574 5f61 6273 5f63 656e 7472 6f69   get_abs_centroi
-00017c90: 645f 6469 7374 616e 6365 280a 2020 2020  d_distance(.    
-00017ca0: 2020 2020 7365 6c66 2c20 0a20 2020 2020      self, .     
-00017cb0: 2020 2072 6f69 2c20 0a20 2020 2020 2020     roi, .       
-00017cc0: 2076 6965 773d 2278 2d79 222c 200a 2020   view="x-y", .  
-00017cd0: 2020 2020 2020 7369 6e67 6c65 5f73 6c69        single_sli
-00017ce0: 6365 3d46 616c 7365 2c0a 2020 2020 2020  ce=False,.      
-00017cf0: 2020 666c 6174 7465 6e3d 4661 6c73 652c    flatten=False,
-00017d00: 200a 2020 2020 2020 2020 736c 3d4e 6f6e   .        sl=Non
-00017d10: 652c 0a20 2020 2020 2020 2069 6478 3d4e  e,.        idx=N
-00017d20: 6f6e 652c 0a20 2020 2020 2020 2070 6f73  one,.        pos
-00017d30: 3d4e 6f6e 652c 0a20 2020 2020 2020 2075  =None,.        u
-00017d40: 6e69 7473 3d22 6d6d 222c 0a20 2020 2020  nits="mm",.     
-00017d50: 2020 206d 6574 686f 643d 4e6f 6e65 2c0a     method=None,.
-00017d60: 2020 2020 2020 2020 666f 7263 653d 5472          force=Tr
-00017d70: 7565 2c0a 2020 2020 2020 2020 6279 5f73  ue,.        by_s
-00017d80: 6c69 6365 3d4e 6f6e 652c 0a20 2020 2020  lice=None,.     
-00017d90: 2020 2076 616c 7565 5f66 6f72 5f6e 6f6e     value_for_non
-00017da0: 653d 4e6f 6e65 2c0a 2020 2020 2020 2020  e=None,.        
-00017db0: 736c 6963 655f 7374 6174 3d4e 6f6e 652c  slice_stat=None,
-00017dc0: 0a20 2020 2020 2020 2073 6c69 6365 5f73  .        slice_s
-00017dd0: 7461 745f 6b77 6172 6773 3d4e 6f6e 652c  tat_kwargs=None,
-00017de0: 0a20 2020 2020 2020 2029 3a0a 2020 2020  .        ):.    
-00017df0: 2020 2020 2222 2247 6574 2061 6273 6f6c      """Get absol
-00017e00: 7574 6520 6365 6e74 726f 6964 2064 6973  ute centroid dis
-00017e10: 7461 6e63 6520 7769 7468 2072 6573 7065  tance with respe
-00017e20: 6374 2074 6f20 616e 6f74 6865 7220 524f  ct to another RO
-00017e30: 492e 0a0a 2020 2020 2020 2020 2a2a 5061  I...        **Pa
-00017e40: 7261 6d65 7465 7273 3a2a 2a0a 2020 2020  rameters:**.    
-00017e50: 2020 2020 0a20 2020 2020 2020 2072 6f69      .        roi
-00017e60: 203a 2052 4f49 0a20 2020 2020 2020 2020   : ROI.         
-00017e70: 2020 204f 7468 6572 2052 4f49 2077 6974     Other ROI wit
-00017e80: 6820 7768 6963 6820 746f 2063 6f6d 7061  h which to compa
-00017e90: 7265 2063 656e 7472 6f69 642e 0a0a 2020  re centroid...  
-00017ea0: 2020 2020 2020 7669 6577 203a 2073 7472        view : str
-00017eb0: 2c20 6465 6661 756c 743d 2278 2d79 220a  , default="x-y".
-00017ec0: 2020 2020 2020 2020 2020 2020 4f72 6965              Orie
-00017ed0: 6e74 6174 696f 6e20 696e 2077 6869 6368  ntation in which
-00017ee0: 2074 6f20 6765 7420 6365 6e74 726f 6964   to get centroid
-00017ef0: 7320 6966 2075 7369 6e67 2061 2073 696e  s if using a sin
-00017f00: 676c 6520 736c 6963 6520 6f72 0a20 2020  gle slice or.   
-00017f10: 2020 2020 2020 2020 2066 6c61 7474 656e           flatten
-00017f20: 696e 672e 0a0a 2020 2020 2020 2020 7369  ing...        si
-00017f30: 6e67 6c65 5f73 6c69 6365 203a 2062 6f6f  ngle_slice : boo
-00017f40: 6c2c 2064 6566 6175 6c74 3d46 616c 7365  l, default=False
-00017f50: 0a20 2020 2020 2020 2020 2020 2049 6620  .            If 
-00017f60: 5472 7565 2c20 7468 6520 6365 6e74 726f  True, the centro
-00017f70: 6964 2077 696c 6c20 6265 2072 6574 7572  id will be retur
-00017f80: 6e65 6420 666f 7220 6120 7369 6e67 6c65  ned for a single
-00017f90: 2073 6c69 6365 2e0a 0a20 2020 2020 2020   slice...       
-00017fa0: 2066 6c61 7474 656e 203a 2062 6f6f 6c2c   flatten : bool,
-00017fb0: 2064 6566 6175 6c74 3d46 616c 7365 0a20   default=False. 
-00017fc0: 2020 2020 2020 2020 2020 2049 6620 5472             If Tr
-00017fd0: 7565 2c20 7468 6520 3344 2063 656e 7472  ue, the 3D centr
-00017fe0: 6f69 6420 7769 6c6c 2062 6520 6f62 7461  oid will be obta
-00017ff0: 696e 6564 2061 6e64 2074 6865 6e20 7468  ined and then th
-00018000: 6520 6162 736f 6c75 7465 200a 2020 2020  e absolute .    
-00018010: 2020 2020 2020 2020 7661 6c75 6520 616c          value al
-00018020: 6f6e 6720 6f6e 6c79 2074 6865 2032 4420  ong only the 2D 
-00018030: 6178 6573 2069 6e20 7468 6520 6f72 6965  axes in the orie
-00018040: 6e74 6174 696f 6e20 696e 203c 7669 6577  ntation in <view
-00018050: 3e20 7769 6c6c 0a20 2020 2020 2020 2020  > will.         
-00018060: 2020 2062 6520 7265 7475 726e 6564 2e0a     be returned..
-00018070: 0a20 2020 2020 2020 2073 6c20 3a20 696e  .        sl : in
-00018080: 742c 2064 6566 6175 6c74 3d4e 6f6e 650a  t, default=None.
-00018090: 2020 2020 2020 2020 2020 2020 536c 6963              Slic
-000180a0: 6520 6e75 6d62 6572 2e20 4966 206e 6f6e  e number. If non
-000180b0: 6520 6f66 203c 736c 3e2c 203c 6964 783e  e of <sl>, <idx>
-000180c0: 206f 7220 3c70 6f73 3e20 6172 6520 7375   or <pos> are su
-000180d0: 7070 6c69 6564 2062 7574 0a20 2020 2020  pplied but.     
-000180e0: 2020 2020 2020 203c 7369 6e67 6c65 5f73         <single_s
-000180f0: 6c69 6365 3e20 6973 2054 7275 652c 2074  lice> is True, t
-00018100: 6865 2063 656e 7472 616c 2073 6c69 6365  he central slice
-00018110: 206f 6620 6561 6368 2052 4f49 0a20 2020   of each ROI.   
-00018120: 2020 2020 2020 2020 2077 696c 6c20 6265           will be
-00018130: 2075 7365 642e 0a0a 2020 2020 2020 2020   used...        
-00018140: 6964 7820 3a20 696e 742c 2064 6566 6175  idx : int, defau
-00018150: 6c74 3d4e 6f6e 650a 2020 2020 2020 2020  lt=None.        
-00018160: 2020 2020 4172 7261 7920 696e 6465 7820      Array index 
-00018170: 6f66 2073 6c69 6365 2e20 4966 206e 6f6e  of slice. If non
-00018180: 6520 6f66 203c 736c 3e2c 203c 6964 783e  e of <sl>, <idx>
-00018190: 206f 7220 3c70 6f73 3e20 6172 6520 7375   or <pos> are su
-000181a0: 7070 6c69 6564 0a20 2020 2020 2020 2020  pplied.         
-000181b0: 2020 2062 7574 203c 7369 6e67 6c65 5f73     but <single_s
-000181c0: 6c69 6365 3e20 6973 2054 7275 652c 2074  lice> is True, t
-000181d0: 6865 2063 656e 7472 616c 2073 6c69 6365  he central slice
-000181e0: 206f 6620 6561 6368 2052 4f49 0a20 2020   of each ROI.   
-000181f0: 2020 2020 2020 2020 2077 696c 6c20 6265           will be
-00018200: 2075 7365 642e 0a0a 2020 2020 2020 2020   used...        
-00018210: 706f 7320 3a20 666c 6f61 742c 2064 6566  pos : float, def
-00018220: 6175 6c74 3d4e 6f6e 650a 2020 2020 2020  ault=None.      
-00018230: 2020 2020 2020 536c 6963 6520 706f 7369        Slice posi
-00018240: 7469 6f6e 2069 6e20 6d6d 2e20 4966 206e  tion in mm. If n
-00018250: 6f6e 6520 6f66 203c 736c 3e2c 203c 6964  one of <sl>, <id
-00018260: 783e 206f 7220 3c70 6f73 3e20 6172 6520  x> or <pos> are 
-00018270: 7375 7070 6c69 6564 0a20 2020 2020 2020  supplied.       
-00018280: 2020 2020 2062 7574 203c 7369 6e67 6c65       but <single
-00018290: 5f73 6c69 6365 3e20 6973 2054 7275 652c  _slice> is True,
-000182a0: 2074 6865 2063 656e 7472 616c 2073 6c69   the central sli
-000182b0: 6365 206f 6620 6561 6368 2052 4f49 0a20  ce of each ROI. 
-000182c0: 2020 2020 2020 2020 2020 2077 696c 6c20             will 
-000182d0: 6265 2075 7365 642e 0a0a 2020 2020 2020  be used...      
-000182e0: 2020 756e 6974 7320 3a20 7374 722c 2064    units : str, d
-000182f0: 6566 6175 6c74 3d22 6d6d 220a 2020 2020  efault="mm".    
-00018300: 2020 2020 2020 2020 556e 6974 7320 6f66          Units of
-00018310: 2061 6273 6f6c 7574 6520 6365 6e74 726f   absolute centro
-00018320: 6964 2064 6973 7461 6e63 652e 2043 616e  id distance. Can
-00018330: 2062 6520 616e 7920 6f66 3a0a 2020 2020   be any of:.    
-00018340: 2020 2020 2020 2020 2020 2020 2d20 226d              - "m
-00018350: 6d22 3a20 7265 7475 726e 2063 656e 7472  m": return centr
-00018360: 6f69 6420 706f 7369 7469 6f6e 2069 6e20  oid position in 
-00018370: 6d69 6c6c 696d 6574 7265 732e 0a20 2020  millimetres..   
-00018380: 2020 2020 2020 2020 2020 2020 202d 2022               - "
-00018390: 766f 7865 6c73 223a 2072 6574 7572 6e20  voxels": return 
-000183a0: 6365 6e74 726f 6964 2070 6f73 6974 696f  centroid positio
-000183b0: 6e20 696e 2074 6572 6d73 206f 6620 6172  n in terms of ar
-000183c0: 7261 7920 696e 6469 6365 732e 0a20 2020  ray indices..   
-000183d0: 2020 2020 2020 2020 2020 2020 202d 2022               - "
-000183e0: 736c 6963 6522 3a20 7265 7475 726e 2063  slice": return c
-000183f0: 656e 7472 6f69 6420 706f 7369 7469 6f6e  entroid position
-00018400: 2069 6e20 7465 726d 7320 6f66 2073 6c69   in terms of sli
-00018410: 6365 206e 756d 6265 7273 2e0a 0a20 2020  ce numbers...   
-00018420: 2020 2020 2020 2020 2049 6620 756e 6974           If unit
-00018430: 733d 2276 6f78 656c 7322 206f 7220 2273  s="voxels" or "s
-00018440: 6c69 6365 2220 6973 2072 6571 7565 7374  lice" is request
-00018450: 6564 2062 7574 2065 6974 6865 7220 524f  ed but either RO
-00018460: 4920 6f6e 6c79 2068 6173 200a 2020 2020  I only has .    
-00018470: 2020 2020 2020 2020 636f 6e74 6f75 7273          contours
-00018480: 2061 6e64 206e 6f20 6d61 736b 2073 6861   and no mask sha
-00018490: 7065 2f76 6f78 656c 2073 697a 6520 696e  pe/voxel size in
-000184a0: 666f 726d 6174 696f 6e2c 2061 6e20 6572  formation, an er
-000184b0: 726f 7220 7769 6c6c 2062 6520 0a20 2020  ror will be .   
-000184c0: 2020 2020 2020 2020 2072 6169 7365 6420           raised 
-000184d0: 2875 6e6c 6573 7320 6178 3d22 7a22 2c20  (unless ax="z", 
-000184e0: 696e 2077 6869 6368 2063 6173 6520 766f  in which case vo
-000184f0: 7865 6c20 7369 7a65 2077 696c 6c20 6265  xel size will be
-00018500: 2069 6e66 6572 7265 6420 0a20 2020 2020   inferred .     
-00018510: 2020 2020 2020 2066 726f 6d20 7370 6163         from spac
-00018520: 696e 6720 6265 7477 6565 6e20 736c 6963  ing between slic
-00018530: 6573 292e 0a0a 2020 2020 2020 2020 6d65  es)...        me
-00018540: 7468 6f64 203a 2073 7472 2c20 6465 6661  thod : str, defa
-00018550: 756c 743d 4e6f 6e65 0a20 2020 2020 2020  ult=None.       
-00018560: 2020 2020 204d 6574 686f 6420 746f 2075       Method to u
-00018570: 7365 2066 6f72 2063 656e 7472 6f69 6420  se for centroid 
-00018580: 6361 6c63 756c 6174 696f 6e2e 2043 616e  calculation. Can
-00018590: 2062 653a 200a 2020 2020 2020 2020 2020   be: .          
-000185a0: 2020 2020 2020 2d20 2263 6f6e 746f 7572        - "contour
-000185b0: 223a 2067 6574 2063 656e 7472 6f69 6420  ": get centroid 
-000185c0: 6f66 2073 6861 7065 6c79 2063 6f6e 746f  of shapely conto
-000185d0: 7572 2873 292e 0a20 2020 2020 2020 2020  ur(s)..         
-000185e0: 2020 2020 2020 202d 2022 6d61 736b 223a         - "mask":
-000185f0: 2067 6574 2061 7665 7261 6765 2070 6f73   get average pos
-00018600: 6974 696f 6e20 6f66 2076 6f78 656c 7320  ition of voxels 
-00018610: 696e 2062 696e 6172 7920 6d61 736b 2e0a  in binary mask..
-00018620: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018630: 2d20 4e6f 6e65 3a20 7573 6520 7468 6520  - None: use the 
-00018640: 6d65 7468 6f64 2073 6574 2069 6e20 7365  method set in se
-00018650: 6c66 2e64 6566 6175 6c74 5f67 656f 6d5f  lf.default_geom_
-00018660: 6d65 7468 6f64 2e0a 0a20 2020 2020 2020  method...       
-00018670: 2066 6f72 6365 203a 2062 6f6f 6c2c 2064   force : bool, d
-00018680: 6566 6175 6c74 3d54 7275 650a 2020 2020  efault=True.    
-00018690: 2020 2020 2020 2020 4966 2054 7275 652c          If True,
-000186a0: 2074 6865 2067 6c6f 6261 6c20 6365 6e74   the global cent
-000186b0: 726f 6964 2077 696c 6c20 616c 7761 7973  roid will always
-000186c0: 2062 6520 7265 6361 6c63 756c 6174 6564   be recalculated
-000186d0: 3b20 0a20 2020 2020 2020 2020 2020 206f  ; .            o
-000186e0: 7468 6572 7769 7365 2c20 6974 2077 696c  therwise, it wil
-000186f0: 6c20 6f6e 6c79 2062 6520 6361 6c63 756c  l only be calcul
-00018700: 6174 6564 2069 6620 6974 2068 6173 206e  ated if it has n
-00018710: 6f74 2079 6574 2062 6565 6e20 6361 6368  ot yet been cach
-00018720: 6564 200a 2020 2020 2020 2020 2020 2020  ed .            
-00018730: 696e 2073 656c 662e 5f76 6f6c 756d 652e  in self._volume.
-00018740: 2020 4e6f 7465 2074 6861 7420 6966 2073    Note that if s
-00018750: 696e 676c 655f 736c 6963 653d 5472 7565  ingle_slice=True
-00018760: 2c20 7468 6520 6365 6e74 726f 6964 2077  , the centroid w
-00018770: 696c 6c20 0a20 2020 2020 2020 2020 2020  ill .           
-00018780: 2061 6c77 6179 7320 6265 2072 6563 616c   always be recal
-00018790: 6375 6c61 7465 642e 0a0a 2020 2020 2020  culated...      
-000187a0: 2020 6279 5f73 6c69 6365 203a 2073 7472    by_slice : str
-000187b0: 2c20 6465 6661 756c 743d 4e6f 6e65 0a20  , default=None. 
-000187c0: 2020 2020 2020 2020 2020 2049 6620 6f6e             If on
-000187d0: 6520 6f66 2022 6c65 6674 222c 2022 7269  e of "left", "ri
-000187e0: 6768 7422 2c20 2275 6e69 6f6e 222c 2022  ght", "union", "
-000187f0: 696e 7465 7273 6563 7469 6f6e 222c 2063  intersection", c
-00018800: 616c 6375 6c61 7465 0a20 2020 2020 2020  alculate.       
-00018810: 2020 2020 2044 6963 6520 7363 6f72 6573       Dice scores
-00018820: 2073 6c69 6365 2062 7920 736c 6963 6520   slice by slice 
-00018830: 666f 7220 6561 6368 2073 6c69 6365 2063  for each slice c
-00018840: 6f6e 7461 696e 696e 670a 2020 2020 2020  ontaining.      
-00018850: 2020 2020 2020 7365 6c66 2061 6e64 2f6f        self and/o
-00018860: 7220 6f74 6865 723a 0a0a 2020 2020 2020  r other:..      
-00018870: 2020 2020 2020 2d20 226c 6566 7422 3a20        - "left": 
-00018880: 636f 6e73 6964 6572 206f 6e6c 7920 736c  consider only sl
-00018890: 6963 6573 2063 6f6e 7461 696e 696e 6720  ices containing 
-000188a0: 7365 6c66 3b0a 2020 2020 2020 2020 2020  self;.          
-000188b0: 2020 2d20 2272 6967 6874 223a 2063 6f6e    - "right": con
-000188c0: 7369 6465 7220 6f6e 6c79 2073 6c69 6365  sider only slice
-000188d0: 7320 636f 6e74 6169 6e69 6e67 206f 7468  s containing oth
-000188e0: 6572 3b0a 2020 2020 2020 2020 2020 2020  er;.            
-000188f0: 2d20 2275 6e69 6f6e 223a 2063 6f6e 7369  - "union": consi
-00018900: 6465 7220 736c 6963 6573 2063 6f6e 7461  der slices conta
-00018910: 696e 696e 6720 6569 7468 6572 206f 6620  ining either of 
-00018920: 7365 6c66 2061 6e64 206f 7468 6572 3b0a  self and other;.
-00018930: 2020 2020 2020 2020 2020 2020 2d20 2269              - "i
-00018940: 6e74 6572 7365 6374 696f 6e22 3a20 636f  ntersection": co
-00018950: 6e73 6964 6572 2073 6c69 6365 7320 636f  nsider slices co
-00018960: 6e74 6169 6e69 6e67 2062 6f74 6820 6f66  ntaining both of
-00018970: 2073 656c 6620 616e 6420 6f74 6865 722e   self and other.
-00018980: 0a0a 2020 2020 2020 2020 2020 2020 4966  ..            If
-00018990: 2073 6c69 6365 5f73 7461 7420 6973 204e   slice_stat is N
-000189a0: 6f6e 652c 2072 6574 7572 6e20 6120 6469  one, return a di
-000189b0: 6374 696f 6e61 7279 2077 6865 7265 206b  ctionary where k
-000189c0: 6579 7320 6172 650a 2020 2020 2020 2020  eys are.        
-000189d0: 2020 2020 736c 6963 6520 706f 7369 7469      slice positi
-000189e0: 6f6e 7320 616e 6420 7661 6c75 6573 2061  ons and values a
-000189f0: 7265 2074 6865 2063 616c 6375 6c61 7465  re the calculate
-00018a00: 6420 4469 6365 2073 636f 7265 732e 0a20  d Dice scores.. 
-00018a10: 2020 2020 2020 2020 2020 204f 7468 6572             Other
-00018a20: 7769 7365 2c20 7265 7475 726e 2066 6f72  wise, return for
-00018a30: 2074 6865 2063 616c 6375 6c61 7465 6420   the calculated 
-00018a40: 4469 6365 2073 636f 7265 7320 7468 6520  Dice scores the 
-00018a50: 7374 6174 6973 7469 630a 2020 2020 2020  statistic.      
-00018a60: 2020 2020 2020 7370 6563 6966 6965 6420        specified 
-00018a70: 6279 2073 6c69 6365 5f73 7461 742e 0a0a  by slice_stat...
-00018a80: 2020 2020 2020 2020 7661 6c75 655f 666f          value_fo
-00018a90: 725f 6e6f 6e65 203a 2066 6c6f 6174 2c20  r_none : float, 
-00018aa0: 6465 6661 756c 743d 4e6f 6e65 0a20 2020  default=None.   
-00018ab0: 2020 2020 2020 2020 2046 6f72 2073 696e           For sin
-00018ac0: 676c 655f 736c 6963 6520 616e 6420 6279  gle_slice and by
-00018ad0: 5f73 6c69 6365 2c20 7661 6c75 6520 746f  _slice, value to
-00018ae0: 2062 6520 7265 7475 726e 6564 2066 6f72   be returned for
-00018af0: 0a20 2020 2020 2020 2020 2020 2073 6c69  .            sli
-00018b00: 6365 7320 7768 6572 6520 4469 6365 2073  ces where Dice s
-00018b10: 636f 7265 2069 7320 756e 6465 7465 726d  core is undeterm
-00018b20: 696e 6564 2028 4e6f 6e65 292e 2020 466f  ined (None).  Fo
-00018b30: 7220 736c 6963 655f 7374 6174 2c0a 2020  r slice_stat,.  
-00018b40: 2020 2020 2020 2020 2020 7661 6c75 6520            value 
-00018b50: 746f 2073 7562 7374 6974 7574 6520 666f  to substitute fo
-00018b60: 7220 616e 7920 4e6f 6e65 2076 616c 7565  r any None value
-00018b70: 7320 616d 6f6e 6720 7468 6520 696e 7075  s among the inpu
-00018b80: 7473 0a20 2020 2020 2020 2020 2020 2066  ts.            f
-00018b90: 6f72 2063 616c 6375 6c61 7469 6e67 2073  or calculating s
-00018ba0: 6c69 6365 2d62 6173 6564 2073 7461 7469  lice-based stati
-00018bb0: 7374 6963 2e20 2049 6620 4e6f 6e65 2069  stic.  If None i
-00018bc0: 6e20 7468 6520 6c61 7474 6572 0a20 2020  n the latter.   
-00018bd0: 2020 2020 2020 2020 2063 6173 652c 204e           case, N
-00018be0: 6f6e 6520 7661 6c75 6573 2061 6d6f 6e67  one values among
-00018bf0: 2074 6865 2069 6e70 7574 7320 6172 6520   the inputs are 
-00018c00: 6f6d 6974 7465 642e 0a0a 2020 2020 2020  omitted...      
-00018c10: 2020 736c 6963 655f 7374 6174 203a 2073    slice_stat : s
-00018c20: 7472 2c20 6465 6661 756c 743d 4e6f 6e65  tr, default=None
-00018c30: 0a20 2020 2020 2020 2020 2020 2053 696e  .            Sin
-00018c40: 676c 652d 7661 7269 6162 6c65 2073 7461  gle-variable sta
-00018c50: 7469 7374 6963 2873 2920 746f 2062 6520  tistic(s) to be 
-00018c60: 7265 7475 726e 6564 2066 6f72 2073 6c69  returned for sli
-00018c70: 6365 2d62 792d 736c 6963 650a 2020 2020  ce-by-slice.    
-00018c80: 2020 2020 2020 2020 4469 6365 2073 636f          Dice sco
-00018c90: 7265 732e 2020 5468 6973 2073 686f 756c  res.  This shoul
-00018ca0: 6420 6265 2074 6865 206e 616d 6520 6f66  d be the name of
-00018cb0: 2074 6865 2066 756e 6374 696f 6e20 666f   the function fo
-00018cc0: 720a 2020 2020 2020 2020 2020 2020 6361  r.            ca
-00018cd0: 6c63 756c 6174 696f 6e20 6f66 2074 6865  lculation of the
-00018ce0: 2073 7461 7469 7374 6963 2873 2920 696e   statistic(s) in
-00018cf0: 2074 6865 2050 7974 686f 6e20 7374 6174   the Python stat
-00018d00: 6973 7469 6373 206d 6f64 756c 653a 0a0a  istics module:..
-00018d10: 2020 2020 2020 2020 2020 2020 6874 7470              http
-00018d20: 733a 2f2f 646f 6373 2e70 7974 686f 6e2e  s://docs.python.
-00018d30: 6f72 672f 332f 6c69 6272 6172 792f 7374  org/3/library/st
-00018d40: 6174 6973 7469 6373 2e68 746d 6c0a 0a20  atistics.html.. 
-00018d50: 2020 2020 2020 2020 2020 2041 7661 696c             Avail
-00018d60: 6162 6c65 206f 7074 696f 6e73 2069 6e63  able options inc
-00018d70: 6c75 6465 3a20 226d 6561 6e22 2c20 226d  lude: "mean", "m
-00018d80: 6564 6961 6e22 2c20 226d 6f64 6522 2c0a  edian", "mode",.
-00018d90: 2020 2020 2020 2020 2020 2020 2273 7464              "std
-00018da0: 6576 222c 2022 7175 616e 7469 6c65 7322  ev", "quantiles"
-00018db0: 2e20 2044 6973 7265 6761 7264 6564 2069  .  Disregarded i
-00018dc0: 6620 4e6f 6e65 2e0a 0a20 2020 2020 2020  f None...       
-00018dd0: 2020 2020 2049 6620 6279 5f73 6c69 6365       If by_slice
-00018de0: 2069 7320 4e6f 6e65 2061 6e64 2073 6c69   is None and sli
-00018df0: 6365 5f73 7461 7420 6973 2064 6966 6665  ce_stat is diffe
-00018e00: 7265 6e74 2066 726f 6d20 4e6f 6e65 2c0a  rent from None,.
-00018e10: 2020 2020 2020 2020 2020 2020 736b 7274              skrt
-00018e20: 2e63 6f72 652e 4465 6661 756c 7473 2829  .core.Defaults()
-00018e30: 2e62 795f 736c 6963 6520 6973 2075 7365  .by_slice is use
-00018e40: 6420 666f 7220 7468 6520 666f 726d 6572  d for the former
-00018e50: 2e0a 0a20 2020 2020 2020 2073 6c69 6365  ...        slice
-00018e60: 5f73 7461 745f 6b77 6172 6773 203a 2064  _stat_kwargs : d
-00018e70: 6963 742c 2064 6566 6175 6c74 3d4e 6f6e  ict, default=Non
-00018e80: 650a 2020 2020 2020 2020 2020 2020 4b65  e.            Ke
-00018e90: 7977 6f72 6420 6172 6775 6d65 6e74 7320  yword arguments 
-00018ea0: 746f 2062 6520 7061 7373 6564 2074 6f20  to be passed to 
-00018eb0: 6675 6e63 7469 6f6e 206f 6620 7374 6174  function of stat
-00018ec0: 6973 7469 6373 0a20 2020 2020 2020 2020  istics.         
-00018ed0: 2020 206d 6f64 756c 6520 666f 7220 6361     module for ca
-00018ee0: 6c63 756c 6174 696f 6e20 7265 6c61 7469  lculation relati
-00018ef0: 7665 2074 6f20 736c 6963 6520 7661 6c75  ve to slice valu
-00018f00: 6573 2e20 2046 6f72 2065 7861 6d70 6c65  es.  For example
-00018f10: 2c0a 2020 2020 2020 2020 2020 2020 6966  ,.            if
-00018f20: 2071 7561 6e74 696c 6573 2061 7265 2072   quantiles are r
-00018f30: 6571 7569 7265 6420 666f 7220 3130 2069  equired for 10 i
-00018f40: 6e74 6572 7661 6c73 2c20 7261 7468 6572  ntervals, rather
-00018f50: 2074 6861 6e20 666f 720a 2020 2020 2020   than for.      
-00018f60: 2020 2020 2020 7468 6520 6465 6661 756c        the defaul
-00018f70: 7420 6f66 2034 2c20 7468 6973 2063 616e  t of 4, this can
-00018f80: 2062 6520 7370 6563 6966 6965 6420 7573   be specified us
-00018f90: 696e 673a 0a0a 2020 2020 2020 2020 2020  ing:..          
-00018fa0: 2020 736c 6963 655f 7374 6174 5f6b 7761    slice_stat_kwa
-00018fb0: 7267 737b 226e 2220 3a20 3130 7d0a 0a20  rgs{"n" : 10}.. 
-00018fc0: 2020 2020 2020 2020 2020 2046 6f72 2061             For a
-00018fd0: 7661 696c 6162 6c65 206b 6579 776f 7264  vailable keyword
-00018fe0: 206f 7074 696f 6e73 2c20 7365 6520 646f   options, see do
-00018ff0: 6375 6d65 6e74 6174 696f 6e20 6f66 2073  cumentation of s
-00019000: 7461 7469 7374 6963 730a 2020 2020 2020  tatistics.      
-00019010: 2020 2020 2020 6d6f 6475 6c65 2061 743a        module at:
-00019020: 0a0a 2020 2020 2020 2020 2020 2020 6874  ..            ht
-00019030: 7470 733a 2f2f 646f 6373 2e70 7974 686f  tps://docs.pytho
-00019040: 6e2e 6f72 672f 332f 6c69 6272 6172 792f  n.org/3/library/
-00019050: 7374 6174 6973 7469 6373 2e68 746d 6c0a  statistics.html.
-00019060: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00019070: 2020 2020 6966 2073 6c69 6365 5f73 7461      if slice_sta
-00019080: 743a 0a20 2020 2020 2020 2020 2020 2072  t:.            r
-00019090: 6574 7572 6e20 7365 6c66 2e67 6574 5f73  eturn self.get_s
-000190a0: 6c69 6365 5f73 7461 7428 726f 692c 2022  lice_stat(roi, "
-000190b0: 6162 735f 6365 6e74 726f 6964 222c 2073  abs_centroid", s
-000190c0: 6c69 6365 5f73 7461 742c 0a20 2020 2020  lice_stat,.     
-000190d0: 2020 2020 2020 2020 2020 2020 2020 2062                 b
-000190e0: 795f 736c 6963 652c 2076 616c 7565 5f66  y_slice, value_f
-000190f0: 6f72 5f6e 6f6e 652c 2076 6965 772c 206d  or_none, view, m
-00019100: 6574 686f 642c 0a20 2020 2020 2020 2020  ethod,.         
-00019110: 2020 2020 2020 2020 2020 202a 2a28 736c             **(sl
-00019120: 6963 655f 7374 6174 5f6b 7761 7267 7320  ice_stat_kwargs 
-00019130: 6f72 207b 7d29 290a 0a20 2020 2020 2020  or {}))..       
-00019140: 2069 6620 6279 5f73 6c69 6365 3a0a 2020   if by_slice:.  
-00019150: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00019160: 2073 656c 662e 6765 745f 6d65 7472 6963   self.get_metric
-00019170: 5f62 795f 736c 6963 6528 726f 692c 2022  _by_slice(roi, "
-00019180: 6162 735f 6365 6e74 726f 6964 222c 2062  abs_centroid", b
-00019190: 795f 736c 6963 652c 0a20 2020 2020 2020  y_slice,.       
-000191a0: 2020 2020 2020 2020 2020 2020 2076 6965               vie
-000191b0: 772c 206d 6574 686f 6429 0a0a 2020 2020  w, method)..    
-000191c0: 2020 2020 2320 4966 2066 6c61 7474 656e      # If flatten
-000191d0: 696e 672c 206e 6565 6420 746f 2067 6574  ing, need to get
-000191e0: 2033 4420 6365 6e74 726f 6964 2076 6563   3D centroid vec
-000191f0: 746f 720a 2020 2020 2020 2020 6966 2066  tor.        if f
-00019200: 6c61 7474 656e 3a0a 2020 2020 2020 2020  latten:.        
-00019210: 2020 2020 7369 6e67 6c65 5f73 6c69 6365      single_slice
-00019220: 203d 2046 616c 7365 0a0a 2020 2020 2020   = False..      
-00019230: 2020 2320 4765 7420 6365 6e74 726f 6964    # Get centroid
-00019240: 2076 6563 746f 720a 2020 2020 2020 2020   vector.        
-00019250: 6365 6e74 726f 6964 203d 2073 656c 662e  centroid = self.
-00019260: 6765 745f 6365 6e74 726f 6964 5f64 6973  get_centroid_dis
-00019270: 7461 6e63 6528 0a20 2020 2020 2020 2020  tance(.         
-00019280: 2020 2072 6f69 2c20 0a20 2020 2020 2020     roi, .       
-00019290: 2020 2020 2076 6965 773d 7669 6577 2c20       view=view, 
-000192a0: 0a20 2020 2020 2020 2020 2020 2073 696e  .            sin
-000192b0: 676c 655f 736c 6963 653d 7369 6e67 6c65  gle_slice=single
-000192c0: 5f73 6c69 6365 2c0a 2020 2020 2020 2020  _slice,.        
-000192d0: 2020 2020 736c 3d73 6c2c 0a20 2020 2020      sl=sl,.     
-000192e0: 2020 2020 2020 2069 6478 3d69 6478 2c0a         idx=idx,.
-000192f0: 2020 2020 2020 2020 2020 2020 706f 733d              pos=
-00019300: 706f 732c 0a20 2020 2020 2020 2020 2020  pos,.           
-00019310: 2075 6e69 7473 3d75 6e69 7473 2c0a 2020   units=units,.  
-00019320: 2020 2020 2020 2020 2020 6d65 7468 6f64            method
-00019330: 3d6d 6574 686f 642c 0a20 2020 2020 2020  =method,.       
-00019340: 2020 2020 2066 6f72 6365 3d66 6f72 6365       force=force
-00019350: 2c0a 2020 2020 2020 2020 290a 0a20 2020  ,.        )..   
-00019360: 2020 2020 2023 2049 6620 6365 6e74 726f       # If centro
-00019370: 6964 2077 6173 6e27 7420 6176 6169 6c61  id wasn't availa
-00019380: 626c 652c 2072 6574 7572 6e20 4e6f 6e65  ble, return None
-00019390: 0a20 2020 2020 2020 2069 6620 4e6f 6e65  .        if None
-000193a0: 2069 6e20 6365 6e74 726f 6964 3a0a 2020   in centroid:.  
-000193b0: 2020 2020 2020 2020 2020 7265 7475 726e            return
-000193c0: 2076 616c 7565 5f66 6f72 5f6e 6f6e 650a   value_for_none.
-000193d0: 0a20 2020 2020 2020 2023 2049 6620 666c  .        # If fl
-000193e0: 6174 7465 6e69 6e67 2c20 7461 6b65 2032  attening, take 2
-000193f0: 2061 7865 7320 6f6e 6c79 0a20 2020 2020   axes only.     
-00019400: 2020 2069 6620 666c 6174 7465 6e3a 0a20     if flatten:. 
-00019410: 2020 2020 2020 2020 2020 2078 5f61 782c             x_ax,
-00019420: 2079 5f61 7820 3d20 736b 7274 2e69 6d61   y_ax = skrt.ima
-00019430: 6765 2e5f 706c 6f74 5f61 7865 735b 7669  ge._plot_axes[vi
-00019440: 6577 5d0a 2020 2020 2020 2020 2020 2020  ew].            
-00019450: 6365 6e74 726f 6964 203d 206e 702e 6172  centroid = np.ar
-00019460: 7261 7928 5b63 656e 7472 6f69 645b 785f  ray([centroid[x_
-00019470: 6178 5d2c 2063 656e 7472 6f69 645b 795f  ax], centroid[y_
-00019480: 6178 5d5d 290a 0a20 2020 2020 2020 2023  ax]])..        #
-00019490: 2052 6574 7572 6e20 6d61 676e 6974 7564   Return magnitud
-000194a0: 6520 6f66 2076 6563 746f 720a 2020 2020  e of vector.    
-000194b0: 2020 2020 7265 7475 726e 206e 702e 6c69      return np.li
-000194c0: 6e61 6c67 2e6e 6f72 6d28 6365 6e74 726f  nalg.norm(centro
-000194d0: 6964 290a 0a20 2020 2064 6566 2067 6574  id)..    def get
-000194e0: 5f64 6963 6528 0a20 2020 2020 2020 2073  _dice(.        s
-000194f0: 656c 662c 200a 2020 2020 2020 2020 6f74  elf, .        ot
-00019500: 6865 722c 200a 2020 2020 2020 2020 7369  her, .        si
-00019510: 6e67 6c65 5f73 6c69 6365 3d46 616c 7365  ngle_slice=False
-00019520: 2c0a 2020 2020 2020 2020 7669 6577 3d22  ,.        view="
-00019530: 782d 7922 2c20 0a20 2020 2020 2020 2073  x-y", .        s
-00019540: 6c3d 4e6f 6e65 2c20 0a20 2020 2020 2020  l=None, .       
-00019550: 2069 6478 3d4e 6f6e 652c 200a 2020 2020   idx=None, .    
-00019560: 2020 2020 706f 733d 4e6f 6e65 2c20 0a20      pos=None, . 
-00019570: 2020 2020 2020 206d 6574 686f 643d 4e6f         method=No
-00019580: 6e65 2c0a 2020 2020 2020 2020 666c 6174  ne,.        flat
-00019590: 7465 6e3d 4661 6c73 652c 0a20 2020 2020  ten=False,.     
-000195a0: 2020 2062 795f 736c 6963 653d 4e6f 6e65     by_slice=None
-000195b0: 2c0a 2020 2020 2020 2020 7661 6c75 655f  ,.        value_
-000195c0: 666f 725f 6e6f 6e65 3d4e 6f6e 652c 0a20  for_none=None,. 
-000195d0: 2020 2020 2020 2073 6c69 6365 5f73 7461         slice_sta
-000195e0: 743d 4e6f 6e65 2c0a 2020 2020 2020 2020  t=None,.        
-000195f0: 736c 6963 655f 7374 6174 5f6b 7761 7267  slice_stat_kwarg
-00019600: 733d 4e6f 6e65 2c0a 2020 2020 293a 0a20  s=None,.    ):. 
-00019610: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-00019620: 2020 2047 6574 2044 6963 6520 7363 6f72     Get Dice scor
-00019630: 6520 7769 7468 2072 6573 7065 6374 2074  e with respect t
-00019640: 6f20 616e 6f74 6865 7220 524f 492c 0a20  o another ROI,. 
-00019650: 2020 2020 2020 2067 6c6f 6261 6c6c 792c         globally,
-00019660: 206f 6e20 6120 7369 6e67 6c65 2073 6c69   on a single sli
-00019670: 6365 2c20 736c 6963 6520 6279 2073 6c69  ce, slice by sli
-00019680: 6365 2c20 6f72 2073 6c69 6365 2061 7665  ce, or slice ave
-00019690: 7261 6765 642e 0a0a 2020 2020 2020 2020  raged...        
-000196a0: 2a2a 5061 7261 6d65 7465 7273 3a2a 2a0a  **Parameters:**.
-000196b0: 2020 2020 2020 2020 0a20 2020 2020 2020          .       
-000196c0: 206f 7468 6572 203a 2052 4f49 0a20 2020   other : ROI.   
-000196d0: 2020 2020 2020 2020 204f 7468 6572 2052           Other R
-000196e0: 4f49 2074 6f20 636f 6d70 6172 6520 7769  OI to compare wi
-000196f0: 7468 2074 6869 7320 524f 492e 0a0a 2020  th this ROI...  
-00019700: 2020 2020 2020 7369 6e67 6c65 5f73 6c69        single_sli
-00019710: 6365 203a 2062 6f6f 6c2c 2064 6566 6175  ce : bool, defau
-00019720: 6c74 3d46 616c 7365 0a20 2020 2020 2020  lt=False.       
-00019730: 2020 2020 2049 6620 4661 6c73 652c 2074       If False, t
-00019740: 6865 2067 6c6f 6261 6c20 3344 2044 6963  he global 3D Dic
-00019750: 6520 7363 6f72 6520 6f66 2074 6865 2066  e score of the f
-00019760: 756c 6c20 524f 4973 2077 696c 6c20 6265  ull ROIs will be
-00019770: 2072 6574 7572 6e65 643b 0a20 2020 2020   returned;.     
-00019780: 2020 2020 2020 206f 7468 6572 7769 7365         otherwise
-00019790: 2c20 7468 6520 3244 2044 6963 6520 7363  , the 2D Dice sc
-000197a0: 6f72 6520 6f6e 2061 2073 696e 676c 6520  ore on a single 
-000197b0: 736c 6963 6520 7769 6c6c 2062 6520 7265  slice will be re
-000197c0: 7475 726e 6564 2e0a 0a20 2020 2020 2020  turned...       
-000197d0: 2076 6965 7720 3a20 7374 722c 2064 6566   view : str, def
-000197e0: 6175 6c74 3d22 782d 7922 0a20 2020 2020  ault="x-y".     
-000197f0: 2020 2020 2020 204f 7269 656e 7461 7469         Orientati
-00019800: 6f6e 206f 6620 736c 6963 6520 6f6e 2077  on of slice on w
-00019810: 6869 6368 2074 6f20 6765 7420 4469 6365  hich to get Dice
-00019820: 2073 636f 7265 2e20 4f6e 6c79 2075 7365   score. Only use
-00019830: 6420 6966 200a 2020 2020 2020 2020 2020  d if .          
-00019840: 2020 7369 6e67 6c65 5f73 6c69 6365 3d54    single_slice=T
-00019850: 7275 652e 2049 6620 7573 696e 672c 203c  rue. If using, <
-00019860: 6178 3e20 6d75 7374 2062 6520 616e 2061  ax> must be an a
-00019870: 7869 7320 7468 6174 206c 6965 7320 616c  xis that lies al
-00019880: 6f6e 670a 2020 2020 2020 2020 2020 2020  ong.            
-00019890: 7468 6520 736c 6963 6520 696e 2074 6869  the slice in thi
-000198a0: 7320 6f72 6965 6e74 6174 696f 6e2e 0a0a  s orientation...
-000198b0: 2020 2020 2020 2020 736c 203a 2069 6e74          sl : int
-000198c0: 2c20 6465 6661 756c 743d 4e6f 6e65 0a20  , default=None. 
-000198d0: 2020 2020 2020 2020 2020 2053 6c69 6365             Slice
-000198e0: 206e 756d 6265 722e 2049 6620 6e6f 6e65   number. If none
-000198f0: 206f 6620 3c73 6c3e 2c20 3c69 6478 3e20   of <sl>, <idx> 
-00019900: 6f72 203c 706f 733e 2061 7265 2073 7570  or <pos> are sup
-00019910: 706c 6965 6420 6275 740a 2020 2020 2020  plied but.      
-00019920: 2020 2020 2020 3c73 696e 676c 655f 736c        <single_sl
-00019930: 6963 653e 2069 7320 5472 7565 2c20 7468  ice> is True, th
-00019940: 6520 6365 6e74 7261 6c20 736c 6963 6520  e central slice 
-00019950: 6f66 2074 6869 7320 524f 4920 7769 6c6c  of this ROI will
-00019960: 2062 6520 7573 6564 2e0a 0a20 2020 2020   be used...     
-00019970: 2020 2069 6478 203a 2069 6e74 2c20 6465     idx : int, de
-00019980: 6661 756c 743d 4e6f 6e65 0a20 2020 2020  fault=None.     
-00019990: 2020 2020 2020 2041 7272 6179 2069 6e64         Array ind
-000199a0: 6578 206f 6620 736c 6963 652e 2049 6620  ex of slice. If 
-000199b0: 6e6f 6e65 206f 6620 3c73 6c3e 2c20 3c69  none of <sl>, <i
-000199c0: 6478 3e20 6f72 203c 706f 733e 2061 7265  dx> or <pos> are
-000199d0: 2073 7570 706c 6965 6420 6275 740a 2020   supplied but.  
-000199e0: 2020 2020 2020 2020 2020 3c73 696e 676c            <singl
-000199f0: 655f 736c 6963 653e 2069 7320 5472 7565  e_slice> is True
-00019a00: 2c20 7468 6520 6365 6e74 7261 6c20 736c  , the central sl
-00019a10: 6963 6520 6f66 2074 6869 7320 524f 4920  ice of this ROI 
-00019a20: 7769 6c6c 2062 6520 7573 6564 2e0a 0a20  will be used... 
-00019a30: 2020 2020 2020 2070 6f73 203a 2066 6c6f         pos : flo
-00019a40: 6174 2c20 6465 6661 756c 743d 4e6f 6e65  at, default=None
-00019a50: 0a20 2020 2020 2020 2020 2020 2053 6c69  .            Sli
-00019a60: 6365 2070 6f73 6974 696f 6e20 696e 206d  ce position in m
-00019a70: 6d2e 2049 6620 6e6f 6e65 206f 6620 3c73  m. If none of <s
-00019a80: 6c3e 2c20 3c69 6478 3e20 6f72 203c 706f  l>, <idx> or <po
-00019a90: 733e 2061 7265 2073 7570 706c 6965 6420  s> are supplied 
-00019aa0: 6275 740a 2020 2020 2020 2020 2020 2020  but.            
-00019ab0: 3c73 696e 676c 655f 736c 6963 653e 2069  <single_slice> i
-00019ac0: 7320 5472 7565 2c20 7468 6520 6365 6e74  s True, the cent
-00019ad0: 7261 6c20 736c 6963 6520 6f66 2074 6869  ral slice of thi
-00019ae0: 7320 524f 4920 7769 6c6c 2062 6520 7573  s ROI will be us
-00019af0: 6564 2e0a 0a20 2020 2020 2020 206d 6574  ed...        met
-00019b00: 686f 6420 3a20 7374 722c 2064 6566 6175  hod : str, defau
-00019b10: 6c74 3d4e 6f6e 650a 2020 2020 2020 2020  lt=None.        
-00019b20: 2020 2020 4d65 7468 6f64 2074 6f20 7573      Method to us
-00019b30: 6520 666f 7220 4469 6365 2073 636f 7265  e for Dice score
-00019b40: 2063 616c 6375 6c61 7469 6f6e 2e20 4361   calculation. Ca
-00019b50: 6e20 6265 3a20 0a20 2020 2020 2020 2020  n be: .         
-00019b60: 2020 2020 2020 202d 2022 636f 6e74 6f75         - "contou
-00019b70: 7222 3a20 6765 7420 696e 7465 7273 6563  r": get intersec
-00019b80: 7469 6f6e 7320 616e 6420 6172 6561 7320  tions and areas 
-00019b90: 6f66 2073 6861 7065 6c79 2063 6f6e 746f  of shapely conto
-00019ba0: 7572 732e 0a20 2020 2020 2020 2020 2020  urs..           
-00019bb0: 2020 2020 202d 2022 6d61 736b 223a 2063       - "mask": c
-00019bc0: 6f75 6e74 2069 6e74 6572 7365 6374 696e  ount intersectin
-00019bd0: 6720 766f 7865 6c73 2069 6e20 6269 6e61  g voxels in bina
-00019be0: 7279 206d 6173 6b73 2e0a 2020 2020 2020  ry masks..      
-00019bf0: 2020 2020 2020 2020 2020 2d20 4e6f 6e65            - None
-00019c00: 3a20 7573 6520 7468 6520 6d65 7468 6f64  : use the method
-00019c10: 2073 6574 2069 6e20 7365 6c66 2e64 6566   set in self.def
-00019c20: 6175 6c74 5f67 656f 6d5f 6d65 7468 6f64  ault_geom_method
-00019c30: 2e0a 0a20 2020 2020 2020 2066 6c61 7474  ...        flatt
-00019c40: 656e 203a 2062 6f6f 6c2c 2064 6566 6175  en : bool, defau
-00019c50: 6c74 3d46 616c 7365 0a20 2020 2020 2020  lt=False.       
-00019c60: 2020 2020 2049 6620 5472 7565 2c20 616c       If True, al
-00019c70: 6c20 736c 6963 6573 2077 696c 6c20 6265  l slices will be
-00019c80: 2066 6c61 7474 656e 6564 2069 6e20 7468   flattened in th
-00019c90: 6520 6769 7665 6e20 6f72 6965 6e74 6174  e given orientat
-00019ca0: 696f 6e20 616e 640a 2020 2020 2020 2020  ion and.        
-00019cb0: 2020 2020 7468 6520 4469 6365 2073 636f      the Dice sco
-00019cc0: 7265 206f 6620 7468 6520 666c 6174 7465  re of the flatte
-00019cd0: 6e65 6420 736c 6963 6573 2077 696c 6c20  ned slices will 
-00019ce0: 6265 2072 6574 7572 6e65 642e 204f 6e6c  be returned. Onl
-00019cf0: 7920 0a20 2020 2020 2020 2020 2020 2061  y .            a
-00019d00: 7661 696c 6162 6c65 2069 6620 6d65 7468  vailable if meth
-00019d10: 6f64 3d22 6d61 736b 222e 0a0a 2020 2020  od="mask"...    
-00019d20: 2020 2020 6279 5f73 6c69 6365 203a 2073      by_slice : s
-00019d30: 7472 2c20 6465 6661 756c 743d 4e6f 6e65  tr, default=None
-00019d40: 0a20 2020 2020 2020 2020 2020 2049 6620  .            If 
-00019d50: 6f6e 6520 6f66 2022 6c65 6674 222c 2022  one of "left", "
-00019d60: 7269 6768 7422 2c20 2275 6e69 6f6e 222c  right", "union",
-00019d70: 2022 696e 7465 7273 6563 7469 6f6e 222c   "intersection",
-00019d80: 2063 616c 6375 6c61 7465 0a20 2020 2020   calculate.     
-00019d90: 2020 2020 2020 2044 6963 6520 7363 6f72         Dice scor
-00019da0: 6573 2073 6c69 6365 2062 7920 736c 6963  es slice by slic
-00019db0: 6520 666f 7220 6561 6368 2073 6c69 6365  e for each slice
-00019dc0: 2063 6f6e 7461 696e 696e 670a 2020 2020   containing.    
-00019dd0: 2020 2020 2020 2020 7365 6c66 2061 6e64          self and
-00019de0: 2f6f 7220 6f74 6865 723a 0a0a 2020 2020  /or other:..    
-00019df0: 2020 2020 2020 2020 2d20 226c 6566 7422          - "left"
-00019e00: 3a20 636f 6e73 6964 6572 206f 6e6c 7920  : consider only 
-00019e10: 736c 6963 6573 2063 6f6e 7461 696e 696e  slices containin
-00019e20: 6720 7365 6c66 3b0a 2020 2020 2020 2020  g self;.        
-00019e30: 2020 2020 2d20 2272 6967 6874 223a 2063      - "right": c
-00019e40: 6f6e 7369 6465 7220 6f6e 6c79 2073 6c69  onsider only sli
-00019e50: 6365 7320 636f 6e74 6169 6e69 6e67 206f  ces containing o
-00019e60: 7468 6572 3b0a 2020 2020 2020 2020 2020  ther;.          
-00019e70: 2020 2d20 2275 6e69 6f6e 223a 2063 6f6e    - "union": con
-00019e80: 7369 6465 7220 736c 6963 6573 2063 6f6e  sider slices con
-00019e90: 7461 696e 696e 6720 6569 7468 6572 206f  taining either o
-00019ea0: 6620 7365 6c66 2061 6e64 206f 7468 6572  f self and other
-00019eb0: 3b0a 2020 2020 2020 2020 2020 2020 2d20  ;.            - 
-00019ec0: 2269 6e74 6572 7365 6374 696f 6e22 3a20  "intersection": 
-00019ed0: 636f 6e73 6964 6572 2073 6c69 6365 7320  consider slices 
-00019ee0: 636f 6e74 6169 6e69 6e67 2062 6f74 6820  containing both 
-00019ef0: 6f66 2073 656c 6620 616e 6420 6f74 6865  of self and othe
-00019f00: 722e 0a0a 2020 2020 2020 2020 2020 2020  r...            
-00019f10: 4966 2073 6c69 6365 5f73 7461 7420 6973  If slice_stat is
-00019f20: 204e 6f6e 652c 2072 6574 7572 6e20 6120   None, return a 
-00019f30: 6469 6374 696f 6e61 7279 2077 6865 7265  dictionary where
-00019f40: 206b 6579 7320 6172 650a 2020 2020 2020   keys are.      
-00019f50: 2020 2020 2020 736c 6963 6520 706f 7369        slice posi
-00019f60: 7469 6f6e 7320 616e 6420 7661 6c75 6573  tions and values
-00019f70: 2061 7265 2074 6865 2063 616c 6375 6c61   are the calcula
-00019f80: 7465 6420 4469 6365 2073 636f 7265 732e  ted Dice scores.
-00019f90: 0a20 2020 2020 2020 2020 2020 204f 7468  .            Oth
-00019fa0: 6572 7769 7365 2c20 7265 7475 726e 2066  erwise, return f
-00019fb0: 6f72 2074 6865 2063 616c 6375 6c61 7465  or the calculate
-00019fc0: 6420 4469 6365 2073 636f 7265 7320 7468  d Dice scores th
-00019fd0: 6520 7374 6174 6973 7469 630a 2020 2020  e statistic.    
-00019fe0: 2020 2020 2020 2020 7370 6563 6966 6965          specifie
-00019ff0: 6420 6279 2073 6c69 6365 5f73 7461 742e  d by slice_stat.
-0001a000: 0a0a 2020 2020 2020 2020 7661 6c75 655f  ..        value_
-0001a010: 666f 725f 6e6f 6e65 203a 2066 6c6f 6174  for_none : float
-0001a020: 2c20 6465 6661 756c 743d 4e6f 6e65 0a20  , default=None. 
-0001a030: 2020 2020 2020 2020 2020 2046 6f72 2073             For s
-0001a040: 696e 676c 655f 736c 6963 6520 616e 6420  ingle_slice and 
-0001a050: 6279 5f73 6c69 6365 2c20 7661 6c75 6520  by_slice, value 
-0001a060: 746f 2062 6520 7265 7475 726e 6564 2066  to be returned f
-0001a070: 6f72 0a20 2020 2020 2020 2020 2020 2073  or.            s
-0001a080: 6c69 6365 7320 7768 6572 6520 4469 6365  lices where Dice
-0001a090: 2073 636f 7265 2069 7320 756e 6465 7465   score is undete
-0001a0a0: 726d 696e 6564 2028 4e6f 6e65 292e 2020  rmined (None).  
-0001a0b0: 466f 7220 736c 6963 655f 7374 6174 2c0a  For slice_stat,.
-0001a0c0: 2020 2020 2020 2020 2020 2020 7661 6c75              valu
-0001a0d0: 6520 746f 2073 7562 7374 6974 7574 6520  e to substitute 
-0001a0e0: 666f 7220 616e 7920 4e6f 6e65 2076 616c  for any None val
-0001a0f0: 7565 7320 616d 6f6e 6720 7468 6520 696e  ues among the in
-0001a100: 7075 7473 0a20 2020 2020 2020 2020 2020  puts.           
-0001a110: 2066 6f72 2063 616c 6375 6c61 7469 6e67   for calculating
-0001a120: 2073 6c69 6365 2d62 6173 6564 2073 7461   slice-based sta
-0001a130: 7469 7374 6963 2e20 2049 6620 4e6f 6e65  tistic.  If None
-0001a140: 2069 6e20 7468 6520 6c61 7474 6572 0a20   in the latter. 
-0001a150: 2020 2020 2020 2020 2020 2063 6173 652c             case,
-0001a160: 204e 6f6e 6520 7661 6c75 6573 2061 6d6f   None values amo
-0001a170: 6e67 2074 6865 2069 6e70 7574 7320 6172  ng the inputs ar
-0001a180: 6520 6f6d 6974 7465 642e 0a0a 2020 2020  e omitted...    
-0001a190: 2020 2020 736c 6963 655f 7374 6174 203a      slice_stat :
-0001a1a0: 2073 7472 2c20 6465 6661 756c 743d 4e6f   str, default=No
-0001a1b0: 6e65 0a20 2020 2020 2020 2020 2020 2053  ne.            S
-0001a1c0: 696e 676c 652d 7661 7269 6162 6c65 2073  ingle-variable s
-0001a1d0: 7461 7469 7374 6963 2873 2920 746f 2062  tatistic(s) to b
-0001a1e0: 6520 7265 7475 726e 6564 2066 6f72 2073  e returned for s
-0001a1f0: 6c69 6365 2d62 792d 736c 6963 650a 2020  lice-by-slice.  
-0001a200: 2020 2020 2020 2020 2020 4469 6365 2073            Dice s
-0001a210: 636f 7265 732e 2020 5468 6973 2073 686f  cores.  This sho
-0001a220: 756c 6420 6265 2074 6865 206e 616d 6520  uld be the name 
-0001a230: 6f66 2074 6865 2066 756e 6374 696f 6e20  of the function 
-0001a240: 666f 720a 2020 2020 2020 2020 2020 2020  for.            
-0001a250: 6361 6c63 756c 6174 696f 6e20 6f66 2074  calculation of t
-0001a260: 6865 2073 7461 7469 7374 6963 2873 2920  he statistic(s) 
-0001a270: 696e 2074 6865 2050 7974 686f 6e20 7374  in the Python st
-0001a280: 6174 6973 7469 6373 206d 6f64 756c 653a  atistics module:
-0001a290: 0a0a 2020 2020 2020 2020 2020 2020 6874  ..            ht
-0001a2a0: 7470 733a 2f2f 646f 6373 2e70 7974 686f  tps://docs.pytho
-0001a2b0: 6e2e 6f72 672f 332f 6c69 6272 6172 792f  n.org/3/library/
-0001a2c0: 7374 6174 6973 7469 6373 2e68 746d 6c0a  statistics.html.
-0001a2d0: 0a20 2020 2020 2020 2020 2020 2041 7661  .            Ava
-0001a2e0: 696c 6162 6c65 206f 7074 696f 6e73 2069  ilable options i
-0001a2f0: 6e63 6c75 6465 3a20 226d 6561 6e22 2c20  nclude: "mean", 
-0001a300: 226d 6564 6961 6e22 2c20 226d 6f64 6522  "median", "mode"
-0001a310: 2c0a 2020 2020 2020 2020 2020 2020 2273  ,.            "s
-0001a320: 7464 6576 222c 2022 7175 616e 7469 6c65  tdev", "quantile
-0001a330: 7322 2e20 2044 6973 7265 6761 7264 6564  s".  Disregarded
-0001a340: 2069 6620 4e6f 6e65 2e0a 0a20 2020 2020   if None...     
-0001a350: 2020 2020 2020 2049 6620 6279 5f73 6c69         If by_sli
-0001a360: 6365 2069 7320 4e6f 6e65 2061 6e64 2073  ce is None and s
-0001a370: 6c69 6365 5f73 7461 7420 6973 2064 6966  lice_stat is dif
-0001a380: 6665 7265 6e74 2066 726f 6d20 4e6f 6e65  ferent from None
-0001a390: 2c0a 2020 2020 2020 2020 2020 2020 736b  ,.            sk
-0001a3a0: 7274 2e63 6f72 652e 4465 6661 756c 7473  rt.core.Defaults
-0001a3b0: 2829 2e62 795f 736c 6963 6520 6973 2075  ().by_slice is u
-0001a3c0: 7365 6420 666f 7220 7468 6520 666f 726d  sed for the form
-0001a3d0: 6572 2e0a 0a20 2020 2020 2020 2073 6c69  er...        sli
-0001a3e0: 6365 5f73 7461 745f 6b77 6172 6773 203a  ce_stat_kwargs :
-0001a3f0: 2064 6963 742c 2064 6566 6175 6c74 3d4e   dict, default=N
-0001a400: 6f6e 650a 2020 2020 2020 2020 2020 2020  one.            
-0001a410: 4b65 7977 6f72 6420 6172 6775 6d65 6e74  Keyword argument
-0001a420: 7320 746f 2062 6520 7061 7373 6564 2074  s to be passed t
-0001a430: 6f20 6675 6e63 7469 6f6e 206f 6620 7374  o function of st
-0001a440: 6174 6973 7469 6373 0a20 2020 2020 2020  atistics.       
-0001a450: 2020 2020 206d 6f64 756c 6520 666f 7220       module for 
-0001a460: 6361 6c63 756c 6174 696f 6e20 7265 6c61  calculation rela
-0001a470: 7469 7665 2074 6f20 736c 6963 6520 7661  tive to slice va
-0001a480: 6c75 6573 2e20 2046 6f72 2065 7861 6d70  lues.  For examp
-0001a490: 6c65 2c0a 2020 2020 2020 2020 2020 2020  le,.            
-0001a4a0: 6966 2071 7561 6e74 696c 6573 2061 7265  if quantiles are
-0001a4b0: 2072 6571 7569 7265 6420 666f 7220 3130   required for 10
-0001a4c0: 2069 6e74 6572 7661 6c73 2c20 7261 7468   intervals, rath
-0001a4d0: 6572 2074 6861 6e20 666f 720a 2020 2020  er than for.    
-0001a4e0: 2020 2020 2020 2020 7468 6520 6465 6661          the defa
-0001a4f0: 756c 7420 6f66 2034 2c20 7468 6973 2063  ult of 4, this c
-0001a500: 616e 2062 6520 7370 6563 6966 6965 6420  an be specified 
-0001a510: 7573 696e 673a 0a0a 2020 2020 2020 2020  using:..        
-0001a520: 2020 2020 736c 6963 655f 7374 6174 5f6b      slice_stat_k
-0001a530: 7761 7267 737b 226e 2220 3a20 3130 7d0a  wargs{"n" : 10}.
-0001a540: 0a20 2020 2020 2020 2020 2020 2046 6f72  .            For
-0001a550: 2061 7661 696c 6162 6c65 206b 6579 776f   available keywo
-0001a560: 7264 206f 7074 696f 6e73 2c20 7365 6520  rd options, see 
-0001a570: 646f 6375 6d65 6e74 6174 696f 6e20 6f66  documentation of
-0001a580: 2073 7461 7469 7374 6963 730a 2020 2020   statistics.    
-0001a590: 2020 2020 2020 2020 6d6f 6475 6c65 2061          module a
-0001a5a0: 743a 0a0a 2020 2020 2020 2020 2020 2020  t:..            
-0001a5b0: 6874 7470 733a 2f2f 646f 6373 2e70 7974  https://docs.pyt
-0001a5c0: 686f 6e2e 6f72 672f 332f 6c69 6272 6172  hon.org/3/librar
-0001a5d0: 792f 7374 6174 6973 7469 6373 2e68 746d  y/statistics.htm
-0001a5e0: 6c0a 2020 2020 2020 2020 2222 220a 2020  l.        """.  
-0001a5f0: 2020 2020 2020 6966 2073 6c69 6365 5f73        if slice_s
-0001a600: 7461 743a 0a20 2020 2020 2020 2020 2020  tat:.           
-0001a610: 2072 6574 7572 6e20 7365 6c66 2e67 6574   return self.get
-0001a620: 5f73 6c69 6365 5f73 7461 7428 6f74 6865  _slice_stat(othe
-0001a630: 722c 2022 6469 6365 222c 2073 6c69 6365  r, "dice", slice
-0001a640: 5f73 7461 742c 2062 795f 736c 6963 652c  _stat, by_slice,
-0001a650: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001a660: 2020 2020 2076 616c 7565 5f66 6f72 5f6e       value_for_n
-0001a670: 6f6e 652c 2076 6965 772c 206d 6574 686f  one, view, metho
-0001a680: 642c 202a 2a28 736c 6963 655f 7374 6174  d, **(slice_stat
-0001a690: 5f6b 7761 7267 7320 6f72 207b 7d29 290a  _kwargs or {})).
-0001a6a0: 0a20 2020 2020 2020 2069 6620 6279 5f73  .        if by_s
-0001a6b0: 6c69 6365 3a0a 2020 2020 2020 2020 2020  lice:.          
-0001a6c0: 2020 7265 7475 726e 2073 656c 662e 6765    return self.ge
-0001a6d0: 745f 6d65 7472 6963 5f62 795f 736c 6963  t_metric_by_slic
-0001a6e0: 6528 6f74 6865 722c 2022 6469 6365 222c  e(other, "dice",
-0001a6f0: 2062 795f 736c 6963 652c 0a20 2020 2020   by_slice,.     
-0001a700: 2020 2020 2020 2020 2020 2020 2020 2076                 v
-0001a710: 6965 772c 206d 6574 686f 6429 0a0a 2020  iew, method)..  
-0001a720: 2020 2020 2020 696e 7465 7273 6563 7469        intersecti
-0001a730: 6f6e 2c20 756e 696f 6e2c 206d 6561 6e5f  on, union, mean_
-0001a740: 7369 7a65 203d 2073 656c 662e 6765 745f  size = self.get_
-0001a750: 696e 7465 7273 6563 7469 6f6e 5f75 6e69  intersection_uni
-0001a760: 6f6e 5f73 697a 6528 0a20 2020 2020 2020  on_size(.       
-0001a770: 2020 2020 2020 2020 206f 7468 6572 2c20           other, 
-0001a780: 7369 6e67 6c65 5f73 6c69 6365 2c20 7669  single_slice, vi
-0001a790: 6577 2c20 736c 2c20 6964 782c 2070 6f73  ew, sl, idx, pos
-0001a7a0: 2c20 6d65 7468 6f64 2c20 666c 6174 7465  , method, flatte
-0001a7b0: 6e29 0a0a 2020 2020 2020 2020 7265 7475  n)..        retu
-0001a7c0: 726e 2028 696e 7465 7273 6563 7469 6f6e  rn (intersection
-0001a7d0: 202f 206d 6561 6e5f 7369 7a65 2069 6620   / mean_size if 
-0001a7e0: 6d65 616e 5f73 697a 6520 656c 7365 2076  mean_size else v
-0001a7f0: 616c 7565 5f66 6f72 5f6e 6f6e 6529 0a0a  alue_for_none)..
-0001a800: 2020 2020 6465 6620 6765 745f 6a61 6363      def get_jacc
-0001a810: 6172 6428 0a20 2020 2020 2020 2073 656c  ard(.        sel
-0001a820: 662c 200a 2020 2020 2020 2020 6f74 6865  f, .        othe
-0001a830: 722c 200a 2020 2020 2020 2020 7369 6e67  r, .        sing
-0001a840: 6c65 5f73 6c69 6365 3d46 616c 7365 2c0a  le_slice=False,.
-0001a850: 2020 2020 2020 2020 7669 6577 3d22 782d          view="x-
-0001a860: 7922 2c20 0a20 2020 2020 2020 2073 6c3d  y", .        sl=
-0001a870: 4e6f 6e65 2c20 0a20 2020 2020 2020 2069  None, .        i
-0001a880: 6478 3d4e 6f6e 652c 200a 2020 2020 2020  dx=None, .      
-0001a890: 2020 706f 733d 4e6f 6e65 2c20 0a20 2020    pos=None, .   
-0001a8a0: 2020 2020 206d 6574 686f 643d 4e6f 6e65       method=None
-0001a8b0: 2c0a 2020 2020 2020 2020 666c 6174 7465  ,.        flatte
-0001a8c0: 6e3d 4661 6c73 652c 0a20 2020 2020 2020  n=False,.       
-0001a8d0: 2062 795f 736c 6963 653d 4e6f 6e65 2c0a   by_slice=None,.
-0001a8e0: 2020 2020 2020 2020 7661 6c75 655f 666f          value_fo
-0001a8f0: 725f 6e6f 6e65 3d4e 6f6e 652c 0a20 2020  r_none=None,.   
-0001a900: 2020 2020 2073 6c69 6365 5f73 7461 743d       slice_stat=
-0001a910: 4e6f 6e65 2c0a 2020 2020 2020 2020 736c  None,.        sl
-0001a920: 6963 655f 7374 6174 5f6b 7761 7267 733d  ice_stat_kwargs=
-0001a930: 4e6f 6e65 2c0a 2020 2020 293a 0a20 2020  None,.    ):.   
-0001a940: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-0001a950: 2047 6574 204a 6163 6361 7264 2069 6e64   Get Jaccard ind
-0001a960: 6578 2077 6974 6820 7265 7370 6563 7420  ex with respect 
-0001a970: 746f 2061 6e6f 7468 6572 2052 4f49 2e0a  to another ROI..
-0001a980: 0a20 2020 2020 2020 2054 6865 204a 6163  .        The Jac
-0001a990: 6361 7264 2069 6e64 6578 206d 6179 2062  card index may b
-0001a9a0: 6520 6f62 7461 696e 6564 2065 6974 6865  e obtained eithe
-0001a9b0: 7220 676c 6f62 616c 6c79 206f 7220 6f6e  r globally or on
-0001a9c0: 2061 200a 2020 2020 2020 2020 7369 6e67   a .        sing
-0001a9d0: 6c65 2073 6c69 6365 2e0a 0a20 2020 2020  le slice...     
-0001a9e0: 2020 202a 2a50 6172 616d 6574 6572 733a     **Parameters:
-0001a9f0: 2a2a 0a20 2020 2020 2020 200a 2020 2020  **.        .    
-0001aa00: 2020 2020 6f74 6865 7220 3a20 524f 490a      other : ROI.
-0001aa10: 2020 2020 2020 2020 2020 2020 4f74 6865              Othe
-0001aa20: 7220 524f 4920 746f 2063 6f6d 7061 7265  r ROI to compare
-0001aa30: 2077 6974 6820 7468 6973 2052 4f49 2e0a   with this ROI..
-0001aa40: 0a20 2020 2020 2020 2073 696e 676c 655f  .        single_
-0001aa50: 736c 6963 6520 3a20 626f 6f6c 2c20 6465  slice : bool, de
-0001aa60: 6661 756c 743d 4661 6c73 650a 2020 2020  fault=False.    
-0001aa70: 2020 2020 2020 2020 4966 2046 616c 7365          If False
-0001aa80: 2c20 7468 6520 676c 6f62 616c 2033 4420  , the global 3D 
-0001aa90: 4a61 6363 6172 6420 696e 6465 7820 6f66  Jaccard index of
-0001aaa0: 2074 6865 2066 756c 6c20 524f 4973 2077   the full ROIs w
-0001aab0: 696c 6c20 6265 0a20 2020 2020 2020 2020  ill be.         
-0001aac0: 2020 2072 6574 7572 6e65 643b 206f 7468     returned; oth
-0001aad0: 6572 7769 7365 2c20 7468 6520 3244 204a  erwise, the 2D J
-0001aae0: 6163 6361 7264 2069 6e64 6578 206f 6e20  accard index on 
-0001aaf0: 6120 7369 6e67 6c65 2073 6c69 6365 0a20  a single slice. 
-0001ab00: 2020 2020 2020 2020 2020 2077 696c 6c20             will 
-0001ab10: 6265 2072 6574 7572 6e65 642e 0a0a 2020  be returned...  
-0001ab20: 2020 2020 2020 7669 6577 203a 2073 7472        view : str
-0001ab30: 2c20 6465 6661 756c 743d 2278 2d79 220a  , default="x-y".
-0001ab40: 2020 2020 2020 2020 2020 2020 4f72 6965              Orie
-0001ab50: 6e74 6174 696f 6e20 6f66 2073 6c69 6365  ntation of slice
-0001ab60: 206f 6e20 7768 6963 6820 746f 2067 6574   on which to get
-0001ab70: 204a 6163 6361 7264 2069 6e64 6578 2e20   Jaccard index. 
-0001ab80: 4f6e 6c79 2075 7365 6420 6966 200a 2020  Only used if .  
-0001ab90: 2020 2020 2020 2020 2020 7369 6e67 6c65            single
-0001aba0: 5f73 6c69 6365 3d54 7275 652e 2049 6620  _slice=True. If 
-0001abb0: 7573 696e 672c 203c 6178 3e20 6d75 7374  using, <ax> must
-0001abc0: 2062 6520 616e 2061 7869 7320 7468 6174   be an axis that
-0001abd0: 206c 6965 7320 616c 6f6e 670a 2020 2020   lies along.    
-0001abe0: 2020 2020 2020 2020 7468 6520 736c 6963          the slic
-0001abf0: 6520 696e 2074 6869 7320 6f72 6965 6e74  e in this orient
-0001ac00: 6174 696f 6e2e 0a0a 2020 2020 2020 2020  ation...        
-0001ac10: 736c 203a 2069 6e74 2c20 6465 6661 756c  sl : int, defaul
-0001ac20: 743d 4e6f 6e65 0a20 2020 2020 2020 2020  t=None.         
-0001ac30: 2020 2053 6c69 6365 206e 756d 6265 722e     Slice number.
-0001ac40: 2049 6620 6e6f 6e65 206f 6620 3c73 6c3e   If none of <sl>
-0001ac50: 2c20 3c69 6478 3e20 6f72 203c 706f 733e  , <idx> or <pos>
-0001ac60: 2061 7265 2073 7570 706c 6965 6420 6275   are supplied bu
-0001ac70: 740a 2020 2020 2020 2020 2020 2020 3c73  t.            <s
-0001ac80: 696e 676c 655f 736c 6963 653e 2069 7320  ingle_slice> is 
-0001ac90: 5472 7565 2c20 7468 6520 6365 6e74 7261  True, the centra
-0001aca0: 6c20 736c 6963 6520 6f66 2074 6869 7320  l slice of this 
-0001acb0: 524f 4920 7769 6c6c 2062 6520 7573 6564  ROI will be used
-0001acc0: 2e0a 0a20 2020 2020 2020 2069 6478 203a  ...        idx :
-0001acd0: 2069 6e74 2c20 6465 6661 756c 743d 4e6f   int, default=No
-0001ace0: 6e65 0a20 2020 2020 2020 2020 2020 2041  ne.            A
-0001acf0: 7272 6179 2069 6e64 6578 206f 6620 736c  rray index of sl
-0001ad00: 6963 652e 2049 6620 6e6f 6e65 206f 6620  ice. If none of 
-0001ad10: 3c73 6c3e 2c20 3c69 6478 3e20 6f72 203c  <sl>, <idx> or <
-0001ad20: 706f 733e 2061 7265 2073 7570 706c 6965  pos> are supplie
-0001ad30: 6420 6275 740a 2020 2020 2020 2020 2020  d but.          
-0001ad40: 2020 3c73 696e 676c 655f 736c 6963 653e    <single_slice>
-0001ad50: 2069 7320 5472 7565 2c20 7468 6520 6365   is True, the ce
-0001ad60: 6e74 7261 6c20 736c 6963 6520 6f66 2074  ntral slice of t
-0001ad70: 6869 7320 524f 4920 7769 6c6c 2062 6520  his ROI will be 
-0001ad80: 7573 6564 2e0a 0a20 2020 2020 2020 2070  used...        p
-0001ad90: 6f73 203a 2066 6c6f 6174 2c20 6465 6661  os : float, defa
-0001ada0: 756c 743d 4e6f 6e65 0a20 2020 2020 2020  ult=None.       
-0001adb0: 2020 2020 2053 6c69 6365 2070 6f73 6974       Slice posit
-0001adc0: 696f 6e20 696e 206d 6d2e 2049 6620 6e6f  ion in mm. If no
-0001add0: 6e65 206f 6620 3c73 6c3e 2c20 3c69 6478  ne of <sl>, <idx
-0001ade0: 3e20 6f72 203c 706f 733e 2061 7265 2073  > or <pos> are s
-0001adf0: 7570 706c 6965 6420 6275 740a 2020 2020  upplied but.    
-0001ae00: 2020 2020 2020 2020 3c73 696e 676c 655f          <single_
-0001ae10: 736c 6963 653e 2069 7320 5472 7565 2c20  slice> is True, 
-0001ae20: 7468 6520 6365 6e74 7261 6c20 736c 6963  the central slic
-0001ae30: 6520 6f66 2074 6869 7320 524f 4920 7769  e of this ROI wi
-0001ae40: 6c6c 2062 6520 7573 6564 2e0a 0a20 2020  ll be used...   
-0001ae50: 2020 2020 206d 6574 686f 6420 3a20 7374       method : st
-0001ae60: 722c 2064 6566 6175 6c74 3d4e 6f6e 650a  r, default=None.
-0001ae70: 2020 2020 2020 2020 2020 2020 4d65 7468              Meth
-0001ae80: 6f64 2074 6f20 7573 6520 666f 7220 4469  od to use for Di
-0001ae90: 6365 2073 636f 7265 2063 616c 6375 6c61  ce score calcula
-0001aea0: 7469 6f6e 2e20 4361 6e20 6265 3a20 0a20  tion. Can be: . 
-0001aeb0: 2020 2020 2020 2020 2020 2020 2020 202d                 -
-0001aec0: 2022 636f 6e74 6f75 7222 3a20 6765 7420   "contour": get 
-0001aed0: 696e 7465 7273 6563 7469 6f6e 7320 616e  intersections an
-0001aee0: 6420 6172 6561 7320 6f66 2073 6861 7065  d areas of shape
-0001aef0: 6c79 2063 6f6e 746f 7572 732e 0a20 2020  ly contours..   
-0001af00: 2020 2020 2020 2020 2020 2020 202d 2022               - "
-0001af10: 6d61 736b 223a 2063 6f75 6e74 2069 6e74  mask": count int
-0001af20: 6572 7365 6374 696e 6720 766f 7865 6c73  ersecting voxels
-0001af30: 2069 6e20 6269 6e61 7279 206d 6173 6b73   in binary masks
-0001af40: 2e0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0001af50: 2020 2d20 4e6f 6e65 3a20 7573 6520 7468    - None: use th
-0001af60: 6520 6d65 7468 6f64 2073 6574 2069 6e20  e method set in 
-0001af70: 7365 6c66 2e64 6566 6175 6c74 5f67 656f  self.default_geo
-0001af80: 6d5f 6d65 7468 6f64 2e0a 0a20 2020 2020  m_method...     
-0001af90: 2020 2066 6c61 7474 656e 203a 2062 6f6f     flatten : boo
-0001afa0: 6c2c 2064 6566 6175 6c74 3d46 616c 7365  l, default=False
-0001afb0: 0a20 2020 2020 2020 2020 2020 2049 6620  .            If 
-0001afc0: 5472 7565 2c20 616c 6c20 736c 6963 6573  True, all slices
-0001afd0: 2077 696c 6c20 6265 2066 6c61 7474 656e   will be flatten
-0001afe0: 6564 2069 6e20 7468 6520 6769 7665 6e20  ed in the given 
-0001aff0: 6f72 6965 6e74 6174 696f 6e20 616e 640a  orientation and.
-0001b000: 2020 2020 2020 2020 2020 2020 7468 6520              the 
-0001b010: 4469 6365 2073 636f 7265 206f 6620 7468  Dice score of th
-0001b020: 6520 666c 6174 7465 6e65 6420 736c 6963  e flattened slic
-0001b030: 6573 2077 696c 6c20 6265 2072 6574 7572  es will be retur
-0001b040: 6e65 642e 204f 6e6c 7920 0a20 2020 2020  ned. Only .     
-0001b050: 2020 2020 2020 2061 7661 696c 6162 6c65         available
-0001b060: 2069 6620 6d65 7468 6f64 3d22 6d61 736b   if method="mask
-0001b070: 222e 0a0a 2020 2020 2020 2020 6279 5f73  "...        by_s
-0001b080: 6c69 6365 203a 2073 7472 2c20 6465 6661  lice : str, defa
-0001b090: 756c 743d 4e6f 6e65 0a20 2020 2020 2020  ult=None.       
-0001b0a0: 2020 2020 2049 6620 6f6e 6520 6f66 2022       If one of "
-0001b0b0: 6c65 6674 222c 2022 7269 6768 7422 2c20  left", "right", 
-0001b0c0: 2275 6e69 6f6e 222c 2022 696e 7465 7273  "union", "inters
-0001b0d0: 6563 7469 6f6e 222c 2063 616c 6375 6c61  ection", calcula
-0001b0e0: 7465 0a20 2020 2020 2020 2020 2020 2044  te.            D
-0001b0f0: 6963 6520 7363 6f72 6573 2073 6c69 6365  ice scores slice
-0001b100: 2062 7920 736c 6963 6520 666f 7220 6561   by slice for ea
-0001b110: 6368 2073 6c69 6365 2063 6f6e 7461 696e  ch slice contain
-0001b120: 696e 670a 2020 2020 2020 2020 2020 2020  ing.            
-0001b130: 7365 6c66 2061 6e64 2f6f 7220 6f74 6865  self and/or othe
-0001b140: 723a 0a0a 2020 2020 2020 2020 2020 2020  r:..            
-0001b150: 2d20 226c 6566 7422 3a20 636f 6e73 6964  - "left": consid
-0001b160: 6572 206f 6e6c 7920 736c 6963 6573 2063  er only slices c
-0001b170: 6f6e 7461 696e 696e 6720 7365 6c66 3b0a  ontaining self;.
-0001b180: 2020 2020 2020 2020 2020 2020 2d20 2272              - "r
-0001b190: 6967 6874 223a 2063 6f6e 7369 6465 7220  ight": consider 
-0001b1a0: 6f6e 6c79 2073 6c69 6365 7320 636f 6e74  only slices cont
-0001b1b0: 6169 6e69 6e67 206f 7468 6572 3b0a 2020  aining other;.  
-0001b1c0: 2020 2020 2020 2020 2020 2d20 2275 6e69            - "uni
-0001b1d0: 6f6e 223a 2063 6f6e 7369 6465 7220 736c  on": consider sl
-0001b1e0: 6963 6573 2063 6f6e 7461 696e 696e 6720  ices containing 
-0001b1f0: 6569 7468 6572 206f 6620 7365 6c66 2061  either of self a
-0001b200: 6e64 206f 7468 6572 3b0a 2020 2020 2020  nd other;.      
-0001b210: 2020 2020 2020 2d20 2269 6e74 6572 7365        - "interse
-0001b220: 6374 696f 6e22 3a20 636f 6e73 6964 6572  ction": consider
-0001b230: 2073 6c69 6365 7320 636f 6e74 6169 6e69   slices containi
-0001b240: 6e67 2062 6f74 6820 6f66 2073 656c 6620  ng both of self 
-0001b250: 616e 6420 6f74 6865 722e 0a0a 2020 2020  and other...    
-0001b260: 2020 2020 2020 2020 4966 2073 6c69 6365          If slice
-0001b270: 5f73 7461 7420 6973 204e 6f6e 652c 2072  _stat is None, r
-0001b280: 6574 7572 6e20 6120 6469 6374 696f 6e61  eturn a dictiona
-0001b290: 7279 2077 6865 7265 206b 6579 7320 6172  ry where keys ar
-0001b2a0: 650a 2020 2020 2020 2020 2020 2020 736c  e.            sl
-0001b2b0: 6963 6520 706f 7369 7469 6f6e 7320 616e  ice positions an
-0001b2c0: 6420 7661 6c75 6573 2061 7265 2074 6865  d values are the
-0001b2d0: 2063 616c 6375 6c61 7465 6420 4a61 6363   calculated Jacc
-0001b2e0: 6172 6420 696e 6469 6365 732e 0a20 2020  ard indices..   
-0001b2f0: 2020 2020 2020 2020 204f 7468 6572 7769           Otherwi
-0001b300: 7365 2c20 7265 7475 726e 2066 6f72 2074  se, return for t
-0001b310: 6865 2063 616c 6375 6c61 7465 6420 4a61  he calculated Ja
-0001b320: 6363 6172 6420 696e 6469 6365 7320 7468  ccard indices th
-0001b330: 6520 7374 6174 6973 7469 630a 2020 2020  e statistic.    
-0001b340: 2020 2020 2020 2020 7370 6563 6966 6965          specifie
-0001b350: 6420 6279 2073 6c69 6365 5f73 7461 742e  d by slice_stat.
-0001b360: 0a0a 2020 2020 2020 2020 7661 6c75 655f  ..        value_
-0001b370: 666f 725f 6e6f 6e65 203a 2066 6c6f 6174  for_none : float
-0001b380: 2c20 6465 6661 756c 743d 4e6f 6e65 0a20  , default=None. 
-0001b390: 2020 2020 2020 2020 2020 2046 6f72 2073             For s
-0001b3a0: 696e 676c 655f 736c 6963 6520 616e 6420  ingle_slice and 
-0001b3b0: 6279 5f73 6c69 6365 2c20 7661 6c75 6520  by_slice, value 
-0001b3c0: 746f 2062 6520 7265 7475 726e 6564 2066  to be returned f
-0001b3d0: 6f72 0a20 2020 2020 2020 2020 2020 2073  or.            s
-0001b3e0: 6c69 6365 7320 7768 6572 6520 4a61 6363  lices where Jacc
-0001b3f0: 6172 6420 696e 6465 7820 6973 2075 6e64  ard index is und
-0001b400: 6574 6572 6d69 6e65 6420 284e 6f6e 6529  etermined (None)
-0001b410: 2e20 2046 6f72 2073 6c69 6365 5f73 7461  .  For slice_sta
-0001b420: 742c 0a20 2020 2020 2020 2020 2020 2076  t,.            v
-0001b430: 616c 7565 2074 6f20 7375 6273 7469 7475  alue to substitu
-0001b440: 7465 2066 6f72 2061 6e79 204e 6f6e 6520  te for any None 
-0001b450: 7661 6c75 6573 2061 6d6f 6e67 2074 6865  values among the
-0001b460: 2069 6e70 7574 730a 2020 2020 2020 2020   inputs.        
-0001b470: 2020 2020 666f 7220 6361 6c63 756c 6174      for calculat
-0001b480: 696e 6720 736c 6963 652d 6261 7365 6420  ing slice-based 
-0001b490: 7374 6174 6973 7469 632e 2020 4966 204e  statistic.  If N
-0001b4a0: 6f6e 6520 696e 2074 6865 206c 6174 7465  one in the latte
-0001b4b0: 720a 2020 2020 2020 2020 2020 2020 6361  r.            ca
-0001b4c0: 7365 2c20 4e6f 6e65 2076 616c 7565 7320  se, None values 
-0001b4d0: 616d 6f6e 6720 7468 6520 696e 7075 7473  among the inputs
-0001b4e0: 2061 7265 206f 6d69 7474 6564 2e0a 0a20   are omitted... 
-0001b4f0: 2020 2020 2020 2073 6c69 6365 5f73 7461         slice_sta
-0001b500: 7420 3a20 7374 722c 2064 6566 6175 6c74  t : str, default
-0001b510: 3d4e 6f6e 650a 2020 2020 2020 2020 2020  =None.          
-0001b520: 2020 5369 6e67 6c65 2d76 6172 6961 626c    Single-variabl
-0001b530: 6520 7374 6174 6973 7469 6328 7329 2074  e statistic(s) t
-0001b540: 6f20 6265 2072 6574 7572 6e65 6420 666f  o be returned fo
-0001b550: 7220 736c 6963 652d 6279 2d73 6c69 6365  r slice-by-slice
-0001b560: 0a20 2020 2020 2020 2020 2020 204a 6163  .            Jac
-0001b570: 6361 7264 2069 6e64 6963 6573 2e20 2054  card indices.  T
-0001b580: 6869 7320 7368 6f75 6c64 2062 6520 7468  his should be th
-0001b590: 6520 6e61 6d65 206f 6620 7468 6520 6675  e name of the fu
-0001b5a0: 6e63 7469 6f6e 2066 6f72 0a20 2020 2020  nction for.     
-0001b5b0: 2020 2020 2020 2063 616c 6375 6c61 7469         calculati
-0001b5c0: 6f6e 206f 6620 7468 6520 7374 6174 6973  on of the statis
-0001b5d0: 7469 6328 7329 2069 6e20 7468 6520 5079  tic(s) in the Py
-0001b5e0: 7468 6f6e 2073 7461 7469 7374 6963 7320  thon statistics 
-0001b5f0: 6d6f 6475 6c65 3a0a 0a20 2020 2020 2020  module:..       
-0001b600: 2020 2020 2068 7474 7073 3a2f 2f64 6f63       https://doc
-0001b610: 732e 7079 7468 6f6e 2e6f 7267 2f33 2f6c  s.python.org/3/l
-0001b620: 6962 7261 7279 2f73 7461 7469 7374 6963  ibrary/statistic
-0001b630: 732e 6874 6d6c 0a0a 2020 2020 2020 2020  s.html..        
-0001b640: 2020 2020 4176 6169 6c61 626c 6520 6f70      Available op
-0001b650: 7469 6f6e 7320 696e 636c 7564 653a 2022  tions include: "
-0001b660: 6d65 616e 222c 2022 6d65 6469 616e 222c  mean", "median",
-0001b670: 2022 6d6f 6465 222c 0a20 2020 2020 2020   "mode",.       
-0001b680: 2020 2020 2022 7374 6465 7622 2c20 2271       "stdev", "q
-0001b690: 7561 6e74 696c 6573 222e 2020 4469 7372  uantiles".  Disr
-0001b6a0: 6567 6172 6465 6420 6966 204e 6f6e 652e  egarded if None.
-0001b6b0: 0a0a 2020 2020 2020 2020 2020 2020 4966  ..            If
-0001b6c0: 2062 795f 736c 6963 6520 6973 204e 6f6e   by_slice is Non
-0001b6d0: 6520 616e 6420 736c 6963 655f 7374 6174  e and slice_stat
-0001b6e0: 2069 7320 6469 6666 6572 656e 7420 6672   is different fr
-0001b6f0: 6f6d 204e 6f6e 652c 0a20 2020 2020 2020  om None,.       
-0001b700: 2020 2020 2074 6865 2066 6f72 6d65 7220       the former 
-0001b710: 6465 6661 756c 7473 2074 6f20 2275 6e69  defaults to "uni
-0001b720: 6f6e 222e 0a0a 2020 2020 2020 2020 736c  on"...        sl
-0001b730: 6963 655f 7374 6174 5f6b 7761 7267 7320  ice_stat_kwargs 
-0001b740: 3a20 6469 6374 2c20 6465 6661 756c 743d  : dict, default=
-0001b750: 4e6f 6e65 0a20 2020 2020 2020 2020 2020  None.           
-0001b760: 204b 6579 776f 7264 2061 7267 756d 656e   Keyword argumen
-0001b770: 7473 2074 6f20 6265 2070 6173 7365 6420  ts to be passed 
-0001b780: 746f 2066 756e 6374 696f 6e20 6f66 2073  to function of s
-0001b790: 7461 7469 7374 6963 730a 2020 2020 2020  tatistics.      
-0001b7a0: 2020 2020 2020 6d6f 6475 6c65 2066 6f72        module for
-0001b7b0: 2063 616c 6375 6c61 7469 6f6e 2072 656c   calculation rel
-0001b7c0: 6174 6976 6520 746f 2073 6c69 6365 2076  ative to slice v
-0001b7d0: 616c 7565 732e 2020 466f 7220 6578 616d  alues.  For exam
-0001b7e0: 706c 652c 0a20 2020 2020 2020 2020 2020  ple,.           
-0001b7f0: 2069 6620 7175 616e 7469 6c65 7320 6172   if quantiles ar
-0001b800: 6520 7265 7175 6972 6564 2066 6f72 2031  e required for 1
-0001b810: 3020 696e 7465 7276 616c 732c 2072 6174  0 intervals, rat
-0001b820: 6865 7220 7468 616e 2066 6f72 0a20 2020  her than for.   
-0001b830: 2020 2020 2020 2020 2074 6865 2064 6566           the def
-0001b840: 6175 6c74 206f 6620 342c 2074 6869 7320  ault of 4, this 
-0001b850: 6361 6e20 6265 2073 7065 6369 6669 6564  can be specified
-0001b860: 2075 7369 6e67 3a0a 0a20 2020 2020 2020   using:..       
-0001b870: 2020 2020 2073 6c69 6365 5f73 7461 745f       slice_stat_
-0001b880: 6b77 6172 6773 7b22 6e22 203a 2031 307d  kwargs{"n" : 10}
-0001b890: 0a0a 2020 2020 2020 2020 2020 2020 466f  ..            Fo
-0001b8a0: 7220 6176 6169 6c61 626c 6520 6b65 7977  r available keyw
-0001b8b0: 6f72 6420 6f70 7469 6f6e 732c 2073 6565  ord options, see
-0001b8c0: 2064 6f63 756d 656e 7461 7469 6f6e 206f   documentation o
-0001b8d0: 6620 7374 6174 6973 7469 6373 0a20 2020  f statistics.   
-0001b8e0: 2020 2020 2020 2020 206d 6f64 756c 6520           module 
-0001b8f0: 6174 3a0a 0a20 2020 2020 2020 2020 2020  at:..           
-0001b900: 2068 7474 7073 3a2f 2f64 6f63 732e 7079   https://docs.py
-0001b910: 7468 6f6e 2e6f 7267 2f33 2f6c 6962 7261  thon.org/3/libra
-0001b920: 7279 2f73 7461 7469 7374 6963 732e 6874  ry/statistics.ht
-0001b930: 6d6c 0a20 2020 2020 2020 2022 2222 0a20  ml.        """. 
-0001b940: 2020 2020 2020 2069 6620 736c 6963 655f         if slice_
-0001b950: 7374 6174 3a0a 2020 2020 2020 2020 2020  stat:.          
-0001b960: 2020 7265 7475 726e 2073 656c 662e 6765    return self.ge
-0001b970: 745f 736c 6963 655f 7374 6174 286f 7468  t_slice_stat(oth
-0001b980: 6572 2c20 226a 6163 6361 7264 222c 2073  er, "jaccard", s
-0001b990: 6c69 6365 5f73 7461 742c 2062 795f 736c  lice_stat, by_sl
-0001b9a0: 6963 652c 0a20 2020 2020 2020 2020 2020  ice,.           
-0001b9b0: 2020 2020 2020 2020 2076 616c 7565 5f66           value_f
-0001b9c0: 6f72 5f6e 6f6e 652c 2076 6965 772c 206d  or_none, view, m
-0001b9d0: 6574 686f 642c 202a 2a28 736c 6963 655f  ethod, **(slice_
-0001b9e0: 7374 6174 5f6b 7761 7267 7320 6f72 207b  stat_kwargs or {
-0001b9f0: 7d29 290a 0a20 2020 2020 2020 2069 6620  }))..        if 
-0001ba00: 6279 5f73 6c69 6365 3a0a 2020 2020 2020  by_slice:.      
-0001ba10: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-0001ba20: 662e 6765 745f 6d65 7472 6963 5f62 795f  f.get_metric_by_
-0001ba30: 736c 6963 6528 6f74 6865 722c 2022 6a61  slice(other, "ja
-0001ba40: 6363 6172 6422 2c20 6279 5f73 6c69 6365  ccard", by_slice
-0001ba50: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0001ba60: 2020 2020 2020 7669 6577 2c20 6d65 7468        view, meth
-0001ba70: 6f64 290a 0a20 2020 2020 2020 2069 6e74  od)..        int
-0001ba80: 6572 7365 6374 696f 6e2c 2075 6e69 6f6e  ersection, union
-0001ba90: 2c20 6d65 616e 5f73 697a 6520 3d20 7365  , mean_size = se
-0001baa0: 6c66 2e67 6574 5f69 6e74 6572 7365 6374  lf.get_intersect
-0001bab0: 696f 6e5f 756e 696f 6e5f 7369 7a65 280a  ion_union_size(.
-0001bac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bad0: 6f74 6865 722c 2073 696e 676c 655f 736c  other, single_sl
-0001bae0: 6963 652c 2076 6965 772c 2073 6c2c 2069  ice, view, sl, i
-0001baf0: 6478 2c20 706f 732c 206d 6574 686f 642c  dx, pos, method,
-0001bb00: 2066 6c61 7474 656e 290a 0a20 2020 2020   flatten)..     
-0001bb10: 2020 2072 6574 7572 6e20 2869 6e74 6572     return (inter
-0001bb20: 7365 6374 696f 6e20 2f20 756e 696f 6e20  section / union 
-0001bb30: 6966 2075 6e69 6f6e 2065 6c73 6520 7661  if union else va
-0001bb40: 6c75 655f 666f 725f 6e6f 6e65 290a 0a20  lue_for_none).. 
-0001bb50: 2020 2064 6566 2067 6574 5f76 6f6c 756d     def get_volum
-0001bb60: 655f 7261 7469 6f28 7365 6c66 2c20 6f74  e_ratio(self, ot
-0001bb70: 6865 722c 202a 2a6b 7761 7267 7329 3a0a  her, **kwargs):.
-0001bb80: 2020 2020 2020 2020 2222 2247 6574 2072          """Get r
-0001bb90: 6174 696f 206f 6620 616e 6f74 6865 7220  atio of another 
-0001bba0: 524f 4927 7320 766f 6c75 6d65 2077 6974  ROI's volume wit
-0001bbb0: 6820 7265 7370 6563 7420 746f 206f 776e  h respect to own
-0001bbc0: 2076 6f6c 756d 652e 2222 220a 0a20 2020   volume."""..   
-0001bbd0: 2020 2020 206f 776e 5f76 6f6c 756d 6520       own_volume 
-0001bbe0: 3d20 6f74 6865 722e 6765 745f 766f 6c75  = other.get_volu
-0001bbf0: 6d65 282a 2a6b 7761 7267 7329 0a20 2020  me(**kwargs).   
-0001bc00: 2020 2020 206f 7468 6572 5f76 6f6c 756d       other_volum
-0001bc10: 6520 3d20 7365 6c66 2e67 6574 5f76 6f6c  e = self.get_vol
-0001bc20: 756d 6528 2a2a 6b77 6172 6773 290a 2020  ume(**kwargs).  
-0001bc30: 2020 2020 2020 6966 206e 6f74 206f 7468        if not oth
-0001bc40: 6572 5f76 6f6c 756d 6520 6f72 206e 6f74  er_volume or not
-0001bc50: 206f 776e 5f76 6f6c 756d 653a 0a20 2020   own_volume:.   
-0001bc60: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-0001bc70: 4e6f 6e65 0a20 2020 2020 2020 2072 6574  None.        ret
-0001bc80: 7572 6e20 6f77 6e5f 766f 6c75 6d65 202f  urn own_volume /
-0001bc90: 206f 7468 6572 5f76 6f6c 756d 650a 0a20   other_volume.. 
-0001bca0: 2020 2064 6566 2067 6574 5f61 7265 615f     def get_area_
-0001bcb0: 7261 7469 6f28 7365 6c66 2c20 6f74 6865  ratio(self, othe
-0001bcc0: 722c 2076 6965 773d 2278 2d79 222c 2073  r, view="x-y", s
-0001bcd0: 6c3d 4e6f 6e65 2c20 6964 783d 4e6f 6e65  l=None, idx=None
-0001bce0: 2c20 706f 733d 4e6f 6e65 2c0a 2020 2020  , pos=None,.    
-0001bcf0: 2020 2020 2020 2020 756e 6974 733d 226d          units="m
-0001bd00: 6d22 2c20 6d65 7468 6f64 3d4e 6f6e 652c  m", method=None,
-0001bd10: 2066 6c61 7474 656e 3d46 616c 7365 2c20   flatten=False, 
-0001bd20: 6279 5f73 6c69 6365 3d4e 6f6e 652c 0a20  by_slice=None,. 
-0001bd30: 2020 2020 2020 2020 2020 2073 6c69 6365             slice
-0001bd40: 5f73 7461 743d 4e6f 6e65 2c20 7661 6c75  _stat=None, valu
-0001bd50: 655f 666f 725f 6e6f 6e65 3d4e 6f6e 652c  e_for_none=None,
-0001bd60: 202a 2a73 6c69 6365 5f73 7461 745f 6b77   **slice_stat_kw
-0001bd70: 6172 6773 293a 0a20 2020 2020 2020 2022  args):.        "
-0001bd80: 2222 4765 7420 7261 7469 6f20 6f66 2061  ""Get ratio of a
-0001bd90: 6e6f 7468 6572 2052 4f49 2773 2061 7265  nother ROI's are
-0001bda0: 6120 7769 7468 2072 6573 7065 6374 2074  a with respect t
-0001bdb0: 6f20 6f77 6e20 6172 6561 2e22 2222 0a0a  o own area."""..
-0001bdc0: 2020 2020 2020 2020 6966 2073 6c69 6365          if slice
-0001bdd0: 5f73 7461 743a 0a20 2020 2020 2020 2020  _stat:.         
-0001bde0: 2020 2072 6574 7572 6e20 7365 6c66 2e67     return self.g
-0001bdf0: 6574 5f73 6c69 6365 5f73 7461 7428 6f74  et_slice_stat(ot
-0001be00: 6865 722c 2022 6172 6561 5f72 6174 696f  her, "area_ratio
-0001be10: 222c 2073 6c69 6365 5f73 7461 742c 0a20  ", slice_stat,. 
-0001be20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001be30: 2020 2062 795f 736c 6963 652c 2076 616c     by_slice, val
-0001be40: 7565 5f66 6f72 5f6e 6f6e 652c 2076 6965  ue_for_none, vie
-0001be50: 772c 206d 6574 686f 642c 0a20 2020 2020  w, method,.     
-0001be60: 2020 2020 2020 2020 2020 2020 2020 202a                 *
-0001be70: 2a28 736c 6963 655f 7374 6174 5f6b 7761  *(slice_stat_kwa
-0001be80: 7267 7320 6f72 207b 7d29 290a 0a20 2020  rgs or {}))..   
-0001be90: 2020 2020 2069 6620 6279 5f73 6c69 6365       if by_slice
-0001bea0: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
-0001beb0: 7475 726e 2073 656c 662e 6765 745f 6d65  turn self.get_me
-0001bec0: 7472 6963 5f62 795f 736c 6963 6528 6f74  tric_by_slice(ot
-0001bed0: 6865 722c 2022 6172 6561 5f72 6174 696f  her, "area_ratio
-0001bee0: 222c 2062 795f 736c 6963 652c 0a20 2020  ", by_slice,.   
-0001bef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bf00: 2076 6965 772c 206d 6574 686f 6429 0a0a   view, method)..
-0001bf10: 2020 2020 2020 2020 6f77 6e5f 6172 6561          own_area
-0001bf20: 203d 206f 7468 6572 2e67 6574 5f61 7265   = other.get_are
-0001bf30: 6128 7669 6577 2c20 736c 2c20 6964 782c  a(view, sl, idx,
-0001bf40: 2070 6f73 2c20 756e 6974 732c 206d 6574   pos, units, met
-0001bf50: 686f 642c 2066 6c61 7474 656e 290a 2020  hod, flatten).  
-0001bf60: 2020 2020 2020 6f74 6865 725f 6172 6561        other_area
-0001bf70: 203d 2073 656c 662e 6765 745f 6172 6561   = self.get_area
-0001bf80: 2876 6965 772c 2073 6c2c 2069 6478 2c20  (view, sl, idx, 
-0001bf90: 706f 732c 2075 6e69 7473 2c20 6d65 7468  pos, units, meth
-0001bfa0: 6f64 2c20 666c 6174 7465 6e29 0a20 2020  od, flatten).   
-0001bfb0: 2020 2020 2069 6620 6e6f 7420 6f74 6865       if not othe
-0001bfc0: 725f 6172 6561 206f 7220 6e6f 7420 6f77  r_area or not ow
-0001bfd0: 6e5f 6172 6561 3a0a 2020 2020 2020 2020  n_area:.        
-0001bfe0: 2020 2020 7265 7475 726e 2076 616c 7565      return value
-0001bff0: 5f66 6f72 5f6e 6f6e 650a 2020 2020 2020  _for_none.      
-0001c000: 2020 7265 7475 726e 206f 776e 5f61 7265    return own_are
-0001c010: 6120 2f20 6f74 6865 725f 6172 6561 0a0a  a / other_area..
-0001c020: 2020 2020 6465 6620 6765 745f 766f 6c75      def get_volu
-0001c030: 6d65 5f64 6966 6628 7365 6c66 2c20 6f74  me_diff(self, ot
-0001c040: 6865 722c 202a 2a6b 7761 7267 7329 3a0a  her, **kwargs):.
-0001c050: 2020 2020 2020 2020 2222 2247 6574 206f          """Get o
-0001c060: 776e 2076 6f6c 756d 6520 6d69 6e75 7320  wn volume minus 
-0001c070: 766f 6c75 6d65 206f 6620 6f74 6865 7220  volume of other 
-0001c080: 524f 492e 2222 220a 0a20 2020 2020 2020  ROI."""..       
-0001c090: 206f 776e 5f76 6f6c 756d 6520 3d20 7365   own_volume = se
-0001c0a0: 6c66 2e67 6574 5f76 6f6c 756d 6528 2a2a  lf.get_volume(**
-0001c0b0: 6b77 6172 6773 290a 2020 2020 2020 2020  kwargs).        
-0001c0c0: 6f74 6865 725f 766f 6c75 6d65 203d 206f  other_volume = o
-0001c0d0: 7468 6572 2e67 6574 5f76 6f6c 756d 6528  ther.get_volume(
-0001c0e0: 2a2a 6b77 6172 6773 290a 2020 2020 2020  **kwargs).      
-0001c0f0: 2020 6966 206e 6f74 206f 776e 5f76 6f6c    if not own_vol
-0001c100: 756d 6520 6f72 206e 6f74 206f 7468 6572  ume or not other
-0001c110: 5f76 6f6c 756d 653a 0a20 2020 2020 2020  _volume:.       
-0001c120: 2020 2020 2072 6574 7572 6e20 4e6f 6e65       return None
-0001c130: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-0001c140: 286f 776e 5f76 6f6c 756d 6520 2d20 6f74  (own_volume - ot
-0001c150: 6865 725f 766f 6c75 6d65 290a 0a20 2020  her_volume)..   
-0001c160: 2064 6566 2067 6574 5f72 656c 6174 6976   def get_relativ
-0001c170: 655f 766f 6c75 6d65 5f64 6966 6628 7365  e_volume_diff(se
-0001c180: 6c66 2c20 6f74 6865 722c 202a 2a6b 7761  lf, other, **kwa
-0001c190: 7267 7329 3a0a 2020 2020 2020 2020 2222  rgs):.        ""
-0001c1a0: 2247 6574 2072 656c 6174 6976 6520 766f  "Get relative vo
-0001c1b0: 6c75 6d65 206f 6620 616e 6f74 6865 7220  lume of another 
-0001c1c0: 524f 4920 7769 7468 2072 6573 7065 6374  ROI with respect
-0001c1d0: 2074 6f20 6f77 6e20 766f 6c75 6d65 2e22   to own volume."
-0001c1e0: 2222 0a0a 2020 2020 2020 2020 6f77 6e5f  ""..        own_
-0001c1f0: 766f 6c75 6d65 203d 2073 656c 662e 6765  volume = self.ge
-0001c200: 745f 766f 6c75 6d65 282a 2a6b 7761 7267  t_volume(**kwarg
-0001c210: 7329 0a20 2020 2020 2020 2076 6f6c 756d  s).        volum
-0001c220: 655f 6469 6666 203d 2073 656c 662e 6765  e_diff = self.ge
-0001c230: 745f 766f 6c75 6d65 5f64 6966 6628 6f74  t_volume_diff(ot
-0001c240: 6865 722c 202a 2a6b 7761 7267 7329 0a20  her, **kwargs). 
-0001c250: 2020 2020 2020 2069 6620 766f 6c75 6d65         if volume
-0001c260: 5f64 6966 6620 6973 204e 6f6e 653a 0a20  _diff is None:. 
-0001c270: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-0001c280: 6e0a 2020 2020 2020 2020 7265 7475 726e  n.        return
-0001c290: 2076 6f6c 756d 655f 6469 6666 202f 206f   volume_diff / o
-0001c2a0: 776e 5f76 6f6c 756d 650a 0a20 2020 2064  wn_volume..    d
-0001c2b0: 6566 2067 6574 5f61 7265 615f 6469 6666  ef get_area_diff
-0001c2c0: 2873 656c 662c 206f 7468 6572 2c20 7669  (self, other, vi
-0001c2d0: 6577 3d22 782d 7922 2c20 736c 3d4e 6f6e  ew="x-y", sl=Non
-0001c2e0: 652c 2069 6478 3d4e 6f6e 652c 2070 6f73  e, idx=None, pos
-0001c2f0: 3d4e 6f6e 652c 0a20 2020 2020 2020 2020  =None,.         
-0001c300: 2020 2075 6e69 7473 3d22 6d6d 222c 206d     units="mm", m
-0001c310: 6574 686f 643d 4e6f 6e65 2c20 666c 6174  ethod=None, flat
-0001c320: 7465 6e3d 4661 6c73 652c 2062 795f 736c  ten=False, by_sl
-0001c330: 6963 653d 4e6f 6e65 2c0a 2020 2020 2020  ice=None,.      
-0001c340: 2020 2020 2020 736c 6963 655f 7374 6174        slice_stat
-0001c350: 3d4e 6f6e 652c 2076 616c 7565 5f66 6f72  =None, value_for
-0001c360: 5f6e 6f6e 653d 4e6f 6e65 2c20 2a2a 736c  _none=None, **sl
-0001c370: 6963 655f 7374 6174 5f6b 7761 7267 7329  ice_stat_kwargs)
-0001c380: 3a0a 2020 2020 2020 2020 2222 2247 6574  :.        """Get
-0001c390: 2061 6273 6f6c 7574 6520 6172 6561 2064   absolute area d
-0001c3a0: 6966 6665 7265 6e63 6520 6265 7477 6565  ifference betwee
-0001c3b0: 6e20 7477 6f20 524f 4973 2e22 2222 0a0a  n two ROIs."""..
-0001c3c0: 2020 2020 2020 2020 6966 2073 6c69 6365          if slice
-0001c3d0: 5f73 7461 743a 0a20 2020 2020 2020 2020  _stat:.         
-0001c3e0: 2020 2072 6574 7572 6e20 7365 6c66 2e67     return self.g
-0001c3f0: 6574 5f73 6c69 6365 5f73 7461 7428 6f74  et_slice_stat(ot
-0001c400: 6865 722c 2022 6172 6561 5f64 6966 6622  her, "area_diff"
-0001c410: 2c20 736c 6963 655f 7374 6174 2c0a 2020  , slice_stat,.  
-0001c420: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c430: 2020 6279 5f73 6c69 6365 2c20 7661 6c75    by_slice, valu
-0001c440: 655f 666f 725f 6e6f 6e65 2c20 7669 6577  e_for_none, view
-0001c450: 2c20 6d65 7468 6f64 2c0a 2020 2020 2020  , method,.      
-0001c460: 2020 2020 2020 2020 2020 2020 2020 2a2a                **
-0001c470: 2873 6c69 6365 5f73 7461 745f 6b77 6172  (slice_stat_kwar
-0001c480: 6773 206f 7220 7b7d 2929 0a0a 2020 2020  gs or {}))..    
-0001c490: 2020 2020 6966 2062 795f 736c 6963 653a      if by_slice:
-0001c4a0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-0001c4b0: 7572 6e20 7365 6c66 2e67 6574 5f6d 6574  urn self.get_met
-0001c4c0: 7269 635f 6279 5f73 6c69 6365 286f 7468  ric_by_slice(oth
-0001c4d0: 6572 2c20 2261 7265 615f 6469 6666 222c  er, "area_diff",
-0001c4e0: 2062 795f 736c 6963 652c 0a20 2020 2020   by_slice,.     
-0001c4f0: 2020 2020 2020 2020 2020 2020 2020 2076                 v
-0001c500: 6965 772c 206d 6574 686f 6429 0a0a 2020  iew, method)..  
-0001c510: 2020 2020 2020 6f77 6e5f 6172 6561 203d        own_area =
-0001c520: 2073 656c 662e 6765 745f 6172 6561 2876   self.get_area(v
-0001c530: 6965 772c 2073 6c2c 2069 6478 2c20 706f  iew, sl, idx, po
-0001c540: 732c 2075 6e69 7473 2c20 6d65 7468 6f64  s, units, method
-0001c550: 2c20 666c 6174 7465 6e29 0a20 2020 2020  , flatten).     
-0001c560: 2020 206f 7468 6572 5f61 7265 6120 3d20     other_area = 
-0001c570: 6f74 6865 722e 6765 745f 6172 6561 2876  other.get_area(v
-0001c580: 6965 772c 2073 6c2c 2069 6478 2c20 706f  iew, sl, idx, po
-0001c590: 732c 2075 6e69 7473 2c20 6d65 7468 6f64  s, units, method
-0001c5a0: 2c20 666c 6174 7465 6e29 0a20 2020 2020  , flatten).     
-0001c5b0: 2020 2069 6620 6e6f 7420 6f77 6e5f 6172     if not own_ar
-0001c5c0: 6561 206f 7220 6e6f 7420 6f74 6865 725f  ea or not other_
-0001c5d0: 6172 6561 3a0a 2020 2020 2020 2020 2020  area:.          
-0001c5e0: 2020 7265 7475 726e 2076 616c 7565 5f66    return value_f
-0001c5f0: 6f72 5f6e 6f6e 650a 2020 2020 2020 2020  or_none.        
-0001c600: 7265 7475 726e 206f 776e 5f61 7265 6120  return own_area 
-0001c610: 2d20 6f74 6865 725f 6172 6561 0a0a 2020  - other_area..  
-0001c620: 2020 6465 6620 6765 745f 7265 6c61 7469    def get_relati
-0001c630: 7665 5f61 7265 615f 6469 6666 2873 656c  ve_area_diff(sel
-0001c640: 662c 206f 7468 6572 2c20 7669 6577 3d22  f, other, view="
-0001c650: 782d 7922 2c20 736c 3d4e 6f6e 652c 2069  x-y", sl=None, i
-0001c660: 6478 3d4e 6f6e 652c 0a20 2020 2020 2020  dx=None,.       
-0001c670: 2020 2020 2070 6f73 3d4e 6f6e 652c 2075       pos=None, u
-0001c680: 6e69 7473 3d22 6d6d 222c 206d 6574 686f  nits="mm", metho
-0001c690: 643d 4e6f 6e65 2c20 666c 6174 7465 6e3d  d=None, flatten=
-0001c6a0: 4661 6c73 652c 2062 795f 736c 6963 653d  False, by_slice=
-0001c6b0: 4e6f 6e65 2c0a 2020 2020 2020 2020 2020  None,.          
-0001c6c0: 2020 736c 6963 655f 7374 6174 3d4e 6f6e    slice_stat=Non
-0001c6d0: 652c 2076 616c 7565 5f66 6f72 5f6e 6f6e  e, value_for_non
-0001c6e0: 653d 4e6f 6e65 2c20 2a2a 736c 6963 655f  e=None, **slice_
-0001c6f0: 7374 6174 5f6b 7761 7267 7329 3a0a 2020  stat_kwargs):.  
-0001c700: 2020 2020 2020 2222 2247 6574 2072 656c        """Get rel
-0001c710: 6174 6976 6520 6172 6561 206f 6620 616e  ative area of an
-0001c720: 6f74 6865 7220 524f 4920 7769 7468 2072  other ROI with r
-0001c730: 6573 7065 6374 2074 6f20 6f77 6e20 6172  espect to own ar
-0001c740: 6561 2e22 2222 0a0a 2020 2020 2020 2020  ea."""..        
-0001c750: 6966 2073 6c69 6365 5f73 7461 743a 0a20  if slice_stat:. 
-0001c760: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-0001c770: 6e20 7365 6c66 2e67 6574 5f73 6c69 6365  n self.get_slice
-0001c780: 5f73 7461 7428 6f74 6865 722c 2022 7265  _stat(other, "re
-0001c790: 6c5f 6172 6561 5f64 6966 6622 2c20 736c  l_area_diff", sl
-0001c7a0: 6963 655f 7374 6174 2c0a 2020 2020 2020  ice_stat,.      
-0001c7b0: 2020 2020 2020 2020 2020 2020 2020 6279                by
-0001c7c0: 5f73 6c69 6365 2c20 7661 6c75 655f 666f  _slice, value_fo
-0001c7d0: 725f 6e6f 6e65 2c20 7669 6577 2c20 6d65  r_none, view, me
-0001c7e0: 7468 6f64 2c0a 2020 2020 2020 2020 2020  thod,.          
-0001c7f0: 2020 2020 2020 2020 2020 2a2a 2873 6c69            **(sli
-0001c800: 6365 5f73 7461 745f 6b77 6172 6773 206f  ce_stat_kwargs o
-0001c810: 7220 7b7d 2929 0a0a 2020 2020 2020 2020  r {}))..        
-0001c820: 6966 2062 795f 736c 6963 653a 0a20 2020  if by_slice:.   
-0001c830: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-0001c840: 7365 6c66 2e67 6574 5f6d 6574 7269 635f  self.get_metric_
-0001c850: 6279 5f73 6c69 6365 286f 7468 6572 2c20  by_slice(other, 
-0001c860: 2272 656c 5f61 7265 615f 6469 6666 222c  "rel_area_diff",
-0001c870: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001c880: 2020 2020 2062 795f 736c 6963 652c 2076       by_slice, v
-0001c890: 6965 772c 206d 6574 686f 6429 0a0a 2020  iew, method)..  
-0001c8a0: 2020 2020 2020 6f77 6e5f 6172 6561 203d        own_area =
-0001c8b0: 2073 656c 662e 6765 745f 6172 6561 2876   self.get_area(v
-0001c8c0: 6965 772c 2073 6c2c 2069 6478 2c20 706f  iew, sl, idx, po
-0001c8d0: 732c 2075 6e69 7473 2c20 6d65 7468 6f64  s, units, method
-0001c8e0: 2c20 666c 6174 7465 6e29 0a20 2020 2020  , flatten).     
-0001c8f0: 2020 2061 7265 615f 6469 6666 203d 2073     area_diff = s
-0001c900: 656c 662e 6765 745f 6172 6561 5f64 6966  elf.get_area_dif
-0001c910: 6628 6f74 6865 722c 2076 6965 772c 2073  f(other, view, s
-0001c920: 6c2c 2069 6478 2c20 706f 732c 2075 6e69  l, idx, pos, uni
-0001c930: 7473 2c20 6d65 7468 6f64 2c0a 2020 2020  ts, method,.    
-0001c940: 2020 2020 2020 2020 2020 2020 666c 6174              flat
-0001c950: 7465 6e29 0a0a 2020 2020 2020 2020 6966  ten)..        if
-0001c960: 2061 7265 615f 6469 6666 2069 7320 4e6f   area_diff is No
-0001c970: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-0001c980: 7265 7475 726e 2076 616c 7565 5f66 6f72  return value_for
-0001c990: 5f6e 6f6e 650a 2020 2020 2020 2020 7265  _none.        re
-0001c9a0: 7475 726e 2061 7265 615f 6469 6666 202f  turn area_diff /
-0001c9b0: 206f 776e 5f61 7265 610a 0a20 2020 2064   own_area..    d
-0001c9c0: 6566 2067 6574 5f69 6e74 6572 7365 6374  ef get_intersect
-0001c9d0: 696f 6e5f 756e 696f 6e5f 7369 7a65 280a  ion_union_size(.
-0001c9e0: 2020 2020 2020 2020 7365 6c66 2c20 0a20          self, . 
-0001c9f0: 2020 2020 2020 206f 7468 6572 2c20 0a20         other, . 
-0001ca00: 2020 2020 2020 2073 696e 676c 655f 736c         single_sl
-0001ca10: 6963 653d 4661 6c73 652c 0a20 2020 2020  ice=False,.     
-0001ca20: 2020 2076 6965 773d 2278 2d79 222c 200a     view="x-y", .
-0001ca30: 2020 2020 2020 2020 736c 3d4e 6f6e 652c          sl=None,
-0001ca40: 200a 2020 2020 2020 2020 6964 783d 4e6f   .        idx=No
-0001ca50: 6e65 2c20 0a20 2020 2020 2020 2070 6f73  ne, .        pos
-0001ca60: 3d4e 6f6e 652c 200a 2020 2020 2020 2020  =None, .        
-0001ca70: 6d65 7468 6f64 3d4e 6f6e 652c 0a20 2020  method=None,.   
-0001ca80: 2020 2020 2066 6c61 7474 656e 3d46 616c       flatten=Fal
-0001ca90: 7365 2c0a 2020 2020 293a 0a20 2020 2020  se,.    ):.     
-0001caa0: 2020 2022 2222 0a20 2020 2020 2020 2047     """.        G
-0001cab0: 6574 2069 6e74 6572 7365 6374 696f 6e2c  et intersection,
-0001cac0: 2075 6e69 6f6e 2061 6e64 206d 6561 6e20   union and mean 
-0001cad0: 7369 7a65 2077 6974 6820 7265 7370 6563  size with respec
-0001cae0: 7420 746f 2061 6e6f 7468 6572 2052 4f49  t to another ROI
-0001caf0: 2e0a 2020 2020 2020 2020 5661 6c75 6573  ..        Values
-0001cb00: 2061 7265 2072 6574 7572 6e65 6420 6173   are returned as
-0001cb10: 2076 6f6c 756d 6573 2066 6f72 2074 6865   volumes for the
-0001cb20: 2066 756c 6c20 524f 4973 2c0a 2020 2020   full ROIs,.    
-0001cb30: 2020 2020 6f72 2061 7320 6172 6561 7320      or as areas 
-0001cb40: 666f 7220 6120 7369 6e67 6c65 2073 6c69  for a single sli
-0001cb50: 6365 2e0a 0a20 2020 2020 2020 202a 2a50  ce...        **P
-0001cb60: 6172 616d 6574 6572 733a 2a2a 0a20 2020  arameters:**.   
-0001cb70: 2020 2020 200a 2020 2020 2020 2020 6f74       .        ot
-0001cb80: 6865 7220 3a20 524f 490a 2020 2020 2020  her : ROI.      
-0001cb90: 2020 2020 2020 4f74 6865 7220 524f 4920        Other ROI 
-0001cba0: 746f 2063 6f6d 7061 7265 2077 6974 6820  to compare with 
-0001cbb0: 7468 6973 2052 4f49 2e0a 0a20 2020 2020  this ROI...     
-0001cbc0: 2020 2073 696e 676c 655f 736c 6963 6520     single_slice 
-0001cbd0: 3a20 626f 6f6c 2c20 6465 6661 756c 743d  : bool, default=
-0001cbe0: 4661 6c73 650a 2020 2020 2020 2020 2020  False.          
-0001cbf0: 2020 4966 2046 616c 7365 2c20 7468 6520    If False, the 
-0001cc00: 766f 6c75 6d65 7320 6f66 2069 6e74 6572  volumes of inter
-0001cc10: 7365 6374 696f 6e20 616e 6420 2075 6e69  section and  uni
-0001cc20: 6f6e 206f 6620 7468 6520 6675 6c6c 2052  on of the full R
-0001cc30: 4f49 732c 0a20 2020 2020 2020 2020 2020  OIs,.           
-0001cc40: 2061 6e64 2074 6865 206d 6561 6e20 524f   and the mean RO
-0001cc50: 4920 766f 6c75 6d65 2077 696c 6c20 6265  I volume will be
-0001cc60: 2072 6574 7572 6e65 643b 0a20 2020 2020   returned;.     
-0001cc70: 2020 2020 2020 206f 7468 6572 7769 7365         otherwise
-0001cc80: 2c20 7468 6520 6172 6561 7320 6f66 2069  , the areas of i
-0001cc90: 6e74 6572 7365 6374 696f 6e20 616e 6420  ntersection and 
-0001cca0: 756e 696f 6e20 6f6e 2061 2073 696e 676c  union on a singl
-0001ccb0: 6520 736c 6963 652c 0a20 2020 2020 2020  e slice,.       
-0001ccc0: 2020 2020 2061 6e64 2074 6865 206d 6561       and the mea
-0001ccd0: 6e20 524f 4920 6172 6561 2c20 7769 6c6c  n ROI area, will
-0001cce0: 2062 6520 7265 7475 726e 6564 2e0a 0a20   be returned... 
-0001ccf0: 2020 2020 2020 2076 6965 7720 3a20 7374         view : st
-0001cd00: 722c 2064 6566 6175 6c74 3d22 782d 7922  r, default="x-y"
-0001cd10: 0a20 2020 2020 2020 2020 2020 204f 7269  .            Ori
-0001cd20: 656e 7461 7469 6f6e 206f 6620 736c 6963  entation of slic
-0001cd30: 6520 6f6e 2077 6869 6368 2074 6f20 6765  e on which to ge
-0001cd40: 7420 6172 6561 7320 6f66 2069 6e74 6572  t areas of inter
-0001cd50: 7365 6374 696f 6e0a 2020 2020 2020 2020  section.        
-0001cd60: 2020 2020 616e 6420 756e 696f 6e2c 2061      and union, a
-0001cd70: 6e64 206d 6561 6e20 524f 4920 6172 6561  nd mean ROI area
-0001cd80: 2e20 204f 6e6c 7920 7573 6564 2069 6620  .  Only used if 
-0001cd90: 7369 6e67 6c65 5f73 6c69 6365 3d54 7275  single_slice=Tru
-0001cda0: 652e 0a0a 2020 2020 2020 2020 736c 203a  e...        sl :
-0001cdb0: 2069 6e74 2c20 6465 6661 756c 743d 4e6f   int, default=No
-0001cdc0: 6e65 0a20 2020 2020 2020 2020 2020 2053  ne.            S
-0001cdd0: 6c69 6365 206e 756d 6265 722e 2049 6620  lice number. If 
-0001cde0: 6e6f 6e65 206f 6620 3c73 6c3e 2c20 3c69  none of <sl>, <i
-0001cdf0: 6478 3e20 6f72 203c 706f 733e 2061 7265  dx> or <pos> are
-0001ce00: 2073 7570 706c 6965 6420 6275 740a 2020   supplied but.  
-0001ce10: 2020 2020 2020 2020 2020 3c73 696e 676c            <singl
-0001ce20: 655f 736c 6963 653e 2069 7320 5472 7565  e_slice> is True
-0001ce30: 2c20 7468 6520 6365 6e74 7261 6c20 736c  , the central sl
-0001ce40: 6963 6520 6f66 2074 6869 7320 524f 4920  ice of this ROI 
-0001ce50: 7769 6c6c 2062 6520 7573 6564 2e0a 0a20  will be used... 
-0001ce60: 2020 2020 2020 2069 6478 203a 2069 6e74         idx : int
-0001ce70: 2c20 6465 6661 756c 743d 4e6f 6e65 0a20  , default=None. 
-0001ce80: 2020 2020 2020 2020 2020 2041 7272 6179             Array
-0001ce90: 2069 6e64 6578 206f 6620 736c 6963 652e   index of slice.
-0001cea0: 2049 6620 6e6f 6e65 206f 6620 3c73 6c3e   If none of <sl>
-0001ceb0: 2c20 3c69 6478 3e20 6f72 203c 706f 733e  , <idx> or <pos>
-0001cec0: 2061 7265 2073 7570 706c 6965 640a 2020   are supplied.  
-0001ced0: 2020 2020 2020 2020 2020 6275 7420 3c73            but <s
-0001cee0: 696e 676c 655f 736c 6963 653e 2069 7320  ingle_slice> is 
-0001cef0: 5472 7565 2c20 7468 6520 6365 6e74 7261  True, the centra
-0001cf00: 6c20 736c 6963 6520 6f66 2074 6869 7320  l slice of this 
-0001cf10: 524f 4920 7769 6c6c 2062 650a 2020 2020  ROI will be.    
-0001cf20: 2020 2020 2020 2020 7573 6564 2e0a 0a20          used... 
-0001cf30: 2020 2020 2020 2070 6f73 203a 2066 6c6f         pos : flo
-0001cf40: 6174 2c20 6465 6661 756c 743d 4e6f 6e65  at, default=None
-0001cf50: 0a20 2020 2020 2020 2020 2020 2053 6c69  .            Sli
-0001cf60: 6365 2070 6f73 6974 696f 6e20 696e 206d  ce position in m
-0001cf70: 6d2e 2049 6620 6e6f 6e65 206f 6620 3c73  m. If none of <s
-0001cf80: 6c3e 2c20 3c69 6478 3e20 6f72 203c 706f  l>, <idx> or <po
-0001cf90: 733e 2061 7265 2073 7570 706c 6965 640a  s> are supplied.
-0001cfa0: 2020 2020 2020 2020 2020 2020 6275 7420              but 
-0001cfb0: 3c73 696e 676c 655f 736c 6963 653e 2069  <single_slice> i
-0001cfc0: 7320 5472 7565 2c20 7468 6520 6365 6e74  s True, the cent
-0001cfd0: 7261 6c20 736c 6963 6520 6f66 2074 6869  ral slice of thi
-0001cfe0: 7320 524f 4920 7769 6c6c 0a20 2020 2020  s ROI will.     
-0001cff0: 2020 2020 2020 2062 6520 7573 6564 2e0a         be used..
-0001d000: 0a20 2020 2020 2020 206d 6574 686f 6420  .        method 
-0001d010: 3a20 7374 722c 2064 6566 6175 6c74 3d4e  : str, default=N
-0001d020: 6f6e 650a 2020 2020 2020 2020 2020 2020  one.            
-0001d030: 4d65 7468 6f64 2074 6f20 7573 6520 666f  Method to use fo
-0001d040: 7220 6361 6c63 756c 6174 696e 6720 696e  r calculating in
-0001d050: 7465 7273 6563 7469 6f6e 2c20 756e 696f  tersection, unio
-0001d060: 6e2c 2061 6e64 206d 6561 6e0a 2020 2020  n, and mean.    
-0001d070: 2020 2020 2020 2020 7369 7a65 2e20 4361          size. Ca
-0001d080: 6e20 6265 3a20 0a20 2020 2020 2020 2020  n be: .         
-0001d090: 2020 2020 2020 202d 2022 636f 6e74 6f75         - "contou
-0001d0a0: 7222 3a20 6765 7420 696e 7465 7273 6563  r": get intersec
-0001d0b0: 7469 6f6e 7320 616e 6420 6172 6561 7320  tions and areas 
-0001d0c0: 6f66 2073 6861 7065 6c79 2063 6f6e 746f  of shapely conto
-0001d0d0: 7572 732e 0a20 2020 2020 2020 2020 2020  urs..           
-0001d0e0: 2020 2020 202d 2022 6d61 736b 223a 2063       - "mask": c
-0001d0f0: 6f75 6e74 2069 6e74 6572 7365 6374 696e  ount intersectin
-0001d100: 6720 766f 7865 6c73 2069 6e20 6269 6e61  g voxels in bina
-0001d110: 7279 206d 6173 6b73 2e0a 2020 2020 2020  ry masks..      
-0001d120: 2020 2020 2020 2020 2020 2d20 4e6f 6e65            - None
-0001d130: 3a20 7573 6520 7468 6520 6d65 7468 6f64  : use the method
-0001d140: 2073 6574 2069 6e20 7365 6c66 2e64 6566   set in self.def
-0001d150: 6175 6c74 5f67 656f 6d5f 6d65 7468 6f64  ault_geom_method
-0001d160: 2e0a 0a20 2020 2020 2020 2066 6c61 7474  ...        flatt
-0001d170: 656e 203a 2062 6f6f 6c2c 2064 6566 6175  en : bool, defau
-0001d180: 6c74 3d46 616c 7365 0a20 2020 2020 2020  lt=False.       
-0001d190: 2020 2020 2049 6620 5472 7565 2c20 616c       If True, al
-0001d1a0: 6c20 736c 6963 6573 2077 696c 6c20 6265  l slices will be
-0001d1b0: 2066 6c61 7474 656e 6564 2069 6e20 7468   flattened in th
-0001d1c0: 6520 6769 7665 6e20 6f72 6965 6e74 6174  e given orientat
-0001d1d0: 696f 6e20 616e 640a 2020 2020 2020 2020  ion and.        
-0001d1e0: 2020 2020 7468 6520 6172 6561 7320 6f66      the areas of
-0001d1f0: 2069 6e74 6572 7365 6374 696f 6e20 616e   intersection an
-0001d200: 6420 756e 696f 6e2c 2061 6e64 2074 6865  d union, and the
-0001d210: 206d 6561 6e20 524f 4920 6172 6561 2c0a   mean ROI area,.
-0001d220: 2020 2020 2020 2020 2020 2020 7769 6c6c              will
-0001d230: 2062 6520 7265 7475 726e 6564 2066 6f72   be returned for
-0001d240: 2074 6865 2066 6c61 7474 656e 6564 2073   the flattened s
-0001d250: 6c69 6365 732e 204f 6e6c 7920 6176 6169  lices. Only avai
-0001d260: 6c61 626c 650a 2020 2020 2020 2020 2020  lable.          
-0001d270: 2020 6966 206d 6574 686f 643d 226d 6173    if method="mas
-0001d280: 6b22 2e0a 2020 2020 2020 2020 2222 220a  k"..        """.
-0001d290: 0a20 2020 2020 2020 2073 656c 662e 6372  .        self.cr
-0001d2a0: 6561 7465 5f6d 6173 6b28 290a 0a20 2020  eate_mask()..   
-0001d2b0: 2020 2020 2023 2044 6566 696e 6520 766f       # Define vo
-0001d2c0: 7865 6c20 766f 6c75 6d65 2c20 616e 6420  xel volume, and 
-0001d2d0: 766f 7865 6c20 6172 6561 2069 6e20 7669  voxel area in vi
-0001d2e0: 6577 2e0a 2020 2020 2020 2020 766f 7865  ew..        voxe
-0001d2f0: 6c5f 766f 6c75 6d65 203d 2031 0a20 2020  l_volume = 1.   
-0001d300: 2020 2020 2066 6f72 2064 7879 7a20 696e       for dxyz in
-0001d310: 2073 656c 662e 6d61 736b 2e76 6f78 656c   self.mask.voxel
-0001d320: 5f73 697a 653a 0a20 2020 2020 2020 2020  _size:.         
-0001d330: 2020 2076 6f78 656c 5f76 6f6c 756d 6520     voxel_volume 
-0001d340: 2a3d 2064 7879 7a0a 2020 2020 2020 2020  *= dxyz.        
-0001d350: 7a5f 6178 203d 2073 6b72 742e 696d 6167  z_ax = skrt.imag
-0001d360: 652e 5f73 6c69 6365 5f61 7865 735b 7669  e._slice_axes[vi
-0001d370: 6577 5d0a 2020 2020 2020 2020 736c 6963  ew].        slic
-0001d380: 655f 7468 6963 6b6e 6573 7320 3d20 7365  e_thickness = se
-0001d390: 6c66 2e6d 6173 6b2e 766f 7865 6c5f 7369  lf.mask.voxel_si
-0001d3a0: 7a65 5b7a 5f61 785d 0a20 2020 2020 2020  ze[z_ax].       
-0001d3b0: 2076 6f78 656c 5f61 7265 6120 3d20 766f   voxel_area = vo
-0001d3c0: 7865 6c5f 766f 6c75 6d65 202f 2073 6c69  xel_volume / sli
-0001d3d0: 6365 5f74 6869 636b 6e65 7373 0a0a 2020  ce_thickness..  
-0001d3e0: 2020 2020 2020 2320 4765 7420 6465 6661        # Get defa
-0001d3f0: 756c 7420 736c 6963 6520 616e 6420 6d65  ult slice and me
-0001d400: 7468 6f64 0a20 2020 2020 2020 2069 6620  thod.        if 
-0001d410: 7369 6e67 6c65 5f73 6c69 6365 3a0a 2020  single_slice:.  
-0001d420: 2020 2020 2020 2020 2020 6966 2073 6c20            if sl 
-0001d430: 6973 204e 6f6e 6520 616e 6420 6964 7820  is None and idx 
-0001d440: 6973 204e 6f6e 6520 616e 6420 706f 7320  is None and pos 
-0001d450: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
-0001d460: 2020 2020 2020 2020 2069 6478 203d 2073           idx = s
-0001d470: 656c 662e 6765 745f 6d69 645f 6964 7828  elf.get_mid_idx(
-0001d480: 7669 6577 290a 2020 2020 2020 2020 6966  view).        if
-0001d490: 206d 6574 686f 6420 6973 204e 6f6e 653a   method is None:
-0001d4a0: 0a20 2020 2020 2020 2020 2020 206d 6574  .            met
-0001d4b0: 686f 6420 3d20 7365 6c66 2e64 6566 6175  hod = self.defau
-0001d4c0: 6c74 5f67 656f 6d5f 6d65 7468 6f64 0a0a  lt_geom_method..
-0001d4d0: 2020 2020 2020 2020 6966 2066 6c61 7474          if flatt
-0001d4e0: 656e 3a20 2023 2046 6c61 7474 656e 696e  en:  # Flattenin
-0001d4f0: 6720 6f6e 6c79 2070 6f73 7369 626c 6520  g only possible 
-0001d500: 7769 7468 2022 6d61 736b 220a 2020 2020  with "mask".    
-0001d510: 2020 2020 2020 2020 6d65 7468 6f64 203d          method =
-0001d520: 2022 6d61 736b 220a 0a20 2020 2020 2020   "mask"..       
-0001d530: 2023 2043 616c 6375 6c61 7465 2069 6e74   # Calculate int
-0001d540: 6572 7365 6374 696f 6e73 2061 6e64 2061  ersections and a
-0001d550: 7265 6173 2066 726f 6d20 706f 6c79 676f  reas from polygo
-0001d560: 6e73 0a20 2020 2020 2020 2069 6620 6d65  ns.        if me
-0001d570: 7468 6f64 203d 3d20 2263 6f6e 746f 7572  thod == "contour
-0001d580: 223a 0a0a 2020 2020 2020 2020 2020 2020  ":..            
-0001d590: 2320 4765 7420 706f 7369 7469 6f6e 7320  # Get positions 
-0001d5a0: 6f66 2073 6c69 6365 2873 290a 2020 2020  of slice(s).    
-0001d5b0: 2020 2020 2020 2020 2320 6f6e 2077 6869          # on whi
-0001d5c0: 6368 2074 6f20 636f 6d70 6172 6520 6172  ch to compare ar
-0001d5d0: 6561 7320 616e 6420 746f 7461 6c20 6172  eas and total ar
-0001d5e0: 6561 732e 0a20 2020 2020 2020 2020 2020  eas..           
-0001d5f0: 2069 6620 6e6f 7420 7369 6e67 6c65 5f73   if not single_s
-0001d600: 6c69 6365 3a0a 2020 2020 2020 2020 2020  lice:.          
-0001d610: 2020 2020 2020 706f 7369 7469 6f6e 7320        positions 
-0001d620: 3d20 7365 7428 7365 6c66 2e67 6574 5f63  = set(self.get_c
-0001d630: 6f6e 746f 7572 7328 2278 2d79 2229 2e6b  ontours("x-y").k
-0001d640: 6579 7328 2929 2e75 6e69 6f6e 280a 2020  eys()).union(.  
-0001d650: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d660: 2020 2020 2020 7365 7428 6f74 6865 722e        set(other.
-0001d670: 6765 745f 636f 6e74 6f75 7273 2822 782d  get_contours("x-
-0001d680: 7922 292e 6b65 7973 2829 2929 0a20 2020  y").keys())).   
-0001d690: 2020 2020 2020 2020 2020 2020 2061 7265               are
-0001d6a0: 6173 3120 3d20 5b73 656c 662e 6765 745f  as1 = [self.get_
-0001d6b0: 6172 6561 2822 782d 7922 2c20 706f 733d  area("x-y", pos=
-0001d6c0: 702c 206d 6574 686f 643d 6d65 7468 6f64  p, method=method
-0001d6d0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0001d6e0: 2020 2020 2020 2020 2020 666f 7220 7020            for p 
-0001d6f0: 696e 2070 6f73 6974 696f 6e73 5d0a 2020  in positions].  
-0001d700: 2020 2020 2020 2020 2020 2020 2020 766f                vo
-0001d710: 6c75 6d65 7331 203d 205b 6120 2a20 736c  lumes1 = [a * sl
-0001d720: 6963 655f 7468 6963 6b6e 6573 7320 666f  ice_thickness fo
-0001d730: 7220 6120 696e 2061 7265 6173 3120 6966  r a in areas1 if
-0001d740: 2061 5d0a 2020 2020 2020 2020 2020 2020   a].            
-0001d750: 2020 2020 766f 6c75 6d65 3120 3d20 7375      volume1 = su
-0001d760: 6d28 766f 6c75 6d65 7331 290a 2020 2020  m(volumes1).    
-0001d770: 2020 2020 2020 2020 2020 2020 6172 6561              area
-0001d780: 7332 203d 205b 6f74 6865 722e 6765 745f  s2 = [other.get_
-0001d790: 6172 6561 2822 782d 7922 2c20 706f 733d  area("x-y", pos=
-0001d7a0: 702c 206d 6574 686f 643d 6d65 7468 6f64  p, method=method
-0001d7b0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0001d7c0: 2020 2020 2020 2020 2020 666f 7220 7020            for p 
-0001d7d0: 696e 2070 6f73 6974 696f 6e73 5d0a 2020  in positions].  
-0001d7e0: 2020 2020 2020 2020 2020 2020 2020 766f                vo
-0001d7f0: 6c75 6d65 7332 203d 205b 6120 2a20 736c  lumes2 = [a * sl
-0001d800: 6963 655f 7468 6963 6b6e 6573 7320 666f  ice_thickness fo
-0001d810: 7220 6120 696e 2061 7265 6173 3220 6966  r a in areas2 if
-0001d820: 2061 5d0a 2020 2020 2020 2020 2020 2020   a].            
-0001d830: 2020 2020 766f 6c75 6d65 3220 3d20 7375      volume2 = su
-0001d840: 6d28 766f 6c75 6d65 7332 290a 2020 2020  m(volumes2).    
-0001d850: 2020 2020 2020 2020 2020 2020 6d65 616e              mean
-0001d860: 5f73 697a 6520 3d20 302e 3520 2a20 2876  _size = 0.5 * (v
-0001d870: 6f6c 756d 6531 202b 2076 6f6c 756d 6532  olume1 + volume2
-0001d880: 290a 2020 2020 2020 2020 2020 2020 656c  ).            el
-0001d890: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-0001d8a0: 2020 2020 706f 7369 7469 6f6e 7320 3d20      positions = 
-0001d8b0: 5b0a 2020 2020 2020 2020 2020 2020 2020  [.              
-0001d8c0: 2020 2020 2020 7365 6c66 2e69 6478 5f74        self.idx_t
-0001d8d0: 6f5f 706f 7328 7365 6c66 2e67 6574 5f69  o_pos(self.get_i
-0001d8e0: 6478 2876 6965 772c 2073 6c2c 2069 6478  dx(view, sl, idx
-0001d8f0: 2c20 706f 7329 2c0a 2020 2020 2020 2020  , pos),.        
-0001d900: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d910: 2020 2020 2020 2020 2020 2020 6178 3d73              ax=s
-0001d920: 6b72 742e 696d 6167 652e 5f73 6c69 6365  krt.image._slice
-0001d930: 5f61 7865 735b 7669 6577 5d29 0a20 2020  _axes[view]).   
-0001d940: 2020 2020 2020 2020 2020 2020 205d 0a20               ]. 
-0001d950: 2020 2020 2020 2020 2020 2020 2020 2061                 a
-0001d960: 7265 6131 203d 2073 656c 662e 6765 745f  rea1 = self.get_
-0001d970: 6172 6561 2876 6965 772c 2073 6c2c 2069  area(view, sl, i
-0001d980: 6478 2c20 706f 732c 206d 6574 686f 643d  dx, pos, method=
-0001d990: 6d65 7468 6f64 290a 2020 2020 2020 2020  method).        
-0001d9a0: 2020 2020 2020 2020 6966 2061 7265 6131          if area1
-0001d9b0: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
-0001d9c0: 2020 2020 2020 2020 2020 2020 2020 6172                ar
-0001d9d0: 6561 3120 3d20 300a 2020 2020 2020 2020  ea1 = 0.        
-0001d9e0: 2020 2020 2020 2020 6172 6561 3220 3d20          area2 = 
-0001d9f0: 6f74 6865 722e 6765 745f 6172 6561 2876  other.get_area(v
-0001da00: 6965 772c 2073 6c2c 2069 6478 2c20 706f  iew, sl, idx, po
-0001da10: 732c 206d 6574 686f 643d 6d65 7468 6f64  s, method=method
-0001da20: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0001da30: 2020 6966 2061 7265 6132 2069 7320 4e6f    if area2 is No
-0001da40: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-0001da50: 2020 2020 2020 2020 6172 6561 3220 3d20          area2 = 
-0001da60: 300a 2020 2020 2020 2020 2020 2020 2020  0.              
-0001da70: 2020 6d65 616e 5f73 697a 6520 3d20 302e    mean_size = 0.
-0001da80: 3520 2a20 2861 7265 6131 202b 2061 7265  5 * (area1 + are
-0001da90: 6132 290a 2020 2020 2020 2020 2020 2020  a2).            
-0001daa0: 0a20 2020 2020 2020 2020 2020 2023 2043  .            # C
-0001dab0: 6f6d 7075 7465 2061 7265 6173 206f 6620  ompute areas of 
-0001dac0: 696e 7465 7273 6563 7469 6f6e 2061 6e64  intersection and
-0001dad0: 2075 6e69 6f6e 206f 6e20 736c 6963 6528   union on slice(
-0001dae0: 7329 0a20 2020 2020 2020 2020 2020 2069  s).            i
-0001daf0: 6e74 6572 7365 6374 696f 6e20 3d20 300a  ntersection = 0.
-0001db00: 2020 2020 2020 2020 2020 2020 756e 696f              unio
-0001db10: 6e20 3d20 300a 2020 2020 2020 2020 2020  n = 0.          
-0001db20: 2020 6661 6374 6f72 203d 2031 2069 6620    factor = 1 if 
-0001db30: 2873 696e 676c 655f 736c 6963 6520 6f72  (single_slice or
-0001db40: 2066 6c61 7474 656e 2920 656c 7365 2073   flatten) else s
-0001db50: 6c69 6365 5f74 6869 636b 6e65 7373 0a20  lice_thickness. 
-0001db60: 2020 2020 2020 2020 2020 2066 6f72 2070             for p
-0001db70: 2069 6e20 706f 7369 7469 6f6e 733a 0a20   in positions:. 
-0001db80: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0001db90: 6574 3120 3d20 6f70 732e 756e 6172 795f  et1 = ops.unary_
-0001dba0: 756e 696f 6e28 7365 6c66 2e67 6574 5f70  union(self.get_p
-0001dbb0: 6f6c 7967 6f6e 735f 6f6e 5f73 6c69 6365  olygons_on_slice
-0001dbc0: 2876 6965 772c 2070 6f73 3d70 2929 0a20  (view, pos=p)). 
-0001dbd0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0001dbe0: 6574 3220 3d20 6f70 732e 756e 6172 795f  et2 = ops.unary_
-0001dbf0: 756e 696f 6e28 6f74 6865 722e 6765 745f  union(other.get_
-0001dc00: 706f 6c79 676f 6e73 5f6f 6e5f 736c 6963  polygons_on_slic
-0001dc10: 6528 7669 6577 2c20 706f 733d 7029 290a  e(view, pos=p)).
-0001dc20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001dc30: 696e 7465 7273 6563 7469 6f6e 202b 3d20  intersection += 
-0001dc40: 7365 7431 2e69 6e74 6572 7365 6374 696f  set1.intersectio
-0001dc50: 6e28 7365 7432 292e 6172 6561 202a 2066  n(set2).area * f
-0001dc60: 6163 746f 720a 2020 2020 2020 2020 2020  actor.          
-0001dc70: 2020 2020 2020 756e 696f 6e20 2b3d 2073        union += s
-0001dc80: 6574 312e 756e 696f 6e28 7365 7432 292e  et1.union(set2).
-0001dc90: 6172 6561 202a 2066 6163 746f 720a 0a20  area * factor.. 
-0001dca0: 2020 2020 2020 2023 2043 616c 6375 6c61         # Calcula
-0001dcb0: 7465 2069 6e74 6572 7365 6374 696f 6e73  te intersections
-0001dcc0: 2061 6e64 2061 7265 6173 2066 726f 6d20   and areas from 
-0001dcd0: 6269 6e61 7279 206d 6173 6b20 766f 7865  binary mask voxe
-0001dce0: 6c20 636f 756e 7473 0a20 2020 2020 2020  l counts.       
-0001dcf0: 2065 6c73 653a 0a0a 2020 2020 2020 2020   else:..        
-0001dd00: 2020 2020 2320 5573 6520 3344 206d 6173      # Use 3D mas
-0001dd10: 6b0a 2020 2020 2020 2020 2020 2020 6966  k.            if
-0001dd20: 206e 6f74 2073 696e 676c 655f 736c 6963   not single_slic
-0001dd30: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-0001dd40: 2020 2064 6174 6131 203d 2073 656c 662e     data1 = self.
-0001dd50: 6765 745f 6d61 736b 2876 6965 772c 2066  get_mask(view, f
-0001dd60: 6c61 7474 656e 2c20 7374 616e 6461 7264  latten, standard
-0001dd70: 6973 653d 5472 7565 290a 2020 2020 2020  ise=True).      
-0001dd80: 2020 2020 2020 2020 2020 6461 7461 3220            data2 
-0001dd90: 3d20 6f74 6865 722e 6765 745f 6d61 736b  = other.get_mask
-0001dda0: 2876 6965 772c 2066 6c61 7474 656e 2c20  (view, flatten, 
-0001ddb0: 7374 616e 6461 7264 6973 653d 5472 7565  standardise=True
-0001ddc0: 290a 0a20 2020 2020 2020 2020 2020 2023  )..            #
-0001ddd0: 204f 7468 6572 7769 7365 2c20 7573 6520   Otherwise, use 
-0001dde0: 7369 6e67 6c65 2032 4420 736c 6963 650a  single 2D slice.
-0001ddf0: 2020 2020 2020 2020 2020 2020 656c 7365              else
-0001de00: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0001de10: 2020 6461 7461 3120 3d20 7365 6c66 2e67    data1 = self.g
-0001de20: 6574 5f73 6c69 6365 2876 6965 772c 2073  et_slice(view, s
-0001de30: 6c2c 2069 6478 2c20 706f 7329 0a20 2020  l, idx, pos).   
-0001de40: 2020 2020 2020 2020 2020 2020 2064 6174               dat
-0001de50: 6132 203d 206f 7468 6572 2e67 6574 5f73  a2 = other.get_s
-0001de60: 6c69 6365 2876 6965 772c 2073 6c2c 2069  lice(view, sl, i
-0001de70: 6478 2c20 706f 7329 0a0a 2020 2020 2020  dx, pos)..      
-0001de80: 2020 2020 2020 6661 6374 6f72 203d 2076        factor = v
-0001de90: 6f78 656c 5f61 7265 6120 6966 2028 7369  oxel_area if (si
-0001dea0: 6e67 6c65 5f73 6c69 6365 206f 7220 666c  ngle_slice or fl
-0001deb0: 6174 7465 6e29 2065 6c73 6520 766f 7865  atten) else voxe
-0001dec0: 6c5f 766f 6c75 6d65 0a20 2020 2020 2020  l_volume.       
-0001ded0: 2020 2020 2069 6e74 6572 7365 6374 696f       intersectio
-0001dee0: 6e20 3d20 2864 6174 6131 2026 2064 6174  n = (data1 & dat
-0001def0: 6132 292e 7375 6d28 2920 2a20 6661 6374  a2).sum() * fact
-0001df00: 6f72 0a20 2020 2020 2020 2020 2020 2075  or.            u
-0001df10: 6e69 6f6e 203d 2028 6461 7461 3120 7c20  nion = (data1 | 
-0001df20: 6461 7461 3229 2e73 756d 2829 202a 2066  data2).sum() * f
-0001df30: 6163 746f 720a 2020 2020 2020 2020 2020  actor.          
-0001df40: 2020 6d65 616e 5f73 697a 6520 3d20 302e    mean_size = 0.
-0001df50: 3520 2a20 2864 6174 6131 2e73 756d 2829  5 * (data1.sum()
-0001df60: 202b 2064 6174 6132 2e73 756d 2829 2920   + data2.sum()) 
-0001df70: 2a20 6661 6374 6f72 0a0a 2020 2020 2020  * factor..      
-0001df80: 2020 7265 7475 726e 2028 696e 7465 7273    return (inters
-0001df90: 6563 7469 6f6e 2c20 756e 696f 6e2c 206d  ection, union, m
-0001dfa0: 6561 6e5f 7369 7a65 290a 0a20 2020 2064  ean_size)..    d
-0001dfb0: 6566 2067 6574 5f6d 6574 7269 635f 6279  ef get_metric_by
-0001dfc0: 5f73 6c69 6365 2873 656c 662c 206f 7468  _slice(self, oth
-0001dfd0: 6572 2c20 6d65 7472 6963 3d4e 6f6e 652c  er, metric=None,
-0001dfe0: 2062 795f 736c 6963 653d 4e6f 6e65 2c0a   by_slice=None,.
-0001dff0: 2020 2020 2020 2020 2020 2020 7669 6577              view
-0001e000: 3d22 782d 7922 2c20 6d65 7468 6f64 3d4e  ="x-y", method=N
-0001e010: 6f6e 6529 3a0a 2020 2020 2020 2020 2222  one):.        ""
-0001e020: 220a 2020 2020 2020 2020 4765 7420 6469  ".        Get di
-0001e030: 6374 696f 6e61 7279 206f 6620 736c 6963  ctionary of slic
-0001e040: 652d 6279 2d73 6c69 6365 2076 616c 7565  e-by-slice value
-0001e050: 7320 666f 7220 636f 6d70 6172 6973 6f6e  s for comparison
-0001e060: 206d 6574 7269 632e 0a0a 2020 2020 2020   metric...      
-0001e070: 2020 4561 6368 206b 6579 206f 6620 7468    Each key of th
-0001e080: 6520 7265 7475 726e 6564 2064 6963 7469  e returned dicti
-0001e090: 6f6e 6172 7920 6973 2061 2073 6c69 6365  onary is a slice
-0001e0a0: 2070 6f73 6974 696f 6e20 286d 6d29 2c20   position (mm), 
-0001e0b0: 616e 640a 2020 2020 2020 2020 7468 6520  and.        the 
-0001e0c0: 6173 736f 6369 6174 6564 2076 616c 7565  associated value
-0001e0d0: 2069 7320 7468 6520 6d65 7472 6963 2076   is the metric v
-0001e0e0: 616c 7565 2066 6f72 2074 6865 2073 6c69  alue for the sli
-0001e0f0: 6365 2e0a 0a20 2020 2020 2020 202a 2a50  ce...        **P
-0001e100: 6172 616d 6574 6572 733a 2a2a 0a0a 2020  arameters:**..  
-0001e110: 2020 2020 2020 6f74 6865 7220 3a20 524f        other : RO
-0001e120: 490a 2020 2020 2020 2020 2020 2020 4f74  I.            Ot
-0001e130: 6865 7220 524f 4920 746f 2063 6f6d 7061  her ROI to compa
-0001e140: 7265 2077 6974 6820 7468 6973 2052 4f49  re with this ROI
-0001e150: 2e0a 0a20 2020 2020 2020 206d 6574 7269  ...        metri
-0001e160: 6320 3a20 7374 722c 2064 6566 6175 6c74  c : str, default
-0001e170: 3d4e 6f6e 650a 2020 2020 2020 2020 2020  =None.          
-0001e180: 2020 4d65 7472 6963 2074 6f20 6265 2065    Metric to be e
-0001e190: 7661 6c75 6174 6564 2e0a 0a20 2020 2020  valuated...     
-0001e1a0: 2020 2062 795f 736c 6963 653a 2073 7472     by_slice: str
-0001e1b0: 2c20 6465 6661 756c 743d 4e6f 6e65 0a20  , default=None. 
-0001e1c0: 2020 2020 2020 2020 2020 2053 6c69 6365             Slice
-0001e1d0: 7320 746f 2062 6520 636f 6e73 6964 6572  s to be consider
-0001e1e0: 6564 2e20 2054 6865 2076 616c 6964 2073  ed.  The valid s
-0001e1f0: 7065 6369 6669 6361 7469 6f6e 7320 6172  pecifications ar
-0001e200: 653a 0a0a 2020 2020 2020 2020 2020 2020  e:..            
-0001e210: 2d20 226c 6566 7422 3a20 636f 6e73 6964  - "left": consid
-0001e220: 6572 206f 6e6c 7920 736c 6963 6573 2063  er only slices c
-0001e230: 6f6e 7461 696e 696e 6720 7365 6c66 3b0a  ontaining self;.
-0001e240: 2020 2020 2020 2020 2020 2020 2d20 2272              - "r
-0001e250: 6967 6874 223a 2063 6f6e 7369 6465 7220  ight": consider 
-0001e260: 6f6e 6c79 2073 6c69 6365 7320 636f 6e74  only slices cont
-0001e270: 6169 6e69 6e67 206f 7468 6572 2072 6f69  aining other roi
-0001e280: 3b0a 2020 2020 2020 2020 2020 2020 2d20  ;.            - 
-0001e290: 2275 6e69 6f6e 223a 2063 6f6e 7369 6465  "union": conside
-0001e2a0: 7220 736c 6963 6573 2063 6f6e 7461 696e  r slices contain
-0001e2b0: 696e 6720 6569 7468 6572 206f 6620 7365  ing either of se
-0001e2c0: 6c66 2061 6e64 206f 7468 6572 2072 6f69  lf and other roi
-0001e2d0: 3b0a 2020 2020 2020 2020 2020 2020 2d20  ;.            - 
-0001e2e0: 2269 6e74 6572 7365 6374 696f 6e22 3a20  "intersection": 
-0001e2f0: 636f 6e73 6964 6572 2073 6c69 6365 7320  consider slices 
-0001e300: 636f 6e74 6169 6e69 6e67 2062 6f74 6820  containing both 
-0001e310: 6f66 2073 656c 6620 616e 640a 2020 2020  of self and.    
-0001e320: 2020 2020 2020 2020 2020 6f74 6865 7220            other 
-0001e330: 726f 692e 0a0a 2020 2020 2020 2020 2020  roi...          
-0001e340: 2020 4966 204e 6f6e 652c 2075 7365 2073    If None, use s
-0001e350: 6b72 742e 636f 7265 2e44 6566 6175 6c74  krt.core.Default
-0001e360: 7328 292e 6279 5f73 6c69 6365 0a0a 2020  s().by_slice..  
-0001e370: 2020 2020 2020 7669 6577 203a 2073 7472        view : str
-0001e380: 2c20 6465 6661 756c 743d 2278 2d79 220a  , default="x-y".
-0001e390: 2020 2020 2020 2020 2020 2020 4f72 6965              Orie
-0001e3a0: 6e74 6174 696f 6e20 6f66 2073 6c69 6365  ntation of slice
-0001e3b0: 7320 6f6e 2077 6869 6368 2074 6f20 6765  s on which to ge
-0001e3c0: 7420 6d65 7472 6963 2076 616c 7565 732e  t metric values.
-0001e3d0: 0a0a 2020 2020 2020 2020 6d65 7468 6f64  ..        method
-0001e3e0: 203a 2073 7472 2c20 6465 6661 756c 743d   : str, default=
-0001e3f0: 4e6f 6e65 0a20 2020 2020 2020 2020 2020  None.           
-0001e400: 204d 6574 686f 6420 746f 2075 7365 2066   Method to use f
-0001e410: 6f72 206d 6574 7269 6320 6361 6c63 756c  or metric calcul
-0001e420: 6174 696f 6e2e 2043 616e 2062 653a 200a  ation. Can be: .
-0001e430: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e440: 2d20 2263 6f6e 746f 7572 223a 2063 616c  - "contour": cal
-0001e450: 6375 6c61 7465 206d 6574 7269 6320 6672  culate metric fr
-0001e460: 6f6d 2073 6861 7065 6c79 2063 6f6e 746f  om shapely conto
-0001e470: 7572 732e 0a20 2020 2020 2020 2020 2020  urs..           
-0001e480: 2020 2020 202d 2022 6d61 736b 223a 2063       - "mask": c
-0001e490: 616c 6375 616c 7465 206d 6574 7269 6320  alcualte metric 
-0001e4a0: 6672 6f6d 2062 696e 6172 7920 6d61 736b  from binary mask
-0001e4b0: 732e 0a20 2020 2020 2020 2020 2020 2020  s..             
-0001e4c0: 2020 202d 204e 6f6e 653a 2075 7365 2074     - None: use t
-0001e4d0: 6865 206d 6574 686f 6420 7365 7420 696e  he method set in
-0001e4e0: 2073 656c 662e 6465 6661 756c 745f 6765   self.default_ge
-0001e4f0: 6f6d 5f6d 6574 686f 642e 0a20 2020 2020  om_method..     
-0001e500: 2020 2022 2222 0a20 2020 2020 2020 2069     """.        i
-0001e510: 6620 6d65 7472 6963 206e 6f74 2069 6e20  f metric not in 
-0001e520: 6765 745f 636f 6d70 6172 6973 6f6e 5f6d  get_comparison_m
-0001e530: 6574 7269 6373 2829 3a0a 2020 2020 2020  etrics():.      
-0001e540: 2020 2020 2020 7261 6973 6520 5275 6e74        raise Runt
-0001e550: 696d 6545 7272 6f72 2866 224d 6574 7269  imeError(f"Metri
-0001e560: 6320 7b6d 6574 7269 637d 206e 6f74 2072  c {metric} not r
-0001e570: 6563 6f67 6e69 7365 6420 6279 2022 0a20  ecognised by ". 
-0001e580: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e590: 2020 2020 2020 2022 524f 492e 6765 745f         "ROI.get_
-0001e5a0: 6d65 7472 6963 5f62 795f 736c 6963 6528  metric_by_slice(
-0001e5b0: 2922 290a 0a20 2020 2020 2020 2062 795f  )")..        by_
-0001e5c0: 736c 6963 6520 3d20 6279 5f73 6c69 6365  slice = by_slice
-0001e5d0: 206f 7220 736b 7274 2e63 6f72 652e 4465   or skrt.core.De
-0001e5e0: 6661 756c 7473 2829 2e62 795f 736c 6963  faults().by_slic
-0001e5f0: 650a 0a20 2020 2020 2020 2072 6574 7572  e..        retur
-0001e600: 6e20 7b70 6f73 3a20 6765 7461 7474 7228  n {pos: getattr(
-0001e610: 7365 6c66 2c20 6622 6765 745f 7b67 6574  self, f"get_{get
-0001e620: 5f6d 6574 7269 635f 6d65 7468 6f64 286d  _metric_method(m
-0001e630: 6574 7269 6329 7d22 2928 0a20 2020 2020  etric)}")(.     
-0001e640: 2020 2020 2020 206f 7468 6572 2c20 7369         other, si
-0001e650: 6e67 6c65 5f73 6c69 6365 3d54 7275 652c  ngle_slice=True,
-0001e660: 2076 6965 773d 7669 6577 2c20 706f 733d   view=view, pos=
-0001e670: 706f 732c 206d 6574 686f 643d 6d65 7468  pos, method=meth
-0001e680: 6f64 290a 2020 2020 2020 2020 2020 2020  od).            
-0001e690: 666f 7220 706f 7320 696e 2073 656c 662e  for pos in self.
-0001e6a0: 6765 745f 736c 6963 655f 706f 7369 7469  get_slice_positi
-0001e6b0: 6f6e 7328 6f74 6865 722c 2076 6965 772c  ons(other, view,
-0001e6c0: 206d 6574 686f 643d 6279 5f73 6c69 6365   method=by_slice
-0001e6d0: 297d 0a0a 2020 2020 6465 6620 6765 745f  )}..    def get_
-0001e6e0: 736c 6963 655f 7374 6174 2873 656c 662c  slice_stat(self,
-0001e6f0: 206f 7468 6572 2c20 6d65 7472 6963 3d4e   other, metric=N
-0001e700: 6f6e 652c 2073 6c69 6365 5f73 7461 743d  one, slice_stat=
-0001e710: 4e6f 6e65 2c20 6279 5f73 6c69 6365 3d4e  None, by_slice=N
-0001e720: 6f6e 652c 0a20 2020 2020 2020 2020 2020  one,.           
-0001e730: 2076 616c 7565 5f66 6f72 5f6e 6f6e 653d   value_for_none=
-0001e740: 4e6f 6e65 2c20 7669 6577 3d22 782d 7922  None, view="x-y"
-0001e750: 2c20 6d65 7468 6f64 3d4e 6f6e 652c 202a  , method=None, *
-0001e760: 2a73 6c69 6365 5f73 7461 745f 6b77 6172  *slice_stat_kwar
-0001e770: 6773 293a 0a20 2020 2020 2020 2022 2222  gs):.        """
-0001e780: 0a20 2020 2020 2020 2047 6574 2073 7461  .        Get sta
-0001e790: 7469 7374 6963 2066 6f72 2073 6c69 6365  tistic for slice
-0001e7a0: 2d62 792d 736c 6963 6520 636f 6d70 6172  -by-slice compar
-0001e7b0: 6973 6f6e 206d 6574 7269 632e 0a0a 2020  ison metric...  
-0001e7c0: 2020 2020 2020 2a2a 5061 7261 6d65 7465        **Paramete
-0001e7d0: 7273 3a2a 2a0a 0a20 2020 2020 2020 206f  rs:**..        o
-0001e7e0: 7468 6572 203a 2052 4f49 0a20 2020 2020  ther : ROI.     
-0001e7f0: 2020 2020 2020 204f 7468 6572 2052 4f49         Other ROI
-0001e800: 2074 6f20 636f 6d70 6172 6520 7769 7468   to compare with
-0001e810: 2074 6869 7320 524f 492e 0a0a 2020 2020   this ROI...    
-0001e820: 2020 2020 6d65 7472 6963 203a 2073 7472      metric : str
-0001e830: 2c20 6465 6661 756c 743d 4e6f 6e65 0a20  , default=None. 
-0001e840: 2020 2020 2020 2020 2020 204d 6574 7269             Metri
-0001e850: 6320 666f 7220 7768 6963 6820 7374 6174  c for which stat
-0001e860: 6973 7469 6320 666f 7220 736c 6963 652d  istic for slice-
-0001e870: 6279 2d73 6c69 6365 2076 616c 7565 730a  by-slice values.
-0001e880: 2020 2020 2020 2020 2020 2020 6973 2074              is t
-0001e890: 6f20 6265 2072 6574 7572 6e65 642e 0a0a  o be returned...
-0001e8a0: 2020 2020 2020 2020 736c 6963 655f 7374          slice_st
-0001e8b0: 6174 203a 2073 7472 2c20 6465 6661 756c  at : str, defaul
-0001e8c0: 743d 4e6f 6e65 0a20 2020 2020 2020 2020  t=None.         
-0001e8d0: 2020 2053 696e 676c 652d 7661 7269 6162     Single-variab
-0001e8e0: 6c65 2073 7461 7469 7374 6963 2873 2920  le statistic(s) 
-0001e8f0: 746f 2062 6520 7265 7475 726e 6564 2066  to be returned f
-0001e900: 6f72 2073 6c69 6365 2d62 792d 736c 6963  or slice-by-slic
-0001e910: 650a 2020 2020 2020 2020 2020 2020 4469  e.            Di
-0001e920: 6365 2073 636f 7265 732e 2020 5468 6973  ce scores.  This
-0001e930: 2073 686f 756c 6420 6265 2074 6865 206e   should be the n
-0001e940: 616d 6520 6f66 2074 6865 2066 756e 6374  ame of the funct
-0001e950: 696f 6e20 666f 720a 2020 2020 2020 2020  ion for.        
-0001e960: 2020 2020 6361 6c63 756c 6174 696f 6e20      calculation 
-0001e970: 6f66 2074 6865 2073 7461 7469 7374 6963  of the statistic
-0001e980: 2873 2920 696e 2074 6865 2050 7974 686f  (s) in the Pytho
-0001e990: 6e20 7374 6174 6973 7469 6373 206d 6f64  n statistics mod
-0001e9a0: 756c 653a 0a0a 2020 2020 2020 2020 2020  ule:..          
-0001e9b0: 2020 6874 7470 733a 2f2f 646f 6373 2e70    https://docs.p
-0001e9c0: 7974 686f 6e2e 6f72 672f 332f 6c69 6272  ython.org/3/libr
-0001e9d0: 6172 792f 7374 6174 6973 7469 6373 2e68  ary/statistics.h
-0001e9e0: 746d 6c0a 0a20 2020 2020 2020 2020 2020  tml..           
-0001e9f0: 2041 7661 696c 6162 6c65 206f 7074 696f   Available optio
-0001ea00: 6e73 2069 6e63 6c75 6465 3a20 226d 6561  ns include: "mea
-0001ea10: 6e22 2c20 226d 6564 6961 6e22 2c20 226d  n", "median", "m
-0001ea20: 6f64 6522 2c0a 2020 2020 2020 2020 2020  ode",.          
-0001ea30: 2020 2273 7464 6576 222c 2022 7175 616e    "stdev", "quan
-0001ea40: 7469 6c65 7322 2e0a 0a20 2020 2020 2020  tiles"...       
-0001ea50: 2062 795f 736c 6963 653a 2073 7472 2c20   by_slice: str, 
-0001ea60: 6465 6661 756c 743d 4e6f 6e65 0a20 2020  default=None.   
-0001ea70: 2020 2020 2020 2020 2053 6c69 6365 7320           Slices 
-0001ea80: 746f 2062 6520 636f 6e73 6964 6572 6564  to be considered
-0001ea90: 2e20 2054 6865 2076 616c 6964 2073 7065  .  The valid spe
-0001eaa0: 6369 6669 6361 7469 6f6e 7320 6172 653a  cifications are:
-0001eab0: 0a0a 2020 2020 2020 2020 2020 2020 2d20  ..            - 
-0001eac0: 226c 6566 7422 3a20 636f 6e73 6964 6572  "left": consider
-0001ead0: 206f 6e6c 7920 736c 6963 6573 2063 6f6e   only slices con
-0001eae0: 7461 696e 696e 6720 7365 6c66 3b0a 2020  taining self;.  
-0001eaf0: 2020 2020 2020 2020 2020 2d20 2272 6967            - "rig
-0001eb00: 6874 223a 2063 6f6e 7369 6465 7220 6f6e  ht": consider on
-0001eb10: 6c79 2073 6c69 6365 7320 636f 6e74 6169  ly slices contai
-0001eb20: 6e69 6e67 206f 7468 6572 2072 6f69 3b0a  ning other roi;.
-0001eb30: 2020 2020 2020 2020 2020 2020 2d20 2275              - "u
-0001eb40: 6e69 6f6e 223a 2063 6f6e 7369 6465 7220  nion": consider 
-0001eb50: 736c 6963 6573 2063 6f6e 7461 696e 696e  slices containin
-0001eb60: 6720 6569 7468 6572 206f 6620 7365 6c66  g either of self
-0001eb70: 2061 6e64 206f 7468 6572 2072 6f69 3b0a   and other roi;.
-0001eb80: 2020 2020 2020 2020 2020 2020 2d20 2269              - "i
-0001eb90: 6e74 6572 7365 6374 696f 6e22 3a20 636f  ntersection": co
-0001eba0: 6e73 6964 6572 2073 6c69 6365 7320 636f  nsider slices co
-0001ebb0: 6e74 6169 6e69 6e67 2062 6f74 6820 6f66  ntaining both of
-0001ebc0: 2073 656c 6620 616e 640a 2020 2020 2020   self and.      
-0001ebd0: 2020 2020 2020 2020 6f74 6865 7220 726f          other ro
-0001ebe0: 692e 0a0a 2020 2020 2020 2020 2020 2020  i...            
-0001ebf0: 4966 204e 6f6e 652c 2075 7365 2073 6b72  If None, use skr
-0001ec00: 742e 636f 7265 2e44 6566 6175 6c74 7328  t.core.Defaults(
-0001ec10: 292e 6279 5f73 6c69 6365 0a0a 2020 2020  ).by_slice..    
-0001ec20: 2020 2020 7661 6c75 655f 666f 725f 6e6f      value_for_no
-0001ec30: 6e65 203a 2066 6c6f 6174 2c20 6465 6661  ne : float, defa
-0001ec40: 756c 743d 4e6f 6e65 0a20 2020 2020 2020  ult=None.       
-0001ec50: 2020 2020 2056 616c 7565 2074 6f20 7375       Value to su
-0001ec60: 6273 7469 7475 7465 2066 6f72 2061 6e79  bstitute for any
-0001ec70: 204e 6f6e 6520 7661 6c75 6573 2061 6d6f   None values amo
-0001ec80: 6e67 2073 6c69 6365 0a20 2020 2020 2020  ng slice.       
-0001ec90: 2020 2020 206d 6574 7269 6320 7661 6c75       metric valu
-0001eca0: 6573 2e20 2049 6620 4e6f 6e65 2c20 4e6f  es.  If None, No
-0001ecb0: 6e65 2076 616c 7565 7320 616d 6f6e 6720  ne values among 
-0001ecc0: 7468 6520 6d65 7472 6963 2076 616c 7565  the metric value
-0001ecd0: 730a 2020 2020 2020 2020 2020 2020 6172  s.            ar
-0001ece0: 6520 6f6d 6974 7465 642e 0a0a 2020 2020  e omitted...    
-0001ecf0: 2020 2020 7669 6577 203a 2073 7472 2c20      view : str, 
-0001ed00: 6465 6661 756c 743d 2278 2d79 220a 2020  default="x-y".  
-0001ed10: 2020 2020 2020 2020 2020 4f72 6965 6e74            Orient
-0001ed20: 6174 696f 6e20 6f66 2073 6c69 6365 7320  ation of slices 
-0001ed30: 6f6e 2077 6869 6368 2074 6f20 6765 7420  on which to get 
-0001ed40: 6d65 7472 6963 2076 616c 7565 732e 0a0a  metric values...
-0001ed50: 2020 2020 2020 2020 6d65 7468 6f64 203a          method :
-0001ed60: 2073 7472 2c20 6465 6661 756c 743d 4e6f   str, default=No
-0001ed70: 6e65 0a20 2020 2020 2020 2020 2020 204d  ne.            M
-0001ed80: 6574 686f 6420 746f 2075 7365 2066 6f72  ethod to use for
-0001ed90: 206d 6574 7269 6320 6361 6c63 756c 6174   metric calculat
-0001eda0: 696f 6e2e 2043 616e 2062 653a 200a 2020  ion. Can be: .  
-0001edb0: 2020 2020 2020 2020 2020 2020 2020 2d20                - 
-0001edc0: 2263 6f6e 746f 7572 223a 2063 616c 6375  "contour": calcu
-0001edd0: 6c61 7465 206d 6574 7269 6320 6672 6f6d  late metric from
-0001ede0: 2073 6861 7065 6c79 2063 6f6e 746f 7572   shapely contour
-0001edf0: 732e 0a20 2020 2020 2020 2020 2020 2020  s..             
-0001ee00: 2020 202d 2022 6d61 736b 223a 2063 616c     - "mask": cal
-0001ee10: 6375 616c 7465 206d 6574 7269 6320 6672  cualte metric fr
-0001ee20: 6f6d 2062 696e 6172 7920 6d61 736b 732e  om binary masks.
-0001ee30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001ee40: 202d 204e 6f6e 653a 2075 7365 2074 6865   - None: use the
-0001ee50: 206d 6574 686f 6420 7365 7420 696e 2073   method set in s
-0001ee60: 656c 662e 6465 6661 756c 745f 6765 6f6d  elf.default_geom
-0001ee70: 5f6d 6574 686f 642e 0a0a 2020 2020 2020  _method...      
-0001ee80: 2020 736c 6963 655f 7374 6174 5f6b 7761    slice_stat_kwa
-0001ee90: 7267 7320 3a20 6469 6374 2c20 6465 6661  rgs : dict, defa
-0001eea0: 756c 743d 4e6f 6e65 0a20 2020 2020 2020  ult=None.       
-0001eeb0: 2020 2020 204b 6579 776f 7264 2061 7267       Keyword arg
-0001eec0: 756d 656e 7473 2074 6f20 6265 2070 6173  uments to be pas
-0001eed0: 7365 6420 746f 2066 756e 6374 696f 6e20  sed to function 
-0001eee0: 6f66 2073 7461 7469 7374 6963 730a 2020  of statistics.  
-0001eef0: 2020 2020 2020 2020 2020 6d6f 6475 6c65            module
-0001ef00: 2066 6f72 2063 616c 6375 6c61 7469 6f6e   for calculation
-0001ef10: 2072 656c 6174 6976 6520 746f 2073 6c69   relative to sli
-0001ef20: 6365 2076 616c 7565 732e 2020 466f 7220  ce values.  For 
-0001ef30: 6578 616d 706c 652c 0a20 2020 2020 2020  example,.       
-0001ef40: 2020 2020 2069 6620 7175 616e 7469 6c65       if quantile
-0001ef50: 7320 6172 6520 7265 7175 6972 6564 2066  s are required f
-0001ef60: 6f72 2031 3020 696e 7465 7276 616c 732c  or 10 intervals,
-0001ef70: 2072 6174 6865 7220 7468 616e 2066 6f72   rather than for
-0001ef80: 0a20 2020 2020 2020 2020 2020 2074 6865  .            the
-0001ef90: 2064 6566 6175 6c74 206f 6620 342c 2074   default of 4, t
-0001efa0: 6869 7320 6361 6e20 6265 2073 7065 6369  his can be speci
-0001efb0: 6669 6564 2075 7369 6e67 3a0a 0a20 2020  fied using:..   
-0001efc0: 2020 2020 2020 2020 2073 6c69 6365 5f73           slice_s
-0001efd0: 7461 745f 6b77 6172 6773 7b22 6e22 203a  tat_kwargs{"n" :
-0001efe0: 2031 307d 0a0a 2020 2020 2020 2020 2020   10}..          
-0001eff0: 2020 466f 7220 6176 6169 6c61 626c 6520    For available 
-0001f000: 6b65 7977 6f72 6420 6f70 7469 6f6e 732c  keyword options,
-0001f010: 2073 6565 2064 6f63 756d 656e 7461 7469   see documentati
-0001f020: 6f6e 206f 6620 7374 6174 6973 7469 6373  on of statistics
-0001f030: 0a20 2020 2020 2020 2020 2020 206d 6f64  .            mod
-0001f040: 756c 6520 6174 3a0a 0a20 2020 2020 2020  ule at:..       
-0001f050: 2020 2020 2068 7474 7073 3a2f 2f64 6f63       https://doc
-0001f060: 732e 7079 7468 6f6e 2e6f 7267 2f33 2f6c  s.python.org/3/l
-0001f070: 6962 7261 7279 2f73 7461 7469 7374 6963  ibrary/statistic
-0001f080: 732e 6874 6d6c 0a20 2020 2020 2020 2022  s.html.        "
-0001f090: 2222 0a20 2020 2020 2020 2062 795f 736c  "".        by_sl
-0001f0a0: 6963 6520 3d20 6279 5f73 6c69 6365 206f  ice = by_slice o
-0001f0b0: 7220 736b 7274 2e63 6f72 652e 4465 6661  r skrt.core.Defa
-0001f0c0: 756c 7473 2829 2e62 795f 736c 6963 650a  ults().by_slice.
-0001f0d0: 2020 2020 2020 2020 736c 6963 655f 7374          slice_st
-0001f0e0: 6174 5f6b 7761 7267 7320 3d20 736c 6963  at_kwargs = slic
-0001f0f0: 655f 7374 6174 5f6b 7761 7267 7320 6f72  e_stat_kwargs or
-0001f100: 207b 7d0a 0a20 2020 2020 2020 2072 6574   {}..        ret
-0001f110: 7572 6e20 736b 7274 2e63 6f72 652e 6765  urn skrt.core.ge
-0001f120: 745f 7374 6174 2873 656c 662e 6765 745f  t_stat(self.get_
-0001f130: 6d65 7472 6963 5f62 795f 736c 6963 6528  metric_by_slice(
-0001f140: 0a20 2020 2020 2020 2020 2020 206f 7468  .            oth
-0001f150: 6572 2c20 6d65 7472 6963 2c20 6279 5f73  er, metric, by_s
-0001f160: 6c69 6365 2c20 7669 6577 2c20 6d65 7468  lice, view, meth
-0001f170: 6f64 292c 0a20 2020 2020 2020 2020 2020  od),.           
-0001f180: 2076 616c 7565 5f66 6f72 5f6e 6f6e 652c   value_for_none,
-0001f190: 2073 6c69 6365 5f73 7461 742c 202a 2a73   slice_stat, **s
-0001f1a0: 6c69 6365 5f73 7461 745f 6b77 6172 6773  lice_stat_kwargs
-0001f1b0: 290a 0a20 2020 2064 6566 2067 6574 5f73  )..    def get_s
-0001f1c0: 6c69 6365 5f73 7461 7473 2873 656c 662c  lice_stats(self,
-0001f1d0: 206f 7468 6572 2c20 6d65 7472 6963 733d   other, metrics=
-0001f1e0: 4e6f 6e65 2c20 736c 6963 655f 7374 6174  None, slice_stat
-0001f1f0: 733d 4e6f 6e65 2c0a 2020 2020 2020 2020  s=None,.        
-0001f200: 2020 2020 6465 6661 756c 745f 6279 5f73      default_by_s
-0001f210: 6c69 6365 3d4e 6f6e 652c 206d 6574 686f  lice=None, metho
-0001f220: 643d 4e6f 6e65 2c20 7669 6577 3d22 782d  d=None, view="x-
-0001f230: 7922 2c0a 2020 2020 2020 2020 2020 2020  y",.            
-0001f240: 7365 7061 7261 7465 5f63 6f6d 706f 6e65  separate_compone
-0001f250: 6e74 733d 4661 6c73 6529 3a0a 2020 2020  nts=False):.    
-0001f260: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-0001f270: 4765 7420 6469 6374 696f 6e61 7279 206f  Get dictionary o
-0001f280: 6620 7374 6174 6973 7469 6373 2066 6f72  f statistics for
-0001f290: 2073 6c69 6365 2d62 792d 736c 6963 6520   slice-by-slice 
-0001f2a0: 636f 6d70 6172 6973 6f6e 206d 6574 7269  comparison metri
-0001f2b0: 6373 2e0a 0a20 2020 2020 2020 202a 2a50  cs...        **P
-0001f2c0: 6172 616d 6574 6572 733a 2a2a 0a0a 2020  arameters:**..  
-0001f2d0: 2020 2020 2020 6f74 6865 7220 3a20 524f        other : RO
-0001f2e0: 490a 2020 2020 2020 2020 2020 2020 4f74  I.            Ot
-0001f2f0: 6865 7220 524f 4920 746f 2063 6f6d 7061  her ROI to compa
-0001f300: 7265 2077 6974 6820 7468 6973 2052 4f49  re with this ROI
-0001f310: 2e0a 0a20 2020 2020 2020 206d 6574 7269  ...        metri
-0001f320: 6373 203a 2073 7472 2f6c 6973 742c 2064  cs : str/list, d
-0001f330: 6566 6175 6c74 3d4e 6f6e 650a 2020 2020  efault=None.    
-0001f340: 2020 2020 2020 2020 4d65 7472 6963 2873          Metric(s
-0001f350: 2920 666f 7220 7768 6963 6820 7374 6174  ) for which stat
-0001f360: 6973 7469 6328 7329 2066 6f72 2073 6c69  istic(s) for sli
-0001f370: 6365 2d62 792d 736c 6963 6520 6361 6c63  ce-by-slice calc
-0001f380: 756c 6174 696f 6e73 0a20 2020 2020 2020  ulations.       
-0001f390: 2020 2020 2061 7265 2074 6f20 6265 2072       are to be r
-0001f3a0: 6574 7572 6e65 642e 2020 4120 7369 6e67  eturned.  A sing
-0001f3b0: 6c65 206d 6574 7269 6320 6361 6e20 6279  le metric can by
-0001f3c0: 2073 7065 6669 6369 6564 2061 7320 6120   speficied as a 
-0001f3d0: 7374 7269 6e67 2e0a 2020 2020 2020 2020  string..        
-0001f3e0: 2020 2020 4d75 6c74 6970 6c65 206d 6574      Multiple met
-0001f3f0: 7269 6373 2063 616e 2062 6520 7370 6563  rics can be spec
-0001f400: 6966 6965 6420 6173 2061 206c 6973 7420  ified as a list 
-0001f410: 6f66 2073 7472 696e 6773 2e0a 0a20 2020  of strings...   
-0001f420: 2020 2020 2073 6c69 6365 5f73 7461 7473       slice_stats
-0001f430: 203a 2073 7472 2f6c 6973 742f 6469 6374   : str/list/dict
-0001f440: 2c20 6465 6661 756c 743d 4e6f 6e65 0a20  , default=None. 
-0001f450: 2020 2020 2020 2020 2020 2053 7065 6369             Speci
-0001f460: 6669 6361 7469 6f6e 206f 6620 7374 6174  fication of stat
-0001f470: 6973 7469 6373 2074 6f20 6265 2063 616c  istics to be cal
-0001f480: 6375 6c61 7465 6420 7265 6c61 7469 7665  culated relative
-0001f490: 0a20 2020 2020 2020 2020 2020 2074 6f20  .            to 
-0001f4a0: 736c 6963 652d 6279 2d73 6c69 6365 206d  slice-by-slice m
-0001f4b0: 6574 7269 6320 7661 6c75 6573 2e20 2055  etric values.  U
-0001f4c0: 7365 6420 666f 7220 616c 6c20 6d65 7472  sed for all metr
-0001f4d0: 6963 7320 7769 7468 0a20 2020 2020 2020  ics with.       
-0001f4e0: 2020 2020 2073 7566 6669 7820 225f 736c       suffix "_sl
-0001f4f0: 6963 655f 7374 6174 7322 2069 6e20 7468  ice_stats" in th
-0001f500: 6520 3c6d 6574 7269 6373 3e20 6c69 7374  e <metrics> list
-0001f510: 2e0a 0a20 2020 2020 2020 2020 2020 2041  ...            A
-0001f520: 2073 7461 7469 7374 6963 2069 7320 7370   statistic is sp
-0001f530: 6563 6966 6965 6420 6279 2074 6865 206e  ecified by the n
-0001f540: 616d 6520 6f66 2074 6865 2066 756e 6374  ame of the funct
-0001f550: 696f 6e20 666f 720a 2020 2020 2020 2020  ion for.        
-0001f560: 2020 2020 6974 7320 6361 6c63 756c 6174      its calculat
-0001f570: 696f 6e20 696e 2074 6865 2050 7974 686f  ion in the Pytho
-0001f580: 6e20 7374 6174 6973 7469 6373 206d 6f64  n statistics mod
-0001f590: 756c 653a 0a0a 2020 2020 2020 2020 2020  ule:..          
-0001f5a0: 2020 6874 7470 733a 2f2f 646f 6373 2e70    https://docs.p
-0001f5b0: 7974 686f 6e2e 6f72 672f 332f 6c69 6272  ython.org/3/libr
-0001f5c0: 6172 792f 7374 6174 6973 7469 6373 2e68  ary/statistics.h
-0001f5d0: 746d 6c0a 0a20 2020 2020 2020 2020 2020  tml..           
-0001f5e0: 2046 6f72 2069 7473 2075 7365 2068 6572   For its use her
-0001f5f0: 652c 2074 6865 2072 656c 6576 616e 7420  e, the relevant 
-0001f600: 6675 6e63 7469 6f6e 206d 7573 7420 7265  function must re
-0001f610: 7175 6972 650a 2020 2020 2020 2020 2020  quire.          
-0001f620: 2020 6120 7369 6e67 6c65 2d76 6172 6961    a single-varia
-0001f630: 626c 6520 696e 7075 742c 206d 7573 7420  ble input, must 
-0001f640: 6e6f 7420 7265 7175 6972 6520 616e 7920  not require any 
-0001f650: 6b65 7977 6f72 640a 2020 2020 2020 2020  keyword.        
-0001f660: 2020 2020 6172 6775 6d65 6e74 732c 2061      arguments, a
-0001f670: 6e64 206d 7573 7420 7265 7475 726e 2061  nd must return a
-0001f680: 2073 696e 676c 6520 6e75 6d62 6572 2e0a   single number..
-0001f690: 0a20 2020 2020 2020 2020 2020 2041 7661  .            Ava
-0001f6a0: 696c 6162 6c65 206f 7074 696f 6e73 2069  ilable options i
-0001f6b0: 6e63 6c75 6465 3a20 226d 6561 6e22 2c20  nclude: "mean", 
-0001f6c0: 226d 6564 6961 6e22 2c20 226d 6f64 6522  "median", "mode"
-0001f6d0: 2c0a 2020 2020 2020 2020 2020 2020 2273  ,.            "s
-0001f6e0: 7464 6576 222e 0a0a 2020 2020 2020 2020  tdev"...        
-0001f6f0: 2020 2053 7461 7469 7374 6963 7320 746f     Statistics to
-0001f700: 2062 6520 6361 6c63 756c 6174 6564 2063   be calculated c
-0001f710: 616e 2062 6520 7370 6563 6966 6965 6420  an be specified 
-0001f720: 7573 696e 6720 616e 7920 6f66 0a20 2020  using any of.   
-0001f730: 2020 2020 2020 2020 7468 6520 666f 6c6c          the foll
-0001f740: 6f77 696e 673a 0a0a 2020 2020 2020 2020  owing:..        
-0001f750: 2020 202d 2053 7472 696e 6720 7370 6563     - String spec
-0001f760: 6966 7969 6e67 2073 696e 676c 6520 7374  ifying single st
-0001f770: 6174 6973 7469 6320 746f 2062 6520 6361  atistic to be ca
-0001f780: 6c63 756c 6174 6564 2c0a 2020 2020 2020  lculated,.      
-0001f790: 2020 2020 2020 2077 6974 6820 736c 6963         with slic
-0001f7a0: 6573 2063 6f6e 7369 6465 7265 6420 6173  es considered as
-0001f7b0: 2067 6976 656e 2062 7920 6465 6661 756c   given by defaul
-0001f7c0: 745f 6279 5f73 6c69 6365 2c0a 2020 2020  t_by_slice,.    
-0001f7d0: 2020 2020 2020 2020 2066 6f72 2065 7861           for exa
-0001f7e0: 6d70 6c65 3a20 226d 6561 6e22 3b0a 2020  mple: "mean";.  
-0001f7f0: 2020 2020 2020 2020 202d 204c 6973 7420           - List 
-0001f800: 7370 6563 6966 7969 6e67 206d 756c 7469  specifying multi
-0001f810: 706c 6520 7374 6174 6973 7469 6373 2074  ple statistics t
-0001f820: 6f20 6265 2063 616c 6375 6c61 7465 642c  o be calculated,
-0001f830: 0a20 2020 2020 2020 2020 2020 2020 7769  .             wi
-0001f840: 7468 2073 6c69 6365 7320 636f 6e73 6964  th slices consid
-0001f850: 6572 6564 2061 7320 6769 7665 6e20 6279  ered as given by
-0001f860: 2064 6566 6175 6c74 5f62 795f 736c 6963   default_by_slic
-0001f870: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
-0001f880: 666f 7220 6578 616d 706c 653a 205b 226d  for example: ["m
-0001f890: 6561 6e22 2c20 2273 7464 6576 225d 3b0a  ean", "stdev"];.
-0001f8a0: 2020 2020 2020 2020 2020 202d 2044 6963             - Dic
-0001f8b0: 7469 6f6e 6172 7920 7768 6572 6520 6b65  tionary where ke
-0001f8c0: 7973 2073 7065 6369 6679 2073 6c69 6365  ys specify slice
-0001f8d0: 7320 746f 2062 6520 636f 6e73 6964 6572  s to be consider
-0001f8e0: 6564 2c0a 2020 2020 2020 2020 2020 2020  ed,.            
-0001f8f0: 2061 6e64 2076 616c 7565 7320 7370 6563   and values spec
-0001f900: 6966 7920 7374 6174 6973 7469 6373 2028  ify statistics (
-0001f910: 7374 7269 6e67 206f 7220 6c69 7374 292c  string or list),
-0001f920: 2066 6f72 0a20 2020 2020 2020 2020 2020   for.           
-0001f930: 2020 6578 616d 706c 653a 207b 2275 6e69    example: {"uni
-0001f940: 6f6e 223a 205b 226d 6561 6e22 2c20 2273  on": ["mean", "s
-0001f950: 7464 6576 225d 7d2e 2020 5661 6c69 6420  tdev"]}.  Valid 
-0001f960: 736c 6963 650a 2020 2020 2020 2020 2020  slice.          
-0001f970: 2020 2073 7065 6369 6669 6361 7469 6f6e     specification
-0001f980: 7320 6172 6520 6173 206c 6973 7465 6420  s are as listed 
-0001f990: 666f 7220 6465 6661 756c 745f 6279 5f73  for default_by_s
-0001f9a0: 6c69 6365 2e0a 0a20 2020 2020 2020 2064  lice...        d
-0001f9b0: 6566 6175 6c74 5f62 795f 736c 6963 653a  efault_by_slice:
-0001f9c0: 2073 7472 2c20 6465 6661 756c 743d 4e6f   str, default=No
-0001f9d0: 6e65 0a20 2020 2020 2020 2020 2020 2044  ne.            D
-0001f9e0: 6566 6175 6c74 2073 7065 6369 6669 6361  efault specifica
-0001f9f0: 7469 6f6e 206f 6620 736c 6963 6573 2074  tion of slices t
-0001fa00: 6f20 6265 2063 6f6e 7369 6465 7265 6420  o be considered 
-0001fa10: 7768 656e 0a20 2020 2020 2020 2020 2020  when.           
-0001fa20: 2063 616c 6375 6c61 7469 6e67 2073 6c69   calculating sli
-0001fa30: 6365 2d62 792d 736c 6963 6520 7374 6174  ce-by-slice stat
-0001fa40: 6973 7469 6373 2e20 2054 6865 2076 616c  istics.  The val
-0001fa50: 6964 2073 7065 6369 6669 6361 7469 6f6e  id specification
-0001fa60: 730a 2020 2020 2020 2020 2020 2020 6172  s.            ar
-0001fa70: 653a 0a0a 2020 2020 2020 2020 2020 2020  e:..            
-0001fa80: 2d20 226c 6566 7422 3a20 636f 6e73 6964  - "left": consid
-0001fa90: 6572 206f 6e6c 7920 736c 6963 6573 2063  er only slices c
-0001faa0: 6f6e 7461 696e 696e 6720 7365 6c66 3b0a  ontaining self;.
-0001fab0: 2020 2020 2020 2020 2020 2020 2d20 2272              - "r
-0001fac0: 6967 6874 223a 2063 6f6e 7369 6465 7220  ight": consider 
-0001fad0: 6f6e 6c79 2073 6c69 6365 7320 636f 6e74  only slices cont
-0001fae0: 6169 6e69 6e67 206f 7468 6572 2072 6f69  aining other roi
-0001faf0: 3b0a 2020 2020 2020 2020 2020 2020 2d20  ;.            - 
-0001fb00: 2275 6e69 6f6e 223a 2063 6f6e 7369 6465  "union": conside
-0001fb10: 7220 736c 6963 6573 2063 6f6e 7461 696e  r slices contain
-0001fb20: 696e 6720 6569 7468 6572 206f 6620 7365  ing either of se
-0001fb30: 6c66 2061 6e64 206f 7468 6572 2072 6f69  lf and other roi
-0001fb40: 3b0a 2020 2020 2020 2020 2020 2020 2d20  ;.            - 
-0001fb50: 2269 6e74 6572 7365 6374 696f 6e22 3a20  "intersection": 
-0001fb60: 636f 6e73 6964 6572 2073 6c69 6365 7320  consider slices 
-0001fb70: 636f 6e74 6169 6e69 6e67 2062 6f74 6820  containing both 
-0001fb80: 6f66 2073 656c 6620 616e 640a 2020 2020  of self and.    
-0001fb90: 2020 2020 2020 2020 2020 6f74 6865 7220            other 
-0001fba0: 726f 692e 0a0a 2020 2020 2020 2020 2020  roi...          
-0001fbb0: 2020 4966 204e 6f6e 652c 2075 7365 2073    If None, use s
-0001fbc0: 6b72 742e 636f 7265 2e44 6566 6175 6c74  krt.core.Default
-0001fbd0: 7328 292e 6279 5f73 6c69 6365 0a0a 2020  s().by_slice..  
-0001fbe0: 2020 2020 2020 7669 6577 203a 2073 7472        view : str
-0001fbf0: 2c20 6465 6661 756c 743d 2278 2d79 220a  , default="x-y".
-0001fc00: 2020 2020 2020 2020 2020 2020 4f72 6965              Orie
-0001fc10: 6e74 6174 696f 6e20 6f66 2073 6c69 6365  ntation of slice
-0001fc20: 7320 6f6e 2077 6869 6368 2074 6f20 6765  s on which to ge
-0001fc30: 7420 6d65 7472 6963 2076 616c 7565 732e  t metric values.
-0001fc40: 0a0a 2020 2020 2020 2020 6d65 7468 6f64  ..        method
-0001fc50: 203a 2073 7472 2c20 6465 6661 756c 743d   : str, default=
-0001fc60: 4e6f 6e65 0a20 2020 2020 2020 2020 2020  None.           
-0001fc70: 204d 6574 686f 6420 746f 2075 7365 2066   Method to use f
-0001fc80: 6f72 206d 6574 7269 6320 6361 6c63 756c  or metric calcul
-0001fc90: 6174 696f 6e2e 2043 616e 2062 653a 200a  ation. Can be: .
-0001fca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001fcb0: 2d20 2263 6f6e 746f 7572 223a 2063 616c  - "contour": cal
-0001fcc0: 6375 6c61 7465 206d 6574 7269 6320 6672  culate metric fr
-0001fcd0: 6f6d 2073 6861 7065 6c79 2063 6f6e 746f  om shapely conto
-0001fce0: 7572 732e 0a20 2020 2020 2020 2020 2020  urs..           
-0001fcf0: 2020 2020 202d 2022 6d61 736b 223a 2063       - "mask": c
-0001fd00: 616c 6375 6c61 7465 206d 6574 7269 6320  alculate metric 
-0001fd10: 6672 6f6d 2062 696e 6172 7920 6d61 736b  from binary mask
-0001fd20: 732e 0a20 2020 2020 2020 2020 2020 2020  s..             
-0001fd30: 2020 202d 204e 6f6e 653a 2075 7365 2074     - None: use t
-0001fd40: 6865 206d 6574 686f 6420 7365 7420 696e  he method set in
-0001fd50: 2073 656c 662e 6465 6661 756c 745f 6765   self.default_ge
-0001fd60: 6f6d 5f6d 6574 686f 642e 0a0a 2020 2020  om_method...    
-0001fd70: 2020 2020 7365 7061 7261 7465 5f63 6f6d      separate_com
-0001fd80: 706f 6e65 6e74 733a 2062 6f6f 6c2c 2064  ponents: bool, d
-0001fd90: 6566 6175 6c74 3d46 616c 7365 0a20 2020  efault=False.   
-0001fda0: 2020 2020 2020 2020 2049 6620 4661 6c73           If Fals
-0001fdb0: 652c 2072 6574 7572 6e20 6120 6d65 7472  e, return a metr
-0001fdc0: 6963 2072 6570 7265 7365 6e74 6564 2062  ic represented b
-0001fdd0: 7920 6120 7665 6374 6f72 2061 7320 610a  y a vector as a.
-0001fde0: 2020 2020 2020 2020 2020 2020 6c69 7374              list
-0001fdf0: 206f 6620 636f 6d70 6f6e 656e 7420 7661   of component va
-0001fe00: 6c75 6573 2e20 2049 6620 7472 7565 2c20  lues.  If true, 
-0001fe10: 7265 7475 726e 2061 2073 6570 6172 6174  return a separat
-0001fe20: 6520 6d65 7472 6963 2066 6f72 0a20 2020  e metric for.   
-0001fe30: 2020 2020 2020 2020 2065 6163 6820 636f           each co
-0001fe40: 6d70 6f6e 656e 742c 206c 6162 656c 6c69  mponent, labelli
-0001fe50: 6e67 2062 7920 7468 6520 636f 6d70 6f6e  ng by the compon
-0001fe60: 656e 7420 6178 6573 2064 6574 6572 6d69  ent axes determi
-0001fe70: 6e65 640a 2020 2020 2020 2020 2020 2020  ned.            
-0001fe80: 6672 6f6d 203c 7669 6577 3e2e 0a20 2020  from <view>..   
-0001fe90: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-0001fea0: 2069 6620 6d65 7472 6963 7320 6973 204e   if metrics is N
-0001feb0: 6f6e 6520 6f72 2073 6c69 6365 5f73 7461  one or slice_sta
-0001fec0: 7473 2069 7320 4e6f 6e65 3a0a 2020 2020  ts is None:.    
-0001fed0: 2020 2020 2020 2020 7265 7475 726e 207b          return {
-0001fee0: 7d0a 0a20 2020 2020 2020 2064 6566 6175  }..        defau
-0001fef0: 6c74 5f62 795f 736c 6963 6520 3d20 6465  lt_by_slice = de
-0001ff00: 6661 756c 745f 6279 5f73 6c69 6365 206f  fault_by_slice o
-0001ff10: 7220 736b 7274 2e63 6f72 652e 4465 6661  r skrt.core.Defa
-0001ff20: 756c 7473 2829 2e62 795f 736c 6963 650a  ults().by_slice.
-0001ff30: 0a20 2020 2020 2020 2023 2045 6e73 7572  .        # Ensur
-0001ff40: 6520 7468 6174 206d 6574 7269 6373 2069  e that metrics i
-0001ff50: 7320 6120 6e6f 6e2d 656d 7074 7920 6c69  s a non-empty li
-0001ff60: 7374 2e0a 2020 2020 2020 2020 6966 2069  st..        if i
-0001ff70: 7369 6e73 7461 6e63 6528 6d65 7472 6963  sinstance(metric
-0001ff80: 732c 2073 7472 293a 0a20 2020 2020 2020  s, str):.       
-0001ff90: 2020 2020 206d 6574 7269 6373 203d 205b       metrics = [
-0001ffa0: 6d65 7472 6963 735d 0a20 2020 2020 2020  metrics].       
-0001ffb0: 2065 6c69 6620 6e6f 7420 736b 7274 2e63   elif not skrt.c
-0001ffc0: 6f72 652e 6973 5f6c 6973 7428 6d65 7472  ore.is_list(metr
-0001ffd0: 6963 7329 3a0a 2020 2020 2020 2020 2020  ics):.          
-0001ffe0: 2020 7265 7475 726e 207b 7d0a 2020 2020    return {}.    
-0001fff0: 2020 2020 6d65 7472 6963 7320 3d20 5b6d      metrics = [m
-00020000: 6574 7269 6320 666f 7220 6d65 7472 6963  etric for metric
-00020010: 2069 6e20 6d65 7472 6963 730a 2020 2020   in metrics.    
-00020020: 2020 2020 2020 2020 2020 2020 6966 2066              if f
-00020030: 227b 6d65 7472 6963 7d5f 736c 6963 655f  "{metric}_slice_
-00020040: 7374 6174 7322 2069 6e20 6765 745f 636f  stats" in get_co
-00020050: 6d70 6172 6973 6f6e 5f6d 6574 7269 6373  mparison_metrics
-00020060: 2829 5d0a 2020 2020 2020 2020 6966 206e  ()].        if n
-00020070: 6f74 206d 6574 7269 6373 3a0a 2020 2020  ot metrics:.    
-00020080: 2020 2020 2020 2020 7265 7475 726e 207b          return {
-00020090: 7d0a 0a20 2020 2020 2020 2073 6c69 6365  }..        slice
-000200a0: 5f73 7461 7473 203d 2065 7870 616e 645f  _stats = expand_
-000200b0: 736c 6963 655f 7374 6174 7328 736c 6963  slice_stats(slic
-000200c0: 655f 7374 6174 732c 2064 6566 6175 6c74  e_stats, default
-000200d0: 5f62 795f 736c 6963 6529 0a20 2020 2020  _by_slice).     
-000200e0: 2020 2069 6620 6e6f 7420 736c 6963 655f     if not slice_
-000200f0: 7374 6174 733a 0a20 2020 2020 2020 2020  stats:.         
-00020100: 2020 2072 6574 7572 6e20 7b7d 0a0a 2020     return {}..  
-00020110: 2020 2020 2020 2320 4361 6c63 756c 6174        # Calculat
-00020120: 6520 7374 6174 6973 7469 6328 7329 2066  e statistic(s) f
-00020130: 6f72 206d 6574 7269 6320 7661 6c75 6573  or metric values
-00020140: 2063 616c 6375 6c61 7465 6420 736c 6963   calculated slic
-00020150: 6520 6279 2073 6c69 6365 2e0a 2020 2020  e by slice..    
-00020160: 2020 2020 6361 6c63 756c 6174 6564 5f73      calculated_s
-00020170: 6c69 6365 5f73 7461 7473 203d 207b 7d0a  lice_stats = {}.
-00020180: 2020 2020 2020 2020 666f 7220 6d65 7472          for metr
-00020190: 6963 2069 6e20 6d65 7472 6963 733a 0a20  ic in metrics:. 
-000201a0: 2020 2020 2020 2020 2020 2066 6f72 2062             for b
-000201b0: 795f 736c 6963 652c 2073 7461 7473 2069  y_slice, stats i
-000201c0: 6e20 736c 6963 655f 7374 6174 732e 6974  n slice_stats.it
-000201d0: 656d 7328 293a 0a20 2020 2020 2020 2020  ems():.         
-000201e0: 2020 2020 2020 2076 616c 7565 7320 3d20         values = 
-000201f0: 7365 6c66 2e67 6574 5f6d 6574 7269 635f  self.get_metric_
-00020200: 6279 5f73 6c69 6365 280a 2020 2020 2020  by_slice(.      
-00020210: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020220: 2020 6f74 6865 722c 206d 6574 7269 632c    other, metric,
-00020230: 2062 795f 736c 6963 652c 2076 6965 772c   by_slice, view,
-00020240: 206d 6574 686f 6429 0a20 2020 2020 2020   method).       
-00020250: 2020 2020 2020 2020 2066 6f72 2073 7461           for sta
-00020260: 7420 696e 2073 7461 7473 3a0a 2020 2020  t in stats:.    
-00020270: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020280: 6b65 7920 3d20 6622 7b6d 6574 7269 637d  key = f"{metric}
-00020290: 5f73 6c69 6365 5f7b 6279 5f73 6c69 6365  _slice_{by_slice
-000202a0: 7d5f 7b73 7461 747d 220a 2020 2020 2020  }_{stat}".      
-000202b0: 2020 2020 2020 2020 2020 2020 2020 6361                ca
-000202c0: 6c63 756c 6174 6564 5f73 6c69 6365 5f73  lculated_slice_s
-000202d0: 7461 7473 5b6b 6579 5d20 3d20 280a 2020  tats[key] = (.  
-000202e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000202f0: 2020 2020 2020 2020 2020 736b 7274 2e63            skrt.c
-00020300: 6f72 652e 6765 745f 7374 6174 2876 616c  ore.get_stat(val
-00020310: 7565 732c 2073 7461 743d 7374 6174 2929  ues, stat=stat))
-00020320: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00020330: 2020 2020 2069 6620 2873 6b72 742e 636f       if (skrt.co
-00020340: 7265 2e69 735f 6c69 7374 2863 616c 6375  re.is_list(calcu
-00020350: 6c61 7465 645f 736c 6963 655f 7374 6174  lated_slice_stat
-00020360: 735b 6b65 795d 290a 2020 2020 2020 2020  s[key]).        
-00020370: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020380: 2020 2020 616e 6420 7365 7061 7261 7465      and separate
-00020390: 5f63 6f6d 706f 6e65 6e74 7329 3a0a 2020  _components):.  
+00015a80: 203d 206d 6574 7269 630a 2020 2020 2020   = metric.      
+00015a90: 2020 2020 2020 2020 2020 6966 2022 766f            if "vo
+00015aa0: 6c75 6d65 2220 696e 206d 6574 7269 633a  lume" in metric:
+00015ab0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00015ac0: 2020 2020 2069 6620 766f 6c5f 756e 6974       if vol_unit
+00015ad0: 7320 3d3d 2022 6d6d 223a 0a20 2020 2020  s == "mm":.     
+00015ae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015af0: 2020 206e 616d 6520 2b3d 2022 2028 6d6d     name += " (mm
+00015b00: 5e33 2922 0a20 2020 2020 2020 2020 2020  ^3)".           
+00015b10: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+00015b20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015b30: 2020 2020 2020 206e 616d 6520 2b3d 2022         name += "
+00015b40: 2028 2220 2b20 766f 6c5f 756e 6974 7320   (" + vol_units 
+00015b50: 2b20 2229 220a 2020 2020 2020 2020 2020  + ")".          
+00015b60: 2020 2020 2020 656c 6966 2022 6172 6561        elif "area
+00015b70: 2220 696e 206d 6574 7269 633a 0a20 2020  " in metric:.   
+00015b80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015b90: 2069 6620 6172 6561 5f75 6e69 7473 203d   if area_units =
+00015ba0: 3d20 226d 6d22 3a0a 2020 2020 2020 2020  = "mm":.        
+00015bb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015bc0: 6e61 6d65 202b 3d20 2220 286d 6d5e 3229  name += " (mm^2)
+00015bd0: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+00015be0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+00015bf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015c00: 2020 2020 6e61 6d65 202b 3d20 2220 2822      name += " ("
+00015c10: 202b 2061 7265 615f 756e 6974 7320 2b20   + area_units + 
+00015c20: 2229 220a 2020 2020 2020 2020 2020 2020  ")".            
+00015c30: 2020 2020 656c 6966 2022 6c65 6e67 7468      elif "length
+00015c40: 2220 696e 206d 6574 7269 633a 0a20 2020  " in metric:.   
+00015c50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015c60: 206e 616d 6520 2b3d 2022 2028 2220 2b20   name += " (" + 
+00015c70: 6c65 6e67 7468 5f75 6e69 7473 202b 2022  length_units + "
+00015c80: 2922 0a20 2020 2020 2020 2020 2020 2020  )".             
+00015c90: 2020 2065 6c69 6620 2263 656e 7472 6f69     elif "centroi
+00015ca0: 6422 2069 6e20 6d65 7472 6963 3a0a 2020  d" in metric:.  
+00015cb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015cc0: 2020 6e61 6d65 202b 3d20 2220 2822 202b    name += " (" +
+00015cd0: 2063 656e 7472 6f69 645f 756e 6974 7320   centroid_units 
+00015ce0: 2b20 2229 220a 2020 2020 2020 2020 2020  + ")".          
+00015cf0: 2020 2020 2020 6765 6f6d 5f6e 616d 6564        geom_named
+00015d00: 5b6e 616d 655d 203d 2076 616c 0a0a 2020  [name] = val..  
+00015d10: 2020 2020 2020 2320 4164 6a75 7374 206e        # Adjust n
+00015d20: 756d 6265 7220 6f66 2064 6563 696d 616c  umber of decimal
+00015d30: 2070 6c61 6365 730a 2020 2020 2020 2020   places.        
+00015d40: 6966 2064 6563 696d 616c 5f70 6c61 6365  if decimal_place
+00015d50: 7320 6973 206e 6f74 204e 6f6e 653a 0a20  s is not None:. 
+00015d60: 2020 2020 2020 2020 2020 2066 6f72 206d             for m
+00015d70: 6574 7269 632c 2076 616c 2069 6e20 6765  etric, val in ge
+00015d80: 6f6d 5f6e 616d 6564 2e69 7465 6d73 2829  om_named.items()
+00015d90: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00015da0: 2020 666d 7420 3d20 6622 7b7b 7661 6c3a    fmt = f"{{val:
+00015db0: 2e7b 6465 6369 6d61 6c5f 706c 6163 6573  .{decimal_places
+00015dc0: 7d66 7d7d 220a 2020 2020 2020 2020 2020  }f}}".          
+00015dd0: 2020 2020 2020 6966 2067 656f 6d5f 6e61        if geom_na
+00015de0: 6d65 645b 6d65 7472 6963 5d20 6973 206e  med[metric] is n
+00015df0: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
+00015e00: 2020 2020 2020 2020 2020 2020 2067 656f               geo
+00015e10: 6d5f 6e61 6d65 645b 6d65 7472 6963 5d20  m_named[metric] 
+00015e20: 3d20 666c 6f61 7428 666d 742e 666f 726d  = float(fmt.form
+00015e30: 6174 2876 616c 3d76 616c 2929 0a0a 2020  at(val=val))..  
+00015e40: 2020 2020 2020 2320 436f 6e76 6572 7420        # Convert 
+00015e50: 746f 2070 616e 6461 7320 4461 7461 4672  to pandas DataFr
+00015e60: 616d 650a 2020 2020 2020 2020 6466 203d  ame.        df =
+00015e70: 2070 642e 4461 7461 4672 616d 6528 6765   pd.DataFrame(ge
+00015e80: 6f6d 5f6e 616d 6564 2c20 696e 6465 783d  om_named, index=
+00015e90: 5b73 656c 662e 6e61 6d65 5d29 0a0a 2020  [self.name])..  
+00015ea0: 2020 2020 2020 2320 4361 7069 7461 6c69        # Capitali
+00015eb0: 7a65 2063 6f6c 756d 6e20 6e61 6d65 7320  ze column names 
+00015ec0: 616e 6420 7265 6d6f 7665 2075 6e64 6572  and remove under
+00015ed0: 7363 6f72 6573 2069 6620 7265 7175 6573  scores if reques
+00015ee0: 7465 640a 2020 2020 2020 2020 6966 206e  ted.        if n
+00015ef0: 6963 655f 636f 6c75 6d6e 7320 616e 6420  ice_columns and 
+00015f00: 6e6f 7420 676c 6f62 616c 5f76 735f 736c  not global_vs_sl
+00015f10: 6963 655f 6865 6164 6572 3a0a 2020 2020  ice_header:.    
+00015f20: 2020 2020 2020 2020 6466 2e63 6f6c 756d          df.colum
+00015f30: 6e73 203d 205b 636f 6c2e 6361 7069 7461  ns = [col.capita
+00015f40: 6c69 7a65 2829 2e72 6570 6c61 6365 2822  lize().replace("
+00015f50: 5f22 2c20 2220 2229 200a 2020 2020 2020  _", " ") .      
+00015f60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015f70: 2020 2020 666f 7220 636f 6c20 696e 2064      for col in d
+00015f80: 662e 636f 6c75 6d6e 735d 0a0a 2020 2020  f.columns]..    
+00015f90: 2020 2020 2320 5475 726e 206e 616d 6520      # Turn name 
+00015fa0: 696e 746f 2061 2072 6567 756c 6172 2063  into a regular c
+00015fb0: 6f6c 756d 6e20 6966 2072 6571 7565 7374  olumn if request
+00015fc0: 6564 0a20 2020 2020 2020 2069 6620 6e6f  ed.        if no
+00015fd0: 7420 6e61 6d65 5f61 735f 696e 6465 783a  t name_as_index:
+00015fe0: 0a20 2020 2020 2020 2020 2020 2064 6620  .            df 
+00015ff0: 3d20 6466 2e72 6573 6574 5f69 6e64 6578  = df.reset_index
+00016000: 2829 2e72 656e 616d 6528 7b22 696e 6465  ().rename({"inde
+00016010: 7822 3a20 2252 4f49 227d 2c20 6178 6973  x": "ROI"}, axis
+00016020: 3d31 290a 0a20 2020 2020 2020 2023 2041  =1)..        # A
+00016030: 6464 2067 6c6f 6261 6c2f 736c 6963 6520  dd global/slice 
+00016040: 6865 6164 6572 730a 2020 2020 2020 2020  headers.        
+00016050: 6966 2067 6c6f 6261 6c5f 7673 5f73 6c69  if global_vs_sli
+00016060: 6365 5f68 6561 6465 723a 0a0a 2020 2020  ce_header:..    
+00016070: 2020 2020 2020 2020 2320 536f 7274 2063          # Sort c
+00016080: 6f6c 756d 6e73 2069 6e74 6f20 676c 6f62  olumns into glob
+00016090: 616c 206f 7220 736c 6963 650a 2020 2020  al or slice.    
+000160a0: 2020 2020 2020 2020 6865 6164 6572 7320          headers 
+000160b0: 3d20 5b5d 0a20 2020 2020 2020 2020 2020  = [].           
+000160c0: 2073 6c69 6365 5f63 6f6c 7320 3d20 5b5d   slice_cols = []
+000160d0: 0a20 2020 2020 2020 2020 2020 2067 6c6f  .            glo
+000160e0: 6261 6c5f 636f 6c73 203d 205b 5d0a 2020  bal_cols = [].  
+000160f0: 2020 2020 2020 2020 2020 736c 6963 655f            slice_
+00016100: 6e61 6d65 203d 2022 736c 6963 6522 2069  name = "slice" i
+00016110: 6620 6e6f 7420 6e69 6365 5f63 6f6c 756d  f not nice_colum
+00016120: 6e73 2065 6c73 6520 2253 6c69 6365 220a  ns else "Slice".
+00016130: 2020 2020 2020 2020 2020 2020 676c 6f62              glob
+00016140: 616c 5f6e 616d 6520 3d20 2267 6c6f 6261  al_name = "globa
+00016150: 6c22 2069 6620 6e6f 7420 6e69 6365 5f63  l" if not nice_c
+00016160: 6f6c 756d 6e73 2065 6c73 6520 2247 6c6f  olumns else "Glo
+00016170: 6261 6c22 0a20 2020 2020 2020 2020 2020  bal".           
+00016180: 2066 6f72 206d 6574 7269 6320 696e 2067   for metric in g
+00016190: 656f 6d5f 6e61 6d65 643a 0a20 2020 2020  eom_named:.     
+000161a0: 2020 2020 2020 2020 2020 206e 616d 6520             name 
+000161b0: 3d20 6d65 7472 6963 2069 6620 6e6f 7420  = metric if not 
+000161c0: 6e69 6365 5f63 6f6c 756d 6e73 2065 6c73  nice_columns els
+000161d0: 6520 5c0a 2020 2020 2020 2020 2020 2020  e \.            
+000161e0: 2020 2020 2020 2020 2020 2020 6d65 7472              metr
+000161f0: 6963 2e63 6170 6974 616c 697a 6528 292e  ic.capitalize().
+00016200: 7265 706c 6163 6528 225f 222c 2022 2229  replace("_", "")
+00016210: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00016220: 2069 6620 2261 7265 6122 2069 6e20 6d65   if "area" in me
+00016230: 7472 6963 206f 7220 2273 6c69 6365 2220  tric or "slice" 
+00016240: 696e 206d 6574 7269 633a 0a20 2020 2020  in metric:.     
+00016250: 2020 2020 2020 2020 2020 2020 2020 2068                 h
+00016260: 6561 6465 7273 2e61 7070 656e 6428 2873  eaders.append((s
+00016270: 6c69 6365 5f6e 616d 652c 206d 6574 7269  lice_name, metri
+00016280: 6329 290a 2020 2020 2020 2020 2020 2020  c)).            
+00016290: 2020 2020 2020 2020 736c 6963 655f 636f          slice_co
+000162a0: 6c73 2e61 7070 656e 6428 6d65 7472 6963  ls.append(metric
+000162b0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+000162c0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+000162d0: 2020 2020 2020 2020 2020 2020 6865 6164              head
+000162e0: 6572 732e 6170 7065 6e64 2828 676c 6f62  ers.append((glob
+000162f0: 616c 5f6e 616d 652c 206d 6574 7269 6329  al_name, metric)
+00016300: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00016310: 2020 2020 2020 676c 6f62 616c 5f63 6f6c        global_col
+00016320: 732e 6170 7065 6e64 286d 6574 7269 6329  s.append(metric)
+00016330: 0a0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
+00016340: 5265 6f72 6465 7220 636f 6c75 6d6e 730a  Reorder columns.
+00016350: 2020 2020 2020 2020 2020 2020 6466 735f              dfs_
+00016360: 6f72 6465 7265 6420 3d20 5b64 665b 676c  ordered = [df[gl
+00016370: 6f62 616c 5f63 6f6c 735d 2c20 6466 5b73  obal_cols], df[s
+00016380: 6c69 6365 5f63 6f6c 735d 5d0a 2020 2020  lice_cols]].    
+00016390: 2020 2020 2020 2020 6966 206e 6f74 206e          if not n
+000163a0: 616d 655f 6173 5f69 6e64 6578 3a0a 2020  ame_as_index:.  
+000163b0: 2020 2020 2020 2020 2020 2020 2020 6466                df
+000163c0: 735f 6f72 6465 7265 642e 696e 7365 7274  s_ordered.insert
+000163d0: 2830 2c20 6466 5b22 524f 4922 5d29 0a20  (0, df["ROI"]). 
+000163e0: 2020 2020 2020 2020 2020 2064 6620 3d20             df = 
+000163f0: 7064 2e63 6f6e 6361 7428 6466 735f 6f72  pd.concat(dfs_or
+00016400: 6465 7265 642c 2061 7869 733d 3129 0a0a  dered, axis=1)..
+00016410: 2020 2020 2020 2020 2020 2020 2320 536f              # So
+00016420: 7274 2068 6561 6465 7273 2062 7920 676c  rt headers by gl
+00016430: 6f62 616c 2f73 6c69 6365 0a20 2020 2020  obal/slice.     
+00016440: 2020 2020 2020 2068 6561 6465 7273 203d         headers =
+00016450: 205b 6820 666f 7220 6820 696e 2068 6561   [h for h in hea
+00016460: 6465 7273 2069 6620 685b 305d 203d 3d20  ders if h[0] == 
+00016470: 676c 6f62 616c 5f6e 616d 655d 205c 0a20  global_name] \. 
+00016480: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016490: 2020 202b 205b 6820 666f 7220 6820 696e     + [h for h in
+000164a0: 2068 6561 6465 7273 2069 6620 685b 305d   headers if h[0]
+000164b0: 203d 3d20 736c 6963 655f 6e61 6d65 5d0a   == slice_name].
+000164c0: 2020 2020 2020 2020 2020 2020 6966 206e              if n
+000164d0: 6f74 206e 616d 655f 6173 5f69 6e64 6578  ot name_as_index
+000164e0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000164f0: 2020 6865 6164 6572 732e 696e 7365 7274    headers.insert
+00016500: 2830 2c20 2822 222c 2022 524f 4922 2929  (0, ("", "ROI"))
+00016510: 0a0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
+00016520: 4164 6420 4d75 6c74 6949 6e64 6578 0a20  Add MultiIndex. 
+00016530: 2020 2020 2020 2020 2020 2064 662e 636f             df.co
+00016540: 6c75 6d6e 7320 3d20 7064 2e4d 756c 7469  lumns = pd.Multi
+00016550: 496e 6465 782e 6672 6f6d 5f74 7570 6c65  Index.from_tuple
+00016560: 7328 6865 6164 6572 7329 0a0a 2020 2020  s(headers)..    
+00016570: 2020 2020 6966 2068 746d 6c3a 0a20 2020      if html:.   
+00016580: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00016590: 6466 5f74 6f5f 6874 6d6c 2864 6629 0a20  df_to_html(df). 
+000165a0: 2020 2020 2020 2072 6574 7572 6e20 6466         return df
+000165b0: 0a0a 2020 2020 6465 6620 6765 745f 6365  ..    def get_ce
+000165c0: 6e74 726f 6964 5f64 6973 7461 6e63 6528  ntroid_distance(
+000165d0: 7365 6c66 2c20 726f 692c 2073 696e 676c  self, roi, singl
+000165e0: 655f 736c 6963 653d 4661 6c73 652c 2076  e_slice=False, v
+000165f0: 6965 773d 2278 2d79 222c 0a20 2020 2020  iew="x-y",.     
+00016600: 2020 2020 2020 2073 6c3d 4e6f 6e65 2c20         sl=None, 
+00016610: 6964 783d 4e6f 6e65 2c20 706f 733d 4e6f  idx=None, pos=No
+00016620: 6e65 2c20 756e 6974 733d 226d 6d22 2c20  ne, units="mm", 
+00016630: 6d65 7468 6f64 3d4e 6f6e 652c 2066 6f72  method=None, for
+00016640: 6365 3d54 7275 652c 0a20 2020 2020 2020  ce=True,.       
+00016650: 2020 2020 2062 795f 736c 6963 653d 4e6f       by_slice=No
+00016660: 6e65 2c20 7661 6c75 655f 666f 725f 6e6f  ne, value_for_no
+00016670: 6e65 3d4e 6f6e 652c 2073 6c69 6365 5f73  ne=None, slice_s
+00016680: 7461 743d 4e6f 6e65 2c0a 2020 2020 2020  tat=None,.      
+00016690: 2020 2020 2020 2a2a 736c 6963 655f 7374        **slice_st
+000166a0: 6174 5f6b 7761 7267 7329 3a0a 2020 2020  at_kwargs):.    
+000166b0: 2020 2020 2222 2247 6574 2063 656e 7472      """Get centr
+000166c0: 6f69 6420 6469 7370 6c61 6365 6d65 6e74  oid displacement
+000166d0: 2076 6563 746f 7220 7769 7468 2072 6573   vector with res
+000166e0: 7065 6374 2074 6f20 616e 6f74 6865 7220  pect to another 
+000166f0: 524f 492e 0a0a 2020 2020 2020 2020 2a2a  ROI...        **
+00016700: 5061 7261 6d65 7465 7273 3a2a 2a0a 2020  Parameters:**.  
+00016710: 2020 2020 2020 0a20 2020 2020 2020 2072        .        r
+00016720: 6f69 203a 2052 4f49 0a20 2020 2020 2020  oi : ROI.       
+00016730: 2020 2020 204f 7468 6572 2052 4f49 2077       Other ROI w
+00016740: 6974 6820 7768 6963 6820 746f 2063 6f6d  ith which to com
+00016750: 7061 7265 2063 656e 7472 6f69 642e 0a0a  pare centroid...
+00016760: 2020 2020 2020 2020 7369 6e67 6c65 5f73          single_s
+00016770: 6c69 6365 203a 2062 6f6f 6c2c 2064 6566  lice : bool, def
+00016780: 6175 6c74 3d46 616c 7365 0a20 2020 2020  ault=False.     
+00016790: 2020 2020 2020 2049 6620 5472 7565 2c20         If True, 
+000167a0: 7468 6520 6365 6e74 726f 6964 2077 696c  the centroid wil
+000167b0: 6c20 6265 2072 6574 7572 6e65 6420 666f  l be returned fo
+000167c0: 7220 6120 7369 6e67 6c65 2073 6c69 6365  r a single slice
+000167d0: 2e0a 0a20 2020 2020 2020 2076 6965 7720  ...        view 
+000167e0: 3a20 7374 722c 2064 6566 6175 6c74 3d22  : str, default="
+000167f0: 782d 7922 0a20 2020 2020 2020 2020 2020  x-y".           
+00016800: 204f 7269 656e 7461 7469 6f6e 2069 6e20   Orientation in 
+00016810: 7768 6963 6820 746f 2067 6574 2063 656e  which to get cen
+00016820: 7472 6f69 6473 2069 6620 7573 696e 6720  troids if using 
+00016830: 6120 7369 6e67 6c65 2073 6c69 6365 206f  a single slice o
+00016840: 720a 2020 2020 2020 2020 2020 2020 666c  r.            fl
+00016850: 6174 7465 6e69 6e67 2e0a 0a20 2020 2020  attening...     
+00016860: 2020 2066 6c61 7474 656e 203a 2062 6f6f     flatten : boo
+00016870: 6c2c 2064 6566 6175 6c74 3d46 616c 7365  l, default=False
+00016880: 0a20 2020 2020 2020 2020 2020 2049 6620  .            If 
+00016890: 5472 7565 2c20 7468 6520 3344 2063 656e  True, the 3D cen
+000168a0: 7472 6f69 6420 7769 6c6c 2062 6520 6f62  troid will be ob
+000168b0: 7461 696e 6564 2061 6e64 2074 6865 6e20  tained and then 
+000168c0: 7468 6520 6162 736f 6c75 7465 200a 2020  the absolute .  
+000168d0: 2020 2020 2020 2020 2020 7661 6c75 6520            value 
+000168e0: 616c 6f6e 6720 6f6e 6c79 2074 6865 2032  along only the 2
+000168f0: 4420 6178 6573 2069 6e20 7468 6520 6f72  D axes in the or
+00016900: 6965 6e74 6174 696f 6e20 696e 203c 7669  ientation in <vi
+00016910: 6577 3e20 7769 6c6c 0a20 2020 2020 2020  ew> will.       
+00016920: 2020 2020 2062 6520 7265 7475 726e 6564       be returned
+00016930: 2e0a 0a20 2020 2020 2020 2073 6c20 3a20  ...        sl : 
+00016940: 696e 742c 2064 6566 6175 6c74 3d4e 6f6e  int, default=Non
+00016950: 650a 2020 2020 2020 2020 2020 2020 536c  e.            Sl
+00016960: 6963 6520 6e75 6d62 6572 2e20 4966 206e  ice number. If n
+00016970: 6f6e 6520 6f66 203c 736c 3e2c 203c 6964  one of <sl>, <id
+00016980: 783e 206f 7220 3c70 6f73 3e20 6172 6520  x> or <pos> are 
+00016990: 7375 7070 6c69 6564 2062 7574 0a20 2020  supplied but.   
+000169a0: 2020 2020 2020 2020 203c 7369 6e67 6c65           <single
+000169b0: 5f73 6c69 6365 3e20 6973 2054 7275 652c  _slice> is True,
+000169c0: 2074 6865 2063 656e 7472 616c 2073 6c69   the central sli
+000169d0: 6365 206f 6620 6561 6368 2052 4f49 0a20  ce of each ROI. 
+000169e0: 2020 2020 2020 2020 2020 2077 696c 6c20             will 
+000169f0: 6265 2075 7365 642e 0a0a 2020 2020 2020  be used...      
+00016a00: 2020 6964 7820 3a20 696e 742c 2064 6566    idx : int, def
+00016a10: 6175 6c74 3d4e 6f6e 650a 2020 2020 2020  ault=None.      
+00016a20: 2020 2020 2020 4172 7261 7920 696e 6465        Array inde
+00016a30: 7820 6f66 2073 6c69 6365 2e20 4966 206e  x of slice. If n
+00016a40: 6f6e 6520 6f66 203c 736c 3e2c 203c 6964  one of <sl>, <id
+00016a50: 783e 206f 7220 3c70 6f73 3e20 6172 6520  x> or <pos> are 
+00016a60: 7375 7070 6c69 6564 0a20 2020 2020 2020  supplied.       
+00016a70: 2020 2020 2062 7574 203c 7369 6e67 6c65       but <single
+00016a80: 5f73 6c69 6365 3e20 6973 2054 7275 652c  _slice> is True,
+00016a90: 2074 6865 2063 656e 7472 616c 2073 6c69   the central sli
+00016aa0: 6365 206f 6620 6561 6368 2052 4f49 0a20  ce of each ROI. 
+00016ab0: 2020 2020 2020 2020 2020 2077 696c 6c20             will 
+00016ac0: 6265 2075 7365 642e 0a0a 2020 2020 2020  be used...      
+00016ad0: 2020 706f 7320 3a20 666c 6f61 742c 2064    pos : float, d
+00016ae0: 6566 6175 6c74 3d4e 6f6e 650a 2020 2020  efault=None.    
+00016af0: 2020 2020 2020 2020 536c 6963 6520 706f          Slice po
+00016b00: 7369 7469 6f6e 2069 6e20 6d6d 2e20 4966  sition in mm. If
+00016b10: 206e 6f6e 6520 6f66 203c 736c 3e2c 203c   none of <sl>, <
+00016b20: 6964 783e 206f 7220 3c70 6f73 3e20 6172  idx> or <pos> ar
+00016b30: 6520 7375 7070 6c69 6564 0a20 2020 2020  e supplied.     
+00016b40: 2020 2020 2020 2062 7574 203c 7369 6e67         but <sing
+00016b50: 6c65 5f73 6c69 6365 3e20 6973 2054 7275  le_slice> is Tru
+00016b60: 652c 2074 6865 2063 656e 7472 616c 2073  e, the central s
+00016b70: 6c69 6365 206f 6620 6561 6368 2052 4f49  lice of each ROI
+00016b80: 0a20 2020 2020 2020 2020 2020 2077 696c  .            wil
+00016b90: 6c20 6265 2075 7365 642e 0a0a 2020 2020  l be used...    
+00016ba0: 2020 2020 756e 6974 7320 3a20 7374 722c      units : str,
+00016bb0: 2064 6566 6175 6c74 3d22 6d6d 220a 2020   default="mm".  
+00016bc0: 2020 2020 2020 2020 2020 556e 6974 7320            Units 
+00016bd0: 6f66 2061 6273 6f6c 7574 6520 6365 6e74  of absolute cent
+00016be0: 726f 6964 2064 6973 7461 6e63 652e 2043  roid distance. C
+00016bf0: 616e 2062 6520 616e 7920 6f66 3a0a 2020  an be any of:.  
+00016c00: 2020 2020 2020 2020 2020 2020 2020 2d20                - 
+00016c10: 226d 6d22 3a20 7265 7475 726e 2063 656e  "mm": return cen
+00016c20: 7472 6f69 6420 706f 7369 7469 6f6e 2069  troid position i
+00016c30: 6e20 6d69 6c6c 696d 6574 7265 732e 0a20  n millimetres.. 
+00016c40: 2020 2020 2020 2020 2020 2020 2020 202d                 -
+00016c50: 2022 766f 7865 6c73 223a 2072 6574 7572   "voxels": retur
+00016c60: 6e20 6365 6e74 726f 6964 2070 6f73 6974  n centroid posit
+00016c70: 696f 6e20 696e 2074 6572 6d73 206f 6620  ion in terms of 
+00016c80: 6172 7261 7920 696e 6469 6365 732e 0a20  array indices.. 
+00016c90: 2020 2020 2020 2020 2020 2020 2020 202d                 -
+00016ca0: 2022 736c 6963 6522 3a20 7265 7475 726e   "slice": return
+00016cb0: 2063 656e 7472 6f69 6420 706f 7369 7469   centroid positi
+00016cc0: 6f6e 2069 6e20 7465 726d 7320 6f66 2073  on in terms of s
+00016cd0: 6c69 6365 206e 756d 6265 7273 2e0a 0a20  lice numbers... 
+00016ce0: 2020 2020 2020 2020 2020 2049 6620 756e             If un
+00016cf0: 6974 733d 2276 6f78 656c 7322 206f 7220  its="voxels" or 
+00016d00: 2273 6c69 6365 2220 6973 2072 6571 7565  "slice" is reque
+00016d10: 7374 6564 2062 7574 2065 6974 6865 7220  sted but either 
+00016d20: 524f 4920 6f6e 6c79 2068 6173 200a 2020  ROI only has .  
+00016d30: 2020 2020 2020 2020 2020 636f 6e74 6f75            contou
+00016d40: 7273 2061 6e64 206e 6f20 6d61 736b 2073  rs and no mask s
+00016d50: 6861 7065 2f76 6f78 656c 2073 697a 6520  hape/voxel size 
+00016d60: 696e 666f 726d 6174 696f 6e2c 2061 6e20  information, an 
+00016d70: 6572 726f 7220 7769 6c6c 2062 6520 0a20  error will be . 
+00016d80: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+00016d90: 6420 2875 6e6c 6573 7320 6178 3d22 7a22  d (unless ax="z"
+00016da0: 2c20 696e 2077 6869 6368 2063 6173 6520  , in which case 
+00016db0: 766f 7865 6c20 7369 7a65 2077 696c 6c20  voxel size will 
+00016dc0: 6265 2069 6e66 6572 7265 6420 0a20 2020  be inferred .   
+00016dd0: 2020 2020 2020 2020 2066 726f 6d20 7370           from sp
+00016de0: 6163 696e 6720 6265 7477 6565 6e20 736c  acing between sl
+00016df0: 6963 6573 292e 0a0a 2020 2020 2020 2020  ices)...        
+00016e00: 6d65 7468 6f64 203a 2073 7472 2c20 6465  method : str, de
+00016e10: 6661 756c 743d 4e6f 6e65 0a20 2020 2020  fault=None.     
+00016e20: 2020 2020 2020 204d 6574 686f 6420 746f         Method to
+00016e30: 2075 7365 2066 6f72 2063 656e 7472 6f69   use for centroi
+00016e40: 6420 6361 6c63 756c 6174 696f 6e2e 2043  d calculation. C
+00016e50: 616e 2062 653a 200a 2020 2020 2020 2020  an be: .        
+00016e60: 2020 2020 2020 2020 2d20 2263 6f6e 746f          - "conto
+00016e70: 7572 223a 2067 6574 2063 656e 7472 6f69  ur": get centroi
+00016e80: 6420 6f66 2073 6861 7065 6c79 2063 6f6e  d of shapely con
+00016e90: 746f 7572 2873 292e 0a20 2020 2020 2020  tour(s)..       
+00016ea0: 2020 2020 2020 2020 202d 2022 6d61 736b           - "mask
+00016eb0: 223a 2067 6574 2061 7665 7261 6765 2070  ": get average p
+00016ec0: 6f73 6974 696f 6e20 6f66 2076 6f78 656c  osition of voxel
+00016ed0: 7320 696e 2062 696e 6172 7920 6d61 736b  s in binary mask
+00016ee0: 2e0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00016ef0: 2020 2d20 4e6f 6e65 3a20 7573 6520 7468    - None: use th
+00016f00: 6520 6d65 7468 6f64 2073 6574 2069 6e20  e method set in 
+00016f10: 7365 6c66 2e64 6566 6175 6c74 5f67 656f  self.default_geo
+00016f20: 6d5f 6d65 7468 6f64 2e0a 0a20 2020 2020  m_method...     
+00016f30: 2020 2066 6f72 6365 203a 2062 6f6f 6c2c     force : bool,
+00016f40: 2064 6566 6175 6c74 3d54 7275 650a 2020   default=True.  
+00016f50: 2020 2020 2020 2020 2020 4966 2054 7275            If Tru
+00016f60: 652c 2074 6865 2067 6c6f 6261 6c20 6365  e, the global ce
+00016f70: 6e74 726f 6964 2077 696c 6c20 616c 7761  ntroid will alwa
+00016f80: 7973 2062 6520 7265 6361 6c63 756c 6174  ys be recalculat
+00016f90: 6564 3b20 0a20 2020 2020 2020 2020 2020  ed; .           
+00016fa0: 206f 7468 6572 7769 7365 2c20 6974 2077   otherwise, it w
+00016fb0: 696c 6c20 6f6e 6c79 2062 6520 6361 6c63  ill only be calc
+00016fc0: 756c 6174 6564 2069 6620 6974 2068 6173  ulated if it has
+00016fd0: 206e 6f74 2079 6574 2062 6565 6e20 6361   not yet been ca
+00016fe0: 6368 6564 200a 2020 2020 2020 2020 2020  ched .          
+00016ff0: 2020 696e 2073 656c 662e 5f76 6f6c 756d    in self._volum
+00017000: 652e 2020 4e6f 7465 2074 6861 7420 6966  e.  Note that if
+00017010: 2073 696e 676c 655f 736c 6963 653d 5472   single_slice=Tr
+00017020: 7565 2c20 7468 6520 6365 6e74 726f 6964  ue, the centroid
+00017030: 2077 696c 6c20 0a20 2020 2020 2020 2020   will .         
+00017040: 2020 2061 6c77 6179 7320 6265 2072 6563     always be rec
+00017050: 616c 6375 6c61 7465 642e 0a0a 2020 2020  alculated...    
+00017060: 2020 2020 6279 5f73 6c69 6365 203a 2073      by_slice : s
+00017070: 7472 2c20 6465 6661 756c 743d 4e6f 6e65  tr, default=None
+00017080: 0a20 2020 2020 2020 2020 2020 2049 6620  .            If 
+00017090: 6f6e 6520 6f66 2022 6c65 6674 222c 2022  one of "left", "
+000170a0: 7269 6768 7422 2c20 2275 6e69 6f6e 222c  right", "union",
+000170b0: 2022 696e 7465 7273 6563 7469 6f6e 222c   "intersection",
+000170c0: 2063 616c 6375 6c61 7465 0a20 2020 2020   calculate.     
+000170d0: 2020 2020 2020 2044 6963 6520 7363 6f72         Dice scor
+000170e0: 6573 2073 6c69 6365 2062 7920 736c 6963  es slice by slic
+000170f0: 6520 666f 7220 6561 6368 2073 6c69 6365  e for each slice
+00017100: 2063 6f6e 7461 696e 696e 670a 2020 2020   containing.    
+00017110: 2020 2020 2020 2020 7365 6c66 2061 6e64          self and
+00017120: 2f6f 7220 6f74 6865 723a 0a0a 2020 2020  /or other:..    
+00017130: 2020 2020 2020 2020 2d20 226c 6566 7422          - "left"
+00017140: 3a20 636f 6e73 6964 6572 206f 6e6c 7920  : consider only 
+00017150: 736c 6963 6573 2063 6f6e 7461 696e 696e  slices containin
+00017160: 6720 7365 6c66 3b0a 2020 2020 2020 2020  g self;.        
+00017170: 2020 2020 2d20 2272 6967 6874 223a 2063      - "right": c
+00017180: 6f6e 7369 6465 7220 6f6e 6c79 2073 6c69  onsider only sli
+00017190: 6365 7320 636f 6e74 6169 6e69 6e67 206f  ces containing o
+000171a0: 7468 6572 3b0a 2020 2020 2020 2020 2020  ther;.          
+000171b0: 2020 2d20 2275 6e69 6f6e 223a 2063 6f6e    - "union": con
+000171c0: 7369 6465 7220 736c 6963 6573 2063 6f6e  sider slices con
+000171d0: 7461 696e 696e 6720 6569 7468 6572 206f  taining either o
+000171e0: 6620 7365 6c66 2061 6e64 206f 7468 6572  f self and other
+000171f0: 3b0a 2020 2020 2020 2020 2020 2020 2d20  ;.            - 
+00017200: 2269 6e74 6572 7365 6374 696f 6e22 3a20  "intersection": 
+00017210: 636f 6e73 6964 6572 2073 6c69 6365 7320  consider slices 
+00017220: 636f 6e74 6169 6e69 6e67 2062 6f74 6820  containing both 
+00017230: 6f66 2073 656c 6620 616e 6420 6f74 6865  of self and othe
+00017240: 722e 0a0a 2020 2020 2020 2020 2020 2020  r...            
+00017250: 4966 2073 6c69 6365 5f73 7461 7420 6973  If slice_stat is
+00017260: 204e 6f6e 652c 2072 6574 7572 6e20 6120   None, return a 
+00017270: 6469 6374 696f 6e61 7279 2077 6865 7265  dictionary where
+00017280: 206b 6579 7320 6172 650a 2020 2020 2020   keys are.      
+00017290: 2020 2020 2020 736c 6963 6520 706f 7369        slice posi
+000172a0: 7469 6f6e 7320 616e 6420 7661 6c75 6573  tions and values
+000172b0: 2061 7265 2074 6865 2063 616c 6375 6c61   are the calcula
+000172c0: 7465 6420 4469 6365 2073 636f 7265 732e  ted Dice scores.
+000172d0: 0a20 2020 2020 2020 2020 2020 204f 7468  .            Oth
+000172e0: 6572 7769 7365 2c20 7265 7475 726e 2066  erwise, return f
+000172f0: 6f72 2074 6865 2063 616c 6375 6c61 7465  or the calculate
+00017300: 6420 4469 6365 2073 636f 7265 7320 7468  d Dice scores th
+00017310: 6520 7374 6174 6973 7469 630a 2020 2020  e statistic.    
+00017320: 2020 2020 2020 2020 7370 6563 6966 6965          specifie
+00017330: 6420 6279 2073 6c69 6365 5f73 7461 742e  d by slice_stat.
+00017340: 0a0a 2020 2020 2020 2020 7661 6c75 655f  ..        value_
+00017350: 666f 725f 6e6f 6e65 203a 2066 6c6f 6174  for_none : float
+00017360: 2c20 6465 6661 756c 743d 4e6f 6e65 0a20  , default=None. 
+00017370: 2020 2020 2020 2020 2020 2046 6f72 2073             For s
+00017380: 696e 676c 655f 736c 6963 6520 616e 6420  ingle_slice and 
+00017390: 6279 5f73 6c69 6365 2c20 7661 6c75 6520  by_slice, value 
+000173a0: 746f 2062 6520 7265 7475 726e 6564 2066  to be returned f
+000173b0: 6f72 0a20 2020 2020 2020 2020 2020 2073  or.            s
+000173c0: 6c69 6365 7320 7768 6572 6520 4469 6365  lices where Dice
+000173d0: 2073 636f 7265 2069 7320 756e 6465 7465   score is undete
+000173e0: 726d 696e 6564 2028 4e6f 6e65 292e 2020  rmined (None).  
+000173f0: 466f 7220 736c 6963 655f 7374 6174 2c0a  For slice_stat,.
+00017400: 2020 2020 2020 2020 2020 2020 7661 6c75              valu
+00017410: 6520 746f 2073 7562 7374 6974 7574 6520  e to substitute 
+00017420: 666f 7220 616e 7920 4e6f 6e65 2076 616c  for any None val
+00017430: 7565 7320 616d 6f6e 6720 7468 6520 696e  ues among the in
+00017440: 7075 7473 0a20 2020 2020 2020 2020 2020  puts.           
+00017450: 2066 6f72 2063 616c 6375 6c61 7469 6e67   for calculating
+00017460: 2073 6c69 6365 2d62 6173 6564 2073 7461   slice-based sta
+00017470: 7469 7374 6963 2e20 2049 6620 4e6f 6e65  tistic.  If None
+00017480: 2069 6e20 7468 6520 6c61 7474 6572 0a20   in the latter. 
+00017490: 2020 2020 2020 2020 2020 2063 6173 652c             case,
+000174a0: 204e 6f6e 6520 7661 6c75 6573 2061 6d6f   None values amo
+000174b0: 6e67 2074 6865 2069 6e70 7574 7320 6172  ng the inputs ar
+000174c0: 6520 6f6d 6974 7465 642e 0a0a 2020 2020  e omitted...    
+000174d0: 2020 2020 736c 6963 655f 7374 6174 203a      slice_stat :
+000174e0: 2073 7472 2c20 6465 6661 756c 743d 4e6f   str, default=No
+000174f0: 6e65 0a20 2020 2020 2020 2020 2020 2053  ne.            S
+00017500: 696e 676c 652d 7661 7269 6162 6c65 2073  ingle-variable s
+00017510: 7461 7469 7374 6963 2873 2920 746f 2062  tatistic(s) to b
+00017520: 6520 7265 7475 726e 6564 2066 6f72 2073  e returned for s
+00017530: 6c69 6365 2d62 792d 736c 6963 650a 2020  lice-by-slice.  
+00017540: 2020 2020 2020 2020 2020 4469 6365 2073            Dice s
+00017550: 636f 7265 732e 2020 5468 6973 2073 686f  cores.  This sho
+00017560: 756c 6420 6265 2074 6865 206e 616d 6520  uld be the name 
+00017570: 6f66 2074 6865 2066 756e 6374 696f 6e20  of the function 
+00017580: 666f 720a 2020 2020 2020 2020 2020 2020  for.            
+00017590: 6361 6c63 756c 6174 696f 6e20 6f66 2074  calculation of t
+000175a0: 6865 2073 7461 7469 7374 6963 2873 2920  he statistic(s) 
+000175b0: 696e 2074 6865 2050 7974 686f 6e20 7374  in the Python st
+000175c0: 6174 6973 7469 6373 206d 6f64 756c 653a  atistics module:
+000175d0: 0a0a 2020 2020 2020 2020 2020 2020 6874  ..            ht
+000175e0: 7470 733a 2f2f 646f 6373 2e70 7974 686f  tps://docs.pytho
+000175f0: 6e2e 6f72 672f 332f 6c69 6272 6172 792f  n.org/3/library/
+00017600: 7374 6174 6973 7469 6373 2e68 746d 6c0a  statistics.html.
+00017610: 0a20 2020 2020 2020 2020 2020 2041 7661  .            Ava
+00017620: 696c 6162 6c65 206f 7074 696f 6e73 2069  ilable options i
+00017630: 6e63 6c75 6465 3a20 226d 6561 6e22 2c20  nclude: "mean", 
+00017640: 226d 6564 6961 6e22 2c20 226d 6f64 6522  "median", "mode"
+00017650: 2c0a 2020 2020 2020 2020 2020 2020 2273  ,.            "s
+00017660: 7464 6576 222c 2022 7175 616e 7469 6c65  tdev", "quantile
+00017670: 7322 2e20 2044 6973 7265 6761 7264 6564  s".  Disregarded
+00017680: 2069 6620 4e6f 6e65 2e0a 0a20 2020 2020   if None...     
+00017690: 2020 2020 2020 2049 6620 6279 5f73 6c69         If by_sli
+000176a0: 6365 2069 7320 4e6f 6e65 2061 6e64 2073  ce is None and s
+000176b0: 6c69 6365 5f73 7461 7420 6973 2064 6966  lice_stat is dif
+000176c0: 6665 7265 6e74 2066 726f 6d20 4e6f 6e65  ferent from None
+000176d0: 2c0a 2020 2020 2020 2020 2020 2020 736b  ,.            sk
+000176e0: 7274 2e63 6f72 652e 4465 6661 756c 7473  rt.core.Defaults
+000176f0: 2829 2e62 795f 736c 6963 6520 6973 2075  ().by_slice is u
+00017700: 7365 6420 666f 7220 7468 6520 666f 726d  sed for the form
+00017710: 6572 2e0a 0a20 2020 2020 2020 2073 6c69  er...        sli
+00017720: 6365 5f73 7461 745f 6b77 6172 6773 203a  ce_stat_kwargs :
+00017730: 2064 6963 742c 2064 6566 6175 6c74 3d4e   dict, default=N
+00017740: 6f6e 650a 2020 2020 2020 2020 2020 2020  one.            
+00017750: 4b65 7977 6f72 6420 6172 6775 6d65 6e74  Keyword argument
+00017760: 7320 746f 2062 6520 7061 7373 6564 2074  s to be passed t
+00017770: 6f20 6675 6e63 7469 6f6e 206f 6620 7374  o function of st
+00017780: 6174 6973 7469 6373 0a20 2020 2020 2020  atistics.       
+00017790: 2020 2020 206d 6f64 756c 6520 666f 7220       module for 
+000177a0: 6361 6c63 756c 6174 696f 6e20 7265 6c61  calculation rela
+000177b0: 7469 7665 2074 6f20 736c 6963 6520 7661  tive to slice va
+000177c0: 6c75 6573 2e20 2046 6f72 2065 7861 6d70  lues.  For examp
+000177d0: 6c65 2c0a 2020 2020 2020 2020 2020 2020  le,.            
+000177e0: 6966 2071 7561 6e74 696c 6573 2061 7265  if quantiles are
+000177f0: 2072 6571 7569 7265 6420 666f 7220 3130   required for 10
+00017800: 2069 6e74 6572 7661 6c73 2c20 7261 7468   intervals, rath
+00017810: 6572 2074 6861 6e20 666f 720a 2020 2020  er than for.    
+00017820: 2020 2020 2020 2020 7468 6520 6465 6661          the defa
+00017830: 756c 7420 6f66 2034 2c20 7468 6973 2063  ult of 4, this c
+00017840: 616e 2062 6520 7370 6563 6966 6965 6420  an be specified 
+00017850: 7573 696e 673a 0a0a 2020 2020 2020 2020  using:..        
+00017860: 2020 2020 736c 6963 655f 7374 6174 5f6b      slice_stat_k
+00017870: 7761 7267 737b 226e 2220 3a20 3130 7d0a  wargs{"n" : 10}.
+00017880: 0a20 2020 2020 2020 2020 2020 2046 6f72  .            For
+00017890: 2061 7661 696c 6162 6c65 206b 6579 776f   available keywo
+000178a0: 7264 206f 7074 696f 6e73 2c20 7365 6520  rd options, see 
+000178b0: 646f 6375 6d65 6e74 6174 696f 6e20 6f66  documentation of
+000178c0: 2073 7461 7469 7374 6963 730a 2020 2020   statistics.    
+000178d0: 2020 2020 2020 2020 6d6f 6475 6c65 2061          module a
+000178e0: 743a 0a0a 2020 2020 2020 2020 2020 2020  t:..            
+000178f0: 6874 7470 733a 2f2f 646f 6373 2e70 7974  https://docs.pyt
+00017900: 686f 6e2e 6f72 672f 332f 6c69 6272 6172  hon.org/3/librar
+00017910: 792f 7374 6174 6973 7469 6373 2e68 746d  y/statistics.htm
+00017920: 6c0a 2020 2020 2020 2020 2222 220a 2020  l.        """.  
+00017930: 2020 2020 2020 6966 2073 6c69 6365 5f73        if slice_s
+00017940: 7461 743a 0a20 2020 2020 2020 2020 2020  tat:.           
+00017950: 2072 6574 7572 6e20 7365 6c66 2e67 6574   return self.get
+00017960: 5f73 6c69 6365 5f73 7461 7428 726f 692c  _slice_stat(roi,
+00017970: 2022 6365 6e74 726f 6964 222c 2073 6c69   "centroid", sli
+00017980: 6365 5f73 7461 742c 0a20 2020 2020 2020  ce_stat,.       
+00017990: 2020 2020 2020 2020 2020 2020 2062 795f               by_
+000179a0: 736c 6963 652c 2076 616c 7565 5f66 6f72  slice, value_for
+000179b0: 5f6e 6f6e 652c 2076 6965 772c 206d 6574  _none, view, met
+000179c0: 686f 642c 0a20 2020 2020 2020 2020 2020  hod,.           
+000179d0: 2020 2020 2020 2020 202a 2a28 736c 6963           **(slic
+000179e0: 655f 7374 6174 5f6b 7761 7267 7320 6f72  e_stat_kwargs or
+000179f0: 207b 7d29 290a 0a20 2020 2020 2020 2069   {}))..        i
+00017a00: 6620 6279 5f73 6c69 6365 3a0a 2020 2020  f by_slice:.    
+00017a10: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+00017a20: 656c 662e 6765 745f 6d65 7472 6963 5f62  elf.get_metric_b
+00017a30: 795f 736c 6963 6528 726f 692c 2022 6365  y_slice(roi, "ce
+00017a40: 6e74 726f 6964 222c 2062 795f 736c 6963  ntroid", by_slic
+00017a50: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
+00017a60: 2020 2020 2020 2076 6965 772c 206d 6574         view, met
+00017a70: 686f 6429 0a0a 2020 2020 2020 2020 7468  hod)..        th
+00017a80: 6973 5f63 656e 7472 6f69 6420 3d20 6e70  is_centroid = np
+00017a90: 2e61 7272 6179 2873 656c 662e 6765 745f  .array(self.get_
+00017aa0: 6365 6e74 726f 6964 280a 2020 2020 2020  centroid(.      
+00017ab0: 2020 2020 2020 7369 6e67 6c65 5f73 6c69        single_sli
+00017ac0: 6365 3d73 696e 676c 655f 736c 6963 652c  ce=single_slice,
+00017ad0: 2076 6965 773d 7669 6577 2c20 736c 3d73   view=view, sl=s
+00017ae0: 6c2c 2069 6478 3d69 6478 2c20 706f 733d  l, idx=idx, pos=
+00017af0: 706f 732c 0a20 2020 2020 2020 2020 2020  pos,.           
+00017b00: 2075 6e69 7473 3d75 6e69 7473 2c20 6d65   units=units, me
+00017b10: 7468 6f64 3d6d 6574 686f 642c 2066 6f72  thod=method, for
+00017b20: 6365 3d66 6f72 6365 290a 2020 2020 2020  ce=force).      
+00017b30: 2020 290a 2020 2020 2020 2020 6f74 6865    ).        othe
+00017b40: 725f 6365 6e74 726f 6964 203d 206e 702e  r_centroid = np.
+00017b50: 6172 7261 7928 726f 692e 6765 745f 6365  array(roi.get_ce
+00017b60: 6e74 726f 6964 280a 2020 2020 2020 2020  ntroid(.        
+00017b70: 2020 2020 7369 6e67 6c65 5f73 6c69 6365      single_slice
+00017b80: 3d73 696e 676c 655f 736c 6963 652c 2076  =single_slice, v
+00017b90: 6965 773d 7669 6577 2c20 736c 3d73 6c2c  iew=view, sl=sl,
+00017ba0: 2069 6478 3d69 6478 2c20 706f 733d 706f   idx=idx, pos=po
+00017bb0: 732c 0a20 2020 2020 2020 2020 2020 2075  s,.            u
+00017bc0: 6e69 7473 3d75 6e69 7473 2c20 6d65 7468  nits=units, meth
+00017bd0: 6f64 3d6d 6574 686f 642c 2066 6f72 6365  od=method, force
+00017be0: 3d66 6f72 6365 290a 2020 2020 2020 2020  =force).        
+00017bf0: 290a 2020 2020 2020 2020 6966 204e 6f6e  ).        if Non
+00017c00: 6520 696e 2074 6869 735f 6365 6e74 726f  e in this_centro
+00017c10: 6964 206f 7220 4e6f 6e65 2069 6e20 6f74  id or None in ot
+00017c20: 6865 725f 6365 6e74 726f 6964 3a0a 2020  her_centroid:.  
+00017c30: 2020 2020 2020 2020 2020 6966 2073 696e            if sin
+00017c40: 676c 655f 736c 6963 653a 0a20 2020 2020  gle_slice:.     
+00017c50: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00017c60: 6e20 6e70 2e61 7272 6179 285b 7661 6c75  n np.array([valu
+00017c70: 655f 666f 725f 6e6f 6e65 2c20 7661 6c75  e_for_none, valu
+00017c80: 655f 666f 725f 6e6f 6e65 5d29 0a20 2020  e_for_none]).   
+00017c90: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+00017ca0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00017cb0: 6574 7572 6e20 6e70 2e61 7272 6179 285b  eturn np.array([
+00017cc0: 7661 6c75 655f 666f 725f 6e6f 6e65 2c20  value_for_none, 
+00017cd0: 7661 6c75 655f 666f 725f 6e6f 6e65 2c0a  value_for_none,.
+00017ce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017cf0: 2020 2020 7661 6c75 655f 666f 725f 6e6f      value_for_no
+00017d00: 6e65 5d29 0a20 2020 2020 2020 2072 6574  ne]).        ret
+00017d10: 7572 6e20 6f74 6865 725f 6365 6e74 726f  urn other_centro
+00017d20: 6964 202d 2074 6869 735f 6365 6e74 726f  id - this_centro
+00017d30: 6964 0a0a 2020 2020 6465 6620 6765 745f  id..    def get_
+00017d40: 6162 735f 6365 6e74 726f 6964 5f64 6973  abs_centroid_dis
+00017d50: 7461 6e63 6528 0a20 2020 2020 2020 2073  tance(.        s
+00017d60: 656c 662c 200a 2020 2020 2020 2020 726f  elf, .        ro
+00017d70: 692c 200a 2020 2020 2020 2020 7669 6577  i, .        view
+00017d80: 3d22 782d 7922 2c20 0a20 2020 2020 2020  ="x-y", .       
+00017d90: 2073 696e 676c 655f 736c 6963 653d 4661   single_slice=Fa
+00017da0: 6c73 652c 0a20 2020 2020 2020 2066 6c61  lse,.        fla
+00017db0: 7474 656e 3d46 616c 7365 2c20 0a20 2020  tten=False, .   
+00017dc0: 2020 2020 2073 6c3d 4e6f 6e65 2c0a 2020       sl=None,.  
+00017dd0: 2020 2020 2020 6964 783d 4e6f 6e65 2c0a        idx=None,.
+00017de0: 2020 2020 2020 2020 706f 733d 4e6f 6e65          pos=None
+00017df0: 2c0a 2020 2020 2020 2020 756e 6974 733d  ,.        units=
+00017e00: 226d 6d22 2c0a 2020 2020 2020 2020 6d65  "mm",.        me
+00017e10: 7468 6f64 3d4e 6f6e 652c 0a20 2020 2020  thod=None,.     
+00017e20: 2020 2066 6f72 6365 3d54 7275 652c 0a20     force=True,. 
+00017e30: 2020 2020 2020 2062 795f 736c 6963 653d         by_slice=
+00017e40: 4e6f 6e65 2c0a 2020 2020 2020 2020 7661  None,.        va
+00017e50: 6c75 655f 666f 725f 6e6f 6e65 3d4e 6f6e  lue_for_none=Non
+00017e60: 652c 0a20 2020 2020 2020 2073 6c69 6365  e,.        slice
+00017e70: 5f73 7461 743d 4e6f 6e65 2c0a 2020 2020  _stat=None,.    
+00017e80: 2020 2020 736c 6963 655f 7374 6174 5f6b      slice_stat_k
+00017e90: 7761 7267 733d 4e6f 6e65 2c0a 2020 2020  wargs=None,.    
+00017ea0: 2020 2020 293a 0a20 2020 2020 2020 2022      ):.        "
+00017eb0: 2222 4765 7420 6162 736f 6c75 7465 2063  ""Get absolute c
+00017ec0: 656e 7472 6f69 6420 6469 7374 616e 6365  entroid distance
+00017ed0: 2077 6974 6820 7265 7370 6563 7420 746f   with respect to
+00017ee0: 2061 6e6f 7468 6572 2052 4f49 2e0a 0a20   another ROI... 
+00017ef0: 2020 2020 2020 202a 2a50 6172 616d 6574         **Paramet
+00017f00: 6572 733a 2a2a 0a20 2020 2020 2020 200a  ers:**.        .
+00017f10: 2020 2020 2020 2020 726f 6920 3a20 524f          roi : RO
+00017f20: 490a 2020 2020 2020 2020 2020 2020 4f74  I.            Ot
+00017f30: 6865 7220 524f 4920 7769 7468 2077 6869  her ROI with whi
+00017f40: 6368 2074 6f20 636f 6d70 6172 6520 6365  ch to compare ce
+00017f50: 6e74 726f 6964 2e0a 0a20 2020 2020 2020  ntroid...       
+00017f60: 2076 6965 7720 3a20 7374 722c 2064 6566   view : str, def
+00017f70: 6175 6c74 3d22 782d 7922 0a20 2020 2020  ault="x-y".     
+00017f80: 2020 2020 2020 204f 7269 656e 7461 7469         Orientati
+00017f90: 6f6e 2069 6e20 7768 6963 6820 746f 2067  on in which to g
+00017fa0: 6574 2063 656e 7472 6f69 6473 2069 6620  et centroids if 
+00017fb0: 7573 696e 6720 6120 7369 6e67 6c65 2073  using a single s
+00017fc0: 6c69 6365 206f 720a 2020 2020 2020 2020  lice or.        
+00017fd0: 2020 2020 666c 6174 7465 6e69 6e67 2e0a      flattening..
+00017fe0: 0a20 2020 2020 2020 2073 696e 676c 655f  .        single_
+00017ff0: 736c 6963 6520 3a20 626f 6f6c 2c20 6465  slice : bool, de
+00018000: 6661 756c 743d 4661 6c73 650a 2020 2020  fault=False.    
+00018010: 2020 2020 2020 2020 4966 2054 7275 652c          If True,
+00018020: 2074 6865 2063 656e 7472 6f69 6420 7769   the centroid wi
+00018030: 6c6c 2062 6520 7265 7475 726e 6564 2066  ll be returned f
+00018040: 6f72 2061 2073 696e 676c 6520 736c 6963  or a single slic
+00018050: 652e 0a0a 2020 2020 2020 2020 666c 6174  e...        flat
+00018060: 7465 6e20 3a20 626f 6f6c 2c20 6465 6661  ten : bool, defa
+00018070: 756c 743d 4661 6c73 650a 2020 2020 2020  ult=False.      
+00018080: 2020 2020 2020 4966 2054 7275 652c 2074        If True, t
+00018090: 6865 2033 4420 6365 6e74 726f 6964 2077  he 3D centroid w
+000180a0: 696c 6c20 6265 206f 6274 6169 6e65 6420  ill be obtained 
+000180b0: 616e 6420 7468 656e 2074 6865 2061 6273  and then the abs
+000180c0: 6f6c 7574 6520 0a20 2020 2020 2020 2020  olute .         
+000180d0: 2020 2076 616c 7565 2061 6c6f 6e67 206f     value along o
+000180e0: 6e6c 7920 7468 6520 3244 2061 7865 7320  nly the 2D axes 
+000180f0: 696e 2074 6865 206f 7269 656e 7461 7469  in the orientati
+00018100: 6f6e 2069 6e20 3c76 6965 773e 2077 696c  on in <view> wil
+00018110: 6c0a 2020 2020 2020 2020 2020 2020 6265  l.            be
+00018120: 2072 6574 7572 6e65 642e 0a0a 2020 2020   returned...    
+00018130: 2020 2020 736c 203a 2069 6e74 2c20 6465      sl : int, de
+00018140: 6661 756c 743d 4e6f 6e65 0a20 2020 2020  fault=None.     
+00018150: 2020 2020 2020 2053 6c69 6365 206e 756d         Slice num
+00018160: 6265 722e 2049 6620 6e6f 6e65 206f 6620  ber. If none of 
+00018170: 3c73 6c3e 2c20 3c69 6478 3e20 6f72 203c  <sl>, <idx> or <
+00018180: 706f 733e 2061 7265 2073 7570 706c 6965  pos> are supplie
+00018190: 6420 6275 740a 2020 2020 2020 2020 2020  d but.          
+000181a0: 2020 3c73 696e 676c 655f 736c 6963 653e    <single_slice>
+000181b0: 2069 7320 5472 7565 2c20 7468 6520 6365   is True, the ce
+000181c0: 6e74 7261 6c20 736c 6963 6520 6f66 2065  ntral slice of e
+000181d0: 6163 6820 524f 490a 2020 2020 2020 2020  ach ROI.        
+000181e0: 2020 2020 7769 6c6c 2062 6520 7573 6564      will be used
+000181f0: 2e0a 0a20 2020 2020 2020 2069 6478 203a  ...        idx :
+00018200: 2069 6e74 2c20 6465 6661 756c 743d 4e6f   int, default=No
+00018210: 6e65 0a20 2020 2020 2020 2020 2020 2041  ne.            A
+00018220: 7272 6179 2069 6e64 6578 206f 6620 736c  rray index of sl
+00018230: 6963 652e 2049 6620 6e6f 6e65 206f 6620  ice. If none of 
+00018240: 3c73 6c3e 2c20 3c69 6478 3e20 6f72 203c  <sl>, <idx> or <
+00018250: 706f 733e 2061 7265 2073 7570 706c 6965  pos> are supplie
+00018260: 640a 2020 2020 2020 2020 2020 2020 6275  d.            bu
+00018270: 7420 3c73 696e 676c 655f 736c 6963 653e  t <single_slice>
+00018280: 2069 7320 5472 7565 2c20 7468 6520 6365   is True, the ce
+00018290: 6e74 7261 6c20 736c 6963 6520 6f66 2065  ntral slice of e
+000182a0: 6163 6820 524f 490a 2020 2020 2020 2020  ach ROI.        
+000182b0: 2020 2020 7769 6c6c 2062 6520 7573 6564      will be used
+000182c0: 2e0a 0a20 2020 2020 2020 2070 6f73 203a  ...        pos :
+000182d0: 2066 6c6f 6174 2c20 6465 6661 756c 743d   float, default=
+000182e0: 4e6f 6e65 0a20 2020 2020 2020 2020 2020  None.           
+000182f0: 2053 6c69 6365 2070 6f73 6974 696f 6e20   Slice position 
+00018300: 696e 206d 6d2e 2049 6620 6e6f 6e65 206f  in mm. If none o
+00018310: 6620 3c73 6c3e 2c20 3c69 6478 3e20 6f72  f <sl>, <idx> or
+00018320: 203c 706f 733e 2061 7265 2073 7570 706c   <pos> are suppl
+00018330: 6965 640a 2020 2020 2020 2020 2020 2020  ied.            
+00018340: 6275 7420 3c73 696e 676c 655f 736c 6963  but <single_slic
+00018350: 653e 2069 7320 5472 7565 2c20 7468 6520  e> is True, the 
+00018360: 6365 6e74 7261 6c20 736c 6963 6520 6f66  central slice of
+00018370: 2065 6163 6820 524f 490a 2020 2020 2020   each ROI.      
+00018380: 2020 2020 2020 7769 6c6c 2062 6520 7573        will be us
+00018390: 6564 2e0a 0a20 2020 2020 2020 2075 6e69  ed...        uni
+000183a0: 7473 203a 2073 7472 2c20 6465 6661 756c  ts : str, defaul
+000183b0: 743d 226d 6d22 0a20 2020 2020 2020 2020  t="mm".         
+000183c0: 2020 2055 6e69 7473 206f 6620 6162 736f     Units of abso
+000183d0: 6c75 7465 2063 656e 7472 6f69 6420 6469  lute centroid di
+000183e0: 7374 616e 6365 2e20 4361 6e20 6265 2061  stance. Can be a
+000183f0: 6e79 206f 663a 0a20 2020 2020 2020 2020  ny of:.         
+00018400: 2020 2020 2020 202d 2022 6d6d 223a 2072         - "mm": r
+00018410: 6574 7572 6e20 6365 6e74 726f 6964 2070  eturn centroid p
+00018420: 6f73 6974 696f 6e20 696e 206d 696c 6c69  osition in milli
+00018430: 6d65 7472 6573 2e0a 2020 2020 2020 2020  metres..        
+00018440: 2020 2020 2020 2020 2d20 2276 6f78 656c          - "voxel
+00018450: 7322 3a20 7265 7475 726e 2063 656e 7472  s": return centr
+00018460: 6f69 6420 706f 7369 7469 6f6e 2069 6e20  oid position in 
+00018470: 7465 726d 7320 6f66 2061 7272 6179 2069  terms of array i
+00018480: 6e64 6963 6573 2e0a 2020 2020 2020 2020  ndices..        
+00018490: 2020 2020 2020 2020 2d20 2273 6c69 6365          - "slice
+000184a0: 223a 2072 6574 7572 6e20 6365 6e74 726f  ": return centro
+000184b0: 6964 2070 6f73 6974 696f 6e20 696e 2074  id position in t
+000184c0: 6572 6d73 206f 6620 736c 6963 6520 6e75  erms of slice nu
+000184d0: 6d62 6572 732e 0a0a 2020 2020 2020 2020  mbers...        
+000184e0: 2020 2020 4966 2075 6e69 7473 3d22 766f      If units="vo
+000184f0: 7865 6c73 2220 6f72 2022 736c 6963 6522  xels" or "slice"
+00018500: 2069 7320 7265 7175 6573 7465 6420 6275   is requested bu
+00018510: 7420 6569 7468 6572 2052 4f49 206f 6e6c  t either ROI onl
+00018520: 7920 6861 7320 0a20 2020 2020 2020 2020  y has .         
+00018530: 2020 2063 6f6e 746f 7572 7320 616e 6420     contours and 
+00018540: 6e6f 206d 6173 6b20 7368 6170 652f 766f  no mask shape/vo
+00018550: 7865 6c20 7369 7a65 2069 6e66 6f72 6d61  xel size informa
+00018560: 7469 6f6e 2c20 616e 2065 7272 6f72 2077  tion, an error w
+00018570: 696c 6c20 6265 200a 2020 2020 2020 2020  ill be .        
+00018580: 2020 2020 7261 6973 6564 2028 756e 6c65      raised (unle
+00018590: 7373 2061 783d 227a 222c 2069 6e20 7768  ss ax="z", in wh
+000185a0: 6963 6820 6361 7365 2076 6f78 656c 2073  ich case voxel s
+000185b0: 697a 6520 7769 6c6c 2062 6520 696e 6665  ize will be infe
+000185c0: 7272 6564 200a 2020 2020 2020 2020 2020  rred .          
+000185d0: 2020 6672 6f6d 2073 7061 6369 6e67 2062    from spacing b
+000185e0: 6574 7765 656e 2073 6c69 6365 7329 2e0a  etween slices)..
+000185f0: 0a20 2020 2020 2020 206d 6574 686f 6420  .        method 
+00018600: 3a20 7374 722c 2064 6566 6175 6c74 3d4e  : str, default=N
+00018610: 6f6e 650a 2020 2020 2020 2020 2020 2020  one.            
+00018620: 4d65 7468 6f64 2074 6f20 7573 6520 666f  Method to use fo
+00018630: 7220 6365 6e74 726f 6964 2063 616c 6375  r centroid calcu
+00018640: 6c61 7469 6f6e 2e20 4361 6e20 6265 3a20  lation. Can be: 
+00018650: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00018660: 202d 2022 636f 6e74 6f75 7222 3a20 6765   - "contour": ge
+00018670: 7420 6365 6e74 726f 6964 206f 6620 7368  t centroid of sh
+00018680: 6170 656c 7920 636f 6e74 6f75 7228 7329  apely contour(s)
+00018690: 2e0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000186a0: 2020 2d20 226d 6173 6b22 3a20 6765 7420    - "mask": get 
+000186b0: 6176 6572 6167 6520 706f 7369 7469 6f6e  average position
+000186c0: 206f 6620 766f 7865 6c73 2069 6e20 6269   of voxels in bi
+000186d0: 6e61 7279 206d 6173 6b2e 0a20 2020 2020  nary mask..     
+000186e0: 2020 2020 2020 2020 2020 202d 204e 6f6e             - Non
+000186f0: 653a 2075 7365 2074 6865 206d 6574 686f  e: use the metho
+00018700: 6420 7365 7420 696e 2073 656c 662e 6465  d set in self.de
+00018710: 6661 756c 745f 6765 6f6d 5f6d 6574 686f  fault_geom_metho
+00018720: 642e 0a0a 2020 2020 2020 2020 666f 7263  d...        forc
+00018730: 6520 3a20 626f 6f6c 2c20 6465 6661 756c  e : bool, defaul
+00018740: 743d 5472 7565 0a20 2020 2020 2020 2020  t=True.         
+00018750: 2020 2049 6620 5472 7565 2c20 7468 6520     If True, the 
+00018760: 676c 6f62 616c 2063 656e 7472 6f69 6420  global centroid 
+00018770: 7769 6c6c 2061 6c77 6179 7320 6265 2072  will always be r
+00018780: 6563 616c 6375 6c61 7465 643b 200a 2020  ecalculated; .  
+00018790: 2020 2020 2020 2020 2020 6f74 6865 7277            otherw
+000187a0: 6973 652c 2069 7420 7769 6c6c 206f 6e6c  ise, it will onl
+000187b0: 7920 6265 2063 616c 6375 6c61 7465 6420  y be calculated 
+000187c0: 6966 2069 7420 6861 7320 6e6f 7420 7965  if it has not ye
+000187d0: 7420 6265 656e 2063 6163 6865 6420 0a20  t been cached . 
+000187e0: 2020 2020 2020 2020 2020 2069 6e20 7365             in se
+000187f0: 6c66 2e5f 766f 6c75 6d65 2e20 204e 6f74  lf._volume.  Not
+00018800: 6520 7468 6174 2069 6620 7369 6e67 6c65  e that if single
+00018810: 5f73 6c69 6365 3d54 7275 652c 2074 6865  _slice=True, the
+00018820: 2063 656e 7472 6f69 6420 7769 6c6c 200a   centroid will .
+00018830: 2020 2020 2020 2020 2020 2020 616c 7761              alwa
+00018840: 7973 2062 6520 7265 6361 6c63 756c 6174  ys be recalculat
+00018850: 6564 2e0a 0a20 2020 2020 2020 2062 795f  ed...        by_
+00018860: 736c 6963 6520 3a20 7374 722c 2064 6566  slice : str, def
+00018870: 6175 6c74 3d4e 6f6e 650a 2020 2020 2020  ault=None.      
+00018880: 2020 2020 2020 4966 206f 6e65 206f 6620        If one of 
+00018890: 226c 6566 7422 2c20 2272 6967 6874 222c  "left", "right",
+000188a0: 2022 756e 696f 6e22 2c20 2269 6e74 6572   "union", "inter
+000188b0: 7365 6374 696f 6e22 2c20 6361 6c63 756c  section", calcul
+000188c0: 6174 650a 2020 2020 2020 2020 2020 2020  ate.            
+000188d0: 4469 6365 2073 636f 7265 7320 736c 6963  Dice scores slic
+000188e0: 6520 6279 2073 6c69 6365 2066 6f72 2065  e by slice for e
+000188f0: 6163 6820 736c 6963 6520 636f 6e74 6169  ach slice contai
+00018900: 6e69 6e67 0a20 2020 2020 2020 2020 2020  ning.           
+00018910: 2073 656c 6620 616e 642f 6f72 206f 7468   self and/or oth
+00018920: 6572 3a0a 0a20 2020 2020 2020 2020 2020  er:..           
+00018930: 202d 2022 6c65 6674 223a 2063 6f6e 7369   - "left": consi
+00018940: 6465 7220 6f6e 6c79 2073 6c69 6365 7320  der only slices 
+00018950: 636f 6e74 6169 6e69 6e67 2073 656c 663b  containing self;
+00018960: 0a20 2020 2020 2020 2020 2020 202d 2022  .            - "
+00018970: 7269 6768 7422 3a20 636f 6e73 6964 6572  right": consider
+00018980: 206f 6e6c 7920 736c 6963 6573 2063 6f6e   only slices con
+00018990: 7461 696e 696e 6720 6f74 6865 723b 0a20  taining other;. 
+000189a0: 2020 2020 2020 2020 2020 202d 2022 756e             - "un
+000189b0: 696f 6e22 3a20 636f 6e73 6964 6572 2073  ion": consider s
+000189c0: 6c69 6365 7320 636f 6e74 6169 6e69 6e67  lices containing
+000189d0: 2065 6974 6865 7220 6f66 2073 656c 6620   either of self 
+000189e0: 616e 6420 6f74 6865 723b 0a20 2020 2020  and other;.     
+000189f0: 2020 2020 2020 202d 2022 696e 7465 7273         - "inters
+00018a00: 6563 7469 6f6e 223a 2063 6f6e 7369 6465  ection": conside
+00018a10: 7220 736c 6963 6573 2063 6f6e 7461 696e  r slices contain
+00018a20: 696e 6720 626f 7468 206f 6620 7365 6c66  ing both of self
+00018a30: 2061 6e64 206f 7468 6572 2e0a 0a20 2020   and other...   
+00018a40: 2020 2020 2020 2020 2049 6620 736c 6963           If slic
+00018a50: 655f 7374 6174 2069 7320 4e6f 6e65 2c20  e_stat is None, 
+00018a60: 7265 7475 726e 2061 2064 6963 7469 6f6e  return a diction
+00018a70: 6172 7920 7768 6572 6520 6b65 7973 2061  ary where keys a
+00018a80: 7265 0a20 2020 2020 2020 2020 2020 2073  re.            s
+00018a90: 6c69 6365 2070 6f73 6974 696f 6e73 2061  lice positions a
+00018aa0: 6e64 2076 616c 7565 7320 6172 6520 7468  nd values are th
+00018ab0: 6520 6361 6c63 756c 6174 6564 2044 6963  e calculated Dic
+00018ac0: 6520 7363 6f72 6573 2e0a 2020 2020 2020  e scores..      
+00018ad0: 2020 2020 2020 4f74 6865 7277 6973 652c        Otherwise,
+00018ae0: 2072 6574 7572 6e20 666f 7220 7468 6520   return for the 
+00018af0: 6361 6c63 756c 6174 6564 2044 6963 6520  calculated Dice 
+00018b00: 7363 6f72 6573 2074 6865 2073 7461 7469  scores the stati
+00018b10: 7374 6963 0a20 2020 2020 2020 2020 2020  stic.           
+00018b20: 2073 7065 6369 6669 6564 2062 7920 736c   specified by sl
+00018b30: 6963 655f 7374 6174 2e0a 0a20 2020 2020  ice_stat...     
+00018b40: 2020 2076 616c 7565 5f66 6f72 5f6e 6f6e     value_for_non
+00018b50: 6520 3a20 666c 6f61 742c 2064 6566 6175  e : float, defau
+00018b60: 6c74 3d4e 6f6e 650a 2020 2020 2020 2020  lt=None.        
+00018b70: 2020 2020 466f 7220 7369 6e67 6c65 5f73      For single_s
+00018b80: 6c69 6365 2061 6e64 2062 795f 736c 6963  lice and by_slic
+00018b90: 652c 2076 616c 7565 2074 6f20 6265 2072  e, value to be r
+00018ba0: 6574 7572 6e65 6420 666f 720a 2020 2020  eturned for.    
+00018bb0: 2020 2020 2020 2020 736c 6963 6573 2077          slices w
+00018bc0: 6865 7265 2044 6963 6520 7363 6f72 6520  here Dice score 
+00018bd0: 6973 2075 6e64 6574 6572 6d69 6e65 6420  is undetermined 
+00018be0: 284e 6f6e 6529 2e20 2046 6f72 2073 6c69  (None).  For sli
+00018bf0: 6365 5f73 7461 742c 0a20 2020 2020 2020  ce_stat,.       
+00018c00: 2020 2020 2076 616c 7565 2074 6f20 7375       value to su
+00018c10: 6273 7469 7475 7465 2066 6f72 2061 6e79  bstitute for any
+00018c20: 204e 6f6e 6520 7661 6c75 6573 2061 6d6f   None values amo
+00018c30: 6e67 2074 6865 2069 6e70 7574 730a 2020  ng the inputs.  
+00018c40: 2020 2020 2020 2020 2020 666f 7220 6361            for ca
+00018c50: 6c63 756c 6174 696e 6720 736c 6963 652d  lculating slice-
+00018c60: 6261 7365 6420 7374 6174 6973 7469 632e  based statistic.
+00018c70: 2020 4966 204e 6f6e 6520 696e 2074 6865    If None in the
+00018c80: 206c 6174 7465 720a 2020 2020 2020 2020   latter.        
+00018c90: 2020 2020 6361 7365 2c20 4e6f 6e65 2076      case, None v
+00018ca0: 616c 7565 7320 616d 6f6e 6720 7468 6520  alues among the 
+00018cb0: 696e 7075 7473 2061 7265 206f 6d69 7474  inputs are omitt
+00018cc0: 6564 2e0a 0a20 2020 2020 2020 2073 6c69  ed...        sli
+00018cd0: 6365 5f73 7461 7420 3a20 7374 722c 2064  ce_stat : str, d
+00018ce0: 6566 6175 6c74 3d4e 6f6e 650a 2020 2020  efault=None.    
+00018cf0: 2020 2020 2020 2020 5369 6e67 6c65 2d76          Single-v
+00018d00: 6172 6961 626c 6520 7374 6174 6973 7469  ariable statisti
+00018d10: 6328 7329 2074 6f20 6265 2072 6574 7572  c(s) to be retur
+00018d20: 6e65 6420 666f 7220 736c 6963 652d 6279  ned for slice-by
+00018d30: 2d73 6c69 6365 0a20 2020 2020 2020 2020  -slice.         
+00018d40: 2020 2044 6963 6520 7363 6f72 6573 2e20     Dice scores. 
+00018d50: 2054 6869 7320 7368 6f75 6c64 2062 6520   This should be 
+00018d60: 7468 6520 6e61 6d65 206f 6620 7468 6520  the name of the 
+00018d70: 6675 6e63 7469 6f6e 2066 6f72 0a20 2020  function for.   
+00018d80: 2020 2020 2020 2020 2063 616c 6375 6c61           calcula
+00018d90: 7469 6f6e 206f 6620 7468 6520 7374 6174  tion of the stat
+00018da0: 6973 7469 6328 7329 2069 6e20 7468 6520  istic(s) in the 
+00018db0: 5079 7468 6f6e 2073 7461 7469 7374 6963  Python statistic
+00018dc0: 7320 6d6f 6475 6c65 3a0a 0a20 2020 2020  s module:..     
+00018dd0: 2020 2020 2020 2068 7474 7073 3a2f 2f64         https://d
+00018de0: 6f63 732e 7079 7468 6f6e 2e6f 7267 2f33  ocs.python.org/3
+00018df0: 2f6c 6962 7261 7279 2f73 7461 7469 7374  /library/statist
+00018e00: 6963 732e 6874 6d6c 0a0a 2020 2020 2020  ics.html..      
+00018e10: 2020 2020 2020 4176 6169 6c61 626c 6520        Available 
+00018e20: 6f70 7469 6f6e 7320 696e 636c 7564 653a  options include:
+00018e30: 2022 6d65 616e 222c 2022 6d65 6469 616e   "mean", "median
+00018e40: 222c 2022 6d6f 6465 222c 0a20 2020 2020  ", "mode",.     
+00018e50: 2020 2020 2020 2022 7374 6465 7622 2c20         "stdev", 
+00018e60: 2271 7561 6e74 696c 6573 222e 2020 4469  "quantiles".  Di
+00018e70: 7372 6567 6172 6465 6420 6966 204e 6f6e  sregarded if Non
+00018e80: 652e 0a0a 2020 2020 2020 2020 2020 2020  e...            
+00018e90: 4966 2062 795f 736c 6963 6520 6973 204e  If by_slice is N
+00018ea0: 6f6e 6520 616e 6420 736c 6963 655f 7374  one and slice_st
+00018eb0: 6174 2069 7320 6469 6666 6572 656e 7420  at is different 
+00018ec0: 6672 6f6d 204e 6f6e 652c 0a20 2020 2020  from None,.     
+00018ed0: 2020 2020 2020 2073 6b72 742e 636f 7265         skrt.core
+00018ee0: 2e44 6566 6175 6c74 7328 292e 6279 5f73  .Defaults().by_s
+00018ef0: 6c69 6365 2069 7320 7573 6564 2066 6f72  lice is used for
+00018f00: 2074 6865 2066 6f72 6d65 722e 0a0a 2020   the former...  
+00018f10: 2020 2020 2020 736c 6963 655f 7374 6174        slice_stat
+00018f20: 5f6b 7761 7267 7320 3a20 6469 6374 2c20  _kwargs : dict, 
+00018f30: 6465 6661 756c 743d 4e6f 6e65 0a20 2020  default=None.   
+00018f40: 2020 2020 2020 2020 204b 6579 776f 7264           Keyword
+00018f50: 2061 7267 756d 656e 7473 2074 6f20 6265   arguments to be
+00018f60: 2070 6173 7365 6420 746f 2066 756e 6374   passed to funct
+00018f70: 696f 6e20 6f66 2073 7461 7469 7374 6963  ion of statistic
+00018f80: 730a 2020 2020 2020 2020 2020 2020 6d6f  s.            mo
+00018f90: 6475 6c65 2066 6f72 2063 616c 6375 6c61  dule for calcula
+00018fa0: 7469 6f6e 2072 656c 6174 6976 6520 746f  tion relative to
+00018fb0: 2073 6c69 6365 2076 616c 7565 732e 2020   slice values.  
+00018fc0: 466f 7220 6578 616d 706c 652c 0a20 2020  For example,.   
+00018fd0: 2020 2020 2020 2020 2069 6620 7175 616e           if quan
+00018fe0: 7469 6c65 7320 6172 6520 7265 7175 6972  tiles are requir
+00018ff0: 6564 2066 6f72 2031 3020 696e 7465 7276  ed for 10 interv
+00019000: 616c 732c 2072 6174 6865 7220 7468 616e  als, rather than
+00019010: 2066 6f72 0a20 2020 2020 2020 2020 2020   for.           
+00019020: 2074 6865 2064 6566 6175 6c74 206f 6620   the default of 
+00019030: 342c 2074 6869 7320 6361 6e20 6265 2073  4, this can be s
+00019040: 7065 6369 6669 6564 2075 7369 6e67 3a0a  pecified using:.
+00019050: 0a20 2020 2020 2020 2020 2020 2073 6c69  .            sli
+00019060: 6365 5f73 7461 745f 6b77 6172 6773 7b22  ce_stat_kwargs{"
+00019070: 6e22 203a 2031 307d 0a0a 2020 2020 2020  n" : 10}..      
+00019080: 2020 2020 2020 466f 7220 6176 6169 6c61        For availa
+00019090: 626c 6520 6b65 7977 6f72 6420 6f70 7469  ble keyword opti
+000190a0: 6f6e 732c 2073 6565 2064 6f63 756d 656e  ons, see documen
+000190b0: 7461 7469 6f6e 206f 6620 7374 6174 6973  tation of statis
+000190c0: 7469 6373 0a20 2020 2020 2020 2020 2020  tics.           
+000190d0: 206d 6f64 756c 6520 6174 3a0a 0a20 2020   module at:..   
+000190e0: 2020 2020 2020 2020 2068 7474 7073 3a2f           https:/
+000190f0: 2f64 6f63 732e 7079 7468 6f6e 2e6f 7267  /docs.python.org
+00019100: 2f33 2f6c 6962 7261 7279 2f73 7461 7469  /3/library/stati
+00019110: 7374 6963 732e 6874 6d6c 0a20 2020 2020  stics.html.     
+00019120: 2020 2022 2222 0a20 2020 2020 2020 2069     """.        i
+00019130: 6620 736c 6963 655f 7374 6174 3a0a 2020  f slice_stat:.  
+00019140: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00019150: 2073 656c 662e 6765 745f 736c 6963 655f   self.get_slice_
+00019160: 7374 6174 2872 6f69 2c20 2261 6273 5f63  stat(roi, "abs_c
+00019170: 656e 7472 6f69 6422 2c20 736c 6963 655f  entroid", slice_
+00019180: 7374 6174 2c0a 2020 2020 2020 2020 2020  stat,.          
+00019190: 2020 2020 2020 2020 2020 6279 5f73 6c69            by_sli
+000191a0: 6365 2c20 7661 6c75 655f 666f 725f 6e6f  ce, value_for_no
+000191b0: 6e65 2c20 7669 6577 2c20 6d65 7468 6f64  ne, view, method
+000191c0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+000191d0: 2020 2020 2020 2a2a 2873 6c69 6365 5f73        **(slice_s
+000191e0: 7461 745f 6b77 6172 6773 206f 7220 7b7d  tat_kwargs or {}
+000191f0: 2929 0a0a 2020 2020 2020 2020 6966 2062  ))..        if b
+00019200: 795f 736c 6963 653a 0a20 2020 2020 2020  y_slice:.       
+00019210: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+00019220: 2e67 6574 5f6d 6574 7269 635f 6279 5f73  .get_metric_by_s
+00019230: 6c69 6365 2872 6f69 2c20 2261 6273 5f63  lice(roi, "abs_c
+00019240: 656e 7472 6f69 6422 2c20 6279 5f73 6c69  entroid", by_sli
+00019250: 6365 2c0a 2020 2020 2020 2020 2020 2020  ce,.            
+00019260: 2020 2020 2020 2020 7669 6577 2c20 6d65          view, me
+00019270: 7468 6f64 290a 0a20 2020 2020 2020 2023  thod)..        #
+00019280: 2049 6620 666c 6174 7465 6e69 6e67 2c20   If flattening, 
+00019290: 6e65 6564 2074 6f20 6765 7420 3344 2063  need to get 3D c
+000192a0: 656e 7472 6f69 6420 7665 6374 6f72 0a20  entroid vector. 
+000192b0: 2020 2020 2020 2069 6620 666c 6174 7465         if flatte
+000192c0: 6e3a 0a20 2020 2020 2020 2020 2020 2073  n:.            s
+000192d0: 696e 676c 655f 736c 6963 6520 3d20 4661  ingle_slice = Fa
+000192e0: 6c73 650a 0a20 2020 2020 2020 2023 2047  lse..        # G
+000192f0: 6574 2063 656e 7472 6f69 6420 7665 6374  et centroid vect
+00019300: 6f72 0a20 2020 2020 2020 2063 656e 7472  or.        centr
+00019310: 6f69 6420 3d20 7365 6c66 2e67 6574 5f63  oid = self.get_c
+00019320: 656e 7472 6f69 645f 6469 7374 616e 6365  entroid_distance
+00019330: 280a 2020 2020 2020 2020 2020 2020 726f  (.            ro
+00019340: 692c 200a 2020 2020 2020 2020 2020 2020  i, .            
+00019350: 7669 6577 3d76 6965 772c 200a 2020 2020  view=view, .    
+00019360: 2020 2020 2020 2020 7369 6e67 6c65 5f73          single_s
+00019370: 6c69 6365 3d73 696e 676c 655f 736c 6963  lice=single_slic
+00019380: 652c 0a20 2020 2020 2020 2020 2020 2073  e,.            s
+00019390: 6c3d 736c 2c0a 2020 2020 2020 2020 2020  l=sl,.          
+000193a0: 2020 6964 783d 6964 782c 0a20 2020 2020    idx=idx,.     
+000193b0: 2020 2020 2020 2070 6f73 3d70 6f73 2c0a         pos=pos,.
+000193c0: 2020 2020 2020 2020 2020 2020 756e 6974              unit
+000193d0: 733d 756e 6974 732c 0a20 2020 2020 2020  s=units,.       
+000193e0: 2020 2020 206d 6574 686f 643d 6d65 7468       method=meth
+000193f0: 6f64 2c0a 2020 2020 2020 2020 2020 2020  od,.            
+00019400: 666f 7263 653d 666f 7263 652c 0a20 2020  force=force,.   
+00019410: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
+00019420: 2320 4966 2063 656e 7472 6f69 6420 7761  # If centroid wa
+00019430: 736e 2774 2061 7661 696c 6162 6c65 2c20  sn't available, 
+00019440: 7265 7475 726e 204e 6f6e 650a 2020 2020  return None.    
+00019450: 2020 2020 6966 204e 6f6e 6520 696e 2063      if None in c
+00019460: 656e 7472 6f69 643a 0a20 2020 2020 2020  entroid:.       
+00019470: 2020 2020 2072 6574 7572 6e20 7661 6c75       return valu
+00019480: 655f 666f 725f 6e6f 6e65 0a0a 2020 2020  e_for_none..    
+00019490: 2020 2020 2320 4966 2066 6c61 7474 656e      # If flatten
+000194a0: 696e 672c 2074 616b 6520 3220 6178 6573  ing, take 2 axes
+000194b0: 206f 6e6c 790a 2020 2020 2020 2020 6966   only.        if
+000194c0: 2066 6c61 7474 656e 3a0a 2020 2020 2020   flatten:.      
+000194d0: 2020 2020 2020 785f 6178 2c20 795f 6178        x_ax, y_ax
+000194e0: 203d 2073 6b72 742e 696d 6167 652e 5f70   = skrt.image._p
+000194f0: 6c6f 745f 6178 6573 5b76 6965 775d 0a20  lot_axes[view]. 
+00019500: 2020 2020 2020 2020 2020 2063 656e 7472             centr
+00019510: 6f69 6420 3d20 6e70 2e61 7272 6179 285b  oid = np.array([
+00019520: 6365 6e74 726f 6964 5b78 5f61 785d 2c20  centroid[x_ax], 
+00019530: 6365 6e74 726f 6964 5b79 5f61 785d 5d29  centroid[y_ax]])
+00019540: 0a0a 2020 2020 2020 2020 2320 5265 7475  ..        # Retu
+00019550: 726e 206d 6167 6e69 7475 6465 206f 6620  rn magnitude of 
+00019560: 7665 6374 6f72 0a20 2020 2020 2020 2072  vector.        r
+00019570: 6574 7572 6e20 6e70 2e6c 696e 616c 672e  eturn np.linalg.
+00019580: 6e6f 726d 2863 656e 7472 6f69 6429 0a0a  norm(centroid)..
+00019590: 2020 2020 6465 6620 6765 745f 6469 6365      def get_dice
+000195a0: 280a 2020 2020 2020 2020 7365 6c66 2c20  (.        self, 
+000195b0: 0a20 2020 2020 2020 206f 7468 6572 2c20  .        other, 
+000195c0: 0a20 2020 2020 2020 2073 696e 676c 655f  .        single_
+000195d0: 736c 6963 653d 4661 6c73 652c 0a20 2020  slice=False,.   
+000195e0: 2020 2020 2076 6965 773d 2278 2d79 222c       view="x-y",
+000195f0: 200a 2020 2020 2020 2020 736c 3d4e 6f6e   .        sl=Non
+00019600: 652c 200a 2020 2020 2020 2020 6964 783d  e, .        idx=
+00019610: 4e6f 6e65 2c20 0a20 2020 2020 2020 2070  None, .        p
+00019620: 6f73 3d4e 6f6e 652c 200a 2020 2020 2020  os=None, .      
+00019630: 2020 6d65 7468 6f64 3d4e 6f6e 652c 0a20    method=None,. 
+00019640: 2020 2020 2020 2066 6c61 7474 656e 3d46         flatten=F
+00019650: 616c 7365 2c0a 2020 2020 2020 2020 6279  alse,.        by
+00019660: 5f73 6c69 6365 3d4e 6f6e 652c 0a20 2020  _slice=None,.   
+00019670: 2020 2020 2076 616c 7565 5f66 6f72 5f6e       value_for_n
+00019680: 6f6e 653d 4e6f 6e65 2c0a 2020 2020 2020  one=None,.      
+00019690: 2020 736c 6963 655f 7374 6174 3d4e 6f6e    slice_stat=Non
+000196a0: 652c 0a20 2020 2020 2020 2073 6c69 6365  e,.        slice
+000196b0: 5f73 7461 745f 6b77 6172 6773 3d4e 6f6e  _stat_kwargs=Non
+000196c0: 652c 0a20 2020 2029 3a0a 2020 2020 2020  e,.    ):.      
+000196d0: 2020 2222 220a 2020 2020 2020 2020 4765    """.        Ge
+000196e0: 7420 4469 6365 2073 636f 7265 2077 6974  t Dice score wit
+000196f0: 6820 7265 7370 6563 7420 746f 2061 6e6f  h respect to ano
+00019700: 7468 6572 2052 4f49 2c0a 2020 2020 2020  ther ROI,.      
+00019710: 2020 676c 6f62 616c 6c79 2c20 6f6e 2061    globally, on a
+00019720: 2073 696e 676c 6520 736c 6963 652c 2073   single slice, s
+00019730: 6c69 6365 2062 7920 736c 6963 652c 206f  lice by slice, o
+00019740: 7220 736c 6963 6520 6176 6572 6167 6564  r slice averaged
+00019750: 2e0a 0a20 2020 2020 2020 202a 2a50 6172  ...        **Par
+00019760: 616d 6574 6572 733a 2a2a 0a20 2020 2020  ameters:**.     
+00019770: 2020 200a 2020 2020 2020 2020 6f74 6865     .        othe
+00019780: 7220 3a20 524f 490a 2020 2020 2020 2020  r : ROI.        
+00019790: 2020 2020 4f74 6865 7220 524f 4920 746f      Other ROI to
+000197a0: 2063 6f6d 7061 7265 2077 6974 6820 7468   compare with th
+000197b0: 6973 2052 4f49 2e0a 0a20 2020 2020 2020  is ROI...       
+000197c0: 2073 696e 676c 655f 736c 6963 6520 3a20   single_slice : 
+000197d0: 626f 6f6c 2c20 6465 6661 756c 743d 4661  bool, default=Fa
+000197e0: 6c73 650a 2020 2020 2020 2020 2020 2020  lse.            
+000197f0: 4966 2046 616c 7365 2c20 7468 6520 676c  If False, the gl
+00019800: 6f62 616c 2033 4420 4469 6365 2073 636f  obal 3D Dice sco
+00019810: 7265 206f 6620 7468 6520 6675 6c6c 2052  re of the full R
+00019820: 4f49 7320 7769 6c6c 2062 6520 7265 7475  OIs will be retu
+00019830: 726e 6564 3b0a 2020 2020 2020 2020 2020  rned;.          
+00019840: 2020 6f74 6865 7277 6973 652c 2074 6865    otherwise, the
+00019850: 2032 4420 4469 6365 2073 636f 7265 206f   2D Dice score o
+00019860: 6e20 6120 7369 6e67 6c65 2073 6c69 6365  n a single slice
+00019870: 2077 696c 6c20 6265 2072 6574 7572 6e65   will be returne
+00019880: 642e 0a0a 2020 2020 2020 2020 7669 6577  d...        view
+00019890: 203a 2073 7472 2c20 6465 6661 756c 743d   : str, default=
+000198a0: 2278 2d79 220a 2020 2020 2020 2020 2020  "x-y".          
+000198b0: 2020 4f72 6965 6e74 6174 696f 6e20 6f66    Orientation of
+000198c0: 2073 6c69 6365 206f 6e20 7768 6963 6820   slice on which 
+000198d0: 746f 2067 6574 2044 6963 6520 7363 6f72  to get Dice scor
+000198e0: 652e 204f 6e6c 7920 7573 6564 2069 6620  e. Only used if 
+000198f0: 0a20 2020 2020 2020 2020 2020 2073 696e  .            sin
+00019900: 676c 655f 736c 6963 653d 5472 7565 2e20  gle_slice=True. 
+00019910: 4966 2075 7369 6e67 2c20 3c61 783e 206d  If using, <ax> m
+00019920: 7573 7420 6265 2061 6e20 6178 6973 2074  ust be an axis t
+00019930: 6861 7420 6c69 6573 2061 6c6f 6e67 0a20  hat lies along. 
+00019940: 2020 2020 2020 2020 2020 2074 6865 2073             the s
+00019950: 6c69 6365 2069 6e20 7468 6973 206f 7269  lice in this ori
+00019960: 656e 7461 7469 6f6e 2e0a 0a20 2020 2020  entation...     
+00019970: 2020 2073 6c20 3a20 696e 742c 2064 6566     sl : int, def
+00019980: 6175 6c74 3d4e 6f6e 650a 2020 2020 2020  ault=None.      
+00019990: 2020 2020 2020 536c 6963 6520 6e75 6d62        Slice numb
+000199a0: 6572 2e20 4966 206e 6f6e 6520 6f66 203c  er. If none of <
+000199b0: 736c 3e2c 203c 6964 783e 206f 7220 3c70  sl>, <idx> or <p
+000199c0: 6f73 3e20 6172 6520 7375 7070 6c69 6564  os> are supplied
+000199d0: 2062 7574 0a20 2020 2020 2020 2020 2020   but.           
+000199e0: 203c 7369 6e67 6c65 5f73 6c69 6365 3e20   <single_slice> 
+000199f0: 6973 2054 7275 652c 2074 6865 2063 656e  is True, the cen
+00019a00: 7472 616c 2073 6c69 6365 206f 6620 7468  tral slice of th
+00019a10: 6973 2052 4f49 2077 696c 6c20 6265 2075  is ROI will be u
+00019a20: 7365 642e 0a0a 2020 2020 2020 2020 6964  sed...        id
+00019a30: 7820 3a20 696e 742c 2064 6566 6175 6c74  x : int, default
+00019a40: 3d4e 6f6e 650a 2020 2020 2020 2020 2020  =None.          
+00019a50: 2020 4172 7261 7920 696e 6465 7820 6f66    Array index of
+00019a60: 2073 6c69 6365 2e20 4966 206e 6f6e 6520   slice. If none 
+00019a70: 6f66 203c 736c 3e2c 203c 6964 783e 206f  of <sl>, <idx> o
+00019a80: 7220 3c70 6f73 3e20 6172 6520 7375 7070  r <pos> are supp
+00019a90: 6c69 6564 2062 7574 0a20 2020 2020 2020  lied but.       
+00019aa0: 2020 2020 203c 7369 6e67 6c65 5f73 6c69       <single_sli
+00019ab0: 6365 3e20 6973 2054 7275 652c 2074 6865  ce> is True, the
+00019ac0: 2063 656e 7472 616c 2073 6c69 6365 206f   central slice o
+00019ad0: 6620 7468 6973 2052 4f49 2077 696c 6c20  f this ROI will 
+00019ae0: 6265 2075 7365 642e 0a0a 2020 2020 2020  be used...      
+00019af0: 2020 706f 7320 3a20 666c 6f61 742c 2064    pos : float, d
+00019b00: 6566 6175 6c74 3d4e 6f6e 650a 2020 2020  efault=None.    
+00019b10: 2020 2020 2020 2020 536c 6963 6520 706f          Slice po
+00019b20: 7369 7469 6f6e 2069 6e20 6d6d 2e20 4966  sition in mm. If
+00019b30: 206e 6f6e 6520 6f66 203c 736c 3e2c 203c   none of <sl>, <
+00019b40: 6964 783e 206f 7220 3c70 6f73 3e20 6172  idx> or <pos> ar
+00019b50: 6520 7375 7070 6c69 6564 2062 7574 0a20  e supplied but. 
+00019b60: 2020 2020 2020 2020 2020 203c 7369 6e67             <sing
+00019b70: 6c65 5f73 6c69 6365 3e20 6973 2054 7275  le_slice> is Tru
+00019b80: 652c 2074 6865 2063 656e 7472 616c 2073  e, the central s
+00019b90: 6c69 6365 206f 6620 7468 6973 2052 4f49  lice of this ROI
+00019ba0: 2077 696c 6c20 6265 2075 7365 642e 0a0a   will be used...
+00019bb0: 2020 2020 2020 2020 6d65 7468 6f64 203a          method :
+00019bc0: 2073 7472 2c20 6465 6661 756c 743d 4e6f   str, default=No
+00019bd0: 6e65 0a20 2020 2020 2020 2020 2020 204d  ne.            M
+00019be0: 6574 686f 6420 746f 2075 7365 2066 6f72  ethod to use for
+00019bf0: 2044 6963 6520 7363 6f72 6520 6361 6c63   Dice score calc
+00019c00: 756c 6174 696f 6e2e 2043 616e 2062 653a  ulation. Can be:
+00019c10: 200a 2020 2020 2020 2020 2020 2020 2020   .              
+00019c20: 2020 2d20 2263 6f6e 746f 7572 223a 2067    - "contour": g
+00019c30: 6574 2069 6e74 6572 7365 6374 696f 6e73  et intersections
+00019c40: 2061 6e64 2061 7265 6173 206f 6620 7368   and areas of sh
+00019c50: 6170 656c 7920 636f 6e74 6f75 7273 2e0a  apely contours..
+00019c60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019c70: 2d20 226d 6173 6b22 3a20 636f 756e 7420  - "mask": count 
+00019c80: 696e 7465 7273 6563 7469 6e67 2076 6f78  intersecting vox
+00019c90: 656c 7320 696e 2062 696e 6172 7920 6d61  els in binary ma
+00019ca0: 736b 732e 0a20 2020 2020 2020 2020 2020  sks..           
+00019cb0: 2020 2020 202d 204e 6f6e 653a 2075 7365       - None: use
+00019cc0: 2074 6865 206d 6574 686f 6420 7365 7420   the method set 
+00019cd0: 696e 2073 656c 662e 6465 6661 756c 745f  in self.default_
+00019ce0: 6765 6f6d 5f6d 6574 686f 642e 0a0a 2020  geom_method...  
+00019cf0: 2020 2020 2020 666c 6174 7465 6e20 3a20        flatten : 
+00019d00: 626f 6f6c 2c20 6465 6661 756c 743d 4661  bool, default=Fa
+00019d10: 6c73 650a 2020 2020 2020 2020 2020 2020  lse.            
+00019d20: 4966 2054 7275 652c 2061 6c6c 2073 6c69  If True, all sli
+00019d30: 6365 7320 7769 6c6c 2062 6520 666c 6174  ces will be flat
+00019d40: 7465 6e65 6420 696e 2074 6865 2067 6976  tened in the giv
+00019d50: 656e 206f 7269 656e 7461 7469 6f6e 2061  en orientation a
+00019d60: 6e64 0a20 2020 2020 2020 2020 2020 2074  nd.            t
+00019d70: 6865 2044 6963 6520 7363 6f72 6520 6f66  he Dice score of
+00019d80: 2074 6865 2066 6c61 7474 656e 6564 2073   the flattened s
+00019d90: 6c69 6365 7320 7769 6c6c 2062 6520 7265  lices will be re
+00019da0: 7475 726e 6564 2e20 4f6e 6c79 200a 2020  turned. Only .  
+00019db0: 2020 2020 2020 2020 2020 6176 6169 6c61            availa
+00019dc0: 626c 6520 6966 206d 6574 686f 643d 226d  ble if method="m
+00019dd0: 6173 6b22 2e0a 0a20 2020 2020 2020 2062  ask"...        b
+00019de0: 795f 736c 6963 6520 3a20 7374 722c 2064  y_slice : str, d
+00019df0: 6566 6175 6c74 3d4e 6f6e 650a 2020 2020  efault=None.    
+00019e00: 2020 2020 2020 2020 4966 206f 6e65 206f          If one o
+00019e10: 6620 226c 6566 7422 2c20 2272 6967 6874  f "left", "right
+00019e20: 222c 2022 756e 696f 6e22 2c20 2269 6e74  ", "union", "int
+00019e30: 6572 7365 6374 696f 6e22 2c20 6361 6c63  ersection", calc
+00019e40: 756c 6174 650a 2020 2020 2020 2020 2020  ulate.          
+00019e50: 2020 4469 6365 2073 636f 7265 7320 736c    Dice scores sl
+00019e60: 6963 6520 6279 2073 6c69 6365 2066 6f72  ice by slice for
+00019e70: 2065 6163 6820 736c 6963 6520 636f 6e74   each slice cont
+00019e80: 6169 6e69 6e67 0a20 2020 2020 2020 2020  aining.         
+00019e90: 2020 2073 656c 6620 616e 642f 6f72 206f     self and/or o
+00019ea0: 7468 6572 3a0a 0a20 2020 2020 2020 2020  ther:..         
+00019eb0: 2020 202d 2022 6c65 6674 223a 2063 6f6e     - "left": con
+00019ec0: 7369 6465 7220 6f6e 6c79 2073 6c69 6365  sider only slice
+00019ed0: 7320 636f 6e74 6169 6e69 6e67 2073 656c  s containing sel
+00019ee0: 663b 0a20 2020 2020 2020 2020 2020 202d  f;.            -
+00019ef0: 2022 7269 6768 7422 3a20 636f 6e73 6964   "right": consid
+00019f00: 6572 206f 6e6c 7920 736c 6963 6573 2063  er only slices c
+00019f10: 6f6e 7461 696e 696e 6720 6f74 6865 723b  ontaining other;
+00019f20: 0a20 2020 2020 2020 2020 2020 202d 2022  .            - "
+00019f30: 756e 696f 6e22 3a20 636f 6e73 6964 6572  union": consider
+00019f40: 2073 6c69 6365 7320 636f 6e74 6169 6e69   slices containi
+00019f50: 6e67 2065 6974 6865 7220 6f66 2073 656c  ng either of sel
+00019f60: 6620 616e 6420 6f74 6865 723b 0a20 2020  f and other;.   
+00019f70: 2020 2020 2020 2020 202d 2022 696e 7465           - "inte
+00019f80: 7273 6563 7469 6f6e 223a 2063 6f6e 7369  rsection": consi
+00019f90: 6465 7220 736c 6963 6573 2063 6f6e 7461  der slices conta
+00019fa0: 696e 696e 6720 626f 7468 206f 6620 7365  ining both of se
+00019fb0: 6c66 2061 6e64 206f 7468 6572 2e0a 0a20  lf and other... 
+00019fc0: 2020 2020 2020 2020 2020 2049 6620 736c             If sl
+00019fd0: 6963 655f 7374 6174 2069 7320 4e6f 6e65  ice_stat is None
+00019fe0: 2c20 7265 7475 726e 2061 2064 6963 7469  , return a dicti
+00019ff0: 6f6e 6172 7920 7768 6572 6520 6b65 7973  onary where keys
+0001a000: 2061 7265 0a20 2020 2020 2020 2020 2020   are.           
+0001a010: 2073 6c69 6365 2070 6f73 6974 696f 6e73   slice positions
+0001a020: 2061 6e64 2076 616c 7565 7320 6172 6520   and values are 
+0001a030: 7468 6520 6361 6c63 756c 6174 6564 2044  the calculated D
+0001a040: 6963 6520 7363 6f72 6573 2e0a 2020 2020  ice scores..    
+0001a050: 2020 2020 2020 2020 4f74 6865 7277 6973          Otherwis
+0001a060: 652c 2072 6574 7572 6e20 666f 7220 7468  e, return for th
+0001a070: 6520 6361 6c63 756c 6174 6564 2044 6963  e calculated Dic
+0001a080: 6520 7363 6f72 6573 2074 6865 2073 7461  e scores the sta
+0001a090: 7469 7374 6963 0a20 2020 2020 2020 2020  tistic.         
+0001a0a0: 2020 2073 7065 6369 6669 6564 2062 7920     specified by 
+0001a0b0: 736c 6963 655f 7374 6174 2e0a 0a20 2020  slice_stat...   
+0001a0c0: 2020 2020 2076 616c 7565 5f66 6f72 5f6e       value_for_n
+0001a0d0: 6f6e 6520 3a20 666c 6f61 742c 2064 6566  one : float, def
+0001a0e0: 6175 6c74 3d4e 6f6e 650a 2020 2020 2020  ault=None.      
+0001a0f0: 2020 2020 2020 466f 7220 7369 6e67 6c65        For single
+0001a100: 5f73 6c69 6365 2061 6e64 2062 795f 736c  _slice and by_sl
+0001a110: 6963 652c 2076 616c 7565 2074 6f20 6265  ice, value to be
+0001a120: 2072 6574 7572 6e65 6420 666f 720a 2020   returned for.  
+0001a130: 2020 2020 2020 2020 2020 736c 6963 6573            slices
+0001a140: 2077 6865 7265 2044 6963 6520 7363 6f72   where Dice scor
+0001a150: 6520 6973 2075 6e64 6574 6572 6d69 6e65  e is undetermine
+0001a160: 6420 284e 6f6e 6529 2e20 2046 6f72 2073  d (None).  For s
+0001a170: 6c69 6365 5f73 7461 742c 0a20 2020 2020  lice_stat,.     
+0001a180: 2020 2020 2020 2076 616c 7565 2074 6f20         value to 
+0001a190: 7375 6273 7469 7475 7465 2066 6f72 2061  substitute for a
+0001a1a0: 6e79 204e 6f6e 6520 7661 6c75 6573 2061  ny None values a
+0001a1b0: 6d6f 6e67 2074 6865 2069 6e70 7574 730a  mong the inputs.
+0001a1c0: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+0001a1d0: 6361 6c63 756c 6174 696e 6720 736c 6963  calculating slic
+0001a1e0: 652d 6261 7365 6420 7374 6174 6973 7469  e-based statisti
+0001a1f0: 632e 2020 4966 204e 6f6e 6520 696e 2074  c.  If None in t
+0001a200: 6865 206c 6174 7465 720a 2020 2020 2020  he latter.      
+0001a210: 2020 2020 2020 6361 7365 2c20 4e6f 6e65        case, None
+0001a220: 2076 616c 7565 7320 616d 6f6e 6720 7468   values among th
+0001a230: 6520 696e 7075 7473 2061 7265 206f 6d69  e inputs are omi
+0001a240: 7474 6564 2e0a 0a20 2020 2020 2020 2073  tted...        s
+0001a250: 6c69 6365 5f73 7461 7420 3a20 7374 722c  lice_stat : str,
+0001a260: 2064 6566 6175 6c74 3d4e 6f6e 650a 2020   default=None.  
+0001a270: 2020 2020 2020 2020 2020 5369 6e67 6c65            Single
+0001a280: 2d76 6172 6961 626c 6520 7374 6174 6973  -variable statis
+0001a290: 7469 6328 7329 2074 6f20 6265 2072 6574  tic(s) to be ret
+0001a2a0: 7572 6e65 6420 666f 7220 736c 6963 652d  urned for slice-
+0001a2b0: 6279 2d73 6c69 6365 0a20 2020 2020 2020  by-slice.       
+0001a2c0: 2020 2020 2044 6963 6520 7363 6f72 6573       Dice scores
+0001a2d0: 2e20 2054 6869 7320 7368 6f75 6c64 2062  .  This should b
+0001a2e0: 6520 7468 6520 6e61 6d65 206f 6620 7468  e the name of th
+0001a2f0: 6520 6675 6e63 7469 6f6e 2066 6f72 0a20  e function for. 
+0001a300: 2020 2020 2020 2020 2020 2063 616c 6375             calcu
+0001a310: 6c61 7469 6f6e 206f 6620 7468 6520 7374  lation of the st
+0001a320: 6174 6973 7469 6328 7329 2069 6e20 7468  atistic(s) in th
+0001a330: 6520 5079 7468 6f6e 2073 7461 7469 7374  e Python statist
+0001a340: 6963 7320 6d6f 6475 6c65 3a0a 0a20 2020  ics module:..   
+0001a350: 2020 2020 2020 2020 2068 7474 7073 3a2f           https:/
+0001a360: 2f64 6f63 732e 7079 7468 6f6e 2e6f 7267  /docs.python.org
+0001a370: 2f33 2f6c 6962 7261 7279 2f73 7461 7469  /3/library/stati
+0001a380: 7374 6963 732e 6874 6d6c 0a0a 2020 2020  stics.html..    
+0001a390: 2020 2020 2020 2020 4176 6169 6c61 626c          Availabl
+0001a3a0: 6520 6f70 7469 6f6e 7320 696e 636c 7564  e options includ
+0001a3b0: 653a 2022 6d65 616e 222c 2022 6d65 6469  e: "mean", "medi
+0001a3c0: 616e 222c 2022 6d6f 6465 222c 0a20 2020  an", "mode",.   
+0001a3d0: 2020 2020 2020 2020 2022 7374 6465 7622           "stdev"
+0001a3e0: 2c20 2271 7561 6e74 696c 6573 222e 2020  , "quantiles".  
+0001a3f0: 4469 7372 6567 6172 6465 6420 6966 204e  Disregarded if N
+0001a400: 6f6e 652e 0a0a 2020 2020 2020 2020 2020  one...          
+0001a410: 2020 4966 2062 795f 736c 6963 6520 6973    If by_slice is
+0001a420: 204e 6f6e 6520 616e 6420 736c 6963 655f   None and slice_
+0001a430: 7374 6174 2069 7320 6469 6666 6572 656e  stat is differen
+0001a440: 7420 6672 6f6d 204e 6f6e 652c 0a20 2020  t from None,.   
+0001a450: 2020 2020 2020 2020 2073 6b72 742e 636f           skrt.co
+0001a460: 7265 2e44 6566 6175 6c74 7328 292e 6279  re.Defaults().by
+0001a470: 5f73 6c69 6365 2069 7320 7573 6564 2066  _slice is used f
+0001a480: 6f72 2074 6865 2066 6f72 6d65 722e 0a0a  or the former...
+0001a490: 2020 2020 2020 2020 736c 6963 655f 7374          slice_st
+0001a4a0: 6174 5f6b 7761 7267 7320 3a20 6469 6374  at_kwargs : dict
+0001a4b0: 2c20 6465 6661 756c 743d 4e6f 6e65 0a20  , default=None. 
+0001a4c0: 2020 2020 2020 2020 2020 204b 6579 776f             Keywo
+0001a4d0: 7264 2061 7267 756d 656e 7473 2074 6f20  rd arguments to 
+0001a4e0: 6265 2070 6173 7365 6420 746f 2066 756e  be passed to fun
+0001a4f0: 6374 696f 6e20 6f66 2073 7461 7469 7374  ction of statist
+0001a500: 6963 730a 2020 2020 2020 2020 2020 2020  ics.            
+0001a510: 6d6f 6475 6c65 2066 6f72 2063 616c 6375  module for calcu
+0001a520: 6c61 7469 6f6e 2072 656c 6174 6976 6520  lation relative 
+0001a530: 746f 2073 6c69 6365 2076 616c 7565 732e  to slice values.
+0001a540: 2020 466f 7220 6578 616d 706c 652c 0a20    For example,. 
+0001a550: 2020 2020 2020 2020 2020 2069 6620 7175             if qu
+0001a560: 616e 7469 6c65 7320 6172 6520 7265 7175  antiles are requ
+0001a570: 6972 6564 2066 6f72 2031 3020 696e 7465  ired for 10 inte
+0001a580: 7276 616c 732c 2072 6174 6865 7220 7468  rvals, rather th
+0001a590: 616e 2066 6f72 0a20 2020 2020 2020 2020  an for.         
+0001a5a0: 2020 2074 6865 2064 6566 6175 6c74 206f     the default o
+0001a5b0: 6620 342c 2074 6869 7320 6361 6e20 6265  f 4, this can be
+0001a5c0: 2073 7065 6369 6669 6564 2075 7369 6e67   specified using
+0001a5d0: 3a0a 0a20 2020 2020 2020 2020 2020 2073  :..            s
+0001a5e0: 6c69 6365 5f73 7461 745f 6b77 6172 6773  lice_stat_kwargs
+0001a5f0: 7b22 6e22 203a 2031 307d 0a0a 2020 2020  {"n" : 10}..    
+0001a600: 2020 2020 2020 2020 466f 7220 6176 6169          For avai
+0001a610: 6c61 626c 6520 6b65 7977 6f72 6420 6f70  lable keyword op
+0001a620: 7469 6f6e 732c 2073 6565 2064 6f63 756d  tions, see docum
+0001a630: 656e 7461 7469 6f6e 206f 6620 7374 6174  entation of stat
+0001a640: 6973 7469 6373 0a20 2020 2020 2020 2020  istics.         
+0001a650: 2020 206d 6f64 756c 6520 6174 3a0a 0a20     module at:.. 
+0001a660: 2020 2020 2020 2020 2020 2068 7474 7073             https
+0001a670: 3a2f 2f64 6f63 732e 7079 7468 6f6e 2e6f  ://docs.python.o
+0001a680: 7267 2f33 2f6c 6962 7261 7279 2f73 7461  rg/3/library/sta
+0001a690: 7469 7374 6963 732e 6874 6d6c 0a20 2020  tistics.html.   
+0001a6a0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+0001a6b0: 2069 6620 736c 6963 655f 7374 6174 3a0a   if slice_stat:.
+0001a6c0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+0001a6d0: 726e 2073 656c 662e 6765 745f 736c 6963  rn self.get_slic
+0001a6e0: 655f 7374 6174 286f 7468 6572 2c20 2264  e_stat(other, "d
+0001a6f0: 6963 6522 2c20 736c 6963 655f 7374 6174  ice", slice_stat
+0001a700: 2c20 6279 5f73 6c69 6365 2c0a 2020 2020  , by_slice,.    
+0001a710: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a720: 7661 6c75 655f 666f 725f 6e6f 6e65 2c20  value_for_none, 
+0001a730: 7669 6577 2c20 6d65 7468 6f64 2c20 2a2a  view, method, **
+0001a740: 2873 6c69 6365 5f73 7461 745f 6b77 6172  (slice_stat_kwar
+0001a750: 6773 206f 7220 7b7d 2929 0a0a 2020 2020  gs or {}))..    
+0001a760: 2020 2020 6966 2062 795f 736c 6963 653a      if by_slice:
+0001a770: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+0001a780: 7572 6e20 7365 6c66 2e67 6574 5f6d 6574  urn self.get_met
+0001a790: 7269 635f 6279 5f73 6c69 6365 286f 7468  ric_by_slice(oth
+0001a7a0: 6572 2c20 2264 6963 6522 2c20 6279 5f73  er, "dice", by_s
+0001a7b0: 6c69 6365 2c0a 2020 2020 2020 2020 2020  lice,.          
+0001a7c0: 2020 2020 2020 2020 2020 7669 6577 2c20            view, 
+0001a7d0: 6d65 7468 6f64 290a 0a20 2020 2020 2020  method)..       
+0001a7e0: 2069 6e74 6572 7365 6374 696f 6e2c 2075   intersection, u
+0001a7f0: 6e69 6f6e 2c20 6d65 616e 5f73 697a 6520  nion, mean_size 
+0001a800: 3d20 7365 6c66 2e67 6574 5f69 6e74 6572  = self.get_inter
+0001a810: 7365 6374 696f 6e5f 756e 696f 6e5f 7369  section_union_si
+0001a820: 7a65 280a 2020 2020 2020 2020 2020 2020  ze(.            
+0001a830: 2020 2020 6f74 6865 722c 2073 696e 676c      other, singl
+0001a840: 655f 736c 6963 652c 2076 6965 772c 2073  e_slice, view, s
+0001a850: 6c2c 2069 6478 2c20 706f 732c 206d 6574  l, idx, pos, met
+0001a860: 686f 642c 2066 6c61 7474 656e 290a 0a20  hod, flatten).. 
+0001a870: 2020 2020 2020 2072 6574 7572 6e20 2869         return (i
+0001a880: 6e74 6572 7365 6374 696f 6e20 2f20 6d65  ntersection / me
+0001a890: 616e 5f73 697a 6520 6966 206d 6561 6e5f  an_size if mean_
+0001a8a0: 7369 7a65 2065 6c73 6520 7661 6c75 655f  size else value_
+0001a8b0: 666f 725f 6e6f 6e65 290a 0a20 2020 2064  for_none)..    d
+0001a8c0: 6566 2067 6574 5f6a 6163 6361 7264 280a  ef get_jaccard(.
+0001a8d0: 2020 2020 2020 2020 7365 6c66 2c20 0a20          self, . 
+0001a8e0: 2020 2020 2020 206f 7468 6572 2c20 0a20         other, . 
+0001a8f0: 2020 2020 2020 2073 696e 676c 655f 736c         single_sl
+0001a900: 6963 653d 4661 6c73 652c 0a20 2020 2020  ice=False,.     
+0001a910: 2020 2076 6965 773d 2278 2d79 222c 200a     view="x-y", .
+0001a920: 2020 2020 2020 2020 736c 3d4e 6f6e 652c          sl=None,
+0001a930: 200a 2020 2020 2020 2020 6964 783d 4e6f   .        idx=No
+0001a940: 6e65 2c20 0a20 2020 2020 2020 2070 6f73  ne, .        pos
+0001a950: 3d4e 6f6e 652c 200a 2020 2020 2020 2020  =None, .        
+0001a960: 6d65 7468 6f64 3d4e 6f6e 652c 0a20 2020  method=None,.   
+0001a970: 2020 2020 2066 6c61 7474 656e 3d46 616c       flatten=Fal
+0001a980: 7365 2c0a 2020 2020 2020 2020 6279 5f73  se,.        by_s
+0001a990: 6c69 6365 3d4e 6f6e 652c 0a20 2020 2020  lice=None,.     
+0001a9a0: 2020 2076 616c 7565 5f66 6f72 5f6e 6f6e     value_for_non
+0001a9b0: 653d 4e6f 6e65 2c0a 2020 2020 2020 2020  e=None,.        
+0001a9c0: 736c 6963 655f 7374 6174 3d4e 6f6e 652c  slice_stat=None,
+0001a9d0: 0a20 2020 2020 2020 2073 6c69 6365 5f73  .        slice_s
+0001a9e0: 7461 745f 6b77 6172 6773 3d4e 6f6e 652c  tat_kwargs=None,
+0001a9f0: 0a20 2020 2029 3a0a 2020 2020 2020 2020  .    ):.        
+0001aa00: 2222 220a 2020 2020 2020 2020 4765 7420  """.        Get 
+0001aa10: 4a61 6363 6172 6420 696e 6465 7820 7769  Jaccard index wi
+0001aa20: 7468 2072 6573 7065 6374 2074 6f20 616e  th respect to an
+0001aa30: 6f74 6865 7220 524f 492e 0a0a 2020 2020  other ROI...    
+0001aa40: 2020 2020 5468 6520 4a61 6363 6172 6420      The Jaccard 
+0001aa50: 696e 6465 7820 6d61 7920 6265 206f 6274  index may be obt
+0001aa60: 6169 6e65 6420 6569 7468 6572 2067 6c6f  ained either glo
+0001aa70: 6261 6c6c 7920 6f72 206f 6e20 6120 0a20  bally or on a . 
+0001aa80: 2020 2020 2020 2073 696e 676c 6520 736c         single sl
+0001aa90: 6963 652e 0a0a 2020 2020 2020 2020 2a2a  ice...        **
+0001aaa0: 5061 7261 6d65 7465 7273 3a2a 2a0a 2020  Parameters:**.  
+0001aab0: 2020 2020 2020 0a20 2020 2020 2020 206f        .        o
+0001aac0: 7468 6572 203a 2052 4f49 0a20 2020 2020  ther : ROI.     
+0001aad0: 2020 2020 2020 204f 7468 6572 2052 4f49         Other ROI
+0001aae0: 2074 6f20 636f 6d70 6172 6520 7769 7468   to compare with
+0001aaf0: 2074 6869 7320 524f 492e 0a0a 2020 2020   this ROI...    
+0001ab00: 2020 2020 7369 6e67 6c65 5f73 6c69 6365      single_slice
+0001ab10: 203a 2062 6f6f 6c2c 2064 6566 6175 6c74   : bool, default
+0001ab20: 3d46 616c 7365 0a20 2020 2020 2020 2020  =False.         
+0001ab30: 2020 2049 6620 4661 6c73 652c 2074 6865     If False, the
+0001ab40: 2067 6c6f 6261 6c20 3344 204a 6163 6361   global 3D Jacca
+0001ab50: 7264 2069 6e64 6578 206f 6620 7468 6520  rd index of the 
+0001ab60: 6675 6c6c 2052 4f49 7320 7769 6c6c 2062  full ROIs will b
+0001ab70: 650a 2020 2020 2020 2020 2020 2020 7265  e.            re
+0001ab80: 7475 726e 6564 3b20 6f74 6865 7277 6973  turned; otherwis
+0001ab90: 652c 2074 6865 2032 4420 4a61 6363 6172  e, the 2D Jaccar
+0001aba0: 6420 696e 6465 7820 6f6e 2061 2073 696e  d index on a sin
+0001abb0: 676c 6520 736c 6963 650a 2020 2020 2020  gle slice.      
+0001abc0: 2020 2020 2020 7769 6c6c 2062 6520 7265        will be re
+0001abd0: 7475 726e 6564 2e0a 0a20 2020 2020 2020  turned...       
+0001abe0: 2076 6965 7720 3a20 7374 722c 2064 6566   view : str, def
+0001abf0: 6175 6c74 3d22 782d 7922 0a20 2020 2020  ault="x-y".     
+0001ac00: 2020 2020 2020 204f 7269 656e 7461 7469         Orientati
+0001ac10: 6f6e 206f 6620 736c 6963 6520 6f6e 2077  on of slice on w
+0001ac20: 6869 6368 2074 6f20 6765 7420 4a61 6363  hich to get Jacc
+0001ac30: 6172 6420 696e 6465 782e 204f 6e6c 7920  ard index. Only 
+0001ac40: 7573 6564 2069 6620 0a20 2020 2020 2020  used if .       
+0001ac50: 2020 2020 2073 696e 676c 655f 736c 6963       single_slic
+0001ac60: 653d 5472 7565 2e20 4966 2075 7369 6e67  e=True. If using
+0001ac70: 2c20 3c61 783e 206d 7573 7420 6265 2061  , <ax> must be a
+0001ac80: 6e20 6178 6973 2074 6861 7420 6c69 6573  n axis that lies
+0001ac90: 2061 6c6f 6e67 0a20 2020 2020 2020 2020   along.         
+0001aca0: 2020 2074 6865 2073 6c69 6365 2069 6e20     the slice in 
+0001acb0: 7468 6973 206f 7269 656e 7461 7469 6f6e  this orientation
+0001acc0: 2e0a 0a20 2020 2020 2020 2073 6c20 3a20  ...        sl : 
+0001acd0: 696e 742c 2064 6566 6175 6c74 3d4e 6f6e  int, default=Non
+0001ace0: 650a 2020 2020 2020 2020 2020 2020 536c  e.            Sl
+0001acf0: 6963 6520 6e75 6d62 6572 2e20 4966 206e  ice number. If n
+0001ad00: 6f6e 6520 6f66 203c 736c 3e2c 203c 6964  one of <sl>, <id
+0001ad10: 783e 206f 7220 3c70 6f73 3e20 6172 6520  x> or <pos> are 
+0001ad20: 7375 7070 6c69 6564 2062 7574 0a20 2020  supplied but.   
+0001ad30: 2020 2020 2020 2020 203c 7369 6e67 6c65           <single
+0001ad40: 5f73 6c69 6365 3e20 6973 2054 7275 652c  _slice> is True,
+0001ad50: 2074 6865 2063 656e 7472 616c 2073 6c69   the central sli
+0001ad60: 6365 206f 6620 7468 6973 2052 4f49 2077  ce of this ROI w
+0001ad70: 696c 6c20 6265 2075 7365 642e 0a0a 2020  ill be used...  
+0001ad80: 2020 2020 2020 6964 7820 3a20 696e 742c        idx : int,
+0001ad90: 2064 6566 6175 6c74 3d4e 6f6e 650a 2020   default=None.  
+0001ada0: 2020 2020 2020 2020 2020 4172 7261 7920            Array 
+0001adb0: 696e 6465 7820 6f66 2073 6c69 6365 2e20  index of slice. 
+0001adc0: 4966 206e 6f6e 6520 6f66 203c 736c 3e2c  If none of <sl>,
+0001add0: 203c 6964 783e 206f 7220 3c70 6f73 3e20   <idx> or <pos> 
+0001ade0: 6172 6520 7375 7070 6c69 6564 2062 7574  are supplied but
+0001adf0: 0a20 2020 2020 2020 2020 2020 203c 7369  .            <si
+0001ae00: 6e67 6c65 5f73 6c69 6365 3e20 6973 2054  ngle_slice> is T
+0001ae10: 7275 652c 2074 6865 2063 656e 7472 616c  rue, the central
+0001ae20: 2073 6c69 6365 206f 6620 7468 6973 2052   slice of this R
+0001ae30: 4f49 2077 696c 6c20 6265 2075 7365 642e  OI will be used.
+0001ae40: 0a0a 2020 2020 2020 2020 706f 7320 3a20  ..        pos : 
+0001ae50: 666c 6f61 742c 2064 6566 6175 6c74 3d4e  float, default=N
+0001ae60: 6f6e 650a 2020 2020 2020 2020 2020 2020  one.            
+0001ae70: 536c 6963 6520 706f 7369 7469 6f6e 2069  Slice position i
+0001ae80: 6e20 6d6d 2e20 4966 206e 6f6e 6520 6f66  n mm. If none of
+0001ae90: 203c 736c 3e2c 203c 6964 783e 206f 7220   <sl>, <idx> or 
+0001aea0: 3c70 6f73 3e20 6172 6520 7375 7070 6c69  <pos> are suppli
+0001aeb0: 6564 2062 7574 0a20 2020 2020 2020 2020  ed but.         
+0001aec0: 2020 203c 7369 6e67 6c65 5f73 6c69 6365     <single_slice
+0001aed0: 3e20 6973 2054 7275 652c 2074 6865 2063  > is True, the c
+0001aee0: 656e 7472 616c 2073 6c69 6365 206f 6620  entral slice of 
+0001aef0: 7468 6973 2052 4f49 2077 696c 6c20 6265  this ROI will be
+0001af00: 2075 7365 642e 0a0a 2020 2020 2020 2020   used...        
+0001af10: 6d65 7468 6f64 203a 2073 7472 2c20 6465  method : str, de
+0001af20: 6661 756c 743d 4e6f 6e65 0a20 2020 2020  fault=None.     
+0001af30: 2020 2020 2020 204d 6574 686f 6420 746f         Method to
+0001af40: 2075 7365 2066 6f72 2044 6963 6520 7363   use for Dice sc
+0001af50: 6f72 6520 6361 6c63 756c 6174 696f 6e2e  ore calculation.
+0001af60: 2043 616e 2062 653a 200a 2020 2020 2020   Can be: .      
+0001af70: 2020 2020 2020 2020 2020 2d20 2263 6f6e            - "con
+0001af80: 746f 7572 223a 2067 6574 2069 6e74 6572  tour": get inter
+0001af90: 7365 6374 696f 6e73 2061 6e64 2061 7265  sections and are
+0001afa0: 6173 206f 6620 7368 6170 656c 7920 636f  as of shapely co
+0001afb0: 6e74 6f75 7273 2e0a 2020 2020 2020 2020  ntours..        
+0001afc0: 2020 2020 2020 2020 2d20 226d 6173 6b22          - "mask"
+0001afd0: 3a20 636f 756e 7420 696e 7465 7273 6563  : count intersec
+0001afe0: 7469 6e67 2076 6f78 656c 7320 696e 2062  ting voxels in b
+0001aff0: 696e 6172 7920 6d61 736b 732e 0a20 2020  inary masks..   
+0001b000: 2020 2020 2020 2020 2020 2020 202d 204e               - N
+0001b010: 6f6e 653a 2075 7365 2074 6865 206d 6574  one: use the met
+0001b020: 686f 6420 7365 7420 696e 2073 656c 662e  hod set in self.
+0001b030: 6465 6661 756c 745f 6765 6f6d 5f6d 6574  default_geom_met
+0001b040: 686f 642e 0a0a 2020 2020 2020 2020 666c  hod...        fl
+0001b050: 6174 7465 6e20 3a20 626f 6f6c 2c20 6465  atten : bool, de
+0001b060: 6661 756c 743d 4661 6c73 650a 2020 2020  fault=False.    
+0001b070: 2020 2020 2020 2020 4966 2054 7275 652c          If True,
+0001b080: 2061 6c6c 2073 6c69 6365 7320 7769 6c6c   all slices will
+0001b090: 2062 6520 666c 6174 7465 6e65 6420 696e   be flattened in
+0001b0a0: 2074 6865 2067 6976 656e 206f 7269 656e   the given orien
+0001b0b0: 7461 7469 6f6e 2061 6e64 0a20 2020 2020  tation and.     
+0001b0c0: 2020 2020 2020 2074 6865 2044 6963 6520         the Dice 
+0001b0d0: 7363 6f72 6520 6f66 2074 6865 2066 6c61  score of the fla
+0001b0e0: 7474 656e 6564 2073 6c69 6365 7320 7769  ttened slices wi
+0001b0f0: 6c6c 2062 6520 7265 7475 726e 6564 2e20  ll be returned. 
+0001b100: 4f6e 6c79 200a 2020 2020 2020 2020 2020  Only .          
+0001b110: 2020 6176 6169 6c61 626c 6520 6966 206d    available if m
+0001b120: 6574 686f 643d 226d 6173 6b22 2e0a 0a20  ethod="mask"... 
+0001b130: 2020 2020 2020 2062 795f 736c 6963 6520         by_slice 
+0001b140: 3a20 7374 722c 2064 6566 6175 6c74 3d4e  : str, default=N
+0001b150: 6f6e 650a 2020 2020 2020 2020 2020 2020  one.            
+0001b160: 4966 206f 6e65 206f 6620 226c 6566 7422  If one of "left"
+0001b170: 2c20 2272 6967 6874 222c 2022 756e 696f  , "right", "unio
+0001b180: 6e22 2c20 2269 6e74 6572 7365 6374 696f  n", "intersectio
+0001b190: 6e22 2c20 6361 6c63 756c 6174 650a 2020  n", calculate.  
+0001b1a0: 2020 2020 2020 2020 2020 4469 6365 2073            Dice s
+0001b1b0: 636f 7265 7320 736c 6963 6520 6279 2073  cores slice by s
+0001b1c0: 6c69 6365 2066 6f72 2065 6163 6820 736c  lice for each sl
+0001b1d0: 6963 6520 636f 6e74 6169 6e69 6e67 0a20  ice containing. 
+0001b1e0: 2020 2020 2020 2020 2020 2073 656c 6620             self 
+0001b1f0: 616e 642f 6f72 206f 7468 6572 3a0a 0a20  and/or other:.. 
+0001b200: 2020 2020 2020 2020 2020 202d 2022 6c65             - "le
+0001b210: 6674 223a 2063 6f6e 7369 6465 7220 6f6e  ft": consider on
+0001b220: 6c79 2073 6c69 6365 7320 636f 6e74 6169  ly slices contai
+0001b230: 6e69 6e67 2073 656c 663b 0a20 2020 2020  ning self;.     
+0001b240: 2020 2020 2020 202d 2022 7269 6768 7422         - "right"
+0001b250: 3a20 636f 6e73 6964 6572 206f 6e6c 7920  : consider only 
+0001b260: 736c 6963 6573 2063 6f6e 7461 696e 696e  slices containin
+0001b270: 6720 6f74 6865 723b 0a20 2020 2020 2020  g other;.       
+0001b280: 2020 2020 202d 2022 756e 696f 6e22 3a20       - "union": 
+0001b290: 636f 6e73 6964 6572 2073 6c69 6365 7320  consider slices 
+0001b2a0: 636f 6e74 6169 6e69 6e67 2065 6974 6865  containing eithe
+0001b2b0: 7220 6f66 2073 656c 6620 616e 6420 6f74  r of self and ot
+0001b2c0: 6865 723b 0a20 2020 2020 2020 2020 2020  her;.           
+0001b2d0: 202d 2022 696e 7465 7273 6563 7469 6f6e   - "intersection
+0001b2e0: 223a 2063 6f6e 7369 6465 7220 736c 6963  ": consider slic
+0001b2f0: 6573 2063 6f6e 7461 696e 696e 6720 626f  es containing bo
+0001b300: 7468 206f 6620 7365 6c66 2061 6e64 206f  th of self and o
+0001b310: 7468 6572 2e0a 0a20 2020 2020 2020 2020  ther...         
+0001b320: 2020 2049 6620 736c 6963 655f 7374 6174     If slice_stat
+0001b330: 2069 7320 4e6f 6e65 2c20 7265 7475 726e   is None, return
+0001b340: 2061 2064 6963 7469 6f6e 6172 7920 7768   a dictionary wh
+0001b350: 6572 6520 6b65 7973 2061 7265 0a20 2020  ere keys are.   
+0001b360: 2020 2020 2020 2020 2073 6c69 6365 2070           slice p
+0001b370: 6f73 6974 696f 6e73 2061 6e64 2076 616c  ositions and val
+0001b380: 7565 7320 6172 6520 7468 6520 6361 6c63  ues are the calc
+0001b390: 756c 6174 6564 204a 6163 6361 7264 2069  ulated Jaccard i
+0001b3a0: 6e64 6963 6573 2e0a 2020 2020 2020 2020  ndices..        
+0001b3b0: 2020 2020 4f74 6865 7277 6973 652c 2072      Otherwise, r
+0001b3c0: 6574 7572 6e20 666f 7220 7468 6520 6361  eturn for the ca
+0001b3d0: 6c63 756c 6174 6564 204a 6163 6361 7264  lculated Jaccard
+0001b3e0: 2069 6e64 6963 6573 2074 6865 2073 7461   indices the sta
+0001b3f0: 7469 7374 6963 0a20 2020 2020 2020 2020  tistic.         
+0001b400: 2020 2073 7065 6369 6669 6564 2062 7920     specified by 
+0001b410: 736c 6963 655f 7374 6174 2e0a 0a20 2020  slice_stat...   
+0001b420: 2020 2020 2076 616c 7565 5f66 6f72 5f6e       value_for_n
+0001b430: 6f6e 6520 3a20 666c 6f61 742c 2064 6566  one : float, def
+0001b440: 6175 6c74 3d4e 6f6e 650a 2020 2020 2020  ault=None.      
+0001b450: 2020 2020 2020 466f 7220 7369 6e67 6c65        For single
+0001b460: 5f73 6c69 6365 2061 6e64 2062 795f 736c  _slice and by_sl
+0001b470: 6963 652c 2076 616c 7565 2074 6f20 6265  ice, value to be
+0001b480: 2072 6574 7572 6e65 6420 666f 720a 2020   returned for.  
+0001b490: 2020 2020 2020 2020 2020 736c 6963 6573            slices
+0001b4a0: 2077 6865 7265 204a 6163 6361 7264 2069   where Jaccard i
+0001b4b0: 6e64 6578 2069 7320 756e 6465 7465 726d  ndex is undeterm
+0001b4c0: 696e 6564 2028 4e6f 6e65 292e 2020 466f  ined (None).  Fo
+0001b4d0: 7220 736c 6963 655f 7374 6174 2c0a 2020  r slice_stat,.  
+0001b4e0: 2020 2020 2020 2020 2020 7661 6c75 6520            value 
+0001b4f0: 746f 2073 7562 7374 6974 7574 6520 666f  to substitute fo
+0001b500: 7220 616e 7920 4e6f 6e65 2076 616c 7565  r any None value
+0001b510: 7320 616d 6f6e 6720 7468 6520 696e 7075  s among the inpu
+0001b520: 7473 0a20 2020 2020 2020 2020 2020 2066  ts.            f
+0001b530: 6f72 2063 616c 6375 6c61 7469 6e67 2073  or calculating s
+0001b540: 6c69 6365 2d62 6173 6564 2073 7461 7469  lice-based stati
+0001b550: 7374 6963 2e20 2049 6620 4e6f 6e65 2069  stic.  If None i
+0001b560: 6e20 7468 6520 6c61 7474 6572 0a20 2020  n the latter.   
+0001b570: 2020 2020 2020 2020 2063 6173 652c 204e           case, N
+0001b580: 6f6e 6520 7661 6c75 6573 2061 6d6f 6e67  one values among
+0001b590: 2074 6865 2069 6e70 7574 7320 6172 6520   the inputs are 
+0001b5a0: 6f6d 6974 7465 642e 0a0a 2020 2020 2020  omitted...      
+0001b5b0: 2020 736c 6963 655f 7374 6174 203a 2073    slice_stat : s
+0001b5c0: 7472 2c20 6465 6661 756c 743d 4e6f 6e65  tr, default=None
+0001b5d0: 0a20 2020 2020 2020 2020 2020 2053 696e  .            Sin
+0001b5e0: 676c 652d 7661 7269 6162 6c65 2073 7461  gle-variable sta
+0001b5f0: 7469 7374 6963 2873 2920 746f 2062 6520  tistic(s) to be 
+0001b600: 7265 7475 726e 6564 2066 6f72 2073 6c69  returned for sli
+0001b610: 6365 2d62 792d 736c 6963 650a 2020 2020  ce-by-slice.    
+0001b620: 2020 2020 2020 2020 4a61 6363 6172 6420          Jaccard 
+0001b630: 696e 6469 6365 732e 2020 5468 6973 2073  indices.  This s
+0001b640: 686f 756c 6420 6265 2074 6865 206e 616d  hould be the nam
+0001b650: 6520 6f66 2074 6865 2066 756e 6374 696f  e of the functio
+0001b660: 6e20 666f 720a 2020 2020 2020 2020 2020  n for.          
+0001b670: 2020 6361 6c63 756c 6174 696f 6e20 6f66    calculation of
+0001b680: 2074 6865 2073 7461 7469 7374 6963 2873   the statistic(s
+0001b690: 2920 696e 2074 6865 2050 7974 686f 6e20  ) in the Python 
+0001b6a0: 7374 6174 6973 7469 6373 206d 6f64 756c  statistics modul
+0001b6b0: 653a 0a0a 2020 2020 2020 2020 2020 2020  e:..            
+0001b6c0: 6874 7470 733a 2f2f 646f 6373 2e70 7974  https://docs.pyt
+0001b6d0: 686f 6e2e 6f72 672f 332f 6c69 6272 6172  hon.org/3/librar
+0001b6e0: 792f 7374 6174 6973 7469 6373 2e68 746d  y/statistics.htm
+0001b6f0: 6c0a 0a20 2020 2020 2020 2020 2020 2041  l..            A
+0001b700: 7661 696c 6162 6c65 206f 7074 696f 6e73  vailable options
+0001b710: 2069 6e63 6c75 6465 3a20 226d 6561 6e22   include: "mean"
+0001b720: 2c20 226d 6564 6961 6e22 2c20 226d 6f64  , "median", "mod
+0001b730: 6522 2c0a 2020 2020 2020 2020 2020 2020  e",.            
+0001b740: 2273 7464 6576 222c 2022 7175 616e 7469  "stdev", "quanti
+0001b750: 6c65 7322 2e20 2044 6973 7265 6761 7264  les".  Disregard
+0001b760: 6564 2069 6620 4e6f 6e65 2e0a 0a20 2020  ed if None...   
+0001b770: 2020 2020 2020 2020 2049 6620 6279 5f73           If by_s
+0001b780: 6c69 6365 2069 7320 4e6f 6e65 2061 6e64  lice is None and
+0001b790: 2073 6c69 6365 5f73 7461 7420 6973 2064   slice_stat is d
+0001b7a0: 6966 6665 7265 6e74 2066 726f 6d20 4e6f  ifferent from No
+0001b7b0: 6e65 2c0a 2020 2020 2020 2020 2020 2020  ne,.            
+0001b7c0: 7468 6520 666f 726d 6572 2064 6566 6175  the former defau
+0001b7d0: 6c74 7320 746f 2022 756e 696f 6e22 2e0a  lts to "union"..
+0001b7e0: 0a20 2020 2020 2020 2073 6c69 6365 5f73  .        slice_s
+0001b7f0: 7461 745f 6b77 6172 6773 203a 2064 6963  tat_kwargs : dic
+0001b800: 742c 2064 6566 6175 6c74 3d4e 6f6e 650a  t, default=None.
+0001b810: 2020 2020 2020 2020 2020 2020 4b65 7977              Keyw
+0001b820: 6f72 6420 6172 6775 6d65 6e74 7320 746f  ord arguments to
+0001b830: 2062 6520 7061 7373 6564 2074 6f20 6675   be passed to fu
+0001b840: 6e63 7469 6f6e 206f 6620 7374 6174 6973  nction of statis
+0001b850: 7469 6373 0a20 2020 2020 2020 2020 2020  tics.           
+0001b860: 206d 6f64 756c 6520 666f 7220 6361 6c63   module for calc
+0001b870: 756c 6174 696f 6e20 7265 6c61 7469 7665  ulation relative
+0001b880: 2074 6f20 736c 6963 6520 7661 6c75 6573   to slice values
+0001b890: 2e20 2046 6f72 2065 7861 6d70 6c65 2c0a  .  For example,.
+0001b8a0: 2020 2020 2020 2020 2020 2020 6966 2071              if q
+0001b8b0: 7561 6e74 696c 6573 2061 7265 2072 6571  uantiles are req
+0001b8c0: 7569 7265 6420 666f 7220 3130 2069 6e74  uired for 10 int
+0001b8d0: 6572 7661 6c73 2c20 7261 7468 6572 2074  ervals, rather t
+0001b8e0: 6861 6e20 666f 720a 2020 2020 2020 2020  han for.        
+0001b8f0: 2020 2020 7468 6520 6465 6661 756c 7420      the default 
+0001b900: 6f66 2034 2c20 7468 6973 2063 616e 2062  of 4, this can b
+0001b910: 6520 7370 6563 6966 6965 6420 7573 696e  e specified usin
+0001b920: 673a 0a0a 2020 2020 2020 2020 2020 2020  g:..            
+0001b930: 736c 6963 655f 7374 6174 5f6b 7761 7267  slice_stat_kwarg
+0001b940: 737b 226e 2220 3a20 3130 7d0a 0a20 2020  s{"n" : 10}..   
+0001b950: 2020 2020 2020 2020 2046 6f72 2061 7661           For ava
+0001b960: 696c 6162 6c65 206b 6579 776f 7264 206f  ilable keyword o
+0001b970: 7074 696f 6e73 2c20 7365 6520 646f 6375  ptions, see docu
+0001b980: 6d65 6e74 6174 696f 6e20 6f66 2073 7461  mentation of sta
+0001b990: 7469 7374 6963 730a 2020 2020 2020 2020  tistics.        
+0001b9a0: 2020 2020 6d6f 6475 6c65 2061 743a 0a0a      module at:..
+0001b9b0: 2020 2020 2020 2020 2020 2020 6874 7470              http
+0001b9c0: 733a 2f2f 646f 6373 2e70 7974 686f 6e2e  s://docs.python.
+0001b9d0: 6f72 672f 332f 6c69 6272 6172 792f 7374  org/3/library/st
+0001b9e0: 6174 6973 7469 6373 2e68 746d 6c0a 2020  atistics.html.  
+0001b9f0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+0001ba00: 2020 6966 2073 6c69 6365 5f73 7461 743a    if slice_stat:
+0001ba10: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+0001ba20: 7572 6e20 7365 6c66 2e67 6574 5f73 6c69  urn self.get_sli
+0001ba30: 6365 5f73 7461 7428 6f74 6865 722c 2022  ce_stat(other, "
+0001ba40: 6a61 6363 6172 6422 2c20 736c 6963 655f  jaccard", slice_
+0001ba50: 7374 6174 2c20 6279 5f73 6c69 6365 2c0a  stat, by_slice,.
+0001ba60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ba70: 2020 2020 7661 6c75 655f 666f 725f 6e6f      value_for_no
+0001ba80: 6e65 2c20 7669 6577 2c20 6d65 7468 6f64  ne, view, method
+0001ba90: 2c20 2a2a 2873 6c69 6365 5f73 7461 745f  , **(slice_stat_
+0001baa0: 6b77 6172 6773 206f 7220 7b7d 2929 0a0a  kwargs or {}))..
+0001bab0: 2020 2020 2020 2020 6966 2062 795f 736c          if by_sl
+0001bac0: 6963 653a 0a20 2020 2020 2020 2020 2020  ice:.           
+0001bad0: 2072 6574 7572 6e20 7365 6c66 2e67 6574   return self.get
+0001bae0: 5f6d 6574 7269 635f 6279 5f73 6c69 6365  _metric_by_slice
+0001baf0: 286f 7468 6572 2c20 226a 6163 6361 7264  (other, "jaccard
+0001bb00: 222c 2062 795f 736c 6963 652c 0a20 2020  ", by_slice,.   
+0001bb10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bb20: 2076 6965 772c 206d 6574 686f 6429 0a0a   view, method)..
+0001bb30: 2020 2020 2020 2020 696e 7465 7273 6563          intersec
+0001bb40: 7469 6f6e 2c20 756e 696f 6e2c 206d 6561  tion, union, mea
+0001bb50: 6e5f 7369 7a65 203d 2073 656c 662e 6765  n_size = self.ge
+0001bb60: 745f 696e 7465 7273 6563 7469 6f6e 5f75  t_intersection_u
+0001bb70: 6e69 6f6e 5f73 697a 6528 0a20 2020 2020  nion_size(.     
+0001bb80: 2020 2020 2020 2020 2020 206f 7468 6572             other
+0001bb90: 2c20 7369 6e67 6c65 5f73 6c69 6365 2c20  , single_slice, 
+0001bba0: 7669 6577 2c20 736c 2c20 6964 782c 2070  view, sl, idx, p
+0001bbb0: 6f73 2c20 6d65 7468 6f64 2c20 666c 6174  os, method, flat
+0001bbc0: 7465 6e29 0a0a 2020 2020 2020 2020 7265  ten)..        re
+0001bbd0: 7475 726e 2028 696e 7465 7273 6563 7469  turn (intersecti
+0001bbe0: 6f6e 202f 2075 6e69 6f6e 2069 6620 756e  on / union if un
+0001bbf0: 696f 6e20 656c 7365 2076 616c 7565 5f66  ion else value_f
+0001bc00: 6f72 5f6e 6f6e 6529 0a0a 2020 2020 6465  or_none)..    de
+0001bc10: 6620 6765 745f 766f 6c75 6d65 5f72 6174  f get_volume_rat
+0001bc20: 696f 2873 656c 662c 206f 7468 6572 2c20  io(self, other, 
+0001bc30: 2a2a 6b77 6172 6773 293a 0a20 2020 2020  **kwargs):.     
+0001bc40: 2020 2022 2222 4765 7420 7261 7469 6f20     """Get ratio 
+0001bc50: 6f66 2061 6e6f 7468 6572 2052 4f49 2773  of another ROI's
+0001bc60: 2076 6f6c 756d 6520 7769 7468 2072 6573   volume with res
+0001bc70: 7065 6374 2074 6f20 6f77 6e20 766f 6c75  pect to own volu
+0001bc80: 6d65 2e22 2222 0a0a 2020 2020 2020 2020  me."""..        
+0001bc90: 6f77 6e5f 766f 6c75 6d65 203d 206f 7468  own_volume = oth
+0001bca0: 6572 2e67 6574 5f76 6f6c 756d 6528 2a2a  er.get_volume(**
+0001bcb0: 6b77 6172 6773 290a 2020 2020 2020 2020  kwargs).        
+0001bcc0: 6f74 6865 725f 766f 6c75 6d65 203d 2073  other_volume = s
+0001bcd0: 656c 662e 6765 745f 766f 6c75 6d65 282a  elf.get_volume(*
+0001bce0: 2a6b 7761 7267 7329 0a20 2020 2020 2020  *kwargs).       
+0001bcf0: 2069 6620 6e6f 7420 6f74 6865 725f 766f   if not other_vo
+0001bd00: 6c75 6d65 206f 7220 6e6f 7420 6f77 6e5f  lume or not own_
+0001bd10: 766f 6c75 6d65 3a0a 2020 2020 2020 2020  volume:.        
+0001bd20: 2020 2020 7265 7475 726e 204e 6f6e 650a      return None.
+0001bd30: 2020 2020 2020 2020 7265 7475 726e 206f          return o
+0001bd40: 776e 5f76 6f6c 756d 6520 2f20 6f74 6865  wn_volume / othe
+0001bd50: 725f 766f 6c75 6d65 0a0a 2020 2020 6465  r_volume..    de
+0001bd60: 6620 6765 745f 6172 6561 5f72 6174 696f  f get_area_ratio
+0001bd70: 2873 656c 662c 206f 7468 6572 2c20 7669  (self, other, vi
+0001bd80: 6577 3d22 782d 7922 2c20 736c 3d4e 6f6e  ew="x-y", sl=Non
+0001bd90: 652c 2069 6478 3d4e 6f6e 652c 2070 6f73  e, idx=None, pos
+0001bda0: 3d4e 6f6e 652c 0a20 2020 2020 2020 2020  =None,.         
+0001bdb0: 2020 2075 6e69 7473 3d22 6d6d 222c 206d     units="mm", m
+0001bdc0: 6574 686f 643d 4e6f 6e65 2c20 666c 6174  ethod=None, flat
+0001bdd0: 7465 6e3d 4661 6c73 652c 2062 795f 736c  ten=False, by_sl
+0001bde0: 6963 653d 4e6f 6e65 2c0a 2020 2020 2020  ice=None,.      
+0001bdf0: 2020 2020 2020 736c 6963 655f 7374 6174        slice_stat
+0001be00: 3d4e 6f6e 652c 2076 616c 7565 5f66 6f72  =None, value_for
+0001be10: 5f6e 6f6e 653d 4e6f 6e65 2c20 2a2a 736c  _none=None, **sl
+0001be20: 6963 655f 7374 6174 5f6b 7761 7267 7329  ice_stat_kwargs)
+0001be30: 3a0a 2020 2020 2020 2020 2222 2247 6574  :.        """Get
+0001be40: 2072 6174 696f 206f 6620 616e 6f74 6865   ratio of anothe
+0001be50: 7220 524f 4927 7320 6172 6561 2077 6974  r ROI's area wit
+0001be60: 6820 7265 7370 6563 7420 746f 206f 776e  h respect to own
+0001be70: 2061 7265 612e 2222 220a 0a20 2020 2020   area."""..     
+0001be80: 2020 2069 6620 736c 6963 655f 7374 6174     if slice_stat
+0001be90: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+0001bea0: 7475 726e 2073 656c 662e 6765 745f 736c  turn self.get_sl
+0001beb0: 6963 655f 7374 6174 286f 7468 6572 2c20  ice_stat(other, 
+0001bec0: 2261 7265 615f 7261 7469 6f22 2c20 736c  "area_ratio", sl
+0001bed0: 6963 655f 7374 6174 2c0a 2020 2020 2020  ice_stat,.      
+0001bee0: 2020 2020 2020 2020 2020 2020 2020 6279                by
+0001bef0: 5f73 6c69 6365 2c20 7661 6c75 655f 666f  _slice, value_fo
+0001bf00: 725f 6e6f 6e65 2c20 7669 6577 2c20 6d65  r_none, view, me
+0001bf10: 7468 6f64 2c0a 2020 2020 2020 2020 2020  thod,.          
+0001bf20: 2020 2020 2020 2020 2020 2a2a 2873 6c69            **(sli
+0001bf30: 6365 5f73 7461 745f 6b77 6172 6773 206f  ce_stat_kwargs o
+0001bf40: 7220 7b7d 2929 0a0a 2020 2020 2020 2020  r {}))..        
+0001bf50: 6966 2062 795f 736c 6963 653a 0a20 2020  if by_slice:.   
+0001bf60: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+0001bf70: 7365 6c66 2e67 6574 5f6d 6574 7269 635f  self.get_metric_
+0001bf80: 6279 5f73 6c69 6365 286f 7468 6572 2c20  by_slice(other, 
+0001bf90: 2261 7265 615f 7261 7469 6f22 2c20 6279  "area_ratio", by
+0001bfa0: 5f73 6c69 6365 2c0a 2020 2020 2020 2020  _slice,.        
+0001bfb0: 2020 2020 2020 2020 2020 2020 7669 6577              view
+0001bfc0: 2c20 6d65 7468 6f64 290a 0a20 2020 2020  , method)..     
+0001bfd0: 2020 206f 776e 5f61 7265 6120 3d20 6f74     own_area = ot
+0001bfe0: 6865 722e 6765 745f 6172 6561 2876 6965  her.get_area(vie
+0001bff0: 772c 2073 6c2c 2069 6478 2c20 706f 732c  w, sl, idx, pos,
+0001c000: 2075 6e69 7473 2c20 6d65 7468 6f64 2c20   units, method, 
+0001c010: 666c 6174 7465 6e29 0a20 2020 2020 2020  flatten).       
+0001c020: 206f 7468 6572 5f61 7265 6120 3d20 7365   other_area = se
+0001c030: 6c66 2e67 6574 5f61 7265 6128 7669 6577  lf.get_area(view
+0001c040: 2c20 736c 2c20 6964 782c 2070 6f73 2c20  , sl, idx, pos, 
+0001c050: 756e 6974 732c 206d 6574 686f 642c 2066  units, method, f
+0001c060: 6c61 7474 656e 290a 2020 2020 2020 2020  latten).        
+0001c070: 6966 206e 6f74 206f 7468 6572 5f61 7265  if not other_are
+0001c080: 6120 6f72 206e 6f74 206f 776e 5f61 7265  a or not own_are
+0001c090: 613a 0a20 2020 2020 2020 2020 2020 2072  a:.            r
+0001c0a0: 6574 7572 6e20 7661 6c75 655f 666f 725f  eturn value_for_
+0001c0b0: 6e6f 6e65 0a20 2020 2020 2020 2072 6574  none.        ret
+0001c0c0: 7572 6e20 6f77 6e5f 6172 6561 202f 206f  urn own_area / o
+0001c0d0: 7468 6572 5f61 7265 610a 0a20 2020 2064  ther_area..    d
+0001c0e0: 6566 2067 6574 5f76 6f6c 756d 655f 6469  ef get_volume_di
+0001c0f0: 6666 2873 656c 662c 206f 7468 6572 2c20  ff(self, other, 
+0001c100: 2a2a 6b77 6172 6773 293a 0a20 2020 2020  **kwargs):.     
+0001c110: 2020 2022 2222 4765 7420 6f77 6e20 766f     """Get own vo
+0001c120: 6c75 6d65 206d 696e 7573 2076 6f6c 756d  lume minus volum
+0001c130: 6520 6f66 206f 7468 6572 2052 4f49 2e22  e of other ROI."
+0001c140: 2222 0a0a 2020 2020 2020 2020 6f77 6e5f  ""..        own_
+0001c150: 766f 6c75 6d65 203d 2073 656c 662e 6765  volume = self.ge
+0001c160: 745f 766f 6c75 6d65 282a 2a6b 7761 7267  t_volume(**kwarg
+0001c170: 7329 0a20 2020 2020 2020 206f 7468 6572  s).        other
+0001c180: 5f76 6f6c 756d 6520 3d20 6f74 6865 722e  _volume = other.
+0001c190: 6765 745f 766f 6c75 6d65 282a 2a6b 7761  get_volume(**kwa
+0001c1a0: 7267 7329 0a20 2020 2020 2020 2069 6620  rgs).        if 
+0001c1b0: 6e6f 7420 6f77 6e5f 766f 6c75 6d65 206f  not own_volume o
+0001c1c0: 7220 6e6f 7420 6f74 6865 725f 766f 6c75  r not other_volu
+0001c1d0: 6d65 3a0a 2020 2020 2020 2020 2020 2020  me:.            
+0001c1e0: 7265 7475 726e 204e 6f6e 650a 2020 2020  return None.    
+0001c1f0: 2020 2020 7265 7475 726e 2028 6f77 6e5f      return (own_
+0001c200: 766f 6c75 6d65 202d 206f 7468 6572 5f76  volume - other_v
+0001c210: 6f6c 756d 6529 0a0a 2020 2020 6465 6620  olume)..    def 
+0001c220: 6765 745f 7265 6c61 7469 7665 5f76 6f6c  get_relative_vol
+0001c230: 756d 655f 6469 6666 2873 656c 662c 206f  ume_diff(self, o
+0001c240: 7468 6572 2c20 2a2a 6b77 6172 6773 293a  ther, **kwargs):
+0001c250: 0a20 2020 2020 2020 2022 2222 4765 7420  .        """Get 
+0001c260: 7265 6c61 7469 7665 2076 6f6c 756d 6520  relative volume 
+0001c270: 6f66 2061 6e6f 7468 6572 2052 4f49 2077  of another ROI w
+0001c280: 6974 6820 7265 7370 6563 7420 746f 206f  ith respect to o
+0001c290: 776e 2076 6f6c 756d 652e 2222 220a 0a20  wn volume.""".. 
+0001c2a0: 2020 2020 2020 206f 776e 5f76 6f6c 756d         own_volum
+0001c2b0: 6520 3d20 7365 6c66 2e67 6574 5f76 6f6c  e = self.get_vol
+0001c2c0: 756d 6528 2a2a 6b77 6172 6773 290a 2020  ume(**kwargs).  
+0001c2d0: 2020 2020 2020 766f 6c75 6d65 5f64 6966        volume_dif
+0001c2e0: 6620 3d20 7365 6c66 2e67 6574 5f76 6f6c  f = self.get_vol
+0001c2f0: 756d 655f 6469 6666 286f 7468 6572 2c20  ume_diff(other, 
+0001c300: 2a2a 6b77 6172 6773 290a 2020 2020 2020  **kwargs).      
+0001c310: 2020 6966 2076 6f6c 756d 655f 6469 6666    if volume_diff
+0001c320: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
+0001c330: 2020 2020 2020 7265 7475 726e 0a20 2020        return.   
+0001c340: 2020 2020 2072 6574 7572 6e20 766f 6c75       return volu
+0001c350: 6d65 5f64 6966 6620 2f20 6f77 6e5f 766f  me_diff / own_vo
+0001c360: 6c75 6d65 0a0a 2020 2020 6465 6620 6765  lume..    def ge
+0001c370: 745f 6172 6561 5f64 6966 6628 7365 6c66  t_area_diff(self
+0001c380: 2c20 6f74 6865 722c 2076 6965 773d 2278  , other, view="x
+0001c390: 2d79 222c 2073 6c3d 4e6f 6e65 2c20 6964  -y", sl=None, id
+0001c3a0: 783d 4e6f 6e65 2c20 706f 733d 4e6f 6e65  x=None, pos=None
+0001c3b0: 2c0a 2020 2020 2020 2020 2020 2020 756e  ,.            un
+0001c3c0: 6974 733d 226d 6d22 2c20 6d65 7468 6f64  its="mm", method
+0001c3d0: 3d4e 6f6e 652c 2066 6c61 7474 656e 3d46  =None, flatten=F
+0001c3e0: 616c 7365 2c20 6279 5f73 6c69 6365 3d4e  alse, by_slice=N
+0001c3f0: 6f6e 652c 0a20 2020 2020 2020 2020 2020  one,.           
+0001c400: 2073 6c69 6365 5f73 7461 743d 4e6f 6e65   slice_stat=None
+0001c410: 2c20 7661 6c75 655f 666f 725f 6e6f 6e65  , value_for_none
+0001c420: 3d4e 6f6e 652c 202a 2a73 6c69 6365 5f73  =None, **slice_s
+0001c430: 7461 745f 6b77 6172 6773 293a 0a20 2020  tat_kwargs):.   
+0001c440: 2020 2020 2022 2222 4765 7420 6162 736f       """Get abso
+0001c450: 6c75 7465 2061 7265 6120 6469 6666 6572  lute area differ
+0001c460: 656e 6365 2062 6574 7765 656e 2074 776f  ence between two
+0001c470: 2052 4f49 732e 2222 220a 0a20 2020 2020   ROIs."""..     
+0001c480: 2020 2069 6620 736c 6963 655f 7374 6174     if slice_stat
+0001c490: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+0001c4a0: 7475 726e 2073 656c 662e 6765 745f 736c  turn self.get_sl
+0001c4b0: 6963 655f 7374 6174 286f 7468 6572 2c20  ice_stat(other, 
+0001c4c0: 2261 7265 615f 6469 6666 222c 2073 6c69  "area_diff", sli
+0001c4d0: 6365 5f73 7461 742c 0a20 2020 2020 2020  ce_stat,.       
+0001c4e0: 2020 2020 2020 2020 2020 2020 2062 795f               by_
+0001c4f0: 736c 6963 652c 2076 616c 7565 5f66 6f72  slice, value_for
+0001c500: 5f6e 6f6e 652c 2076 6965 772c 206d 6574  _none, view, met
+0001c510: 686f 642c 0a20 2020 2020 2020 2020 2020  hod,.           
+0001c520: 2020 2020 2020 2020 202a 2a28 736c 6963           **(slic
+0001c530: 655f 7374 6174 5f6b 7761 7267 7320 6f72  e_stat_kwargs or
+0001c540: 207b 7d29 290a 0a20 2020 2020 2020 2069   {}))..        i
+0001c550: 6620 6279 5f73 6c69 6365 3a0a 2020 2020  f by_slice:.    
+0001c560: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+0001c570: 656c 662e 6765 745f 6d65 7472 6963 5f62  elf.get_metric_b
+0001c580: 795f 736c 6963 6528 6f74 6865 722c 2022  y_slice(other, "
+0001c590: 6172 6561 5f64 6966 6622 2c20 6279 5f73  area_diff", by_s
+0001c5a0: 6c69 6365 2c0a 2020 2020 2020 2020 2020  lice,.          
+0001c5b0: 2020 2020 2020 2020 2020 7669 6577 2c20            view, 
+0001c5c0: 6d65 7468 6f64 290a 0a20 2020 2020 2020  method)..       
+0001c5d0: 206f 776e 5f61 7265 6120 3d20 7365 6c66   own_area = self
+0001c5e0: 2e67 6574 5f61 7265 6128 7669 6577 2c20  .get_area(view, 
+0001c5f0: 736c 2c20 6964 782c 2070 6f73 2c20 756e  sl, idx, pos, un
+0001c600: 6974 732c 206d 6574 686f 642c 2066 6c61  its, method, fla
+0001c610: 7474 656e 290a 2020 2020 2020 2020 6f74  tten).        ot
+0001c620: 6865 725f 6172 6561 203d 206f 7468 6572  her_area = other
+0001c630: 2e67 6574 5f61 7265 6128 7669 6577 2c20  .get_area(view, 
+0001c640: 736c 2c20 6964 782c 2070 6f73 2c20 756e  sl, idx, pos, un
+0001c650: 6974 732c 206d 6574 686f 642c 2066 6c61  its, method, fla
+0001c660: 7474 656e 290a 2020 2020 2020 2020 6966  tten).        if
+0001c670: 206e 6f74 206f 776e 5f61 7265 6120 6f72   not own_area or
+0001c680: 206e 6f74 206f 7468 6572 5f61 7265 613a   not other_area:
+0001c690: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+0001c6a0: 7572 6e20 7661 6c75 655f 666f 725f 6e6f  urn value_for_no
+0001c6b0: 6e65 0a20 2020 2020 2020 2072 6574 7572  ne.        retur
+0001c6c0: 6e20 6f77 6e5f 6172 6561 202d 206f 7468  n own_area - oth
+0001c6d0: 6572 5f61 7265 610a 0a20 2020 2064 6566  er_area..    def
+0001c6e0: 2067 6574 5f72 656c 6174 6976 655f 6172   get_relative_ar
+0001c6f0: 6561 5f64 6966 6628 7365 6c66 2c20 6f74  ea_diff(self, ot
+0001c700: 6865 722c 2076 6965 773d 2278 2d79 222c  her, view="x-y",
+0001c710: 2073 6c3d 4e6f 6e65 2c20 6964 783d 4e6f   sl=None, idx=No
+0001c720: 6e65 2c0a 2020 2020 2020 2020 2020 2020  ne,.            
+0001c730: 706f 733d 4e6f 6e65 2c20 756e 6974 733d  pos=None, units=
+0001c740: 226d 6d22 2c20 6d65 7468 6f64 3d4e 6f6e  "mm", method=Non
+0001c750: 652c 2066 6c61 7474 656e 3d46 616c 7365  e, flatten=False
+0001c760: 2c20 6279 5f73 6c69 6365 3d4e 6f6e 652c  , by_slice=None,
+0001c770: 0a20 2020 2020 2020 2020 2020 2073 6c69  .            sli
+0001c780: 6365 5f73 7461 743d 4e6f 6e65 2c20 7661  ce_stat=None, va
+0001c790: 6c75 655f 666f 725f 6e6f 6e65 3d4e 6f6e  lue_for_none=Non
+0001c7a0: 652c 202a 2a73 6c69 6365 5f73 7461 745f  e, **slice_stat_
+0001c7b0: 6b77 6172 6773 293a 0a20 2020 2020 2020  kwargs):.       
+0001c7c0: 2022 2222 4765 7420 7265 6c61 7469 7665   """Get relative
+0001c7d0: 2061 7265 6120 6f66 2061 6e6f 7468 6572   area of another
+0001c7e0: 2052 4f49 2077 6974 6820 7265 7370 6563   ROI with respec
+0001c7f0: 7420 746f 206f 776e 2061 7265 612e 2222  t to own area.""
+0001c800: 220a 0a20 2020 2020 2020 2069 6620 736c  "..        if sl
+0001c810: 6963 655f 7374 6174 3a0a 2020 2020 2020  ice_stat:.      
+0001c820: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
+0001c830: 662e 6765 745f 736c 6963 655f 7374 6174  f.get_slice_stat
+0001c840: 286f 7468 6572 2c20 2272 656c 5f61 7265  (other, "rel_are
+0001c850: 615f 6469 6666 222c 2073 6c69 6365 5f73  a_diff", slice_s
+0001c860: 7461 742c 0a20 2020 2020 2020 2020 2020  tat,.           
+0001c870: 2020 2020 2020 2020 2062 795f 736c 6963           by_slic
+0001c880: 652c 2076 616c 7565 5f66 6f72 5f6e 6f6e  e, value_for_non
+0001c890: 652c 2076 6965 772c 206d 6574 686f 642c  e, view, method,
+0001c8a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001c8b0: 2020 2020 202a 2a28 736c 6963 655f 7374       **(slice_st
+0001c8c0: 6174 5f6b 7761 7267 7320 6f72 207b 7d29  at_kwargs or {})
+0001c8d0: 290a 0a20 2020 2020 2020 2069 6620 6279  )..        if by
+0001c8e0: 5f73 6c69 6365 3a0a 2020 2020 2020 2020  _slice:.        
+0001c8f0: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
+0001c900: 6765 745f 6d65 7472 6963 5f62 795f 736c  get_metric_by_sl
+0001c910: 6963 6528 6f74 6865 722c 2022 7265 6c5f  ice(other, "rel_
+0001c920: 6172 6561 5f64 6966 6622 2c0a 2020 2020  area_diff",.    
+0001c930: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c940: 6279 5f73 6c69 6365 2c20 7669 6577 2c20  by_slice, view, 
+0001c950: 6d65 7468 6f64 290a 0a20 2020 2020 2020  method)..       
+0001c960: 206f 776e 5f61 7265 6120 3d20 7365 6c66   own_area = self
+0001c970: 2e67 6574 5f61 7265 6128 7669 6577 2c20  .get_area(view, 
+0001c980: 736c 2c20 6964 782c 2070 6f73 2c20 756e  sl, idx, pos, un
+0001c990: 6974 732c 206d 6574 686f 642c 2066 6c61  its, method, fla
+0001c9a0: 7474 656e 290a 2020 2020 2020 2020 6172  tten).        ar
+0001c9b0: 6561 5f64 6966 6620 3d20 7365 6c66 2e67  ea_diff = self.g
+0001c9c0: 6574 5f61 7265 615f 6469 6666 286f 7468  et_area_diff(oth
+0001c9d0: 6572 2c20 7669 6577 2c20 736c 2c20 6964  er, view, sl, id
+0001c9e0: 782c 2070 6f73 2c20 756e 6974 732c 206d  x, pos, units, m
+0001c9f0: 6574 686f 642c 0a20 2020 2020 2020 2020  ethod,.         
+0001ca00: 2020 2020 2020 2066 6c61 7474 656e 290a         flatten).
+0001ca10: 0a20 2020 2020 2020 2069 6620 6172 6561  .        if area
+0001ca20: 5f64 6966 6620 6973 204e 6f6e 653a 0a20  _diff is None:. 
+0001ca30: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+0001ca40: 6e20 7661 6c75 655f 666f 725f 6e6f 6e65  n value_for_none
+0001ca50: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0001ca60: 6172 6561 5f64 6966 6620 2f20 6f77 6e5f  area_diff / own_
+0001ca70: 6172 6561 0a0a 2020 2020 6465 6620 6765  area..    def ge
+0001ca80: 745f 696e 7465 7273 6563 7469 6f6e 5f75  t_intersection_u
+0001ca90: 6e69 6f6e 5f73 697a 6528 0a20 2020 2020  nion_size(.     
+0001caa0: 2020 2073 656c 662c 200a 2020 2020 2020     self, .      
+0001cab0: 2020 6f74 6865 722c 200a 2020 2020 2020    other, .      
+0001cac0: 2020 7369 6e67 6c65 5f73 6c69 6365 3d46    single_slice=F
+0001cad0: 616c 7365 2c0a 2020 2020 2020 2020 7669  alse,.        vi
+0001cae0: 6577 3d22 782d 7922 2c20 0a20 2020 2020  ew="x-y", .     
+0001caf0: 2020 2073 6c3d 4e6f 6e65 2c20 0a20 2020     sl=None, .   
+0001cb00: 2020 2020 2069 6478 3d4e 6f6e 652c 200a       idx=None, .
+0001cb10: 2020 2020 2020 2020 706f 733d 4e6f 6e65          pos=None
+0001cb20: 2c20 0a20 2020 2020 2020 206d 6574 686f  , .        metho
+0001cb30: 643d 4e6f 6e65 2c0a 2020 2020 2020 2020  d=None,.        
+0001cb40: 666c 6174 7465 6e3d 4661 6c73 652c 0a20  flatten=False,. 
+0001cb50: 2020 2029 3a0a 2020 2020 2020 2020 2222     ):.        ""
+0001cb60: 220a 2020 2020 2020 2020 4765 7420 696e  ".        Get in
+0001cb70: 7465 7273 6563 7469 6f6e 2c20 756e 696f  tersection, unio
+0001cb80: 6e20 616e 6420 6d65 616e 2073 697a 6520  n and mean size 
+0001cb90: 7769 7468 2072 6573 7065 6374 2074 6f20  with respect to 
+0001cba0: 616e 6f74 6865 7220 524f 492e 0a20 2020  another ROI..   
+0001cbb0: 2020 2020 2056 616c 7565 7320 6172 6520       Values are 
+0001cbc0: 7265 7475 726e 6564 2061 7320 766f 6c75  returned as volu
+0001cbd0: 6d65 7320 666f 7220 7468 6520 6675 6c6c  mes for the full
+0001cbe0: 2052 4f49 732c 0a20 2020 2020 2020 206f   ROIs,.        o
+0001cbf0: 7220 6173 2061 7265 6173 2066 6f72 2061  r as areas for a
+0001cc00: 2073 696e 676c 6520 736c 6963 652e 0a0a   single slice...
+0001cc10: 2020 2020 2020 2020 2a2a 5061 7261 6d65          **Parame
+0001cc20: 7465 7273 3a2a 2a0a 2020 2020 2020 2020  ters:**.        
+0001cc30: 0a20 2020 2020 2020 206f 7468 6572 203a  .        other :
+0001cc40: 2052 4f49 0a20 2020 2020 2020 2020 2020   ROI.           
+0001cc50: 204f 7468 6572 2052 4f49 2074 6f20 636f   Other ROI to co
+0001cc60: 6d70 6172 6520 7769 7468 2074 6869 7320  mpare with this 
+0001cc70: 524f 492e 0a0a 2020 2020 2020 2020 7369  ROI...        si
+0001cc80: 6e67 6c65 5f73 6c69 6365 203a 2062 6f6f  ngle_slice : boo
+0001cc90: 6c2c 2064 6566 6175 6c74 3d46 616c 7365  l, default=False
+0001cca0: 0a20 2020 2020 2020 2020 2020 2049 6620  .            If 
+0001ccb0: 4661 6c73 652c 2074 6865 2076 6f6c 756d  False, the volum
+0001ccc0: 6573 206f 6620 696e 7465 7273 6563 7469  es of intersecti
+0001ccd0: 6f6e 2061 6e64 2020 756e 696f 6e20 6f66  on and  union of
+0001cce0: 2074 6865 2066 756c 6c20 524f 4973 2c0a   the full ROIs,.
+0001ccf0: 2020 2020 2020 2020 2020 2020 616e 6420              and 
+0001cd00: 7468 6520 6d65 616e 2052 4f49 2076 6f6c  the mean ROI vol
+0001cd10: 756d 6520 7769 6c6c 2062 6520 7265 7475  ume will be retu
+0001cd20: 726e 6564 3b0a 2020 2020 2020 2020 2020  rned;.          
+0001cd30: 2020 6f74 6865 7277 6973 652c 2074 6865    otherwise, the
+0001cd40: 2061 7265 6173 206f 6620 696e 7465 7273   areas of inters
+0001cd50: 6563 7469 6f6e 2061 6e64 2075 6e69 6f6e  ection and union
+0001cd60: 206f 6e20 6120 7369 6e67 6c65 2073 6c69   on a single sli
+0001cd70: 6365 2c0a 2020 2020 2020 2020 2020 2020  ce,.            
+0001cd80: 616e 6420 7468 6520 6d65 616e 2052 4f49  and the mean ROI
+0001cd90: 2061 7265 612c 2077 696c 6c20 6265 2072   area, will be r
+0001cda0: 6574 7572 6e65 642e 0a0a 2020 2020 2020  eturned...      
+0001cdb0: 2020 7669 6577 203a 2073 7472 2c20 6465    view : str, de
+0001cdc0: 6661 756c 743d 2278 2d79 220a 2020 2020  fault="x-y".    
+0001cdd0: 2020 2020 2020 2020 4f72 6965 6e74 6174          Orientat
+0001cde0: 696f 6e20 6f66 2073 6c69 6365 206f 6e20  ion of slice on 
+0001cdf0: 7768 6963 6820 746f 2067 6574 2061 7265  which to get are
+0001ce00: 6173 206f 6620 696e 7465 7273 6563 7469  as of intersecti
+0001ce10: 6f6e 0a20 2020 2020 2020 2020 2020 2061  on.            a
+0001ce20: 6e64 2075 6e69 6f6e 2c20 616e 6420 6d65  nd union, and me
+0001ce30: 616e 2052 4f49 2061 7265 612e 2020 4f6e  an ROI area.  On
+0001ce40: 6c79 2075 7365 6420 6966 2073 696e 676c  ly used if singl
+0001ce50: 655f 736c 6963 653d 5472 7565 2e0a 0a20  e_slice=True... 
+0001ce60: 2020 2020 2020 2073 6c20 3a20 696e 742c         sl : int,
+0001ce70: 2064 6566 6175 6c74 3d4e 6f6e 650a 2020   default=None.  
+0001ce80: 2020 2020 2020 2020 2020 536c 6963 6520            Slice 
+0001ce90: 6e75 6d62 6572 2e20 4966 206e 6f6e 6520  number. If none 
+0001cea0: 6f66 203c 736c 3e2c 203c 6964 783e 206f  of <sl>, <idx> o
+0001ceb0: 7220 3c70 6f73 3e20 6172 6520 7375 7070  r <pos> are supp
+0001cec0: 6c69 6564 2062 7574 0a20 2020 2020 2020  lied but.       
+0001ced0: 2020 2020 203c 7369 6e67 6c65 5f73 6c69       <single_sli
+0001cee0: 6365 3e20 6973 2054 7275 652c 2074 6865  ce> is True, the
+0001cef0: 2063 656e 7472 616c 2073 6c69 6365 206f   central slice o
+0001cf00: 6620 7468 6973 2052 4f49 2077 696c 6c20  f this ROI will 
+0001cf10: 6265 2075 7365 642e 0a0a 2020 2020 2020  be used...      
+0001cf20: 2020 6964 7820 3a20 696e 742c 2064 6566    idx : int, def
+0001cf30: 6175 6c74 3d4e 6f6e 650a 2020 2020 2020  ault=None.      
+0001cf40: 2020 2020 2020 4172 7261 7920 696e 6465        Array inde
+0001cf50: 7820 6f66 2073 6c69 6365 2e20 4966 206e  x of slice. If n
+0001cf60: 6f6e 6520 6f66 203c 736c 3e2c 203c 6964  one of <sl>, <id
+0001cf70: 783e 206f 7220 3c70 6f73 3e20 6172 6520  x> or <pos> are 
+0001cf80: 7375 7070 6c69 6564 0a20 2020 2020 2020  supplied.       
+0001cf90: 2020 2020 2062 7574 203c 7369 6e67 6c65       but <single
+0001cfa0: 5f73 6c69 6365 3e20 6973 2054 7275 652c  _slice> is True,
+0001cfb0: 2074 6865 2063 656e 7472 616c 2073 6c69   the central sli
+0001cfc0: 6365 206f 6620 7468 6973 2052 4f49 2077  ce of this ROI w
+0001cfd0: 696c 6c20 6265 0a20 2020 2020 2020 2020  ill be.         
+0001cfe0: 2020 2075 7365 642e 0a0a 2020 2020 2020     used...      
+0001cff0: 2020 706f 7320 3a20 666c 6f61 742c 2064    pos : float, d
+0001d000: 6566 6175 6c74 3d4e 6f6e 650a 2020 2020  efault=None.    
+0001d010: 2020 2020 2020 2020 536c 6963 6520 706f          Slice po
+0001d020: 7369 7469 6f6e 2069 6e20 6d6d 2e20 4966  sition in mm. If
+0001d030: 206e 6f6e 6520 6f66 203c 736c 3e2c 203c   none of <sl>, <
+0001d040: 6964 783e 206f 7220 3c70 6f73 3e20 6172  idx> or <pos> ar
+0001d050: 6520 7375 7070 6c69 6564 0a20 2020 2020  e supplied.     
+0001d060: 2020 2020 2020 2062 7574 203c 7369 6e67         but <sing
+0001d070: 6c65 5f73 6c69 6365 3e20 6973 2054 7275  le_slice> is Tru
+0001d080: 652c 2074 6865 2063 656e 7472 616c 2073  e, the central s
+0001d090: 6c69 6365 206f 6620 7468 6973 2052 4f49  lice of this ROI
+0001d0a0: 2077 696c 6c0a 2020 2020 2020 2020 2020   will.          
+0001d0b0: 2020 6265 2075 7365 642e 0a0a 2020 2020    be used...    
+0001d0c0: 2020 2020 6d65 7468 6f64 203a 2073 7472      method : str
+0001d0d0: 2c20 6465 6661 756c 743d 4e6f 6e65 0a20  , default=None. 
+0001d0e0: 2020 2020 2020 2020 2020 204d 6574 686f             Metho
+0001d0f0: 6420 746f 2075 7365 2066 6f72 2063 616c  d to use for cal
+0001d100: 6375 6c61 7469 6e67 2069 6e74 6572 7365  culating interse
+0001d110: 6374 696f 6e2c 2075 6e69 6f6e 2c20 616e  ction, union, an
+0001d120: 6420 6d65 616e 0a20 2020 2020 2020 2020  d mean.         
+0001d130: 2020 2073 697a 652e 2043 616e 2062 653a     size. Can be:
+0001d140: 200a 2020 2020 2020 2020 2020 2020 2020   .              
+0001d150: 2020 2d20 2263 6f6e 746f 7572 223a 2067    - "contour": g
+0001d160: 6574 2069 6e74 6572 7365 6374 696f 6e73  et intersections
+0001d170: 2061 6e64 2061 7265 6173 206f 6620 7368   and areas of sh
+0001d180: 6170 656c 7920 636f 6e74 6f75 7273 2e0a  apely contours..
+0001d190: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d1a0: 2d20 226d 6173 6b22 3a20 636f 756e 7420  - "mask": count 
+0001d1b0: 696e 7465 7273 6563 7469 6e67 2076 6f78  intersecting vox
+0001d1c0: 656c 7320 696e 2062 696e 6172 7920 6d61  els in binary ma
+0001d1d0: 736b 732e 0a20 2020 2020 2020 2020 2020  sks..           
+0001d1e0: 2020 2020 202d 204e 6f6e 653a 2075 7365       - None: use
+0001d1f0: 2074 6865 206d 6574 686f 6420 7365 7420   the method set 
+0001d200: 696e 2073 656c 662e 6465 6661 756c 745f  in self.default_
+0001d210: 6765 6f6d 5f6d 6574 686f 642e 0a0a 2020  geom_method...  
+0001d220: 2020 2020 2020 666c 6174 7465 6e20 3a20        flatten : 
+0001d230: 626f 6f6c 2c20 6465 6661 756c 743d 4661  bool, default=Fa
+0001d240: 6c73 650a 2020 2020 2020 2020 2020 2020  lse.            
+0001d250: 4966 2054 7275 652c 2061 6c6c 2073 6c69  If True, all sli
+0001d260: 6365 7320 7769 6c6c 2062 6520 666c 6174  ces will be flat
+0001d270: 7465 6e65 6420 696e 2074 6865 2067 6976  tened in the giv
+0001d280: 656e 206f 7269 656e 7461 7469 6f6e 2061  en orientation a
+0001d290: 6e64 0a20 2020 2020 2020 2020 2020 2074  nd.            t
+0001d2a0: 6865 2061 7265 6173 206f 6620 696e 7465  he areas of inte
+0001d2b0: 7273 6563 7469 6f6e 2061 6e64 2075 6e69  rsection and uni
+0001d2c0: 6f6e 2c20 616e 6420 7468 6520 6d65 616e  on, and the mean
+0001d2d0: 2052 4f49 2061 7265 612c 0a20 2020 2020   ROI area,.     
+0001d2e0: 2020 2020 2020 2077 696c 6c20 6265 2072         will be r
+0001d2f0: 6574 7572 6e65 6420 666f 7220 7468 6520  eturned for the 
+0001d300: 666c 6174 7465 6e65 6420 736c 6963 6573  flattened slices
+0001d310: 2e20 4f6e 6c79 2061 7661 696c 6162 6c65  . Only available
+0001d320: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+0001d330: 6d65 7468 6f64 3d22 6d61 736b 222e 0a20  method="mask".. 
+0001d340: 2020 2020 2020 2022 2222 0a0a 2020 2020         """..    
+0001d350: 2020 2020 7365 6c66 2e63 7265 6174 655f      self.create_
+0001d360: 6d61 736b 2829 0a0a 2020 2020 2020 2020  mask()..        
+0001d370: 2320 4465 6669 6e65 2076 6f78 656c 2076  # Define voxel v
+0001d380: 6f6c 756d 652c 2061 6e64 2076 6f78 656c  olume, and voxel
+0001d390: 2061 7265 6120 696e 2076 6965 772e 0a20   area in view.. 
+0001d3a0: 2020 2020 2020 2076 6f78 656c 5f76 6f6c         voxel_vol
+0001d3b0: 756d 6520 3d20 310a 2020 2020 2020 2020  ume = 1.        
+0001d3c0: 666f 7220 6478 797a 2069 6e20 7365 6c66  for dxyz in self
+0001d3d0: 2e6d 6173 6b2e 766f 7865 6c5f 7369 7a65  .mask.voxel_size
+0001d3e0: 3a0a 2020 2020 2020 2020 2020 2020 766f  :.            vo
+0001d3f0: 7865 6c5f 766f 6c75 6d65 202a 3d20 6478  xel_volume *= dx
+0001d400: 797a 0a20 2020 2020 2020 207a 5f61 7820  yz.        z_ax 
+0001d410: 3d20 736b 7274 2e69 6d61 6765 2e5f 736c  = skrt.image._sl
+0001d420: 6963 655f 6178 6573 5b76 6965 775d 0a20  ice_axes[view]. 
+0001d430: 2020 2020 2020 2073 6c69 6365 5f74 6869         slice_thi
+0001d440: 636b 6e65 7373 203d 2073 656c 662e 6d61  ckness = self.ma
+0001d450: 736b 2e76 6f78 656c 5f73 697a 655b 7a5f  sk.voxel_size[z_
+0001d460: 6178 5d0a 2020 2020 2020 2020 766f 7865  ax].        voxe
+0001d470: 6c5f 6172 6561 203d 2076 6f78 656c 5f76  l_area = voxel_v
+0001d480: 6f6c 756d 6520 2f20 736c 6963 655f 7468  olume / slice_th
+0001d490: 6963 6b6e 6573 730a 0a20 2020 2020 2020  ickness..       
+0001d4a0: 2023 2047 6574 2064 6566 6175 6c74 2073   # Get default s
+0001d4b0: 6c69 6365 2061 6e64 206d 6574 686f 640a  lice and method.
+0001d4c0: 2020 2020 2020 2020 6966 2073 696e 676c          if singl
+0001d4d0: 655f 736c 6963 653a 0a20 2020 2020 2020  e_slice:.       
+0001d4e0: 2020 2020 2069 6620 736c 2069 7320 4e6f       if sl is No
+0001d4f0: 6e65 2061 6e64 2069 6478 2069 7320 4e6f  ne and idx is No
+0001d500: 6e65 2061 6e64 2070 6f73 2069 7320 4e6f  ne and pos is No
+0001d510: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+0001d520: 2020 2020 6964 7820 3d20 7365 6c66 2e67      idx = self.g
+0001d530: 6574 5f6d 6964 5f69 6478 2876 6965 7729  et_mid_idx(view)
+0001d540: 0a20 2020 2020 2020 2069 6620 6d65 7468  .        if meth
+0001d550: 6f64 2069 7320 4e6f 6e65 3a0a 2020 2020  od is None:.    
+0001d560: 2020 2020 2020 2020 6d65 7468 6f64 203d          method =
+0001d570: 2073 656c 662e 6465 6661 756c 745f 6765   self.default_ge
+0001d580: 6f6d 5f6d 6574 686f 640a 0a20 2020 2020  om_method..     
+0001d590: 2020 2069 6620 666c 6174 7465 6e3a 2020     if flatten:  
+0001d5a0: 2320 466c 6174 7465 6e69 6e67 206f 6e6c  # Flattening onl
+0001d5b0: 7920 706f 7373 6962 6c65 2077 6974 6820  y possible with 
+0001d5c0: 226d 6173 6b22 0a20 2020 2020 2020 2020  "mask".         
+0001d5d0: 2020 206d 6574 686f 6420 3d20 226d 6173     method = "mas
+0001d5e0: 6b22 0a0a 2020 2020 2020 2020 2320 4361  k"..        # Ca
+0001d5f0: 6c63 756c 6174 6520 696e 7465 7273 6563  lculate intersec
+0001d600: 7469 6f6e 7320 616e 6420 6172 6561 7320  tions and areas 
+0001d610: 6672 6f6d 2070 6f6c 7967 6f6e 730a 2020  from polygons.  
+0001d620: 2020 2020 2020 6966 206d 6574 686f 6420        if method 
+0001d630: 3d3d 2022 636f 6e74 6f75 7222 3a0a 0a20  == "contour":.. 
+0001d640: 2020 2020 2020 2020 2020 2023 2047 6574             # Get
+0001d650: 2070 6f73 6974 696f 6e73 206f 6620 736c   positions of sl
+0001d660: 6963 6528 7329 0a20 2020 2020 2020 2020  ice(s).         
+0001d670: 2020 2023 206f 6e20 7768 6963 6820 746f     # on which to
+0001d680: 2063 6f6d 7061 7265 2061 7265 6173 2061   compare areas a
+0001d690: 6e64 2074 6f74 616c 2061 7265 6173 2e0a  nd total areas..
+0001d6a0: 2020 2020 2020 2020 2020 2020 6966 206e              if n
+0001d6b0: 6f74 2073 696e 676c 655f 736c 6963 653a  ot single_slice:
+0001d6c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001d6d0: 2070 6f73 6974 696f 6e73 203d 2073 6574   positions = set
+0001d6e0: 2873 656c 662e 6765 745f 636f 6e74 6f75  (self.get_contou
+0001d6f0: 7273 2822 782d 7922 292e 6b65 7973 2829  rs("x-y").keys()
+0001d700: 292e 756e 696f 6e28 0a20 2020 2020 2020  ).union(.       
+0001d710: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d720: 2073 6574 286f 7468 6572 2e67 6574 5f63   set(other.get_c
+0001d730: 6f6e 746f 7572 7328 2278 2d79 2229 2e6b  ontours("x-y").k
+0001d740: 6579 7328 2929 290a 2020 2020 2020 2020  eys())).        
+0001d750: 2020 2020 2020 2020 6172 6561 7331 203d          areas1 =
+0001d760: 205b 7365 6c66 2e67 6574 5f61 7265 6128   [self.get_area(
+0001d770: 2278 2d79 222c 2070 6f73 3d70 2c20 6d65  "x-y", pos=p, me
+0001d780: 7468 6f64 3d6d 6574 686f 6429 0a20 2020  thod=method).   
+0001d790: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d7a0: 2020 2020 2066 6f72 2070 2069 6e20 706f       for p in po
+0001d7b0: 7369 7469 6f6e 735d 0a20 2020 2020 2020  sitions].       
+0001d7c0: 2020 2020 2020 2020 2076 6f6c 756d 6573           volumes
+0001d7d0: 3120 3d20 5b61 202a 2073 6c69 6365 5f74  1 = [a * slice_t
+0001d7e0: 6869 636b 6e65 7373 2066 6f72 2061 2069  hickness for a i
+0001d7f0: 6e20 6172 6561 7331 2069 6620 615d 0a20  n areas1 if a]. 
+0001d800: 2020 2020 2020 2020 2020 2020 2020 2076                 v
+0001d810: 6f6c 756d 6531 203d 2073 756d 2876 6f6c  olume1 = sum(vol
+0001d820: 756d 6573 3129 0a20 2020 2020 2020 2020  umes1).         
+0001d830: 2020 2020 2020 2061 7265 6173 3220 3d20         areas2 = 
+0001d840: 5b6f 7468 6572 2e67 6574 5f61 7265 6128  [other.get_area(
+0001d850: 2278 2d79 222c 2070 6f73 3d70 2c20 6d65  "x-y", pos=p, me
+0001d860: 7468 6f64 3d6d 6574 686f 6429 0a20 2020  thod=method).   
+0001d870: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d880: 2020 2020 2066 6f72 2070 2069 6e20 706f       for p in po
+0001d890: 7369 7469 6f6e 735d 0a20 2020 2020 2020  sitions].       
+0001d8a0: 2020 2020 2020 2020 2076 6f6c 756d 6573           volumes
+0001d8b0: 3220 3d20 5b61 202a 2073 6c69 6365 5f74  2 = [a * slice_t
+0001d8c0: 6869 636b 6e65 7373 2066 6f72 2061 2069  hickness for a i
+0001d8d0: 6e20 6172 6561 7332 2069 6620 615d 0a20  n areas2 if a]. 
+0001d8e0: 2020 2020 2020 2020 2020 2020 2020 2076                 v
+0001d8f0: 6f6c 756d 6532 203d 2073 756d 2876 6f6c  olume2 = sum(vol
+0001d900: 756d 6573 3229 0a20 2020 2020 2020 2020  umes2).         
+0001d910: 2020 2020 2020 206d 6561 6e5f 7369 7a65         mean_size
+0001d920: 203d 2030 2e35 202a 2028 766f 6c75 6d65   = 0.5 * (volume
+0001d930: 3120 2b20 766f 6c75 6d65 3229 0a20 2020  1 + volume2).   
+0001d940: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+0001d950: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+0001d960: 6f73 6974 696f 6e73 203d 205b 0a20 2020  ositions = [.   
+0001d970: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d980: 2073 656c 662e 6964 785f 746f 5f70 6f73   self.idx_to_pos
+0001d990: 2873 656c 662e 6765 745f 6964 7828 7669  (self.get_idx(vi
+0001d9a0: 6577 2c20 736c 2c20 6964 782c 2070 6f73  ew, sl, idx, pos
+0001d9b0: 292c 0a20 2020 2020 2020 2020 2020 2020  ),.             
+0001d9c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d9d0: 2020 2020 2020 2061 783d 736b 7274 2e69         ax=skrt.i
+0001d9e0: 6d61 6765 2e5f 736c 6963 655f 6178 6573  mage._slice_axes
+0001d9f0: 5b76 6965 775d 290a 2020 2020 2020 2020  [view]).        
+0001da00: 2020 2020 2020 2020 5d0a 2020 2020 2020          ].      
+0001da10: 2020 2020 2020 2020 2020 6172 6561 3120            area1 
+0001da20: 3d20 7365 6c66 2e67 6574 5f61 7265 6128  = self.get_area(
+0001da30: 7669 6577 2c20 736c 2c20 6964 782c 2070  view, sl, idx, p
+0001da40: 6f73 2c20 6d65 7468 6f64 3d6d 6574 686f  os, method=metho
+0001da50: 6429 0a20 2020 2020 2020 2020 2020 2020  d).             
+0001da60: 2020 2069 6620 6172 6561 3120 6973 204e     if area1 is N
+0001da70: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+0001da80: 2020 2020 2020 2020 2061 7265 6131 203d           area1 =
+0001da90: 2030 0a20 2020 2020 2020 2020 2020 2020   0.             
+0001daa0: 2020 2061 7265 6132 203d 206f 7468 6572     area2 = other
+0001dab0: 2e67 6574 5f61 7265 6128 7669 6577 2c20  .get_area(view, 
+0001dac0: 736c 2c20 6964 782c 2070 6f73 2c20 6d65  sl, idx, pos, me
+0001dad0: 7468 6f64 3d6d 6574 686f 6429 0a20 2020  thod=method).   
+0001dae0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0001daf0: 6172 6561 3220 6973 204e 6f6e 653a 0a20  area2 is None:. 
+0001db00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001db10: 2020 2061 7265 6132 203d 2030 0a20 2020     area2 = 0.   
+0001db20: 2020 2020 2020 2020 2020 2020 206d 6561               mea
+0001db30: 6e5f 7369 7a65 203d 2030 2e35 202a 2028  n_size = 0.5 * (
+0001db40: 6172 6561 3120 2b20 6172 6561 3229 0a20  area1 + area2). 
+0001db50: 2020 2020 2020 2020 2020 200a 2020 2020             .    
+0001db60: 2020 2020 2020 2020 2320 436f 6d70 7574          # Comput
+0001db70: 6520 6172 6561 7320 6f66 2069 6e74 6572  e areas of inter
+0001db80: 7365 6374 696f 6e20 616e 6420 756e 696f  section and unio
+0001db90: 6e20 6f6e 2073 6c69 6365 2873 290a 2020  n on slice(s).  
+0001dba0: 2020 2020 2020 2020 2020 696e 7465 7273            inters
+0001dbb0: 6563 7469 6f6e 203d 2030 0a20 2020 2020  ection = 0.     
+0001dbc0: 2020 2020 2020 2075 6e69 6f6e 203d 2030         union = 0
+0001dbd0: 0a20 2020 2020 2020 2020 2020 2066 6163  .            fac
+0001dbe0: 746f 7220 3d20 3120 6966 2028 7369 6e67  tor = 1 if (sing
+0001dbf0: 6c65 5f73 6c69 6365 206f 7220 666c 6174  le_slice or flat
+0001dc00: 7465 6e29 2065 6c73 6520 736c 6963 655f  ten) else slice_
+0001dc10: 7468 6963 6b6e 6573 730a 2020 2020 2020  thickness.      
+0001dc20: 2020 2020 2020 666f 7220 7020 696e 2070        for p in p
+0001dc30: 6f73 6974 696f 6e73 3a0a 2020 2020 2020  ositions:.      
+0001dc40: 2020 2020 2020 2020 2020 7365 7431 203d            set1 =
+0001dc50: 206f 7073 2e75 6e61 7279 5f75 6e69 6f6e   ops.unary_union
+0001dc60: 2873 656c 662e 6765 745f 706f 6c79 676f  (self.get_polygo
+0001dc70: 6e73 5f6f 6e5f 736c 6963 6528 7669 6577  ns_on_slice(view
+0001dc80: 2c20 706f 733d 7029 290a 2020 2020 2020  , pos=p)).      
+0001dc90: 2020 2020 2020 2020 2020 7365 7432 203d            set2 =
+0001dca0: 206f 7073 2e75 6e61 7279 5f75 6e69 6f6e   ops.unary_union
+0001dcb0: 286f 7468 6572 2e67 6574 5f70 6f6c 7967  (other.get_polyg
+0001dcc0: 6f6e 735f 6f6e 5f73 6c69 6365 2876 6965  ons_on_slice(vie
+0001dcd0: 772c 2070 6f73 3d70 2929 0a20 2020 2020  w, pos=p)).     
+0001dce0: 2020 2020 2020 2020 2020 2069 6e74 6572             inter
+0001dcf0: 7365 6374 696f 6e20 2b3d 2073 6574 312e  section += set1.
+0001dd00: 696e 7465 7273 6563 7469 6f6e 2873 6574  intersection(set
+0001dd10: 3229 2e61 7265 6120 2a20 6661 6374 6f72  2).area * factor
+0001dd20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001dd30: 2075 6e69 6f6e 202b 3d20 7365 7431 2e75   union += set1.u
+0001dd40: 6e69 6f6e 2873 6574 3229 2e61 7265 6120  nion(set2).area 
+0001dd50: 2a20 6661 6374 6f72 0a0a 2020 2020 2020  * factor..      
+0001dd60: 2020 2320 4361 6c63 756c 6174 6520 696e    # Calculate in
+0001dd70: 7465 7273 6563 7469 6f6e 7320 616e 6420  tersections and 
+0001dd80: 6172 6561 7320 6672 6f6d 2062 696e 6172  areas from binar
+0001dd90: 7920 6d61 736b 2076 6f78 656c 2063 6f75  y mask voxel cou
+0001dda0: 6e74 730a 2020 2020 2020 2020 656c 7365  nts.        else
+0001ddb0: 3a0a 0a20 2020 2020 2020 2020 2020 2023  :..            #
+0001ddc0: 2055 7365 2033 4420 6d61 736b 0a20 2020   Use 3D mask.   
+0001ddd0: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
+0001dde0: 7369 6e67 6c65 5f73 6c69 6365 3a0a 2020  single_slice:.  
+0001ddf0: 2020 2020 2020 2020 2020 2020 2020 6461                da
+0001de00: 7461 3120 3d20 7365 6c66 2e67 6574 5f6d  ta1 = self.get_m
+0001de10: 6173 6b28 7669 6577 2c20 666c 6174 7465  ask(view, flatte
+0001de20: 6e2c 2073 7461 6e64 6172 6469 7365 3d54  n, standardise=T
+0001de30: 7275 6529 0a20 2020 2020 2020 2020 2020  rue).           
+0001de40: 2020 2020 2064 6174 6132 203d 206f 7468       data2 = oth
+0001de50: 6572 2e67 6574 5f6d 6173 6b28 7669 6577  er.get_mask(view
+0001de60: 2c20 666c 6174 7465 6e2c 2073 7461 6e64  , flatten, stand
+0001de70: 6172 6469 7365 3d54 7275 6529 0a0a 2020  ardise=True)..  
+0001de80: 2020 2020 2020 2020 2020 2320 4f74 6865            # Othe
+0001de90: 7277 6973 652c 2075 7365 2073 696e 676c  rwise, use singl
+0001dea0: 6520 3244 2073 6c69 6365 0a20 2020 2020  e 2D slice.     
+0001deb0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+0001dec0: 2020 2020 2020 2020 2020 2020 2064 6174               dat
+0001ded0: 6131 203d 2073 656c 662e 6765 745f 736c  a1 = self.get_sl
+0001dee0: 6963 6528 7669 6577 2c20 736c 2c20 6964  ice(view, sl, id
+0001def0: 782c 2070 6f73 290a 2020 2020 2020 2020  x, pos).        
+0001df00: 2020 2020 2020 2020 6461 7461 3220 3d20          data2 = 
+0001df10: 6f74 6865 722e 6765 745f 736c 6963 6528  other.get_slice(
+0001df20: 7669 6577 2c20 736c 2c20 6964 782c 2070  view, sl, idx, p
+0001df30: 6f73 290a 0a20 2020 2020 2020 2020 2020  os)..           
+0001df40: 2066 6163 746f 7220 3d20 766f 7865 6c5f   factor = voxel_
+0001df50: 6172 6561 2069 6620 2873 696e 676c 655f  area if (single_
+0001df60: 736c 6963 6520 6f72 2066 6c61 7474 656e  slice or flatten
+0001df70: 2920 656c 7365 2076 6f78 656c 5f76 6f6c  ) else voxel_vol
+0001df80: 756d 650a 2020 2020 2020 2020 2020 2020  ume.            
+0001df90: 696e 7465 7273 6563 7469 6f6e 203d 2028  intersection = (
+0001dfa0: 6461 7461 3120 2620 6461 7461 3229 2e73  data1 & data2).s
+0001dfb0: 756d 2829 202a 2066 6163 746f 720a 2020  um() * factor.  
+0001dfc0: 2020 2020 2020 2020 2020 756e 696f 6e20            union 
+0001dfd0: 3d20 2864 6174 6131 207c 2064 6174 6132  = (data1 | data2
+0001dfe0: 292e 7375 6d28 2920 2a20 6661 6374 6f72  ).sum() * factor
+0001dff0: 0a20 2020 2020 2020 2020 2020 206d 6561  .            mea
+0001e000: 6e5f 7369 7a65 203d 2030 2e35 202a 2028  n_size = 0.5 * (
+0001e010: 6461 7461 312e 7375 6d28 2920 2b20 6461  data1.sum() + da
+0001e020: 7461 322e 7375 6d28 2929 202a 2066 6163  ta2.sum()) * fac
+0001e030: 746f 720a 0a20 2020 2020 2020 2072 6574  tor..        ret
+0001e040: 7572 6e20 2869 6e74 6572 7365 6374 696f  urn (intersectio
+0001e050: 6e2c 2075 6e69 6f6e 2c20 6d65 616e 5f73  n, union, mean_s
+0001e060: 697a 6529 0a0a 2020 2020 6465 6620 6765  ize)..    def ge
+0001e070: 745f 6d65 7472 6963 5f62 795f 736c 6963  t_metric_by_slic
+0001e080: 6528 7365 6c66 2c20 6f74 6865 722c 206d  e(self, other, m
+0001e090: 6574 7269 633d 4e6f 6e65 2c20 6279 5f73  etric=None, by_s
+0001e0a0: 6c69 6365 3d4e 6f6e 652c 0a20 2020 2020  lice=None,.     
+0001e0b0: 2020 2020 2020 2076 6965 773d 2278 2d79         view="x-y
+0001e0c0: 222c 206d 6574 686f 643d 4e6f 6e65 293a  ", method=None):
+0001e0d0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+0001e0e0: 2020 2020 2047 6574 2064 6963 7469 6f6e       Get diction
+0001e0f0: 6172 7920 6f66 2073 6c69 6365 2d62 792d  ary of slice-by-
+0001e100: 736c 6963 6520 7661 6c75 6573 2066 6f72  slice values for
+0001e110: 2063 6f6d 7061 7269 736f 6e20 6d65 7472   comparison metr
+0001e120: 6963 2e0a 0a20 2020 2020 2020 2045 6163  ic...        Eac
+0001e130: 6820 6b65 7920 6f66 2074 6865 2072 6574  h key of the ret
+0001e140: 7572 6e65 6420 6469 6374 696f 6e61 7279  urned dictionary
+0001e150: 2069 7320 6120 736c 6963 6520 706f 7369   is a slice posi
+0001e160: 7469 6f6e 2028 6d6d 292c 2061 6e64 0a20  tion (mm), and. 
+0001e170: 2020 2020 2020 2074 6865 2061 7373 6f63         the assoc
+0001e180: 6961 7465 6420 7661 6c75 6520 6973 2074  iated value is t
+0001e190: 6865 206d 6574 7269 6320 7661 6c75 6520  he metric value 
+0001e1a0: 666f 7220 7468 6520 736c 6963 652e 0a0a  for the slice...
+0001e1b0: 2020 2020 2020 2020 2a2a 5061 7261 6d65          **Parame
+0001e1c0: 7465 7273 3a2a 2a0a 0a20 2020 2020 2020  ters:**..       
+0001e1d0: 206f 7468 6572 203a 2052 4f49 0a20 2020   other : ROI.   
+0001e1e0: 2020 2020 2020 2020 204f 7468 6572 2052           Other R
+0001e1f0: 4f49 2074 6f20 636f 6d70 6172 6520 7769  OI to compare wi
+0001e200: 7468 2074 6869 7320 524f 492e 0a0a 2020  th this ROI...  
+0001e210: 2020 2020 2020 6d65 7472 6963 203a 2073        metric : s
+0001e220: 7472 2c20 6465 6661 756c 743d 4e6f 6e65  tr, default=None
+0001e230: 0a20 2020 2020 2020 2020 2020 204d 6574  .            Met
+0001e240: 7269 6320 746f 2062 6520 6576 616c 7561  ric to be evalua
+0001e250: 7465 642e 0a0a 2020 2020 2020 2020 6279  ted...        by
+0001e260: 5f73 6c69 6365 3a20 7374 722c 2064 6566  _slice: str, def
+0001e270: 6175 6c74 3d4e 6f6e 650a 2020 2020 2020  ault=None.      
+0001e280: 2020 2020 2020 536c 6963 6573 2074 6f20        Slices to 
+0001e290: 6265 2063 6f6e 7369 6465 7265 642e 2020  be considered.  
+0001e2a0: 5468 6520 7661 6c69 6420 7370 6563 6966  The valid specif
+0001e2b0: 6963 6174 696f 6e73 2061 7265 3a0a 0a20  ications are:.. 
+0001e2c0: 2020 2020 2020 2020 2020 202d 2022 6c65             - "le
+0001e2d0: 6674 223a 2063 6f6e 7369 6465 7220 6f6e  ft": consider on
+0001e2e0: 6c79 2073 6c69 6365 7320 636f 6e74 6169  ly slices contai
+0001e2f0: 6e69 6e67 2073 656c 663b 0a20 2020 2020  ning self;.     
+0001e300: 2020 2020 2020 202d 2022 7269 6768 7422         - "right"
+0001e310: 3a20 636f 6e73 6964 6572 206f 6e6c 7920  : consider only 
+0001e320: 736c 6963 6573 2063 6f6e 7461 696e 696e  slices containin
+0001e330: 6720 6f74 6865 7220 726f 693b 0a20 2020  g other roi;.   
+0001e340: 2020 2020 2020 2020 202d 2022 756e 696f           - "unio
+0001e350: 6e22 3a20 636f 6e73 6964 6572 2073 6c69  n": consider sli
+0001e360: 6365 7320 636f 6e74 6169 6e69 6e67 2065  ces containing e
+0001e370: 6974 6865 7220 6f66 2073 656c 6620 616e  ither of self an
+0001e380: 6420 6f74 6865 7220 726f 693b 0a20 2020  d other roi;.   
+0001e390: 2020 2020 2020 2020 202d 2022 696e 7465           - "inte
+0001e3a0: 7273 6563 7469 6f6e 223a 2063 6f6e 7369  rsection": consi
+0001e3b0: 6465 7220 736c 6963 6573 2063 6f6e 7461  der slices conta
+0001e3c0: 696e 696e 6720 626f 7468 206f 6620 7365  ining both of se
+0001e3d0: 6c66 2061 6e64 0a20 2020 2020 2020 2020  lf and.         
+0001e3e0: 2020 2020 206f 7468 6572 2072 6f69 2e0a       other roi..
+0001e3f0: 0a20 2020 2020 2020 2020 2020 2049 6620  .            If 
+0001e400: 4e6f 6e65 2c20 7573 6520 736b 7274 2e63  None, use skrt.c
+0001e410: 6f72 652e 4465 6661 756c 7473 2829 2e62  ore.Defaults().b
+0001e420: 795f 736c 6963 650a 0a20 2020 2020 2020  y_slice..       
+0001e430: 2076 6965 7720 3a20 7374 722c 2064 6566   view : str, def
+0001e440: 6175 6c74 3d22 782d 7922 0a20 2020 2020  ault="x-y".     
+0001e450: 2020 2020 2020 204f 7269 656e 7461 7469         Orientati
+0001e460: 6f6e 206f 6620 736c 6963 6573 206f 6e20  on of slices on 
+0001e470: 7768 6963 6820 746f 2067 6574 206d 6574  which to get met
+0001e480: 7269 6320 7661 6c75 6573 2e0a 0a20 2020  ric values...   
+0001e490: 2020 2020 206d 6574 686f 6420 3a20 7374       method : st
+0001e4a0: 722c 2064 6566 6175 6c74 3d4e 6f6e 650a  r, default=None.
+0001e4b0: 2020 2020 2020 2020 2020 2020 4d65 7468              Meth
+0001e4c0: 6f64 2074 6f20 7573 6520 666f 7220 6d65  od to use for me
+0001e4d0: 7472 6963 2063 616c 6375 6c61 7469 6f6e  tric calculation
+0001e4e0: 2e20 4361 6e20 6265 3a20 0a20 2020 2020  . Can be: .     
+0001e4f0: 2020 2020 2020 2020 2020 202d 2022 636f             - "co
+0001e500: 6e74 6f75 7222 3a20 6361 6c63 756c 6174  ntour": calculat
+0001e510: 6520 6d65 7472 6963 2066 726f 6d20 7368  e metric from sh
+0001e520: 6170 656c 7920 636f 6e74 6f75 7273 2e0a  apely contours..
+0001e530: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e540: 2d20 226d 6173 6b22 3a20 6361 6c63 7561  - "mask": calcua
+0001e550: 6c74 6520 6d65 7472 6963 2066 726f 6d20  lte metric from 
+0001e560: 6269 6e61 7279 206d 6173 6b73 2e0a 2020  binary masks..  
+0001e570: 2020 2020 2020 2020 2020 2020 2020 2d20                - 
+0001e580: 4e6f 6e65 3a20 7573 6520 7468 6520 6d65  None: use the me
+0001e590: 7468 6f64 2073 6574 2069 6e20 7365 6c66  thod set in self
+0001e5a0: 2e64 6566 6175 6c74 5f67 656f 6d5f 6d65  .default_geom_me
+0001e5b0: 7468 6f64 2e0a 2020 2020 2020 2020 2222  thod..        ""
+0001e5c0: 220a 2020 2020 2020 2020 6966 206d 6574  ".        if met
+0001e5d0: 7269 6320 6e6f 7420 696e 2067 6574 5f63  ric not in get_c
+0001e5e0: 6f6d 7061 7269 736f 6e5f 6d65 7472 6963  omparison_metric
+0001e5f0: 7328 293a 0a20 2020 2020 2020 2020 2020  s():.           
+0001e600: 2072 6169 7365 2052 756e 7469 6d65 4572   raise RuntimeEr
+0001e610: 726f 7228 6622 4d65 7472 6963 207b 6d65  ror(f"Metric {me
+0001e620: 7472 6963 7d20 6e6f 7420 7265 636f 676e  tric} not recogn
+0001e630: 6973 6564 2062 7920 220a 2020 2020 2020  ised by ".      
+0001e640: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e650: 2020 2252 4f49 2e67 6574 5f6d 6574 7269    "ROI.get_metri
+0001e660: 635f 6279 5f73 6c69 6365 2829 2229 0a0a  c_by_slice()")..
+0001e670: 2020 2020 2020 2020 6279 5f73 6c69 6365          by_slice
+0001e680: 203d 2062 795f 736c 6963 6520 6f72 2073   = by_slice or s
+0001e690: 6b72 742e 636f 7265 2e44 6566 6175 6c74  krt.core.Default
+0001e6a0: 7328 292e 6279 5f73 6c69 6365 0a0a 2020  s().by_slice..  
+0001e6b0: 2020 2020 2020 7265 7475 726e 207b 706f        return {po
+0001e6c0: 733a 2067 6574 6174 7472 2873 656c 662c  s: getattr(self,
+0001e6d0: 2066 2267 6574 5f7b 6765 745f 6d65 7472   f"get_{get_metr
+0001e6e0: 6963 5f6d 6574 686f 6428 6d65 7472 6963  ic_method(metric
+0001e6f0: 297d 2229 280a 2020 2020 2020 2020 2020  )}")(.          
+0001e700: 2020 6f74 6865 722c 2073 696e 676c 655f    other, single_
+0001e710: 736c 6963 653d 5472 7565 2c20 7669 6577  slice=True, view
+0001e720: 3d76 6965 772c 2070 6f73 3d70 6f73 2c20  =view, pos=pos, 
+0001e730: 6d65 7468 6f64 3d6d 6574 686f 6429 0a20  method=method). 
+0001e740: 2020 2020 2020 2020 2020 2066 6f72 2070             for p
+0001e750: 6f73 2069 6e20 7365 6c66 2e67 6574 5f73  os in self.get_s
+0001e760: 6c69 6365 5f70 6f73 6974 696f 6e73 286f  lice_positions(o
+0001e770: 7468 6572 2c20 7669 6577 2c20 6d65 7468  ther, view, meth
+0001e780: 6f64 3d62 795f 736c 6963 6529 7d0a 0a20  od=by_slice)}.. 
+0001e790: 2020 2064 6566 2067 6574 5f73 6c69 6365     def get_slice
+0001e7a0: 5f73 7461 7428 7365 6c66 2c20 6f74 6865  _stat(self, othe
+0001e7b0: 722c 206d 6574 7269 633d 4e6f 6e65 2c20  r, metric=None, 
+0001e7c0: 736c 6963 655f 7374 6174 3d4e 6f6e 652c  slice_stat=None,
+0001e7d0: 2062 795f 736c 6963 653d 4e6f 6e65 2c0a   by_slice=None,.
+0001e7e0: 2020 2020 2020 2020 2020 2020 7661 6c75              valu
+0001e7f0: 655f 666f 725f 6e6f 6e65 3d4e 6f6e 652c  e_for_none=None,
+0001e800: 2076 6965 773d 2278 2d79 222c 206d 6574   view="x-y", met
+0001e810: 686f 643d 4e6f 6e65 2c20 2a2a 736c 6963  hod=None, **slic
+0001e820: 655f 7374 6174 5f6b 7761 7267 7329 3a0a  e_stat_kwargs):.
+0001e830: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+0001e840: 2020 2020 4765 7420 7374 6174 6973 7469      Get statisti
+0001e850: 6320 666f 7220 736c 6963 652d 6279 2d73  c for slice-by-s
+0001e860: 6c69 6365 2063 6f6d 7061 7269 736f 6e20  lice comparison 
+0001e870: 6d65 7472 6963 2e0a 0a20 2020 2020 2020  metric...       
+0001e880: 202a 2a50 6172 616d 6574 6572 733a 2a2a   **Parameters:**
+0001e890: 0a0a 2020 2020 2020 2020 6f74 6865 7220  ..        other 
+0001e8a0: 3a20 524f 490a 2020 2020 2020 2020 2020  : ROI.          
+0001e8b0: 2020 4f74 6865 7220 524f 4920 746f 2063    Other ROI to c
+0001e8c0: 6f6d 7061 7265 2077 6974 6820 7468 6973  ompare with this
+0001e8d0: 2052 4f49 2e0a 0a20 2020 2020 2020 206d   ROI...        m
+0001e8e0: 6574 7269 6320 3a20 7374 722c 2064 6566  etric : str, def
+0001e8f0: 6175 6c74 3d4e 6f6e 650a 2020 2020 2020  ault=None.      
+0001e900: 2020 2020 2020 4d65 7472 6963 2066 6f72        Metric for
+0001e910: 2077 6869 6368 2073 7461 7469 7374 6963   which statistic
+0001e920: 2066 6f72 2073 6c69 6365 2d62 792d 736c   for slice-by-sl
+0001e930: 6963 6520 7661 6c75 6573 0a20 2020 2020  ice values.     
+0001e940: 2020 2020 2020 2069 7320 746f 2062 6520         is to be 
+0001e950: 7265 7475 726e 6564 2e0a 0a20 2020 2020  returned...     
+0001e960: 2020 2073 6c69 6365 5f73 7461 7420 3a20     slice_stat : 
+0001e970: 7374 722c 2064 6566 6175 6c74 3d4e 6f6e  str, default=Non
+0001e980: 650a 2020 2020 2020 2020 2020 2020 5369  e.            Si
+0001e990: 6e67 6c65 2d76 6172 6961 626c 6520 7374  ngle-variable st
+0001e9a0: 6174 6973 7469 6328 7329 2074 6f20 6265  atistic(s) to be
+0001e9b0: 2072 6574 7572 6e65 6420 666f 7220 736c   returned for sl
+0001e9c0: 6963 652d 6279 2d73 6c69 6365 0a20 2020  ice-by-slice.   
+0001e9d0: 2020 2020 2020 2020 2044 6963 6520 7363           Dice sc
+0001e9e0: 6f72 6573 2e20 2054 6869 7320 7368 6f75  ores.  This shou
+0001e9f0: 6c64 2062 6520 7468 6520 6e61 6d65 206f  ld be the name o
+0001ea00: 6620 7468 6520 6675 6e63 7469 6f6e 2066  f the function f
+0001ea10: 6f72 0a20 2020 2020 2020 2020 2020 2063  or.            c
+0001ea20: 616c 6375 6c61 7469 6f6e 206f 6620 7468  alculation of th
+0001ea30: 6520 7374 6174 6973 7469 6328 7329 2069  e statistic(s) i
+0001ea40: 6e20 7468 6520 5079 7468 6f6e 2073 7461  n the Python sta
+0001ea50: 7469 7374 6963 7320 6d6f 6475 6c65 3a0a  tistics module:.
+0001ea60: 0a20 2020 2020 2020 2020 2020 2068 7474  .            htt
+0001ea70: 7073 3a2f 2f64 6f63 732e 7079 7468 6f6e  ps://docs.python
+0001ea80: 2e6f 7267 2f33 2f6c 6962 7261 7279 2f73  .org/3/library/s
+0001ea90: 7461 7469 7374 6963 732e 6874 6d6c 0a0a  tatistics.html..
+0001eaa0: 2020 2020 2020 2020 2020 2020 4176 6169              Avai
+0001eab0: 6c61 626c 6520 6f70 7469 6f6e 7320 696e  lable options in
+0001eac0: 636c 7564 653a 2022 6d65 616e 222c 2022  clude: "mean", "
+0001ead0: 6d65 6469 616e 222c 2022 6d6f 6465 222c  median", "mode",
+0001eae0: 0a20 2020 2020 2020 2020 2020 2022 7374  .            "st
+0001eaf0: 6465 7622 2c20 2271 7561 6e74 696c 6573  dev", "quantiles
+0001eb00: 222e 0a0a 2020 2020 2020 2020 6279 5f73  "...        by_s
+0001eb10: 6c69 6365 3a20 7374 722c 2064 6566 6175  lice: str, defau
+0001eb20: 6c74 3d4e 6f6e 650a 2020 2020 2020 2020  lt=None.        
+0001eb30: 2020 2020 536c 6963 6573 2074 6f20 6265      Slices to be
+0001eb40: 2063 6f6e 7369 6465 7265 642e 2020 5468   considered.  Th
+0001eb50: 6520 7661 6c69 6420 7370 6563 6966 6963  e valid specific
+0001eb60: 6174 696f 6e73 2061 7265 3a0a 0a20 2020  ations are:..   
+0001eb70: 2020 2020 2020 2020 202d 2022 6c65 6674           - "left
+0001eb80: 223a 2063 6f6e 7369 6465 7220 6f6e 6c79  ": consider only
+0001eb90: 2073 6c69 6365 7320 636f 6e74 6169 6e69   slices containi
+0001eba0: 6e67 2073 656c 663b 0a20 2020 2020 2020  ng self;.       
+0001ebb0: 2020 2020 202d 2022 7269 6768 7422 3a20       - "right": 
+0001ebc0: 636f 6e73 6964 6572 206f 6e6c 7920 736c  consider only sl
+0001ebd0: 6963 6573 2063 6f6e 7461 696e 696e 6720  ices containing 
+0001ebe0: 6f74 6865 7220 726f 693b 0a20 2020 2020  other roi;.     
+0001ebf0: 2020 2020 2020 202d 2022 756e 696f 6e22         - "union"
+0001ec00: 3a20 636f 6e73 6964 6572 2073 6c69 6365  : consider slice
+0001ec10: 7320 636f 6e74 6169 6e69 6e67 2065 6974  s containing eit
+0001ec20: 6865 7220 6f66 2073 656c 6620 616e 6420  her of self and 
+0001ec30: 6f74 6865 7220 726f 693b 0a20 2020 2020  other roi;.     
+0001ec40: 2020 2020 2020 202d 2022 696e 7465 7273         - "inters
+0001ec50: 6563 7469 6f6e 223a 2063 6f6e 7369 6465  ection": conside
+0001ec60: 7220 736c 6963 6573 2063 6f6e 7461 696e  r slices contain
+0001ec70: 696e 6720 626f 7468 206f 6620 7365 6c66  ing both of self
+0001ec80: 2061 6e64 0a20 2020 2020 2020 2020 2020   and.           
+0001ec90: 2020 206f 7468 6572 2072 6f69 2e0a 0a20     other roi... 
+0001eca0: 2020 2020 2020 2020 2020 2049 6620 4e6f             If No
+0001ecb0: 6e65 2c20 7573 6520 736b 7274 2e63 6f72  ne, use skrt.cor
+0001ecc0: 652e 4465 6661 756c 7473 2829 2e62 795f  e.Defaults().by_
+0001ecd0: 736c 6963 650a 0a20 2020 2020 2020 2076  slice..        v
+0001ece0: 616c 7565 5f66 6f72 5f6e 6f6e 6520 3a20  alue_for_none : 
+0001ecf0: 666c 6f61 742c 2064 6566 6175 6c74 3d4e  float, default=N
+0001ed00: 6f6e 650a 2020 2020 2020 2020 2020 2020  one.            
+0001ed10: 5661 6c75 6520 746f 2073 7562 7374 6974  Value to substit
+0001ed20: 7574 6520 666f 7220 616e 7920 4e6f 6e65  ute for any None
+0001ed30: 2076 616c 7565 7320 616d 6f6e 6720 736c   values among sl
+0001ed40: 6963 650a 2020 2020 2020 2020 2020 2020  ice.            
+0001ed50: 6d65 7472 6963 2076 616c 7565 732e 2020  metric values.  
+0001ed60: 4966 204e 6f6e 652c 204e 6f6e 6520 7661  If None, None va
+0001ed70: 6c75 6573 2061 6d6f 6e67 2074 6865 206d  lues among the m
+0001ed80: 6574 7269 6320 7661 6c75 6573 0a20 2020  etric values.   
+0001ed90: 2020 2020 2020 2020 2061 7265 206f 6d69           are omi
+0001eda0: 7474 6564 2e0a 0a20 2020 2020 2020 2076  tted...        v
+0001edb0: 6965 7720 3a20 7374 722c 2064 6566 6175  iew : str, defau
+0001edc0: 6c74 3d22 782d 7922 0a20 2020 2020 2020  lt="x-y".       
+0001edd0: 2020 2020 204f 7269 656e 7461 7469 6f6e       Orientation
+0001ede0: 206f 6620 736c 6963 6573 206f 6e20 7768   of slices on wh
+0001edf0: 6963 6820 746f 2067 6574 206d 6574 7269  ich to get metri
+0001ee00: 6320 7661 6c75 6573 2e0a 0a20 2020 2020  c values...     
+0001ee10: 2020 206d 6574 686f 6420 3a20 7374 722c     method : str,
+0001ee20: 2064 6566 6175 6c74 3d4e 6f6e 650a 2020   default=None.  
+0001ee30: 2020 2020 2020 2020 2020 4d65 7468 6f64            Method
+0001ee40: 2074 6f20 7573 6520 666f 7220 6d65 7472   to use for metr
+0001ee50: 6963 2063 616c 6375 6c61 7469 6f6e 2e20  ic calculation. 
+0001ee60: 4361 6e20 6265 3a20 0a20 2020 2020 2020  Can be: .       
+0001ee70: 2020 2020 2020 2020 202d 2022 636f 6e74           - "cont
+0001ee80: 6f75 7222 3a20 6361 6c63 756c 6174 6520  our": calculate 
+0001ee90: 6d65 7472 6963 2066 726f 6d20 7368 6170  metric from shap
+0001eea0: 656c 7920 636f 6e74 6f75 7273 2e0a 2020  ely contours..  
+0001eeb0: 2020 2020 2020 2020 2020 2020 2020 2d20                - 
+0001eec0: 226d 6173 6b22 3a20 6361 6c63 7561 6c74  "mask": calcualt
+0001eed0: 6520 6d65 7472 6963 2066 726f 6d20 6269  e metric from bi
+0001eee0: 6e61 7279 206d 6173 6b73 2e0a 2020 2020  nary masks..    
+0001eef0: 2020 2020 2020 2020 2020 2020 2d20 4e6f              - No
+0001ef00: 6e65 3a20 7573 6520 7468 6520 6d65 7468  ne: use the meth
+0001ef10: 6f64 2073 6574 2069 6e20 7365 6c66 2e64  od set in self.d
+0001ef20: 6566 6175 6c74 5f67 656f 6d5f 6d65 7468  efault_geom_meth
+0001ef30: 6f64 2e0a 0a20 2020 2020 2020 2073 6c69  od...        sli
+0001ef40: 6365 5f73 7461 745f 6b77 6172 6773 203a  ce_stat_kwargs :
+0001ef50: 2064 6963 742c 2064 6566 6175 6c74 3d4e   dict, default=N
+0001ef60: 6f6e 650a 2020 2020 2020 2020 2020 2020  one.            
+0001ef70: 4b65 7977 6f72 6420 6172 6775 6d65 6e74  Keyword argument
+0001ef80: 7320 746f 2062 6520 7061 7373 6564 2074  s to be passed t
+0001ef90: 6f20 6675 6e63 7469 6f6e 206f 6620 7374  o function of st
+0001efa0: 6174 6973 7469 6373 0a20 2020 2020 2020  atistics.       
+0001efb0: 2020 2020 206d 6f64 756c 6520 666f 7220       module for 
+0001efc0: 6361 6c63 756c 6174 696f 6e20 7265 6c61  calculation rela
+0001efd0: 7469 7665 2074 6f20 736c 6963 6520 7661  tive to slice va
+0001efe0: 6c75 6573 2e20 2046 6f72 2065 7861 6d70  lues.  For examp
+0001eff0: 6c65 2c0a 2020 2020 2020 2020 2020 2020  le,.            
+0001f000: 6966 2071 7561 6e74 696c 6573 2061 7265  if quantiles are
+0001f010: 2072 6571 7569 7265 6420 666f 7220 3130   required for 10
+0001f020: 2069 6e74 6572 7661 6c73 2c20 7261 7468   intervals, rath
+0001f030: 6572 2074 6861 6e20 666f 720a 2020 2020  er than for.    
+0001f040: 2020 2020 2020 2020 7468 6520 6465 6661          the defa
+0001f050: 756c 7420 6f66 2034 2c20 7468 6973 2063  ult of 4, this c
+0001f060: 616e 2062 6520 7370 6563 6966 6965 6420  an be specified 
+0001f070: 7573 696e 673a 0a0a 2020 2020 2020 2020  using:..        
+0001f080: 2020 2020 736c 6963 655f 7374 6174 5f6b      slice_stat_k
+0001f090: 7761 7267 737b 226e 2220 3a20 3130 7d0a  wargs{"n" : 10}.
+0001f0a0: 0a20 2020 2020 2020 2020 2020 2046 6f72  .            For
+0001f0b0: 2061 7661 696c 6162 6c65 206b 6579 776f   available keywo
+0001f0c0: 7264 206f 7074 696f 6e73 2c20 7365 6520  rd options, see 
+0001f0d0: 646f 6375 6d65 6e74 6174 696f 6e20 6f66  documentation of
+0001f0e0: 2073 7461 7469 7374 6963 730a 2020 2020   statistics.    
+0001f0f0: 2020 2020 2020 2020 6d6f 6475 6c65 2061          module a
+0001f100: 743a 0a0a 2020 2020 2020 2020 2020 2020  t:..            
+0001f110: 6874 7470 733a 2f2f 646f 6373 2e70 7974  https://docs.pyt
+0001f120: 686f 6e2e 6f72 672f 332f 6c69 6272 6172  hon.org/3/librar
+0001f130: 792f 7374 6174 6973 7469 6373 2e68 746d  y/statistics.htm
+0001f140: 6c0a 2020 2020 2020 2020 2222 220a 2020  l.        """.  
+0001f150: 2020 2020 2020 6279 5f73 6c69 6365 203d        by_slice =
+0001f160: 2062 795f 736c 6963 6520 6f72 2073 6b72   by_slice or skr
+0001f170: 742e 636f 7265 2e44 6566 6175 6c74 7328  t.core.Defaults(
+0001f180: 292e 6279 5f73 6c69 6365 0a20 2020 2020  ).by_slice.     
+0001f190: 2020 2073 6c69 6365 5f73 7461 745f 6b77     slice_stat_kw
+0001f1a0: 6172 6773 203d 2073 6c69 6365 5f73 7461  args = slice_sta
+0001f1b0: 745f 6b77 6172 6773 206f 7220 7b7d 0a0a  t_kwargs or {}..
+0001f1c0: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+0001f1d0: 6b72 742e 636f 7265 2e67 6574 5f73 7461  krt.core.get_sta
+0001f1e0: 7428 7365 6c66 2e67 6574 5f6d 6574 7269  t(self.get_metri
+0001f1f0: 635f 6279 5f73 6c69 6365 280a 2020 2020  c_by_slice(.    
+0001f200: 2020 2020 2020 2020 6f74 6865 722c 206d          other, m
+0001f210: 6574 7269 632c 2062 795f 736c 6963 652c  etric, by_slice,
+0001f220: 2076 6965 772c 206d 6574 686f 6429 2c0a   view, method),.
+0001f230: 2020 2020 2020 2020 2020 2020 7661 6c75              valu
+0001f240: 655f 666f 725f 6e6f 6e65 2c20 736c 6963  e_for_none, slic
+0001f250: 655f 7374 6174 2c20 2a2a 736c 6963 655f  e_stat, **slice_
+0001f260: 7374 6174 5f6b 7761 7267 7329 0a0a 2020  stat_kwargs)..  
+0001f270: 2020 6465 6620 6765 745f 736c 6963 655f    def get_slice_
+0001f280: 7374 6174 7328 7365 6c66 2c20 6f74 6865  stats(self, othe
+0001f290: 722c 206d 6574 7269 6373 3d4e 6f6e 652c  r, metrics=None,
+0001f2a0: 2073 6c69 6365 5f73 7461 7473 3d4e 6f6e   slice_stats=Non
+0001f2b0: 652c 0a20 2020 2020 2020 2020 2020 2064  e,.            d
+0001f2c0: 6566 6175 6c74 5f62 795f 736c 6963 653d  efault_by_slice=
+0001f2d0: 4e6f 6e65 2c20 6d65 7468 6f64 3d4e 6f6e  None, method=Non
+0001f2e0: 652c 2076 6965 773d 2278 2d79 222c 0a20  e, view="x-y",. 
+0001f2f0: 2020 2020 2020 2020 2020 2073 6570 6172             separ
+0001f300: 6174 655f 636f 6d70 6f6e 656e 7473 3d46  ate_components=F
+0001f310: 616c 7365 293a 0a20 2020 2020 2020 2022  alse):.        "
+0001f320: 2222 0a20 2020 2020 2020 2047 6574 2064  "".        Get d
+0001f330: 6963 7469 6f6e 6172 7920 6f66 2073 7461  ictionary of sta
+0001f340: 7469 7374 6963 7320 666f 7220 736c 6963  tistics for slic
+0001f350: 652d 6279 2d73 6c69 6365 2063 6f6d 7061  e-by-slice compa
+0001f360: 7269 736f 6e20 6d65 7472 6963 732e 0a0a  rison metrics...
+0001f370: 2020 2020 2020 2020 2a2a 5061 7261 6d65          **Parame
+0001f380: 7465 7273 3a2a 2a0a 0a20 2020 2020 2020  ters:**..       
+0001f390: 206f 7468 6572 203a 2052 4f49 0a20 2020   other : ROI.   
+0001f3a0: 2020 2020 2020 2020 204f 7468 6572 2052           Other R
+0001f3b0: 4f49 2074 6f20 636f 6d70 6172 6520 7769  OI to compare wi
+0001f3c0: 7468 2074 6869 7320 524f 492e 0a0a 2020  th this ROI...  
+0001f3d0: 2020 2020 2020 6d65 7472 6963 7320 3a20        metrics : 
+0001f3e0: 7374 722f 6c69 7374 2c20 6465 6661 756c  str/list, defaul
+0001f3f0: 743d 4e6f 6e65 0a20 2020 2020 2020 2020  t=None.         
+0001f400: 2020 204d 6574 7269 6328 7329 2066 6f72     Metric(s) for
+0001f410: 2077 6869 6368 2073 7461 7469 7374 6963   which statistic
+0001f420: 2873 2920 666f 7220 736c 6963 652d 6279  (s) for slice-by
+0001f430: 2d73 6c69 6365 2063 616c 6375 6c61 7469  -slice calculati
+0001f440: 6f6e 730a 2020 2020 2020 2020 2020 2020  ons.            
+0001f450: 6172 6520 746f 2062 6520 7265 7475 726e  are to be return
+0001f460: 6564 2e20 2041 2073 696e 676c 6520 6d65  ed.  A single me
+0001f470: 7472 6963 2063 616e 2062 7920 7370 6566  tric can by spef
+0001f480: 6963 6965 6420 6173 2061 2073 7472 696e  icied as a strin
+0001f490: 672e 0a20 2020 2020 2020 2020 2020 204d  g..            M
+0001f4a0: 756c 7469 706c 6520 6d65 7472 6963 7320  ultiple metrics 
+0001f4b0: 6361 6e20 6265 2073 7065 6369 6669 6564  can be specified
+0001f4c0: 2061 7320 6120 6c69 7374 206f 6620 7374   as a list of st
+0001f4d0: 7269 6e67 732e 0a0a 2020 2020 2020 2020  rings...        
+0001f4e0: 736c 6963 655f 7374 6174 7320 3a20 7374  slice_stats : st
+0001f4f0: 722f 6c69 7374 2f64 6963 742c 2064 6566  r/list/dict, def
+0001f500: 6175 6c74 3d4e 6f6e 650a 2020 2020 2020  ault=None.      
+0001f510: 2020 2020 2020 5370 6563 6966 6963 6174        Specificat
+0001f520: 696f 6e20 6f66 2073 7461 7469 7374 6963  ion of statistic
+0001f530: 7320 746f 2062 6520 6361 6c63 756c 6174  s to be calculat
+0001f540: 6564 2072 656c 6174 6976 650a 2020 2020  ed relative.    
+0001f550: 2020 2020 2020 2020 746f 2073 6c69 6365          to slice
+0001f560: 2d62 792d 736c 6963 6520 6d65 7472 6963  -by-slice metric
+0001f570: 2076 616c 7565 732e 2020 5573 6564 2066   values.  Used f
+0001f580: 6f72 2061 6c6c 206d 6574 7269 6373 2077  or all metrics w
+0001f590: 6974 680a 2020 2020 2020 2020 2020 2020  ith.            
+0001f5a0: 7375 6666 6978 2022 5f73 6c69 6365 5f73  suffix "_slice_s
+0001f5b0: 7461 7473 2220 696e 2074 6865 203c 6d65  tats" in the <me
+0001f5c0: 7472 6963 733e 206c 6973 742e 0a0a 2020  trics> list...  
+0001f5d0: 2020 2020 2020 2020 2020 4120 7374 6174            A stat
+0001f5e0: 6973 7469 6320 6973 2073 7065 6369 6669  istic is specifi
+0001f5f0: 6564 2062 7920 7468 6520 6e61 6d65 206f  ed by the name o
+0001f600: 6620 7468 6520 6675 6e63 7469 6f6e 2066  f the function f
+0001f610: 6f72 0a20 2020 2020 2020 2020 2020 2069  or.            i
+0001f620: 7473 2063 616c 6375 6c61 7469 6f6e 2069  ts calculation i
+0001f630: 6e20 7468 6520 5079 7468 6f6e 2073 7461  n the Python sta
+0001f640: 7469 7374 6963 7320 6d6f 6475 6c65 3a0a  tistics module:.
+0001f650: 0a20 2020 2020 2020 2020 2020 2068 7474  .            htt
+0001f660: 7073 3a2f 2f64 6f63 732e 7079 7468 6f6e  ps://docs.python
+0001f670: 2e6f 7267 2f33 2f6c 6962 7261 7279 2f73  .org/3/library/s
+0001f680: 7461 7469 7374 6963 732e 6874 6d6c 0a0a  tatistics.html..
+0001f690: 2020 2020 2020 2020 2020 2020 466f 7220              For 
+0001f6a0: 6974 7320 7573 6520 6865 7265 2c20 7468  its use here, th
+0001f6b0: 6520 7265 6c65 7661 6e74 2066 756e 6374  e relevant funct
+0001f6c0: 696f 6e20 6d75 7374 2072 6571 7569 7265  ion must require
+0001f6d0: 0a20 2020 2020 2020 2020 2020 2061 2073  .            a s
+0001f6e0: 696e 676c 652d 7661 7269 6162 6c65 2069  ingle-variable i
+0001f6f0: 6e70 7574 2c20 6d75 7374 206e 6f74 2072  nput, must not r
+0001f700: 6571 7569 7265 2061 6e79 206b 6579 776f  equire any keywo
+0001f710: 7264 0a20 2020 2020 2020 2020 2020 2061  rd.            a
+0001f720: 7267 756d 656e 7473 2c20 616e 6420 6d75  rguments, and mu
+0001f730: 7374 2072 6574 7572 6e20 6120 7369 6e67  st return a sing
+0001f740: 6c65 206e 756d 6265 722e 0a0a 2020 2020  le number...    
+0001f750: 2020 2020 2020 2020 4176 6169 6c61 626c          Availabl
+0001f760: 6520 6f70 7469 6f6e 7320 696e 636c 7564  e options includ
+0001f770: 653a 2022 6d65 616e 222c 2022 6d65 6469  e: "mean", "medi
+0001f780: 616e 222c 2022 6d6f 6465 222c 0a20 2020  an", "mode",.   
+0001f790: 2020 2020 2020 2020 2022 7374 6465 7622           "stdev"
+0001f7a0: 2e0a 0a20 2020 2020 2020 2020 2020 5374  ...           St
+0001f7b0: 6174 6973 7469 6373 2074 6f20 6265 2063  atistics to be c
+0001f7c0: 616c 6375 6c61 7465 6420 6361 6e20 6265  alculated can be
+0001f7d0: 2073 7065 6369 6669 6564 2075 7369 6e67   specified using
+0001f7e0: 2061 6e79 206f 660a 2020 2020 2020 2020   any of.        
+0001f7f0: 2020 2074 6865 2066 6f6c 6c6f 7769 6e67     the following
+0001f800: 3a0a 0a20 2020 2020 2020 2020 2020 2d20  :..           - 
+0001f810: 5374 7269 6e67 2073 7065 6369 6679 696e  String specifyin
+0001f820: 6720 7369 6e67 6c65 2073 7461 7469 7374  g single statist
+0001f830: 6963 2074 6f20 6265 2063 616c 6375 6c61  ic to be calcula
+0001f840: 7465 642c 0a20 2020 2020 2020 2020 2020  ted,.           
+0001f850: 2020 7769 7468 2073 6c69 6365 7320 636f    with slices co
+0001f860: 6e73 6964 6572 6564 2061 7320 6769 7665  nsidered as give
+0001f870: 6e20 6279 2064 6566 6175 6c74 5f62 795f  n by default_by_
+0001f880: 736c 6963 652c 0a20 2020 2020 2020 2020  slice,.         
+0001f890: 2020 2020 666f 7220 6578 616d 706c 653a      for example:
+0001f8a0: 2022 6d65 616e 223b 0a20 2020 2020 2020   "mean";.       
+0001f8b0: 2020 2020 2d20 4c69 7374 2073 7065 6369      - List speci
+0001f8c0: 6679 696e 6720 6d75 6c74 6970 6c65 2073  fying multiple s
+0001f8d0: 7461 7469 7374 6963 7320 746f 2062 6520  tatistics to be 
+0001f8e0: 6361 6c63 756c 6174 6564 2c0a 2020 2020  calculated,.    
+0001f8f0: 2020 2020 2020 2020 2077 6974 6820 736c           with sl
+0001f900: 6963 6573 2063 6f6e 7369 6465 7265 6420  ices considered 
+0001f910: 6173 2067 6976 656e 2062 7920 6465 6661  as given by defa
+0001f920: 756c 745f 6279 5f73 6c69 6365 2c0a 2020  ult_by_slice,.  
+0001f930: 2020 2020 2020 2020 2020 2066 6f72 2065             for e
+0001f940: 7861 6d70 6c65 3a20 5b22 6d65 616e 222c  xample: ["mean",
+0001f950: 2022 7374 6465 7622 5d3b 0a20 2020 2020   "stdev"];.     
+0001f960: 2020 2020 2020 2d20 4469 6374 696f 6e61        - Dictiona
+0001f970: 7279 2077 6865 7265 206b 6579 7320 7370  ry where keys sp
+0001f980: 6563 6966 7920 736c 6963 6573 2074 6f20  ecify slices to 
+0001f990: 6265 2063 6f6e 7369 6465 7265 642c 0a20  be considered,. 
+0001f9a0: 2020 2020 2020 2020 2020 2020 616e 6420              and 
+0001f9b0: 7661 6c75 6573 2073 7065 6369 6679 2073  values specify s
+0001f9c0: 7461 7469 7374 6963 7320 2873 7472 696e  tatistics (strin
+0001f9d0: 6720 6f72 206c 6973 7429 2c20 666f 720a  g or list), for.
+0001f9e0: 2020 2020 2020 2020 2020 2020 2065 7861               exa
+0001f9f0: 6d70 6c65 3a20 7b22 756e 696f 6e22 3a20  mple: {"union": 
+0001fa00: 5b22 6d65 616e 222c 2022 7374 6465 7622  ["mean", "stdev"
+0001fa10: 5d7d 2e20 2056 616c 6964 2073 6c69 6365  ]}.  Valid slice
+0001fa20: 0a20 2020 2020 2020 2020 2020 2020 7370  .             sp
+0001fa30: 6563 6966 6963 6174 696f 6e73 2061 7265  ecifications are
+0001fa40: 2061 7320 6c69 7374 6564 2066 6f72 2064   as listed for d
+0001fa50: 6566 6175 6c74 5f62 795f 736c 6963 652e  efault_by_slice.
+0001fa60: 0a0a 2020 2020 2020 2020 6465 6661 756c  ..        defaul
+0001fa70: 745f 6279 5f73 6c69 6365 3a20 7374 722c  t_by_slice: str,
+0001fa80: 2064 6566 6175 6c74 3d4e 6f6e 650a 2020   default=None.  
+0001fa90: 2020 2020 2020 2020 2020 4465 6661 756c            Defaul
+0001faa0: 7420 7370 6563 6966 6963 6174 696f 6e20  t specification 
+0001fab0: 6f66 2073 6c69 6365 7320 746f 2062 6520  of slices to be 
+0001fac0: 636f 6e73 6964 6572 6564 2077 6865 6e0a  considered when.
+0001fad0: 2020 2020 2020 2020 2020 2020 6361 6c63              calc
+0001fae0: 756c 6174 696e 6720 736c 6963 652d 6279  ulating slice-by
+0001faf0: 2d73 6c69 6365 2073 7461 7469 7374 6963  -slice statistic
+0001fb00: 732e 2020 5468 6520 7661 6c69 6420 7370  s.  The valid sp
+0001fb10: 6563 6966 6963 6174 696f 6e73 0a20 2020  ecifications.   
+0001fb20: 2020 2020 2020 2020 2061 7265 3a0a 0a20           are:.. 
+0001fb30: 2020 2020 2020 2020 2020 202d 2022 6c65             - "le
+0001fb40: 6674 223a 2063 6f6e 7369 6465 7220 6f6e  ft": consider on
+0001fb50: 6c79 2073 6c69 6365 7320 636f 6e74 6169  ly slices contai
+0001fb60: 6e69 6e67 2073 656c 663b 0a20 2020 2020  ning self;.     
+0001fb70: 2020 2020 2020 202d 2022 7269 6768 7422         - "right"
+0001fb80: 3a20 636f 6e73 6964 6572 206f 6e6c 7920  : consider only 
+0001fb90: 736c 6963 6573 2063 6f6e 7461 696e 696e  slices containin
+0001fba0: 6720 6f74 6865 7220 726f 693b 0a20 2020  g other roi;.   
+0001fbb0: 2020 2020 2020 2020 202d 2022 756e 696f           - "unio
+0001fbc0: 6e22 3a20 636f 6e73 6964 6572 2073 6c69  n": consider sli
+0001fbd0: 6365 7320 636f 6e74 6169 6e69 6e67 2065  ces containing e
+0001fbe0: 6974 6865 7220 6f66 2073 656c 6620 616e  ither of self an
+0001fbf0: 6420 6f74 6865 7220 726f 693b 0a20 2020  d other roi;.   
+0001fc00: 2020 2020 2020 2020 202d 2022 696e 7465           - "inte
+0001fc10: 7273 6563 7469 6f6e 223a 2063 6f6e 7369  rsection": consi
+0001fc20: 6465 7220 736c 6963 6573 2063 6f6e 7461  der slices conta
+0001fc30: 696e 696e 6720 626f 7468 206f 6620 7365  ining both of se
+0001fc40: 6c66 2061 6e64 0a20 2020 2020 2020 2020  lf and.         
+0001fc50: 2020 2020 206f 7468 6572 2072 6f69 2e0a       other roi..
+0001fc60: 0a20 2020 2020 2020 2020 2020 2049 6620  .            If 
+0001fc70: 4e6f 6e65 2c20 7573 6520 736b 7274 2e63  None, use skrt.c
+0001fc80: 6f72 652e 4465 6661 756c 7473 2829 2e62  ore.Defaults().b
+0001fc90: 795f 736c 6963 650a 0a20 2020 2020 2020  y_slice..       
+0001fca0: 2076 6965 7720 3a20 7374 722c 2064 6566   view : str, def
+0001fcb0: 6175 6c74 3d22 782d 7922 0a20 2020 2020  ault="x-y".     
+0001fcc0: 2020 2020 2020 204f 7269 656e 7461 7469         Orientati
+0001fcd0: 6f6e 206f 6620 736c 6963 6573 206f 6e20  on of slices on 
+0001fce0: 7768 6963 6820 746f 2067 6574 206d 6574  which to get met
+0001fcf0: 7269 6320 7661 6c75 6573 2e0a 0a20 2020  ric values...   
+0001fd00: 2020 2020 206d 6574 686f 6420 3a20 7374       method : st
+0001fd10: 722c 2064 6566 6175 6c74 3d4e 6f6e 650a  r, default=None.
+0001fd20: 2020 2020 2020 2020 2020 2020 4d65 7468              Meth
+0001fd30: 6f64 2074 6f20 7573 6520 666f 7220 6d65  od to use for me
+0001fd40: 7472 6963 2063 616c 6375 6c61 7469 6f6e  tric calculation
+0001fd50: 2e20 4361 6e20 6265 3a20 0a20 2020 2020  . Can be: .     
+0001fd60: 2020 2020 2020 2020 2020 202d 2022 636f             - "co
+0001fd70: 6e74 6f75 7222 3a20 6361 6c63 756c 6174  ntour": calculat
+0001fd80: 6520 6d65 7472 6963 2066 726f 6d20 7368  e metric from sh
+0001fd90: 6170 656c 7920 636f 6e74 6f75 7273 2e0a  apely contours..
+0001fda0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001fdb0: 2d20 226d 6173 6b22 3a20 6361 6c63 756c  - "mask": calcul
+0001fdc0: 6174 6520 6d65 7472 6963 2066 726f 6d20  ate metric from 
+0001fdd0: 6269 6e61 7279 206d 6173 6b73 2e0a 2020  binary masks..  
+0001fde0: 2020 2020 2020 2020 2020 2020 2020 2d20                - 
+0001fdf0: 4e6f 6e65 3a20 7573 6520 7468 6520 6d65  None: use the me
+0001fe00: 7468 6f64 2073 6574 2069 6e20 7365 6c66  thod set in self
+0001fe10: 2e64 6566 6175 6c74 5f67 656f 6d5f 6d65  .default_geom_me
+0001fe20: 7468 6f64 2e0a 0a20 2020 2020 2020 2073  thod...        s
+0001fe30: 6570 6172 6174 655f 636f 6d70 6f6e 656e  eparate_componen
+0001fe40: 7473 3a20 626f 6f6c 2c20 6465 6661 756c  ts: bool, defaul
+0001fe50: 743d 4661 6c73 650a 2020 2020 2020 2020  t=False.        
+0001fe60: 2020 2020 4966 2046 616c 7365 2c20 7265      If False, re
+0001fe70: 7475 726e 2061 206d 6574 7269 6320 7265  turn a metric re
+0001fe80: 7072 6573 656e 7465 6420 6279 2061 2076  presented by a v
+0001fe90: 6563 746f 7220 6173 2061 0a20 2020 2020  ector as a.     
+0001fea0: 2020 2020 2020 206c 6973 7420 6f66 2063         list of c
+0001feb0: 6f6d 706f 6e65 6e74 2076 616c 7565 732e  omponent values.
+0001fec0: 2020 4966 2074 7275 652c 2072 6574 7572    If true, retur
+0001fed0: 6e20 6120 7365 7061 7261 7465 206d 6574  n a separate met
+0001fee0: 7269 6320 666f 720a 2020 2020 2020 2020  ric for.        
+0001fef0: 2020 2020 6561 6368 2063 6f6d 706f 6e65      each compone
+0001ff00: 6e74 2c20 6c61 6265 6c6c 696e 6720 6279  nt, labelling by
+0001ff10: 2074 6865 2063 6f6d 706f 6e65 6e74 2061   the component a
+0001ff20: 7865 7320 6465 7465 726d 696e 6564 0a20  xes determined. 
+0001ff30: 2020 2020 2020 2020 2020 2066 726f 6d20             from 
+0001ff40: 3c76 6965 773e 2e0a 2020 2020 2020 2020  <view>..        
+0001ff50: 2222 220a 2020 2020 2020 2020 6966 206d  """.        if m
+0001ff60: 6574 7269 6373 2069 7320 4e6f 6e65 206f  etrics is None o
+0001ff70: 7220 736c 6963 655f 7374 6174 7320 6973  r slice_stats is
+0001ff80: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+0001ff90: 2020 2072 6574 7572 6e20 7b7d 0a0a 2020     return {}..  
+0001ffa0: 2020 2020 2020 6465 6661 756c 745f 6279        default_by
+0001ffb0: 5f73 6c69 6365 203d 2064 6566 6175 6c74  _slice = default
+0001ffc0: 5f62 795f 736c 6963 6520 6f72 2073 6b72  _by_slice or skr
+0001ffd0: 742e 636f 7265 2e44 6566 6175 6c74 7328  t.core.Defaults(
+0001ffe0: 292e 6279 5f73 6c69 6365 0a0a 2020 2020  ).by_slice..    
+0001fff0: 2020 2020 2320 456e 7375 7265 2074 6861      # Ensure tha
+00020000: 7420 6d65 7472 6963 7320 6973 2061 206e  t metrics is a n
+00020010: 6f6e 2d65 6d70 7479 206c 6973 742e 0a20  on-empty list.. 
+00020020: 2020 2020 2020 2069 6620 6973 696e 7374         if isinst
+00020030: 616e 6365 286d 6574 7269 6373 2c20 7374  ance(metrics, st
+00020040: 7229 3a0a 2020 2020 2020 2020 2020 2020  r):.            
+00020050: 6d65 7472 6963 7320 3d20 5b6d 6574 7269  metrics = [metri
+00020060: 6373 5d0a 2020 2020 2020 2020 656c 6966  cs].        elif
+00020070: 206e 6f74 2073 6b72 742e 636f 7265 2e69   not skrt.core.i
+00020080: 735f 6c69 7374 286d 6574 7269 6373 293a  s_list(metrics):
+00020090: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+000200a0: 7572 6e20 7b7d 0a20 2020 2020 2020 206d  urn {}.        m
+000200b0: 6574 7269 6373 203d 205b 6d65 7472 6963  etrics = [metric
+000200c0: 2066 6f72 206d 6574 7269 6320 696e 206d   for metric in m
+000200d0: 6574 7269 6373 0a20 2020 2020 2020 2020  etrics.         
+000200e0: 2020 2020 2020 2069 6620 6622 7b6d 6574         if f"{met
+000200f0: 7269 637d 5f73 6c69 6365 5f73 7461 7473  ric}_slice_stats
+00020100: 2220 696e 2067 6574 5f63 6f6d 7061 7269  " in get_compari
+00020110: 736f 6e5f 6d65 7472 6963 7328 295d 0a20  son_metrics()]. 
+00020120: 2020 2020 2020 2069 6620 6e6f 7420 6d65         if not me
+00020130: 7472 6963 733a 0a20 2020 2020 2020 2020  trics:.         
+00020140: 2020 2072 6574 7572 6e20 7b7d 0a0a 2020     return {}..  
+00020150: 2020 2020 2020 736c 6963 655f 7374 6174        slice_stat
+00020160: 7320 3d20 6578 7061 6e64 5f73 6c69 6365  s = expand_slice
+00020170: 5f73 7461 7473 2873 6c69 6365 5f73 7461  _stats(slice_sta
+00020180: 7473 2c20 6465 6661 756c 745f 6279 5f73  ts, default_by_s
+00020190: 6c69 6365 290a 2020 2020 2020 2020 6966  lice).        if
+000201a0: 206e 6f74 2073 6c69 6365 5f73 7461 7473   not slice_stats
+000201b0: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+000201c0: 7475 726e 207b 7d0a 0a20 2020 2020 2020  turn {}..       
+000201d0: 2023 2043 616c 6375 6c61 7465 2073 7461   # Calculate sta
+000201e0: 7469 7374 6963 2873 2920 666f 7220 6d65  tistic(s) for me
+000201f0: 7472 6963 2076 616c 7565 7320 6361 6c63  tric values calc
+00020200: 756c 6174 6564 2073 6c69 6365 2062 7920  ulated slice by 
+00020210: 736c 6963 652e 0a20 2020 2020 2020 2063  slice..        c
+00020220: 616c 6375 6c61 7465 645f 736c 6963 655f  alculated_slice_
+00020230: 7374 6174 7320 3d20 7b7d 0a20 2020 2020  stats = {}.     
+00020240: 2020 2066 6f72 206d 6574 7269 6320 696e     for metric in
+00020250: 206d 6574 7269 6373 3a0a 2020 2020 2020   metrics:.      
+00020260: 2020 2020 2020 666f 7220 6279 5f73 6c69        for by_sli
+00020270: 6365 2c20 7374 6174 7320 696e 2073 6c69  ce, stats in sli
+00020280: 6365 5f73 7461 7473 2e69 7465 6d73 2829  ce_stats.items()
+00020290: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000202a0: 2020 7661 6c75 6573 203d 2073 656c 662e    values = self.
+000202b0: 6765 745f 6d65 7472 6963 5f62 795f 736c  get_metric_by_sl
+000202c0: 6963 6528 0a20 2020 2020 2020 2020 2020  ice(.           
+000202d0: 2020 2020 2020 2020 2020 2020 206f 7468               oth
+000202e0: 6572 2c20 6d65 7472 6963 2c20 6279 5f73  er, metric, by_s
+000202f0: 6c69 6365 2c20 7669 6577 2c20 6d65 7468  lice, view, meth
+00020300: 6f64 290a 2020 2020 2020 2020 2020 2020  od).            
+00020310: 2020 2020 666f 7220 7374 6174 2069 6e20      for stat in 
+00020320: 7374 6174 733a 0a20 2020 2020 2020 2020  stats:.         
+00020330: 2020 2020 2020 2020 2020 206b 6579 203d             key =
+00020340: 2066 227b 6d65 7472 6963 7d5f 736c 6963   f"{metric}_slic
+00020350: 655f 7b62 795f 736c 6963 657d 5f7b 7374  e_{by_slice}_{st
+00020360: 6174 7d22 0a20 2020 2020 2020 2020 2020  at}".           
+00020370: 2020 2020 2020 2020 2063 616c 6375 6c61           calcula
+00020380: 7465 645f 736c 6963 655f 7374 6174 735b  ted_slice_stats[
+00020390: 6b65 795d 203d 2028 0a20 2020 2020 2020  key] = (.       
 000203a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000203b0: 2020 2020 2020 7665 6374 6f72 203d 2063        vector = c
-000203c0: 616c 6375 6c61 7465 645f 736c 6963 655f  alculated_slice_
-000203d0: 7374 6174 732e 706f 7028 6b65 7929 0a20  stats.pop(key). 
+000203b0: 2020 2020 2073 6b72 742e 636f 7265 2e67       skrt.core.g
+000203c0: 6574 5f73 7461 7428 7661 6c75 6573 2c20  et_stat(values, 
+000203d0: 7374 6174 3d73 7461 7429 290a 2020 2020  stat=stat)).    
 000203e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000203f0: 2020 2020 2020 2066 6f72 2069 2c20 695f         for i, i_
-00020400: 6178 2069 6e20 656e 756d 6572 6174 6528  ax in enumerate(
-00020410: 736b 7274 2e69 6d61 6765 2e5f 706c 6f74  skrt.image._plot
-00020420: 5f61 7865 735b 7669 6577 5d29 3a0a 2020  _axes[view]):.  
-00020430: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020440: 2020 2020 2020 2020 2020 6178 203d 2073            ax = s
-00020450: 6b72 742e 696d 6167 652e 5f61 7865 735b  krt.image._axes[
-00020460: 695f 6178 5d0a 2020 2020 2020 2020 2020  i_ax].          
-00020470: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020480: 2020 6178 5f6b 6579 203d 2066 227b 6d65    ax_key = f"{me
-00020490: 7472 6963 7d5f 7b61 787d 5f73 6c69 6365  tric}_{ax}_slice
-000204a0: 5f7b 6279 5f73 6c69 6365 7d5f 7b73 7461  _{by_slice}_{sta
-000204b0: 747d 220a 2020 2020 2020 2020 2020 2020  t}".            
-000204c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000204d0: 6361 6c63 756c 6174 6564 5f73 6c69 6365  calculated_slice
-000204e0: 5f73 7461 7473 5b61 785f 6b65 795d 203d  _stats[ax_key] =
-000204f0: 2076 6563 746f 725b 695d 0a0a 2020 2020   vector[i]..    
-00020500: 2020 2020 7265 7475 726e 2063 616c 6375      return calcu
-00020510: 6c61 7465 645f 736c 6963 655f 7374 6174  lated_slice_stat
-00020520: 730a 0a20 2020 2064 6566 206d 6174 6368  s..    def match
-00020530: 5f6d 6173 6b5f 766f 7865 6c5f 7369 7a65  _mask_voxel_size
-00020540: 2873 656c 662c 206f 7468 6572 2c20 766f  (self, other, vo
-00020550: 7865 6c5f 7369 7a65 3d4e 6f6e 652c 0a20  xel_size=None,. 
-00020560: 2020 2020 2020 2020 2020 2076 6f78 656c             voxel
-00020570: 5f64 696d 5f74 6f6c 6572 616e 6365 3d30  _dim_tolerance=0
-00020580: 2e31 293a 0a20 2020 2020 2020 2027 2727  .1):.        '''
-00020590: 0a20 2020 2020 2020 2045 6e73 7572 6520  .        Ensure 
-000205a0: 7468 6174 2074 6865 206d 6173 6b20 766f  that the mask vo
-000205b0: 7865 6c20 7369 7a65 7320 6f66 203c 7365  xel sizes of <se
-000205c0: 6c66 3e20 616e 6420 3c6f 7468 6572 3e20  lf> and <other> 
-000205d0: 6d61 7463 682e 0a0a 2020 2020 2020 2020  match...        
-000205e0: 5468 6520 6d61 736b 2076 6f78 656c 5f73  The mask voxel_s
-000205f0: 697a 6573 2066 6f72 2062 6f74 6820 6d61  izes for both ma
-00020600: 7920 6f70 7469 6f6e 616c 6c79 2062 6520  y optionally be 
-00020610: 7365 7420 746f 2061 206e 6577 0a20 2020  set to a new.   
-00020620: 2020 2020 2063 6f6d 6d6f 6e20 7661 6c75       common valu
-00020630: 652e 0a0a 2020 2020 2020 2020 2a2a 5061  e...        **Pa
-00020640: 7261 6d74 6572 733a 2a2a 0a0a 2020 2020  ramters:**..    
-00020650: 2020 2020 6f74 6865 7220 3a20 736b 7274      other : skrt
-00020660: 2e73 7472 7563 7475 7265 732e 524f 490a  .structures.ROI.
-00020670: 2020 2020 2020 2020 2020 2020 524f 4920              ROI 
-00020680: 7769 7468 2077 6869 6368 2076 6f78 656c  with which voxel
-00020690: 2073 697a 6520 6973 2074 6f20 6265 206d   size is to be m
-000206a0: 6174 6368 6564 2e0a 0a20 2020 2020 2020  atched...       
-000206b0: 2076 6f78 656c 5f73 697a 6520 3a20 7475   voxel_size : tu
-000206c0: 706c 652c 2064 6566 6175 6c74 3d4e 6f6e  ple, default=Non
-000206d0: 650a 2020 2020 2020 2020 2020 2020 566f  e.            Vo
-000206e0: 7865 6c20 7369 7a65 2028 6478 2c20 6479  xel size (dx, dy
-000206f0: 2c20 647a 2920 696e 206d 6d20 746f 2062  , dz) in mm to b
-00020700: 6520 7573 6564 2066 6f72 2052 4f49 206d  e used for ROI m
-00020710: 6173 6b73 0a20 2020 2020 2020 2020 2020  asks.           
-00020720: 2066 726f 6d20 7768 6963 6820 746f 2063   from which to c
-00020730: 616c 6375 6c61 7465 2073 7572 6661 6365  alculate surface
-00020740: 2064 6973 7461 6e63 6573 2e20 2049 6620   distances.  If 
-00020750: 4e6f 6e65 2c0a 2020 2020 2020 2020 2020  None,.          
-00020760: 2020 7468 6520 6d61 736b 2076 6f78 656c    the mask voxel
-00020770: 2073 697a 6520 6f66 203c 6f74 6865 723e   size of <other>
-00020780: 2069 7320 7573 6564 2069 6620 6e6f 7420   is used if not 
-00020790: 4e6f 6e65 3b0a 2020 2020 2020 2020 2020  None;.          
-000207a0: 2020 6f74 6865 7277 6973 6520 7468 6520    otherwise the 
-000207b0: 6465 6661 756c 7420 766f 7865 6c20 7369  default voxel si
-000207c0: 7a65 2066 6f72 2064 756d 6d79 2069 6d61  ze for dummy ima
-000207d0: 6765 732c 0a20 2020 2020 2020 2020 2020  ges,.           
-000207e0: 206e 616d 656c 7920 2831 2c20 312c 2031   namely (1, 1, 1
-000207f0: 292c 2069 7320 7573 6564 2e20 2049 6620  ), is used.  If 
-00020800: 616e 2065 6c65 6d65 6e74 206f 6620 7468  an element of th
-00020810: 650a 2020 2020 2020 2020 2020 2020 7475  e.            tu
-00020820: 706c 6520 7370 6563 6966 7969 6e67 2076  ple specifying v
-00020830: 6f78 656c 2073 697a 6520 6973 204e 6f6e  oxel size is Non
-00020840: 652c 2074 6865 2076 616c 7565 2066 6f72  e, the value for
-00020850: 0a20 2020 2020 2020 2020 2020 2074 6865  .            the
-00020860: 2063 6f72 7265 7370 6f6e 6469 6e67 2065   corresponding e
-00020870: 6c65 6d65 6e74 206f 6620 7468 6520 6d61  lement of the ma
-00020880: 736b 2076 6f78 656c 2073 697a 6520 6f66  sk voxel size of
-00020890: 0a20 2020 2020 2020 2020 2020 203c 6f74  .            <ot
-000208a0: 6865 723e 2069 7320 7573 6564 2e0a 0a20  her> is used... 
-000208b0: 2020 2020 2020 2076 6f78 656c 5f64 696d         voxel_dim
-000208c0: 5f74 6f6c 6572 616e 6365 203a 2066 6c6f  _tolerance : flo
-000208d0: 6174 2c20 6465 6661 756c 743d 302e 310a  at, default=0.1.
-000208e0: 2020 2020 2020 2020 2020 2020 4d61 7869              Maxi
-000208f0: 6d75 6d20 6163 6365 7074 6564 2076 616c  mum accepted val
-00020900: 7565 2066 6f72 2074 6865 2061 6273 6f6c  ue for the absol
-00020910: 7574 6520 6469 6666 6572 656e 6365 2069  ute difference i
-00020920: 6e20 766f 7865 6c20 7369 7a65 0a20 2020  n voxel size.   
-00020930: 2020 2020 2020 2020 2028 616e 7920 6469           (any di
-00020940: 6d65 6e73 696f 6e29 206f 6620 7468 6520  mension) of the 
-00020950: 524f 4920 6d61 736b 7320 666f 7220 7468  ROI masks for th
-00020960: 656d 2074 6f20 6265 2063 6f6e 7369 6465  em to be conside
-00020970: 7265 640a 2020 2020 2020 2020 2020 2020  red.            
-00020980: 6173 2068 6176 696e 6720 7468 6520 7361  as having the sa
-00020990: 6d65 2076 6f78 656c 2073 697a 652e 2020  me voxel size.  
-000209a0: 4966 2061 206e 6567 6174 6976 6520 7661  If a negative va
-000209b0: 6c75 6520 6973 2067 6976 656e 2c0a 2020  lue is given,.  
-000209c0: 2020 2020 2020 2020 2020 7468 6520 6162            the ab
-000209d0: 736f 6c75 7465 2064 6966 6665 7265 6e63  solute differenc
-000209e0: 6520 6973 206e 6576 6572 2062 656c 6f77  e is never below
-000209f0: 2074 6869 732c 2066 6f72 6369 6e67 2063   this, forcing c
-00020a00: 7265 6174 696f 6e0a 2020 2020 2020 2020  reation.        
-00020a10: 2020 2020 6f66 206e 6577 206d 6173 6b73      of new masks
-00020a20: 2077 6974 6820 7468 6520 7468 6520 7370   with the the sp
-00020a30: 6563 6966 6965 6420 766f 7865 6c20 7369  ecified voxel si
-00020a40: 7a65 2e20 2054 6869 7320 6361 6e20 6265  ze.  This can be
-00020a50: 0a20 2020 2020 2020 2020 2020 2075 7365  .            use
-00020a60: 6675 6c20 666f 7220 6f62 7461 696e 696e  ful for obtainin
-00020a70: 6720 6d61 736b 7320 7468 6174 2061 7265  g masks that are
-00020a80: 206a 7573 7420 6c61 7267 6520 656e 6f75   just large enou
-00020a90: 6768 2074 6f20 636f 6e74 6169 6e0a 2020  gh to contain.  
-00020aa0: 2020 2020 2020 2020 2020 626f 7468 2052            both R
-00020ab0: 4f49 732c 2070 6f74 656e 7469 616c 6c79  OIs, potentially
-00020ac0: 2072 6564 7563 696e 6720 7468 6520 7469   reducing the ti
-00020ad0: 6d65 2066 6f72 2073 7572 6661 6365 2d64  me for surface-d
-00020ae0: 6973 7461 6e63 650a 2020 2020 2020 2020  istance.        
-00020af0: 2020 2020 6361 6c63 756c 6174 696f 6e73      calculations
-00020b00: 2e0a 2020 2020 2020 2020 2727 270a 2020  ..        '''.  
-00020b10: 2020 2020 2020 2320 4372 6561 7465 2052        # Create R
-00020b20: 4f49 2063 6c6f 6e65 732c 2066 6f72 2077  OI clones, for w
-00020b30: 6869 6368 2076 6f78 656c 2073 697a 6573  hich voxel sizes
-00020b40: 206d 6179 2062 6520 616c 7465 7265 642e   may be altered.
-00020b50: 0a20 2020 2020 2020 2072 6f69 3120 3d20  .        roi1 = 
-00020b60: 7365 6c66 2e63 6c6f 6e65 2829 0a20 2020  self.clone().   
-00020b70: 2020 2020 2072 6f69 3220 3d20 6f74 6865       roi2 = othe
-00020b80: 722e 636c 6f6e 6528 290a 0a20 2020 2020  r.clone()..     
-00020b90: 2020 2023 2041 7373 6f63 6961 7465 206e     # Associate n
-00020ba0: 6577 2064 756d 6d79 2069 6d61 6765 2077  ew dummy image w
-00020bb0: 6974 6820 524f 4973 2069 6620 7265 7175  ith ROIs if requ
-00020bc0: 6573 7465 6420 766f 7865 6c20 7369 7a65  ested voxel size
-00020bd0: 0a20 2020 2020 2020 2023 2069 7320 6469  .        # is di
-00020be0: 6666 6572 656e 7420 6672 6f6d 2076 6f78  fferent from vox
-00020bf0: 656c 2073 697a 6520 6f66 2065 6974 6865  el size of eithe
-00020c00: 7220 6375 7272 656e 7420 696d 6167 652c  r current image,
-00020c10: 0a20 2020 2020 2020 2023 206f 7220 6966  .        # or if
-00020c20: 2061 6273 6f6c 7574 6520 6469 6666 6572   absolute differ
-00020c30: 656e 6365 2069 6e20 616e 7920 6469 6d65  ence in any dime
-00020c40: 6e73 696f 6e20 6265 7477 6565 6e20 766f  nsion between vo
-00020c50: 7865 6c20 7369 7a65 730a 2020 2020 2020  xel sizes.      
-00020c60: 2020 2320 6f66 2063 7572 7265 6e74 2069    # of current i
-00020c70: 6d61 6765 7320 646f 6e27 7420 6d61 7463  mages don't matc
-00020c80: 6820 6973 2067 7265 6174 6572 2074 6861  h is greater tha
-00020c90: 6e20 746f 6c65 7261 6e63 652e 0a20 2020  n tolerance..   
-00020ca0: 2020 2020 2076 6f78 656c 5f73 697a 6520       voxel_size 
-00020cb0: 3d20 766f 7865 6c5f 7369 7a65 2069 6620  = voxel_size if 
-00020cc0: 766f 7865 6c5f 7369 7a65 2065 6c73 6520  voxel_size else 
-00020cd0: 726f 6932 2e67 6574 5f76 6f78 656c 5f73  roi2.get_voxel_s
-00020ce0: 697a 6528 290a 2020 2020 2020 2020 6966  ize().        if
-00020cf0: 2076 6f78 656c 5f73 697a 6520 616e 6420   voxel_size and 
-00020d00: 726f 6932 2e67 6574 5f76 6f78 656c 5f73  roi2.get_voxel_s
-00020d10: 697a 6528 293a 0a20 2020 2020 2020 2020  ize():.         
-00020d20: 2020 2076 6f78 656c 5f73 697a 6520 3d20     voxel_size = 
-00020d30: 5b76 6f78 656c 5f73 697a 655b 6964 785d  [voxel_size[idx]
-00020d40: 2069 6620 766f 7865 6c5f 7369 7a65 5b69   if voxel_size[i
-00020d50: 6478 5d20 6973 206e 6f74 204e 6f6e 650a  dx] is not None.
-00020d60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020d70: 2020 2020 656c 7365 2072 6f69 322e 6765      else roi2.ge
-00020d80: 745f 766f 7865 6c5f 7369 7a65 2829 5b69  t_voxel_size()[i
-00020d90: 6478 5d20 666f 7220 6964 7820 696e 2072  dx] for idx in r
-00020da0: 616e 6765 2833 295d 0a20 2020 2020 2020  ange(3)].       
-00020db0: 2072 6573 697a 6520 3d20 6e6f 7420 726f   resize = not ro
-00020dc0: 6931 2e67 6574 5f76 6f78 656c 5f73 697a  i1.get_voxel_siz
-00020dd0: 6528 2920 6f72 206e 6f74 2072 6f69 322e  e() or not roi2.
-00020de0: 6765 745f 766f 7865 6c5f 7369 7a65 2829  get_voxel_size()
-00020df0: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
-00020e00: 7265 7369 7a65 3a0a 2020 2020 2020 2020  resize:.        
-00020e10: 2020 2020 666f 7220 726f 6920 696e 205b      for roi in [
-00020e20: 726f 6931 2c20 726f 6932 5d3a 0a20 2020  roi1, roi2]:.   
-00020e30: 2020 2020 2020 2020 2020 2020 206d 6174               mat
-00020e40: 6368 6573 203d 205b 6478 797a 3120 666f  ches = [dxyz1 fo
-00020e50: 7220 6478 797a 312c 2064 7879 7a32 2069  r dxyz1, dxyz2 i
-00020e60: 6e0a 2020 2020 2020 2020 2020 2020 2020  n.              
-00020e70: 2020 2020 2020 2020 2020 7a69 7028 766f            zip(vo
-00020e80: 7865 6c5f 7369 7a65 2c20 726f 692e 766f  xel_size, roi.vo
-00020e90: 7865 6c5f 7369 7a65 290a 2020 2020 2020  xel_size).      
-00020ea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020eb0: 2020 6966 2061 6273 2864 7879 7a31 202d    if abs(dxyz1 -
-00020ec0: 2064 7879 7a32 2920 3c20 766f 7865 6c5f   dxyz2) < voxel_
-00020ed0: 6469 6d5f 746f 6c65 7261 6e63 655d 0a20  dim_tolerance]. 
-00020ee0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00020ef0: 6620 3320 213d 206c 656e 286d 6174 6368  f 3 != len(match
-00020f00: 6573 293a 0a20 2020 2020 2020 2020 2020  es):.           
-00020f10: 2020 2020 2020 2020 2072 6573 697a 6520           resize 
-00020f20: 3d20 5472 7565 0a20 2020 2020 2020 2069  = True.        i
-00020f30: 6620 7265 7369 7a65 3a0a 2020 2020 2020  f resize:.      
-00020f40: 2020 2020 2020 6966 2076 6f78 656c 5f73        if voxel_s
-00020f50: 697a 653a 0a20 2020 2020 2020 2020 2020  ize:.           
-00020f60: 2020 2020 2073 6c69 6365 5f74 6869 636b       slice_thick
-00020f70: 6e65 7373 203d 2076 6f78 656c 5f73 697a  ness = voxel_siz
-00020f80: 655b 325d 0a20 2020 2020 2020 2020 2020  e[2].           
-00020f90: 2020 2020 2076 6f78 656c 5f73 697a 655f       voxel_size_
-00020fa0: 3264 203d 2076 6f78 656c 5f73 697a 655b  2d = voxel_size[
-00020fb0: 3a32 5d0a 2020 2020 2020 2020 2020 2020  :2].            
-00020fc0: 2020 2020 2320 456e 7375 7265 2074 6861      # Ensure tha
-00020fd0: 7420 696e 6974 6961 6c20 766f 7865 6c20  t initial voxel 
-00020fe0: 7369 7a65 2069 7320 7365 742e 0a20 2020  size is set..   
-00020ff0: 2020 2020 2020 2020 2020 2020 2023 2054               # T
-00021000: 6869 7320 6973 2075 7365 6420 746f 2064  his is used to d
-00021010: 6566 696e 6520 736c 6963 6520 7468 6963  efine slice thic
-00021020: 6b6e 6573 730a 2020 2020 2020 2020 2020  kness.          
-00021030: 2020 2020 2020 2320 666f 7220 616e 2052        # for an R
-00021040: 4f49 2074 6861 7420 6861 7320 6e6f 2061  OI that has no a
-00021050: 7373 6f63 6961 7465 6420 696d 6167 652c  ssociated image,
-00021060: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00021070: 2023 2061 6e64 2069 7320 6465 6669 6e65   # and is define
-00021080: 6420 6279 206f 6e65 206f 7220 6d6f 7265  d by one or more
-00021090: 2063 6f6e 746f 7572 7320 6f6e 2061 2073   contours on a s
-000210a0: 696e 676c 650a 2020 2020 2020 2020 2020  ingle.          
-000210b0: 2020 2020 2020 2320 696d 6167 6520 736c        # image sl
-000210c0: 6963 652e 0a20 2020 2020 2020 2020 2020  ice..           
-000210d0: 2020 2020 2069 6620 6e6f 7420 726f 6931       if not roi1
-000210e0: 2e76 6f78 656c 5f73 697a 653a 0a20 2020  .voxel_size:.   
-000210f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021100: 2072 6f69 312e 766f 7865 6c5f 7369 7a65   roi1.voxel_size
-00021110: 203d 2076 6f78 656c 5f73 697a 650a 2020   = voxel_size.  
-00021120: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00021130: 206e 6f74 2072 6f69 322e 766f 7865 6c5f   not roi2.voxel_
-00021140: 7369 7a65 3a0a 2020 2020 2020 2020 2020  size:.          
-00021150: 2020 2020 2020 2020 2020 726f 6932 2e76            roi2.v
-00021160: 6f78 656c 5f73 697a 6520 3d20 766f 7865  oxel_size = voxe
-00021170: 6c5f 7369 7a65 0a20 2020 2020 2020 2020  l_size.         
-00021180: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00021190: 2020 2020 2020 2020 2073 6c69 6365 5f74           slice_t
-000211a0: 6869 636b 6e65 7373 203d 204e 6f6e 650a  hickness = None.
-000211b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000211c0: 766f 7865 6c5f 7369 7a65 5f32 6420 3d20  voxel_size_2d = 
-000211d0: 4e6f 6e65 0a0a 2020 2020 2020 2020 2020  None..          
-000211e0: 2020 5374 7275 6374 7572 6553 6574 285b    StructureSet([
-000211f0: 726f 6931 2c20 726f 6932 5d29 2e73 6574  roi1, roi2]).set
-00021200: 5f69 6d61 6765 5f74 6f5f 6475 6d6d 7928  _image_to_dummy(
-00021210: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00021220: 2020 2020 2073 6c69 6365 5f74 6869 636b       slice_thick
-00021230: 6e65 7373 3d73 6c69 6365 5f74 6869 636b  ness=slice_thick
-00021240: 6e65 7373 2c20 766f 7865 6c5f 7369 7a65  ness, voxel_size
-00021250: 3d76 6f78 656c 5f73 697a 655f 3264 290a  =voxel_size_2d).
-00021260: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00021270: 2872 6f69 312c 2072 6f69 3229 0a0a 2020  (roi1, roi2)..  
-00021280: 2020 6465 6620 6765 745f 7375 7266 6163    def get_surfac
-00021290: 655f 6469 7374 616e 6365 7328 0a20 2020  e_distances(.   
-000212a0: 2020 2020 2073 656c 662c 0a20 2020 2020       self,.     
-000212b0: 2020 206f 7468 6572 2c0a 2020 2020 2020     other,.      
-000212c0: 2020 7369 6e67 6c65 5f73 6c69 6365 3d46    single_slice=F
-000212d0: 616c 7365 2c0a 2020 2020 2020 2020 7369  alse,.        si
-000212e0: 676e 6564 3d46 616c 7365 2c0a 2020 2020  gned=False,.    
-000212f0: 2020 2020 7669 6577 3d22 782d 7922 2c0a      view="x-y",.
-00021300: 2020 2020 2020 2020 736c 3d4e 6f6e 652c          sl=None,
-00021310: 0a20 2020 2020 2020 2069 6478 3d4e 6f6e  .        idx=Non
-00021320: 652c 0a20 2020 2020 2020 2070 6f73 3d4e  e,.        pos=N
-00021330: 6f6e 652c 0a20 2020 2020 2020 2063 6f6e  one,.        con
-00021340: 6e65 6374 6976 6974 793d 322c 0a20 2020  nectivity=2,.   
-00021350: 2020 2020 2066 6c61 7474 656e 3d46 616c       flatten=Fal
-00021360: 7365 2c0a 2020 2020 2020 2020 7379 6d6d  se,.        symm
-00021370: 6574 7269 633d 4e6f 6e65 2c0a 2020 2020  etric=None,.    
-00021380: 2020 2020 636f 6e66 6f72 6d69 7479 3d46      conformity=F
-00021390: 616c 7365 2c0a 2020 2020 2020 2020 696e  alse,.        in
-000213a0: 5f73 6c69 6365 3d54 7275 652c 0a20 2020  _slice=True,.   
-000213b0: 2020 2020 2076 6f78 656c 5f73 697a 653d       voxel_size=
-000213c0: 4e6f 6e65 2c0a 2020 2020 2020 2020 766f  None,.        vo
-000213d0: 7865 6c5f 6469 6d5f 746f 6c65 7261 6e63  xel_dim_toleranc
-000213e0: 653d 302e 312c 0a20 2020 2029 3a0a 2020  e=0.1,.    ):.  
-000213f0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-00021400: 2020 4765 7420 7665 6374 6f72 206f 6620    Get vector of 
-00021410: 7375 7266 6163 6520 6469 7374 616e 6365  surface distance
-00021420: 7320 6265 7477 6565 6e20 7477 6f20 524f  s between two RO
-00021430: 4973 2e0a 0a20 2020 2020 2020 2053 7572  Is...        Sur
-00021440: 6661 6365 2064 6973 7461 6e63 6573 206d  face distances m
-00021450: 6179 2062 6520 7369 676e 6564 206f 7220  ay be signed or 
-00021460: 756e 7369 676e 6564 2c20 616e 6420 6d61  unsigned, and ma
-00021470: 7920 6265 2066 6f72 2061 2073 696e 676c  y be for a singl
-00021480: 650a 2020 2020 2020 2020 736c 6963 6520  e.        slice 
-00021490: 7468 726f 7567 6820 7468 6520 524f 4973  through the ROIs
-000214a0: 2c20 6f72 2066 6f72 2074 6865 2033 4420  , or for the 3D 
-000214b0: 766f 6c75 6d65 732e 2020 0a0a 2020 2020  volumes.  ..    
-000214c0: 2020 2020 5468 6973 2066 756e 6374 696f      This functio
-000214d0: 6e20 7573 6573 2069 6465 6173 206f 7574  n uses ideas out
-000214e0: 6c69 6e65 6420 6174 3a0a 2020 2020 2020  lined at:.      
-000214f0: 2020 6874 7470 733a 2f2f 6d6c 6e6f 7465    https://mlnote
-00021500: 626f 6f6b 2e67 6974 6875 622e 696f 2f70  book.github.io/p
-00021510: 6f73 742f 7375 7266 6163 652d 6469 7374  ost/surface-dist
-00021520: 616e 6365 2d66 756e 6374 696f 6e2f 0a0a  ance-function/..
-00021530: 2020 2020 2020 2020 2a2a 5061 7261 6d65          **Parame
-00021540: 7465 7273 3a2a 2a0a 0a20 2020 2020 2020  ters:**..       
-00021550: 2073 696e 676c 655f 736c 6963 6520 3a20   single_slice : 
-00021560: 626f 6f6c 2c20 6465 6661 756c 743d 4661  bool, default=Fa
-00021570: 6c73 650a 2020 2020 2020 2020 2020 2020  lse.            
-00021580: 4966 2046 616c 7365 2c20 7265 7475 726e  If False, return
-00021590: 2073 7572 6661 6365 2064 6973 7461 6e63   surface distanc
-000215a0: 6573 2072 656c 6174 6976 6520 746f 2033  es relative to 3
-000215b0: 4420 766f 6c75 6d65 732e 0a20 2020 2020  D volumes..     
-000215c0: 2020 2020 2020 204f 7468 6572 7769 7365         Otherwise
-000215d0: 2c20 7265 7475 726e 2073 7572 6661 6365  , return surface
-000215e0: 2064 6973 7461 6e63 6573 2066 6f72 2061   distances for a
-000215f0: 2073 696e 676c 6520 696d 6167 6520 736c   single image sl
-00021600: 6963 652e 0a0a 2020 2020 2020 2020 7369  ice...        si
-00021610: 676e 6564 203a 2062 6f6f 6c2c 2064 6566  gned : bool, def
-00021620: 6175 6c74 3d46 616c 7365 0a20 2020 2020  ault=False.     
-00021630: 2020 2020 2020 2049 6620 4661 6c73 652c         If False,
-00021640: 2072 6574 7572 6e20 6162 736f 6c75 7465   return absolute
-00021650: 2073 7572 6661 6365 2064 6973 7461 6e63   surface distanc
-00021660: 6573 2e0a 2020 2020 2020 2020 2020 2020  es..            
-00021670: 4966 2054 7275 652c 2072 6574 7572 6e20  If True, return 
-00021680: 7369 676e 6564 2073 7572 6661 6365 2064  signed surface d
-00021690: 6973 7461 6e63 6573 2e20 2041 2070 6f69  istances.  A poi
-000216a0: 6e74 206f 6e20 7468 650a 2020 2020 2020  nt on the.      
-000216b0: 2020 2020 2020 7375 7266 6163 6520 6f66        surface of
-000216c0: 203c 6f74 6865 723e 2069 7320 7461 6b65   <other> is take
-000216d0: 6e20 746f 2062 6520 6174 2061 2070 6f73  n to be at a pos
-000216e0: 6974 6976 6520 6469 7374 616e 6365 2069  itive distance i
-000216f0: 660a 2020 2020 2020 2020 2020 2020 6f75  f.            ou
-00021700: 7473 6964 6520 3c73 656c 663e 2c20 616e  tside <self>, an
-00021710: 6420 6174 2061 206e 6567 6174 6976 6520  d at a negative 
-00021720: 6469 7374 616e 6365 2069 6620 696e 7369  distance if insi
-00021730: 6465 2e0a 0a20 2020 2020 2020 2076 6965  de...        vie
-00021740: 7720 3a20 7374 722c 2064 6566 6175 6c74  w : str, default
-00021750: 3d22 782d 7922 0a20 2020 2020 2020 2020  ="x-y".         
-00021760: 2020 204f 7269 656e 7461 7469 6f6e 206f     Orientation o
-00021770: 6620 736c 6963 6520 666f 7220 7768 6963  f slice for whic
-00021780: 6820 746f 206f 6274 6169 6e20 7375 7266  h to obtain surf
-00021790: 6163 6520 6469 7374 616e 6365 732e 0a20  ace distances.. 
-000217a0: 2020 2020 2020 2020 2020 204f 6e6c 7920             Only 
-000217b0: 7573 6564 2069 6620 6569 7468 6572 203c  used if either <
-000217c0: 7369 6e67 6c65 5f73 6c69 6365 3e20 6f72  single_slice> or
-000217d0: 203c 666c 6174 7465 6e3e 2069 7320 5472   <flatten> is Tr
-000217e0: 7565 2e0a 0a20 2020 2020 2020 2073 6c20  ue...        sl 
-000217f0: 3a20 696e 742c 2064 6566 6175 6c74 3d4e  : int, default=N
-00021800: 6f6e 650a 2020 2020 2020 2020 2020 2020  one.            
-00021810: 536c 6963 6520 6e75 6d62 6572 2e20 4966  Slice number. If
-00021820: 206e 6f6e 6520 6f66 203c 736c 3e2c 203c   none of <sl>, <
-00021830: 6964 783e 206f 7220 3c70 6f73 3e20 6973  idx> or <pos> is
-00021840: 2073 7570 706c 6965 6420 6275 740a 2020   supplied but.  
-00021850: 2020 2020 2020 2020 2020 3c73 696e 676c            <singl
-00021860: 655f 736c 6963 653e 2069 7320 5472 7565  e_slice> is True
-00021870: 2c20 7468 6520 6365 6e74 7261 6c20 736c  , the central sl
-00021880: 6963 6520 6f66 2074 6865 2052 4f49 2077  ice of the ROI w
-00021890: 696c 6c20 6265 2075 7365 642e 0a0a 2020  ill be used...  
-000218a0: 2020 2020 2020 6964 7820 3a20 696e 742c        idx : int,
-000218b0: 2064 6566 6175 6c74 3d4e 6f6e 650a 2020   default=None.  
-000218c0: 2020 2020 2020 2020 2020 4172 7261 7920            Array 
-000218d0: 696e 6465 7820 6f66 2073 6c69 6365 2e20  index of slice. 
-000218e0: 4966 206e 6f6e 6520 6f66 203c 736c 3e2c  If none of <sl>,
-000218f0: 203c 6964 783e 206f 7220 3c70 6f73 3e20   <idx> or <pos> 
-00021900: 6973 200a 2020 2020 2020 2020 2020 2020  is .            
-00021910: 7375 7070 6c69 6564 2062 7574 203c 7369  supplied but <si
-00021920: 6e67 6c65 5f73 6c69 6365 3e20 6973 2054  ngle_slice> is T
-00021930: 7275 652c 2074 6865 2063 656e 7472 616c  rue, the central
-00021940: 2073 6c69 6365 206f 660a 2020 2020 2020   slice of.      
-00021950: 2020 2020 2020 7468 6520 524f 4920 7769        the ROI wi
-00021960: 6c6c 2062 6520 7573 6564 2e0a 0a20 2020  ll be used...   
-00021970: 2020 2020 2070 6f73 203a 2066 6c6f 6174       pos : float
-00021980: 2c20 6465 6661 756c 743d 4e6f 6e65 0a20  , default=None. 
-00021990: 2020 2020 2020 2020 2020 2053 6c69 6365             Slice
-000219a0: 2070 6f73 6974 696f 6e20 696e 206d 6d2e   position in mm.
-000219b0: 2049 6620 6e6f 6e65 206f 6620 3c73 6c3e   If none of <sl>
-000219c0: 2c20 3c69 6478 3e20 6f72 203c 706f 733e  , <idx> or <pos>
-000219d0: 2069 7320 7375 7070 6c69 6564 0a20 2020   is supplied.   
-000219e0: 2020 2020 2020 2020 2062 7574 203c 7369           but <si
-000219f0: 6e67 6c65 5f73 6c69 6365 3e20 6973 2054  ngle_slice> is T
-00021a00: 7275 652c 2074 6865 2063 656e 7472 616c  rue, the central
-00021a10: 2073 6c69 6365 206f 6620 7468 6520 524f   slice of the RO
-00021a20: 4920 7769 6c6c 0a20 2020 2020 2020 2020  I will.         
-00021a30: 2020 2062 6520 7573 6564 2e0a 0a20 2020     be used...   
-00021a40: 2020 2020 2063 6f6e 6e65 6374 6976 6974       connectivit
-00021a50: 793a 2069 6e74 2c20 6465 6661 756c 743d  y: int, default=
-00021a60: 320a 2020 2020 2020 2020 2020 2020 496e  2.            In
-00021a70: 7465 6765 7220 6465 6669 6e69 6e67 2077  teger defining w
-00021a80: 6869 6368 2076 6f78 656c 7320 746f 2063  hich voxels to c
-00021a90: 6f6e 7369 6465 7220 6173 206e 6569 6768  onsider as neigh
-00021aa0: 626f 7572 730a 2020 2020 2020 2020 2020  bours.          
-00021ab0: 2020 7768 656e 2070 6572 666f 726d 696e    when performin
-00021ac0: 6720 6572 6f73 696f 6e20 6f70 6572 6174  g erosion operat
-00021ad0: 696f 6e20 746f 2069 6465 6e74 6966 7920  ion to identify 
-00021ae0: 524f 4920 7375 7266 6163 6573 2e20 2054  ROI surfaces.  T
-00021af0: 6869 730a 2020 2020 2020 2020 2020 2020  his.            
-00021b00: 6973 2070 6173 7365 6420 6173 203c 636f  is passed as <co
-00021b10: 6e6e 6563 7469 7669 7479 3e20 7061 7261  nnectivity> para
-00021b20: 6d65 7465 7220 746f 3a0a 2020 2020 2020  meter to:.      
-00021b30: 2020 2020 2020 7363 6970 792e 6e64 696d        scipy.ndim
-00021b40: 6167 652e 6765 6e65 7261 7465 5f62 696e  age.generate_bin
-00021b50: 6172 795f 7374 7275 6374 7572 650a 2020  ary_structure.  
-00021b60: 2020 2020 2020 2020 2020 466f 7220 6675            For fu
-00021b70: 7274 6865 7220 6465 7461 696c 732c 2073  rther details, s
-00021b80: 6565 3a0a 2020 2020 2020 2020 2020 2020  ee:.            
-00021b90: 6874 7470 733a 2f2f 646f 6373 2e73 6369  https://docs.sci
-00021ba0: 7079 2e6f 7267 2f64 6f63 2f73 6369 7079  py.org/doc/scipy
-00021bb0: 2f72 6566 6572 656e 6365 2f67 656e 6572  /reference/gener
-00021bc0: 6174 6564 2f73 6369 7079 2e6e 6469 6d61  ated/scipy.ndima
-00021bd0: 6765 2e67 656e 6572 6174 655f 6269 6e61  ge.generate_bina
-00021be0: 7279 5f73 7472 7563 7475 7265 2e68 746d  ry_structure.htm
-00021bf0: 6c0a 0a20 2020 2020 2020 2066 6c61 7474  l..        flatt
-00021c00: 656e 203a 2062 6f6f 6c2c 2064 6566 6175  en : bool, defau
-00021c10: 6c74 3d46 616c 7365 0a20 2020 2020 2020  lt=False.       
-00021c20: 2020 2020 2049 6620 5472 7565 2c20 616c       If True, al
-00021c30: 6c20 736c 6963 6573 2066 6f72 2065 6163  l slices for eac
-00021c40: 6820 524f 4920 7769 6c6c 2062 6520 666c  h ROI will be fl
-00021c50: 6174 7465 6e65 6420 696e 2074 6865 2067  attened in the g
-00021c60: 6976 656e 0a20 2020 2020 2020 2020 2020  iven.           
-00021c70: 206f 7269 656e 7461 7469 6f6e 2c20 616e   orientation, an
-00021c80: 6420 7375 7266 6163 6520 6469 7374 616e  d surface distan
-00021c90: 6365 7320 7265 6c61 7469 7665 2074 6f20  ces relative to 
-00021ca0: 7468 6520 666c 6174 7465 6e65 640a 2020  the flattened.  
-00021cb0: 2020 2020 2020 2020 2020 736c 6963 6520            slice 
-00021cc0: 7769 6c6c 2062 6520 7265 7475 726e 6564  will be returned
-00021cd0: 2e0a 0a20 2020 2020 2020 2073 796d 6d65  ...        symme
-00021ce0: 7472 6963 203a 2062 6f6f 6c2c 2064 6566  tric : bool, def
-00021cf0: 6175 6c74 3d4e 6f6e 650a 2020 2020 2020  ault=None.      
-00021d00: 2020 2020 2020 4966 2054 7275 652c 2074        If True, t
-00021d10: 6865 2064 6973 7461 6e63 6573 2072 6574  he distances ret
-00021d20: 7572 6e65 6420 6172 6520 6672 6f6d 2074  urned are from t
-00021d30: 6865 2073 7572 6661 6365 206f 6620 3c6f  he surface of <o
-00021d40: 7468 6572 3e0a 2020 2020 2020 2020 2020  ther>.          
-00021d50: 2020 746f 2074 6865 2073 7572 6661 6365    to the surface
-00021d60: 206f 6620 3c73 656c 663e 2061 6e64 2066   of <self> and f
-00021d70: 726f 6d20 7468 6520 7375 7266 6163 6520  rom the surface 
-00021d80: 6f66 203c 7365 6c66 3e20 746f 2074 6865  of <self> to the
-00021d90: 0a20 2020 2020 2020 2020 2020 2073 7572  .            sur
-00021da0: 6661 6365 206f 6620 3c6f 7468 6572 3e2e  face of <other>.
-00021db0: 2020 4966 2046 616c 7365 2c20 6469 7374    If False, dist
-00021dc0: 616e 6365 7320 6172 6520 6672 6f6d 2074  ances are from t
-00021dd0: 6865 2073 7572 6661 6365 0a20 2020 2020  he surface.     
-00021de0: 2020 2020 2020 206f 6620 3c6f 7468 6572         of <other
-00021df0: 3e20 746f 2074 6865 2073 7572 6661 6365  > to the surface
-00021e00: 206f 6620 3c73 656c 663e 206f 6e6c 792e   of <self> only.
-00021e10: 2020 4966 204e 6f6e 652c 2073 6574 2074    If None, set t
-00021e20: 6f0a 2020 2020 2020 2020 2020 2020 7468  o.            th
-00021e30: 6520 6f70 706f 7369 7374 6520 6f66 203c  e opposiste of <
-00021e40: 7369 676e 6564 3e2e 0a0a 2020 2020 2020  signed>...      
-00021e50: 2020 2063 6f6e 666f 726d 6974 7920 3a20     conformity : 
-00021e60: 626f 6f6c 2c20 6465 6661 756c 743d 4661  bool, default=Fa
-00021e70: 6c73 650a 2020 2020 2020 2020 2020 2020  lse.            
-00021e80: 2049 6620 5472 7565 2c20 6469 7374 616e   If True, distan
-00021e90: 6365 7320 7265 7475 726e 6564 2061 7265  ces returned are
-00021ea0: 2073 6967 6e65 6420 6469 7374 616e 6365   signed distance
-00021eb0: 7320 746f 2063 6f6e 666f 726d 6974 792c  s to conformity,
-00021ec0: 0a20 2020 2020 2020 2020 2020 2020 6173  .             as
-00021ed0: 2064 6566 696e 6564 2069 6e3a 0a20 2020   defined in:.   
-00021ee0: 2020 2020 2020 2020 2020 6874 7470 733a            https:
-00021ef0: 2f2f 646f 692e 6f72 672f 3130 2e31 3235  //doi.org/10.125
-00021f00: 392f 626a 722f 3237 3637 3435 3831 0a20  9/bjr/27674581. 
-00021f10: 2020 2020 2020 2020 2020 2020 496e 2074              In t
-00021f20: 6869 7320 6361 7365 2c20 7468 6520 7661  his case, the va
-00021f30: 6c75 6573 206f 6620 3c73 6967 6e65 643e  lues of <signed>
-00021f40: 2061 6e64 203c 7379 6d6d 6574 7269 633e   and <symmetric>
-00021f50: 0a20 2020 2020 2020 2020 2020 2020 6172  .             ar
-00021f60: 6520 6469 7372 6567 6172 6465 642e 0a0a  e disregarded...
-00021f70: 2020 2020 2020 2020 696e 5f73 6c69 6365          in_slice
-00021f80: 203a 2062 6f6f 6c2c 2064 6566 6175 6c74   : bool, default
-00021f90: 3d54 7275 650a 2020 2020 2020 2020 2020  =True.          
-00021fa0: 2020 4966 2054 7275 652c 206f 6e6c 7920    If True, only 
-00021fb0: 696e 7472 612d 736c 6963 6520 636f 6e6e  intra-slice conn
-00021fc0: 6563 7469 7669 7479 2069 7320 636f 6e73  ectivity is cons
-00021fd0: 6964 6572 6564 2077 6865 6e0a 2020 2020  idered when.    
-00021fe0: 2020 2020 2020 2020 7065 7266 6f72 6d69          performi
-00021ff0: 6e67 2065 726f 7369 6f6e 2074 6f20 6964  ng erosion to id
-00022000: 656e 7469 6679 2052 4f49 2073 7572 6661  entify ROI surfa
-00022010: 6365 732e 0a0a 2020 2020 2020 2020 766f  ces...        vo
-00022020: 7865 6c5f 7369 7a65 203a 2074 7570 6c65  xel_size : tuple
-00022030: 2c20 6465 6661 756c 743d 4e6f 6e65 0a20  , default=None. 
-00022040: 2020 2020 2020 2020 2020 2056 6f78 656c             Voxel
-00022050: 2073 697a 6520 2864 782c 2064 792c 2064   size (dx, dy, d
-00022060: 7a29 2069 6e20 6d6d 2074 6f20 6265 2075  z) in mm to be u
-00022070: 7365 6420 666f 7220 524f 4920 6d61 736b  sed for ROI mask
-00022080: 730a 2020 2020 2020 2020 2020 2020 6672  s.            fr
-00022090: 6f6d 2077 6869 6368 2074 6f20 6361 6c63  om which to calc
-000220a0: 756c 6174 6520 7375 7266 6163 6520 6469  ulate surface di
-000220b0: 7374 616e 6365 732e 2020 4966 204e 6f6e  stances.  If Non
-000220c0: 652c 0a20 2020 2020 2020 2020 2020 2074  e,.            t
-000220d0: 6865 206d 6173 6b20 766f 7865 6c20 7369  he mask voxel si
-000220e0: 7a65 206f 6620 3c6f 7468 6572 3e20 6973  ze of <other> is
-000220f0: 2075 7365 642e 2020 4966 2061 6e20 696e   used.  If an in
-00022100: 6469 7669 6475 616c 0a20 2020 2020 2020  dividual.       
-00022110: 2020 2020 2065 6c65 6d65 6e74 2069 7320       element is 
-00022120: 4e6f 6e65 2c20 7468 6520 7661 6c75 6520  None, the value 
-00022130: 6f66 2074 6865 2063 6f72 7265 7370 6f6e  of the correspon
-00022140: 6469 6e67 2065 6c65 6d65 6e74 2066 6f72  ding element for
-00022150: 0a20 2020 2020 2020 2020 2020 2074 6865  .            the
-00022160: 206d 6173 6b20 766f 7865 6c20 7369 7a65   mask voxel size
-00022170: 206f 6620 3c6f 7468 6572 3e20 6973 2075   of <other> is u
-00022180: 7365 642e 0a0a 2020 2020 2020 2020 766f  sed...        vo
-00022190: 7865 6c5f 6469 6d5f 746f 6c65 7261 6e63  xel_dim_toleranc
-000221a0: 6520 3a20 666c 6f61 742c 2064 6566 6175  e : float, defau
-000221b0: 6c74 3d30 2e31 0a20 2020 2020 2020 2020  lt=0.1.         
-000221c0: 2020 2054 6f6c 6572 656e 6365 2075 7365     Tolerence use
-000221d0: 6420 7768 656e 2064 6574 6572 6d69 6e69  d when determini
-000221e0: 6e67 2077 6865 7468 6572 203c 766f 7865  ng whether <voxe
-000221f0: 6c5f 7369 7a65 3e20 6973 0a20 2020 2020  l_size> is.     
-00022200: 2020 2020 2020 2064 6966 6665 7265 6e74         different
-00022210: 2066 726f 6d20 7468 6520 766f 7865 6c20   from the voxel 
-00022220: 7369 7a65 206f 6620 7468 6520 696d 6167  size of the imag
-00022230: 6573 2061 7373 6f63 6961 7465 6420 7769  es associated wi
-00022240: 7468 0a20 2020 2020 2020 2020 2020 2065  th.            e
-00022250: 6163 6820 524f 492e 0a20 2020 2020 2020  ach ROI..       
-00022260: 2022 2222 0a0a 2020 2020 2020 2020 2320   """..        # 
-00022270: 5365 7420 7669 6577 2074 6f20 4e6f 6e65  Set view to None
-00022280: 2069 6620 636f 6e73 6964 6572 696e 6720   if considering 
-00022290: 3344 206d 6173 6b2e 0a20 2020 2020 2020  3D mask..       
-000222a0: 2069 6620 6e6f 7420 7369 6e67 6c65 5f73   if not single_s
-000222b0: 6c69 6365 2061 6e64 206e 6f74 2066 6c61  lice and not fla
-000222c0: 7474 656e 3a0a 2020 2020 2020 2020 2020  tten:.          
-000222d0: 2020 7669 6577 203d 204e 6f6e 650a 0a20    view = None.. 
-000222e0: 2020 2020 2020 2023 2053 6574 2074 6f20         # Set to 
-000222f0: 4661 6c73 6520 7061 7261 6d65 7465 7273  False parameters
-00022300: 2074 6861 7420 6172 6520 746f 2062 6520   that are to be 
-00022310: 6967 6e6f 7265 640a 2020 2020 2020 2020  ignored.        
-00022320: 2320 7768 656e 2063 616c 6375 6c61 7469  # when calculati
-00022330: 6e67 2064 6973 7461 6e63 6573 2074 6f20  ng distances to 
-00022340: 636f 6e66 6f72 6d69 7479 2e0a 2020 2020  conformity..    
-00022350: 2020 2020 6966 2063 6f6e 666f 726d 6974      if conformit
-00022360: 793a 0a20 2020 2020 2020 2020 2020 2073  y:.            s
-00022370: 796d 6d65 7472 6963 203d 2073 6967 6e65  ymmetric = signe
-00022380: 6420 3d20 4661 6c73 650a 0a20 2020 2020  d = False..     
-00022390: 2020 2023 2044 6566 6175 6c74 2074 6f20     # Default to 
-000223a0: 7379 6d6d 6574 7269 6320 6f72 206f 6e65  symmetric or one
-000223b0: 2d77 6179 2064 6973 7461 6e63 6573 2c0a  -way distances,.
-000223c0: 2020 2020 2020 2020 2320 6465 7065 6e64          # depend
-000223d0: 696e 6720 6f6e 2077 6865 7468 6572 2064  ing on whether d
-000223e0: 6973 7461 6e63 6573 2061 7265 2073 6967  istances are sig
-000223f0: 6e65 6420 6f72 2075 6e73 6967 6e65 642e  ned or unsigned.
-00022400: 0a20 2020 2020 2020 2069 6620 7379 6d6d  .        if symm
-00022410: 6574 7269 6320 6973 204e 6f6e 653a 0a20  etric is None:. 
-00022420: 2020 2020 2020 2020 2020 2073 796d 6d65             symme
-00022430: 7472 6963 203d 2046 616c 7365 2069 6620  tric = False if 
-00022440: 7369 676e 6564 2069 7320 5472 7565 2065  signed is True e
-00022450: 6c73 6520 5472 7565 0a0a 2020 2020 2020  lse True..      
-00022460: 2020 2320 4f62 7461 696e 2052 4f49 2063    # Obtain ROI c
-00022470: 6c6f 6e65 732c 2077 6974 6820 6d61 736b  lones, with mask
-00022480: 2076 6f78 656c 2073 697a 6573 206d 6174   voxel sizes mat
-00022490: 6368 6564 2074 6f20 766f 7865 6c5f 7369  ched to voxel_si
-000224a0: 7a65 0a20 2020 2020 2020 2023 2069 6620  ze.        # if 
-000224b0: 6e6f 6e2d 6e75 6c6c 2c20 6f72 206f 7468  non-null, or oth
-000224c0: 6572 7769 7365 2074 6f20 7468 6520 6d61  erwise to the ma
-000224d0: 736b 2076 6f78 656c 2073 697a 6520 6f66  sk voxel size of
-000224e0: 206f 7468 6572 2e0a 2020 2020 2020 2020   other..        
-000224f0: 726f 6931 2c20 726f 6932 203d 2073 656c  roi1, roi2 = sel
-00022500: 662e 6d61 7463 685f 6d61 736b 5f76 6f78  f.match_mask_vox
-00022510: 656c 5f73 697a 6528 6f74 6865 722c 2076  el_size(other, v
-00022520: 6f78 656c 5f73 697a 652c 0a20 2020 2020  oxel_size,.     
-00022530: 2020 2020 2020 2020 2020 2076 6f78 656c             voxel
-00022540: 5f64 696d 5f74 6f6c 6572 616e 6365 290a  _dim_tolerance).
-00022550: 0a20 2020 2020 2020 2023 2043 6865 636b  .        # Check
-00022560: 2077 6865 7468 6572 2052 4f49 7320 6172   whether ROIs ar
-00022570: 6520 656d 7074 790a 2020 2020 2020 2020  e empty.        
-00022580: 6966 206e 6f74 206e 702e 616e 7928 726f  if not np.any(ro
-00022590: 6931 2e67 6574 5f6d 6173 6b28 2929 206f  i1.get_mask()) o
-000225a0: 7220 6e6f 7420 6e70 2e61 6e79 2872 6f69  r not np.any(roi
-000225b0: 322e 6765 745f 6d61 736b 2829 293a 0a20  2.get_mask()):. 
-000225c0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-000225d0: 6e0a 0a20 2020 2020 2020 2023 2047 6574  n..        # Get
-000225e0: 2076 6f78 656c 2073 697a 6520 7265 6c61   voxel size rela
-000225f0: 7469 7665 2074 6f20 6178 6573 206f 6620  tive to axes of 
-00022600: 6e75 6d70 7920 6172 7261 792e 0a20 2020  numpy array..   
-00022610: 2020 2020 2076 6f78 656c 5f73 697a 6520       voxel_size 
-00022620: 3d20 726f 6931 2e67 6574 5f6e 705f 766f  = roi1.get_np_vo
-00022630: 7865 6c5f 7369 7a65 2876 6965 7729 0a0a  xel_size(view)..
-00022640: 2020 2020 2020 2020 2320 4765 7420 6269          # Get bi
-00022650: 6e61 7279 206d 6173 6b73 0a20 2020 2020  nary masks.     
-00022660: 2020 2069 6620 7369 6e67 6c65 5f73 6c69     if single_sli
-00022670: 6365 3a0a 2020 2020 2020 2020 2020 2020  ce:.            
-00022680: 6d61 736b 3120 3d20 726f 6931 2e67 6574  mask1 = roi1.get
-00022690: 5f73 6c69 6365 2876 6965 772c 2073 6c3d  _slice(view, sl=
-000226a0: 736c 2c20 6964 783d 6964 782c 2070 6f73  sl, idx=idx, pos
-000226b0: 3d70 6f73 290a 2020 2020 2020 2020 2020  =pos).          
-000226c0: 2020 6d61 736b 3220 3d20 726f 6932 2e67    mask2 = roi2.g
-000226d0: 6574 5f73 6c69 6365 2876 6965 772c 2073  et_slice(view, s
-000226e0: 6c3d 736c 2c20 6964 783d 6964 782c 2070  l=sl, idx=idx, p
-000226f0: 6f73 3d70 6f73 290a 2020 2020 2020 2020  os=pos).        
-00022700: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-00022710: 2020 6d61 736b 3120 3d20 726f 6931 2e67    mask1 = roi1.g
-00022720: 6574 5f6d 6173 6b28 7669 6577 2c20 666c  et_mask(view, fl
-00022730: 6174 7465 6e3d 666c 6174 7465 6e29 0a20  atten=flatten). 
-00022740: 2020 2020 2020 2020 2020 206d 6173 6b32             mask2
-00022750: 203d 2072 6f69 322e 6765 745f 6d61 736b   = roi2.get_mask
-00022760: 2876 6965 772c 2066 6c61 7474 656e 3d66  (view, flatten=f
-00022770: 6c61 7474 656e 290a 0a20 2020 2020 2020  latten)..       
-00022780: 2023 204d 616b 6520 7374 7275 6374 7572   # Make structur
-00022790: 696e 6720 656c 656d 656e 740a 2020 2020  ing element.    
-000227a0: 2020 2020 636f 6e6e 3220 3d20 6e64 696d      conn2 = ndim
-000227b0: 6167 652e 6765 6e65 7261 7465 5f62 696e  age.generate_bin
-000227c0: 6172 795f 7374 7275 6374 7572 6528 322c  ary_structure(2,
-000227d0: 2063 6f6e 6e65 6374 6976 6974 7929 0a20   connectivity). 
-000227e0: 2020 2020 2020 2069 6620 6d61 736b 312e         if mask1.
-000227f0: 6e64 696d 203d 3d20 323a 0a20 2020 2020  ndim == 2:.     
-00022800: 2020 2020 2020 2063 6f6e 6e20 3d20 636f         conn = co
-00022810: 6e6e 320a 2020 2020 2020 2020 656c 7365  nn2.        else
-00022820: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
-00022830: 2069 6e5f 736c 6963 653a 0a20 2020 2020   in_slice:.     
-00022840: 2020 2020 2020 2020 2020 2063 6f6e 6e20             conn 
-00022850: 3d20 6e70 2e7a 6572 6f73 2828 332c 2033  = np.zeros((3, 3
-00022860: 2c20 3329 2c20 6474 7970 653d 626f 6f6c  , 3), dtype=bool
-00022870: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00022880: 2020 636f 6e6e 5b3a 2c20 3a2c 2031 5d20    conn[:, :, 1] 
-00022890: 3d20 636f 6e6e 320a 2020 2020 2020 2020  = conn2.        
-000228a0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-000228b0: 2020 2020 2020 2020 2020 636f 6e6e 203d            conn =
-000228c0: 206e 6469 6d61 6765 2e67 656e 6572 6174   ndimage.generat
-000228d0: 655f 6269 6e61 7279 5f73 7472 7563 7475  e_binary_structu
-000228e0: 7265 2833 2c20 636f 6e6e 6563 7469 7669  re(3, connectivi
-000228f0: 7479 290a 0a20 2020 2020 2020 2023 2047  ty)..        # G
-00022900: 6574 206f 7574 6572 2070 6978 656c 206f  et outer pixel o
-00022910: 6620 6269 6e61 7279 206d 6170 730a 2020  f binary maps.  
-00022920: 2020 2020 2020 7375 7266 3120 3d20 6d61        surf1 = ma
-00022930: 736b 3120 5e20 6e64 696d 6167 652e 6269  sk1 ^ ndimage.bi
-00022940: 6e61 7279 5f65 726f 7369 6f6e 286d 6173  nary_erosion(mas
-00022950: 6b31 2c20 636f 6e6e 290a 2020 2020 2020  k1, conn).      
-00022960: 2020 7375 7266 3220 3d20 6d61 736b 3220    surf2 = mask2 
-00022970: 5e20 6e64 696d 6167 652e 6269 6e61 7279  ^ ndimage.binary
-00022980: 5f65 726f 7369 6f6e 286d 6173 6b32 2c20  _erosion(mask2, 
-00022990: 636f 6e6e 290a 0a20 2020 2020 2020 2023  conn)..        #
-000229a0: 204d 616b 6520 6172 7261 7973 206f 6620   Make arrays of 
-000229b0: 6469 7374 616e 6365 7320 746f 2073 7572  distances to sur
-000229c0: 6661 6365 206f 6620 6561 6368 2052 4f49  face of each ROI
-000229d0: 0a20 2020 2020 2020 2064 6973 7431 203d  .        dist1 =
-000229e0: 206e 6469 6d61 6765 2e64 6973 7461 6e63   ndimage.distanc
-000229f0: 655f 7472 616e 7366 6f72 6d5f 6564 7428  e_transform_edt(
-00022a00: 7e73 7572 6631 2c20 766f 7865 6c5f 7369  ~surf1, voxel_si
-00022a10: 7a65 290a 2020 2020 2020 2020 6469 7374  ze).        dist
-00022a20: 3220 3d20 6e64 696d 6167 652e 6469 7374  2 = ndimage.dist
-00022a30: 616e 6365 5f74 7261 6e73 666f 726d 5f65  ance_transform_e
-00022a40: 6474 287e 7375 7266 322c 2076 6f78 656c  dt(~surf2, voxel
-00022a50: 5f73 697a 6529 0a0a 2020 2020 2020 2020  _size)..        
-00022a60: 2320 4765 7420 7369 676e 6564 2064 6973  # Get signed dis
-00022a70: 7461 6e63 6573 0a20 2020 2020 2020 2069  tances.        i
-00022a80: 6620 7369 676e 6564 3a0a 2020 2020 2020  f signed:.      
-00022a90: 2020 2020 2020 6469 7374 3120 3d20 6469        dist1 = di
-00022aa0: 7374 3120 2a20 7e6d 6173 6b31 202d 2064  st1 * ~mask1 - d
-00022ab0: 6973 7431 202a 206d 6173 6b31 0a20 2020  ist1 * mask1.   
-00022ac0: 2020 2020 2020 2020 2064 6973 7432 203d           dist2 =
-00022ad0: 2064 6973 7432 202a 207e 6d61 736b 3220   dist2 * ~mask2 
-00022ae0: 2d20 6469 7374 3220 2a20 6d61 736b 320a  - dist2 * mask2.
-00022af0: 0a20 2020 2020 2020 2023 204d 616b 6520  .        # Make 
-00022b00: 7665 6374 6f72 2063 6f6e 7461 696e 696e  vector containin
-00022b10: 6720 616c 6c20 6469 7374 616e 6365 730a  g all distances.
-00022b20: 2020 2020 2020 2020 6966 2063 6f6e 666f          if confo
-00022b30: 726d 6974 793a 0a20 2020 2020 2020 2020  rmity:.         
-00022b40: 2020 2064 6973 7431 5b6d 6173 6b31 2026     dist1[mask1 &
-00022b50: 206d 6173 6b32 5d20 3d20 300a 2020 2020   mask2] = 0.    
-00022b60: 2020 2020 2020 2020 6469 7374 315b 6d61          dist1[ma
-00022b70: 736b 3120 2620 7e6d 6173 6b32 5d20 3d20  sk1 & ~mask2] = 
-00022b80: 2d64 6973 7432 5b6d 6173 6b31 2026 207e  -dist2[mask1 & ~
-00022b90: 6d61 736b 325d 0a20 2020 2020 2020 2020  mask2].         
-00022ba0: 2020 2073 6473 203d 206e 702e 7261 7665     sds = np.rave
-00022bb0: 6c28 6469 7374 315b 6d61 736b 3120 7c20  l(dist1[mask1 | 
-00022bc0: 6d61 736b 325d 290a 2020 2020 2020 2020  mask2]).        
-00022bd0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-00022be0: 2020 7364 7320 3d20 6e70 2e72 6176 656c    sds = np.ravel
-00022bf0: 2864 6973 7431 5b73 7572 6632 2021 3d20  (dist1[surf2 != 
-00022c00: 305d 290a 2020 2020 2020 2020 2020 2020  0]).            
-00022c10: 6966 2073 796d 6d65 7472 6963 3a0a 2020  if symmetric:.  
-00022c20: 2020 2020 2020 2020 2020 2020 2020 7364                sd
-00022c30: 7320 3d20 6e70 2e63 6f6e 6361 7465 6e61  s = np.concatena
-00022c40: 7465 285b 7364 732c 206e 702e 7261 7665  te([sds, np.rave
-00022c50: 6c28 6469 7374 325b 7375 7266 3120 213d  l(dist2[surf1 !=
-00022c60: 2030 5d29 5d29 0a20 2020 2020 2020 2072   0])]).        r
-00022c70: 6574 7572 6e20 7364 730a 0a20 2020 2064  eturn sds..    d
-00022c80: 6566 2067 6574 5f6d 6561 6e5f 7375 7266  ef get_mean_surf
-00022c90: 6163 655f 6469 7374 616e 6365 2873 656c  ace_distance(sel
-00022ca0: 662c 206f 7468 6572 2c20 2a2a 6b77 6172  f, other, **kwar
-00022cb0: 6773 293a 0a20 2020 2020 2020 2027 2727  gs):.        '''
-00022cc0: 0a20 2020 2020 2020 204f 6274 6169 6e20  .        Obtain 
-00022cd0: 6d65 616e 2064 6973 7461 6e63 6520 6265  mean distance be
-00022ce0: 7477 6565 6e20 7375 7266 6163 6520 6f66  tween surface of
-00022cf0: 203c 6f74 6865 723e 2061 6e64 2073 7572   <other> and sur
-00022d00: 6661 6365 206f 6620 3c73 656c 663e 2e0a  face of <self>..
-00022d10: 0a20 2020 2020 2020 2046 6f72 2070 6172  .        For par
-00022d20: 616d 6574 6572 7320 7468 6174 206d 6179  ameters that may
-00022d30: 2062 6520 7061 7373 6564 2c20 7365 6520   be passed, see 
-00022d40: 646f 6375 6d65 6e74 6174 696f 6e20 666f  documentation fo
-00022d50: 723a 0a20 2020 2020 2020 2073 6b72 742e  r:.        skrt.
-00022d60: 524f 492e 6765 745f 7375 7266 6163 655f  ROI.get_surface_
-00022d70: 6469 7374 616e 6365 7328 292e 0a20 2020  distances()..   
-00022d80: 2020 2020 2027 2727 0a0a 2020 2020 2020       '''..      
-00022d90: 2020 7364 7320 3d20 7365 6c66 2e67 6574    sds = self.get
-00022da0: 5f73 7572 6661 6365 5f64 6973 7461 6e63  _surface_distanc
-00022db0: 6573 286f 7468 6572 2c20 2a2a 6b77 6172  es(other, **kwar
-00022dc0: 6773 290a 2020 2020 2020 2020 6966 2073  gs).        if s
-00022dd0: 6473 2069 7320 4e6f 6e65 3a0a 2020 2020  ds is None:.    
-00022de0: 2020 2020 2020 2020 7265 7475 726e 0a20          return. 
-00022df0: 2020 2020 2020 2072 6574 7572 6e20 7364         return sd
-00022e00: 732e 6d65 616e 2829 0a0a 2020 2020 6465  s.mean()..    de
-00022e10: 6620 6765 745f 726d 735f 7375 7266 6163  f get_rms_surfac
-00022e20: 655f 6469 7374 616e 6365 2873 656c 662c  e_distance(self,
-00022e30: 206f 7468 6572 2c20 2a2a 6b77 6172 6773   other, **kwargs
-00022e40: 293a 0a0a 2020 2020 2020 2020 7364 7320  ):..        sds 
-00022e50: 3d20 7365 6c66 2e67 6574 5f73 7572 6661  = self.get_surfa
-00022e60: 6365 5f64 6973 7461 6e63 6573 286f 7468  ce_distances(oth
-00022e70: 6572 2c20 2a2a 6b77 6172 6773 290a 2020  er, **kwargs).  
-00022e80: 2020 2020 2020 6966 2073 6473 2069 7320        if sds is 
-00022e90: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-00022ea0: 2020 7265 7475 726e 0a20 2020 2020 2020    return.       
-00022eb0: 2072 6574 7572 6e20 6e70 2e73 7172 7428   return np.sqrt(
-00022ec0: 2873 6473 202a 2a20 3229 2e6d 6561 6e28  (sds ** 2).mean(
-00022ed0: 2929 0a0a 2020 2020 6465 6620 6765 745f  ))..    def get_
-00022ee0: 6861 7573 646f 7266 665f 6469 7374 616e  hausdorff_distan
-00022ef0: 6365 2873 656c 662c 206f 7468 6572 2c20  ce(self, other, 
-00022f00: 2a2a 6b77 6172 6773 293a 0a0a 2020 2020  **kwargs):..    
-00022f10: 2020 2020 7364 7320 3d20 7365 6c66 2e67      sds = self.g
-00022f20: 6574 5f73 7572 6661 6365 5f64 6973 7461  et_surface_dista
-00022f30: 6e63 6573 286f 7468 6572 2c20 2a2a 6b77  nces(other, **kw
-00022f40: 6172 6773 290a 2020 2020 2020 2020 6966  args).        if
-00022f50: 2073 6473 2069 7320 4e6f 6e65 3a0a 2020   sds is None:.  
-00022f60: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00022f70: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00022f80: 7364 732e 6d61 7828 290a 0a20 2020 2064  sds.max()..    d
-00022f90: 6566 2067 6574 5f6d 6561 6e5f 6469 7374  ef get_mean_dist
-00022fa0: 616e 6365 5f74 6f5f 636f 6e66 6f72 6d69  ance_to_conformi
-00022fb0: 7479 2873 656c 662c 206f 7468 6572 2c20  ty(self, other, 
-00022fc0: 766f 6c5f 756e 6974 733d 226d 6d22 2c20  vol_units="mm", 
-00022fd0: 2a2a 6b77 6172 6773 293a 0a20 2020 2020  **kwargs):.     
-00022fe0: 2020 2027 2727 0a20 2020 2020 2020 204f     '''.        O
-00022ff0: 6274 6169 6e20 6d65 616e 2064 6973 7461  btain mean dista
-00023000: 6e63 6520 746f 2063 6f6e 666f 726d 6974  nce to conformit
-00023010: 7920 666f 7220 3c6f 7468 6572 3e20 7265  y for <other> re
-00023020: 6c61 7469 7665 2074 6f20 3c73 656c 663e  lative to <self>
-00023030: 2e0a 0a20 2020 2020 2020 2054 6865 206d  ...        The m
-00023040: 6561 6e20 6469 7374 616e 6365 2074 6f20  ean distance to 
-00023050: 636f 6e66 6f72 6d69 7479 2069 7320 6173  conformity is as
-00023060: 2064 6566 696e 6564 2069 6e3a 0a20 2020   defined in:.   
-00023070: 2020 2020 2068 7474 7073 3a2f 2f64 6f69       https://doi
-00023080: 2e6f 7267 2f31 302e 3132 3539 2f62 6a72  .org/10.1259/bjr
-00023090: 2f32 3736 3734 3538 310a 2020 2020 2020  /27674581.      
-000230a0: 2020 5465 6368 6e69 6361 6c6c 7920 7468    Technically th
-000230b0: 6520 6d65 616e 2064 6973 7461 6e63 6520  e mean distance 
-000230c0: 746f 2063 6f6e 666f 726d 6974 7920 6973  to conformity is
-000230d0: 6e27 7420 6120 6469 7374 616e 6365 2c0a  n't a distance,.
-000230e0: 2020 2020 2020 2020 6275 7420 6973 2061          but is a
-000230f0: 2064 6973 7461 6e63 6520 6469 7669 6465   distance divide
-00023100: 6420 6279 2061 2076 6f6c 756d 652e 0a0a  d by a volume...
-00023110: 2020 2020 2020 2020 5468 6973 2066 756e          This fun
-00023120: 6374 696f 6e20 7265 7475 726e 7320 6120  ction returns a 
-00023130: 736b 7274 2e63 6f72 652e 4461 7461 206f  skrt.core.Data o
-00023140: 626a 6563 742c 2077 6974 6820 7468 6520  bject, with the 
-00023150: 666f 6c6c 6f77 696e 670a 2020 2020 2020  following.      
-00023160: 2020 696e 666f 726d 6174 696f 6e3a 0a0a    information:..
-00023170: 2020 2020 2020 2020 6e5f 766f 7865 6c20          n_voxel 
-00023180: 3a20 6e75 6d62 6572 206f 6620 766f 7865  : number of voxe
-00023190: 6c73 2069 6e20 7468 6520 756e 696f 6e20  ls in the union 
-000231a0: 6f66 2074 6865 2052 4f49 7320 636f 6e73  of the ROIs cons
-000231b0: 6964 6572 6564 2e0a 0a20 2020 2020 2020  idered...       
-000231c0: 2076 6f78 656c 5f73 697a 6520 3a20 766f   voxel_size : vo
-000231d0: 7865 6c20 7369 7a65 2028 6478 2c20 6479  xel size (dx, dy
-000231e0: 2c20 647a 2920 696e 206d 696c 6c69 6d65  , dz) in millime
-000231f0: 7472 6573 2c20 696e 2074 6865 0a20 2020  tres, in the.   
-00023200: 2020 2020 2052 4f49 206d 6173 6b73 2075       ROI masks u
-00023210: 7365 6420 696e 2064 6973 7461 6e63 6520  sed in distance 
-00023220: 6361 6c63 756c 6174 696f 6e73 2e0a 0a20  calculations... 
-00023230: 2020 2020 2020 206d 6561 6e5f 756e 6465         mean_unde
-00023240: 725f 636f 6e74 6f75 7269 6e67 203a 2073  r_contouring : s
-00023250: 756d 206f 6620 6162 736f 6c75 7465 2076  um of absolute v
-00023260: 616c 7565 7320 6f66 206e 6567 6174 6976  alues of negativ
-00023270: 6520 6469 7374 616e 6365 730a 2020 2020  e distances.    
-00023280: 2020 2020 746f 2063 6f6e 666f 726d 6974      to conformit
-00023290: 792c 2064 6976 6964 6564 2062 7920 766f  y, divided by vo
-000232a0: 6c75 6d65 2069 6e20 756e 696f 6e20 6f66  lume in union of
-000232b0: 2052 4f49 7320 636f 6e73 6964 6572 6564   ROIs considered
-000232c0: 2e0a 0a20 2020 2020 2020 206d 6561 6e5f  ...        mean_
-000232d0: 6f76 6572 5f63 6f6e 746f 7572 696e 6720  over_contouring 
-000232e0: 3a20 7375 6d20 6f66 2070 6f73 6974 6976  : sum of positiv
-000232f0: 6520 6469 7374 616e 6365 7320 746f 2063  e distances to c
-00023300: 6f6e 666f 726d 6974 792c 0a20 2020 2020  onformity,.     
-00023310: 2020 2064 6976 6964 6564 2062 7920 766f     divided by vo
-00023320: 6c75 6d65 2069 6e20 756e 696f 6e20 6f66  lume in union of
-00023330: 2052 4f49 7320 636f 6e73 6964 6572 6564   ROIs considered
-00023340: 2e0a 0a20 2020 2020 2020 206d 6561 6e5f  ...        mean_
-00023350: 6469 7374 616e 6365 5f74 6f5f 636f 6e66  distance_to_conf
-00023360: 6f72 6d69 7479 203a 2073 756d 206f 6620  ormity : sum of 
-00023370: 6d65 616e 5f75 6e64 6572 5f63 6f6e 746f  mean_under_conto
-00023380: 7572 696e 6720 616e 640a 2020 2020 2020  uring and.      
-00023390: 2020 6d65 616e 5f6f 7665 725f 636f 6e74    mean_over_cont
-000233a0: 6f75 7269 6e67 2e0a 0a20 2020 2020 2020  ouring...       
-000233b0: 202a 2a50 6172 616d 6574 6572 733a 2a2a   **Parameters:**
-000233c0: 0a20 2020 2020 2020 2076 6f6c 5f75 6e69  .        vol_uni
-000233d0: 7473 203a 2073 7472 2c20 6465 6661 756c  ts : str, defaul
-000233e0: 743d 226d 6d22 0a20 2020 2020 2020 2020  t="mm".         
-000233f0: 2020 2055 6e69 7473 2074 6f20 7573 6520     Units to use 
-00023400: 666f 7220 766f 6c75 6d65 2069 6e20 6465  for volume in de
-00023410: 6e6f 6d69 6e61 746f 7220 7768 656e 2063  nominator when c
-00023420: 616c 6375 6c61 7469 6e67 0a20 2020 2020  alculating.     
-00023430: 2020 2020 2020 206d 6561 6e5f 756e 6465         mean_unde
-00023440: 725f 636f 6e74 6f75 7269 6e67 2061 6e64  r_contouring and
-00023450: 206d 6561 6e5f 6f76 6572 636f 6e74 6f75   mean_overcontou
-00023460: 7269 6e67 2e20 4361 6e20 6265 0a20 2020  ring. Can be.   
-00023470: 2020 2020 2020 2020 2022 6d6d 2220 283d           "mm" (=
-00023480: 6d6d 5e33 292c 2022 6d6c 222c 206f 7220  mm^3), "ml", or 
-00023490: 2276 6f78 656c 7322 2e0a 0a20 2020 2020  "voxels"...     
-000234a0: 2020 206b 7761 7267 730a 2020 2020 2020     kwargs.      
-000234b0: 2020 2020 2020 4b65 7977 6f72 6420 6172        Keyword ar
-000234c0: 6775 6d65 6e74 7320 6172 6520 7061 7373  guments are pass
-000234d0: 6564 2074 6f0a 2020 2020 2020 2020 2020  ed to.          
-000234e0: 2020 736b 7274 2e73 7472 7563 7475 7265    skrt.structure
-000234f0: 732e 524f 492e 6765 745f 7375 7266 6163  s.ROI.get_surfac
-00023500: 655f 6469 7374 616e 6365 7328 292e 0a20  e_distances().. 
-00023510: 2020 2020 2020 2020 2020 2053 6565 2064             See d
-00023520: 6f63 756d 656e 7461 7469 6f6e 206f 6620  ocumentation of 
-00023530: 7468 6973 206d 6574 686f 6420 666f 7220  this method for 
-00023540: 7061 7261 6d65 7465 7220 6465 7461 696c  parameter detail
-00023550: 732e 0a20 2020 2020 2020 2027 2727 0a0a  s..        '''..
-00023560: 2020 2020 2020 2020 2320 4f62 7461 696e          # Obtain
-00023570: 2064 6973 7461 6e63 6573 2074 6f20 636f   distances to co
-00023580: 6e66 6f72 6d69 7479 2e0a 2020 2020 2020  nformity..      
-00023590: 2020 6b77 6172 6773 5b22 636f 6e66 6f72    kwargs["confor
-000235a0: 6d69 7479 225d 203d 2054 7275 650a 2020  mity"] = True.  
-000235b0: 2020 2020 2020 7364 7320 3d20 7365 6c66        sds = self
-000235c0: 2e67 6574 5f73 7572 6661 6365 5f64 6973  .get_surface_dis
-000235d0: 7461 6e63 6573 286f 7468 6572 2c20 2a2a  tances(other, **
-000235e0: 6b77 6172 6773 290a 0a20 2020 2020 2020  kwargs)..       
-000235f0: 2023 204f 6274 6169 6e20 6d61 736b 2061   # Obtain mask a
-00023600: 7272 6179 2072 6570 7265 7365 6e74 696e  rray representin
-00023610: 6720 756e 696f 6e20 6f72 2052 4f49 732e  g union or ROIs.
-00023620: 0a20 2020 2020 2020 2075 6e69 6f6e 203d  .        union =
-00023630: 2053 7472 7563 7475 7265 5365 7428 5b73   StructureSet([s
-00023640: 656c 662c 206f 7468 6572 5d29 2e63 6f6d  elf, other]).com
-00023650: 6269 6e65 5f72 6f69 7328 290a 2020 2020  bine_rois().    
-00023660: 2020 2020 7669 6577 203d 206b 7761 7267      view = kwarg
-00023670: 732e 6765 7428 2276 6965 7722 2c20 2278  s.get("view", "x
-00023680: 2d79 2229 0a20 2020 2020 2020 2069 6620  -y").        if 
-00023690: 6b77 6172 6773 2e67 6574 2822 7369 6e67  kwargs.get("sing
-000236a0: 6c65 5f73 6c69 6365 222c 2046 616c 7365  le_slice", False
-000236b0: 293a 0a20 2020 2020 2020 2020 2020 2073  ):.            s
-000236c0: 6c20 3d20 6b77 6172 6773 2e67 6574 2822  l = kwargs.get("
-000236d0: 736c 222c 204e 6f6e 6529 0a20 2020 2020  sl", None).     
-000236e0: 2020 2020 2020 2069 6478 203d 206b 7761         idx = kwa
-000236f0: 7267 732e 6765 7428 2269 6478 222c 204e  rgs.get("idx", N
-00023700: 6f6e 6529 0a20 2020 2020 2020 2020 2020  one).           
-00023710: 2070 6f73 203d 206b 7761 7267 732e 6765   pos = kwargs.ge
-00023720: 7428 2270 6f73 222c 204e 6f6e 6529 0a20  t("pos", None). 
-00023730: 2020 2020 2020 2020 2020 206d 6173 6b5f             mask_
-00023740: 6461 7461 203d 2075 6e69 6f6e 2e67 6574  data = union.get
-00023750: 5f73 6c69 6365 2876 6965 772c 2073 6c2c  _slice(view, sl,
-00023760: 2069 6478 2c20 706f 7329 0a20 2020 2020   idx, pos).     
-00023770: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00023780: 2020 2020 2066 6c61 7474 656e 203d 206b       flatten = k
-00023790: 7761 7267 732e 6765 7428 2266 6c61 7474  wargs.get("flatt
-000237a0: 656e 222c 2046 616c 7365 290a 2020 2020  en", False).    
-000237b0: 2020 2020 2020 2020 6d61 736b 5f64 6174          mask_dat
-000237c0: 6120 3d20 756e 696f 6e2e 6765 745f 6d61  a = union.get_ma
-000237d0: 736b 2876 6965 772c 2066 6c61 7474 656e  sk(view, flatten
-000237e0: 290a 0a20 2020 2020 2020 2023 2043 616c  )..        # Cal
-000237f0: 6375 6c61 7465 2063 6f6e 666f 726d 6974  culate conformit
-00023800: 7920 7363 6f72 6573 2e0a 2020 2020 2020  y scores..      
-00023810: 2020 636f 6e66 6f72 6d69 7479 203d 2073    conformity = s
-00023820: 6b72 742e 636f 7265 2e44 6174 6128 290a  krt.core.Data().
-00023830: 2020 2020 2020 2020 636f 6e66 6f72 6d69          conformi
-00023840: 7479 2e6e 5f76 6f78 656c 203d 206d 6173  ty.n_voxel = mas
-00023850: 6b5f 6461 7461 2e73 756d 2829 0a20 2020  k_data.sum().   
-00023860: 2020 2020 2063 6f6e 666f 726d 6974 792e       conformity.
-00023870: 766f 7865 6c5f 7369 7a65 203d 2075 6e69  voxel_size = uni
-00023880: 6f6e 2e67 6574 5f76 6f78 656c 5f73 697a  on.get_voxel_siz
-00023890: 6528 290a 2020 2020 2020 2020 6966 2073  e().        if s
-000238a0: 6473 2069 7320 4e6f 6e65 3a0a 2020 2020  ds is None:.    
-000238b0: 2020 2020 2020 2020 636f 6e66 6f72 6d69          conformi
-000238c0: 7479 2e6d 6561 6e5f 756e 6465 725f 636f  ty.mean_under_co
-000238d0: 6e74 6f75 7269 6e67 203d 204e 6f6e 650a  ntouring = None.
-000238e0: 2020 2020 2020 2020 2020 2020 636f 6e66              conf
-000238f0: 6f72 6d69 7479 2e6d 6561 6e5f 6f76 6572  ormity.mean_over
-00023900: 5f63 6f6e 746f 7572 696e 6720 3d20 4e6f  _contouring = No
-00023910: 6e65 0a20 2020 2020 2020 2020 2020 2063  ne.            c
-00023920: 6f6e 666f 726d 6974 792e 6d65 616e 5f64  onformity.mean_d
-00023930: 6973 7461 6e63 655f 746f 5f63 6f6e 666f  istance_to_confo
-00023940: 726d 6974 7920 3d20 4e6f 6e65 0a20 2020  rmity = None.   
-00023950: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-00023960: 2020 2020 2020 2063 6f6e 666f 726d 6974         conformit
-00023970: 792e 6d65 616e 5f75 6e64 6572 5f63 6f6e  y.mean_under_con
-00023980: 746f 7572 696e 6720 3d20 2861 6273 2873  touring = (abs(s
-00023990: 6473 5b73 6473 203c 2030 5d2e 7375 6d28  ds[sds < 0].sum(
-000239a0: 2929 0a20 2020 2020 2020 2020 2020 2020  )).             
-000239b0: 2020 2020 2020 202f 2075 6e69 6f6e 2e67         / union.g
-000239c0: 6574 5f76 6f6c 756d 6528 766f 6c5f 756e  et_volume(vol_un
-000239d0: 6974 7329 290a 2020 2020 2020 2020 2020  its)).          
-000239e0: 2020 636f 6e66 6f72 6d69 7479 2e6d 6561    conformity.mea
-000239f0: 6e5f 6f76 6572 5f63 6f6e 746f 7572 696e  n_over_contourin
-00023a00: 6720 3d20 2873 6473 5b73 6473 203e 2030  g = (sds[sds > 0
-00023a10: 5d2e 7375 6d28 290a 2020 2020 2020 2020  ].sum().        
-00023a20: 2020 2020 2020 2020 2020 2020 2f20 756e              / un
-00023a30: 696f 6e2e 6765 745f 766f 6c75 6d65 2876  ion.get_volume(v
-00023a40: 6f6c 5f75 6e69 7473 2929 0a20 2020 2020  ol_units)).     
-00023a50: 2020 2020 2020 2063 6f6e 666f 726d 6974         conformit
-00023a60: 792e 6d65 616e 5f64 6973 7461 6e63 655f  y.mean_distance_
-00023a70: 746f 5f63 6f6e 666f 726d 6974 7920 3d20  to_conformity = 
-00023a80: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-00023a90: 2020 2020 2020 636f 6e66 6f72 6d69 7479        conformity
-00023aa0: 2e6d 6561 6e5f 756e 6465 725f 636f 6e74  .mean_under_cont
-00023ab0: 6f75 7269 6e67 202b 0a20 2020 2020 2020  ouring +.       
-00023ac0: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
-00023ad0: 666f 726d 6974 792e 6d65 616e 5f6f 7665  formity.mean_ove
-00023ae0: 725f 636f 6e74 6f75 7269 6e67 290a 0a20  r_contouring).. 
-00023af0: 2020 2020 2020 2072 6574 7572 6e20 636f         return co
-00023b00: 6e66 6f72 6d69 7479 0a0a 2020 2020 6465  nformity..    de
-00023b10: 6620 6765 745f 7375 7266 6163 655f 6469  f get_surface_di
-00023b20: 7374 616e 6365 5f6d 6574 7269 6373 2873  stance_metrics(s
-00023b30: 656c 662c 206f 7468 6572 2c20 2a2a 6b77  elf, other, **kw
-00023b40: 6172 6773 293a 0a20 2020 2020 2020 2022  args):.        "
-00023b50: 2222 4765 7420 7468 6520 6d65 616e 2073  ""Get the mean s
-00023b60: 7572 6661 6365 2064 6973 7461 6e63 652c  urface distance,
-00023b70: 2052 4d53 2073 7572 6661 6365 2064 6973   RMS surface dis
-00023b80: 7461 6e63 652c 2061 6e64 2048 6175 7364  tance, and Hausd
-00023b90: 6f72 6666 0a20 2020 2020 2020 2064 6973  orff.        dis
-00023ba0: 7461 6e63 652e 2222 220a 0a20 2020 2020  tance."""..     
-00023bb0: 2020 2073 6473 203d 2073 656c 662e 6765     sds = self.ge
-00023bc0: 745f 7375 7266 6163 655f 6469 7374 616e  t_surface_distan
-00023bd0: 6365 7328 6f74 6865 722c 202a 2a6b 7761  ces(other, **kwa
-00023be0: 7267 7329 0a20 2020 2020 2020 2069 6620  rgs).        if 
-00023bf0: 7364 7320 6973 204e 6f6e 653a 0a20 2020  sds is None:.   
-00023c00: 2020 2020 2020 2020 2072 6574 7572 6e0a           return.
-00023c10: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-00023c20: 6473 2e6d 6561 6e28 292c 206e 702e 7371  ds.mean(), np.sq
-00023c30: 7274 2828 7364 7320 2a2a 2032 292e 6d65  rt((sds ** 2).me
-00023c40: 616e 2829 292c 2073 6473 2e6d 6178 2829  an()), sds.max()
-00023c50: 0a0a 2020 2020 6465 6620 706c 6f74 5f73  ..    def plot_s
-00023c60: 7572 6661 6365 5f64 6973 7461 6e63 6573  urface_distances
-00023c70: 2873 656c 662c 206f 7468 6572 2c20 7361  (self, other, sa
-00023c80: 7665 5f61 733d 4e6f 6e65 2c20 7369 676e  ve_as=None, sign
-00023c90: 6564 3d46 616c 7365 2c20 2a2a 6b77 6172  ed=False, **kwar
-00023ca0: 6773 293a 0a20 2020 2020 2020 2022 2222  gs):.        """
-00023cb0: 506c 6f74 2068 6973 746f 6772 616d 206f  Plot histogram o
-00023cc0: 6620 7375 7266 6163 6520 6469 7374 616e  f surface distan
-00023cd0: 6365 732e 2222 220a 0a20 2020 2020 2020  ces."""..       
-00023ce0: 2073 6473 203d 2073 656c 662e 6765 745f   sds = self.get_
-00023cf0: 7375 7266 6163 655f 6469 7374 616e 6365  surface_distance
-00023d00: 7328 6f74 6865 722c 2073 6967 6e65 643d  s(other, signed=
-00023d10: 7369 676e 6564 2c20 2a2a 6b77 6172 6773  signed, **kwargs
-00023d20: 290a 2020 2020 2020 2020 6966 2073 6473  ).        if sds
-00023d30: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
-00023d40: 2020 2020 2020 7265 7475 726e 0a20 2020        return.   
-00023d50: 2020 2020 2066 6967 2c20 6178 203d 2070       fig, ax = p
-00023d60: 6c74 2e73 7562 706c 6f74 7328 290a 2020  lt.subplots().  
-00023d70: 2020 2020 2020 6178 2e68 6973 7428 7364        ax.hist(sd
-00023d80: 7329 0a20 2020 2020 2020 2078 6c61 6265  s).        xlabe
-00023d90: 6c20 3d20 280a 2020 2020 2020 2020 2020  l = (.          
-00023da0: 2020 2253 7572 6661 6365 2064 6973 7461    "Surface dista
-00023db0: 6e63 6520 286d 6d29 2220 6966 206e 6f74  nce (mm)" if not
-00023dc0: 2073 6967 6e65 6420 656c 7365 2022 5369   signed else "Si
-00023dd0: 676e 6564 2073 7572 6661 6365 2064 6973  gned surface dis
-00023de0: 7461 6e63 6520 286d 6d29 220a 2020 2020  tance (mm)".    
-00023df0: 2020 2020 290a 2020 2020 2020 2020 6178      ).        ax
-00023e00: 2e73 6574 5f78 6c61 6265 6c28 786c 6162  .set_xlabel(xlab
-00023e10: 656c 290a 2020 2020 2020 2020 6178 2e73  el).        ax.s
-00023e20: 6574 5f79 6c61 6265 6c28 224e 756d 6265  et_ylabel("Numbe
-00023e30: 7220 6f66 2076 6f78 656c 7322 290a 2020  r of voxels").  
-00023e40: 2020 2020 2020 6966 2073 6176 655f 6173        if save_as
-00023e50: 3a0a 2020 2020 2020 2020 2020 2020 706c  :.            pl
-00023e60: 742e 7469 6768 745f 6c61 796f 7574 2829  t.tight_layout()
-00023e70: 0a20 2020 2020 2020 2020 2020 2066 6967  .            fig
-00023e80: 2e73 6176 6566 6967 2873 6176 655f 6173  .savefig(save_as
-00023e90: 290a 0a20 2020 2064 6566 2067 6574 5f63  )..    def get_c
-00023ea0: 6f6d 7061 7269 736f 6e28 0a20 2020 2020  omparison(.     
-00023eb0: 2020 2073 656c 662c 0a20 2020 2020 2020     self,.       
-00023ec0: 2072 6f69 2c0a 2020 2020 2020 2020 6d65   roi,.        me
-00023ed0: 7472 6963 733d 4e6f 6e65 2c0a 2020 2020  trics=None,.    
-00023ee0: 2020 2020 766f 6c5f 756e 6974 733d 226d      vol_units="m
-00023ef0: 6d22 2c0a 2020 2020 2020 2020 6172 6561  m",.        area
-00023f00: 5f75 6e69 7473 3d22 6d6d 222c 0a20 2020  _units="mm",.   
-00023f10: 2020 2020 2063 656e 7472 6f69 645f 756e       centroid_un
-00023f20: 6974 733d 226d 6d22 2c0a 2020 2020 2020  its="mm",.      
-00023f30: 2020 7669 6577 3d22 782d 7922 2c0a 2020    view="x-y",.  
-00023f40: 2020 2020 2020 736c 3d4e 6f6e 652c 0a20        sl=None,. 
-00023f50: 2020 2020 2020 2070 6f73 3d4e 6f6e 652c         pos=None,
-00023f60: 0a20 2020 2020 2020 2069 6478 3d4e 6f6e  .        idx=Non
-00023f70: 652c 0a20 2020 2020 2020 206d 6574 686f  e,.        metho
-00023f80: 643d 4e6f 6e65 2c0a 2020 2020 2020 2020  d=None,.        
-00023f90: 736c 6963 655f 7374 6174 733d 4e6f 6e65  slice_stats=None
-00023fa0: 2c0a 2020 2020 2020 2020 6465 6661 756c  ,.        defaul
-00023fb0: 745f 6279 5f73 6c69 6365 3d4e 6f6e 652c  t_by_slice=None,
-00023fc0: 0a20 2020 2020 2020 2075 6e69 7473 5f69  .        units_i
-00023fd0: 6e5f 6865 6164 6572 3d46 616c 7365 2c0a  n_header=False,.
-00023fe0: 2020 2020 2020 2020 676c 6f62 616c 5f76          global_v
-00023ff0: 735f 736c 6963 655f 6865 6164 6572 3d46  s_slice_header=F
-00024000: 616c 7365 2c0a 2020 2020 2020 2020 6e61  alse,.        na
-00024010: 6d65 5f61 735f 696e 6465 783d 5472 7565  me_as_index=True
-00024020: 2c0a 2020 2020 2020 2020 6e69 6365 5f63  ,.        nice_c
-00024030: 6f6c 756d 6e73 3d46 616c 7365 2c0a 2020  olumns=False,.  
-00024040: 2020 2020 2020 6465 6369 6d61 6c5f 706c        decimal_pl
-00024050: 6163 6573 3d4e 6f6e 652c 0a20 2020 2020  aces=None,.     
-00024060: 2020 2066 6f72 6365 3d54 7275 652c 0a20     force=True,. 
-00024070: 2020 2020 2020 2076 6f78 656c 5f73 697a         voxel_siz
-00024080: 653d 2831 2c20 312c 2031 292c 0a20 2020  e=(1, 1, 1),.   
-00024090: 2020 2020 206d 6174 6368 5f6c 656e 6774       match_lengt
-000240a0: 6873 3d46 616c 7365 2c0a 2020 2020 2020  hs=False,.      
-000240b0: 2020 6d61 7463 685f 6c65 6e67 7468 735f    match_lengths_
-000240c0: 7374 7261 7465 6779 3d31 0a20 2020 2029  strategy=1.    )
-000240d0: 3a0a 2020 2020 2020 2020 2222 2252 6574  :.        """Ret
-000240e0: 7572 6e20 6120 7061 6e64 6173 2044 6174  urn a pandas Dat
-000240f0: 6146 7261 6d65 206f 6620 7468 6520 636f  aFrame of the co
-00024100: 6d70 6172 6973 6f6e 206d 6574 7269 6373  mparison metrics
-00024110: 206c 6973 7465 6420 696e 200a 2020 2020   listed in .    
-00024120: 2020 2020 3c6d 6574 7269 6373 3e20 7769      <metrics> wi
-00024130: 7468 2072 6573 7065 6374 2074 6f20 616e  th respect to an
-00024140: 6f74 6865 7220 524f 492e 0a0a 2020 2020  other ROI...    
-00024150: 2020 2020 2a2a 5061 7261 6d65 7465 7273      **Parameters
-00024160: 3a2a 2a0a 2020 2020 2020 2020 0a20 2020  :**.        .   
-00024170: 2020 2020 2072 6f69 203a 2052 4f49 0a20       roi : ROI. 
-00024180: 2020 2020 2020 2020 2020 204f 7468 6572             Other
-00024190: 2052 4f49 2077 6974 6820 7768 6963 6820   ROI with which 
-000241a0: 746f 2063 6f6d 7061 7265 2074 6869 7320  to compare this 
-000241b0: 524f 492e 0a0a 2020 2020 2020 2020 6d65  ROI...        me
-000241c0: 7472 6963 7320 3a20 6c69 7374 2c20 6465  trics : list, de
-000241d0: 6661 756c 743d 4e6f 6e65 0a20 2020 2020  fault=None.     
-000241e0: 2020 2020 2020 204c 6973 7420 6f66 206d         List of m
-000241f0: 6574 7269 6373 2074 6f20 696e 636c 7564  etrics to includ
-00024200: 6520 696e 2074 6865 2074 6162 6c65 2e20  e in the table. 
-00024210: 4f70 7469 6f6e 733a 0a0a 2020 2020 2020  Options:..      
-00024220: 2020 2020 2020 2020 2020 2a20 2264 6963            * "dic
-00024230: 6522 203a 2067 6c6f 6261 6c20 4469 6365  e" : global Dice
-00024240: 2073 636f 7265 2e0a 2020 2020 2020 2020   score..        
-00024250: 2020 2020 2020 2020 2a20 2264 6963 655f          * "dice_
-00024260: 666c 6174 223a 2044 6963 6520 7363 6f72  flat": Dice scor
-00024270: 6520 6f66 2052 4f49 7320 666c 6174 7465  e of ROIs flatte
-00024280: 6e65 6420 696e 2074 6865 206f 7269 656e  ned in the orien
-00024290: 7461 7469 6f6e 0a20 2020 2020 2020 2020  tation.         
-000242a0: 2020 2020 2020 2020 2073 7065 6369 6669           specifi
-000242b0: 6564 2069 6e20 3c76 6965 773e 2e0a 2020  ed in <view>..  
-000242c0: 2020 2020 2020 2020 2020 2020 2020 2a20                * 
-000242d0: 2264 6963 655f 736c 6963 6522 3a20 4469  "dice_slice": Di
-000242e0: 6365 2073 636f 7265 206f 6e20 6120 7369  ce score on a si
-000242f0: 6e67 6c65 2073 6c69 6365 2e0a 2020 2020  ngle slice..    
-00024300: 2020 2020 2020 2020 2020 2020 2a20 2264              * "d
-00024310: 6963 655f 736c 6963 655f 7374 6174 7322  ice_slice_stats"
-00024320: 3a20 7374 6174 6973 7469 6373 2073 7065  : statistics spe
-00024330: 6369 6669 6564 2069 6e20 3c73 6c69 6365  cified in <slice
-00024340: 5f73 7461 7473 3e0a 2020 2020 2020 2020  _stats>.        
-00024350: 2020 2020 2020 2020 2020 666f 7220 736c            for sl
-00024360: 6963 652d 6279 2d73 6c69 6365 2044 6963  ice-by-slice Dic
-00024370: 6520 7363 6f72 6573 2e0a 0a20 2020 2020  e scores...     
-00024380: 2020 2020 2020 2020 2020 202a 2022 6a61             * "ja
-00024390: 6363 6172 6422 203a 2067 6c6f 6261 6c20  ccard" : global 
-000243a0: 4a61 6363 6172 6420 696e 6465 782e 0a20  Jaccard index.. 
-000243b0: 2020 2020 2020 2020 2020 2020 2020 202a                 *
-000243c0: 2022 6a61 6363 6172 645f 666c 6174 223a   "jaccard_flat":
-000243d0: 204a 6163 6361 7264 2069 6e64 6578 206f   Jaccard index o
-000243e0: 6620 524f 4973 2066 6c61 7474 656e 6564  f ROIs flattened
-000243f0: 2069 6e0a 2020 2020 2020 2020 2020 2020   in.            
-00024400: 2020 2020 2020 7468 6520 6f72 6965 6e74        the orient
-00024410: 6174 696f 6e20 7370 6563 6966 6965 6420  ation specified 
-00024420: 696e 203c 7669 6577 3e2e 0a20 2020 2020  in <view>..     
-00024430: 2020 2020 2020 2020 2020 202a 2022 6a61             * "ja
-00024440: 6363 6172 645f 736c 6963 6522 3a20 4a61  ccard_slice": Ja
-00024450: 6363 6172 6420 696e 6465 7820 6f6e 2061  ccard index on a
-00024460: 2073 696e 676c 6520 736c 6963 652e 0a20   single slice.. 
-00024470: 2020 2020 2020 2020 2020 2020 2020 202a                 *
-00024480: 2022 6a61 6363 6172 645f 736c 6963 655f   "jaccard_slice_
-00024490: 7374 6174 7322 3a20 7374 6174 6973 7469  stats": statisti
-000244a0: 6373 2073 7065 6369 6669 6564 2069 6e20  cs specified in 
-000244b0: 3c73 6c69 6365 5f73 7461 7473 3e0a 2020  <slice_stats>.  
-000244c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000244d0: 666f 7220 736c 6963 652d 6279 2d73 6c69  for slice-by-sli
-000244e0: 6365 204a 6163 6361 7264 2069 6e64 6963  ce Jaccard indic
-000244f0: 6573 2e0a 0a20 2020 2020 2020 2020 2020  es...           
-00024500: 2020 2020 202a 2022 6365 6e74 726f 6964       * "centroid
-00024510: 223a 2033 4420 6365 6e74 726f 6964 2064  ": 3D centroid d
-00024520: 6973 7461 6e63 6520 7665 6374 6f72 2e0a  istance vector..
-00024530: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024540: 2a20 2261 6273 5f63 656e 7472 6f69 6422  * "abs_centroid"
-00024550: 3a20 6d61 676e 6974 7564 6520 6f66 2033  : magnitude of 3
-00024560: 4420 6365 6e74 726f 6964 2064 6973 7461  D centroid dista
-00024570: 6e63 6520 7665 6374 6f72 2e0a 2020 2020  nce vector..    
-00024580: 2020 2020 2020 2020 2020 2020 2a20 2261              * "a
-00024590: 6273 5f63 656e 7472 6f69 645f 666c 6174  bs_centroid_flat
-000245a0: 223a 206d 6167 6e69 7475 6465 206f 6620  ": magnitude of 
-000245b0: 3344 2063 656e 7472 6f69 6420 6469 7374  3D centroid dist
-000245c0: 616e 6365 2076 6563 746f 720a 2020 2020  ance vector.    
-000245d0: 2020 2020 2020 2020 2020 2020 2020 7072                pr
-000245e0: 6f6a 6563 7465 6420 696e 746f 2074 6865  ojected into the
-000245f0: 2070 6c61 6e65 2073 7065 6369 6669 6564   plane specified
-00024600: 2069 6e20 3c76 6965 773e 2e0a 2020 2020   in <view>..    
-00024610: 2020 2020 2020 2020 2020 2020 2a20 2263              * "c
-00024620: 656e 7472 6f69 645f 736c 6963 6522 3a20  entroid_slice": 
-00024630: 3244 2063 656e 7472 6f69 6420 6469 7374  2D centroid dist
-00024640: 616e 6365 2076 6563 746f 7220 6f6e 2061  ance vector on a
-00024650: 2073 696e 676c 6520 736c 6963 652e 0a20   single slice.. 
-00024660: 2020 2020 2020 2020 2020 2020 2020 202a                 *
-00024670: 2022 6365 6e74 726f 6964 5f73 6c69 6365   "centroid_slice
-00024680: 5f73 7461 7473 223a 2073 7461 7469 7374  _stats": statist
-00024690: 6963 7320 7370 6563 6966 6965 6420 696e  ics specified in
-000246a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000246b0: 2020 203c 736c 6963 655f 7374 6174 733e     <slice_stats>
-000246c0: 2066 6f72 2073 6c69 6365 2d62 792d 736c   for slice-by-sl
-000246d0: 6963 6520 3244 2063 656e 7472 6f69 6420  ice 2D centroid 
-000246e0: 6469 7374 616e 6365 2076 6563 746f 7273  distance vectors
-000246f0: 2e0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00024700: 2020 2a20 2261 6273 5f63 656e 7472 6f69    * "abs_centroi
-00024710: 645f 736c 6963 6522 3a20 6d61 676e 6974  d_slice": magnit
-00024720: 7564 6520 6f66 2032 4420 6365 6e74 726f  ude of 2D centro
-00024730: 6964 2064 6973 7461 6e63 6520 0a20 2020  id distance .   
-00024740: 2020 2020 2020 2020 2020 2020 2020 2076                 v
-00024750: 6563 746f 7220 6f6e 2061 2073 696e 676c  ector on a singl
-00024760: 6520 736c 6963 652e 0a20 2020 2020 2020  e slice..       
-00024770: 2020 2020 2020 2020 202a 2022 6162 735f           * "abs_
-00024780: 6365 6e74 726f 6964 5f73 6c69 6365 5f73  centroid_slice_s
-00024790: 7461 7473 223a 2073 7461 7469 7374 6963  tats": statistic
-000247a0: 7320 7370 6563 6966 6965 6420 696e 0a20  s specified in. 
-000247b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000247c0: 203c 736c 6963 655f 7374 6174 733e 2066   <slice_stats> f
-000247d0: 6f72 2073 6c69 6365 2d62 792d 736c 6963  or slice-by-slic
-000247e0: 6520 6d61 676e 6974 7564 6573 206f 6620  e magnitudes of 
-000247f0: 3244 0a20 2020 2020 2020 2020 2020 2020  2D.             
-00024800: 2020 2020 2063 656e 7472 6f69 6420 6469       centroid di
-00024810: 7374 616e 6365 2076 6563 746f 7273 2e0a  stance vectors..
-00024820: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00024830: 202a 2022 766f 6c75 6d65 5f64 6966 6622   * "volume_diff"
-00024840: 3a20 766f 6c75 6d65 2064 6966 6665 7265  : volume differe
-00024850: 6e63 6520 286f 776e 2076 6f6c 756d 6520  nce (own volume 
-00024860: 2d20 6f74 6865 7220 766f 6c75 6d65 292e  - other volume).
-00024870: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00024880: 202a 2022 7265 6c5f 766f 6c75 6d65 5f64   * "rel_volume_d
-00024890: 6966 6622 3a20 766f 6c75 6d65 2064 6966  iff": volume dif
-000248a0: 6665 7265 6e63 6520 6469 7669 6465 6420  ference divided 
-000248b0: 6279 206f 776e 2076 6f6c 756d 652e 0a20  by own volume.. 
-000248c0: 2020 2020 2020 2020 2020 2020 2020 202a                 *
-000248d0: 2022 766f 6c75 6d65 5f72 6174 696f 223a   "volume_ratio":
-000248e0: 2076 6f6c 756d 6520 7261 7469 6f20 286f   volume ratio (o
-000248f0: 776e 2076 6f6c 756d 6520 2f20 6f74 6865  wn volume / othe
-00024900: 7220 766f 6c75 6d65 292e 0a0a 2020 2020  r volume)...    
-00024910: 2020 2020 2020 2020 2020 2020 2a20 2261              * "a
-00024920: 7265 615f 6469 6666 223a 2061 7265 6120  rea_diff": area 
-00024930: 6469 6666 6572 656e 6365 2028 6f77 6e20  difference (own 
-00024940: 6172 6561 202d 206f 7468 6572 2061 7265  area - other are
-00024950: 6129 206f 6e20 6120 0a20 2020 2020 2020  a) on a .       
-00024960: 2020 2020 2020 2020 2020 2073 696e 676c             singl
-00024970: 6520 736c 6963 652e 0a20 2020 2020 2020  e slice..       
-00024980: 2020 2020 2020 2020 202a 2022 7265 6c5f           * "rel_
-00024990: 6172 6561 5f64 6966 6622 3a20 6172 6561  area_diff": area
-000249a0: 2064 6966 6665 7265 6e63 6520 6469 7669   difference divi
-000249b0: 6465 6420 6279 206f 776e 2061 7265 6120  ded by own area 
-000249c0: 6f6e 2061 200a 2020 2020 2020 2020 2020  on a .          
-000249d0: 2020 2020 2020 2020 7369 6e67 6c65 2073          single s
-000249e0: 6c69 6365 2e0a 2020 2020 2020 2020 2020  lice..          
-000249f0: 2020 2020 2020 2a20 2261 7265 615f 7261        * "area_ra
-00024a00: 7469 6f22 3a20 6172 6561 2072 6174 696f  tio": area ratio
-00024a10: 2028 6f77 6e20 6172 6561 202f 206f 7468   (own area / oth
-00024a20: 6572 2061 7265 6129 2e0a 2020 2020 2020  er area)..      
-00024a30: 2020 2020 2020 2020 2020 2a20 2261 7265            * "are
-00024a40: 615f 6469 6666 5f66 6c61 7422 3a20 6172  a_diff_flat": ar
-00024a50: 6561 2064 6966 6665 7265 6e63 6520 6f66  ea difference of
-00024a60: 2052 4f49 7320 666c 6174 7465 6e65 6420   ROIs flattened 
-00024a70: 696e 2074 6865 0a20 2020 2020 2020 2020  in the.         
-00024a80: 2020 2020 2020 2020 206f 7269 656e 7461           orienta
-00024a90: 7469 6f6e 2073 7065 6369 6669 6564 2069  tion specified i
-00024aa0: 6e20 3c76 6965 773e 2e0a 2020 2020 2020  n <view>..      
-00024ab0: 2020 2020 2020 2020 2020 2a20 2261 7265            * "are
-00024ac0: 615f 6469 6666 5f73 6c69 6365 5f73 7461  a_diff_slice_sta
-00024ad0: 7473 223a 2073 7461 7469 7374 6963 7320  ts": statistics 
-00024ae0: 7370 6563 6966 6965 6420 696e 0a20 2020  specified in.   
-00024af0: 2020 2020 2020 2020 2020 2020 2020 203c                 <
-00024b00: 736c 6963 655f 7374 6174 733e 2066 6f72  slice_stats> for
-00024b10: 2073 6c69 6365 2d62 792d 736c 6963 6520   slice-by-slice 
-00024b20: 6172 6561 2064 6966 6665 7265 6e63 6573  area differences
-00024b30: 2e0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00024b40: 2020 2a20 2272 656c 5f61 7265 615f 6469    * "rel_area_di
-00024b50: 6666 5f66 6c61 7422 3a20 7265 6c61 7469  ff_flat": relati
-00024b60: 7665 2061 7265 6120 6469 6666 6572 656e  ve area differen
-00024b70: 6365 206f 6620 524f 4973 0a20 2020 2020  ce of ROIs.     
-00024b80: 2020 2020 2020 2020 2020 2020 2066 6c61               fla
-00024b90: 7474 656e 6564 2069 6e20 7468 6520 6f72  ttened in the or
-00024ba0: 6965 6e74 6174 696f 6e20 7370 6563 6966  ientation specif
-00024bb0: 6965 6420 696e 203c 7669 6577 3e2e 0a20  ied in <view>.. 
-00024bc0: 2020 2020 2020 2020 2020 2020 2020 202a                 *
-00024bd0: 2022 7265 6c5f 6172 6561 5f64 6966 665f   "rel_area_diff_
-00024be0: 736c 6963 655f 7374 6174 7322 3a20 7374  slice_stats": st
-00024bf0: 6174 6973 7469 6373 2073 7065 6369 6669  atistics specifi
-00024c00: 6564 2069 6e0a 2020 2020 2020 2020 2020  ed in.          
-00024c10: 2020 2020 2020 2020 3c73 6c69 6365 5f73          <slice_s
-00024c20: 7461 7473 3e20 666f 7220 7265 6c61 7469  tats> for relati
-00024c30: 7665 2061 7265 6120 6469 6666 6572 656e  ve area differen
-00024c40: 6365 7320 6f66 2052 4f49 732e 0a20 2020  ces of ROIs..   
-00024c50: 2020 2020 2020 2020 2020 2020 202a 2022               * "
-00024c60: 6172 6561 5f72 6174 696f 5f66 6c61 7422  area_ratio_flat"
-00024c70: 3a20 6172 6561 2072 6174 696f 206f 6620  : area ratio of 
-00024c80: 524f 4973 2066 6c61 7474 656e 6564 2069  ROIs flattened i
-00024c90: 6e20 7468 650a 2020 2020 2020 2020 2020  n the.          
-00024ca0: 2020 2020 2020 2020 6f72 6965 6e74 6174          orientat
-00024cb0: 696f 6e20 7370 6563 6966 6965 6420 696e  ion specified in
-00024cc0: 203c 7669 6577 3e2e 0a20 2020 2020 2020   <view>..       
-00024cd0: 2020 2020 2020 2020 202a 2022 6172 6561           * "area
-00024ce0: 5f72 6174 696f 5f73 6c69 6365 5f73 7461  _ratio_slice_sta
-00024cf0: 7473 223a 2073 7461 7469 7374 6963 7320  ts": statistics 
-00024d00: 7370 6563 6966 6965 6420 696e 0a20 2020  specified in.   
-00024d10: 2020 2020 2020 2020 2020 2020 2020 203c                 <
-00024d20: 736c 6963 655f 7374 6174 733e 2066 6f72  slice_stats> for
-00024d30: 2073 6c69 6365 2d62 792d 736c 6963 6520   slice-by-slice 
-00024d40: 6172 6561 2072 6174 696f 732e 0a0a 2020  area ratios...  
-00024d50: 2020 2020 2020 2020 2020 2020 2020 2a20                * 
-00024d60: 226d 6561 6e5f 7369 676e 6564 5f73 7572  "mean_signed_sur
-00024d70: 6661 6365 5f64 6973 7461 6e63 6522 3a20  face_distance": 
-00024d80: 6d65 616e 2073 6967 6e65 6420 7375 7266  mean signed surf
-00024d90: 6163 6520 6469 7374 616e 6365 2e0a 2020  ace distance..  
-00024da0: 2020 2020 2020 2020 2020 2020 2020 2a20                * 
-00024db0: 226d 6561 6e5f 7369 676e 6564 5f73 7572  "mean_signed_sur
-00024dc0: 6661 6365 5f64 6973 7461 6e63 655f 666c  face_distance_fl
-00024dd0: 6174 223a 206d 6561 6e20 7369 676e 6564  at": mean signed
-00024de0: 2073 7572 6661 6365 0a20 2020 2020 2020   surface.       
-00024df0: 2020 2020 2020 2020 2020 2064 6973 7461             dista
-00024e00: 6e63 6520 6f66 2052 4f49 7320 666c 6174  nce of ROIs flat
-00024e10: 7465 6e65 6420 696e 2074 6865 206f 7269  tened in the ori
-00024e20: 656e 7461 7469 6f6e 2073 7065 6369 6669  entation specifi
-00024e30: 6564 0a20 2020 2020 2020 2020 2020 2020  ed.             
-00024e40: 2020 2020 2069 6e20 3c76 6965 773e 2e0a       in <view>..
-00024e50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024e60: 2a20 226d 6561 6e5f 7375 7266 6163 655f  * "mean_surface_
-00024e70: 6469 7374 616e 6365 223a 206d 6561 6e20  distance": mean 
-00024e80: 7375 7266 6163 6520 6469 7374 616e 6365  surface distance
-00024e90: 2e0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00024ea0: 2020 2a20 226d 6561 6e5f 7375 7266 6163    * "mean_surfac
-00024eb0: 655f 6469 7374 616e 6365 5f66 6c61 7422  e_distance_flat"
-00024ec0: 3a20 6d65 616e 2073 7572 6661 6365 2064  : mean surface d
-00024ed0: 6973 7461 6e63 6520 6f66 2052 4f49 730a  istance of ROIs.
-00024ee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024ef0: 2020 666c 6174 7465 6e65 6420 696e 2074    flattened in t
-00024f00: 6865 206f 7269 656e 7461 7469 6f6e 2073  he orientation s
-00024f10: 7065 6369 6669 6564 2069 6e20 3c76 6965  pecified in <vie
-00024f20: 773e 2e0a 2020 2020 2020 2020 2020 2020  w>..            
-00024f30: 2020 2020 2a20 2272 6d73 5f73 7572 6661      * "rms_surfa
-00024f40: 6365 5f64 6973 7461 6e63 6522 3a20 524d  ce_distance": RM
-00024f50: 5320 7375 7266 6163 6520 6469 7374 616e  S surface distan
-00024f60: 6365 2e0a 2020 2020 2020 2020 2020 2020  ce..            
-00024f70: 2020 2020 2a20 2272 6d73 5f73 7572 6661      * "rms_surfa
-00024f80: 6365 5f64 6973 7461 6e63 655f 666c 6174  ce_distance_flat
-00024f90: 223a 2052 4d53 2073 7572 6661 6365 2064  ": RMS surface d
-00024fa0: 6973 7461 6e63 6520 6f66 2052 4f49 730a  istance of ROIs.
-00024fb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024fc0: 2020 666c 6174 7465 6e65 6420 696e 2074    flattened in t
-00024fd0: 6865 206f 7269 656e 7461 7469 6f6e 2073  he orientation s
-00024fe0: 7065 6369 6669 6564 2069 6e20 3c76 6965  pecified in <vie
-00024ff0: 773e 2e0a 2020 2020 2020 2020 2020 2020  w>..            
-00025000: 2020 2020 2a20 2272 6d73 5f73 6967 6e65      * "rms_signe
-00025010: 645f 7375 7266 6163 655f 6469 7374 616e  d_surface_distan
-00025020: 6365 223a 2052 4d53 2073 6967 6e65 6420  ce": RMS signed 
-00025030: 7375 7266 6163 6520 6469 7374 616e 6365  surface distance
-00025040: 2e0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00025050: 2020 2a20 2272 6d73 5f73 6967 6e65 645f    * "rms_signed_
-00025060: 7375 7266 6163 655f 6469 7374 616e 6365  surface_distance
-00025070: 5f66 6c61 7422 3a20 524d 5320 7369 676e  _flat": RMS sign
-00025080: 6564 2073 7572 6661 6365 0a20 2020 2020  ed surface.     
-00025090: 2020 2020 2020 2020 2020 2020 2064 6973               dis
-000250a0: 7461 6e63 6520 6f66 2052 4f49 7320 666c  tance of ROIs fl
-000250b0: 6174 7465 6e65 6420 696e 2074 6865 206f  attened in the o
-000250c0: 7269 656e 7461 7469 6f6e 2073 7065 6369  rientation speci
-000250d0: 6669 6564 0a20 2020 2020 2020 2020 2020  fied.           
-000250e0: 2020 2020 2020 2069 6e20 3c76 6965 773e         in <view>
-000250f0: 2e0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00025100: 2020 2a20 2268 6175 7364 6f72 6666 5f64    * "hausdorff_d
-00025110: 6973 7461 6e63 6522 3a20 4861 7573 646f  istance": Hausdo
-00025120: 7266 6620 6469 7374 616e 6365 2e0a 2020  rff distance..  
-00025130: 2020 2020 2020 2020 2020 2020 2020 2a20                * 
-00025140: 2268 6175 7364 6f72 6666 5f64 6973 7461  "hausdorff_dista
-00025150: 6e63 655f 666c 6174 223a 2048 6175 7364  nce_flat": Hausd
-00025160: 6f72 6666 2064 6973 7461 6e63 6520 6f66  orff distance of
-00025170: 2052 4f49 730a 2020 2020 2020 2020 2020   ROIs.          
-00025180: 2020 2020 2020 2020 666c 6174 7465 6e65          flattene
-00025190: 6420 696e 2074 6865 206f 7269 656e 7461  d in the orienta
-000251a0: 7469 6f6e 2073 7065 6369 6669 6564 2069  tion specified i
-000251b0: 6e20 3c76 6965 773e 2e0a 2020 2020 2020  n <view>..      
-000251c0: 2020 2020 2020 2020 2020 2a20 226d 6561            * "mea
-000251d0: 6e5f 756e 6465 725f 636f 6e74 6f75 7269  n_under_contouri
-000251e0: 6e67 223a 2053 756d 206f 6620 6162 736f  ng": Sum of abso
-000251f0: 6c75 7465 2076 616c 7565 7320 6f66 0a20  lute values of. 
-00025200: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025210: 206e 6567 6174 6976 6520 6469 7374 616e   negative distan
-00025220: 6365 7320 746f 2063 6f6e 666f 726d 6974  ces to conformit
-00025230: 792c 2064 6976 6964 6564 2062 7920 766f  y, divided by vo
-00025240: 6c75 6d65 0a20 2020 2020 2020 2020 2020  lume.           
-00025250: 2020 2020 2020 2069 6e20 756e 696f 6e20         in union 
-00025260: 6f66 2052 4f49 7320 636f 6d70 6172 6564  of ROIs compared
-00025270: 2e0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00025280: 2020 2a20 226d 6561 6e5f 756e 6465 725f    * "mean_under_
-00025290: 636f 6e74 6f75 7269 6e67 5f66 6c61 7422  contouring_flat"
-000252a0: 3a20 5375 6d20 6f66 2061 6273 6f6c 7574  : Sum of absolut
-000252b0: 6520 7661 6c75 6573 206f 660a 2020 2020  e values of.    
-000252c0: 2020 2020 2020 2020 2020 2020 2020 6e65                ne
-000252d0: 6761 7469 7665 2064 6973 7461 6e63 6573  gative distances
-000252e0: 2074 6f20 636f 6e66 6f72 6d69 7479 2c20   to conformity, 
-000252f0: 6469 7669 6465 6420 6279 2076 6f6c 756d  divided by volum
-00025300: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
-00025310: 2020 2020 2066 6c61 7474 656e 6564 2069       flattened i
-00025320: 6e20 7468 6520 6f72 6965 6e74 6174 696f  n the orientatio
-00025330: 6e20 7370 6563 6966 6965 6420 696e 203c  n specified in <
-00025340: 7669 6577 3e2e 0a20 2020 2020 2020 2020  view>..         
-00025350: 2020 2020 2020 2020 2069 6e20 756e 696f           in unio
-00025360: 6e20 6f66 2052 4f49 7320 636f 6d70 6172  n of ROIs compar
-00025370: 6564 2e0a 2020 2020 2020 2020 2020 2020  ed..            
-00025380: 2020 2020 2a20 226d 6561 6e5f 6f76 6572      * "mean_over
-00025390: 5f63 6f6e 746f 7572 696e 6722 3a20 5375  _contouring": Su
-000253a0: 6d20 6f66 2070 6f73 6974 6976 6520 6469  m of positive di
-000253b0: 7374 616e 6365 730a 2020 2020 2020 2020  stances.        
-000253c0: 2020 2020 2020 2020 2020 746f 2063 6f6e            to con
-000253d0: 666f 726d 6974 792c 2064 6976 6964 6564  formity, divided
-000253e0: 2062 7920 766f 6c75 6d65 2069 6e20 756e   by volume in un
-000253f0: 696f 6e20 6f66 2052 4f49 7320 636f 6d70  ion of ROIs comp
-00025400: 6172 6564 2e0a 2020 2020 2020 2020 2020  ared..          
-00025410: 2020 2020 2020 2a20 226d 6561 6e5f 6f76        * "mean_ov
-00025420: 6572 5f63 6f6e 746f 7572 696e 675f 666c  er_contouring_fl
-00025430: 6174 223a 2053 756d 206f 6620 706f 7369  at": Sum of posi
-00025440: 7469 7665 2064 6973 7461 6e63 6573 0a20  tive distances. 
-00025450: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025460: 2074 6f20 636f 6e66 6f72 6d69 7479 2c20   to conformity, 
-00025470: 6469 7669 6465 6420 6279 2076 6f6c 756d  divided by volum
-00025480: 6520 696e 2075 6e69 6f6e 206f 6620 524f  e in union of RO
-00025490: 4973 2063 6f6d 7061 7265 642c 0a20 2020  Is compared,.   
-000254a0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-000254b0: 6c61 7474 656e 6564 2069 6e20 7468 6520  lattened in the 
-000254c0: 6f72 6965 6e74 6174 696f 6e20 7370 6563  orientation spec
-000254d0: 6966 6965 6420 696e 203c 7669 6577 3e2e  ified in <view>.
-000254e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000254f0: 202a 2022 6d65 616e 5f64 6973 7461 6e63   * "mean_distanc
-00025500: 655f 746f 5f63 6f6e 666f 726d 6974 7922  e_to_conformity"
-00025510: 3a20 5375 6d20 6f66 206d 6561 6e5f 756e  : Sum of mean_un
-00025520: 6465 725f 636f 6e74 6f75 7269 6e67 0a20  der_contouring. 
-00025530: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025540: 2061 6e64 206d 6561 6e5f 6f76 6572 5f63   and mean_over_c
-00025550: 6f6e 746f 7572 696e 672e 0a20 2020 2020  ontouring..     
-00025560: 2020 2020 2020 2020 2020 202a 2022 6d65             * "me
-00025570: 616e 5f64 6973 7461 6e63 655f 746f 5f63  an_distance_to_c
-00025580: 6f6e 666f 726d 6974 795f 666c 6174 223a  onformity_flat":
-00025590: 2053 756d 206f 660a 2020 2020 2020 2020   Sum of.        
-000255a0: 2020 2020 2020 2020 2020 6d65 616e 5f75            mean_u
-000255b0: 6e64 6572 5f63 6f6e 746f 7572 696e 675f  nder_contouring_
-000255c0: 666c 6174 2061 6e64 206d 6561 6e5f 6f76  flat and mean_ov
-000255d0: 6572 5f63 6f6e 746f 7572 696e 675f 666c  er_contouring_fl
-000255e0: 6174 2e0a 0a20 2020 2020 2020 2020 2020  at...           
-000255f0: 2049 6620 4e6f 6e65 2c20 6465 6661 756c   If None, defaul
-00025600: 7473 2074 6f20 5b22 6469 6365 222c 2022  ts to ["dice", "
-00025610: 6365 6e74 726f 6964 225d 2e0a 0a20 2020  centroid"]...   
-00025620: 2020 2020 2076 6f6c 5f75 6e69 7473 203a       vol_units :
-00025630: 2073 7472 2c20 6465 6661 756c 743d 226d   str, default="m
-00025640: 6d22 0a20 2020 2020 2020 2020 2020 2055  m".            U
-00025650: 6e69 7473 2074 6f20 7573 6520 666f 7220  nits to use for 
-00025660: 766f 6c75 6d65 2e20 4361 6e20 6265 2022  volume. Can be "
-00025670: 6d6d 2220 283d 6d6d 5e33 292c 2022 6d6c  mm" (=mm^3), "ml
-00025680: 222c 0a20 2020 2020 2020 2020 2020 206f  ",.            o
-00025690: 7220 2276 6f78 656c 7322 2e0a 0a20 2020  r "voxels"...   
-000256a0: 2020 2020 2061 7265 615f 756e 6974 7320       area_units 
-000256b0: 3a20 7374 722c 2064 6566 6175 6c74 3d22  : str, default="
-000256c0: 6d6d 220a 2020 2020 2020 2020 2020 2020  mm".            
-000256d0: 556e 6974 7320 746f 2075 7365 2066 6f72  Units to use for
-000256e0: 2061 7265 6173 2e20 4361 6e20 6265 2022   areas. Can be "
-000256f0: 6d6d 2220 283d 6d6d 5e32 2920 6f72 2022  mm" (=mm^2) or "
-00025700: 766f 7865 6c73 222e 0a0a 2020 2020 2020  voxels"...      
-00025710: 2020 6365 6e74 726f 6964 5f75 6e69 7473    centroid_units
-00025720: 3a0a 2020 2020 2020 2020 2020 2020 556e  :.            Un
-00025730: 6974 7320 746f 2075 7365 2066 6f72 2063  its to use for c
-00025740: 656e 7472 6f69 6473 2e20 4361 6e20 6265  entroids. Can be
-00025750: 2022 6d6d 2220 6f72 2022 766f 7865 6c73   "mm" or "voxels
-00025760: 222e 0a0a 2020 2020 2020 2020 7669 6577  "...        view
-00025770: 203a 2073 7472 2c20 6465 6661 756c 743d   : str, default=
-00025780: 2278 2d79 220a 2020 2020 2020 2020 2020  "x-y".          
-00025790: 2020 4f72 6965 6e74 6174 696f 6e20 696e    Orientation in
-000257a0: 2077 6869 6368 2074 6f20 636f 6d70 7574   which to comput
-000257b0: 6520 6d65 7472 6963 732e 204f 6e6c 7920  e metrics. Only 
-000257c0: 7265 6c65 7661 6e74 2066 6f72 200a 2020  relevant for .  
-000257d0: 2020 2020 2020 2020 2020 7369 6e67 6c65            single
-000257e0: 2d73 6c69 6365 206d 6574 7269 6373 206f  -slice metrics o
-000257f0: 7220 666c 6174 7465 6e65 6420 6d65 7472  r flattened metr
-00025800: 6963 732e 0a0a 2020 2020 2020 2020 736c  ics...        sl
-00025810: 203a 2069 6e74 2c20 6465 6661 756c 743d   : int, default=
-00025820: 4e6f 6e65 0a20 2020 2020 2020 2020 2020  None.           
-00025830: 2053 6c69 6365 206e 756d 6265 7220 6f6e   Slice number on
-00025840: 2077 6869 6368 2074 6f20 636f 6d70 7574   which to comput
-00025850: 6520 6d65 7472 6963 732e 204f 6e6c 7920  e metrics. Only 
-00025860: 7265 6c65 7661 6e74 2066 6f72 200a 2020  relevant for .  
-00025870: 2020 2020 2020 2020 2020 7369 6e67 6c65            single
-00025880: 2d73 6c69 6365 206d 6574 7269 6373 2028  -slice metrics (
-00025890: 6172 6561 2c20 6365 6e74 726f 6964 5f73  area, centroid_s
-000258a0: 6c69 6365 2c20 6c65 6e67 7468 5f73 6c69  lice, length_sli
-000258b0: 6365 292e 0a20 2020 2020 2020 2020 2020  ce)..           
-000258c0: 2049 6620 3c73 6c3e 2c20 3c69 6478 3e2c   If <sl>, <idx>,
-000258d0: 2061 6e64 203c 706f 733e 2061 7265 2061   and <pos> are a
-000258e0: 6c6c 204e 6f6e 652c 2074 6865 2063 656e  ll None, the cen
-000258f0: 7472 616c 2073 6c69 6365 206f 6620 7468  tral slice of th
-00025900: 650a 2020 2020 2020 2020 2020 2020 524f  e.            RO
-00025910: 4920 7769 6c6c 2062 6520 7573 6564 2e0a  I will be used..
-00025920: 0a20 2020 2020 2020 2069 6478 203a 2069  .        idx : i
-00025930: 6e74 2c20 6465 6661 756c 743d 4e6f 6e65  nt, default=None
-00025940: 0a20 2020 2020 2020 2020 2020 2053 6c69  .            Sli
-00025950: 6365 2069 6e64 6578 2061 7272 6179 206f  ce index array o
-00025960: 6e20 7768 6963 6820 746f 2063 6f6d 7075  n which to compu
-00025970: 7465 206d 6574 7269 6373 2e20 4f6e 6c79  te metrics. Only
-00025980: 2072 656c 6576 616e 7420 666f 7220 0a20   relevant for . 
-00025990: 2020 2020 2020 2020 2020 2073 696e 676c             singl
-000259a0: 652d 736c 6963 6520 6d65 7472 6963 7320  e-slice metrics 
-000259b0: 2861 7265 612c 2063 656e 7472 6f69 645f  (area, centroid_
-000259c0: 736c 6963 652c 206c 656e 6774 685f 736c  slice, length_sl
-000259d0: 6963 6529 2e0a 2020 2020 2020 2020 2020  ice)..          
-000259e0: 2020 5573 6564 2069 6620 3c73 6c3e 2069    Used if <sl> i
-000259f0: 7320 4e6f 6e65 2e0a 0a20 2020 2020 2020  s None...       
-00025a00: 2070 6f73 203a 2066 6c6f 6174 2c20 6465   pos : float, de
-00025a10: 6661 756c 743d 4e6f 6e65 0a20 2020 2020  fault=None.     
-00025a20: 2020 2020 2020 2053 6c69 6365 2070 6f73         Slice pos
-00025a30: 6974 696f 6e20 696e 206d 6d20 6f6e 2077  ition in mm on w
-00025a40: 6869 6368 2074 6f20 636f 6d70 7574 6520  hich to compute 
-00025a50: 6d65 7472 6963 732e 204f 6e6c 7920 7265  metrics. Only re
-00025a60: 6c65 7661 6e74 2066 6f72 200a 2020 2020  levant for .    
-00025a70: 2020 2020 2020 2020 7369 6e67 6c65 2d73          single-s
-00025a80: 6c69 6365 206d 6574 7269 6373 2028 6172  lice metrics (ar
-00025a90: 6561 2c20 6365 6e74 726f 6964 5f73 6c69  ea, centroid_sli
-00025aa0: 6365 2c20 6c65 6e67 7468 5f73 6c69 6365  ce, length_slice
-00025ab0: 292e 0a20 2020 2020 2020 2020 2020 2055  )..            U
-00025ac0: 7365 6420 6966 203c 736c 3e20 616e 6420  sed if <sl> and 
-00025ad0: 3c69 6478 3e20 6172 6520 626f 7468 204e  <idx> are both N
-00025ae0: 6f6e 652e 0a0a 2020 2020 2020 2020 6d65  one...        me
-00025af0: 7468 6f64 203a 2073 7472 2c20 6465 6661  thod : str, defa
-00025b00: 756c 743d 4e6f 6e65 0a20 2020 2020 2020  ult=None.       
-00025b10: 2020 2020 204d 6574 686f 6420 746f 2075       Method to u
-00025b20: 7365 2066 6f72 206d 6574 7269 6320 6361  se for metric ca
-00025b30: 6c63 756c 6174 696f 6e2e 2043 616e 2062  lculation. Can b
-00025b40: 6520 6569 7468 6572 2022 636f 6e74 6f75  e either "contou
-00025b50: 7222 200a 2020 2020 2020 2020 2020 2020  r" .            
-00025b60: 2875 7365 2073 6861 7065 6c79 2070 6f6c  (use shapely pol
-00025b70: 7967 6f6e 7329 206f 7220 226d 6173 6b22  ygons) or "mask"
-00025b80: 2028 7573 6520 6269 6e61 7279 206d 6173   (use binary mas
-00025b90: 6b29 2e20 4966 204e 6f6e 652c 0a20 2020  k). If None,.   
-00025ba0: 2020 2020 2020 2020 2074 6865 2076 616c           the val
-00025bb0: 7565 2073 6574 2069 6e20 7365 6c66 2e64  ue set in self.d
-00025bc0: 6566 6175 6c74 5f67 656f 6d5f 6d65 7468  efault_geom_meth
-00025bd0: 6f64 2077 696c 6c20 6265 2075 7365 642e  od will be used.
-00025be0: 204e 6f74 6520 0a20 2020 2020 2020 2020   Note .         
-00025bf0: 2020 2074 6861 7420 666c 6174 7465 6e65     that flattene
-00025c00: 6420 6d65 7472 6963 7320 616e 6420 7375  d metrics and su
-00025c10: 7266 6163 6520 6469 7374 616e 6365 206d  rface distance m
-00025c20: 6574 7269 6373 2065 6e66 6f72 6365 2075  etrics enforce u
-00025c30: 7365 0a20 2020 2020 2020 2020 2020 206f  se.            o
-00025c40: 6620 7468 6520 226d 6173 6b22 206d 6574  f the "mask" met
-00025c50: 686f 642e 0a0a 2020 2020 2020 2020 736c  hod...        sl
-00025c60: 6963 655f 7374 6174 7320 3a20 7374 722f  ice_stats : str/
-00025c70: 6c69 7374 2f64 6963 742c 2064 6566 6175  list/dict, defau
-00025c80: 6c74 3d4e 6f6e 650a 2020 2020 2020 2020  lt=None.        
-00025c90: 2020 2020 5370 6563 6966 6963 6174 696f      Specificatio
-00025ca0: 6e20 6f66 2073 7461 7469 7374 6963 7320  n of statistics 
-00025cb0: 746f 2062 6520 6361 6c63 756c 6174 6564  to be calculated
-00025cc0: 2072 656c 6174 6976 650a 2020 2020 2020   relative.      
-00025cd0: 2020 2020 2020 746f 2073 6c69 6365 2d62        to slice-b
-00025ce0: 792d 736c 6963 6520 6d65 7472 6963 2076  y-slice metric v
-00025cf0: 616c 7565 732e 2020 5573 6564 2066 6f72  alues.  Used for
-00025d00: 2061 6c6c 206d 6574 7269 6373 2077 6974   all metrics wit
-00025d10: 680a 2020 2020 2020 2020 2020 2020 7375  h.            su
-00025d20: 6666 6978 2022 5f73 6c69 6365 5f73 7461  ffix "_slice_sta
-00025d30: 7473 2220 696e 2074 6865 203c 6d65 7472  ts" in the <metr
-00025d40: 6963 733e 206c 6973 742e 0a0a 2020 2020  ics> list...    
-00025d50: 2020 2020 2020 2020 4120 7374 6174 6973          A statis
-00025d60: 7469 6320 6973 2073 7065 6369 6669 6564  tic is specified
-00025d70: 2062 7920 7468 6520 6e61 6d65 206f 6620   by the name of 
-00025d80: 7468 6520 6675 6e63 7469 6f6e 2066 6f72  the function for
-00025d90: 0a20 2020 2020 2020 2020 2020 2069 7473  .            its
-00025da0: 2063 616c 6375 6c61 7469 6f6e 2069 6e20   calculation in 
-00025db0: 7468 6520 5079 7468 6f6e 2073 7461 7469  the Python stati
-00025dc0: 7374 6963 7320 6d6f 6475 6c65 3a0a 0a20  stics module:.. 
-00025dd0: 2020 2020 2020 2020 2020 2068 7474 7073             https
-00025de0: 3a2f 2f64 6f63 732e 7079 7468 6f6e 2e6f  ://docs.python.o
-00025df0: 7267 2f33 2f6c 6962 7261 7279 2f73 7461  rg/3/library/sta
-00025e00: 7469 7374 6963 732e 6874 6d6c 0a0a 2020  tistics.html..  
-00025e10: 2020 2020 2020 2020 2020 466f 7220 6974            For it
-00025e20: 7320 7573 6520 6865 7265 2c20 7468 6520  s use here, the 
-00025e30: 7265 6c65 7661 6e74 2066 756e 6374 696f  relevant functio
-00025e40: 6e20 6d75 7374 2072 6571 7569 7265 0a20  n must require. 
-00025e50: 2020 2020 2020 2020 2020 2061 2073 696e             a sin
-00025e60: 676c 652d 7661 7269 6162 6c65 2069 6e70  gle-variable inp
-00025e70: 7574 2c20 6d75 7374 206e 6f74 2072 6571  ut, must not req
-00025e80: 7569 7265 2061 6e79 206b 6579 776f 7264  uire any keyword
-00025e90: 0a20 2020 2020 2020 2020 2020 2061 7267  .            arg
-00025ea0: 756d 656e 7473 2c20 616e 6420 6d75 7374  uments, and must
-00025eb0: 2072 6574 7572 6e20 6120 7369 6e67 6c65   return a single
-00025ec0: 206e 756d 6265 722e 0a0a 2020 2020 2020   number...      
-00025ed0: 2020 2020 2020 4176 6169 6c61 626c 6520        Available 
-00025ee0: 6f70 7469 6f6e 7320 696e 636c 7564 653a  options include:
-00025ef0: 2022 6d65 616e 222c 2022 6d65 6469 616e   "mean", "median
-00025f00: 222c 2022 6d6f 6465 222c 0a20 2020 2020  ", "mode",.     
-00025f10: 2020 2020 2020 2022 7374 6465 7622 2e0a         "stdev"..
-00025f20: 0a20 2020 2020 2020 2020 2020 5374 6174  .           Stat
-00025f30: 6973 7469 6373 2074 6f20 6265 2063 616c  istics to be cal
-00025f40: 6375 6c61 7465 6420 6361 6e20 6265 2073  culated can be s
-00025f50: 7065 6369 6669 6564 2075 7369 6e67 2061  pecified using a
-00025f60: 6e79 206f 660a 2020 2020 2020 2020 2020  ny of.          
-00025f70: 2074 6865 2066 6f6c 6c6f 7769 6e67 3a0a   the following:.
-00025f80: 0a20 2020 2020 2020 2020 2020 2d20 5374  .           - St
-00025f90: 7269 6e67 2073 7065 6369 6679 696e 6720  ring specifying 
-00025fa0: 7369 6e67 6c65 2073 7461 7469 7374 6963  single statistic
-00025fb0: 2074 6f20 6265 2063 616c 6375 6c61 7465   to be calculate
-00025fc0: 642c 0a20 2020 2020 2020 2020 2020 2020  d,.             
-00025fd0: 7769 7468 2073 6c69 6365 7320 636f 6e73  with slices cons
-00025fe0: 6964 6572 6564 2061 7320 6769 7665 6e20  idered as given 
-00025ff0: 6279 2064 6566 6175 6c74 5f62 795f 736c  by default_by_sl
-00026000: 6963 652c 0a20 2020 2020 2020 2020 2020  ice,.           
-00026010: 2020 666f 7220 6578 616d 706c 653a 2022    for example: "
-00026020: 6d65 616e 223b 0a20 2020 2020 2020 2020  mean";.         
-00026030: 2020 2d20 4c69 7374 2073 7065 6369 6679    - List specify
-00026040: 696e 6720 6d75 6c74 6970 6c65 2073 7461  ing multiple sta
-00026050: 7469 7374 6963 7320 746f 2062 6520 6361  tistics to be ca
-00026060: 6c63 756c 6174 6564 2c0a 2020 2020 2020  lculated,.      
-00026070: 2020 2020 2020 2077 6974 6820 736c 6963         with slic
-00026080: 6573 2063 6f6e 7369 6465 7265 6420 6173  es considered as
-00026090: 2067 6976 656e 2062 7920 6465 6661 756c   given by defaul
-000260a0: 745f 6279 5f73 6c69 6365 2c0a 2020 2020  t_by_slice,.    
-000260b0: 2020 2020 2020 2020 2066 6f72 2065 7861           for exa
-000260c0: 6d70 6c65 3a20 5b22 6d65 616e 222c 2022  mple: ["mean", "
-000260d0: 7374 6465 7622 5d3b 0a20 2020 2020 2020  stdev"];.       
-000260e0: 2020 2020 2d20 4469 6374 696f 6e61 7279      - Dictionary
-000260f0: 2077 6865 7265 206b 6579 7320 7370 6563   where keys spec
-00026100: 6966 7920 736c 6963 6573 2074 6f20 6265  ify slices to be
-00026110: 2063 6f6e 7369 6465 7265 642c 0a20 2020   considered,.   
-00026120: 2020 2020 2020 2020 2020 616e 6420 7661            and va
-00026130: 6c75 6573 2073 7065 6369 6679 2073 7461  lues specify sta
-00026140: 7469 7374 6963 7320 2873 7472 696e 6720  tistics (string 
-00026150: 6f72 206c 6973 7429 2c20 666f 720a 2020  or list), for.  
-00026160: 2020 2020 2020 2020 2020 2065 7861 6d70             examp
-00026170: 6c65 3a20 7b22 756e 696f 6e22 3a20 5b22  le: {"union": ["
-00026180: 6d65 616e 222c 2022 7374 6465 7622 5d7d  mean", "stdev"]}
-00026190: 2e20 2056 616c 6964 2073 6c69 6365 0a20  .  Valid slice. 
-000261a0: 2020 2020 2020 2020 2020 2020 7370 6563              spec
-000261b0: 6966 6963 6174 696f 6e73 2061 7265 2061  ifications are a
-000261c0: 7320 6c69 7374 6564 2066 6f72 2064 6566  s listed for def
-000261d0: 6175 6c74 5f62 795f 736c 6963 652e 0a0a  ault_by_slice...
-000261e0: 2020 2020 2020 2020 6465 6661 756c 745f          default_
-000261f0: 6279 5f73 6c69 6365 3a20 7374 722c 2064  by_slice: str, d
-00026200: 6566 6175 6c74 3d4e 6f6e 650a 2020 2020  efault=None.    
-00026210: 2020 2020 2020 2020 4465 6661 756c 7420          Default 
-00026220: 7370 6563 6966 6963 6174 696f 6e20 6f66  specification of
-00026230: 2073 6c69 6365 7320 746f 2062 6520 636f   slices to be co
-00026240: 6e73 6964 6572 6564 2077 6865 6e0a 2020  nsidered when.  
-00026250: 2020 2020 2020 2020 2020 6361 6c63 756c            calcul
-00026260: 6174 696e 6720 736c 6963 652d 6279 2d73  ating slice-by-s
-00026270: 6c69 6365 2073 7461 7469 7374 6963 732e  lice statistics.
-00026280: 2020 5468 6520 7661 6c69 6420 7370 6563    The valid spec
-00026290: 6966 6963 6174 696f 6e73 0a20 2020 2020  ifications.     
-000262a0: 2020 2020 2020 2061 7265 3a0a 0a20 2020         are:..   
-000262b0: 2020 2020 2020 2020 202d 2022 6c65 6674           - "left
-000262c0: 223a 2063 6f6e 7369 6465 7220 6f6e 6c79  ": consider only
-000262d0: 2073 6c69 6365 7320 636f 6e74 6169 6e69   slices containi
-000262e0: 6e67 2073 656c 663b 0a20 2020 2020 2020  ng self;.       
-000262f0: 2020 2020 202d 2022 7269 6768 7422 3a20       - "right": 
-00026300: 636f 6e73 6964 6572 206f 6e6c 7920 736c  consider only sl
-00026310: 6963 6573 2063 6f6e 7461 696e 696e 6720  ices containing 
-00026320: 6f74 6865 7220 726f 693b 0a20 2020 2020  other roi;.     
-00026330: 2020 2020 2020 202d 2022 756e 696f 6e22         - "union"
-00026340: 3a20 636f 6e73 6964 6572 2073 6c69 6365  : consider slice
-00026350: 7320 636f 6e74 6169 6e69 6e67 2065 6974  s containing eit
-00026360: 6865 7220 6f66 2073 656c 6620 616e 6420  her of self and 
-00026370: 6f74 6865 7220 726f 693b 0a20 2020 2020  other roi;.     
-00026380: 2020 2020 2020 202d 2022 696e 7465 7273         - "inters
-00026390: 6563 7469 6f6e 223a 2063 6f6e 7369 6465  ection": conside
-000263a0: 7220 736c 6963 6573 2063 6f6e 7461 696e  r slices contain
-000263b0: 696e 6720 626f 7468 206f 6620 7365 6c66  ing both of self
-000263c0: 2061 6e64 0a20 2020 2020 2020 2020 2020   and.           
-000263d0: 2020 206f 7468 6572 2072 6f69 2e0a 0a20     other roi... 
-000263e0: 2020 2020 2020 2020 2020 2049 6620 4e6f             If No
-000263f0: 6e65 2c20 7573 6520 736b 7274 2e63 6f72  ne, use skrt.cor
-00026400: 652e 4465 6661 756c 7473 2829 2e62 795f  e.Defaults().by_
-00026410: 736c 6963 650a 0a20 2020 2020 2020 2075  slice..        u
-00026420: 6e69 7473 5f69 6e5f 6865 6164 6572 203a  nits_in_header :
-00026430: 2062 6f6f 6c2c 2064 6566 6175 6c74 3d46   bool, default=F
-00026440: 616c 7365 0a20 2020 2020 2020 2020 2020  alse.           
-00026450: 2049 6620 5472 7565 2c20 756e 6974 7320   If True, units 
-00026460: 7769 6c6c 2062 6520 696e 636c 7564 6564  will be included
-00026470: 2069 6e20 636f 6c75 6d6e 2068 6561 6465   in column heade
-00026480: 7273 2e0a 0a20 2020 2020 2020 2067 6c6f  rs...        glo
-00026490: 6261 6c5f 7673 5f73 6c69 6365 5f68 6561  bal_vs_slice_hea
-000264a0: 6465 7220 3a20 626f 6f6c 2c20 6465 6661  der : bool, defa
-000264b0: 756c 743d 4661 6c73 650a 2020 2020 2020  ult=False.      
-000264c0: 2020 2020 2020 4966 2054 7275 652c 2074        If True, t
-000264d0: 6865 2072 6574 7572 6e65 6420 4461 7461  he returned Data
-000264e0: 4672 616d 6520 7769 6c6c 2068 6176 6520  Frame will have 
-000264f0: 616e 2065 7874 7261 2073 6574 206f 6620  an extra set of 
-00026500: 6865 6164 6572 730a 2020 2020 2020 2020  headers.        
-00026510: 2020 2020 7370 6c69 7474 696e 6720 7468      splitting th
-00026520: 6520 7461 626c 6520 696e 746f 2022 676c  e table into "gl
-00026530: 6f62 616c 2220 616e 6420 2273 6c69 6365  obal" and "slice
-00026540: 2220 6d65 7472 6963 732e 0a0a 2020 2020  " metrics...    
-00026550: 2020 2020 6e61 6d65 5f61 735f 696e 6465      name_as_inde
-00026560: 7820 3a20 626f 6f6c 2c20 6465 6661 756c  x : bool, defaul
-00026570: 743d 5472 7565 0a20 2020 2020 2020 2020  t=True.         
-00026580: 2020 2049 6620 5472 7565 2c20 7468 6520     If True, the 
-00026590: 696e 6465 7820 636f 6c75 6d6e 206f 6620  index column of 
-000265a0: 7468 6520 7061 6e64 6173 2044 6174 6146  the pandas DataF
-000265b0: 7261 6d65 2077 696c 6c20 0a20 2020 2020  rame will .     
-000265c0: 2020 2020 2020 2063 6f6e 7461 696e 2074         contain t
-000265d0: 6865 2052 4f49 2773 206e 616d 6573 3b20  he ROI's names; 
-000265e0: 6f74 6865 7277 6973 652c 2074 6865 206e  otherwise, the n
-000265f0: 616d 6520 7769 6c6c 2061 7070 6561 7220  ame will appear 
-00026600: 696e 2061 2063 6f6c 756d 6e0a 2020 2020  in a column.    
-00026610: 2020 2020 2020 2020 6e61 6d65 6420 2252          named "R
-00026620: 4f49 222e 0a0a 2020 2020 2020 2020 6e69  OI"...        ni
-00026630: 6365 5f63 6f6c 756d 6e73 203a 2062 6f6f  ce_columns : boo
-00026640: 6c2c 2064 6566 6175 6c74 3d46 616c 7365  l, default=False
-00026650: 0a20 2020 2020 2020 2020 2020 2049 6620  .            If 
-00026660: 4661 6c73 652c 2063 6f6c 756d 6e20 6e61  False, column na
-00026670: 6d65 7320 7769 6c6c 2062 6520 7468 6520  mes will be the 
-00026680: 7361 6d65 2061 7320 7468 6520 696e 7075  same as the inpu
-00026690: 7420 6d65 7472 6963 7320 6e61 6d65 733b  t metrics names;
-000266a0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-000266b0: 5472 7565 2c20 7468 6520 6e61 6d65 7320  True, the names 
-000266c0: 7769 6c6c 2062 6520 6361 7069 7461 6c69  will be capitali
-000266d0: 7a65 6420 616e 6420 756e 6465 7273 636f  zed and undersco
-000266e0: 7265 7320 7769 6c6c 2062 6520 0a20 2020  res will be .   
-000266f0: 2020 2020 2020 2020 2072 6570 6c61 6365           replace
-00026700: 6420 7769 7468 2073 7061 6365 732e 0a0a  d with spaces...
-00026710: 2020 2020 2020 2020 6465 6369 6d61 6c5f          decimal_
-00026720: 706c 6163 6573 203a 2069 6e74 2c20 6465  places : int, de
-00026730: 6661 756c 743d 4e6f 6e65 0a20 2020 2020  fault=None.     
-00026740: 2020 2020 2020 204e 756d 6265 7220 6f66         Number of
-00026750: 2064 6563 696d 616c 2070 6c61 6365 7320   decimal places 
-00026760: 746f 206b 6565 7020 666f 7220 6561 6368  to keep for each
-00026770: 206d 6574 7269 632e 2049 6620 4e6f 6e65   metric. If None
-00026780: 2c20 6675 6c6c 0a20 2020 2020 2020 2020  , full.         
-00026790: 2020 2070 7265 6369 7369 6f6e 2077 696c     precision wil
-000267a0: 6c20 6265 2075 7365 642e 0a0a 2020 2020  l be used...    
-000267b0: 2020 2020 666f 7263 6520 3a20 626f 6f6c      force : bool
-000267c0: 2c20 6465 6661 756c 743d 5472 7565 0a20  , default=True. 
-000267d0: 2020 2020 2020 2020 2020 2049 6620 4661             If Fa
-000267e0: 6c73 652c 2067 6c6f 6261 6c20 6d65 7472  lse, global metr
-000267f0: 6963 7320 666f 7220 6561 6368 2052 4f49  ics for each ROI
-00026800: 2028 766f 6c75 6d65 2c20 3344 2063 656e   (volume, 3D cen
-00026810: 7472 6f69 642c 200a 2020 2020 2020 2020  troid, .        
-00026820: 2020 2020 3344 206c 656e 6774 6873 2920      3D lengths) 
-00026830: 7769 6c6c 206f 6e6c 7920 6265 2063 616c  will only be cal
-00026840: 6375 6c61 7465 6420 6966 2074 6865 7920  culated if they 
-00026850: 6861 7665 206e 6f74 2062 6565 6e20 0a20  have not been . 
-00026860: 2020 2020 2020 2020 2020 2063 616c 6375             calcu
-00026870: 6c61 7465 6420 6265 666f 7265 3b20 6966  lated before; if
-00026880: 2054 7275 652c 2061 6c6c 206d 6574 7269   True, all metri
-00026890: 6373 2077 696c 6c20 6265 2072 6563 616c  cs will be recal
-000268a0: 6375 6c61 7465 642e 0a0a 2020 2020 2020  culated...      
-000268b0: 2020 766f 7865 6c5f 7369 7a65 203a 2074    voxel_size : t
-000268c0: 7570 6c65 2c20 6465 6661 756c 743d 2831  uple, default=(1
-000268d0: 2c20 312c 2031 290a 2020 2020 2020 2020  , 1, 1).        
-000268e0: 2020 2020 566f 7865 6c20 7369 7a65 2028      Voxel size (
-000268f0: 6478 2c20 6479 2c20 647a 2920 696e 206d  dx, dy, dz) in m
-00026900: 6d20 746f 2062 6520 7573 6564 2066 6f72  m to be used for
-00026910: 2052 4f49 206d 6173 6b73 0a20 2020 2020   ROI masks.     
-00026920: 2020 2020 2020 2066 726f 6d20 7768 6963         from whic
-00026930: 6820 746f 2063 616c 6375 6c61 7465 2073  h to calculate s
-00026940: 7572 6661 6365 2064 6973 7461 6e63 6573  urface distances
-00026950: 2e20 2049 6620 4e6f 6e65 2c0a 2020 2020  .  If None,.    
-00026960: 2020 2020 2020 2020 7468 6520 6d61 736b          the mask
-00026970: 2076 6f78 656c 2073 697a 6520 6f66 203c   voxel size of <
-00026980: 6f74 6865 723e 2069 7320 7573 6564 2e20  other> is used. 
-00026990: 2049 6620 616e 2069 6e64 6976 6964 7561   If an individua
-000269a0: 6c0a 2020 2020 2020 2020 2020 2020 656c  l.            el
-000269b0: 656d 656e 7420 6973 204e 6f6e 652c 2074  ement is None, t
-000269c0: 6865 2076 616c 7565 206f 6620 7468 6520  he value of the 
-000269d0: 636f 7272 6573 706f 6e64 696e 6720 656c  corresponding el
-000269e0: 656d 656e 7420 666f 720a 2020 2020 2020  ement for.      
-000269f0: 2020 2020 2020 7468 6520 6d61 736b 2076        the mask v
-00026a00: 6f78 656c 2073 697a 6520 6f66 203c 6f74  oxel size of <ot
-00026a10: 6865 723e 2069 7320 7573 6564 2e20 2041  her> is used.  A
-00026a20: 2076 616c 7565 0a20 2020 2020 2020 2020   value.         
-00026a30: 2020 206f 7468 6572 2074 6861 6e20 4e6f     other than No
-00026a40: 6e65 2066 6f72 6365 7320 6372 6561 7469  ne forces creati
-00026a50: 6f6e 206f 6620 6d61 736b 7320 7468 6174  on of masks that
-00026a60: 206a 7573 7420 636f 7665 720a 2020 2020   just cover.    
-00026a70: 2020 2020 2020 2020 7468 6520 766f 6c75          the volu
-00026a80: 6d65 206f 6363 7570 6965 6420 6279 2074  me occupied by t
-00026a90: 6865 2074 776f 2052 4f49 7320 6265 696e  he two ROIs bein
-00026aa0: 6720 636f 6d70 6172 6564 2c0a 2020 2020  g compared,.    
-00026ab0: 2020 2020 2020 2020 706f 7465 6e74 6961          potentia
-00026ac0: 6c6c 7920 7265 6475 6369 6e67 2074 6865  lly reducing the
-00026ad0: 2074 696d 6520 666f 7220 7375 7266 6163   time for surfac
-00026ae0: 652d 6469 7374 616e 6365 2063 616c 6375  e-distance calcu
-00026af0: 6c61 7469 6f6e 732e 0a0a 2020 2020 2020  lations...      
-00026b00: 2020 6d61 7463 685f 6c65 6e67 7468 7320    match_lengths 
-00026b10: 3a20 626f 6f6c 2f73 7472 2f6c 6973 742c  : bool/str/list,
-00026b20: 2064 6566 6175 6c74 3d46 616c 7365 0a20   default=False. 
-00026b30: 2020 2020 2020 2020 2020 2049 6620 7365             If se
-00026b40: 7420 746f 2054 7275 652c 2074 6f20 7468  t to True, to th
-00026b50: 6520 6e61 6d65 206f 6620 7468 6520 6f74  e name of the ot
-00026b60: 6865 7220 524f 492c 206f 7220 746f 2061  her ROI, or to a
-00026b70: 206c 6973 740a 2020 2020 2020 2020 2020   list.          
-00026b80: 2020 6f66 206e 616d 6573 2069 6e63 6c75    of names inclu
-00026b90: 6469 6e67 2074 6865 206e 616d 6520 6f66  ding the name of
-00026ba0: 2074 6865 206f 7468 6572 2052 4f49 2c20   the other ROI, 
-00026bb0: 6d61 7463 6820 524f 4920 6c65 6e67 7468  match ROI length
-00026bc0: 730a 2020 2020 2020 2020 2020 2020 287a  s.            (z
-00026bd0: 2d64 696d 656e 7369 6f6e 7329 2062 6566  -dimensions) bef
-00026be0: 6f72 6520 636f 6d70 6172 6973 6f6e 2e20  ore comparison. 
-00026bf0: 2054 6865 2073 7472 6174 6567 7920 7573   The strategy us
-00026c00: 6564 2069 7320 6465 6669 6e65 640a 2020  ed is defined.  
-00026c10: 2020 2020 2020 2020 2020 6279 2074 6865            by the
-00026c20: 2076 616c 7565 206f 6620 6d61 7463 685f   value of match_
-00026c30: 6c65 6e67 7468 735f 7374 7261 7465 6779  lengths_strategy
-00026c40: 2e0a 0a20 2020 2020 2020 206d 6174 6368  ...        match
-00026c50: 5f6c 656e 6774 6873 5f73 7472 6174 6567  _lengths_strateg
-00026c60: 7920 3a20 696e 742c 2064 6566 6175 6c74  y : int, default
-00026c70: 3d31 0a20 2020 2020 2020 2020 2020 2053  =1.            S
-00026c80: 7472 6174 6567 7920 746f 2075 7365 2066  trategy to use f
-00026c90: 6f72 206d 6174 6368 696e 6720 524f 4920  or matching ROI 
-00026ca0: 6c65 6e67 7468 7320 287a 2d64 696d 656e  lengths (z-dimen
-00026cb0: 7369 6f6e 7329 3a0a 0a20 2020 2020 2020  sions):..       
-00026cc0: 2020 2020 202d 2030 203a 2043 726f 7020       - 0 : Crop 
-00026cd0: 7468 6973 2052 4f49 2074 6f20 7468 6520  this ROI to the 
-00026ce0: 7a2d 6578 7465 6e74 7320 6f66 2074 6865  z-extents of the
-00026cf0: 206f 7468 6572 2052 4f49 3b0a 2020 2020   other ROI;.    
-00026d00: 2020 2020 2020 2020 2d20 3120 3a20 4372          - 1 : Cr
-00026d10: 6f70 2074 6865 206f 7468 6572 2052 4f49  op the other ROI
-00026d20: 2074 6f20 7468 6520 7a2d 6578 656e 7473   to the z-exents
-00026d30: 206f 6620 7468 6973 2052 4f49 3b0a 2020   of this ROI;.  
-00026d40: 2020 2020 2020 2020 2020 2d20 3220 3a20            - 2 : 
-00026d50: 4372 6f70 2074 6869 7320 524f 4920 746f  Crop this ROI to
-00026d60: 2074 6865 207a 2d65 7874 656e 7473 206f   the z-extents o
-00026d70: 6620 7468 6520 6f74 6865 7220 524f 492c  f the other ROI,
-00026d80: 2074 6865 6e0a 2020 2020 2020 2020 2020   then.          
-00026d90: 2020 2020 2020 2020 6372 6f70 2074 6865          crop the
-00026da0: 206f 7468 6572 2052 4f49 2074 6f20 7468   other ROI to th
-00026db0: 6520 6372 6f70 7065 6420 7a2d 6578 7465  e cropped z-exte
-00026dc0: 6e74 7320 6f66 2074 6869 7320 524f 492e  nts of this ROI.
-00026dd0: 0a0a 2020 2020 2020 2020 2020 2020 466f  ..            Fo
-00026de0: 7220 6120 7661 6c75 6520 6f74 6865 7220  r a value other 
-00026df0: 7468 616e 2030 2c20 312c 2032 2c20 6e6f  than 0, 1, 2, no
-00026e00: 206c 656e 6774 6820 6d61 7463 6869 6e67   length matching
-00026e10: 2069 7320 7065 7266 6f72 6d65 642e 0a20   is performed.. 
-00026e20: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-00026e30: 2020 2069 6620 766f 7865 6c5f 7369 7a65     if voxel_size
-00026e40: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
-00026e50: 2020 2020 2020 2020 2020 2320 4372 6561            # Crea
-00026e60: 7465 2052 4f49 206d 6173 6b73 2c20 6a75  te ROI masks, ju
-00026e70: 7374 2063 6f76 6572 696e 6720 766f 6c75  st covering volu
-00026e80: 6d65 206f 6363 7570 6965 640a 2020 2020  me occupied.    
-00026e90: 2020 2020 2020 2020 2320 6279 2052 4f49          # by ROI
-00026ea0: 7320 6265 696e 6720 636f 6d70 6172 6564  s being compared
-00026eb0: 2c20 7769 7468 2073 7065 6369 6669 6564  , with specified
-00026ec0: 2076 6f78 656c 2073 697a 652e 0a20 2020   voxel size..   
-00026ed0: 2020 2020 2020 2020 2023 2028 5468 6520           # (The 
-00026ee0: 7265 7369 7a69 6e67 2069 7320 7065 7266  resizing is perf
-00026ef0: 6f72 6d65 6420 6f6e 2063 6c6f 6e65 7320  ormed on clones 
-00026f00: 6f6e 2074 6865 2052 4f49 732c 0a20 2020  on the ROIs,.   
-00026f10: 2020 2020 2020 2020 2023 2077 6974 686f           # witho
-00026f20: 7574 2063 6861 6e67 696e 6720 7468 6520  ut changing the 
-00026f30: 6f72 6967 696e 616c 732e 290a 2020 2020  originals.).    
-00026f40: 2020 2020 2020 2020 726f 6930 2c20 726f          roi0, ro
-00026f50: 6920 3d20 7365 6c66 2e6d 6174 6368 5f6d  i = self.match_m
-00026f60: 6173 6b5f 766f 7865 6c5f 7369 7a65 2872  ask_voxel_size(r
-00026f70: 6f69 2c0a 2020 2020 2020 2020 2020 2020  oi,.            
-00026f80: 2020 2020 2020 2020 766f 7865 6c5f 7369          voxel_si
-00026f90: 7a65 3d76 6f78 656c 5f73 697a 652c 2076  ze=voxel_size, v
-00026fa0: 6f78 656c 5f64 696d 5f74 6f6c 6572 616e  oxel_dim_toleran
-00026fb0: 6365 3d2d 3129 0a20 2020 2020 2020 2065  ce=-1).        e
-00026fc0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-00026fd0: 2023 2044 6f6e 2774 2065 7870 6c69 6369   # Don't explici
-00026fe0: 746c 7920 6372 6561 7465 2052 4f49 206d  tly create ROI m
-00026ff0: 6173 6b73 2e0a 2020 2020 2020 2020 2020  asks..          
-00027000: 2020 726f 6930 203d 2073 656c 660a 0a20    roi0 = self.. 
-00027010: 2020 2020 2020 2023 204f 7074 696f 6e61         # Optiona
-00027020: 6c6c 7920 6d61 7463 6820 524f 4920 6c65  lly match ROI le
-00027030: 6e67 7468 732e 0a20 2020 2020 2020 2069  ngths..        i
-00027040: 6620 2828 6d61 7463 685f 6c65 6e67 7468  f ((match_length
-00027050: 7320 6973 2054 7275 6529 206f 7220 2872  s is True) or (r
-00027060: 6f69 2e6e 616d 6520 3d3d 206d 6174 6368  oi.name == match
-00027070: 5f6c 656e 6774 6873 290a 2020 2020 2020  _lengths).      
-00027080: 2020 2020 2020 2020 2020 6f72 2028 6973            or (is
-00027090: 696e 7374 616e 6365 286d 6174 6368 5f6c  instance(match_l
-000270a0: 656e 6774 6873 2c20 286c 6973 742c 2074  engths, (list, t
-000270b0: 7570 6c65 2c20 7365 7429 290a 2020 2020  uple, set)).    
-000270c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000270d0: 616e 6420 726f 692e 6e61 6d65 2069 6e20  and roi.name in 
-000270e0: 6d61 7463 685f 6c65 6e67 7468 7329 293a  match_lengths)):
-000270f0: 0a20 2020 2020 2020 2020 2020 2023 2043  .            # C
-00027100: 7265 6174 6520 524f 4920 636c 6f6e 6573  reate ROI clones
-00027110: 2066 6f72 2063 726f 7070 696e 673b 2074   for cropping; t
-00027120: 6865 206f 7269 6769 6e61 6c73 2077 696c  he originals wil
-00027130: 6c20 6265 2075 6e63 6861 6e67 6564 2e0a  l be unchanged..
-00027140: 2020 2020 2020 2020 2020 2020 6966 206d              if m
-00027150: 6174 6368 5f6c 656e 6774 6873 5f73 7472  atch_lengths_str
-00027160: 6174 6567 7920 696e 205b 302c 2031 2c20  ategy in [0, 1, 
-00027170: 325d 2061 6e64 2076 6f78 656c 5f73 697a  2] and voxel_siz
-00027180: 6520 6973 204e 6f6e 653a 0a20 2020 2020  e is None:.     
-00027190: 2020 2020 2020 2020 2020 2072 6f69 3020             roi0 
-000271a0: 3d20 7365 6c66 2e63 6c6f 6e65 2829 0a20  = self.clone(). 
-000271b0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-000271c0: 6f69 203d 2072 6f69 2e63 6c6f 6e65 2829  oi = roi.clone()
-000271d0: 0a20 2020 2020 2020 2020 2020 2023 2043  .            # C
-000271e0: 726f 7020 7468 6973 2052 4f49 2074 6f20  rop this ROI to 
-000271f0: 7a2d 6578 7465 6e74 7320 6f66 206f 7468  z-extents of oth
-00027200: 6572 2052 4f49 2e0a 2020 2020 2020 2020  er ROI..        
-00027210: 2020 2020 6966 206d 6174 6368 5f6c 656e      if match_len
-00027220: 6774 6873 5f73 7472 6174 6567 7920 696e  gths_strategy in
-00027230: 205b 302c 2032 5d3a 0a20 2020 2020 2020   [0, 2]:.       
-00027240: 2020 2020 2020 2020 2072 6f69 302e 6372           roi0.cr
-00027250: 6f70 5f74 6f5f 726f 695f 6c65 6e67 7468  op_to_roi_length
-00027260: 2872 6f69 290a 2020 2020 2020 2020 2020  (roi).          
-00027270: 2020 2320 4372 6f70 206f 7468 6572 2052    # Crop other R
-00027280: 4f49 2074 6f20 7a2d 6578 7465 6e74 7320  OI to z-extents 
-00027290: 6f66 2074 6869 7320 524f 492e 0a20 2020  of this ROI..   
-000272a0: 2020 2020 2020 2020 2069 6620 6d61 7463           if matc
-000272b0: 685f 6c65 6e67 7468 735f 7374 7261 7465  h_lengths_strate
-000272c0: 6779 2069 6e20 5b31 2c20 325d 3a0a 2020  gy in [1, 2]:.  
-000272d0: 2020 2020 2020 2020 2020 2020 2020 726f                ro
-000272e0: 692e 6372 6f70 5f74 6f5f 726f 695f 6c65  i.crop_to_roi_le
-000272f0: 6e67 7468 2872 6f69 3029 0a0a 2020 2020  ngth(roi0)..    
-00027300: 2020 2020 2320 4465 6661 756c 7420 6d65      # Default me
-00027310: 7472 6963 730a 2020 2020 2020 2020 6966  trics.        if
-00027320: 206d 6574 7269 6373 2069 7320 4e6f 6e65   metrics is None
-00027330: 3a0a 2020 2020 2020 2020 2020 2020 6d65  :.            me
-00027340: 7472 6963 7320 3d20 5b22 6469 6365 222c  trics = ["dice",
-00027350: 2022 6365 6e74 726f 6964 225d 0a0a 2020   "centroid"]..  
-00027360: 2020 2020 2020 2320 4465 6661 756c 7420        # Default 
-00027370: 736c 6963 6573 2074 6f20 636f 6e73 6964  slices to consid
-00027380: 6572 2066 6f72 2073 6c69 6365 2d62 792d  er for slice-by-
-00027390: 736c 6963 6520 6d65 7472 6963 2063 616c  slice metric cal
-000273a0: 6375 6c61 7469 6f6e 732e 0a20 2020 2020  culations..     
-000273b0: 2020 2064 6566 6175 6c74 5f62 795f 736c     default_by_sl
-000273c0: 6963 6520 3d20 736b 7274 2e63 6f72 652e  ice = skrt.core.
-000273d0: 4465 6661 756c 7473 2829 2e62 795f 736c  Defaults().by_sl
-000273e0: 6963 650a 0a20 2020 2020 2020 2023 2049  ice..        # I
-000273f0: 6e69 7469 616c 6973 6520 7661 7269 6162  nitialise variab
-00027400: 6c65 7320 666f 7220 6469 7374 616e 6365  les for distance
-00027410: 206d 6574 7269 6373 2e0a 2020 2020 2020   metrics..      
-00027420: 2020 636f 6e66 6f72 6d69 7479 203d 204e    conformity = N
-00027430: 6f6e 650a 2020 2020 2020 2020 636f 6e66  one.        conf
-00027440: 6f72 6d69 7479 5f66 6c61 7420 3d20 4e6f  ormity_flat = No
-00027450: 6e65 0a20 2020 2020 2020 2064 6973 7461  ne.        dista
-00027460: 6e63 6573 203d 204e 6f6e 650a 2020 2020  nces = None.    
-00027470: 2020 2020 6469 7374 616e 6365 735f 666c      distances_fl
-00027480: 6174 203d 204e 6f6e 650a 2020 2020 2020  at = None.      
-00027490: 2020 7369 676e 6564 5f64 6973 7461 6e63    signed_distanc
-000274a0: 6573 203d 204e 6f6e 650a 2020 2020 2020  es = None.      
-000274b0: 2020 7369 676e 6564 5f64 6973 7461 6e63    signed_distanc
-000274c0: 6573 5f66 6c61 7420 3d20 4e6f 6e65 0a0a  es_flat = None..
-000274d0: 2020 2020 2020 2020 2320 4966 206e 6f20          # If no 
-000274e0: 696e 6465 7820 6769 7665 6e2c 2075 7365  index given, use
-000274f0: 2063 656e 7472 616c 2073 6c69 6365 0a20   central slice. 
-00027500: 2020 2020 2020 2069 6620 736c 2069 7320         if sl is 
-00027510: 4e6f 6e65 2061 6e64 2069 6478 2069 7320  None and idx is 
-00027520: 4e6f 6e65 2061 6e64 2070 6f73 2069 7320  None and pos is 
-00027530: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-00027540: 2020 6964 7820 3d20 726f 6930 2e67 6574    idx = roi0.get
-00027550: 5f6d 6964 5f69 6478 2876 6965 7729 0a0a  _mid_idx(view)..
-00027560: 2020 2020 2020 2020 2320 436f 6d70 7574          # Comput
-00027570: 6520 6d65 7472 6963 730a 2020 2020 2020  e metrics.      
-00027580: 2020 636f 6d70 203d 207b 7d0a 2020 2020    comp = {}.    
-00027590: 2020 2020 736c 6963 655f 6b77 6172 6773      slice_kwargs
-000275a0: 203d 207b 0a20 2020 2020 2020 2020 2020   = {.           
-000275b0: 2022 7369 6e67 6c65 5f73 6c69 6365 223a   "single_slice":
-000275c0: 2054 7275 652c 0a20 2020 2020 2020 2020   True,.         
-000275d0: 2020 2022 7669 6577 223a 2076 6965 772c     "view": view,
-000275e0: 0a20 2020 2020 2020 2020 2020 2022 736c  .            "sl
-000275f0: 223a 2073 6c2c 0a20 2020 2020 2020 2020  ": sl,.         
-00027600: 2020 2022 6964 7822 3a20 6964 782c 0a20     "idx": idx,. 
-00027610: 2020 2020 2020 2020 2020 2022 706f 7322             "pos"
-00027620: 3a20 706f 730a 2020 2020 2020 2020 7d0a  : pos.        }.
-00027630: 0a20 2020 2020 2020 2066 6f72 206d 2069  .        for m i
-00027640: 6e20 6d65 7472 6963 733a 0a20 2020 2020  n metrics:.     
-00027650: 2020 2020 2020 2069 6620 6d20 6e6f 7420         if m not 
-00027660: 696e 2067 6574 5f63 6f6d 7061 7269 736f  in get_compariso
-00027670: 6e5f 6d65 7472 6963 7328 293a 0a20 2020  n_metrics():.   
-00027680: 2020 2020 2020 2020 2020 2020 2072 6169               rai
-00027690: 7365 2052 756e 7469 6d65 4572 726f 7228  se RuntimeError(
-000276a0: 6622 4d65 7472 6963 207b 6d7d 206e 6f74  f"Metric {m} not
-000276b0: 2072 6563 6f67 6e69 7365 6420 6279 2022   recognised by "
-000276c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000276d0: 2020 2020 2020 2020 2022 524f 492e 6765           "ROI.ge
-000276e0: 745f 636f 6d70 6172 6973 6f6e 2829 2229  t_comparison()")
-000276f0: 0a0a 2020 2020 2020 2020 666f 7220 6d20  ..        for m 
-00027700: 696e 206d 6574 7269 6373 3a0a 0a20 2020  in metrics:..   
-00027710: 2020 2020 2020 2020 2023 2044 6963 6520           # Dice 
-00027720: 7363 6f72 650a 2020 2020 2020 2020 2020  score.          
-00027730: 2020 6966 206d 203d 3d20 2264 6963 6522    if m == "dice"
-00027740: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00027750: 2020 636f 6d70 5b6d 5d20 3d20 726f 6930    comp[m] = roi0
-00027760: 2e67 6574 5f64 6963 6528 726f 692c 206d  .get_dice(roi, m
-00027770: 6574 686f 643d 6d65 7468 6f64 290a 2020  ethod=method).  
-00027780: 2020 2020 2020 2020 2020 656c 6966 206d            elif m
-00027790: 203d 3d20 2264 6963 655f 666c 6174 223a   == "dice_flat":
-000277a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000277b0: 2063 6f6d 705b 6d5d 203d 2072 6f69 302e   comp[m] = roi0.
-000277c0: 6765 745f 6469 6365 280a 2020 2020 2020  get_dice(.      
-000277d0: 2020 2020 2020 2020 2020 2020 2020 726f                ro
-000277e0: 692c 200a 2020 2020 2020 2020 2020 2020  i, .            
-000277f0: 2020 2020 2020 2020 7669 6577 3d76 6965          view=vie
-00027800: 772c 0a20 2020 2020 2020 2020 2020 2020  w,.             
-00027810: 2020 2020 2020 206d 6574 686f 643d 6d65         method=me
-00027820: 7468 6f64 2c0a 2020 2020 2020 2020 2020  thod,.          
-00027830: 2020 2020 2020 2020 2020 666c 6174 7465            flatte
-00027840: 6e3d 5472 7565 2c20 0a20 2020 2020 2020  n=True, .       
-00027850: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
-00027860: 2020 2020 2020 2065 6c69 6620 6d20 3d3d         elif m ==
-00027870: 2022 6469 6365 5f73 6c69 6365 223a 0a20   "dice_slice":. 
-00027880: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-00027890: 6f6d 705b 6d5d 203d 2072 6f69 302e 6765  omp[m] = roi0.ge
-000278a0: 745f 6469 6365 2872 6f69 2c20 6d65 7468  t_dice(roi, meth
-000278b0: 6f64 3d6d 6574 686f 642c 202a 2a73 6c69  od=method, **sli
-000278c0: 6365 5f6b 7761 7267 7329 0a0a 2020 2020  ce_kwargs)..    
-000278d0: 2020 2020 2020 2020 656c 6966 206d 203d          elif m =
-000278e0: 3d20 2264 6963 655f 736c 6963 655f 7374  = "dice_slice_st
-000278f0: 6174 7322 3a0a 2020 2020 2020 2020 2020  ats":.          
-00027900: 2020 2020 2020 636f 6d70 2e75 7064 6174        comp.updat
-00027910: 6528 726f 6930 2e67 6574 5f73 6c69 6365  e(roi0.get_slice
-00027920: 5f73 7461 7473 2872 6f69 2c20 6d65 7472  _stats(roi, metr
-00027930: 6963 733d 2264 6963 6522 2c0a 2020 2020  ics="dice",.    
-00027940: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027950: 2020 2020 736c 6963 655f 7374 6174 733d      slice_stats=
-00027960: 736c 6963 655f 7374 6174 732c 0a20 2020  slice_stats,.   
-00027970: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027980: 2020 2020 2064 6566 6175 6c74 5f62 795f       default_by_
-00027990: 736c 6963 653d 6465 6661 756c 745f 6279  slice=default_by
-000279a0: 5f73 6c69 6365 2c0a 2020 2020 2020 2020  _slice,.        
-000279b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000279c0: 6d65 7468 6f64 3d6d 6574 686f 642c 2076  method=method, v
-000279d0: 6965 773d 7669 6577 2929 0a0a 2020 2020  iew=view))..    
-000279e0: 2020 2020 2020 2020 2320 4a61 6363 6172          # Jaccar
-000279f0: 6420 696e 6465 780a 2020 2020 2020 2020  d index.        
-00027a00: 2020 2020 656c 6966 206d 203d 3d20 226a      elif m == "j
-00027a10: 6163 6361 7264 223a 0a20 2020 2020 2020  accard":.       
-00027a20: 2020 2020 2020 2020 2063 6f6d 705b 6d5d           comp[m]
-00027a30: 203d 2072 6f69 302e 6765 745f 6a61 6363   = roi0.get_jacc
-00027a40: 6172 6428 726f 692c 206d 6574 686f 643d  ard(roi, method=
-00027a50: 6d65 7468 6f64 290a 2020 2020 2020 2020  method).        
-00027a60: 2020 2020 656c 6966 206d 203d 3d20 226a      elif m == "j
-00027a70: 6163 6361 7264 5f66 6c61 7422 3a0a 2020  accard_flat":.  
-00027a80: 2020 2020 2020 2020 2020 2020 2020 636f                co
-00027a90: 6d70 5b6d 5d20 3d20 726f 6930 2e67 6574  mp[m] = roi0.get
-00027aa0: 5f6a 6163 6361 7264 280a 2020 2020 2020  _jaccard(.      
-00027ab0: 2020 2020 2020 2020 2020 2020 2020 726f                ro
-00027ac0: 692c 200a 2020 2020 2020 2020 2020 2020  i, .            
-00027ad0: 2020 2020 2020 2020 7669 6577 3d76 6965          view=vie
-00027ae0: 772c 0a20 2020 2020 2020 2020 2020 2020  w,.             
-00027af0: 2020 2020 2020 206d 6574 686f 643d 6d65         method=me
-00027b00: 7468 6f64 2c0a 2020 2020 2020 2020 2020  thod,.          
-00027b10: 2020 2020 2020 2020 2020 666c 6174 7465            flatte
-00027b20: 6e3d 5472 7565 2c20 0a20 2020 2020 2020  n=True, .       
-00027b30: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
-00027b40: 2020 2020 2020 2065 6c69 6620 6d20 3d3d         elif m ==
-00027b50: 2022 6a61 6363 6172 645f 736c 6963 6522   "jaccard_slice"
-00027b60: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00027b70: 2020 636f 6d70 5b6d 5d20 3d20 726f 6930    comp[m] = roi0
-00027b80: 2e67 6574 5f6a 6163 6361 7264 2872 6f69  .get_jaccard(roi
-00027b90: 2c20 6d65 7468 6f64 3d6d 6574 686f 642c  , method=method,
-00027ba0: 202a 2a73 6c69 6365 5f6b 7761 7267 7329   **slice_kwargs)
-00027bb0: 0a0a 2020 2020 2020 2020 2020 2020 656c  ..            el
-00027bc0: 6966 206d 203d 3d20 226a 6163 6361 7264  if m == "jaccard
-00027bd0: 5f73 6c69 6365 5f73 7461 7473 223a 0a20  _slice_stats":. 
-00027be0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-00027bf0: 6f6d 702e 7570 6461 7465 2872 6f69 302e  omp.update(roi0.
-00027c00: 6765 745f 736c 6963 655f 7374 6174 7328  get_slice_stats(
-00027c10: 726f 692c 206d 6574 7269 6373 3d22 6a61  roi, metrics="ja
-00027c20: 6363 6172 6422 2c0a 2020 2020 2020 2020  ccard",.        
-00027c30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027c40: 736c 6963 655f 7374 6174 733d 736c 6963  slice_stats=slic
-00027c50: 655f 7374 6174 732c 0a20 2020 2020 2020  e_stats,.       
-00027c60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027c70: 2064 6566 6175 6c74 5f62 795f 736c 6963   default_by_slic
-00027c80: 653d 6465 6661 756c 745f 6279 5f73 6c69  e=default_by_sli
-00027c90: 6365 2c0a 2020 2020 2020 2020 2020 2020  ce,.            
-00027ca0: 2020 2020 2020 2020 2020 2020 6d65 7468              meth
-00027cb0: 6f64 3d6d 6574 686f 642c 2076 6965 773d  od=method, view=
-00027cc0: 7669 6577 2929 0a0a 2020 2020 2020 2020  view))..        
-00027cd0: 2020 2020 2320 4365 6e74 726f 6964 2064      # Centroid d
-00027ce0: 6973 7461 6e63 6573 0a20 2020 2020 2020  istances.       
-00027cf0: 2020 2020 2065 6c69 6620 6d20 3d3d 2022       elif m == "
-00027d00: 6365 6e74 726f 6964 223a 0a20 2020 2020  centroid":.     
-00027d10: 2020 2020 2020 2020 2020 2063 656e 7472             centr
-00027d20: 6f69 6420 3d20 726f 6930 2e67 6574 5f63  oid = roi0.get_c
-00027d30: 656e 7472 6f69 645f 6469 7374 616e 6365  entroid_distance
-00027d40: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-00027d50: 2020 2020 2020 726f 692c 200a 2020 2020        roi, .    
-00027d60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027d70: 756e 6974 733d 6365 6e74 726f 6964 5f75  units=centroid_u
-00027d80: 6e69 7473 2c20 0a20 2020 2020 2020 2020  nits, .         
-00027d90: 2020 2020 2020 2020 2020 206d 6574 686f             metho
-00027da0: 643d 6d65 7468 6f64 2c0a 2020 2020 2020  d=method,.      
-00027db0: 2020 2020 2020 2020 2020 2020 2020 666f                fo
-00027dc0: 7263 653d 666f 7263 650a 2020 2020 2020  rce=force.      
-00027dd0: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
-00027de0: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-00027df0: 692c 2061 7820 696e 2065 6e75 6d65 7261  i, ax in enumera
-00027e00: 7465 2873 6b72 742e 696d 6167 652e 5f61  te(skrt.image._a
-00027e10: 7865 7329 3a0a 2020 2020 2020 2020 2020  xes):.          
-00027e20: 2020 2020 2020 2020 2020 636f 6d70 5b66            comp[f
-00027e30: 2263 656e 7472 6f69 645f 7b61 787d 225d  "centroid_{ax}"]
-00027e40: 203d 2063 656e 7472 6f69 645b 695d 0a20   = centroid[i]. 
-00027e50: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
-00027e60: 6d20 3d3d 2022 6162 735f 6365 6e74 726f  m == "abs_centro
-00027e70: 6964 223a 0a20 2020 2020 2020 2020 2020  id":.           
-00027e80: 2020 2020 2063 6f6d 705b 6d5d 203d 2072       comp[m] = r
-00027e90: 6f69 302e 6765 745f 6162 735f 6365 6e74  oi0.get_abs_cent
-00027ea0: 726f 6964 5f64 6973 7461 6e63 6528 0a20  roid_distance(. 
-00027eb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027ec0: 2020 2072 6f69 2c20 0a20 2020 2020 2020     roi, .       
-00027ed0: 2020 2020 2020 2020 2020 2020 2075 6e69               uni
-00027ee0: 7473 3d63 656e 7472 6f69 645f 756e 6974  ts=centroid_unit
-00027ef0: 732c 0a20 2020 2020 2020 2020 2020 2020  s,.             
-00027f00: 2020 2020 2020 206d 6574 686f 643d 6d65         method=me
-00027f10: 7468 6f64 2c20 0a20 2020 2020 2020 2020  thod, .         
-00027f20: 2020 2020 2020 2020 2020 2066 6f72 6365             force
-00027f30: 3d66 6f72 6365 0a20 2020 2020 2020 2020  =force.         
-00027f40: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-00027f50: 2020 2020 2065 6c69 6620 6d20 3d3d 2022       elif m == "
-00027f60: 6162 735f 6365 6e74 726f 6964 5f66 6c61  abs_centroid_fla
-00027f70: 7422 3a0a 2020 2020 2020 2020 2020 2020  t":.            
-00027f80: 2020 2020 636f 6d70 5b6d 5d20 3d20 726f      comp[m] = ro
-00027f90: 6930 2e67 6574 5f61 6273 5f63 656e 7472  i0.get_abs_centr
-00027fa0: 6f69 645f 6469 7374 616e 6365 280a 2020  oid_distance(.  
+000203f0: 6966 2028 736b 7274 2e63 6f72 652e 6973  if (skrt.core.is
+00020400: 5f6c 6973 7428 6361 6c63 756c 6174 6564  _list(calculated
+00020410: 5f73 6c69 6365 5f73 7461 7473 5b6b 6579  _slice_stats[key
+00020420: 5d29 0a20 2020 2020 2020 2020 2020 2020  ]).             
+00020430: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+00020440: 6e64 2073 6570 6172 6174 655f 636f 6d70  nd separate_comp
+00020450: 6f6e 656e 7473 293a 0a20 2020 2020 2020  onents):.       
+00020460: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020470: 2076 6563 746f 7220 3d20 6361 6c63 756c   vector = calcul
+00020480: 6174 6564 5f73 6c69 6365 5f73 7461 7473  ated_slice_stats
+00020490: 2e70 6f70 286b 6579 290a 2020 2020 2020  .pop(key).      
+000204a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000204b0: 2020 666f 7220 692c 2069 5f61 7820 696e    for i, i_ax in
+000204c0: 2065 6e75 6d65 7261 7465 2873 6b72 742e   enumerate(skrt.
+000204d0: 696d 6167 652e 5f70 6c6f 745f 6178 6573  image._plot_axes
+000204e0: 5b76 6965 775d 293a 0a20 2020 2020 2020  [view]):.       
+000204f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020500: 2020 2020 2061 7820 3d20 736b 7274 2e69       ax = skrt.i
+00020510: 6d61 6765 2e5f 6178 6573 5b69 5f61 785d  mage._axes[i_ax]
+00020520: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00020530: 2020 2020 2020 2020 2020 2020 2061 785f               ax_
+00020540: 6b65 7920 3d20 6622 7b6d 6574 7269 637d  key = f"{metric}
+00020550: 5f7b 6178 7d5f 736c 6963 655f 7b62 795f  _{ax}_slice_{by_
+00020560: 736c 6963 657d 5f7b 7374 6174 7d22 0a20  slice}_{stat}". 
+00020570: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020580: 2020 2020 2020 2020 2020 2063 616c 6375             calcu
+00020590: 6c61 7465 645f 736c 6963 655f 7374 6174  lated_slice_stat
+000205a0: 735b 6178 5f6b 6579 5d20 3d20 7665 6374  s[ax_key] = vect
+000205b0: 6f72 5b69 5d0a 0a20 2020 2020 2020 2072  or[i]..        r
+000205c0: 6574 7572 6e20 6361 6c63 756c 6174 6564  eturn calculated
+000205d0: 5f73 6c69 6365 5f73 7461 7473 0a0a 2020  _slice_stats..  
+000205e0: 2020 6465 6620 6d61 7463 685f 6d61 736b    def match_mask
+000205f0: 5f76 6f78 656c 5f73 697a 6528 7365 6c66  _voxel_size(self
+00020600: 2c20 6f74 6865 722c 2076 6f78 656c 5f73  , other, voxel_s
+00020610: 697a 653d 4e6f 6e65 2c0a 2020 2020 2020  ize=None,.      
+00020620: 2020 2020 2020 766f 7865 6c5f 6469 6d5f        voxel_dim_
+00020630: 746f 6c65 7261 6e63 653d 302e 3129 3a0a  tolerance=0.1):.
+00020640: 2020 2020 2020 2020 2727 270a 2020 2020          '''.    
+00020650: 2020 2020 456e 7375 7265 2074 6861 7420      Ensure that 
+00020660: 7468 6520 6d61 736b 2076 6f78 656c 2073  the mask voxel s
+00020670: 697a 6573 206f 6620 3c73 656c 663e 2061  izes of <self> a
+00020680: 6e64 203c 6f74 6865 723e 206d 6174 6368  nd <other> match
+00020690: 2e0a 0a20 2020 2020 2020 2054 6865 206d  ...        The m
+000206a0: 6173 6b20 766f 7865 6c5f 7369 7a65 7320  ask voxel_sizes 
+000206b0: 666f 7220 626f 7468 206d 6179 206f 7074  for both may opt
+000206c0: 696f 6e61 6c6c 7920 6265 2073 6574 2074  ionally be set t
+000206d0: 6f20 6120 6e65 770a 2020 2020 2020 2020  o a new.        
+000206e0: 636f 6d6d 6f6e 2076 616c 7565 2e0a 0a20  common value... 
+000206f0: 2020 2020 2020 202a 2a50 6172 616d 7465         **Paramte
+00020700: 7273 3a2a 2a0a 0a20 2020 2020 2020 206f  rs:**..        o
+00020710: 7468 6572 203a 2073 6b72 742e 7374 7275  ther : skrt.stru
+00020720: 6374 7572 6573 2e52 4f49 0a20 2020 2020  ctures.ROI.     
+00020730: 2020 2020 2020 2052 4f49 2077 6974 6820         ROI with 
+00020740: 7768 6963 6820 766f 7865 6c20 7369 7a65  which voxel size
+00020750: 2069 7320 746f 2062 6520 6d61 7463 6865   is to be matche
+00020760: 642e 0a0a 2020 2020 2020 2020 766f 7865  d...        voxe
+00020770: 6c5f 7369 7a65 203a 2074 7570 6c65 2c20  l_size : tuple, 
+00020780: 6465 6661 756c 743d 4e6f 6e65 0a20 2020  default=None.   
+00020790: 2020 2020 2020 2020 2056 6f78 656c 2073           Voxel s
+000207a0: 697a 6520 2864 782c 2064 792c 2064 7a29  ize (dx, dy, dz)
+000207b0: 2069 6e20 6d6d 2074 6f20 6265 2075 7365   in mm to be use
+000207c0: 6420 666f 7220 524f 4920 6d61 736b 730a  d for ROI masks.
+000207d0: 2020 2020 2020 2020 2020 2020 6672 6f6d              from
+000207e0: 2077 6869 6368 2074 6f20 6361 6c63 756c   which to calcul
+000207f0: 6174 6520 7375 7266 6163 6520 6469 7374  ate surface dist
+00020800: 616e 6365 732e 2020 4966 204e 6f6e 652c  ances.  If None,
+00020810: 0a20 2020 2020 2020 2020 2020 2074 6865  .            the
+00020820: 206d 6173 6b20 766f 7865 6c20 7369 7a65   mask voxel size
+00020830: 206f 6620 3c6f 7468 6572 3e20 6973 2075   of <other> is u
+00020840: 7365 6420 6966 206e 6f74 204e 6f6e 653b  sed if not None;
+00020850: 0a20 2020 2020 2020 2020 2020 206f 7468  .            oth
+00020860: 6572 7769 7365 2074 6865 2064 6566 6175  erwise the defau
+00020870: 6c74 2076 6f78 656c 2073 697a 6520 666f  lt voxel size fo
+00020880: 7220 6475 6d6d 7920 696d 6167 6573 2c0a  r dummy images,.
+00020890: 2020 2020 2020 2020 2020 2020 6e61 6d65              name
+000208a0: 6c79 2028 312c 2031 2c20 3129 2c20 6973  ly (1, 1, 1), is
+000208b0: 2075 7365 642e 2020 4966 2061 6e20 656c   used.  If an el
+000208c0: 656d 656e 7420 6f66 2074 6865 0a20 2020  ement of the.   
+000208d0: 2020 2020 2020 2020 2074 7570 6c65 2073           tuple s
+000208e0: 7065 6369 6679 696e 6720 766f 7865 6c20  pecifying voxel 
+000208f0: 7369 7a65 2069 7320 4e6f 6e65 2c20 7468  size is None, th
+00020900: 6520 7661 6c75 6520 666f 720a 2020 2020  e value for.    
+00020910: 2020 2020 2020 2020 7468 6520 636f 7272          the corr
+00020920: 6573 706f 6e64 696e 6720 656c 656d 656e  esponding elemen
+00020930: 7420 6f66 2074 6865 206d 6173 6b20 766f  t of the mask vo
+00020940: 7865 6c20 7369 7a65 206f 660a 2020 2020  xel size of.    
+00020950: 2020 2020 2020 2020 3c6f 7468 6572 3e20          <other> 
+00020960: 6973 2075 7365 642e 0a0a 2020 2020 2020  is used...      
+00020970: 2020 766f 7865 6c5f 6469 6d5f 746f 6c65    voxel_dim_tole
+00020980: 7261 6e63 6520 3a20 666c 6f61 742c 2064  rance : float, d
+00020990: 6566 6175 6c74 3d30 2e31 0a20 2020 2020  efault=0.1.     
+000209a0: 2020 2020 2020 204d 6178 696d 756d 2061         Maximum a
+000209b0: 6363 6570 7465 6420 7661 6c75 6520 666f  ccepted value fo
+000209c0: 7220 7468 6520 6162 736f 6c75 7465 2064  r the absolute d
+000209d0: 6966 6665 7265 6e63 6520 696e 2076 6f78  ifference in vox
+000209e0: 656c 2073 697a 650a 2020 2020 2020 2020  el size.        
+000209f0: 2020 2020 2861 6e79 2064 696d 656e 7369      (any dimensi
+00020a00: 6f6e 2920 6f66 2074 6865 2052 4f49 206d  on) of the ROI m
+00020a10: 6173 6b73 2066 6f72 2074 6865 6d20 746f  asks for them to
+00020a20: 2062 6520 636f 6e73 6964 6572 6564 0a20   be considered. 
+00020a30: 2020 2020 2020 2020 2020 2061 7320 6861             as ha
+00020a40: 7669 6e67 2074 6865 2073 616d 6520 766f  ving the same vo
+00020a50: 7865 6c20 7369 7a65 2e20 2049 6620 6120  xel size.  If a 
+00020a60: 6e65 6761 7469 7665 2076 616c 7565 2069  negative value i
+00020a70: 7320 6769 7665 6e2c 0a20 2020 2020 2020  s given,.       
+00020a80: 2020 2020 2074 6865 2061 6273 6f6c 7574       the absolut
+00020a90: 6520 6469 6666 6572 656e 6365 2069 7320  e difference is 
+00020aa0: 6e65 7665 7220 6265 6c6f 7720 7468 6973  never below this
+00020ab0: 2c20 666f 7263 696e 6720 6372 6561 7469  , forcing creati
+00020ac0: 6f6e 0a20 2020 2020 2020 2020 2020 206f  on.            o
+00020ad0: 6620 6e65 7720 6d61 736b 7320 7769 7468  f new masks with
+00020ae0: 2074 6865 2074 6865 2073 7065 6369 6669   the the specifi
+00020af0: 6564 2076 6f78 656c 2073 697a 652e 2020  ed voxel size.  
+00020b00: 5468 6973 2063 616e 2062 650a 2020 2020  This can be.    
+00020b10: 2020 2020 2020 2020 7573 6566 756c 2066          useful f
+00020b20: 6f72 206f 6274 6169 6e69 6e67 206d 6173  or obtaining mas
+00020b30: 6b73 2074 6861 7420 6172 6520 6a75 7374  ks that are just
+00020b40: 206c 6172 6765 2065 6e6f 7567 6820 746f   large enough to
+00020b50: 2063 6f6e 7461 696e 0a20 2020 2020 2020   contain.       
+00020b60: 2020 2020 2062 6f74 6820 524f 4973 2c20       both ROIs, 
+00020b70: 706f 7465 6e74 6961 6c6c 7920 7265 6475  potentially redu
+00020b80: 6369 6e67 2074 6865 2074 696d 6520 666f  cing the time fo
+00020b90: 7220 7375 7266 6163 652d 6469 7374 616e  r surface-distan
+00020ba0: 6365 0a20 2020 2020 2020 2020 2020 2063  ce.            c
+00020bb0: 616c 6375 6c61 7469 6f6e 732e 0a20 2020  alculations..   
+00020bc0: 2020 2020 2027 2727 0a20 2020 2020 2020       '''.       
+00020bd0: 2023 2043 7265 6174 6520 524f 4920 636c   # Create ROI cl
+00020be0: 6f6e 6573 2c20 666f 7220 7768 6963 6820  ones, for which 
+00020bf0: 766f 7865 6c20 7369 7a65 7320 6d61 7920  voxel sizes may 
+00020c00: 6265 2061 6c74 6572 6564 2e0a 2020 2020  be altered..    
+00020c10: 2020 2020 726f 6931 203d 2073 656c 662e      roi1 = self.
+00020c20: 636c 6f6e 6528 290a 2020 2020 2020 2020  clone().        
+00020c30: 726f 6932 203d 206f 7468 6572 2e63 6c6f  roi2 = other.clo
+00020c40: 6e65 2829 0a0a 2020 2020 2020 2020 2320  ne()..        # 
+00020c50: 4173 736f 6369 6174 6520 6e65 7720 6475  Associate new du
+00020c60: 6d6d 7920 696d 6167 6520 7769 7468 2052  mmy image with R
+00020c70: 4f49 7320 6966 2072 6571 7565 7374 6564  OIs if requested
+00020c80: 2076 6f78 656c 2073 697a 650a 2020 2020   voxel size.    
+00020c90: 2020 2020 2320 6973 2064 6966 6665 7265      # is differe
+00020ca0: 6e74 2066 726f 6d20 766f 7865 6c20 7369  nt from voxel si
+00020cb0: 7a65 206f 6620 6569 7468 6572 2063 7572  ze of either cur
+00020cc0: 7265 6e74 2069 6d61 6765 2c0a 2020 2020  rent image,.    
+00020cd0: 2020 2020 2320 6f72 2069 6620 6162 736f      # or if abso
+00020ce0: 6c75 7465 2064 6966 6665 7265 6e63 6520  lute difference 
+00020cf0: 696e 2061 6e79 2064 696d 656e 7369 6f6e  in any dimension
+00020d00: 2062 6574 7765 656e 2076 6f78 656c 2073   between voxel s
+00020d10: 697a 6573 0a20 2020 2020 2020 2023 206f  izes.        # o
+00020d20: 6620 6375 7272 656e 7420 696d 6167 6573  f current images
+00020d30: 2064 6f6e 2774 206d 6174 6368 2069 7320   don't match is 
+00020d40: 6772 6561 7465 7220 7468 616e 2074 6f6c  greater than tol
+00020d50: 6572 616e 6365 2e0a 2020 2020 2020 2020  erance..        
+00020d60: 766f 7865 6c5f 7369 7a65 203d 2076 6f78  voxel_size = vox
+00020d70: 656c 5f73 697a 6520 6966 2076 6f78 656c  el_size if voxel
+00020d80: 5f73 697a 6520 656c 7365 2072 6f69 322e  _size else roi2.
+00020d90: 6765 745f 766f 7865 6c5f 7369 7a65 2829  get_voxel_size()
+00020da0: 0a20 2020 2020 2020 2069 6620 766f 7865  .        if voxe
+00020db0: 6c5f 7369 7a65 2061 6e64 2072 6f69 322e  l_size and roi2.
+00020dc0: 6765 745f 766f 7865 6c5f 7369 7a65 2829  get_voxel_size()
+00020dd0: 3a0a 2020 2020 2020 2020 2020 2020 766f  :.            vo
+00020de0: 7865 6c5f 7369 7a65 203d 205b 766f 7865  xel_size = [voxe
+00020df0: 6c5f 7369 7a65 5b69 6478 5d20 6966 2076  l_size[idx] if v
+00020e00: 6f78 656c 5f73 697a 655b 6964 785d 2069  oxel_size[idx] i
+00020e10: 7320 6e6f 7420 4e6f 6e65 0a20 2020 2020  s not None.     
+00020e20: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+00020e30: 6c73 6520 726f 6932 2e67 6574 5f76 6f78  lse roi2.get_vox
+00020e40: 656c 5f73 697a 6528 295b 6964 785d 2066  el_size()[idx] f
+00020e50: 6f72 2069 6478 2069 6e20 7261 6e67 6528  or idx in range(
+00020e60: 3329 5d0a 2020 2020 2020 2020 7265 7369  3)].        resi
+00020e70: 7a65 203d 206e 6f74 2072 6f69 312e 6765  ze = not roi1.ge
+00020e80: 745f 766f 7865 6c5f 7369 7a65 2829 206f  t_voxel_size() o
+00020e90: 7220 6e6f 7420 726f 6932 2e67 6574 5f76  r not roi2.get_v
+00020ea0: 6f78 656c 5f73 697a 6528 290a 2020 2020  oxel_size().    
+00020eb0: 2020 2020 6966 206e 6f74 2072 6573 697a      if not resiz
+00020ec0: 653a 0a20 2020 2020 2020 2020 2020 2066  e:.            f
+00020ed0: 6f72 2072 6f69 2069 6e20 5b72 6f69 312c  or roi in [roi1,
+00020ee0: 2072 6f69 325d 3a0a 2020 2020 2020 2020   roi2]:.        
+00020ef0: 2020 2020 2020 2020 6d61 7463 6865 7320          matches 
+00020f00: 3d20 5b64 7879 7a31 2066 6f72 2064 7879  = [dxyz1 for dxy
+00020f10: 7a31 2c20 6478 797a 3220 696e 0a20 2020  z1, dxyz2 in.   
+00020f20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020f30: 2020 2020 207a 6970 2876 6f78 656c 5f73       zip(voxel_s
+00020f40: 697a 652c 2072 6f69 2e76 6f78 656c 5f73  ize, roi.voxel_s
+00020f50: 697a 6529 0a20 2020 2020 2020 2020 2020  ize).           
+00020f60: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00020f70: 6162 7328 6478 797a 3120 2d20 6478 797a  abs(dxyz1 - dxyz
+00020f80: 3229 203c 2076 6f78 656c 5f64 696d 5f74  2) < voxel_dim_t
+00020f90: 6f6c 6572 616e 6365 5d0a 2020 2020 2020  olerance].      
+00020fa0: 2020 2020 2020 2020 2020 6966 2033 2021            if 3 !
+00020fb0: 3d20 6c65 6e28 6d61 7463 6865 7329 3a0a  = len(matches):.
+00020fc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020fd0: 2020 2020 7265 7369 7a65 203d 2054 7275      resize = Tru
+00020fe0: 650a 2020 2020 2020 2020 6966 2072 6573  e.        if res
+00020ff0: 697a 653a 0a20 2020 2020 2020 2020 2020  ize:.           
+00021000: 2069 6620 766f 7865 6c5f 7369 7a65 3a0a   if voxel_size:.
+00021010: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021020: 736c 6963 655f 7468 6963 6b6e 6573 7320  slice_thickness 
+00021030: 3d20 766f 7865 6c5f 7369 7a65 5b32 5d0a  = voxel_size[2].
+00021040: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021050: 766f 7865 6c5f 7369 7a65 5f32 6420 3d20  voxel_size_2d = 
+00021060: 766f 7865 6c5f 7369 7a65 5b3a 325d 0a20  voxel_size[:2]. 
+00021070: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+00021080: 2045 6e73 7572 6520 7468 6174 2069 6e69   Ensure that ini
+00021090: 7469 616c 2076 6f78 656c 2073 697a 6520  tial voxel size 
+000210a0: 6973 2073 6574 2e0a 2020 2020 2020 2020  is set..        
+000210b0: 2020 2020 2020 2020 2320 5468 6973 2069          # This i
+000210c0: 7320 7573 6564 2074 6f20 6465 6669 6e65  s used to define
+000210d0: 2073 6c69 6365 2074 6869 636b 6e65 7373   slice thickness
+000210e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000210f0: 2023 2066 6f72 2061 6e20 524f 4920 7468   # for an ROI th
+00021100: 6174 2068 6173 206e 6f20 6173 736f 6369  at has no associ
+00021110: 6174 6564 2069 6d61 6765 2c0a 2020 2020  ated image,.    
+00021120: 2020 2020 2020 2020 2020 2020 2320 616e              # an
+00021130: 6420 6973 2064 6566 696e 6564 2062 7920  d is defined by 
+00021140: 6f6e 6520 6f72 206d 6f72 6520 636f 6e74  one or more cont
+00021150: 6f75 7273 206f 6e20 6120 7369 6e67 6c65  ours on a single
+00021160: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00021170: 2023 2069 6d61 6765 2073 6c69 6365 2e0a   # image slice..
+00021180: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021190: 6966 206e 6f74 2072 6f69 312e 766f 7865  if not roi1.voxe
+000211a0: 6c5f 7369 7a65 3a0a 2020 2020 2020 2020  l_size:.        
+000211b0: 2020 2020 2020 2020 2020 2020 726f 6931              roi1
+000211c0: 2e76 6f78 656c 5f73 697a 6520 3d20 766f  .voxel_size = vo
+000211d0: 7865 6c5f 7369 7a65 0a20 2020 2020 2020  xel_size.       
+000211e0: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
+000211f0: 726f 6932 2e76 6f78 656c 5f73 697a 653a  roi2.voxel_size:
+00021200: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00021210: 2020 2020 2072 6f69 322e 766f 7865 6c5f       roi2.voxel_
+00021220: 7369 7a65 203d 2076 6f78 656c 5f73 697a  size = voxel_siz
+00021230: 650a 2020 2020 2020 2020 2020 2020 656c  e.            el
+00021240: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+00021250: 2020 2020 736c 6963 655f 7468 6963 6b6e      slice_thickn
+00021260: 6573 7320 3d20 4e6f 6e65 0a20 2020 2020  ess = None.     
+00021270: 2020 2020 2020 2020 2020 2076 6f78 656c             voxel
+00021280: 5f73 697a 655f 3264 203d 204e 6f6e 650a  _size_2d = None.
+00021290: 0a20 2020 2020 2020 2020 2020 2053 7472  .            Str
+000212a0: 7563 7475 7265 5365 7428 5b72 6f69 312c  uctureSet([roi1,
+000212b0: 2072 6f69 325d 292e 7365 745f 696d 6167   roi2]).set_imag
+000212c0: 655f 746f 5f64 756d 6d79 280a 2020 2020  e_to_dummy(.    
+000212d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000212e0: 736c 6963 655f 7468 6963 6b6e 6573 733d  slice_thickness=
+000212f0: 736c 6963 655f 7468 6963 6b6e 6573 732c  slice_thickness,
+00021300: 2076 6f78 656c 5f73 697a 653d 766f 7865   voxel_size=voxe
+00021310: 6c5f 7369 7a65 5f32 6429 0a0a 2020 2020  l_size_2d)..    
+00021320: 2020 2020 7265 7475 726e 2028 726f 6931      return (roi1
+00021330: 2c20 726f 6932 290a 0a20 2020 2064 6566  , roi2)..    def
+00021340: 2067 6574 5f73 7572 6661 6365 5f64 6973   get_surface_dis
+00021350: 7461 6e63 6573 280a 2020 2020 2020 2020  tances(.        
+00021360: 7365 6c66 2c0a 2020 2020 2020 2020 6f74  self,.        ot
+00021370: 6865 722c 0a20 2020 2020 2020 2073 696e  her,.        sin
+00021380: 676c 655f 736c 6963 653d 4661 6c73 652c  gle_slice=False,
+00021390: 0a20 2020 2020 2020 2073 6967 6e65 643d  .        signed=
+000213a0: 4661 6c73 652c 0a20 2020 2020 2020 2076  False,.        v
+000213b0: 6965 773d 2278 2d79 222c 0a20 2020 2020  iew="x-y",.     
+000213c0: 2020 2073 6c3d 4e6f 6e65 2c0a 2020 2020     sl=None,.    
+000213d0: 2020 2020 6964 783d 4e6f 6e65 2c0a 2020      idx=None,.  
+000213e0: 2020 2020 2020 706f 733d 4e6f 6e65 2c0a        pos=None,.
+000213f0: 2020 2020 2020 2020 636f 6e6e 6563 7469          connecti
+00021400: 7669 7479 3d32 2c0a 2020 2020 2020 2020  vity=2,.        
+00021410: 666c 6174 7465 6e3d 4661 6c73 652c 0a20  flatten=False,. 
+00021420: 2020 2020 2020 2073 796d 6d65 7472 6963         symmetric
+00021430: 3d4e 6f6e 652c 0a20 2020 2020 2020 2063  =None,.        c
+00021440: 6f6e 666f 726d 6974 793d 4661 6c73 652c  onformity=False,
+00021450: 0a20 2020 2020 2020 2069 6e5f 736c 6963  .        in_slic
+00021460: 653d 5472 7565 2c0a 2020 2020 2020 2020  e=True,.        
+00021470: 766f 7865 6c5f 7369 7a65 3d4e 6f6e 652c  voxel_size=None,
+00021480: 0a20 2020 2020 2020 2076 6f78 656c 5f64  .        voxel_d
+00021490: 696d 5f74 6f6c 6572 616e 6365 3d30 2e31  im_tolerance=0.1
+000214a0: 2c0a 2020 2020 293a 0a20 2020 2020 2020  ,.    ):.       
+000214b0: 2022 2222 0a20 2020 2020 2020 2047 6574   """.        Get
+000214c0: 2076 6563 746f 7220 6f66 2073 7572 6661   vector of surfa
+000214d0: 6365 2064 6973 7461 6e63 6573 2062 6574  ce distances bet
+000214e0: 7765 656e 2074 776f 2052 4f49 732e 0a0a  ween two ROIs...
+000214f0: 2020 2020 2020 2020 5375 7266 6163 6520          Surface 
+00021500: 6469 7374 616e 6365 7320 6d61 7920 6265  distances may be
+00021510: 2073 6967 6e65 6420 6f72 2075 6e73 6967   signed or unsig
+00021520: 6e65 642c 2061 6e64 206d 6179 2062 6520  ned, and may be 
+00021530: 666f 7220 6120 7369 6e67 6c65 0a20 2020  for a single.   
+00021540: 2020 2020 2073 6c69 6365 2074 6872 6f75       slice throu
+00021550: 6768 2074 6865 2052 4f49 732c 206f 7220  gh the ROIs, or 
+00021560: 666f 7220 7468 6520 3344 2076 6f6c 756d  for the 3D volum
+00021570: 6573 2e20 200a 0a20 2020 2020 2020 2054  es.  ..        T
+00021580: 6869 7320 6675 6e63 7469 6f6e 2075 7365  his function use
+00021590: 7320 6964 6561 7320 6f75 746c 696e 6564  s ideas outlined
+000215a0: 2061 743a 0a20 2020 2020 2020 2068 7474   at:.        htt
+000215b0: 7073 3a2f 2f6d 6c6e 6f74 6562 6f6f 6b2e  ps://mlnotebook.
+000215c0: 6769 7468 7562 2e69 6f2f 706f 7374 2f73  github.io/post/s
+000215d0: 7572 6661 6365 2d64 6973 7461 6e63 652d  urface-distance-
+000215e0: 6675 6e63 7469 6f6e 2f0a 0a20 2020 2020  function/..     
+000215f0: 2020 202a 2a50 6172 616d 6574 6572 733a     **Parameters:
+00021600: 2a2a 0a0a 2020 2020 2020 2020 7369 6e67  **..        sing
+00021610: 6c65 5f73 6c69 6365 203a 2062 6f6f 6c2c  le_slice : bool,
+00021620: 2064 6566 6175 6c74 3d46 616c 7365 0a20   default=False. 
+00021630: 2020 2020 2020 2020 2020 2049 6620 4661             If Fa
+00021640: 6c73 652c 2072 6574 7572 6e20 7375 7266  lse, return surf
+00021650: 6163 6520 6469 7374 616e 6365 7320 7265  ace distances re
+00021660: 6c61 7469 7665 2074 6f20 3344 2076 6f6c  lative to 3D vol
+00021670: 756d 6573 2e0a 2020 2020 2020 2020 2020  umes..          
+00021680: 2020 4f74 6865 7277 6973 652c 2072 6574    Otherwise, ret
+00021690: 7572 6e20 7375 7266 6163 6520 6469 7374  urn surface dist
+000216a0: 616e 6365 7320 666f 7220 6120 7369 6e67  ances for a sing
+000216b0: 6c65 2069 6d61 6765 2073 6c69 6365 2e0a  le image slice..
+000216c0: 0a20 2020 2020 2020 2073 6967 6e65 6420  .        signed 
+000216d0: 3a20 626f 6f6c 2c20 6465 6661 756c 743d  : bool, default=
+000216e0: 4661 6c73 650a 2020 2020 2020 2020 2020  False.          
+000216f0: 2020 4966 2046 616c 7365 2c20 7265 7475    If False, retu
+00021700: 726e 2061 6273 6f6c 7574 6520 7375 7266  rn absolute surf
+00021710: 6163 6520 6469 7374 616e 6365 732e 0a20  ace distances.. 
+00021720: 2020 2020 2020 2020 2020 2049 6620 5472             If Tr
+00021730: 7565 2c20 7265 7475 726e 2073 6967 6e65  ue, return signe
+00021740: 6420 7375 7266 6163 6520 6469 7374 616e  d surface distan
+00021750: 6365 732e 2020 4120 706f 696e 7420 6f6e  ces.  A point on
+00021760: 2074 6865 0a20 2020 2020 2020 2020 2020   the.           
+00021770: 2073 7572 6661 6365 206f 6620 3c6f 7468   surface of <oth
+00021780: 6572 3e20 6973 2074 616b 656e 2074 6f20  er> is taken to 
+00021790: 6265 2061 7420 6120 706f 7369 7469 7665  be at a positive
+000217a0: 2064 6973 7461 6e63 6520 6966 0a20 2020   distance if.   
+000217b0: 2020 2020 2020 2020 206f 7574 7369 6465           outside
+000217c0: 203c 7365 6c66 3e2c 2061 6e64 2061 7420   <self>, and at 
+000217d0: 6120 6e65 6761 7469 7665 2064 6973 7461  a negative dista
+000217e0: 6e63 6520 6966 2069 6e73 6964 652e 0a0a  nce if inside...
+000217f0: 2020 2020 2020 2020 7669 6577 203a 2073          view : s
+00021800: 7472 2c20 6465 6661 756c 743d 2278 2d79  tr, default="x-y
+00021810: 220a 2020 2020 2020 2020 2020 2020 4f72  ".            Or
+00021820: 6965 6e74 6174 696f 6e20 6f66 2073 6c69  ientation of sli
+00021830: 6365 2066 6f72 2077 6869 6368 2074 6f20  ce for which to 
+00021840: 6f62 7461 696e 2073 7572 6661 6365 2064  obtain surface d
+00021850: 6973 7461 6e63 6573 2e0a 2020 2020 2020  istances..      
+00021860: 2020 2020 2020 4f6e 6c79 2075 7365 6420        Only used 
+00021870: 6966 2065 6974 6865 7220 3c73 696e 676c  if either <singl
+00021880: 655f 736c 6963 653e 206f 7220 3c66 6c61  e_slice> or <fla
+00021890: 7474 656e 3e20 6973 2054 7275 652e 0a0a  tten> is True...
+000218a0: 2020 2020 2020 2020 736c 203a 2069 6e74          sl : int
+000218b0: 2c20 6465 6661 756c 743d 4e6f 6e65 0a20  , default=None. 
+000218c0: 2020 2020 2020 2020 2020 2053 6c69 6365             Slice
+000218d0: 206e 756d 6265 722e 2049 6620 6e6f 6e65   number. If none
+000218e0: 206f 6620 3c73 6c3e 2c20 3c69 6478 3e20   of <sl>, <idx> 
+000218f0: 6f72 203c 706f 733e 2069 7320 7375 7070  or <pos> is supp
+00021900: 6c69 6564 2062 7574 0a20 2020 2020 2020  lied but.       
+00021910: 2020 2020 203c 7369 6e67 6c65 5f73 6c69       <single_sli
+00021920: 6365 3e20 6973 2054 7275 652c 2074 6865  ce> is True, the
+00021930: 2063 656e 7472 616c 2073 6c69 6365 206f   central slice o
+00021940: 6620 7468 6520 524f 4920 7769 6c6c 2062  f the ROI will b
+00021950: 6520 7573 6564 2e0a 0a20 2020 2020 2020  e used...       
+00021960: 2069 6478 203a 2069 6e74 2c20 6465 6661   idx : int, defa
+00021970: 756c 743d 4e6f 6e65 0a20 2020 2020 2020  ult=None.       
+00021980: 2020 2020 2041 7272 6179 2069 6e64 6578       Array index
+00021990: 206f 6620 736c 6963 652e 2049 6620 6e6f   of slice. If no
+000219a0: 6e65 206f 6620 3c73 6c3e 2c20 3c69 6478  ne of <sl>, <idx
+000219b0: 3e20 6f72 203c 706f 733e 2069 7320 0a20  > or <pos> is . 
+000219c0: 2020 2020 2020 2020 2020 2073 7570 706c             suppl
+000219d0: 6965 6420 6275 7420 3c73 696e 676c 655f  ied but <single_
+000219e0: 736c 6963 653e 2069 7320 5472 7565 2c20  slice> is True, 
+000219f0: 7468 6520 6365 6e74 7261 6c20 736c 6963  the central slic
+00021a00: 6520 6f66 0a20 2020 2020 2020 2020 2020  e of.           
+00021a10: 2074 6865 2052 4f49 2077 696c 6c20 6265   the ROI will be
+00021a20: 2075 7365 642e 0a0a 2020 2020 2020 2020   used...        
+00021a30: 706f 7320 3a20 666c 6f61 742c 2064 6566  pos : float, def
+00021a40: 6175 6c74 3d4e 6f6e 650a 2020 2020 2020  ault=None.      
+00021a50: 2020 2020 2020 536c 6963 6520 706f 7369        Slice posi
+00021a60: 7469 6f6e 2069 6e20 6d6d 2e20 4966 206e  tion in mm. If n
+00021a70: 6f6e 6520 6f66 203c 736c 3e2c 203c 6964  one of <sl>, <id
+00021a80: 783e 206f 7220 3c70 6f73 3e20 6973 2073  x> or <pos> is s
+00021a90: 7570 706c 6965 640a 2020 2020 2020 2020  upplied.        
+00021aa0: 2020 2020 6275 7420 3c73 696e 676c 655f      but <single_
+00021ab0: 736c 6963 653e 2069 7320 5472 7565 2c20  slice> is True, 
+00021ac0: 7468 6520 6365 6e74 7261 6c20 736c 6963  the central slic
+00021ad0: 6520 6f66 2074 6865 2052 4f49 2077 696c  e of the ROI wil
+00021ae0: 6c0a 2020 2020 2020 2020 2020 2020 6265  l.            be
+00021af0: 2075 7365 642e 0a0a 2020 2020 2020 2020   used...        
+00021b00: 636f 6e6e 6563 7469 7669 7479 3a20 696e  connectivity: in
+00021b10: 742c 2064 6566 6175 6c74 3d32 0a20 2020  t, default=2.   
+00021b20: 2020 2020 2020 2020 2049 6e74 6567 6572           Integer
+00021b30: 2064 6566 696e 696e 6720 7768 6963 6820   defining which 
+00021b40: 766f 7865 6c73 2074 6f20 636f 6e73 6964  voxels to consid
+00021b50: 6572 2061 7320 6e65 6967 6862 6f75 7273  er as neighbours
+00021b60: 0a20 2020 2020 2020 2020 2020 2077 6865  .            whe
+00021b70: 6e20 7065 7266 6f72 6d69 6e67 2065 726f  n performing ero
+00021b80: 7369 6f6e 206f 7065 7261 7469 6f6e 2074  sion operation t
+00021b90: 6f20 6964 656e 7469 6679 2052 4f49 2073  o identify ROI s
+00021ba0: 7572 6661 6365 732e 2020 5468 6973 0a20  urfaces.  This. 
+00021bb0: 2020 2020 2020 2020 2020 2069 7320 7061             is pa
+00021bc0: 7373 6564 2061 7320 3c63 6f6e 6e65 6374  ssed as <connect
+00021bd0: 6976 6974 793e 2070 6172 616d 6574 6572  ivity> parameter
+00021be0: 2074 6f3a 0a20 2020 2020 2020 2020 2020   to:.           
+00021bf0: 2073 6369 7079 2e6e 6469 6d61 6765 2e67   scipy.ndimage.g
+00021c00: 656e 6572 6174 655f 6269 6e61 7279 5f73  enerate_binary_s
+00021c10: 7472 7563 7475 7265 0a20 2020 2020 2020  tructure.       
+00021c20: 2020 2020 2046 6f72 2066 7572 7468 6572       For further
+00021c30: 2064 6574 6169 6c73 2c20 7365 653a 0a20   details, see:. 
+00021c40: 2020 2020 2020 2020 2020 2068 7474 7073             https
+00021c50: 3a2f 2f64 6f63 732e 7363 6970 792e 6f72  ://docs.scipy.or
+00021c60: 672f 646f 632f 7363 6970 792f 7265 6665  g/doc/scipy/refe
+00021c70: 7265 6e63 652f 6765 6e65 7261 7465 642f  rence/generated/
+00021c80: 7363 6970 792e 6e64 696d 6167 652e 6765  scipy.ndimage.ge
+00021c90: 6e65 7261 7465 5f62 696e 6172 795f 7374  nerate_binary_st
+00021ca0: 7275 6374 7572 652e 6874 6d6c 0a0a 2020  ructure.html..  
+00021cb0: 2020 2020 2020 666c 6174 7465 6e20 3a20        flatten : 
+00021cc0: 626f 6f6c 2c20 6465 6661 756c 743d 4661  bool, default=Fa
+00021cd0: 6c73 650a 2020 2020 2020 2020 2020 2020  lse.            
+00021ce0: 4966 2054 7275 652c 2061 6c6c 2073 6c69  If True, all sli
+00021cf0: 6365 7320 666f 7220 6561 6368 2052 4f49  ces for each ROI
+00021d00: 2077 696c 6c20 6265 2066 6c61 7474 656e   will be flatten
+00021d10: 6564 2069 6e20 7468 6520 6769 7665 6e0a  ed in the given.
+00021d20: 2020 2020 2020 2020 2020 2020 6f72 6965              orie
+00021d30: 6e74 6174 696f 6e2c 2061 6e64 2073 7572  ntation, and sur
+00021d40: 6661 6365 2064 6973 7461 6e63 6573 2072  face distances r
+00021d50: 656c 6174 6976 6520 746f 2074 6865 2066  elative to the f
+00021d60: 6c61 7474 656e 6564 0a20 2020 2020 2020  lattened.       
+00021d70: 2020 2020 2073 6c69 6365 2077 696c 6c20       slice will 
+00021d80: 6265 2072 6574 7572 6e65 642e 0a0a 2020  be returned...  
+00021d90: 2020 2020 2020 7379 6d6d 6574 7269 6320        symmetric 
+00021da0: 3a20 626f 6f6c 2c20 6465 6661 756c 743d  : bool, default=
+00021db0: 4e6f 6e65 0a20 2020 2020 2020 2020 2020  None.           
+00021dc0: 2049 6620 5472 7565 2c20 7468 6520 6469   If True, the di
+00021dd0: 7374 616e 6365 7320 7265 7475 726e 6564  stances returned
+00021de0: 2061 7265 2066 726f 6d20 7468 6520 7375   are from the su
+00021df0: 7266 6163 6520 6f66 203c 6f74 6865 723e  rface of <other>
+00021e00: 0a20 2020 2020 2020 2020 2020 2074 6f20  .            to 
+00021e10: 7468 6520 7375 7266 6163 6520 6f66 203c  the surface of <
+00021e20: 7365 6c66 3e20 616e 6420 6672 6f6d 2074  self> and from t
+00021e30: 6865 2073 7572 6661 6365 206f 6620 3c73  he surface of <s
+00021e40: 656c 663e 2074 6f20 7468 650a 2020 2020  elf> to the.    
+00021e50: 2020 2020 2020 2020 7375 7266 6163 6520          surface 
+00021e60: 6f66 203c 6f74 6865 723e 2e20 2049 6620  of <other>.  If 
+00021e70: 4661 6c73 652c 2064 6973 7461 6e63 6573  False, distances
+00021e80: 2061 7265 2066 726f 6d20 7468 6520 7375   are from the su
+00021e90: 7266 6163 650a 2020 2020 2020 2020 2020  rface.          
+00021ea0: 2020 6f66 203c 6f74 6865 723e 2074 6f20    of <other> to 
+00021eb0: 7468 6520 7375 7266 6163 6520 6f66 203c  the surface of <
+00021ec0: 7365 6c66 3e20 6f6e 6c79 2e20 2049 6620  self> only.  If 
+00021ed0: 4e6f 6e65 2c20 7365 7420 746f 0a20 2020  None, set to.   
+00021ee0: 2020 2020 2020 2020 2074 6865 206f 7070           the opp
+00021ef0: 6f73 6973 7465 206f 6620 3c73 6967 6e65  osiste of <signe
+00021f00: 643e 2e0a 0a20 2020 2020 2020 2020 636f  d>...         co
+00021f10: 6e66 6f72 6d69 7479 203a 2062 6f6f 6c2c  nformity : bool,
+00021f20: 2064 6566 6175 6c74 3d46 616c 7365 0a20   default=False. 
+00021f30: 2020 2020 2020 2020 2020 2020 4966 2054              If T
+00021f40: 7275 652c 2064 6973 7461 6e63 6573 2072  rue, distances r
+00021f50: 6574 7572 6e65 6420 6172 6520 7369 676e  eturned are sign
+00021f60: 6564 2064 6973 7461 6e63 6573 2074 6f20  ed distances to 
+00021f70: 636f 6e66 6f72 6d69 7479 2c0a 2020 2020  conformity,.    
+00021f80: 2020 2020 2020 2020 2061 7320 6465 6669           as defi
+00021f90: 6e65 6420 696e 3a0a 2020 2020 2020 2020  ned in:.        
+00021fa0: 2020 2020 2068 7474 7073 3a2f 2f64 6f69       https://doi
+00021fb0: 2e6f 7267 2f31 302e 3132 3539 2f62 6a72  .org/10.1259/bjr
+00021fc0: 2f32 3736 3734 3538 310a 2020 2020 2020  /27674581.      
+00021fd0: 2020 2020 2020 2049 6e20 7468 6973 2063         In this c
+00021fe0: 6173 652c 2074 6865 2076 616c 7565 7320  ase, the values 
+00021ff0: 6f66 203c 7369 676e 6564 3e20 616e 6420  of <signed> and 
+00022000: 3c73 796d 6d65 7472 6963 3e0a 2020 2020  <symmetric>.    
+00022010: 2020 2020 2020 2020 2061 7265 2064 6973           are dis
+00022020: 7265 6761 7264 6564 2e0a 0a20 2020 2020  regarded...     
+00022030: 2020 2069 6e5f 736c 6963 6520 3a20 626f     in_slice : bo
+00022040: 6f6c 2c20 6465 6661 756c 743d 5472 7565  ol, default=True
+00022050: 0a20 2020 2020 2020 2020 2020 2049 6620  .            If 
+00022060: 5472 7565 2c20 6f6e 6c79 2069 6e74 7261  True, only intra
+00022070: 2d73 6c69 6365 2063 6f6e 6e65 6374 6976  -slice connectiv
+00022080: 6974 7920 6973 2063 6f6e 7369 6465 7265  ity is considere
+00022090: 6420 7768 656e 0a20 2020 2020 2020 2020  d when.         
+000220a0: 2020 2070 6572 666f 726d 696e 6720 6572     performing er
+000220b0: 6f73 696f 6e20 746f 2069 6465 6e74 6966  osion to identif
+000220c0: 7920 524f 4920 7375 7266 6163 6573 2e0a  y ROI surfaces..
+000220d0: 0a20 2020 2020 2020 2076 6f78 656c 5f73  .        voxel_s
+000220e0: 697a 6520 3a20 7475 706c 652c 2064 6566  ize : tuple, def
+000220f0: 6175 6c74 3d4e 6f6e 650a 2020 2020 2020  ault=None.      
+00022100: 2020 2020 2020 566f 7865 6c20 7369 7a65        Voxel size
+00022110: 2028 6478 2c20 6479 2c20 647a 2920 696e   (dx, dy, dz) in
+00022120: 206d 6d20 746f 2062 6520 7573 6564 2066   mm to be used f
+00022130: 6f72 2052 4f49 206d 6173 6b73 0a20 2020  or ROI masks.   
+00022140: 2020 2020 2020 2020 2066 726f 6d20 7768           from wh
+00022150: 6963 6820 746f 2063 616c 6375 6c61 7465  ich to calculate
+00022160: 2073 7572 6661 6365 2064 6973 7461 6e63   surface distanc
+00022170: 6573 2e20 2049 6620 4e6f 6e65 2c0a 2020  es.  If None,.  
+00022180: 2020 2020 2020 2020 2020 7468 6520 6d61            the ma
+00022190: 736b 2076 6f78 656c 2073 697a 6520 6f66  sk voxel size of
+000221a0: 203c 6f74 6865 723e 2069 7320 7573 6564   <other> is used
+000221b0: 2e20 2049 6620 616e 2069 6e64 6976 6964  .  If an individ
+000221c0: 7561 6c0a 2020 2020 2020 2020 2020 2020  ual.            
+000221d0: 656c 656d 656e 7420 6973 204e 6f6e 652c  element is None,
+000221e0: 2074 6865 2076 616c 7565 206f 6620 7468   the value of th
+000221f0: 6520 636f 7272 6573 706f 6e64 696e 6720  e corresponding 
+00022200: 656c 656d 656e 7420 666f 720a 2020 2020  element for.    
+00022210: 2020 2020 2020 2020 7468 6520 6d61 736b          the mask
+00022220: 2076 6f78 656c 2073 697a 6520 6f66 203c   voxel size of <
+00022230: 6f74 6865 723e 2069 7320 7573 6564 2e0a  other> is used..
+00022240: 0a20 2020 2020 2020 2076 6f78 656c 5f64  .        voxel_d
+00022250: 696d 5f74 6f6c 6572 616e 6365 203a 2066  im_tolerance : f
+00022260: 6c6f 6174 2c20 6465 6661 756c 743d 302e  loat, default=0.
+00022270: 310a 2020 2020 2020 2020 2020 2020 546f  1.            To
+00022280: 6c65 7265 6e63 6520 7573 6564 2077 6865  lerence used whe
+00022290: 6e20 6465 7465 726d 696e 696e 6720 7768  n determining wh
+000222a0: 6574 6865 7220 3c76 6f78 656c 5f73 697a  ether <voxel_siz
+000222b0: 653e 2069 730a 2020 2020 2020 2020 2020  e> is.          
+000222c0: 2020 6469 6666 6572 656e 7420 6672 6f6d    different from
+000222d0: 2074 6865 2076 6f78 656c 2073 697a 6520   the voxel size 
+000222e0: 6f66 2074 6865 2069 6d61 6765 7320 6173  of the images as
+000222f0: 736f 6369 6174 6564 2077 6974 680a 2020  sociated with.  
+00022300: 2020 2020 2020 2020 2020 6561 6368 2052            each R
+00022310: 4f49 2e0a 2020 2020 2020 2020 2222 220a  OI..        """.
+00022320: 0a20 2020 2020 2020 2023 2053 6574 2076  .        # Set v
+00022330: 6965 7720 746f 204e 6f6e 6520 6966 2063  iew to None if c
+00022340: 6f6e 7369 6465 7269 6e67 2033 4420 6d61  onsidering 3D ma
+00022350: 736b 2e0a 2020 2020 2020 2020 6966 206e  sk..        if n
+00022360: 6f74 2073 696e 676c 655f 736c 6963 6520  ot single_slice 
+00022370: 616e 6420 6e6f 7420 666c 6174 7465 6e3a  and not flatten:
+00022380: 0a20 2020 2020 2020 2020 2020 2076 6965  .            vie
+00022390: 7720 3d20 4e6f 6e65 0a0a 2020 2020 2020  w = None..      
+000223a0: 2020 2320 5365 7420 746f 2046 616c 7365    # Set to False
+000223b0: 2070 6172 616d 6574 6572 7320 7468 6174   parameters that
+000223c0: 2061 7265 2074 6f20 6265 2069 676e 6f72   are to be ignor
+000223d0: 6564 0a20 2020 2020 2020 2023 2077 6865  ed.        # whe
+000223e0: 6e20 6361 6c63 756c 6174 696e 6720 6469  n calculating di
+000223f0: 7374 616e 6365 7320 746f 2063 6f6e 666f  stances to confo
+00022400: 726d 6974 792e 0a20 2020 2020 2020 2069  rmity..        i
+00022410: 6620 636f 6e66 6f72 6d69 7479 3a0a 2020  f conformity:.  
+00022420: 2020 2020 2020 2020 2020 7379 6d6d 6574            symmet
+00022430: 7269 6320 3d20 7369 676e 6564 203d 2046  ric = signed = F
+00022440: 616c 7365 0a0a 2020 2020 2020 2020 2320  alse..        # 
+00022450: 4465 6661 756c 7420 746f 2073 796d 6d65  Default to symme
+00022460: 7472 6963 206f 7220 6f6e 652d 7761 7920  tric or one-way 
+00022470: 6469 7374 616e 6365 732c 0a20 2020 2020  distances,.     
+00022480: 2020 2023 2064 6570 656e 6469 6e67 206f     # depending o
+00022490: 6e20 7768 6574 6865 7220 6469 7374 616e  n whether distan
+000224a0: 6365 7320 6172 6520 7369 676e 6564 206f  ces are signed o
+000224b0: 7220 756e 7369 676e 6564 2e0a 2020 2020  r unsigned..    
+000224c0: 2020 2020 6966 2073 796d 6d65 7472 6963      if symmetric
+000224d0: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
+000224e0: 2020 2020 2020 7379 6d6d 6574 7269 6320        symmetric 
+000224f0: 3d20 4661 6c73 6520 6966 2073 6967 6e65  = False if signe
+00022500: 6420 6973 2054 7275 6520 656c 7365 2054  d is True else T
+00022510: 7275 650a 0a20 2020 2020 2020 2023 204f  rue..        # O
+00022520: 6274 6169 6e20 524f 4920 636c 6f6e 6573  btain ROI clones
+00022530: 2c20 7769 7468 206d 6173 6b20 766f 7865  , with mask voxe
+00022540: 6c20 7369 7a65 7320 6d61 7463 6865 6420  l sizes matched 
+00022550: 746f 2076 6f78 656c 5f73 697a 650a 2020  to voxel_size.  
+00022560: 2020 2020 2020 2320 6966 206e 6f6e 2d6e        # if non-n
+00022570: 756c 6c2c 206f 7220 6f74 6865 7277 6973  ull, or otherwis
+00022580: 6520 746f 2074 6865 206d 6173 6b20 766f  e to the mask vo
+00022590: 7865 6c20 7369 7a65 206f 6620 6f74 6865  xel size of othe
+000225a0: 722e 0a20 2020 2020 2020 2072 6f69 312c  r..        roi1,
+000225b0: 2072 6f69 3220 3d20 7365 6c66 2e6d 6174   roi2 = self.mat
+000225c0: 6368 5f6d 6173 6b5f 766f 7865 6c5f 7369  ch_mask_voxel_si
+000225d0: 7a65 286f 7468 6572 2c20 766f 7865 6c5f  ze(other, voxel_
+000225e0: 7369 7a65 2c0a 2020 2020 2020 2020 2020  size,.          
+000225f0: 2020 2020 2020 766f 7865 6c5f 6469 6d5f        voxel_dim_
+00022600: 746f 6c65 7261 6e63 6529 0a0a 2020 2020  tolerance)..    
+00022610: 2020 2020 2320 4368 6563 6b20 7768 6574      # Check whet
+00022620: 6865 7220 524f 4973 2061 7265 2065 6d70  her ROIs are emp
+00022630: 7479 0a20 2020 2020 2020 2069 6620 6e6f  ty.        if no
+00022640: 7420 6e70 2e61 6e79 2872 6f69 312e 6765  t np.any(roi1.ge
+00022650: 745f 6d61 736b 2829 2920 6f72 206e 6f74  t_mask()) or not
+00022660: 206e 702e 616e 7928 726f 6932 2e67 6574   np.any(roi2.get
+00022670: 5f6d 6173 6b28 2929 3a0a 2020 2020 2020  _mask()):.      
+00022680: 2020 2020 2020 7265 7475 726e 0a0a 2020        return..  
+00022690: 2020 2020 2020 2320 4765 7420 766f 7865        # Get voxe
+000226a0: 6c20 7369 7a65 2072 656c 6174 6976 6520  l size relative 
+000226b0: 746f 2061 7865 7320 6f66 206e 756d 7079  to axes of numpy
+000226c0: 2061 7272 6179 2e0a 2020 2020 2020 2020   array..        
+000226d0: 766f 7865 6c5f 7369 7a65 203d 2072 6f69  voxel_size = roi
+000226e0: 312e 6765 745f 6e70 5f76 6f78 656c 5f73  1.get_np_voxel_s
+000226f0: 697a 6528 7669 6577 290a 0a20 2020 2020  ize(view)..     
+00022700: 2020 2023 2047 6574 2062 696e 6172 7920     # Get binary 
+00022710: 6d61 736b 730a 2020 2020 2020 2020 6966  masks.        if
+00022720: 2073 696e 676c 655f 736c 6963 653a 0a20   single_slice:. 
+00022730: 2020 2020 2020 2020 2020 206d 6173 6b31             mask1
+00022740: 203d 2072 6f69 312e 6765 745f 736c 6963   = roi1.get_slic
+00022750: 6528 7669 6577 2c20 736c 3d73 6c2c 2069  e(view, sl=sl, i
+00022760: 6478 3d69 6478 2c20 706f 733d 706f 7329  dx=idx, pos=pos)
+00022770: 0a20 2020 2020 2020 2020 2020 206d 6173  .            mas
+00022780: 6b32 203d 2072 6f69 322e 6765 745f 736c  k2 = roi2.get_sl
+00022790: 6963 6528 7669 6577 2c20 736c 3d73 6c2c  ice(view, sl=sl,
+000227a0: 2069 6478 3d69 6478 2c20 706f 733d 706f   idx=idx, pos=po
+000227b0: 7329 0a20 2020 2020 2020 2065 6c73 653a  s).        else:
+000227c0: 0a20 2020 2020 2020 2020 2020 206d 6173  .            mas
+000227d0: 6b31 203d 2072 6f69 312e 6765 745f 6d61  k1 = roi1.get_ma
+000227e0: 736b 2876 6965 772c 2066 6c61 7474 656e  sk(view, flatten
+000227f0: 3d66 6c61 7474 656e 290a 2020 2020 2020  =flatten).      
+00022800: 2020 2020 2020 6d61 736b 3220 3d20 726f        mask2 = ro
+00022810: 6932 2e67 6574 5f6d 6173 6b28 7669 6577  i2.get_mask(view
+00022820: 2c20 666c 6174 7465 6e3d 666c 6174 7465  , flatten=flatte
+00022830: 6e29 0a0a 2020 2020 2020 2020 2320 4d61  n)..        # Ma
+00022840: 6b65 2073 7472 7563 7475 7269 6e67 2065  ke structuring e
+00022850: 6c65 6d65 6e74 0a20 2020 2020 2020 2063  lement.        c
+00022860: 6f6e 6e32 203d 206e 6469 6d61 6765 2e67  onn2 = ndimage.g
+00022870: 656e 6572 6174 655f 6269 6e61 7279 5f73  enerate_binary_s
+00022880: 7472 7563 7475 7265 2832 2c20 636f 6e6e  tructure(2, conn
+00022890: 6563 7469 7669 7479 290a 2020 2020 2020  ectivity).      
+000228a0: 2020 6966 206d 6173 6b31 2e6e 6469 6d20    if mask1.ndim 
+000228b0: 3d3d 2032 3a0a 2020 2020 2020 2020 2020  == 2:.          
+000228c0: 2020 636f 6e6e 203d 2063 6f6e 6e32 0a20    conn = conn2. 
+000228d0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+000228e0: 2020 2020 2020 2020 2069 6620 696e 5f73           if in_s
+000228f0: 6c69 6365 3a0a 2020 2020 2020 2020 2020  lice:.          
+00022900: 2020 2020 2020 636f 6e6e 203d 206e 702e        conn = np.
+00022910: 7a65 726f 7328 2833 2c20 332c 2033 292c  zeros((3, 3, 3),
+00022920: 2064 7479 7065 3d62 6f6f 6c29 0a20 2020   dtype=bool).   
+00022930: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
+00022940: 6e5b 3a2c 203a 2c20 315d 203d 2063 6f6e  n[:, :, 1] = con
+00022950: 6e32 0a20 2020 2020 2020 2020 2020 2065  n2.            e
+00022960: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+00022970: 2020 2020 2063 6f6e 6e20 3d20 6e64 696d       conn = ndim
+00022980: 6167 652e 6765 6e65 7261 7465 5f62 696e  age.generate_bin
+00022990: 6172 795f 7374 7275 6374 7572 6528 332c  ary_structure(3,
+000229a0: 2063 6f6e 6e65 6374 6976 6974 7929 0a0a   connectivity)..
+000229b0: 2020 2020 2020 2020 2320 4765 7420 6f75          # Get ou
+000229c0: 7465 7220 7069 7865 6c20 6f66 2062 696e  ter pixel of bin
+000229d0: 6172 7920 6d61 7073 0a20 2020 2020 2020  ary maps.       
+000229e0: 2073 7572 6631 203d 206d 6173 6b31 205e   surf1 = mask1 ^
+000229f0: 206e 6469 6d61 6765 2e62 696e 6172 795f   ndimage.binary_
+00022a00: 6572 6f73 696f 6e28 6d61 736b 312c 2063  erosion(mask1, c
+00022a10: 6f6e 6e29 0a20 2020 2020 2020 2073 7572  onn).        sur
+00022a20: 6632 203d 206d 6173 6b32 205e 206e 6469  f2 = mask2 ^ ndi
+00022a30: 6d61 6765 2e62 696e 6172 795f 6572 6f73  mage.binary_eros
+00022a40: 696f 6e28 6d61 736b 322c 2063 6f6e 6e29  ion(mask2, conn)
+00022a50: 0a0a 2020 2020 2020 2020 2320 4d61 6b65  ..        # Make
+00022a60: 2061 7272 6179 7320 6f66 2064 6973 7461   arrays of dista
+00022a70: 6e63 6573 2074 6f20 7375 7266 6163 6520  nces to surface 
+00022a80: 6f66 2065 6163 6820 524f 490a 2020 2020  of each ROI.    
+00022a90: 2020 2020 6469 7374 3120 3d20 6e64 696d      dist1 = ndim
+00022aa0: 6167 652e 6469 7374 616e 6365 5f74 7261  age.distance_tra
+00022ab0: 6e73 666f 726d 5f65 6474 287e 7375 7266  nsform_edt(~surf
+00022ac0: 312c 2076 6f78 656c 5f73 697a 6529 0a20  1, voxel_size). 
+00022ad0: 2020 2020 2020 2064 6973 7432 203d 206e         dist2 = n
+00022ae0: 6469 6d61 6765 2e64 6973 7461 6e63 655f  dimage.distance_
+00022af0: 7472 616e 7366 6f72 6d5f 6564 7428 7e73  transform_edt(~s
+00022b00: 7572 6632 2c20 766f 7865 6c5f 7369 7a65  urf2, voxel_size
+00022b10: 290a 0a20 2020 2020 2020 2023 2047 6574  )..        # Get
+00022b20: 2073 6967 6e65 6420 6469 7374 616e 6365   signed distance
+00022b30: 730a 2020 2020 2020 2020 6966 2073 6967  s.        if sig
+00022b40: 6e65 643a 0a20 2020 2020 2020 2020 2020  ned:.           
+00022b50: 2064 6973 7431 203d 2064 6973 7431 202a   dist1 = dist1 *
+00022b60: 207e 6d61 736b 3120 2d20 6469 7374 3120   ~mask1 - dist1 
+00022b70: 2a20 6d61 736b 310a 2020 2020 2020 2020  * mask1.        
+00022b80: 2020 2020 6469 7374 3220 3d20 6469 7374      dist2 = dist
+00022b90: 3220 2a20 7e6d 6173 6b32 202d 2064 6973  2 * ~mask2 - dis
+00022ba0: 7432 202a 206d 6173 6b32 0a0a 2020 2020  t2 * mask2..    
+00022bb0: 2020 2020 2320 4d61 6b65 2076 6563 746f      # Make vecto
+00022bc0: 7220 636f 6e74 6169 6e69 6e67 2061 6c6c  r containing all
+00022bd0: 2064 6973 7461 6e63 6573 0a20 2020 2020   distances.     
+00022be0: 2020 2069 6620 636f 6e66 6f72 6d69 7479     if conformity
+00022bf0: 3a0a 2020 2020 2020 2020 2020 2020 6469  :.            di
+00022c00: 7374 315b 6d61 736b 3120 2620 6d61 736b  st1[mask1 & mask
+00022c10: 325d 203d 2030 0a20 2020 2020 2020 2020  2] = 0.         
+00022c20: 2020 2064 6973 7431 5b6d 6173 6b31 2026     dist1[mask1 &
+00022c30: 207e 6d61 736b 325d 203d 202d 6469 7374   ~mask2] = -dist
+00022c40: 325b 6d61 736b 3120 2620 7e6d 6173 6b32  2[mask1 & ~mask2
+00022c50: 5d0a 2020 2020 2020 2020 2020 2020 7364  ].            sd
+00022c60: 7320 3d20 6e70 2e72 6176 656c 2864 6973  s = np.ravel(dis
+00022c70: 7431 5b6d 6173 6b31 207c 206d 6173 6b32  t1[mask1 | mask2
+00022c80: 5d29 0a20 2020 2020 2020 2065 6c73 653a  ]).        else:
+00022c90: 0a20 2020 2020 2020 2020 2020 2073 6473  .            sds
+00022ca0: 203d 206e 702e 7261 7665 6c28 6469 7374   = np.ravel(dist
+00022cb0: 315b 7375 7266 3220 213d 2030 5d29 0a20  1[surf2 != 0]). 
+00022cc0: 2020 2020 2020 2020 2020 2069 6620 7379             if sy
+00022cd0: 6d6d 6574 7269 633a 0a20 2020 2020 2020  mmetric:.       
+00022ce0: 2020 2020 2020 2020 2073 6473 203d 206e           sds = n
+00022cf0: 702e 636f 6e63 6174 656e 6174 6528 5b73  p.concatenate([s
+00022d00: 6473 2c20 6e70 2e72 6176 656c 2864 6973  ds, np.ravel(dis
+00022d10: 7432 5b73 7572 6631 2021 3d20 305d 295d  t2[surf1 != 0])]
+00022d20: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
+00022d30: 2073 6473 0a0a 2020 2020 6465 6620 6765   sds..    def ge
+00022d40: 745f 6d65 616e 5f73 7572 6661 6365 5f64  t_mean_surface_d
+00022d50: 6973 7461 6e63 6528 7365 6c66 2c20 6f74  istance(self, ot
+00022d60: 6865 722c 202a 2a6b 7761 7267 7329 3a0a  her, **kwargs):.
+00022d70: 2020 2020 2020 2020 2727 270a 2020 2020          '''.    
+00022d80: 2020 2020 4f62 7461 696e 206d 6561 6e20      Obtain mean 
+00022d90: 6469 7374 616e 6365 2062 6574 7765 656e  distance between
+00022da0: 2073 7572 6661 6365 206f 6620 3c6f 7468   surface of <oth
+00022db0: 6572 3e20 616e 6420 7375 7266 6163 6520  er> and surface 
+00022dc0: 6f66 203c 7365 6c66 3e2e 0a0a 2020 2020  of <self>...    
+00022dd0: 2020 2020 466f 7220 7061 7261 6d65 7465      For paramete
+00022de0: 7273 2074 6861 7420 6d61 7920 6265 2070  rs that may be p
+00022df0: 6173 7365 642c 2073 6565 2064 6f63 756d  assed, see docum
+00022e00: 656e 7461 7469 6f6e 2066 6f72 3a0a 2020  entation for:.  
+00022e10: 2020 2020 2020 736b 7274 2e52 4f49 2e67        skrt.ROI.g
+00022e20: 6574 5f73 7572 6661 6365 5f64 6973 7461  et_surface_dista
+00022e30: 6e63 6573 2829 2e0a 2020 2020 2020 2020  nces()..        
+00022e40: 2727 270a 0a20 2020 2020 2020 2073 6473  '''..        sds
+00022e50: 203d 2073 656c 662e 6765 745f 7375 7266   = self.get_surf
+00022e60: 6163 655f 6469 7374 616e 6365 7328 6f74  ace_distances(ot
+00022e70: 6865 722c 202a 2a6b 7761 7267 7329 0a20  her, **kwargs). 
+00022e80: 2020 2020 2020 2069 6620 7364 7320 6973         if sds is
+00022e90: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+00022ea0: 2020 2072 6574 7572 6e0a 2020 2020 2020     return.      
+00022eb0: 2020 7265 7475 726e 2073 6473 2e6d 6561    return sds.mea
+00022ec0: 6e28 290a 0a20 2020 2064 6566 2067 6574  n()..    def get
+00022ed0: 5f72 6d73 5f73 7572 6661 6365 5f64 6973  _rms_surface_dis
+00022ee0: 7461 6e63 6528 7365 6c66 2c20 6f74 6865  tance(self, othe
+00022ef0: 722c 202a 2a6b 7761 7267 7329 3a0a 0a20  r, **kwargs):.. 
+00022f00: 2020 2020 2020 2073 6473 203d 2073 656c         sds = sel
+00022f10: 662e 6765 745f 7375 7266 6163 655f 6469  f.get_surface_di
+00022f20: 7374 616e 6365 7328 6f74 6865 722c 202a  stances(other, *
+00022f30: 2a6b 7761 7267 7329 0a20 2020 2020 2020  *kwargs).       
+00022f40: 2069 6620 7364 7320 6973 204e 6f6e 653a   if sds is None:
+00022f50: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+00022f60: 7572 6e0a 2020 2020 2020 2020 7265 7475  urn.        retu
+00022f70: 726e 206e 702e 7371 7274 2828 7364 7320  rn np.sqrt((sds 
+00022f80: 2a2a 2032 292e 6d65 616e 2829 290a 0a20  ** 2).mean()).. 
+00022f90: 2020 2064 6566 2067 6574 5f68 6175 7364     def get_hausd
+00022fa0: 6f72 6666 5f64 6973 7461 6e63 6528 7365  orff_distance(se
+00022fb0: 6c66 2c20 6f74 6865 722c 202a 2a6b 7761  lf, other, **kwa
+00022fc0: 7267 7329 3a0a 0a20 2020 2020 2020 2073  rgs):..        s
+00022fd0: 6473 203d 2073 656c 662e 6765 745f 7375  ds = self.get_su
+00022fe0: 7266 6163 655f 6469 7374 616e 6365 7328  rface_distances(
+00022ff0: 6f74 6865 722c 202a 2a6b 7761 7267 7329  other, **kwargs)
+00023000: 0a20 2020 2020 2020 2069 6620 7364 7320  .        if sds 
+00023010: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
+00023020: 2020 2020 2072 6574 7572 6e0a 2020 2020       return.    
+00023030: 2020 2020 7265 7475 726e 2073 6473 2e6d      return sds.m
+00023040: 6178 2829 0a0a 2020 2020 6465 6620 6765  ax()..    def ge
+00023050: 745f 6d65 616e 5f64 6973 7461 6e63 655f  t_mean_distance_
+00023060: 746f 5f63 6f6e 666f 726d 6974 7928 7365  to_conformity(se
+00023070: 6c66 2c20 6f74 6865 722c 2076 6f6c 5f75  lf, other, vol_u
+00023080: 6e69 7473 3d22 6d6d 222c 202a 2a6b 7761  nits="mm", **kwa
+00023090: 7267 7329 3a0a 2020 2020 2020 2020 2727  rgs):.        ''
+000230a0: 270a 2020 2020 2020 2020 4f62 7461 696e  '.        Obtain
+000230b0: 206d 6561 6e20 6469 7374 616e 6365 2074   mean distance t
+000230c0: 6f20 636f 6e66 6f72 6d69 7479 2066 6f72  o conformity for
+000230d0: 203c 6f74 6865 723e 2072 656c 6174 6976   <other> relativ
+000230e0: 6520 746f 203c 7365 6c66 3e2e 0a0a 2020  e to <self>...  
+000230f0: 2020 2020 2020 5468 6520 6d65 616e 2064        The mean d
+00023100: 6973 7461 6e63 6520 746f 2063 6f6e 666f  istance to confo
+00023110: 726d 6974 7920 6973 2061 7320 6465 6669  rmity is as defi
+00023120: 6e65 6420 696e 3a0a 2020 2020 2020 2020  ned in:.        
+00023130: 6874 7470 733a 2f2f 646f 692e 6f72 672f  https://doi.org/
+00023140: 3130 2e31 3235 392f 626a 722f 3237 3637  10.1259/bjr/2767
+00023150: 3435 3831 0a20 2020 2020 2020 2054 6563  4581.        Tec
+00023160: 686e 6963 616c 6c79 2074 6865 206d 6561  hnically the mea
+00023170: 6e20 6469 7374 616e 6365 2074 6f20 636f  n distance to co
+00023180: 6e66 6f72 6d69 7479 2069 736e 2774 2061  nformity isn't a
+00023190: 2064 6973 7461 6e63 652c 0a20 2020 2020   distance,.     
+000231a0: 2020 2062 7574 2069 7320 6120 6469 7374     but is a dist
+000231b0: 616e 6365 2064 6976 6964 6564 2062 7920  ance divided by 
+000231c0: 6120 766f 6c75 6d65 2e0a 0a20 2020 2020  a volume...     
+000231d0: 2020 2054 6869 7320 6675 6e63 7469 6f6e     This function
+000231e0: 2072 6574 7572 6e73 2061 2073 6b72 742e   returns a skrt.
+000231f0: 636f 7265 2e44 6174 6120 6f62 6a65 6374  core.Data object
+00023200: 2c20 7769 7468 2074 6865 2066 6f6c 6c6f  , with the follo
+00023210: 7769 6e67 0a20 2020 2020 2020 2069 6e66  wing.        inf
+00023220: 6f72 6d61 7469 6f6e 3a0a 0a20 2020 2020  ormation:..     
+00023230: 2020 206e 5f76 6f78 656c 203a 206e 756d     n_voxel : num
+00023240: 6265 7220 6f66 2076 6f78 656c 7320 696e  ber of voxels in
+00023250: 2074 6865 2075 6e69 6f6e 206f 6620 7468   the union of th
+00023260: 6520 524f 4973 2063 6f6e 7369 6465 7265  e ROIs considere
+00023270: 642e 0a0a 2020 2020 2020 2020 766f 7865  d...        voxe
+00023280: 6c5f 7369 7a65 203a 2076 6f78 656c 2073  l_size : voxel s
+00023290: 697a 6520 2864 782c 2064 792c 2064 7a29  ize (dx, dy, dz)
+000232a0: 2069 6e20 6d69 6c6c 696d 6574 7265 732c   in millimetres,
+000232b0: 2069 6e20 7468 650a 2020 2020 2020 2020   in the.        
+000232c0: 524f 4920 6d61 736b 7320 7573 6564 2069  ROI masks used i
+000232d0: 6e20 6469 7374 616e 6365 2063 616c 6375  n distance calcu
+000232e0: 6c61 7469 6f6e 732e 0a0a 2020 2020 2020  lations...      
+000232f0: 2020 6d65 616e 5f75 6e64 6572 5f63 6f6e    mean_under_con
+00023300: 746f 7572 696e 6720 3a20 7375 6d20 6f66  touring : sum of
+00023310: 2061 6273 6f6c 7574 6520 7661 6c75 6573   absolute values
+00023320: 206f 6620 6e65 6761 7469 7665 2064 6973   of negative dis
+00023330: 7461 6e63 6573 0a20 2020 2020 2020 2074  tances.        t
+00023340: 6f20 636f 6e66 6f72 6d69 7479 2c20 6469  o conformity, di
+00023350: 7669 6465 6420 6279 2076 6f6c 756d 6520  vided by volume 
+00023360: 696e 2075 6e69 6f6e 206f 6620 524f 4973  in union of ROIs
+00023370: 2063 6f6e 7369 6465 7265 642e 0a0a 2020   considered...  
+00023380: 2020 2020 2020 6d65 616e 5f6f 7665 725f        mean_over_
+00023390: 636f 6e74 6f75 7269 6e67 203a 2073 756d  contouring : sum
+000233a0: 206f 6620 706f 7369 7469 7665 2064 6973   of positive dis
+000233b0: 7461 6e63 6573 2074 6f20 636f 6e66 6f72  tances to confor
+000233c0: 6d69 7479 2c0a 2020 2020 2020 2020 6469  mity,.        di
+000233d0: 7669 6465 6420 6279 2076 6f6c 756d 6520  vided by volume 
+000233e0: 696e 2075 6e69 6f6e 206f 6620 524f 4973  in union of ROIs
+000233f0: 2063 6f6e 7369 6465 7265 642e 0a0a 2020   considered...  
+00023400: 2020 2020 2020 6d65 616e 5f64 6973 7461        mean_dista
+00023410: 6e63 655f 746f 5f63 6f6e 666f 726d 6974  nce_to_conformit
+00023420: 7920 3a20 7375 6d20 6f66 206d 6561 6e5f  y : sum of mean_
+00023430: 756e 6465 725f 636f 6e74 6f75 7269 6e67  under_contouring
+00023440: 2061 6e64 0a20 2020 2020 2020 206d 6561   and.        mea
+00023450: 6e5f 6f76 6572 5f63 6f6e 746f 7572 696e  n_over_contourin
+00023460: 672e 0a0a 2020 2020 2020 2020 2a2a 5061  g...        **Pa
+00023470: 7261 6d65 7465 7273 3a2a 2a0a 2020 2020  rameters:**.    
+00023480: 2020 2020 766f 6c5f 756e 6974 7320 3a20      vol_units : 
+00023490: 7374 722c 2064 6566 6175 6c74 3d22 6d6d  str, default="mm
+000234a0: 220a 2020 2020 2020 2020 2020 2020 556e  ".            Un
+000234b0: 6974 7320 746f 2075 7365 2066 6f72 2076  its to use for v
+000234c0: 6f6c 756d 6520 696e 2064 656e 6f6d 696e  olume in denomin
+000234d0: 6174 6f72 2077 6865 6e20 6361 6c63 756c  ator when calcul
+000234e0: 6174 696e 670a 2020 2020 2020 2020 2020  ating.          
+000234f0: 2020 6d65 616e 5f75 6e64 6572 5f63 6f6e    mean_under_con
+00023500: 746f 7572 696e 6720 616e 6420 6d65 616e  touring and mean
+00023510: 5f6f 7665 7263 6f6e 746f 7572 696e 672e  _overcontouring.
+00023520: 2043 616e 2062 650a 2020 2020 2020 2020   Can be.        
+00023530: 2020 2020 226d 6d22 2028 3d6d 6d5e 3329      "mm" (=mm^3)
+00023540: 2c20 226d 6c22 2c20 6f72 2022 766f 7865  , "ml", or "voxe
+00023550: 6c73 222e 0a0a 2020 2020 2020 2020 6b77  ls"...        kw
+00023560: 6172 6773 0a20 2020 2020 2020 2020 2020  args.           
+00023570: 204b 6579 776f 7264 2061 7267 756d 656e   Keyword argumen
+00023580: 7473 2061 7265 2070 6173 7365 6420 746f  ts are passed to
+00023590: 0a20 2020 2020 2020 2020 2020 2073 6b72  .            skr
+000235a0: 742e 7374 7275 6374 7572 6573 2e52 4f49  t.structures.ROI
+000235b0: 2e67 6574 5f73 7572 6661 6365 5f64 6973  .get_surface_dis
+000235c0: 7461 6e63 6573 2829 2e0a 2020 2020 2020  tances()..      
+000235d0: 2020 2020 2020 5365 6520 646f 6375 6d65        See docume
+000235e0: 6e74 6174 696f 6e20 6f66 2074 6869 7320  ntation of this 
+000235f0: 6d65 7468 6f64 2066 6f72 2070 6172 616d  method for param
+00023600: 6574 6572 2064 6574 6169 6c73 2e0a 2020  eter details..  
+00023610: 2020 2020 2020 2727 270a 0a20 2020 2020        '''..     
+00023620: 2020 2023 204f 6274 6169 6e20 6469 7374     # Obtain dist
+00023630: 616e 6365 7320 746f 2063 6f6e 666f 726d  ances to conform
+00023640: 6974 792e 0a20 2020 2020 2020 206b 7761  ity..        kwa
+00023650: 7267 735b 2263 6f6e 666f 726d 6974 7922  rgs["conformity"
+00023660: 5d20 3d20 5472 7565 0a20 2020 2020 2020  ] = True.       
+00023670: 2073 6473 203d 2073 656c 662e 6765 745f   sds = self.get_
+00023680: 7375 7266 6163 655f 6469 7374 616e 6365  surface_distance
+00023690: 7328 6f74 6865 722c 202a 2a6b 7761 7267  s(other, **kwarg
+000236a0: 7329 0a0a 2020 2020 2020 2020 2320 4f62  s)..        # Ob
+000236b0: 7461 696e 206d 6173 6b20 6172 7261 7920  tain mask array 
+000236c0: 7265 7072 6573 656e 7469 6e67 2075 6e69  representing uni
+000236d0: 6f6e 206f 6620 524f 4973 2e0a 2020 2020  on of ROIs..    
+000236e0: 2020 2020 756e 696f 6e20 3d20 5374 7275      union = Stru
+000236f0: 6374 7572 6553 6574 285b 7365 6c66 2c20  ctureSet([self, 
+00023700: 6f74 6865 725d 292e 636f 6d62 696e 655f  other]).combine_
+00023710: 726f 6973 2829 0a20 2020 2020 2020 2076  rois().        v
+00023720: 6965 7720 3d20 6b77 6172 6773 2e67 6574  iew = kwargs.get
+00023730: 2822 7669 6577 222c 2022 782d 7922 290a  ("view", "x-y").
+00023740: 2020 2020 2020 2020 6966 206b 7761 7267          if kwarg
+00023750: 732e 6765 7428 2273 696e 676c 655f 736c  s.get("single_sl
+00023760: 6963 6522 2c20 4661 6c73 6529 3a0a 2020  ice", False):.  
+00023770: 2020 2020 2020 2020 2020 736c 203d 206b            sl = k
+00023780: 7761 7267 732e 6765 7428 2273 6c22 2c20  wargs.get("sl", 
+00023790: 4e6f 6e65 290a 2020 2020 2020 2020 2020  None).          
+000237a0: 2020 6964 7820 3d20 6b77 6172 6773 2e67    idx = kwargs.g
+000237b0: 6574 2822 6964 7822 2c20 4e6f 6e65 290a  et("idx", None).
+000237c0: 2020 2020 2020 2020 2020 2020 706f 7320              pos 
+000237d0: 3d20 6b77 6172 6773 2e67 6574 2822 706f  = kwargs.get("po
+000237e0: 7322 2c20 4e6f 6e65 290a 2020 2020 2020  s", None).      
+000237f0: 2020 2020 2020 6d61 736b 5f64 6174 6120        mask_data 
+00023800: 3d20 756e 696f 6e2e 6765 745f 736c 6963  = union.get_slic
+00023810: 6528 7669 6577 2c20 736c 2c20 6964 782c  e(view, sl, idx,
+00023820: 2070 6f73 290a 2020 2020 2020 2020 656c   pos).        el
+00023830: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+00023840: 666c 6174 7465 6e20 3d20 6b77 6172 6773  flatten = kwargs
+00023850: 2e67 6574 2822 666c 6174 7465 6e22 2c20  .get("flatten", 
+00023860: 4661 6c73 6529 0a20 2020 2020 2020 2020  False).         
+00023870: 2020 206d 6173 6b5f 6461 7461 203d 2075     mask_data = u
+00023880: 6e69 6f6e 2e67 6574 5f6d 6173 6b28 7669  nion.get_mask(vi
+00023890: 6577 2c20 666c 6174 7465 6e29 0a0a 2020  ew, flatten)..  
+000238a0: 2020 2020 2020 2320 4361 6c63 756c 6174        # Calculat
+000238b0: 6520 636f 6e66 6f72 6d69 7479 2073 636f  e conformity sco
+000238c0: 7265 732e 0a20 2020 2020 2020 2063 6f6e  res..        con
+000238d0: 666f 726d 6974 7920 3d20 736b 7274 2e63  formity = skrt.c
+000238e0: 6f72 652e 4461 7461 2829 0a20 2020 2020  ore.Data().     
+000238f0: 2020 2063 6f6e 666f 726d 6974 792e 6e5f     conformity.n_
+00023900: 766f 7865 6c20 3d20 6d61 736b 5f64 6174  voxel = mask_dat
+00023910: 612e 7375 6d28 290a 2020 2020 2020 2020  a.sum().        
+00023920: 636f 6e66 6f72 6d69 7479 2e76 6f78 656c  conformity.voxel
+00023930: 5f73 697a 6520 3d20 756e 696f 6e2e 6765  _size = union.ge
+00023940: 745f 766f 7865 6c5f 7369 7a65 2829 0a20  t_voxel_size(). 
+00023950: 2020 2020 2020 2069 6620 7364 7320 6973         if sds is
+00023960: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+00023970: 2020 2063 6f6e 666f 726d 6974 792e 6d65     conformity.me
+00023980: 616e 5f75 6e64 6572 5f63 6f6e 746f 7572  an_under_contour
+00023990: 696e 6720 3d20 4e6f 6e65 0a20 2020 2020  ing = None.     
+000239a0: 2020 2020 2020 2063 6f6e 666f 726d 6974         conformit
+000239b0: 792e 6d65 616e 5f6f 7665 725f 636f 6e74  y.mean_over_cont
+000239c0: 6f75 7269 6e67 203d 204e 6f6e 650a 2020  ouring = None.  
+000239d0: 2020 2020 2020 2020 2020 636f 6e66 6f72            confor
+000239e0: 6d69 7479 2e6d 6561 6e5f 6469 7374 616e  mity.mean_distan
+000239f0: 6365 5f74 6f5f 636f 6e66 6f72 6d69 7479  ce_to_conformity
+00023a00: 203d 204e 6f6e 650a 2020 2020 2020 2020   = None.        
+00023a10: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+00023a20: 2020 636f 6e66 6f72 6d69 7479 2e6d 6561    conformity.mea
+00023a30: 6e5f 756e 6465 725f 636f 6e74 6f75 7269  n_under_contouri
+00023a40: 6e67 203d 2028 6162 7328 7364 735b 7364  ng = (abs(sds[sd
+00023a50: 7320 3c20 305d 2e73 756d 2829 290a 2020  s < 0].sum()).  
+00023a60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023a70: 2020 2f20 756e 696f 6e2e 6765 745f 766f    / union.get_vo
+00023a80: 6c75 6d65 2876 6f6c 5f75 6e69 7473 2929  lume(vol_units))
+00023a90: 0a20 2020 2020 2020 2020 2020 2063 6f6e  .            con
+00023aa0: 666f 726d 6974 792e 6d65 616e 5f6f 7665  formity.mean_ove
+00023ab0: 725f 636f 6e74 6f75 7269 6e67 203d 2028  r_contouring = (
+00023ac0: 7364 735b 7364 7320 3e20 305d 2e73 756d  sds[sds > 0].sum
+00023ad0: 2829 0a20 2020 2020 2020 2020 2020 2020  ().             
+00023ae0: 2020 2020 2020 202f 2075 6e69 6f6e 2e67         / union.g
+00023af0: 6574 5f76 6f6c 756d 6528 766f 6c5f 756e  et_volume(vol_un
+00023b00: 6974 7329 290a 2020 2020 2020 2020 2020  its)).          
+00023b10: 2020 636f 6e66 6f72 6d69 7479 2e6d 6561    conformity.mea
+00023b20: 6e5f 6469 7374 616e 6365 5f74 6f5f 636f  n_distance_to_co
+00023b30: 6e66 6f72 6d69 7479 203d 2028 0a20 2020  nformity = (.   
+00023b40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023b50: 2063 6f6e 666f 726d 6974 792e 6d65 616e   conformity.mean
+00023b60: 5f75 6e64 6572 5f63 6f6e 746f 7572 696e  _under_contourin
+00023b70: 6720 2b0a 2020 2020 2020 2020 2020 2020  g +.            
+00023b80: 2020 2020 2020 2020 636f 6e66 6f72 6d69          conformi
+00023b90: 7479 2e6d 6561 6e5f 6f76 6572 5f63 6f6e  ty.mean_over_con
+00023ba0: 746f 7572 696e 6729 0a0a 2020 2020 2020  touring)..      
+00023bb0: 2020 7265 7475 726e 2063 6f6e 666f 726d    return conform
+00023bc0: 6974 790a 0a20 2020 2064 6566 2067 6574  ity..    def get
+00023bd0: 5f73 7572 6661 6365 5f64 6973 7461 6e63  _surface_distanc
+00023be0: 655f 6d65 7472 6963 7328 7365 6c66 2c20  e_metrics(self, 
+00023bf0: 6f74 6865 722c 202a 2a6b 7761 7267 7329  other, **kwargs)
+00023c00: 3a0a 2020 2020 2020 2020 2222 2247 6574  :.        """Get
+00023c10: 2074 6865 206d 6561 6e20 7375 7266 6163   the mean surfac
+00023c20: 6520 6469 7374 616e 6365 2c20 524d 5320  e distance, RMS 
+00023c30: 7375 7266 6163 6520 6469 7374 616e 6365  surface distance
+00023c40: 2c20 616e 6420 4861 7573 646f 7266 660a  , and Hausdorff.
+00023c50: 2020 2020 2020 2020 6469 7374 616e 6365          distance
+00023c60: 2e22 2222 0a0a 2020 2020 2020 2020 7364  ."""..        sd
+00023c70: 7320 3d20 7365 6c66 2e67 6574 5f73 7572  s = self.get_sur
+00023c80: 6661 6365 5f64 6973 7461 6e63 6573 286f  face_distances(o
+00023c90: 7468 6572 2c20 2a2a 6b77 6172 6773 290a  ther, **kwargs).
+00023ca0: 2020 2020 2020 2020 6966 2073 6473 2069          if sds i
+00023cb0: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
+00023cc0: 2020 2020 7265 7475 726e 0a20 2020 2020      return.     
+00023cd0: 2020 2072 6574 7572 6e20 7364 732e 6d65     return sds.me
+00023ce0: 616e 2829 2c20 6e70 2e73 7172 7428 2873  an(), np.sqrt((s
+00023cf0: 6473 202a 2a20 3229 2e6d 6561 6e28 2929  ds ** 2).mean())
+00023d00: 2c20 7364 732e 6d61 7828 290a 0a20 2020  , sds.max()..   
+00023d10: 2064 6566 2070 6c6f 745f 7375 7266 6163   def plot_surfac
+00023d20: 655f 6469 7374 616e 6365 7328 7365 6c66  e_distances(self
+00023d30: 2c20 6f74 6865 722c 2073 6176 655f 6173  , other, save_as
+00023d40: 3d4e 6f6e 652c 2073 6967 6e65 643d 4661  =None, signed=Fa
+00023d50: 6c73 652c 202a 2a6b 7761 7267 7329 3a0a  lse, **kwargs):.
+00023d60: 2020 2020 2020 2020 2222 2250 6c6f 7420          """Plot 
+00023d70: 6869 7374 6f67 7261 6d20 6f66 2073 7572  histogram of sur
+00023d80: 6661 6365 2064 6973 7461 6e63 6573 2e22  face distances."
+00023d90: 2222 0a0a 2020 2020 2020 2020 7364 7320  ""..        sds 
+00023da0: 3d20 7365 6c66 2e67 6574 5f73 7572 6661  = self.get_surfa
+00023db0: 6365 5f64 6973 7461 6e63 6573 286f 7468  ce_distances(oth
+00023dc0: 6572 2c20 7369 676e 6564 3d73 6967 6e65  er, signed=signe
+00023dd0: 642c 202a 2a6b 7761 7267 7329 0a20 2020  d, **kwargs).   
+00023de0: 2020 2020 2069 6620 7364 7320 6973 204e       if sds is N
+00023df0: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+00023e00: 2072 6574 7572 6e0a 2020 2020 2020 2020   return.        
+00023e10: 6669 672c 2061 7820 3d20 706c 742e 7375  fig, ax = plt.su
+00023e20: 6270 6c6f 7473 2829 0a20 2020 2020 2020  bplots().       
+00023e30: 2061 782e 6869 7374 2873 6473 290a 2020   ax.hist(sds).  
+00023e40: 2020 2020 2020 786c 6162 656c 203d 2028        xlabel = (
+00023e50: 0a20 2020 2020 2020 2020 2020 2022 5375  .            "Su
+00023e60: 7266 6163 6520 6469 7374 616e 6365 2028  rface distance (
+00023e70: 6d6d 2922 2069 6620 6e6f 7420 7369 676e  mm)" if not sign
+00023e80: 6564 2065 6c73 6520 2253 6967 6e65 6420  ed else "Signed 
+00023e90: 7375 7266 6163 6520 6469 7374 616e 6365  surface distance
+00023ea0: 2028 6d6d 2922 0a20 2020 2020 2020 2029   (mm)".        )
+00023eb0: 0a20 2020 2020 2020 2061 782e 7365 745f  .        ax.set_
+00023ec0: 786c 6162 656c 2878 6c61 6265 6c29 0a20  xlabel(xlabel). 
+00023ed0: 2020 2020 2020 2061 782e 7365 745f 796c         ax.set_yl
+00023ee0: 6162 656c 2822 4e75 6d62 6572 206f 6620  abel("Number of 
+00023ef0: 766f 7865 6c73 2229 0a20 2020 2020 2020  voxels").       
+00023f00: 2069 6620 7361 7665 5f61 733a 0a20 2020   if save_as:.   
+00023f10: 2020 2020 2020 2020 2070 6c74 2e74 6967           plt.tig
+00023f20: 6874 5f6c 6179 6f75 7428 290a 2020 2020  ht_layout().    
+00023f30: 2020 2020 2020 2020 6669 672e 7361 7665          fig.save
+00023f40: 6669 6728 7361 7665 5f61 7329 0a0a 2020  fig(save_as)..  
+00023f50: 2020 6465 6620 6765 745f 636f 6d70 6172    def get_compar
+00023f60: 6973 6f6e 280a 2020 2020 2020 2020 7365  ison(.        se
+00023f70: 6c66 2c0a 2020 2020 2020 2020 726f 692c  lf,.        roi,
+00023f80: 0a20 2020 2020 2020 206d 6574 7269 6373  .        metrics
+00023f90: 3d4e 6f6e 652c 0a20 2020 2020 2020 2076  =None,.        v
+00023fa0: 6f6c 5f75 6e69 7473 3d22 6d6d 222c 0a20  ol_units="mm",. 
+00023fb0: 2020 2020 2020 2061 7265 615f 756e 6974         area_unit
+00023fc0: 733d 226d 6d22 2c0a 2020 2020 2020 2020  s="mm",.        
+00023fd0: 6365 6e74 726f 6964 5f75 6e69 7473 3d22  centroid_units="
+00023fe0: 6d6d 222c 0a20 2020 2020 2020 2076 6965  mm",.        vie
+00023ff0: 773d 2278 2d79 222c 0a20 2020 2020 2020  w="x-y",.       
+00024000: 2073 6c3d 4e6f 6e65 2c0a 2020 2020 2020   sl=None,.      
+00024010: 2020 706f 733d 4e6f 6e65 2c0a 2020 2020    pos=None,.    
+00024020: 2020 2020 6964 783d 4e6f 6e65 2c0a 2020      idx=None,.  
+00024030: 2020 2020 2020 6d65 7468 6f64 3d4e 6f6e        method=Non
+00024040: 652c 0a20 2020 2020 2020 2073 6c69 6365  e,.        slice
+00024050: 5f73 7461 7473 3d4e 6f6e 652c 0a20 2020  _stats=None,.   
+00024060: 2020 2020 2064 6566 6175 6c74 5f62 795f       default_by_
+00024070: 736c 6963 653d 4e6f 6e65 2c0a 2020 2020  slice=None,.    
+00024080: 2020 2020 756e 6974 735f 696e 5f68 6561      units_in_hea
+00024090: 6465 723d 4661 6c73 652c 0a20 2020 2020  der=False,.     
+000240a0: 2020 2067 6c6f 6261 6c5f 7673 5f73 6c69     global_vs_sli
+000240b0: 6365 5f68 6561 6465 723d 4661 6c73 652c  ce_header=False,
+000240c0: 0a20 2020 2020 2020 206e 616d 655f 6173  .        name_as
+000240d0: 5f69 6e64 6578 3d54 7275 652c 0a20 2020  _index=True,.   
+000240e0: 2020 2020 206e 6963 655f 636f 6c75 6d6e       nice_column
+000240f0: 733d 4661 6c73 652c 0a20 2020 2020 2020  s=False,.       
+00024100: 2064 6563 696d 616c 5f70 6c61 6365 733d   decimal_places=
+00024110: 4e6f 6e65 2c0a 2020 2020 2020 2020 666f  None,.        fo
+00024120: 7263 653d 5472 7565 2c0a 2020 2020 2020  rce=True,.      
+00024130: 2020 766f 7865 6c5f 7369 7a65 3d28 312c    voxel_size=(1,
+00024140: 2031 2c20 3129 2c0a 2020 2020 2020 2020   1, 1),.        
+00024150: 6d61 7463 685f 6c65 6e67 7468 733d 4661  match_lengths=Fa
+00024160: 6c73 652c 0a20 2020 2020 2020 206d 6174  lse,.        mat
+00024170: 6368 5f6c 656e 6774 6873 5f73 7472 6174  ch_lengths_strat
+00024180: 6567 793d 310a 2020 2020 293a 0a20 2020  egy=1.    ):.   
+00024190: 2020 2020 2022 2222 5265 7475 726e 2061       """Return a
+000241a0: 2070 616e 6461 7320 4461 7461 4672 616d   pandas DataFram
+000241b0: 6520 6f66 2074 6865 2063 6f6d 7061 7269  e of the compari
+000241c0: 736f 6e20 6d65 7472 6963 7320 6c69 7374  son metrics list
+000241d0: 6564 2069 6e20 0a20 2020 2020 2020 203c  ed in .        <
+000241e0: 6d65 7472 6963 733e 2077 6974 6820 7265  metrics> with re
+000241f0: 7370 6563 7420 746f 2061 6e6f 7468 6572  spect to another
+00024200: 2052 4f49 2e0a 0a20 2020 2020 2020 202a   ROI...        *
+00024210: 2a50 6172 616d 6574 6572 733a 2a2a 0a20  *Parameters:**. 
+00024220: 2020 2020 2020 200a 2020 2020 2020 2020         .        
+00024230: 726f 6920 3a20 524f 490a 2020 2020 2020  roi : ROI.      
+00024240: 2020 2020 2020 4f74 6865 7220 524f 4920        Other ROI 
+00024250: 7769 7468 2077 6869 6368 2074 6f20 636f  with which to co
+00024260: 6d70 6172 6520 7468 6973 2052 4f49 2e0a  mpare this ROI..
+00024270: 0a20 2020 2020 2020 206d 6574 7269 6373  .        metrics
+00024280: 203a 206c 6973 742c 2064 6566 6175 6c74   : list, default
+00024290: 3d4e 6f6e 650a 2020 2020 2020 2020 2020  =None.          
+000242a0: 2020 4c69 7374 206f 6620 6d65 7472 6963    List of metric
+000242b0: 7320 746f 2069 6e63 6c75 6465 2069 6e20  s to include in 
+000242c0: 7468 6520 7461 626c 652e 204f 7074 696f  the table. Optio
+000242d0: 6e73 3a0a 0a20 2020 2020 2020 2020 2020  ns:..           
+000242e0: 2020 2020 202a 2022 6469 6365 2220 3a20       * "dice" : 
+000242f0: 676c 6f62 616c 2044 6963 6520 7363 6f72  global Dice scor
+00024300: 652e 0a20 2020 2020 2020 2020 2020 2020  e..             
+00024310: 2020 202a 2022 6469 6365 5f66 6c61 7422     * "dice_flat"
+00024320: 3a20 4469 6365 2073 636f 7265 206f 6620  : Dice score of 
+00024330: 524f 4973 2066 6c61 7474 656e 6564 2069  ROIs flattened i
+00024340: 6e20 7468 6520 6f72 6965 6e74 6174 696f  n the orientatio
+00024350: 6e0a 2020 2020 2020 2020 2020 2020 2020  n.              
+00024360: 2020 2020 7370 6563 6966 6965 6420 696e      specified in
+00024370: 203c 7669 6577 3e2e 0a20 2020 2020 2020   <view>..       
+00024380: 2020 2020 2020 2020 202a 2022 6469 6365           * "dice
+00024390: 5f73 6c69 6365 223a 2044 6963 6520 7363  _slice": Dice sc
+000243a0: 6f72 6520 6f6e 2061 2073 696e 676c 6520  ore on a single 
+000243b0: 736c 6963 652e 0a20 2020 2020 2020 2020  slice..         
+000243c0: 2020 2020 2020 202a 2022 6469 6365 5f73         * "dice_s
+000243d0: 6c69 6365 5f73 7461 7473 223a 2073 7461  lice_stats": sta
+000243e0: 7469 7374 6963 7320 7370 6563 6966 6965  tistics specifie
+000243f0: 6420 696e 203c 736c 6963 655f 7374 6174  d in <slice_stat
+00024400: 733e 0a20 2020 2020 2020 2020 2020 2020  s>.             
+00024410: 2020 2020 2066 6f72 2073 6c69 6365 2d62       for slice-b
+00024420: 792d 736c 6963 6520 4469 6365 2073 636f  y-slice Dice sco
+00024430: 7265 732e 0a0a 2020 2020 2020 2020 2020  res...          
+00024440: 2020 2020 2020 2a20 226a 6163 6361 7264        * "jaccard
+00024450: 2220 3a20 676c 6f62 616c 204a 6163 6361  " : global Jacca
+00024460: 7264 2069 6e64 6578 2e0a 2020 2020 2020  rd index..      
+00024470: 2020 2020 2020 2020 2020 2a20 226a 6163            * "jac
+00024480: 6361 7264 5f66 6c61 7422 3a20 4a61 6363  card_flat": Jacc
+00024490: 6172 6420 696e 6465 7820 6f66 2052 4f49  ard index of ROI
+000244a0: 7320 666c 6174 7465 6e65 6420 696e 0a20  s flattened in. 
+000244b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000244c0: 2074 6865 206f 7269 656e 7461 7469 6f6e   the orientation
+000244d0: 2073 7065 6369 6669 6564 2069 6e20 3c76   specified in <v
+000244e0: 6965 773e 2e0a 2020 2020 2020 2020 2020  iew>..          
+000244f0: 2020 2020 2020 2a20 226a 6163 6361 7264        * "jaccard
+00024500: 5f73 6c69 6365 223a 204a 6163 6361 7264  _slice": Jaccard
+00024510: 2069 6e64 6578 206f 6e20 6120 7369 6e67   index on a sing
+00024520: 6c65 2073 6c69 6365 2e0a 2020 2020 2020  le slice..      
+00024530: 2020 2020 2020 2020 2020 2a20 226a 6163            * "jac
+00024540: 6361 7264 5f73 6c69 6365 5f73 7461 7473  card_slice_stats
+00024550: 223a 2073 7461 7469 7374 6963 7320 7370  ": statistics sp
+00024560: 6563 6966 6965 6420 696e 203c 736c 6963  ecified in <slic
+00024570: 655f 7374 6174 733e 0a20 2020 2020 2020  e_stats>.       
+00024580: 2020 2020 2020 2020 2020 2066 6f72 2073             for s
+00024590: 6c69 6365 2d62 792d 736c 6963 6520 4a61  lice-by-slice Ja
+000245a0: 6363 6172 6420 696e 6469 6365 732e 0a0a  ccard indices...
+000245b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000245c0: 2a20 2263 656e 7472 6f69 6422 3a20 3344  * "centroid": 3D
+000245d0: 2063 656e 7472 6f69 6420 6469 7374 616e   centroid distan
+000245e0: 6365 2076 6563 746f 722e 0a20 2020 2020  ce vector..     
+000245f0: 2020 2020 2020 2020 2020 202a 2022 6162             * "ab
+00024600: 735f 6365 6e74 726f 6964 223a 206d 6167  s_centroid": mag
+00024610: 6e69 7475 6465 206f 6620 3344 2063 656e  nitude of 3D cen
+00024620: 7472 6f69 6420 6469 7374 616e 6365 2076  troid distance v
+00024630: 6563 746f 722e 0a20 2020 2020 2020 2020  ector..         
+00024640: 2020 2020 2020 202a 2022 6162 735f 6365         * "abs_ce
+00024650: 6e74 726f 6964 5f66 6c61 7422 3a20 6d61  ntroid_flat": ma
+00024660: 676e 6974 7564 6520 6f66 2033 4420 6365  gnitude of 3D ce
+00024670: 6e74 726f 6964 2064 6973 7461 6e63 6520  ntroid distance 
+00024680: 7665 6374 6f72 0a20 2020 2020 2020 2020  vector.         
+00024690: 2020 2020 2020 2020 2070 726f 6a65 6374           project
+000246a0: 6564 2069 6e74 6f20 7468 6520 706c 616e  ed into the plan
+000246b0: 6520 7370 6563 6966 6965 6420 696e 203c  e specified in <
+000246c0: 7669 6577 3e2e 0a20 2020 2020 2020 2020  view>..         
+000246d0: 2020 2020 2020 202a 2022 6365 6e74 726f         * "centro
+000246e0: 6964 5f73 6c69 6365 223a 2032 4420 6365  id_slice": 2D ce
+000246f0: 6e74 726f 6964 2064 6973 7461 6e63 6520  ntroid distance 
+00024700: 7665 6374 6f72 206f 6e20 6120 7369 6e67  vector on a sing
+00024710: 6c65 2073 6c69 6365 2e0a 2020 2020 2020  le slice..      
+00024720: 2020 2020 2020 2020 2020 2a20 2263 656e            * "cen
+00024730: 7472 6f69 645f 736c 6963 655f 7374 6174  troid_slice_stat
+00024740: 7322 3a20 7374 6174 6973 7469 6373 2073  s": statistics s
+00024750: 7065 6369 6669 6564 2069 6e0a 2020 2020  pecified in.    
+00024760: 2020 2020 2020 2020 2020 2020 2020 3c73                <s
+00024770: 6c69 6365 5f73 7461 7473 3e20 666f 7220  lice_stats> for 
+00024780: 736c 6963 652d 6279 2d73 6c69 6365 2032  slice-by-slice 2
+00024790: 4420 6365 6e74 726f 6964 2064 6973 7461  D centroid dista
+000247a0: 6e63 6520 7665 6374 6f72 732e 0a20 2020  nce vectors..   
+000247b0: 2020 2020 2020 2020 2020 2020 202a 2022               * "
+000247c0: 6162 735f 6365 6e74 726f 6964 5f73 6c69  abs_centroid_sli
+000247d0: 6365 223a 206d 6167 6e69 7475 6465 206f  ce": magnitude o
+000247e0: 6620 3244 2063 656e 7472 6f69 6420 6469  f 2D centroid di
+000247f0: 7374 616e 6365 200a 2020 2020 2020 2020  stance .        
+00024800: 2020 2020 2020 2020 2020 7665 6374 6f72            vector
+00024810: 206f 6e20 6120 7369 6e67 6c65 2073 6c69   on a single sli
+00024820: 6365 2e0a 2020 2020 2020 2020 2020 2020  ce..            
+00024830: 2020 2020 2a20 2261 6273 5f63 656e 7472      * "abs_centr
+00024840: 6f69 645f 736c 6963 655f 7374 6174 7322  oid_slice_stats"
+00024850: 3a20 7374 6174 6973 7469 6373 2073 7065  : statistics spe
+00024860: 6369 6669 6564 2069 6e0a 2020 2020 2020  cified in.      
+00024870: 2020 2020 2020 2020 2020 2020 3c73 6c69              <sli
+00024880: 6365 5f73 7461 7473 3e20 666f 7220 736c  ce_stats> for sl
+00024890: 6963 652d 6279 2d73 6c69 6365 206d 6167  ice-by-slice mag
+000248a0: 6e69 7475 6465 7320 6f66 2032 440a 2020  nitudes of 2D.  
+000248b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000248c0: 6365 6e74 726f 6964 2064 6973 7461 6e63  centroid distanc
+000248d0: 6520 7665 6374 6f72 732e 0a0a 2020 2020  e vectors...    
+000248e0: 2020 2020 2020 2020 2020 2020 2a20 2276              * "v
+000248f0: 6f6c 756d 655f 6469 6666 223a 2076 6f6c  olume_diff": vol
+00024900: 756d 6520 6469 6666 6572 656e 6365 2028  ume difference (
+00024910: 6f77 6e20 766f 6c75 6d65 202d 206f 7468  own volume - oth
+00024920: 6572 2076 6f6c 756d 6529 2e0a 2020 2020  er volume)..    
+00024930: 2020 2020 2020 2020 2020 2020 2a20 2272              * "r
+00024940: 656c 5f76 6f6c 756d 655f 6469 6666 223a  el_volume_diff":
+00024950: 2076 6f6c 756d 6520 6469 6666 6572 656e   volume differen
+00024960: 6365 2064 6976 6964 6564 2062 7920 6f77  ce divided by ow
+00024970: 6e20 766f 6c75 6d65 2e0a 2020 2020 2020  n volume..      
+00024980: 2020 2020 2020 2020 2020 2a20 2276 6f6c            * "vol
+00024990: 756d 655f 7261 7469 6f22 3a20 766f 6c75  ume_ratio": volu
+000249a0: 6d65 2072 6174 696f 2028 6f77 6e20 766f  me ratio (own vo
+000249b0: 6c75 6d65 202f 206f 7468 6572 2076 6f6c  lume / other vol
+000249c0: 756d 6529 2e0a 0a20 2020 2020 2020 2020  ume)...         
+000249d0: 2020 2020 2020 202a 2022 6172 6561 5f64         * "area_d
+000249e0: 6966 6622 3a20 6172 6561 2064 6966 6665  iff": area diffe
+000249f0: 7265 6e63 6520 286f 776e 2061 7265 6120  rence (own area 
+00024a00: 2d20 6f74 6865 7220 6172 6561 2920 6f6e  - other area) on
+00024a10: 2061 200a 2020 2020 2020 2020 2020 2020   a .            
+00024a20: 2020 2020 2020 7369 6e67 6c65 2073 6c69        single sli
+00024a30: 6365 2e0a 2020 2020 2020 2020 2020 2020  ce..            
+00024a40: 2020 2020 2a20 2272 656c 5f61 7265 615f      * "rel_area_
+00024a50: 6469 6666 223a 2061 7265 6120 6469 6666  diff": area diff
+00024a60: 6572 656e 6365 2064 6976 6964 6564 2062  erence divided b
+00024a70: 7920 6f77 6e20 6172 6561 206f 6e20 6120  y own area on a 
+00024a80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00024a90: 2020 2073 696e 676c 6520 736c 6963 652e     single slice.
+00024aa0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00024ab0: 202a 2022 6172 6561 5f72 6174 696f 223a   * "area_ratio":
+00024ac0: 2061 7265 6120 7261 7469 6f20 286f 776e   area ratio (own
+00024ad0: 2061 7265 6120 2f20 6f74 6865 7220 6172   area / other ar
+00024ae0: 6561 292e 0a20 2020 2020 2020 2020 2020  ea)..           
+00024af0: 2020 2020 202a 2022 6172 6561 5f64 6966       * "area_dif
+00024b00: 665f 666c 6174 223a 2061 7265 6120 6469  f_flat": area di
+00024b10: 6666 6572 656e 6365 206f 6620 524f 4973  fference of ROIs
+00024b20: 2066 6c61 7474 656e 6564 2069 6e20 7468   flattened in th
+00024b30: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
+00024b40: 2020 2020 6f72 6965 6e74 6174 696f 6e20      orientation 
+00024b50: 7370 6563 6966 6965 6420 696e 203c 7669  specified in <vi
+00024b60: 6577 3e2e 0a20 2020 2020 2020 2020 2020  ew>..           
+00024b70: 2020 2020 202a 2022 6172 6561 5f64 6966       * "area_dif
+00024b80: 665f 736c 6963 655f 7374 6174 7322 3a20  f_slice_stats": 
+00024b90: 7374 6174 6973 7469 6373 2073 7065 6369  statistics speci
+00024ba0: 6669 6564 2069 6e0a 2020 2020 2020 2020  fied in.        
+00024bb0: 2020 2020 2020 2020 2020 3c73 6c69 6365            <slice
+00024bc0: 5f73 7461 7473 3e20 666f 7220 736c 6963  _stats> for slic
+00024bd0: 652d 6279 2d73 6c69 6365 2061 7265 6120  e-by-slice area 
+00024be0: 6469 6666 6572 656e 6365 732e 0a20 2020  differences..   
+00024bf0: 2020 2020 2020 2020 2020 2020 202a 2022               * "
+00024c00: 7265 6c5f 6172 6561 5f64 6966 665f 666c  rel_area_diff_fl
+00024c10: 6174 223a 2072 656c 6174 6976 6520 6172  at": relative ar
+00024c20: 6561 2064 6966 6665 7265 6e63 6520 6f66  ea difference of
+00024c30: 2052 4f49 730a 2020 2020 2020 2020 2020   ROIs.          
+00024c40: 2020 2020 2020 2020 666c 6174 7465 6e65          flattene
+00024c50: 6420 696e 2074 6865 206f 7269 656e 7461  d in the orienta
+00024c60: 7469 6f6e 2073 7065 6369 6669 6564 2069  tion specified i
+00024c70: 6e20 3c76 6965 773e 2e0a 2020 2020 2020  n <view>..      
+00024c80: 2020 2020 2020 2020 2020 2a20 2272 656c            * "rel
+00024c90: 5f61 7265 615f 6469 6666 5f73 6c69 6365  _area_diff_slice
+00024ca0: 5f73 7461 7473 223a 2073 7461 7469 7374  _stats": statist
+00024cb0: 6963 7320 7370 6563 6966 6965 6420 696e  ics specified in
+00024cc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00024cd0: 2020 203c 736c 6963 655f 7374 6174 733e     <slice_stats>
+00024ce0: 2066 6f72 2072 656c 6174 6976 6520 6172   for relative ar
+00024cf0: 6561 2064 6966 6665 7265 6e63 6573 206f  ea differences o
+00024d00: 6620 524f 4973 2e0a 2020 2020 2020 2020  f ROIs..        
+00024d10: 2020 2020 2020 2020 2a20 2261 7265 615f          * "area_
+00024d20: 7261 7469 6f5f 666c 6174 223a 2061 7265  ratio_flat": are
+00024d30: 6120 7261 7469 6f20 6f66 2052 4f49 7320  a ratio of ROIs 
+00024d40: 666c 6174 7465 6e65 6420 696e 2074 6865  flattened in the
+00024d50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00024d60: 2020 206f 7269 656e 7461 7469 6f6e 2073     orientation s
+00024d70: 7065 6369 6669 6564 2069 6e20 3c76 6965  pecified in <vie
+00024d80: 773e 2e0a 2020 2020 2020 2020 2020 2020  w>..            
+00024d90: 2020 2020 2a20 2261 7265 615f 7261 7469      * "area_rati
+00024da0: 6f5f 736c 6963 655f 7374 6174 7322 3a20  o_slice_stats": 
+00024db0: 7374 6174 6973 7469 6373 2073 7065 6369  statistics speci
+00024dc0: 6669 6564 2069 6e0a 2020 2020 2020 2020  fied in.        
+00024dd0: 2020 2020 2020 2020 2020 3c73 6c69 6365            <slice
+00024de0: 5f73 7461 7473 3e20 666f 7220 736c 6963  _stats> for slic
+00024df0: 652d 6279 2d73 6c69 6365 2061 7265 6120  e-by-slice area 
+00024e00: 7261 7469 6f73 2e0a 0a20 2020 2020 2020  ratios...       
+00024e10: 2020 2020 2020 2020 202a 2022 6d65 616e           * "mean
+00024e20: 5f73 6967 6e65 645f 7375 7266 6163 655f  _signed_surface_
+00024e30: 6469 7374 616e 6365 223a 206d 6561 6e20  distance": mean 
+00024e40: 7369 676e 6564 2073 7572 6661 6365 2064  signed surface d
+00024e50: 6973 7461 6e63 652e 0a20 2020 2020 2020  istance..       
+00024e60: 2020 2020 2020 2020 202a 2022 6d65 616e           * "mean
+00024e70: 5f73 6967 6e65 645f 7375 7266 6163 655f  _signed_surface_
+00024e80: 6469 7374 616e 6365 5f66 6c61 7422 3a20  distance_flat": 
+00024e90: 6d65 616e 2073 6967 6e65 6420 7375 7266  mean signed surf
+00024ea0: 6163 650a 2020 2020 2020 2020 2020 2020  ace.            
+00024eb0: 2020 2020 2020 6469 7374 616e 6365 206f        distance o
+00024ec0: 6620 524f 4973 2066 6c61 7474 656e 6564  f ROIs flattened
+00024ed0: 2069 6e20 7468 6520 6f72 6965 6e74 6174   in the orientat
+00024ee0: 696f 6e20 7370 6563 6966 6965 640a 2020  ion specified.  
+00024ef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024f00: 696e 203c 7669 6577 3e2e 0a20 2020 2020  in <view>..     
+00024f10: 2020 2020 2020 2020 2020 202a 2022 6d65             * "me
+00024f20: 616e 5f73 7572 6661 6365 5f64 6973 7461  an_surface_dista
+00024f30: 6e63 6522 3a20 6d65 616e 2073 7572 6661  nce": mean surfa
+00024f40: 6365 2064 6973 7461 6e63 652e 0a20 2020  ce distance..   
+00024f50: 2020 2020 2020 2020 2020 2020 202a 2022               * "
+00024f60: 6d65 616e 5f73 7572 6661 6365 5f64 6973  mean_surface_dis
+00024f70: 7461 6e63 655f 666c 6174 223a 206d 6561  tance_flat": mea
+00024f80: 6e20 7375 7266 6163 6520 6469 7374 616e  n surface distan
+00024f90: 6365 206f 6620 524f 4973 0a20 2020 2020  ce of ROIs.     
+00024fa0: 2020 2020 2020 2020 2020 2020 2066 6c61               fla
+00024fb0: 7474 656e 6564 2069 6e20 7468 6520 6f72  ttened in the or
+00024fc0: 6965 6e74 6174 696f 6e20 7370 6563 6966  ientation specif
+00024fd0: 6965 6420 696e 203c 7669 6577 3e2e 0a20  ied in <view>.. 
+00024fe0: 2020 2020 2020 2020 2020 2020 2020 202a                 *
+00024ff0: 2022 726d 735f 7375 7266 6163 655f 6469   "rms_surface_di
+00025000: 7374 616e 6365 223a 2052 4d53 2073 7572  stance": RMS sur
+00025010: 6661 6365 2064 6973 7461 6e63 652e 0a20  face distance.. 
+00025020: 2020 2020 2020 2020 2020 2020 2020 202a                 *
+00025030: 2022 726d 735f 7375 7266 6163 655f 6469   "rms_surface_di
+00025040: 7374 616e 6365 5f66 6c61 7422 3a20 524d  stance_flat": RM
+00025050: 5320 7375 7266 6163 6520 6469 7374 616e  S surface distan
+00025060: 6365 206f 6620 524f 4973 0a20 2020 2020  ce of ROIs.     
+00025070: 2020 2020 2020 2020 2020 2020 2066 6c61               fla
+00025080: 7474 656e 6564 2069 6e20 7468 6520 6f72  ttened in the or
+00025090: 6965 6e74 6174 696f 6e20 7370 6563 6966  ientation specif
+000250a0: 6965 6420 696e 203c 7669 6577 3e2e 0a20  ied in <view>.. 
+000250b0: 2020 2020 2020 2020 2020 2020 2020 202a                 *
+000250c0: 2022 726d 735f 7369 676e 6564 5f73 7572   "rms_signed_sur
+000250d0: 6661 6365 5f64 6973 7461 6e63 6522 3a20  face_distance": 
+000250e0: 524d 5320 7369 676e 6564 2073 7572 6661  RMS signed surfa
+000250f0: 6365 2064 6973 7461 6e63 652e 0a20 2020  ce distance..   
+00025100: 2020 2020 2020 2020 2020 2020 202a 2022               * "
+00025110: 726d 735f 7369 676e 6564 5f73 7572 6661  rms_signed_surfa
+00025120: 6365 5f64 6973 7461 6e63 655f 666c 6174  ce_distance_flat
+00025130: 223a 2052 4d53 2073 6967 6e65 6420 7375  ": RMS signed su
+00025140: 7266 6163 650a 2020 2020 2020 2020 2020  rface.          
+00025150: 2020 2020 2020 2020 6469 7374 616e 6365          distance
+00025160: 206f 6620 524f 4973 2066 6c61 7474 656e   of ROIs flatten
+00025170: 6564 2069 6e20 7468 6520 6f72 6965 6e74  ed in the orient
+00025180: 6174 696f 6e20 7370 6563 6966 6965 640a  ation specified.
+00025190: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000251a0: 2020 696e 203c 7669 6577 3e2e 0a20 2020    in <view>..   
+000251b0: 2020 2020 2020 2020 2020 2020 202a 2022               * "
+000251c0: 6861 7573 646f 7266 665f 6469 7374 616e  hausdorff_distan
+000251d0: 6365 223a 2048 6175 7364 6f72 6666 2064  ce": Hausdorff d
+000251e0: 6973 7461 6e63 652e 0a20 2020 2020 2020  istance..       
+000251f0: 2020 2020 2020 2020 202a 2022 6861 7573           * "haus
+00025200: 646f 7266 665f 6469 7374 616e 6365 5f66  dorff_distance_f
+00025210: 6c61 7422 3a20 4861 7573 646f 7266 6620  lat": Hausdorff 
+00025220: 6469 7374 616e 6365 206f 6620 524f 4973  distance of ROIs
+00025230: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00025240: 2020 2066 6c61 7474 656e 6564 2069 6e20     flattened in 
+00025250: 7468 6520 6f72 6965 6e74 6174 696f 6e20  the orientation 
+00025260: 7370 6563 6966 6965 6420 696e 203c 7669  specified in <vi
+00025270: 6577 3e2e 0a20 2020 2020 2020 2020 2020  ew>..           
+00025280: 2020 2020 202a 2022 6d65 616e 5f75 6e64       * "mean_und
+00025290: 6572 5f63 6f6e 746f 7572 696e 6722 3a20  er_contouring": 
+000252a0: 5375 6d20 6f66 2061 6273 6f6c 7574 6520  Sum of absolute 
+000252b0: 7661 6c75 6573 206f 660a 2020 2020 2020  values of.      
+000252c0: 2020 2020 2020 2020 2020 2020 6e65 6761              nega
+000252d0: 7469 7665 2064 6973 7461 6e63 6573 2074  tive distances t
+000252e0: 6f20 636f 6e66 6f72 6d69 7479 2c20 6469  o conformity, di
+000252f0: 7669 6465 6420 6279 2076 6f6c 756d 650a  vided by volume.
+00025300: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025310: 2020 696e 2075 6e69 6f6e 206f 6620 524f    in union of RO
+00025320: 4973 2063 6f6d 7061 7265 642e 0a20 2020  Is compared..   
+00025330: 2020 2020 2020 2020 2020 2020 202a 2022               * "
+00025340: 6d65 616e 5f75 6e64 6572 5f63 6f6e 746f  mean_under_conto
+00025350: 7572 696e 675f 666c 6174 223a 2053 756d  uring_flat": Sum
+00025360: 206f 6620 6162 736f 6c75 7465 2076 616c   of absolute val
+00025370: 7565 7320 6f66 0a20 2020 2020 2020 2020  ues of.         
+00025380: 2020 2020 2020 2020 206e 6567 6174 6976           negativ
+00025390: 6520 6469 7374 616e 6365 7320 746f 2063  e distances to c
+000253a0: 6f6e 666f 726d 6974 792c 2064 6976 6964  onformity, divid
+000253b0: 6564 2062 7920 766f 6c75 6d65 2c0a 2020  ed by volume,.  
+000253c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000253d0: 666c 6174 7465 6e65 6420 696e 2074 6865  flattened in the
+000253e0: 206f 7269 656e 7461 7469 6f6e 2073 7065   orientation spe
+000253f0: 6369 6669 6564 2069 6e20 3c76 6965 773e  cified in <view>
+00025400: 2e0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00025410: 2020 2020 696e 2075 6e69 6f6e 206f 6620      in union of 
+00025420: 524f 4973 2063 6f6d 7061 7265 642e 0a20  ROIs compared.. 
+00025430: 2020 2020 2020 2020 2020 2020 2020 202a                 *
+00025440: 2022 6d65 616e 5f6f 7665 725f 636f 6e74   "mean_over_cont
+00025450: 6f75 7269 6e67 223a 2053 756d 206f 6620  ouring": Sum of 
+00025460: 706f 7369 7469 7665 2064 6973 7461 6e63  positive distanc
+00025470: 6573 0a20 2020 2020 2020 2020 2020 2020  es.             
+00025480: 2020 2020 2074 6f20 636f 6e66 6f72 6d69       to conformi
+00025490: 7479 2c20 6469 7669 6465 6420 6279 2076  ty, divided by v
+000254a0: 6f6c 756d 6520 696e 2075 6e69 6f6e 206f  olume in union o
+000254b0: 6620 524f 4973 2063 6f6d 7061 7265 642e  f ROIs compared.
+000254c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000254d0: 202a 2022 6d65 616e 5f6f 7665 725f 636f   * "mean_over_co
+000254e0: 6e74 6f75 7269 6e67 5f66 6c61 7422 3a20  ntouring_flat": 
+000254f0: 5375 6d20 6f66 2070 6f73 6974 6976 6520  Sum of positive 
+00025500: 6469 7374 616e 6365 730a 2020 2020 2020  distances.      
+00025510: 2020 2020 2020 2020 2020 2020 746f 2063              to c
+00025520: 6f6e 666f 726d 6974 792c 2064 6976 6964  onformity, divid
+00025530: 6564 2062 7920 766f 6c75 6d65 2069 6e20  ed by volume in 
+00025540: 756e 696f 6e20 6f66 2052 4f49 7320 636f  union of ROIs co
+00025550: 6d70 6172 6564 2c0a 2020 2020 2020 2020  mpared,.        
+00025560: 2020 2020 2020 2020 2020 666c 6174 7465            flatte
+00025570: 6e65 6420 696e 2074 6865 206f 7269 656e  ned in the orien
+00025580: 7461 7469 6f6e 2073 7065 6369 6669 6564  tation specified
+00025590: 2069 6e20 3c76 6965 773e 2e0a 2020 2020   in <view>..    
+000255a0: 2020 2020 2020 2020 2020 2020 2a20 226d              * "m
+000255b0: 6561 6e5f 6469 7374 616e 6365 5f74 6f5f  ean_distance_to_
+000255c0: 636f 6e66 6f72 6d69 7479 223a 2053 756d  conformity": Sum
+000255d0: 206f 6620 6d65 616e 5f75 6e64 6572 5f63   of mean_under_c
+000255e0: 6f6e 746f 7572 696e 670a 2020 2020 2020  ontouring.      
+000255f0: 2020 2020 2020 2020 2020 2020 616e 6420              and 
+00025600: 6d65 616e 5f6f 7665 725f 636f 6e74 6f75  mean_over_contou
+00025610: 7269 6e67 2e0a 2020 2020 2020 2020 2020  ring..          
+00025620: 2020 2020 2020 2a20 226d 6561 6e5f 6469        * "mean_di
+00025630: 7374 616e 6365 5f74 6f5f 636f 6e66 6f72  stance_to_confor
+00025640: 6d69 7479 5f66 6c61 7422 3a20 5375 6d20  mity_flat": Sum 
+00025650: 6f66 0a20 2020 2020 2020 2020 2020 2020  of.             
+00025660: 2020 2020 206d 6561 6e5f 756e 6465 725f       mean_under_
+00025670: 636f 6e74 6f75 7269 6e67 5f66 6c61 7420  contouring_flat 
+00025680: 616e 6420 6d65 616e 5f6f 7665 725f 636f  and mean_over_co
+00025690: 6e74 6f75 7269 6e67 5f66 6c61 742e 0a0a  ntouring_flat...
+000256a0: 2020 2020 2020 2020 2020 2020 4966 204e              If N
+000256b0: 6f6e 652c 2064 6566 6175 6c74 7320 746f  one, defaults to
+000256c0: 205b 2264 6963 6522 2c20 2263 656e 7472   ["dice", "centr
+000256d0: 6f69 6422 5d2e 0a0a 2020 2020 2020 2020  oid"]...        
+000256e0: 766f 6c5f 756e 6974 7320 3a20 7374 722c  vol_units : str,
+000256f0: 2064 6566 6175 6c74 3d22 6d6d 220a 2020   default="mm".  
+00025700: 2020 2020 2020 2020 2020 556e 6974 7320            Units 
+00025710: 746f 2075 7365 2066 6f72 2076 6f6c 756d  to use for volum
+00025720: 652e 2043 616e 2062 6520 226d 6d22 2028  e. Can be "mm" (
+00025730: 3d6d 6d5e 3329 2c20 226d 6c22 2c0a 2020  =mm^3), "ml",.  
+00025740: 2020 2020 2020 2020 2020 6f72 2022 766f            or "vo
+00025750: 7865 6c73 222e 0a0a 2020 2020 2020 2020  xels"...        
+00025760: 6172 6561 5f75 6e69 7473 203a 2073 7472  area_units : str
+00025770: 2c20 6465 6661 756c 743d 226d 6d22 0a20  , default="mm". 
+00025780: 2020 2020 2020 2020 2020 2055 6e69 7473             Units
+00025790: 2074 6f20 7573 6520 666f 7220 6172 6561   to use for area
+000257a0: 732e 2043 616e 2062 6520 226d 6d22 2028  s. Can be "mm" (
+000257b0: 3d6d 6d5e 3229 206f 7220 2276 6f78 656c  =mm^2) or "voxel
+000257c0: 7322 2e0a 0a20 2020 2020 2020 2063 656e  s"...        cen
+000257d0: 7472 6f69 645f 756e 6974 733a 0a20 2020  troid_units:.   
+000257e0: 2020 2020 2020 2020 2055 6e69 7473 2074           Units t
+000257f0: 6f20 7573 6520 666f 7220 6365 6e74 726f  o use for centro
+00025800: 6964 732e 2043 616e 2062 6520 226d 6d22  ids. Can be "mm"
+00025810: 206f 7220 2276 6f78 656c 7322 2e0a 0a20   or "voxels"... 
+00025820: 2020 2020 2020 2076 6965 7720 3a20 7374         view : st
+00025830: 722c 2064 6566 6175 6c74 3d22 782d 7922  r, default="x-y"
+00025840: 0a20 2020 2020 2020 2020 2020 204f 7269  .            Ori
+00025850: 656e 7461 7469 6f6e 2069 6e20 7768 6963  entation in whic
+00025860: 6820 746f 2063 6f6d 7075 7465 206d 6574  h to compute met
+00025870: 7269 6373 2e20 4f6e 6c79 2072 656c 6576  rics. Only relev
+00025880: 616e 7420 666f 7220 0a20 2020 2020 2020  ant for .       
+00025890: 2020 2020 2073 696e 676c 652d 736c 6963       single-slic
+000258a0: 6520 6d65 7472 6963 7320 6f72 2066 6c61  e metrics or fla
+000258b0: 7474 656e 6564 206d 6574 7269 6373 2e0a  ttened metrics..
+000258c0: 0a20 2020 2020 2020 2073 6c20 3a20 696e  .        sl : in
+000258d0: 742c 2064 6566 6175 6c74 3d4e 6f6e 650a  t, default=None.
+000258e0: 2020 2020 2020 2020 2020 2020 536c 6963              Slic
+000258f0: 6520 6e75 6d62 6572 206f 6e20 7768 6963  e number on whic
+00025900: 6820 746f 2063 6f6d 7075 7465 206d 6574  h to compute met
+00025910: 7269 6373 2e20 4f6e 6c79 2072 656c 6576  rics. Only relev
+00025920: 616e 7420 666f 7220 0a20 2020 2020 2020  ant for .       
+00025930: 2020 2020 2073 696e 676c 652d 736c 6963       single-slic
+00025940: 6520 6d65 7472 6963 7320 2861 7265 612c  e metrics (area,
+00025950: 2063 656e 7472 6f69 645f 736c 6963 652c   centroid_slice,
+00025960: 206c 656e 6774 685f 736c 6963 6529 2e0a   length_slice)..
+00025970: 2020 2020 2020 2020 2020 2020 4966 203c              If <
+00025980: 736c 3e2c 203c 6964 783e 2c20 616e 6420  sl>, <idx>, and 
+00025990: 3c70 6f73 3e20 6172 6520 616c 6c20 4e6f  <pos> are all No
+000259a0: 6e65 2c20 7468 6520 6365 6e74 7261 6c20  ne, the central 
+000259b0: 736c 6963 6520 6f66 2074 6865 0a20 2020  slice of the.   
+000259c0: 2020 2020 2020 2020 2052 4f49 2077 696c           ROI wil
+000259d0: 6c20 6265 2075 7365 642e 0a0a 2020 2020  l be used...    
+000259e0: 2020 2020 6964 7820 3a20 696e 742c 2064      idx : int, d
+000259f0: 6566 6175 6c74 3d4e 6f6e 650a 2020 2020  efault=None.    
+00025a00: 2020 2020 2020 2020 536c 6963 6520 696e          Slice in
+00025a10: 6465 7820 6172 7261 7920 6f6e 2077 6869  dex array on whi
+00025a20: 6368 2074 6f20 636f 6d70 7574 6520 6d65  ch to compute me
+00025a30: 7472 6963 732e 204f 6e6c 7920 7265 6c65  trics. Only rele
+00025a40: 7661 6e74 2066 6f72 200a 2020 2020 2020  vant for .      
+00025a50: 2020 2020 2020 7369 6e67 6c65 2d73 6c69        single-sli
+00025a60: 6365 206d 6574 7269 6373 2028 6172 6561  ce metrics (area
+00025a70: 2c20 6365 6e74 726f 6964 5f73 6c69 6365  , centroid_slice
+00025a80: 2c20 6c65 6e67 7468 5f73 6c69 6365 292e  , length_slice).
+00025a90: 0a20 2020 2020 2020 2020 2020 2055 7365  .            Use
+00025aa0: 6420 6966 203c 736c 3e20 6973 204e 6f6e  d if <sl> is Non
+00025ab0: 652e 0a0a 2020 2020 2020 2020 706f 7320  e...        pos 
+00025ac0: 3a20 666c 6f61 742c 2064 6566 6175 6c74  : float, default
+00025ad0: 3d4e 6f6e 650a 2020 2020 2020 2020 2020  =None.          
+00025ae0: 2020 536c 6963 6520 706f 7369 7469 6f6e    Slice position
+00025af0: 2069 6e20 6d6d 206f 6e20 7768 6963 6820   in mm on which 
+00025b00: 746f 2063 6f6d 7075 7465 206d 6574 7269  to compute metri
+00025b10: 6373 2e20 4f6e 6c79 2072 656c 6576 616e  cs. Only relevan
+00025b20: 7420 666f 7220 0a20 2020 2020 2020 2020  t for .         
+00025b30: 2020 2073 696e 676c 652d 736c 6963 6520     single-slice 
+00025b40: 6d65 7472 6963 7320 2861 7265 612c 2063  metrics (area, c
+00025b50: 656e 7472 6f69 645f 736c 6963 652c 206c  entroid_slice, l
+00025b60: 656e 6774 685f 736c 6963 6529 2e0a 2020  ength_slice)..  
+00025b70: 2020 2020 2020 2020 2020 5573 6564 2069            Used i
+00025b80: 6620 3c73 6c3e 2061 6e64 203c 6964 783e  f <sl> and <idx>
+00025b90: 2061 7265 2062 6f74 6820 4e6f 6e65 2e0a   are both None..
+00025ba0: 0a20 2020 2020 2020 206d 6574 686f 6420  .        method 
+00025bb0: 3a20 7374 722c 2064 6566 6175 6c74 3d4e  : str, default=N
+00025bc0: 6f6e 650a 2020 2020 2020 2020 2020 2020  one.            
+00025bd0: 4d65 7468 6f64 2074 6f20 7573 6520 666f  Method to use fo
+00025be0: 7220 6d65 7472 6963 2063 616c 6375 6c61  r metric calcula
+00025bf0: 7469 6f6e 2e20 4361 6e20 6265 2065 6974  tion. Can be eit
+00025c00: 6865 7220 2263 6f6e 746f 7572 2220 0a20  her "contour" . 
+00025c10: 2020 2020 2020 2020 2020 2028 7573 6520             (use 
+00025c20: 7368 6170 656c 7920 706f 6c79 676f 6e73  shapely polygons
+00025c30: 2920 6f72 2022 6d61 736b 2220 2875 7365  ) or "mask" (use
+00025c40: 2062 696e 6172 7920 6d61 736b 292e 2049   binary mask). I
+00025c50: 6620 4e6f 6e65 2c0a 2020 2020 2020 2020  f None,.        
+00025c60: 2020 2020 7468 6520 7661 6c75 6520 7365      the value se
+00025c70: 7420 696e 2073 656c 662e 6465 6661 756c  t in self.defaul
+00025c80: 745f 6765 6f6d 5f6d 6574 686f 6420 7769  t_geom_method wi
+00025c90: 6c6c 2062 6520 7573 6564 2e20 4e6f 7465  ll be used. Note
+00025ca0: 200a 2020 2020 2020 2020 2020 2020 7468   .            th
+00025cb0: 6174 2066 6c61 7474 656e 6564 206d 6574  at flattened met
+00025cc0: 7269 6373 2061 6e64 2073 7572 6661 6365  rics and surface
+00025cd0: 2064 6973 7461 6e63 6520 6d65 7472 6963   distance metric
+00025ce0: 7320 656e 666f 7263 6520 7573 650a 2020  s enforce use.  
+00025cf0: 2020 2020 2020 2020 2020 6f66 2074 6865            of the
+00025d00: 2022 6d61 736b 2220 6d65 7468 6f64 2e0a   "mask" method..
+00025d10: 0a20 2020 2020 2020 2073 6c69 6365 5f73  .        slice_s
+00025d20: 7461 7473 203a 2073 7472 2f6c 6973 742f  tats : str/list/
+00025d30: 6469 6374 2c20 6465 6661 756c 743d 4e6f  dict, default=No
+00025d40: 6e65 0a20 2020 2020 2020 2020 2020 2053  ne.            S
+00025d50: 7065 6369 6669 6361 7469 6f6e 206f 6620  pecification of 
+00025d60: 7374 6174 6973 7469 6373 2074 6f20 6265  statistics to be
+00025d70: 2063 616c 6375 6c61 7465 6420 7265 6c61   calculated rela
+00025d80: 7469 7665 0a20 2020 2020 2020 2020 2020  tive.           
+00025d90: 2074 6f20 736c 6963 652d 6279 2d73 6c69   to slice-by-sli
+00025da0: 6365 206d 6574 7269 6320 7661 6c75 6573  ce metric values
+00025db0: 2e20 2055 7365 6420 666f 7220 616c 6c20  .  Used for all 
+00025dc0: 6d65 7472 6963 7320 7769 7468 0a20 2020  metrics with.   
+00025dd0: 2020 2020 2020 2020 2073 7566 6669 7820           suffix 
+00025de0: 225f 736c 6963 655f 7374 6174 7322 2069  "_slice_stats" i
+00025df0: 6e20 7468 6520 3c6d 6574 7269 6373 3e20  n the <metrics> 
+00025e00: 6c69 7374 2e0a 0a20 2020 2020 2020 2020  list...         
+00025e10: 2020 2041 2073 7461 7469 7374 6963 2069     A statistic i
+00025e20: 7320 7370 6563 6966 6965 6420 6279 2074  s specified by t
+00025e30: 6865 206e 616d 6520 6f66 2074 6865 2066  he name of the f
+00025e40: 756e 6374 696f 6e20 666f 720a 2020 2020  unction for.    
+00025e50: 2020 2020 2020 2020 6974 7320 6361 6c63          its calc
+00025e60: 756c 6174 696f 6e20 696e 2074 6865 2050  ulation in the P
+00025e70: 7974 686f 6e20 7374 6174 6973 7469 6373  ython statistics
+00025e80: 206d 6f64 756c 653a 0a0a 2020 2020 2020   module:..      
+00025e90: 2020 2020 2020 6874 7470 733a 2f2f 646f        https://do
+00025ea0: 6373 2e70 7974 686f 6e2e 6f72 672f 332f  cs.python.org/3/
+00025eb0: 6c69 6272 6172 792f 7374 6174 6973 7469  library/statisti
+00025ec0: 6373 2e68 746d 6c0a 0a20 2020 2020 2020  cs.html..       
+00025ed0: 2020 2020 2046 6f72 2069 7473 2075 7365       For its use
+00025ee0: 2068 6572 652c 2074 6865 2072 656c 6576   here, the relev
+00025ef0: 616e 7420 6675 6e63 7469 6f6e 206d 7573  ant function mus
+00025f00: 7420 7265 7175 6972 650a 2020 2020 2020  t require.      
+00025f10: 2020 2020 2020 6120 7369 6e67 6c65 2d76        a single-v
+00025f20: 6172 6961 626c 6520 696e 7075 742c 206d  ariable input, m
+00025f30: 7573 7420 6e6f 7420 7265 7175 6972 6520  ust not require 
+00025f40: 616e 7920 6b65 7977 6f72 640a 2020 2020  any keyword.    
+00025f50: 2020 2020 2020 2020 6172 6775 6d65 6e74          argument
+00025f60: 732c 2061 6e64 206d 7573 7420 7265 7475  s, and must retu
+00025f70: 726e 2061 2073 696e 676c 6520 6e75 6d62  rn a single numb
+00025f80: 6572 2e0a 0a20 2020 2020 2020 2020 2020  er...           
+00025f90: 2041 7661 696c 6162 6c65 206f 7074 696f   Available optio
+00025fa0: 6e73 2069 6e63 6c75 6465 3a20 226d 6561  ns include: "mea
+00025fb0: 6e22 2c20 226d 6564 6961 6e22 2c20 226d  n", "median", "m
+00025fc0: 6f64 6522 2c0a 2020 2020 2020 2020 2020  ode",.          
+00025fd0: 2020 2273 7464 6576 222e 0a0a 2020 2020    "stdev"...    
+00025fe0: 2020 2020 2020 2053 7461 7469 7374 6963         Statistic
+00025ff0: 7320 746f 2062 6520 6361 6c63 756c 6174  s to be calculat
+00026000: 6564 2063 616e 2062 6520 7370 6563 6966  ed can be specif
+00026010: 6965 6420 7573 696e 6720 616e 7920 6f66  ied using any of
+00026020: 0a20 2020 2020 2020 2020 2020 7468 6520  .           the 
+00026030: 666f 6c6c 6f77 696e 673a 0a0a 2020 2020  following:..    
+00026040: 2020 2020 2020 202d 2053 7472 696e 6720         - String 
+00026050: 7370 6563 6966 7969 6e67 2073 696e 676c  specifying singl
+00026060: 6520 7374 6174 6973 7469 6320 746f 2062  e statistic to b
+00026070: 6520 6361 6c63 756c 6174 6564 2c0a 2020  e calculated,.  
+00026080: 2020 2020 2020 2020 2020 2077 6974 6820             with 
+00026090: 736c 6963 6573 2063 6f6e 7369 6465 7265  slices considere
+000260a0: 6420 6173 2067 6976 656e 2062 7920 6465  d as given by de
+000260b0: 6661 756c 745f 6279 5f73 6c69 6365 2c0a  fault_by_slice,.
+000260c0: 2020 2020 2020 2020 2020 2020 2066 6f72               for
+000260d0: 2065 7861 6d70 6c65 3a20 226d 6561 6e22   example: "mean"
+000260e0: 3b0a 2020 2020 2020 2020 2020 202d 204c  ;.           - L
+000260f0: 6973 7420 7370 6563 6966 7969 6e67 206d  ist specifying m
+00026100: 756c 7469 706c 6520 7374 6174 6973 7469  ultiple statisti
+00026110: 6373 2074 6f20 6265 2063 616c 6375 6c61  cs to be calcula
+00026120: 7465 642c 0a20 2020 2020 2020 2020 2020  ted,.           
+00026130: 2020 7769 7468 2073 6c69 6365 7320 636f    with slices co
+00026140: 6e73 6964 6572 6564 2061 7320 6769 7665  nsidered as give
+00026150: 6e20 6279 2064 6566 6175 6c74 5f62 795f  n by default_by_
+00026160: 736c 6963 652c 0a20 2020 2020 2020 2020  slice,.         
+00026170: 2020 2020 666f 7220 6578 616d 706c 653a      for example:
+00026180: 205b 226d 6561 6e22 2c20 2273 7464 6576   ["mean", "stdev
+00026190: 225d 3b0a 2020 2020 2020 2020 2020 202d  "];.           -
+000261a0: 2044 6963 7469 6f6e 6172 7920 7768 6572   Dictionary wher
+000261b0: 6520 6b65 7973 2073 7065 6369 6679 2073  e keys specify s
+000261c0: 6c69 6365 7320 746f 2062 6520 636f 6e73  lices to be cons
+000261d0: 6964 6572 6564 2c0a 2020 2020 2020 2020  idered,.        
+000261e0: 2020 2020 2061 6e64 2076 616c 7565 7320       and values 
+000261f0: 7370 6563 6966 7920 7374 6174 6973 7469  specify statisti
+00026200: 6373 2028 7374 7269 6e67 206f 7220 6c69  cs (string or li
+00026210: 7374 292c 2066 6f72 0a20 2020 2020 2020  st), for.       
+00026220: 2020 2020 2020 6578 616d 706c 653a 207b        example: {
+00026230: 2275 6e69 6f6e 223a 205b 226d 6561 6e22  "union": ["mean"
+00026240: 2c20 2273 7464 6576 225d 7d2e 2020 5661  , "stdev"]}.  Va
+00026250: 6c69 6420 736c 6963 650a 2020 2020 2020  lid slice.      
+00026260: 2020 2020 2020 2073 7065 6369 6669 6361         specifica
+00026270: 7469 6f6e 7320 6172 6520 6173 206c 6973  tions are as lis
+00026280: 7465 6420 666f 7220 6465 6661 756c 745f  ted for default_
+00026290: 6279 5f73 6c69 6365 2e0a 0a20 2020 2020  by_slice...     
+000262a0: 2020 2064 6566 6175 6c74 5f62 795f 736c     default_by_sl
+000262b0: 6963 653a 2073 7472 2c20 6465 6661 756c  ice: str, defaul
+000262c0: 743d 4e6f 6e65 0a20 2020 2020 2020 2020  t=None.         
+000262d0: 2020 2044 6566 6175 6c74 2073 7065 6369     Default speci
+000262e0: 6669 6361 7469 6f6e 206f 6620 736c 6963  fication of slic
+000262f0: 6573 2074 6f20 6265 2063 6f6e 7369 6465  es to be conside
+00026300: 7265 6420 7768 656e 0a20 2020 2020 2020  red when.       
+00026310: 2020 2020 2063 616c 6375 6c61 7469 6e67       calculating
+00026320: 2073 6c69 6365 2d62 792d 736c 6963 6520   slice-by-slice 
+00026330: 7374 6174 6973 7469 6373 2e20 2054 6865  statistics.  The
+00026340: 2076 616c 6964 2073 7065 6369 6669 6361   valid specifica
+00026350: 7469 6f6e 730a 2020 2020 2020 2020 2020  tions.          
+00026360: 2020 6172 653a 0a0a 2020 2020 2020 2020    are:..        
+00026370: 2020 2020 2d20 226c 6566 7422 3a20 636f      - "left": co
+00026380: 6e73 6964 6572 206f 6e6c 7920 736c 6963  nsider only slic
+00026390: 6573 2063 6f6e 7461 696e 696e 6720 7365  es containing se
+000263a0: 6c66 3b0a 2020 2020 2020 2020 2020 2020  lf;.            
+000263b0: 2d20 2272 6967 6874 223a 2063 6f6e 7369  - "right": consi
+000263c0: 6465 7220 6f6e 6c79 2073 6c69 6365 7320  der only slices 
+000263d0: 636f 6e74 6169 6e69 6e67 206f 7468 6572  containing other
+000263e0: 2072 6f69 3b0a 2020 2020 2020 2020 2020   roi;.          
+000263f0: 2020 2d20 2275 6e69 6f6e 223a 2063 6f6e    - "union": con
+00026400: 7369 6465 7220 736c 6963 6573 2063 6f6e  sider slices con
+00026410: 7461 696e 696e 6720 6569 7468 6572 206f  taining either o
+00026420: 6620 7365 6c66 2061 6e64 206f 7468 6572  f self and other
+00026430: 2072 6f69 3b0a 2020 2020 2020 2020 2020   roi;.          
+00026440: 2020 2d20 2269 6e74 6572 7365 6374 696f    - "intersectio
+00026450: 6e22 3a20 636f 6e73 6964 6572 2073 6c69  n": consider sli
+00026460: 6365 7320 636f 6e74 6169 6e69 6e67 2062  ces containing b
+00026470: 6f74 6820 6f66 2073 656c 6620 616e 640a  oth of self and.
+00026480: 2020 2020 2020 2020 2020 2020 2020 6f74                ot
+00026490: 6865 7220 726f 692e 0a0a 2020 2020 2020  her roi...      
+000264a0: 2020 2020 2020 4966 204e 6f6e 652c 2075        If None, u
+000264b0: 7365 2073 6b72 742e 636f 7265 2e44 6566  se skrt.core.Def
+000264c0: 6175 6c74 7328 292e 6279 5f73 6c69 6365  aults().by_slice
+000264d0: 0a0a 2020 2020 2020 2020 756e 6974 735f  ..        units_
+000264e0: 696e 5f68 6561 6465 7220 3a20 626f 6f6c  in_header : bool
+000264f0: 2c20 6465 6661 756c 743d 4661 6c73 650a  , default=False.
+00026500: 2020 2020 2020 2020 2020 2020 4966 2054              If T
+00026510: 7275 652c 2075 6e69 7473 2077 696c 6c20  rue, units will 
+00026520: 6265 2069 6e63 6c75 6465 6420 696e 2063  be included in c
+00026530: 6f6c 756d 6e20 6865 6164 6572 732e 0a0a  olumn headers...
+00026540: 2020 2020 2020 2020 676c 6f62 616c 5f76          global_v
+00026550: 735f 736c 6963 655f 6865 6164 6572 203a  s_slice_header :
+00026560: 2062 6f6f 6c2c 2064 6566 6175 6c74 3d46   bool, default=F
+00026570: 616c 7365 0a20 2020 2020 2020 2020 2020  alse.           
+00026580: 2049 6620 5472 7565 2c20 7468 6520 7265   If True, the re
+00026590: 7475 726e 6564 2044 6174 6146 7261 6d65  turned DataFrame
+000265a0: 2077 696c 6c20 6861 7665 2061 6e20 6578   will have an ex
+000265b0: 7472 6120 7365 7420 6f66 2068 6561 6465  tra set of heade
+000265c0: 7273 0a20 2020 2020 2020 2020 2020 2073  rs.            s
+000265d0: 706c 6974 7469 6e67 2074 6865 2074 6162  plitting the tab
+000265e0: 6c65 2069 6e74 6f20 2267 6c6f 6261 6c22  le into "global"
+000265f0: 2061 6e64 2022 736c 6963 6522 206d 6574   and "slice" met
+00026600: 7269 6373 2e0a 0a20 2020 2020 2020 206e  rics...        n
+00026610: 616d 655f 6173 5f69 6e64 6578 203a 2062  ame_as_index : b
+00026620: 6f6f 6c2c 2064 6566 6175 6c74 3d54 7275  ool, default=Tru
+00026630: 650a 2020 2020 2020 2020 2020 2020 4966  e.            If
+00026640: 2054 7275 652c 2074 6865 2069 6e64 6578   True, the index
+00026650: 2063 6f6c 756d 6e20 6f66 2074 6865 2070   column of the p
+00026660: 616e 6461 7320 4461 7461 4672 616d 6520  andas DataFrame 
+00026670: 7769 6c6c 200a 2020 2020 2020 2020 2020  will .          
+00026680: 2020 636f 6e74 6169 6e20 7468 6520 524f    contain the RO
+00026690: 4927 7320 6e61 6d65 733b 206f 7468 6572  I's names; other
+000266a0: 7769 7365 2c20 7468 6520 6e61 6d65 2077  wise, the name w
+000266b0: 696c 6c20 6170 7065 6172 2069 6e20 6120  ill appear in a 
+000266c0: 636f 6c75 6d6e 0a20 2020 2020 2020 2020  column.         
+000266d0: 2020 206e 616d 6564 2022 524f 4922 2e0a     named "ROI"..
+000266e0: 0a20 2020 2020 2020 206e 6963 655f 636f  .        nice_co
+000266f0: 6c75 6d6e 7320 3a20 626f 6f6c 2c20 6465  lumns : bool, de
+00026700: 6661 756c 743d 4661 6c73 650a 2020 2020  fault=False.    
+00026710: 2020 2020 2020 2020 4966 2046 616c 7365          If False
+00026720: 2c20 636f 6c75 6d6e 206e 616d 6573 2077  , column names w
+00026730: 696c 6c20 6265 2074 6865 2073 616d 6520  ill be the same 
+00026740: 6173 2074 6865 2069 6e70 7574 206d 6574  as the input met
+00026750: 7269 6373 206e 616d 6573 3b0a 2020 2020  rics names;.    
+00026760: 2020 2020 2020 2020 6966 2054 7275 652c          if True,
+00026770: 2074 6865 206e 616d 6573 2077 696c 6c20   the names will 
+00026780: 6265 2063 6170 6974 616c 697a 6564 2061  be capitalized a
+00026790: 6e64 2075 6e64 6572 7363 6f72 6573 2077  nd underscores w
+000267a0: 696c 6c20 6265 200a 2020 2020 2020 2020  ill be .        
+000267b0: 2020 2020 7265 706c 6163 6564 2077 6974      replaced wit
+000267c0: 6820 7370 6163 6573 2e0a 0a20 2020 2020  h spaces...     
+000267d0: 2020 2064 6563 696d 616c 5f70 6c61 6365     decimal_place
+000267e0: 7320 3a20 696e 742c 2064 6566 6175 6c74  s : int, default
+000267f0: 3d4e 6f6e 650a 2020 2020 2020 2020 2020  =None.          
+00026800: 2020 4e75 6d62 6572 206f 6620 6465 6369    Number of deci
+00026810: 6d61 6c20 706c 6163 6573 2074 6f20 6b65  mal places to ke
+00026820: 6570 2066 6f72 2065 6163 6820 6d65 7472  ep for each metr
+00026830: 6963 2e20 4966 204e 6f6e 652c 2066 756c  ic. If None, ful
+00026840: 6c0a 2020 2020 2020 2020 2020 2020 7072  l.            pr
+00026850: 6563 6973 696f 6e20 7769 6c6c 2062 6520  ecision will be 
+00026860: 7573 6564 2e0a 0a20 2020 2020 2020 2066  used...        f
+00026870: 6f72 6365 203a 2062 6f6f 6c2c 2064 6566  orce : bool, def
+00026880: 6175 6c74 3d54 7275 650a 2020 2020 2020  ault=True.      
+00026890: 2020 2020 2020 4966 2046 616c 7365 2c20        If False, 
+000268a0: 676c 6f62 616c 206d 6574 7269 6373 2066  global metrics f
+000268b0: 6f72 2065 6163 6820 524f 4920 2876 6f6c  or each ROI (vol
+000268c0: 756d 652c 2033 4420 6365 6e74 726f 6964  ume, 3D centroid
+000268d0: 2c20 0a20 2020 2020 2020 2020 2020 2033  , .            3
+000268e0: 4420 6c65 6e67 7468 7329 2077 696c 6c20  D lengths) will 
+000268f0: 6f6e 6c79 2062 6520 6361 6c63 756c 6174  only be calculat
+00026900: 6564 2069 6620 7468 6579 2068 6176 6520  ed if they have 
+00026910: 6e6f 7420 6265 656e 200a 2020 2020 2020  not been .      
+00026920: 2020 2020 2020 6361 6c63 756c 6174 6564        calculated
+00026930: 2062 6566 6f72 653b 2069 6620 5472 7565   before; if True
+00026940: 2c20 616c 6c20 6d65 7472 6963 7320 7769  , all metrics wi
+00026950: 6c6c 2062 6520 7265 6361 6c63 756c 6174  ll be recalculat
+00026960: 6564 2e0a 0a20 2020 2020 2020 2076 6f78  ed...        vox
+00026970: 656c 5f73 697a 6520 3a20 7475 706c 652c  el_size : tuple,
+00026980: 2064 6566 6175 6c74 3d28 312c 2031 2c20   default=(1, 1, 
+00026990: 3129 0a20 2020 2020 2020 2020 2020 2056  1).            V
+000269a0: 6f78 656c 2073 697a 6520 2864 782c 2064  oxel size (dx, d
+000269b0: 792c 2064 7a29 2069 6e20 6d6d 2074 6f20  y, dz) in mm to 
+000269c0: 6265 2075 7365 6420 666f 7220 524f 4920  be used for ROI 
+000269d0: 6d61 736b 730a 2020 2020 2020 2020 2020  masks.          
+000269e0: 2020 6672 6f6d 2077 6869 6368 2074 6f20    from which to 
+000269f0: 6361 6c63 756c 6174 6520 7375 7266 6163  calculate surfac
+00026a00: 6520 6469 7374 616e 6365 732e 2020 4966  e distances.  If
+00026a10: 204e 6f6e 652c 0a20 2020 2020 2020 2020   None,.         
+00026a20: 2020 2074 6865 206d 6173 6b20 766f 7865     the mask voxe
+00026a30: 6c20 7369 7a65 206f 6620 3c6f 7468 6572  l size of <other
+00026a40: 3e20 6973 2075 7365 642e 2020 4966 2061  > is used.  If a
+00026a50: 6e20 696e 6469 7669 6475 616c 0a20 2020  n individual.   
+00026a60: 2020 2020 2020 2020 2065 6c65 6d65 6e74           element
+00026a70: 2069 7320 4e6f 6e65 2c20 7468 6520 7661   is None, the va
+00026a80: 6c75 6520 6f66 2074 6865 2063 6f72 7265  lue of the corre
+00026a90: 7370 6f6e 6469 6e67 2065 6c65 6d65 6e74  sponding element
+00026aa0: 2066 6f72 0a20 2020 2020 2020 2020 2020   for.           
+00026ab0: 2074 6865 206d 6173 6b20 766f 7865 6c20   the mask voxel 
+00026ac0: 7369 7a65 206f 6620 3c6f 7468 6572 3e20  size of <other> 
+00026ad0: 6973 2075 7365 642e 2020 4120 7661 6c75  is used.  A valu
+00026ae0: 650a 2020 2020 2020 2020 2020 2020 6f74  e.            ot
+00026af0: 6865 7220 7468 616e 204e 6f6e 6520 666f  her than None fo
+00026b00: 7263 6573 2063 7265 6174 696f 6e20 6f66  rces creation of
+00026b10: 206d 6173 6b73 2074 6861 7420 6a75 7374   masks that just
+00026b20: 2063 6f76 6572 0a20 2020 2020 2020 2020   cover.         
+00026b30: 2020 2074 6865 2076 6f6c 756d 6520 6f63     the volume oc
+00026b40: 6375 7069 6564 2062 7920 7468 6520 7477  cupied by the tw
+00026b50: 6f20 524f 4973 2062 6569 6e67 2063 6f6d  o ROIs being com
+00026b60: 7061 7265 642c 0a20 2020 2020 2020 2020  pared,.         
+00026b70: 2020 2070 6f74 656e 7469 616c 6c79 2072     potentially r
+00026b80: 6564 7563 696e 6720 7468 6520 7469 6d65  educing the time
+00026b90: 2066 6f72 2073 7572 6661 6365 2d64 6973   for surface-dis
+00026ba0: 7461 6e63 6520 6361 6c63 756c 6174 696f  tance calculatio
+00026bb0: 6e73 2e0a 0a20 2020 2020 2020 206d 6174  ns...        mat
+00026bc0: 6368 5f6c 656e 6774 6873 203a 2062 6f6f  ch_lengths : boo
+00026bd0: 6c2f 7374 722f 6c69 7374 2c20 6465 6661  l/str/list, defa
+00026be0: 756c 743d 4661 6c73 650a 2020 2020 2020  ult=False.      
+00026bf0: 2020 2020 2020 4966 2073 6574 2074 6f20        If set to 
+00026c00: 5472 7565 2c20 746f 2074 6865 206e 616d  True, to the nam
+00026c10: 6520 6f66 2074 6865 206f 7468 6572 2052  e of the other R
+00026c20: 4f49 2c20 6f72 2074 6f20 6120 6c69 7374  OI, or to a list
+00026c30: 0a20 2020 2020 2020 2020 2020 206f 6620  .            of 
+00026c40: 6e61 6d65 7320 696e 636c 7564 696e 6720  names including 
+00026c50: 7468 6520 6e61 6d65 206f 6620 7468 6520  the name of the 
+00026c60: 6f74 6865 7220 524f 492c 206d 6174 6368  other ROI, match
+00026c70: 2052 4f49 206c 656e 6774 6873 0a20 2020   ROI lengths.   
+00026c80: 2020 2020 2020 2020 2028 7a2d 6469 6d65           (z-dime
+00026c90: 6e73 696f 6e73 2920 6265 666f 7265 2063  nsions) before c
+00026ca0: 6f6d 7061 7269 736f 6e2e 2020 5468 6520  omparison.  The 
+00026cb0: 7374 7261 7465 6779 2075 7365 6420 6973  strategy used is
+00026cc0: 2064 6566 696e 6564 0a20 2020 2020 2020   defined.       
+00026cd0: 2020 2020 2062 7920 7468 6520 7661 6c75       by the valu
+00026ce0: 6520 6f66 206d 6174 6368 5f6c 656e 6774  e of match_lengt
+00026cf0: 6873 5f73 7472 6174 6567 792e 0a0a 2020  hs_strategy...  
+00026d00: 2020 2020 2020 6d61 7463 685f 6c65 6e67        match_leng
+00026d10: 7468 735f 7374 7261 7465 6779 203a 2069  ths_strategy : i
+00026d20: 6e74 2c20 6465 6661 756c 743d 310a 2020  nt, default=1.  
+00026d30: 2020 2020 2020 2020 2020 5374 7261 7465            Strate
+00026d40: 6779 2074 6f20 7573 6520 666f 7220 6d61  gy to use for ma
+00026d50: 7463 6869 6e67 2052 4f49 206c 656e 6774  tching ROI lengt
+00026d60: 6873 2028 7a2d 6469 6d65 6e73 696f 6e73  hs (z-dimensions
+00026d70: 293a 0a0a 2020 2020 2020 2020 2020 2020  ):..            
+00026d80: 2d20 3020 3a20 4372 6f70 2074 6869 7320  - 0 : Crop this 
+00026d90: 524f 4920 746f 2074 6865 207a 2d65 7874  ROI to the z-ext
+00026da0: 656e 7473 206f 6620 7468 6520 6f74 6865  ents of the othe
+00026db0: 7220 524f 493b 0a20 2020 2020 2020 2020  r ROI;.         
+00026dc0: 2020 202d 2031 203a 2043 726f 7020 7468     - 1 : Crop th
+00026dd0: 6520 6f74 6865 7220 524f 4920 746f 2074  e other ROI to t
+00026de0: 6865 207a 2d65 7865 6e74 7320 6f66 2074  he z-exents of t
+00026df0: 6869 7320 524f 493b 0a20 2020 2020 2020  his ROI;.       
+00026e00: 2020 2020 202d 2032 203a 2043 726f 7020       - 2 : Crop 
+00026e10: 7468 6973 2052 4f49 2074 6f20 7468 6520  this ROI to the 
+00026e20: 7a2d 6578 7465 6e74 7320 6f66 2074 6865  z-extents of the
+00026e30: 206f 7468 6572 2052 4f49 2c20 7468 656e   other ROI, then
+00026e40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00026e50: 2020 2063 726f 7020 7468 6520 6f74 6865     crop the othe
+00026e60: 7220 524f 4920 746f 2074 6865 2063 726f  r ROI to the cro
+00026e70: 7070 6564 207a 2d65 7874 656e 7473 206f  pped z-extents o
+00026e80: 6620 7468 6973 2052 4f49 2e0a 0a20 2020  f this ROI...   
+00026e90: 2020 2020 2020 2020 2046 6f72 2061 2076           For a v
+00026ea0: 616c 7565 206f 7468 6572 2074 6861 6e20  alue other than 
+00026eb0: 302c 2031 2c20 322c 206e 6f20 6c65 6e67  0, 1, 2, no leng
+00026ec0: 7468 206d 6174 6368 696e 6720 6973 2070  th matching is p
+00026ed0: 6572 666f 726d 6564 2e0a 2020 2020 2020  erformed..      
+00026ee0: 2020 2222 220a 2020 2020 2020 2020 6966    """.        if
+00026ef0: 2076 6f78 656c 5f73 697a 6520 6973 206e   voxel_size is n
+00026f00: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
+00026f10: 2020 2020 2023 2043 7265 6174 6520 524f       # Create RO
+00026f20: 4920 6d61 736b 732c 206a 7573 7420 636f  I masks, just co
+00026f30: 7665 7269 6e67 2076 6f6c 756d 6520 6f63  vering volume oc
+00026f40: 6375 7069 6564 0a20 2020 2020 2020 2020  cupied.         
+00026f50: 2020 2023 2062 7920 524f 4973 2062 6569     # by ROIs bei
+00026f60: 6e67 2063 6f6d 7061 7265 642c 2077 6974  ng compared, wit
+00026f70: 6820 7370 6563 6966 6965 6420 766f 7865  h specified voxe
+00026f80: 6c20 7369 7a65 2e0a 2020 2020 2020 2020  l size..        
+00026f90: 2020 2020 2320 2854 6865 2072 6573 697a      # (The resiz
+00026fa0: 696e 6720 6973 2070 6572 666f 726d 6564  ing is performed
+00026fb0: 206f 6e20 636c 6f6e 6573 206f 6e20 7468   on clones on th
+00026fc0: 6520 524f 4973 2c0a 2020 2020 2020 2020  e ROIs,.        
+00026fd0: 2020 2020 2320 7769 7468 6f75 7420 6368      # without ch
+00026fe0: 616e 6769 6e67 2074 6865 206f 7269 6769  anging the origi
+00026ff0: 6e61 6c73 2e29 0a20 2020 2020 2020 2020  nals.).         
+00027000: 2020 2072 6f69 302c 2072 6f69 203d 2073     roi0, roi = s
+00027010: 656c 662e 6d61 7463 685f 6d61 736b 5f76  elf.match_mask_v
+00027020: 6f78 656c 5f73 697a 6528 726f 692c 0a20  oxel_size(roi,. 
+00027030: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027040: 2020 2076 6f78 656c 5f73 697a 653d 766f     voxel_size=vo
+00027050: 7865 6c5f 7369 7a65 2c20 766f 7865 6c5f  xel_size, voxel_
+00027060: 6469 6d5f 746f 6c65 7261 6e63 653d 2d31  dim_tolerance=-1
+00027070: 290a 2020 2020 2020 2020 656c 7365 3a0a  ).        else:.
+00027080: 2020 2020 2020 2020 2020 2020 2320 446f              # Do
+00027090: 6e27 7420 6578 706c 6963 6974 6c79 2063  n't explicitly c
+000270a0: 7265 6174 6520 524f 4920 6d61 736b 732e  reate ROI masks.
+000270b0: 0a20 2020 2020 2020 2020 2020 2072 6f69  .            roi
+000270c0: 3020 3d20 7365 6c66 0a0a 2020 2020 2020  0 = self..      
+000270d0: 2020 2320 4f70 7469 6f6e 616c 6c79 206d    # Optionally m
+000270e0: 6174 6368 2052 4f49 206c 656e 6774 6873  atch ROI lengths
+000270f0: 2e0a 2020 2020 2020 2020 6966 2028 286d  ..        if ((m
+00027100: 6174 6368 5f6c 656e 6774 6873 2069 7320  atch_lengths is 
+00027110: 5472 7565 2920 6f72 2028 726f 692e 6e61  True) or (roi.na
+00027120: 6d65 203d 3d20 6d61 7463 685f 6c65 6e67  me == match_leng
+00027130: 7468 7329 0a20 2020 2020 2020 2020 2020  ths).           
+00027140: 2020 2020 206f 7220 2869 7369 6e73 7461       or (isinsta
+00027150: 6e63 6528 6d61 7463 685f 6c65 6e67 7468  nce(match_length
+00027160: 732c 2028 6c69 7374 2c20 7475 706c 652c  s, (list, tuple,
+00027170: 2073 6574 2929 0a20 2020 2020 2020 2020   set)).         
+00027180: 2020 2020 2020 2020 2020 2061 6e64 2072             and r
+00027190: 6f69 2e6e 616d 6520 696e 206d 6174 6368  oi.name in match
+000271a0: 5f6c 656e 6774 6873 2929 3a0a 2020 2020  _lengths)):.    
+000271b0: 2020 2020 2020 2020 2320 4372 6561 7465          # Create
+000271c0: 2052 4f49 2063 6c6f 6e65 7320 666f 7220   ROI clones for 
+000271d0: 6372 6f70 7069 6e67 3b20 7468 6520 6f72  cropping; the or
+000271e0: 6967 696e 616c 7320 7769 6c6c 2062 6520  iginals will be 
+000271f0: 756e 6368 616e 6765 642e 0a20 2020 2020  unchanged..     
+00027200: 2020 2020 2020 2069 6620 6d61 7463 685f         if match_
+00027210: 6c65 6e67 7468 735f 7374 7261 7465 6779  lengths_strategy
+00027220: 2069 6e20 5b30 2c20 312c 2032 5d20 616e   in [0, 1, 2] an
+00027230: 6420 766f 7865 6c5f 7369 7a65 2069 7320  d voxel_size is 
+00027240: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+00027250: 2020 2020 2020 726f 6930 203d 2073 656c        roi0 = sel
+00027260: 662e 636c 6f6e 6528 290a 2020 2020 2020  f.clone().      
+00027270: 2020 2020 2020 2020 2020 726f 6920 3d20            roi = 
+00027280: 726f 692e 636c 6f6e 6528 290a 2020 2020  roi.clone().    
+00027290: 2020 2020 2020 2020 2320 4372 6f70 2074          # Crop t
+000272a0: 6869 7320 524f 4920 746f 207a 2d65 7874  his ROI to z-ext
+000272b0: 656e 7473 206f 6620 6f74 6865 7220 524f  ents of other RO
+000272c0: 492e 0a20 2020 2020 2020 2020 2020 2069  I..            i
+000272d0: 6620 6d61 7463 685f 6c65 6e67 7468 735f  f match_lengths_
+000272e0: 7374 7261 7465 6779 2069 6e20 5b30 2c20  strategy in [0, 
+000272f0: 325d 3a0a 2020 2020 2020 2020 2020 2020  2]:.            
+00027300: 2020 2020 726f 6930 2e63 726f 705f 746f      roi0.crop_to
+00027310: 5f72 6f69 5f6c 656e 6774 6828 726f 6929  _roi_length(roi)
+00027320: 0a20 2020 2020 2020 2020 2020 2023 2043  .            # C
+00027330: 726f 7020 6f74 6865 7220 524f 4920 746f  rop other ROI to
+00027340: 207a 2d65 7874 656e 7473 206f 6620 7468   z-extents of th
+00027350: 6973 2052 4f49 2e0a 2020 2020 2020 2020  is ROI..        
+00027360: 2020 2020 6966 206d 6174 6368 5f6c 656e      if match_len
+00027370: 6774 6873 5f73 7472 6174 6567 7920 696e  gths_strategy in
+00027380: 205b 312c 2032 5d3a 0a20 2020 2020 2020   [1, 2]:.       
+00027390: 2020 2020 2020 2020 2072 6f69 2e63 726f           roi.cro
+000273a0: 705f 746f 5f72 6f69 5f6c 656e 6774 6828  p_to_roi_length(
+000273b0: 726f 6930 290a 0a20 2020 2020 2020 2023  roi0)..        #
+000273c0: 2044 6566 6175 6c74 206d 6574 7269 6373   Default metrics
+000273d0: 0a20 2020 2020 2020 2069 6620 6d65 7472  .        if metr
+000273e0: 6963 7320 6973 204e 6f6e 653a 0a20 2020  ics is None:.   
+000273f0: 2020 2020 2020 2020 206d 6574 7269 6373           metrics
+00027400: 203d 205b 2264 6963 6522 2c20 2263 656e   = ["dice", "cen
+00027410: 7472 6f69 6422 5d0a 0a20 2020 2020 2020  troid"]..       
+00027420: 2023 2044 6566 6175 6c74 2073 6c69 6365   # Default slice
+00027430: 7320 746f 2063 6f6e 7369 6465 7220 666f  s to consider fo
+00027440: 7220 736c 6963 652d 6279 2d73 6c69 6365  r slice-by-slice
+00027450: 206d 6574 7269 6320 6361 6c63 756c 6174   metric calculat
+00027460: 696f 6e73 2e0a 2020 2020 2020 2020 6465  ions..        de
+00027470: 6661 756c 745f 6279 5f73 6c69 6365 203d  fault_by_slice =
+00027480: 2073 6b72 742e 636f 7265 2e44 6566 6175   skrt.core.Defau
+00027490: 6c74 7328 292e 6279 5f73 6c69 6365 0a0a  lts().by_slice..
+000274a0: 2020 2020 2020 2020 2320 496e 6974 6961          # Initia
+000274b0: 6c69 7365 2076 6172 6961 626c 6573 2066  lise variables f
+000274c0: 6f72 2064 6973 7461 6e63 6520 6d65 7472  or distance metr
+000274d0: 6963 732e 0a20 2020 2020 2020 2063 6f6e  ics..        con
+000274e0: 666f 726d 6974 7920 3d20 4e6f 6e65 0a20  formity = None. 
+000274f0: 2020 2020 2020 2063 6f6e 666f 726d 6974         conformit
+00027500: 795f 666c 6174 203d 204e 6f6e 650a 2020  y_flat = None.  
+00027510: 2020 2020 2020 6469 7374 616e 6365 7320        distances 
+00027520: 3d20 4e6f 6e65 0a20 2020 2020 2020 2064  = None.        d
+00027530: 6973 7461 6e63 6573 5f66 6c61 7420 3d20  istances_flat = 
+00027540: 4e6f 6e65 0a20 2020 2020 2020 2073 6967  None.        sig
+00027550: 6e65 645f 6469 7374 616e 6365 7320 3d20  ned_distances = 
+00027560: 4e6f 6e65 0a20 2020 2020 2020 2073 6967  None.        sig
+00027570: 6e65 645f 6469 7374 616e 6365 735f 666c  ned_distances_fl
+00027580: 6174 203d 204e 6f6e 650a 0a20 2020 2020  at = None..     
+00027590: 2020 2023 2049 6620 6e6f 2069 6e64 6578     # If no index
+000275a0: 2067 6976 656e 2c20 7573 6520 6365 6e74   given, use cent
+000275b0: 7261 6c20 736c 6963 650a 2020 2020 2020  ral slice.      
+000275c0: 2020 6966 2073 6c20 6973 204e 6f6e 6520    if sl is None 
+000275d0: 616e 6420 6964 7820 6973 204e 6f6e 6520  and idx is None 
+000275e0: 616e 6420 706f 7320 6973 204e 6f6e 653a  and pos is None:
+000275f0: 0a20 2020 2020 2020 2020 2020 2069 6478  .            idx
+00027600: 203d 2072 6f69 302e 6765 745f 6d69 645f   = roi0.get_mid_
+00027610: 6964 7828 7669 6577 290a 0a20 2020 2020  idx(view)..     
+00027620: 2020 2023 2043 6f6d 7075 7465 206d 6574     # Compute met
+00027630: 7269 6373 0a20 2020 2020 2020 2063 6f6d  rics.        com
+00027640: 7020 3d20 7b7d 0a20 2020 2020 2020 2073  p = {}.        s
+00027650: 6c69 6365 5f6b 7761 7267 7320 3d20 7b0a  lice_kwargs = {.
+00027660: 2020 2020 2020 2020 2020 2020 2273 696e              "sin
+00027670: 676c 655f 736c 6963 6522 3a20 5472 7565  gle_slice": True
+00027680: 2c0a 2020 2020 2020 2020 2020 2020 2276  ,.            "v
+00027690: 6965 7722 3a20 7669 6577 2c0a 2020 2020  iew": view,.    
+000276a0: 2020 2020 2020 2020 2273 6c22 3a20 736c          "sl": sl
+000276b0: 2c0a 2020 2020 2020 2020 2020 2020 2269  ,.            "i
+000276c0: 6478 223a 2069 6478 2c0a 2020 2020 2020  dx": idx,.      
+000276d0: 2020 2020 2020 2270 6f73 223a 2070 6f73        "pos": pos
+000276e0: 0a20 2020 2020 2020 207d 0a0a 2020 2020  .        }..    
+000276f0: 2020 2020 666f 7220 6d20 696e 206d 6574      for m in met
+00027700: 7269 6373 3a0a 2020 2020 2020 2020 2020  rics:.          
+00027710: 2020 6966 206d 206e 6f74 2069 6e20 6765    if m not in ge
+00027720: 745f 636f 6d70 6172 6973 6f6e 5f6d 6574  t_comparison_met
+00027730: 7269 6373 2829 3a0a 2020 2020 2020 2020  rics():.        
+00027740: 2020 2020 2020 2020 7261 6973 6520 5275          raise Ru
+00027750: 6e74 696d 6545 7272 6f72 2866 224d 6574  ntimeError(f"Met
+00027760: 7269 6320 7b6d 7d20 6e6f 7420 7265 636f  ric {m} not reco
+00027770: 676e 6973 6564 2062 7920 220a 2020 2020  gnised by ".    
+00027780: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027790: 2020 2020 2252 4f49 2e67 6574 5f63 6f6d      "ROI.get_com
+000277a0: 7061 7269 736f 6e28 2922 290a 0a20 2020  parison()")..   
+000277b0: 2020 2020 2066 6f72 206d 2069 6e20 6d65       for m in me
+000277c0: 7472 6963 733a 0a0a 2020 2020 2020 2020  trics:..        
+000277d0: 2020 2020 2320 4469 6365 2073 636f 7265      # Dice score
+000277e0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+000277f0: 6d20 3d3d 2022 6469 6365 223a 0a20 2020  m == "dice":.   
+00027800: 2020 2020 2020 2020 2020 2020 2063 6f6d               com
+00027810: 705b 6d5d 203d 2072 6f69 302e 6765 745f  p[m] = roi0.get_
+00027820: 6469 6365 2872 6f69 2c20 6d65 7468 6f64  dice(roi, method
+00027830: 3d6d 6574 686f 6429 0a20 2020 2020 2020  =method).       
+00027840: 2020 2020 2065 6c69 6620 6d20 3d3d 2022       elif m == "
+00027850: 6469 6365 5f66 6c61 7422 3a0a 2020 2020  dice_flat":.    
+00027860: 2020 2020 2020 2020 2020 2020 636f 6d70              comp
+00027870: 5b6d 5d20 3d20 726f 6930 2e67 6574 5f64  [m] = roi0.get_d
+00027880: 6963 6528 0a20 2020 2020 2020 2020 2020  ice(.           
+00027890: 2020 2020 2020 2020 2072 6f69 2c20 0a20           roi, . 
+000278a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000278b0: 2020 2076 6965 773d 7669 6577 2c0a 2020     view=view,.  
+000278c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000278d0: 2020 6d65 7468 6f64 3d6d 6574 686f 642c    method=method,
+000278e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000278f0: 2020 2020 2066 6c61 7474 656e 3d54 7275       flatten=Tru
+00027900: 652c 200a 2020 2020 2020 2020 2020 2020  e, .            
+00027910: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
+00027920: 2020 656c 6966 206d 203d 3d20 2264 6963    elif m == "dic
+00027930: 655f 736c 6963 6522 3a0a 2020 2020 2020  e_slice":.      
+00027940: 2020 2020 2020 2020 2020 636f 6d70 5b6d            comp[m
+00027950: 5d20 3d20 726f 6930 2e67 6574 5f64 6963  ] = roi0.get_dic
+00027960: 6528 726f 692c 206d 6574 686f 643d 6d65  e(roi, method=me
+00027970: 7468 6f64 2c20 2a2a 736c 6963 655f 6b77  thod, **slice_kw
+00027980: 6172 6773 290a 0a20 2020 2020 2020 2020  args)..         
+00027990: 2020 2065 6c69 6620 6d20 3d3d 2022 6469     elif m == "di
+000279a0: 6365 5f73 6c69 6365 5f73 7461 7473 223a  ce_slice_stats":
+000279b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000279c0: 2063 6f6d 702e 7570 6461 7465 2872 6f69   comp.update(roi
+000279d0: 302e 6765 745f 736c 6963 655f 7374 6174  0.get_slice_stat
+000279e0: 7328 726f 692c 206d 6574 7269 6373 3d22  s(roi, metrics="
+000279f0: 6469 6365 222c 0a20 2020 2020 2020 2020  dice",.         
+00027a00: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00027a10: 6c69 6365 5f73 7461 7473 3d73 6c69 6365  lice_stats=slice
+00027a20: 5f73 7461 7473 2c0a 2020 2020 2020 2020  _stats,.        
+00027a30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027a40: 6465 6661 756c 745f 6279 5f73 6c69 6365  default_by_slice
+00027a50: 3d64 6566 6175 6c74 5f62 795f 736c 6963  =default_by_slic
+00027a60: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
+00027a70: 2020 2020 2020 2020 2020 206d 6574 686f             metho
+00027a80: 643d 6d65 7468 6f64 2c20 7669 6577 3d76  d=method, view=v
+00027a90: 6965 7729 290a 0a20 2020 2020 2020 2020  iew))..         
+00027aa0: 2020 2023 204a 6163 6361 7264 2069 6e64     # Jaccard ind
+00027ab0: 6578 0a20 2020 2020 2020 2020 2020 2065  ex.            e
+00027ac0: 6c69 6620 6d20 3d3d 2022 6a61 6363 6172  lif m == "jaccar
+00027ad0: 6422 3a0a 2020 2020 2020 2020 2020 2020  d":.            
+00027ae0: 2020 2020 636f 6d70 5b6d 5d20 3d20 726f      comp[m] = ro
+00027af0: 6930 2e67 6574 5f6a 6163 6361 7264 2872  i0.get_jaccard(r
+00027b00: 6f69 2c20 6d65 7468 6f64 3d6d 6574 686f  oi, method=metho
+00027b10: 6429 0a20 2020 2020 2020 2020 2020 2065  d).            e
+00027b20: 6c69 6620 6d20 3d3d 2022 6a61 6363 6172  lif m == "jaccar
+00027b30: 645f 666c 6174 223a 0a20 2020 2020 2020  d_flat":.       
+00027b40: 2020 2020 2020 2020 2063 6f6d 705b 6d5d           comp[m]
+00027b50: 203d 2072 6f69 302e 6765 745f 6a61 6363   = roi0.get_jacc
+00027b60: 6172 6428 0a20 2020 2020 2020 2020 2020  ard(.           
+00027b70: 2020 2020 2020 2020 2072 6f69 2c20 0a20           roi, . 
+00027b80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027b90: 2020 2076 6965 773d 7669 6577 2c0a 2020     view=view,.  
+00027ba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027bb0: 2020 6d65 7468 6f64 3d6d 6574 686f 642c    method=method,
+00027bc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00027bd0: 2020 2020 2066 6c61 7474 656e 3d54 7275       flatten=Tru
+00027be0: 652c 200a 2020 2020 2020 2020 2020 2020  e, .            
+00027bf0: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
+00027c00: 2020 656c 6966 206d 203d 3d20 226a 6163    elif m == "jac
+00027c10: 6361 7264 5f73 6c69 6365 223a 0a20 2020  card_slice":.   
+00027c20: 2020 2020 2020 2020 2020 2020 2063 6f6d               com
+00027c30: 705b 6d5d 203d 2072 6f69 302e 6765 745f  p[m] = roi0.get_
+00027c40: 6a61 6363 6172 6428 726f 692c 206d 6574  jaccard(roi, met
+00027c50: 686f 643d 6d65 7468 6f64 2c20 2a2a 736c  hod=method, **sl
+00027c60: 6963 655f 6b77 6172 6773 290a 0a20 2020  ice_kwargs)..   
+00027c70: 2020 2020 2020 2020 2065 6c69 6620 6d20           elif m 
+00027c80: 3d3d 2022 6a61 6363 6172 645f 736c 6963  == "jaccard_slic
+00027c90: 655f 7374 6174 7322 3a0a 2020 2020 2020  e_stats":.      
+00027ca0: 2020 2020 2020 2020 2020 636f 6d70 2e75            comp.u
+00027cb0: 7064 6174 6528 726f 6930 2e67 6574 5f73  pdate(roi0.get_s
+00027cc0: 6c69 6365 5f73 7461 7473 2872 6f69 2c20  lice_stats(roi, 
+00027cd0: 6d65 7472 6963 733d 226a 6163 6361 7264  metrics="jaccard
+00027ce0: 222c 0a20 2020 2020 2020 2020 2020 2020  ",.             
+00027cf0: 2020 2020 2020 2020 2020 2073 6c69 6365             slice
+00027d00: 5f73 7461 7473 3d73 6c69 6365 5f73 7461  _stats=slice_sta
+00027d10: 7473 2c0a 2020 2020 2020 2020 2020 2020  ts,.            
+00027d20: 2020 2020 2020 2020 2020 2020 6465 6661              defa
+00027d30: 756c 745f 6279 5f73 6c69 6365 3d64 6566  ult_by_slice=def
+00027d40: 6175 6c74 5f62 795f 736c 6963 652c 0a20  ault_by_slice,. 
+00027d50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027d60: 2020 2020 2020 206d 6574 686f 643d 6d65         method=me
+00027d70: 7468 6f64 2c20 7669 6577 3d76 6965 7729  thod, view=view)
+00027d80: 290a 0a20 2020 2020 2020 2020 2020 2023  )..            #
+00027d90: 2043 656e 7472 6f69 6420 6469 7374 616e   Centroid distan
+00027da0: 6365 730a 2020 2020 2020 2020 2020 2020  ces.            
+00027db0: 656c 6966 206d 203d 3d20 2263 656e 7472  elif m == "centr
+00027dc0: 6f69 6422 3a0a 2020 2020 2020 2020 2020  oid":.          
+00027dd0: 2020 2020 2020 6365 6e74 726f 6964 203d        centroid =
+00027de0: 2072 6f69 302e 6765 745f 6365 6e74 726f   roi0.get_centro
+00027df0: 6964 5f64 6973 7461 6e63 6528 0a20 2020  id_distance(.   
+00027e00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027e10: 2072 6f69 2c20 0a20 2020 2020 2020 2020   roi, .         
+00027e20: 2020 2020 2020 2020 2020 2075 6e69 7473             units
+00027e30: 3d63 656e 7472 6f69 645f 756e 6974 732c  =centroid_units,
+00027e40: 200a 2020 2020 2020 2020 2020 2020 2020   .              
+00027e50: 2020 2020 2020 6d65 7468 6f64 3d6d 6574        method=met
+00027e60: 686f 642c 0a20 2020 2020 2020 2020 2020  hod,.           
+00027e70: 2020 2020 2020 2020 2066 6f72 6365 3d66           force=f
+00027e80: 6f72 6365 0a20 2020 2020 2020 2020 2020  orce.           
+00027e90: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
+00027ea0: 2020 2020 2020 2066 6f72 2069 2c20 6178         for i, ax
+00027eb0: 2069 6e20 656e 756d 6572 6174 6528 736b   in enumerate(sk
+00027ec0: 7274 2e69 6d61 6765 2e5f 6178 6573 293a  rt.image._axes):
+00027ed0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00027ee0: 2020 2020 2063 6f6d 705b 6622 6365 6e74       comp[f"cent
+00027ef0: 726f 6964 5f7b 6178 7d22 5d20 3d20 6365  roid_{ax}"] = ce
+00027f00: 6e74 726f 6964 5b69 5d0a 2020 2020 2020  ntroid[i].      
+00027f10: 2020 2020 2020 656c 6966 206d 203d 3d20        elif m == 
+00027f20: 2261 6273 5f63 656e 7472 6f69 6422 3a0a  "abs_centroid":.
+00027f30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027f40: 636f 6d70 5b6d 5d20 3d20 726f 6930 2e67  comp[m] = roi0.g
+00027f50: 6574 5f61 6273 5f63 656e 7472 6f69 645f  et_abs_centroid_
+00027f60: 6469 7374 616e 6365 280a 2020 2020 2020  distance(.      
+00027f70: 2020 2020 2020 2020 2020 2020 2020 726f                ro
+00027f80: 692c 200a 2020 2020 2020 2020 2020 2020  i, .            
+00027f90: 2020 2020 2020 2020 756e 6974 733d 6365          units=ce
+00027fa0: 6e74 726f 6964 5f75 6e69 7473 2c0a 2020  ntroid_units,.  
 00027fb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027fc0: 2020 726f 692c 0a20 2020 2020 2020 2020    roi,.         
-00027fd0: 2020 2020 2020 2020 2020 2076 6965 773d             view=
-00027fe0: 7669 6577 2c0a 2020 2020 2020 2020 2020  view,.          
-00027ff0: 2020 2020 2020 2020 2020 756e 6974 733d            units=
-00028000: 6365 6e74 726f 6964 5f75 6e69 7473 2c0a  centroid_units,.
-00028010: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028020: 2020 2020 6d65 7468 6f64 3d6d 6574 686f      method=metho
-00028030: 642c 0a20 2020 2020 2020 2020 2020 2020  d,.             
-00028040: 2020 2020 2020 2066 6c61 7474 656e 3d54         flatten=T
-00028050: 7275 652c 0a20 2020 2020 2020 2020 2020  rue,.           
-00028060: 2020 2020 2020 2020 2066 6f72 6365 3d66           force=f
-00028070: 6f72 6365 0a20 2020 2020 2020 2020 2020  orce.           
-00028080: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
-00028090: 2020 2065 6c69 6620 6d20 3d3d 2022 6365     elif m == "ce
-000280a0: 6e74 726f 6964 5f73 6c69 6365 223a 0a20  ntroid_slice":. 
-000280b0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-000280c0: 656e 7472 6f69 6420 3d20 726f 6930 2e67  entroid = roi0.g
-000280d0: 6574 5f63 656e 7472 6f69 645f 6469 7374  et_centroid_dist
-000280e0: 616e 6365 280a 2020 2020 2020 2020 2020  ance(.          
-000280f0: 2020 2020 2020 2020 2020 726f 692c 0a20            roi,. 
-00028100: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028110: 2020 2075 6e69 7473 3d63 656e 7472 6f69     units=centroi
-00028120: 645f 756e 6974 732c 0a20 2020 2020 2020  d_units,.       
-00028130: 2020 2020 2020 2020 2020 2020 206d 6574               met
-00028140: 686f 643d 6d65 7468 6f64 2c0a 2020 2020  hod=method,.    
-00028150: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028160: 2a2a 736c 6963 655f 6b77 6172 6773 0a20  **slice_kwargs. 
-00028170: 2020 2020 2020 2020 2020 2020 2020 2029                 )
-00028180: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00028190: 2066 6f72 2069 2c20 695f 6178 2069 6e20   for i, i_ax in 
-000281a0: 656e 756d 6572 6174 6528 736b 7274 2e69  enumerate(skrt.i
-000281b0: 6d61 6765 2e5f 706c 6f74 5f61 7865 735b  mage._plot_axes[
-000281c0: 7669 6577 5d29 3a0a 2020 2020 2020 2020  view]):.        
-000281d0: 2020 2020 2020 2020 2020 2020 6178 203d              ax =
-000281e0: 2073 6b72 742e 696d 6167 652e 5f61 7865   skrt.image._axe
-000281f0: 735b 695f 6178 5d0a 2020 2020 2020 2020  s[i_ax].        
-00028200: 2020 2020 2020 2020 2020 2020 636f 6d70              comp
-00028210: 5b66 2263 656e 7472 6f69 645f 736c 6963  [f"centroid_slic
-00028220: 655f 7b61 787d 225d 203d 2063 656e 7472  e_{ax}"] = centr
-00028230: 6f69 645b 695d 0a0a 2020 2020 2020 2020  oid[i]..        
-00028240: 2020 2020 656c 6966 206d 203d 3d20 2263      elif m == "c
-00028250: 656e 7472 6f69 645f 736c 6963 655f 7374  entroid_slice_st
-00028260: 6174 7322 3a0a 2020 2020 2020 2020 2020  ats":.          
-00028270: 2020 2020 2020 636f 6d70 2e75 7064 6174        comp.updat
-00028280: 6528 726f 6930 2e67 6574 5f73 6c69 6365  e(roi0.get_slice
-00028290: 5f73 7461 7473 2872 6f69 2c20 6d65 7472  _stats(roi, metr
-000282a0: 6963 733d 2263 656e 7472 6f69 6422 2c0a  ics="centroid",.
-000282b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000282c0: 2020 2020 2020 2020 736c 6963 655f 7374          slice_st
-000282d0: 6174 733d 736c 6963 655f 7374 6174 732c  ats=slice_stats,
-000282e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000282f0: 2020 2020 2020 2020 2064 6566 6175 6c74           default
-00028300: 5f62 795f 736c 6963 653d 6465 6661 756c  _by_slice=defaul
-00028310: 745f 6279 5f73 6c69 6365 2c0a 2020 2020  t_by_slice,.    
-00028320: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028330: 2020 2020 6d65 7468 6f64 3d6d 6574 686f      method=metho
-00028340: 642c 2076 6965 773d 7669 6577 2c0a 2020  d, view=view,.  
-00028350: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028360: 2020 2020 2020 7365 7061 7261 7465 5f63        separate_c
-00028370: 6f6d 706f 6e65 6e74 733d 5472 7565 2929  omponents=True))
-00028380: 0a0a 2020 2020 2020 2020 2020 2020 656c  ..            el
-00028390: 6966 206d 203d 3d20 2261 6273 5f63 656e  if m == "abs_cen
-000283a0: 7472 6f69 645f 736c 6963 6522 3a0a 2020  troid_slice":.  
-000283b0: 2020 2020 2020 2020 2020 2020 2020 636f                co
-000283c0: 6d70 5b6d 5d20 3d20 726f 6930 2e67 6574  mp[m] = roi0.get
-000283d0: 5f61 6273 5f63 656e 7472 6f69 645f 6469  _abs_centroid_di
-000283e0: 7374 616e 6365 280a 2020 2020 2020 2020  stance(.        
-000283f0: 2020 2020 2020 2020 2020 2020 726f 692c              roi,
-00028400: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00028410: 2020 2020 2075 6e69 7473 3d63 656e 7472       units=centr
-00028420: 6f69 645f 756e 6974 732c 0a20 2020 2020  oid_units,.     
-00028430: 2020 2020 2020 2020 2020 2020 2020 206d                 m
-00028440: 6574 686f 643d 6d65 7468 6f64 2c0a 2020  ethod=method,.  
-00028450: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028460: 2020 2a2a 736c 6963 655f 6b77 6172 6773    **slice_kwargs
-00028470: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00028480: 2029 0a0a 2020 2020 2020 2020 2020 2020   )..            
-00028490: 656c 6966 206d 203d 3d20 2261 6273 5f63  elif m == "abs_c
-000284a0: 656e 7472 6f69 645f 736c 6963 655f 7374  entroid_slice_st
-000284b0: 6174 7322 3a0a 2020 2020 2020 2020 2020  ats":.          
-000284c0: 2020 2020 2020 636f 6d70 2e75 7064 6174        comp.updat
-000284d0: 6528 726f 6930 2e67 6574 5f73 6c69 6365  e(roi0.get_slice
-000284e0: 5f73 7461 7473 2872 6f69 2c20 6d65 7472  _stats(roi, metr
-000284f0: 6963 733d 2261 6273 5f63 656e 7472 6f69  ics="abs_centroi
-00028500: 6422 2c0a 2020 2020 2020 2020 2020 2020  d",.            
-00028510: 2020 2020 2020 2020 2020 2020 736c 6963              slic
-00028520: 655f 7374 6174 733d 736c 6963 655f 7374  e_stats=slice_st
-00028530: 6174 732c 0a20 2020 2020 2020 2020 2020  ats,.           
-00028540: 2020 2020 2020 2020 2020 2020 2064 6566               def
-00028550: 6175 6c74 5f62 795f 736c 6963 653d 6465  ault_by_slice=de
-00028560: 6661 756c 745f 6279 5f73 6c69 6365 2c0a  fault_by_slice,.
-00028570: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028580: 2020 2020 2020 2020 6d65 7468 6f64 3d6d          method=m
-00028590: 6574 686f 642c 2076 6965 773d 7669 6577  ethod, view=view
-000285a0: 2929 0a0a 2020 2020 2020 2020 2020 2020  ))..            
-000285b0: 2320 566f 6c75 6d65 206d 6574 7269 6373  # Volume metrics
-000285c0: 0a20 2020 2020 2020 2020 2020 2065 6c69  .            eli
-000285d0: 6620 6d20 3d3d 2022 766f 6c75 6d65 5f64  f m == "volume_d
-000285e0: 6966 6622 3a0a 2020 2020 2020 2020 2020  iff":.          
-000285f0: 2020 2020 2020 636f 6d70 5b6d 5d20 3d20        comp[m] = 
-00028600: 726f 6930 2e67 6574 5f76 6f6c 756d 655f  roi0.get_volume_
-00028610: 6469 6666 280a 2020 2020 2020 2020 2020  diff(.          
-00028620: 2020 2020 2020 2020 2020 726f 692c 0a20            roi,. 
+00027fc0: 2020 6d65 7468 6f64 3d6d 6574 686f 642c    method=method,
+00027fd0: 200a 2020 2020 2020 2020 2020 2020 2020   .              
+00027fe0: 2020 2020 2020 666f 7263 653d 666f 7263        force=forc
+00027ff0: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
+00028000: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
+00028010: 656c 6966 206d 203d 3d20 2261 6273 5f63  elif m == "abs_c
+00028020: 656e 7472 6f69 645f 666c 6174 223a 0a20  entroid_flat":. 
+00028030: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+00028040: 6f6d 705b 6d5d 203d 2072 6f69 302e 6765  omp[m] = roi0.ge
+00028050: 745f 6162 735f 6365 6e74 726f 6964 5f64  t_abs_centroid_d
+00028060: 6973 7461 6e63 6528 0a20 2020 2020 2020  istance(.       
+00028070: 2020 2020 2020 2020 2020 2020 2072 6f69               roi
+00028080: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00028090: 2020 2020 2020 7669 6577 3d76 6965 772c        view=view,
+000280a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000280b0: 2020 2020 2075 6e69 7473 3d63 656e 7472       units=centr
+000280c0: 6f69 645f 756e 6974 732c 0a20 2020 2020  oid_units,.     
+000280d0: 2020 2020 2020 2020 2020 2020 2020 206d                 m
+000280e0: 6574 686f 643d 6d65 7468 6f64 2c0a 2020  ethod=method,.  
+000280f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028100: 2020 666c 6174 7465 6e3d 5472 7565 2c0a    flatten=True,.
+00028110: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028120: 2020 2020 666f 7263 653d 666f 7263 650a      force=force.
+00028130: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028140: 290a 2020 2020 2020 2020 2020 2020 656c  ).            el
+00028150: 6966 206d 203d 3d20 2263 656e 7472 6f69  if m == "centroi
+00028160: 645f 736c 6963 6522 3a0a 2020 2020 2020  d_slice":.      
+00028170: 2020 2020 2020 2020 2020 6365 6e74 726f            centro
+00028180: 6964 203d 2072 6f69 302e 6765 745f 6365  id = roi0.get_ce
+00028190: 6e74 726f 6964 5f64 6973 7461 6e63 6528  ntroid_distance(
+000281a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000281b0: 2020 2020 2072 6f69 2c0a 2020 2020 2020       roi,.      
+000281c0: 2020 2020 2020 2020 2020 2020 2020 756e                un
+000281d0: 6974 733d 6365 6e74 726f 6964 5f75 6e69  its=centroid_uni
+000281e0: 7473 2c0a 2020 2020 2020 2020 2020 2020  ts,.            
+000281f0: 2020 2020 2020 2020 6d65 7468 6f64 3d6d          method=m
+00028200: 6574 686f 642c 0a20 2020 2020 2020 2020  ethod,.         
+00028210: 2020 2020 2020 2020 2020 202a 2a73 6c69             **sli
+00028220: 6365 5f6b 7761 7267 730a 2020 2020 2020  ce_kwargs.      
+00028230: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+00028240: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+00028250: 692c 2069 5f61 7820 696e 2065 6e75 6d65  i, i_ax in enume
+00028260: 7261 7465 2873 6b72 742e 696d 6167 652e  rate(skrt.image.
+00028270: 5f70 6c6f 745f 6178 6573 5b76 6965 775d  _plot_axes[view]
+00028280: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+00028290: 2020 2020 2020 2061 7820 3d20 736b 7274         ax = skrt
+000282a0: 2e69 6d61 6765 2e5f 6178 6573 5b69 5f61  .image._axes[i_a
+000282b0: 785d 0a20 2020 2020 2020 2020 2020 2020  x].             
+000282c0: 2020 2020 2020 2063 6f6d 705b 6622 6365         comp[f"ce
+000282d0: 6e74 726f 6964 5f73 6c69 6365 5f7b 6178  ntroid_slice_{ax
+000282e0: 7d22 5d20 3d20 6365 6e74 726f 6964 5b69  }"] = centroid[i
+000282f0: 5d0a 0a20 2020 2020 2020 2020 2020 2065  ]..            e
+00028300: 6c69 6620 6d20 3d3d 2022 6365 6e74 726f  lif m == "centro
+00028310: 6964 5f73 6c69 6365 5f73 7461 7473 223a  id_slice_stats":
+00028320: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00028330: 2063 6f6d 702e 7570 6461 7465 2872 6f69   comp.update(roi
+00028340: 302e 6765 745f 736c 6963 655f 7374 6174  0.get_slice_stat
+00028350: 7328 726f 692c 206d 6574 7269 6373 3d22  s(roi, metrics="
+00028360: 6365 6e74 726f 6964 222c 0a20 2020 2020  centroid",.     
+00028370: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028380: 2020 2073 6c69 6365 5f73 7461 7473 3d73     slice_stats=s
+00028390: 6c69 6365 5f73 7461 7473 2c0a 2020 2020  lice_stats,.    
+000283a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000283b0: 2020 2020 6465 6661 756c 745f 6279 5f73      default_by_s
+000283c0: 6c69 6365 3d64 6566 6175 6c74 5f62 795f  lice=default_by_
+000283d0: 736c 6963 652c 0a20 2020 2020 2020 2020  slice,.         
+000283e0: 2020 2020 2020 2020 2020 2020 2020 206d                 m
+000283f0: 6574 686f 643d 6d65 7468 6f64 2c20 7669  ethod=method, vi
+00028400: 6577 3d76 6965 772c 0a20 2020 2020 2020  ew=view,.       
+00028410: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028420: 2073 6570 6172 6174 655f 636f 6d70 6f6e   separate_compon
+00028430: 656e 7473 3d54 7275 6529 290a 0a20 2020  ents=True))..   
+00028440: 2020 2020 2020 2020 2065 6c69 6620 6d20           elif m 
+00028450: 3d3d 2022 6162 735f 6365 6e74 726f 6964  == "abs_centroid
+00028460: 5f73 6c69 6365 223a 0a20 2020 2020 2020  _slice":.       
+00028470: 2020 2020 2020 2020 2063 6f6d 705b 6d5d           comp[m]
+00028480: 203d 2072 6f69 302e 6765 745f 6162 735f   = roi0.get_abs_
+00028490: 6365 6e74 726f 6964 5f64 6973 7461 6e63  centroid_distanc
+000284a0: 6528 0a20 2020 2020 2020 2020 2020 2020  e(.             
+000284b0: 2020 2020 2020 2072 6f69 2c0a 2020 2020         roi,.    
+000284c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000284d0: 756e 6974 733d 6365 6e74 726f 6964 5f75  units=centroid_u
+000284e0: 6e69 7473 2c0a 2020 2020 2020 2020 2020  nits,.          
+000284f0: 2020 2020 2020 2020 2020 6d65 7468 6f64            method
+00028500: 3d6d 6574 686f 642c 0a20 2020 2020 2020  =method,.       
+00028510: 2020 2020 2020 2020 2020 2020 202a 2a73               **s
+00028520: 6c69 6365 5f6b 7761 7267 730a 2020 2020  lice_kwargs.    
+00028530: 2020 2020 2020 2020 2020 2020 290a 0a20              ).. 
+00028540: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
+00028550: 6d20 3d3d 2022 6162 735f 6365 6e74 726f  m == "abs_centro
+00028560: 6964 5f73 6c69 6365 5f73 7461 7473 223a  id_slice_stats":
+00028570: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00028580: 2063 6f6d 702e 7570 6461 7465 2872 6f69   comp.update(roi
+00028590: 302e 6765 745f 736c 6963 655f 7374 6174  0.get_slice_stat
+000285a0: 7328 726f 692c 206d 6574 7269 6373 3d22  s(roi, metrics="
+000285b0: 6162 735f 6365 6e74 726f 6964 222c 0a20  abs_centroid",. 
+000285c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000285d0: 2020 2020 2020 2073 6c69 6365 5f73 7461         slice_sta
+000285e0: 7473 3d73 6c69 6365 5f73 7461 7473 2c0a  ts=slice_stats,.
+000285f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028600: 2020 2020 2020 2020 6465 6661 756c 745f          default_
+00028610: 6279 5f73 6c69 6365 3d64 6566 6175 6c74  by_slice=default
+00028620: 5f62 795f 736c 6963 652c 0a20 2020 2020  _by_slice,.     
 00028630: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028640: 2020 2075 6e69 7473 3d76 6f6c 5f75 6e69     units=vol_uni
-00028650: 7473 2c0a 2020 2020 2020 2020 2020 2020  ts,.            
-00028660: 2020 2020 2020 2020 6d65 7468 6f64 3d6d          method=m
-00028670: 6574 686f 642c 0a20 2020 2020 2020 2020  ethod,.         
-00028680: 2020 2020 2020 2020 2020 2066 6f72 6365             force
-00028690: 3d66 6f72 6365 0a20 2020 2020 2020 2020  =force.         
-000286a0: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-000286b0: 2020 2020 2065 6c69 6620 6d20 3d3d 2022       elif m == "
-000286c0: 7265 6c5f 766f 6c75 6d65 5f64 6966 6622  rel_volume_diff"
-000286d0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000286e0: 2020 636f 6d70 5b6d 5d20 3d20 726f 6930    comp[m] = roi0
-000286f0: 2e67 6574 5f72 656c 6174 6976 655f 766f  .get_relative_vo
-00028700: 6c75 6d65 5f64 6966 6628 0a20 2020 2020  lume_diff(.     
-00028710: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00028720: 6f69 2c0a 2020 2020 2020 2020 2020 2020  oi,.            
-00028730: 2020 2020 2020 2020 6d65 7468 6f64 3d6d          method=m
-00028740: 6574 686f 642c 0a20 2020 2020 2020 2020  ethod,.         
-00028750: 2020 2020 2020 2020 2020 2066 6f72 6365             force
-00028760: 3d66 6f72 6365 0a20 2020 2020 2020 2020  =force.         
-00028770: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-00028780: 2020 2020 2065 6c69 6620 6d20 3d3d 2022       elif m == "
-00028790: 766f 6c75 6d65 5f72 6174 696f 223a 0a20  volume_ratio":. 
-000287a0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-000287b0: 6f6d 705b 6d5d 203d 2072 6f69 302e 6765  omp[m] = roi0.ge
-000287c0: 745f 766f 6c75 6d65 5f72 6174 696f 280a  t_volume_ratio(.
-000287d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000287e0: 2020 2020 726f 692c 0a20 2020 2020 2020      roi,.       
-000287f0: 2020 2020 2020 2020 2020 2020 206d 6574               met
-00028800: 686f 643d 6d65 7468 6f64 2c0a 2020 2020  hod=method,.    
-00028810: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028820: 666f 7263 653d 666f 7263 650a 2020 2020  force=force.    
-00028830: 2020 2020 2020 2020 2020 2020 290a 0a20              ).. 
-00028840: 2020 2020 2020 2020 2020 2023 2041 7265             # Are
-00028850: 6120 6d65 7472 6963 730a 2020 2020 2020  a metrics.      
-00028860: 2020 2020 2020 656c 6966 206d 203d 3d20        elif m == 
-00028870: 2261 7265 615f 6469 6666 223a 0a20 2020  "area_diff":.   
-00028880: 2020 2020 2020 2020 2020 2020 2063 6f6d               com
-00028890: 705b 6d5d 203d 2072 6f69 302e 6765 745f  p[m] = roi0.get_
-000288a0: 6172 6561 5f64 6966 6628 0a20 2020 2020  area_diff(.     
-000288b0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-000288c0: 6f69 2c0a 2020 2020 2020 2020 2020 2020  oi,.            
-000288d0: 2020 2020 2020 2020 756e 6974 733d 6172          units=ar
-000288e0: 6561 5f75 6e69 7473 2c0a 2020 2020 2020  ea_units,.      
-000288f0: 2020 2020 2020 2020 2020 2020 2020 6d65                me
-00028900: 7468 6f64 3d6d 6574 686f 642c 0a20 2020  thod=method,.   
-00028910: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028920: 202a 2a73 6c69 6365 5f6b 7761 7267 730a   **slice_kwargs.
-00028930: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028940: 290a 2020 2020 2020 2020 2020 2020 656c  ).            el
-00028950: 6966 206d 203d 3d20 2272 656c 5f61 7265  if m == "rel_are
-00028960: 615f 6469 6666 223a 0a20 2020 2020 2020  a_diff":.       
-00028970: 2020 2020 2020 2020 2063 6f6d 705b 6d5d           comp[m]
-00028980: 203d 2072 6f69 302e 6765 745f 7265 6c61   = roi0.get_rela
-00028990: 7469 7665 5f61 7265 615f 6469 6666 280a  tive_area_diff(.
-000289a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000289b0: 2020 2020 726f 692c 0a20 2020 2020 2020      roi,.       
-000289c0: 2020 2020 2020 2020 2020 2020 206d 6574               met
-000289d0: 686f 643d 6d65 7468 6f64 2c0a 2020 2020  hod=method,.    
-000289e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000289f0: 2a2a 736c 6963 655f 6b77 6172 6773 0a20  **slice_kwargs. 
-00028a00: 2020 2020 2020 2020 2020 2020 2020 2029                 )
-00028a10: 0a20 2020 2020 2020 2020 2020 2065 6c69  .            eli
-00028a20: 6620 6d20 3d3d 2022 6172 6561 5f72 6174  f m == "area_rat
-00028a30: 696f 223a 0a20 2020 2020 2020 2020 2020  io":.           
-00028a40: 2020 2020 2063 6f6d 705b 6d5d 203d 2072       comp[m] = r
-00028a50: 6f69 302e 6765 745f 6172 6561 5f72 6174  oi0.get_area_rat
-00028a60: 696f 280a 2020 2020 2020 2020 2020 2020  io(.            
-00028a70: 2020 2020 2020 2020 726f 692c 0a20 2020          roi,.   
-00028a80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028a90: 206d 6574 686f 643d 6d65 7468 6f64 2c0a   method=method,.
-00028aa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028ab0: 2020 2020 2a2a 736c 6963 655f 6b77 6172      **slice_kwar
-00028ac0: 6773 0a20 2020 2020 2020 2020 2020 2020  gs.             
-00028ad0: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
-00028ae0: 2065 6c69 6620 6d20 3d3d 2022 6172 6561   elif m == "area
-00028af0: 5f64 6966 665f 666c 6174 223a 0a20 2020  _diff_flat":.   
-00028b00: 2020 2020 2020 2020 2020 2020 2063 6f6d               com
-00028b10: 705b 6d5d 203d 2072 6f69 302e 6765 745f  p[m] = roi0.get_
-00028b20: 6172 6561 5f64 6966 6628 0a20 2020 2020  area_diff(.     
-00028b30: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00028b40: 6f69 2c0a 2020 2020 2020 2020 2020 2020  oi,.            
-00028b50: 2020 2020 2020 2020 756e 6974 733d 6172          units=ar
-00028b60: 6561 5f75 6e69 7473 2c0a 2020 2020 2020  ea_units,.      
-00028b70: 2020 2020 2020 2020 2020 2020 2020 6d65                me
-00028b80: 7468 6f64 3d6d 6574 686f 642c 0a20 2020  thod=method,.   
-00028b90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028ba0: 2076 6965 773d 7669 6577 2c0a 2020 2020   view=view,.    
-00028bb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028bc0: 666c 6174 7465 6e3d 5472 7565 2c0a 2020  flatten=True,.  
-00028bd0: 2020 2020 2020 2020 2020 2020 2020 290a                ).
-00028be0: 0a20 2020 2020 2020 2020 2020 2065 6c69  .            eli
-00028bf0: 6620 6d20 3d3d 2022 6172 6561 5f64 6966  f m == "area_dif
-00028c00: 665f 736c 6963 655f 7374 6174 7322 3a0a  f_slice_stats":.
-00028c10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028c20: 636f 6d70 2e75 7064 6174 6528 726f 6930  comp.update(roi0
-00028c30: 2e67 6574 5f73 6c69 6365 5f73 7461 7473  .get_slice_stats
-00028c40: 2872 6f69 2c20 6d65 7472 6963 733d 2261  (roi, metrics="a
-00028c50: 7265 615f 6469 6666 222c 0a20 2020 2020  rea_diff",.     
-00028c60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028c70: 2020 2073 6c69 6365 5f73 7461 7473 3d73     slice_stats=s
-00028c80: 6c69 6365 5f73 7461 7473 2c0a 2020 2020  lice_stats,.    
-00028c90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028ca0: 2020 2020 6465 6661 756c 745f 6279 5f73      default_by_s
-00028cb0: 6c69 6365 3d64 6566 6175 6c74 5f62 795f  lice=default_by_
-00028cc0: 736c 6963 652c 0a20 2020 2020 2020 2020  slice,.         
-00028cd0: 2020 2020 2020 2020 2020 2020 2020 206d                 m
-00028ce0: 6574 686f 643d 6d65 7468 6f64 2c20 7669  ethod=method, vi
-00028cf0: 6577 3d76 6965 7729 290a 0a20 2020 2020  ew=view))..     
-00028d00: 2020 2020 2020 2065 6c69 6620 6d20 3d3d         elif m ==
-00028d10: 2022 7265 6c5f 6172 6561 5f64 6966 665f   "rel_area_diff_
-00028d20: 666c 6174 223a 0a20 2020 2020 2020 2020  flat":.         
-00028d30: 2020 2020 2020 2063 6f6d 705b 6d5d 203d         comp[m] =
-00028d40: 2072 6f69 302e 6765 745f 7265 6c61 7469   roi0.get_relati
-00028d50: 7665 5f61 7265 615f 6469 6666 280a 2020  ve_area_diff(.  
-00028d60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028d70: 2020 726f 692c 0a20 2020 2020 2020 2020    roi,.         
-00028d80: 2020 2020 2020 2020 2020 2076 6965 773d             view=
-00028d90: 7669 6577 2c0a 2020 2020 2020 2020 2020  view,.          
-00028da0: 2020 2020 2020 2020 2020 6d65 7468 6f64            method
-00028db0: 3d6d 6574 686f 642c 0a20 2020 2020 2020  =method,.       
-00028dc0: 2020 2020 2020 2020 2020 2020 2066 6c61               fla
-00028dd0: 7474 656e 3d54 7275 652c 0a20 2020 2020  tten=True,.     
-00028de0: 2020 2020 2020 2020 2020 2029 0a0a 2020             )..  
-00028df0: 2020 2020 2020 2020 2020 656c 6966 206d            elif m
-00028e00: 203d 3d20 2272 656c 5f61 7265 615f 6469   == "rel_area_di
-00028e10: 6666 5f73 6c69 6365 5f73 7461 7473 223a  ff_slice_stats":
-00028e20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00028e30: 2063 6f6d 702e 7570 6461 7465 2872 6f69   comp.update(roi
-00028e40: 302e 6765 745f 736c 6963 655f 7374 6174  0.get_slice_stat
-00028e50: 7328 726f 692c 0a20 2020 2020 2020 2020  s(roi,.         
-00028e60: 2020 2020 2020 2020 2020 206d 6574 7269             metri
-00028e70: 6373 3d22 7265 6c5f 6172 6561 5f64 6966  cs="rel_area_dif
-00028e80: 6622 2c0a 2020 2020 2020 2020 2020 2020  f",.            
-00028e90: 2020 2020 2020 2020 736c 6963 655f 7374          slice_st
-00028ea0: 6174 733d 736c 6963 655f 7374 6174 732c  ats=slice_stats,
-00028eb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00028ec0: 2020 2020 2064 6566 6175 6c74 5f62 795f       default_by_
-00028ed0: 736c 6963 653d 6465 6661 756c 745f 6279  slice=default_by
-00028ee0: 5f73 6c69 6365 2c0a 2020 2020 2020 2020  _slice,.        
-00028ef0: 2020 2020 2020 2020 2020 2020 6d65 7468              meth
-00028f00: 6f64 3d6d 6574 686f 642c 2076 6965 773d  od=method, view=
-00028f10: 7669 6577 2929 0a0a 2020 2020 2020 2020  view))..        
-00028f20: 2020 2020 656c 6966 206d 203d 3d20 2261      elif m == "a
-00028f30: 7265 615f 7261 7469 6f5f 666c 6174 223a  rea_ratio_flat":
-00028f40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00028f50: 2063 6f6d 705b 6d5d 203d 2072 6f69 302e   comp[m] = roi0.
-00028f60: 6765 745f 6172 6561 5f72 6174 696f 280a  get_area_ratio(.
+00028640: 2020 206d 6574 686f 643d 6d65 7468 6f64     method=method
+00028650: 2c20 7669 6577 3d76 6965 7729 290a 0a20  , view=view)).. 
+00028660: 2020 2020 2020 2020 2020 2023 2056 6f6c             # Vol
+00028670: 756d 6520 6d65 7472 6963 730a 2020 2020  ume metrics.    
+00028680: 2020 2020 2020 2020 656c 6966 206d 203d          elif m =
+00028690: 3d20 2276 6f6c 756d 655f 6469 6666 223a  = "volume_diff":
+000286a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000286b0: 2063 6f6d 705b 6d5d 203d 2072 6f69 302e   comp[m] = roi0.
+000286c0: 6765 745f 766f 6c75 6d65 5f64 6966 6628  get_volume_diff(
+000286d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000286e0: 2020 2020 2072 6f69 2c0a 2020 2020 2020       roi,.      
+000286f0: 2020 2020 2020 2020 2020 2020 2020 756e                un
+00028700: 6974 733d 766f 6c5f 756e 6974 732c 0a20  its=vol_units,. 
+00028710: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028720: 2020 206d 6574 686f 643d 6d65 7468 6f64     method=method
+00028730: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00028740: 2020 2020 2020 666f 7263 653d 666f 7263        force=forc
+00028750: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
+00028760: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
+00028770: 656c 6966 206d 203d 3d20 2272 656c 5f76  elif m == "rel_v
+00028780: 6f6c 756d 655f 6469 6666 223a 0a20 2020  olume_diff":.   
+00028790: 2020 2020 2020 2020 2020 2020 2063 6f6d               com
+000287a0: 705b 6d5d 203d 2072 6f69 302e 6765 745f  p[m] = roi0.get_
+000287b0: 7265 6c61 7469 7665 5f76 6f6c 756d 655f  relative_volume_
+000287c0: 6469 6666 280a 2020 2020 2020 2020 2020  diff(.          
+000287d0: 2020 2020 2020 2020 2020 726f 692c 0a20            roi,. 
+000287e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000287f0: 2020 206d 6574 686f 643d 6d65 7468 6f64     method=method
+00028800: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00028810: 2020 2020 2020 666f 7263 653d 666f 7263        force=forc
+00028820: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
+00028830: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
+00028840: 656c 6966 206d 203d 3d20 2276 6f6c 756d  elif m == "volum
+00028850: 655f 7261 7469 6f22 3a0a 2020 2020 2020  e_ratio":.      
+00028860: 2020 2020 2020 2020 2020 636f 6d70 5b6d            comp[m
+00028870: 5d20 3d20 726f 6930 2e67 6574 5f76 6f6c  ] = roi0.get_vol
+00028880: 756d 655f 7261 7469 6f28 0a20 2020 2020  ume_ratio(.     
+00028890: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+000288a0: 6f69 2c0a 2020 2020 2020 2020 2020 2020  oi,.            
+000288b0: 2020 2020 2020 2020 6d65 7468 6f64 3d6d          method=m
+000288c0: 6574 686f 642c 0a20 2020 2020 2020 2020  ethod,.         
+000288d0: 2020 2020 2020 2020 2020 2066 6f72 6365             force
+000288e0: 3d66 6f72 6365 0a20 2020 2020 2020 2020  =force.         
+000288f0: 2020 2020 2020 2029 0a0a 2020 2020 2020         )..      
+00028900: 2020 2020 2020 2320 4172 6561 206d 6574        # Area met
+00028910: 7269 6373 0a20 2020 2020 2020 2020 2020  rics.           
+00028920: 2065 6c69 6620 6d20 3d3d 2022 6172 6561   elif m == "area
+00028930: 5f64 6966 6622 3a0a 2020 2020 2020 2020  _diff":.        
+00028940: 2020 2020 2020 2020 636f 6d70 5b6d 5d20          comp[m] 
+00028950: 3d20 726f 6930 2e67 6574 5f61 7265 615f  = roi0.get_area_
+00028960: 6469 6666 280a 2020 2020 2020 2020 2020  diff(.          
+00028970: 2020 2020 2020 2020 2020 726f 692c 0a20            roi,. 
+00028980: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028990: 2020 2075 6e69 7473 3d61 7265 615f 756e     units=area_un
+000289a0: 6974 732c 0a20 2020 2020 2020 2020 2020  its,.           
+000289b0: 2020 2020 2020 2020 206d 6574 686f 643d           method=
+000289c0: 6d65 7468 6f64 2c0a 2020 2020 2020 2020  method,.        
+000289d0: 2020 2020 2020 2020 2020 2020 2a2a 736c              **sl
+000289e0: 6963 655f 6b77 6172 6773 0a20 2020 2020  ice_kwargs.     
+000289f0: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
+00028a00: 2020 2020 2020 2020 2065 6c69 6620 6d20           elif m 
+00028a10: 3d3d 2022 7265 6c5f 6172 6561 5f64 6966  == "rel_area_dif
+00028a20: 6622 3a0a 2020 2020 2020 2020 2020 2020  f":.            
+00028a30: 2020 2020 636f 6d70 5b6d 5d20 3d20 726f      comp[m] = ro
+00028a40: 6930 2e67 6574 5f72 656c 6174 6976 655f  i0.get_relative_
+00028a50: 6172 6561 5f64 6966 6628 0a20 2020 2020  area_diff(.     
+00028a60: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00028a70: 6f69 2c0a 2020 2020 2020 2020 2020 2020  oi,.            
+00028a80: 2020 2020 2020 2020 6d65 7468 6f64 3d6d          method=m
+00028a90: 6574 686f 642c 0a20 2020 2020 2020 2020  ethod,.         
+00028aa0: 2020 2020 2020 2020 2020 202a 2a73 6c69             **sli
+00028ab0: 6365 5f6b 7761 7267 730a 2020 2020 2020  ce_kwargs.      
+00028ac0: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+00028ad0: 2020 2020 2020 2020 656c 6966 206d 203d          elif m =
+00028ae0: 3d20 2261 7265 615f 7261 7469 6f22 3a0a  = "area_ratio":.
+00028af0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028b00: 636f 6d70 5b6d 5d20 3d20 726f 6930 2e67  comp[m] = roi0.g
+00028b10: 6574 5f61 7265 615f 7261 7469 6f28 0a20  et_area_ratio(. 
+00028b20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028b30: 2020 2072 6f69 2c0a 2020 2020 2020 2020     roi,.        
+00028b40: 2020 2020 2020 2020 2020 2020 6d65 7468              meth
+00028b50: 6f64 3d6d 6574 686f 642c 0a20 2020 2020  od=method,.     
+00028b60: 2020 2020 2020 2020 2020 2020 2020 202a                 *
+00028b70: 2a73 6c69 6365 5f6b 7761 7267 730a 2020  *slice_kwargs.  
+00028b80: 2020 2020 2020 2020 2020 2020 2020 290a                ).
+00028b90: 2020 2020 2020 2020 2020 2020 656c 6966              elif
+00028ba0: 206d 203d 3d20 2261 7265 615f 6469 6666   m == "area_diff
+00028bb0: 5f66 6c61 7422 3a0a 2020 2020 2020 2020  _flat":.        
+00028bc0: 2020 2020 2020 2020 636f 6d70 5b6d 5d20          comp[m] 
+00028bd0: 3d20 726f 6930 2e67 6574 5f61 7265 615f  = roi0.get_area_
+00028be0: 6469 6666 280a 2020 2020 2020 2020 2020  diff(.          
+00028bf0: 2020 2020 2020 2020 2020 726f 692c 0a20            roi,. 
+00028c00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028c10: 2020 2075 6e69 7473 3d61 7265 615f 756e     units=area_un
+00028c20: 6974 732c 0a20 2020 2020 2020 2020 2020  its,.           
+00028c30: 2020 2020 2020 2020 206d 6574 686f 643d           method=
+00028c40: 6d65 7468 6f64 2c0a 2020 2020 2020 2020  method,.        
+00028c50: 2020 2020 2020 2020 2020 2020 7669 6577              view
+00028c60: 3d76 6965 772c 0a20 2020 2020 2020 2020  =view,.         
+00028c70: 2020 2020 2020 2020 2020 2066 6c61 7474             flatt
+00028c80: 656e 3d54 7275 652c 0a20 2020 2020 2020  en=True,.       
+00028c90: 2020 2020 2020 2020 2029 0a0a 2020 2020           )..    
+00028ca0: 2020 2020 2020 2020 656c 6966 206d 203d          elif m =
+00028cb0: 3d20 2261 7265 615f 6469 6666 5f73 6c69  = "area_diff_sli
+00028cc0: 6365 5f73 7461 7473 223a 0a20 2020 2020  ce_stats":.     
+00028cd0: 2020 2020 2020 2020 2020 2063 6f6d 702e             comp.
+00028ce0: 7570 6461 7465 2872 6f69 302e 6765 745f  update(roi0.get_
+00028cf0: 736c 6963 655f 7374 6174 7328 726f 692c  slice_stats(roi,
+00028d00: 206d 6574 7269 6373 3d22 6172 6561 5f64   metrics="area_d
+00028d10: 6966 6622 2c0a 2020 2020 2020 2020 2020  iff",.          
+00028d20: 2020 2020 2020 2020 2020 2020 2020 736c                sl
+00028d30: 6963 655f 7374 6174 733d 736c 6963 655f  ice_stats=slice_
+00028d40: 7374 6174 732c 0a20 2020 2020 2020 2020  stats,.         
+00028d50: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+00028d60: 6566 6175 6c74 5f62 795f 736c 6963 653d  efault_by_slice=
+00028d70: 6465 6661 756c 745f 6279 5f73 6c69 6365  default_by_slice
+00028d80: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00028d90: 2020 2020 2020 2020 2020 6d65 7468 6f64            method
+00028da0: 3d6d 6574 686f 642c 2076 6965 773d 7669  =method, view=vi
+00028db0: 6577 2929 0a0a 2020 2020 2020 2020 2020  ew))..          
+00028dc0: 2020 656c 6966 206d 203d 3d20 2272 656c    elif m == "rel
+00028dd0: 5f61 7265 615f 6469 6666 5f66 6c61 7422  _area_diff_flat"
+00028de0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00028df0: 2020 636f 6d70 5b6d 5d20 3d20 726f 6930    comp[m] = roi0
+00028e00: 2e67 6574 5f72 656c 6174 6976 655f 6172  .get_relative_ar
+00028e10: 6561 5f64 6966 6628 0a20 2020 2020 2020  ea_diff(.       
+00028e20: 2020 2020 2020 2020 2020 2020 2072 6f69               roi
+00028e30: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00028e40: 2020 2020 2020 7669 6577 3d76 6965 772c        view=view,
+00028e50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00028e60: 2020 2020 206d 6574 686f 643d 6d65 7468       method=meth
+00028e70: 6f64 2c0a 2020 2020 2020 2020 2020 2020  od,.            
+00028e80: 2020 2020 2020 2020 666c 6174 7465 6e3d          flatten=
+00028e90: 5472 7565 2c0a 2020 2020 2020 2020 2020  True,.          
+00028ea0: 2020 2020 2020 290a 0a20 2020 2020 2020        )..       
+00028eb0: 2020 2020 2065 6c69 6620 6d20 3d3d 2022       elif m == "
+00028ec0: 7265 6c5f 6172 6561 5f64 6966 665f 736c  rel_area_diff_sl
+00028ed0: 6963 655f 7374 6174 7322 3a0a 2020 2020  ice_stats":.    
+00028ee0: 2020 2020 2020 2020 2020 2020 636f 6d70              comp
+00028ef0: 2e75 7064 6174 6528 726f 6930 2e67 6574  .update(roi0.get
+00028f00: 5f73 6c69 6365 5f73 7461 7473 2872 6f69  _slice_stats(roi
+00028f10: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00028f20: 2020 2020 2020 6d65 7472 6963 733d 2272        metrics="r
+00028f30: 656c 5f61 7265 615f 6469 6666 222c 0a20  el_area_diff",. 
+00028f40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028f50: 2020 2073 6c69 6365 5f73 7461 7473 3d73     slice_stats=s
+00028f60: 6c69 6365 5f73 7461 7473 2c0a 2020 2020  lice_stats,.    
 00028f70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028f80: 2020 2020 726f 692c 0a20 2020 2020 2020      roi,.       
-00028f90: 2020 2020 2020 2020 2020 2020 2076 6965               vie
-00028fa0: 773d 7669 6577 2c0a 2020 2020 2020 2020  w=view,.        
-00028fb0: 2020 2020 2020 2020 2020 2020 6d65 7468              meth
-00028fc0: 6f64 3d6d 6574 686f 642c 0a20 2020 2020  od=method,.     
-00028fd0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-00028fe0: 6c61 7474 656e 3d54 7275 652c 0a20 2020  latten=True,.   
-00028ff0: 2020 2020 2020 2020 2020 2020 2029 0a0a               )..
-00029000: 2020 2020 2020 2020 2020 2020 656c 6966              elif
-00029010: 206d 203d 3d20 2261 7265 615f 7261 7469   m == "area_rati
-00029020: 6f5f 736c 6963 655f 7374 6174 7322 3a0a  o_slice_stats":.
-00029030: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029040: 636f 6d70 2e75 7064 6174 6528 726f 6930  comp.update(roi0
-00029050: 2e67 6574 5f73 6c69 6365 5f73 7461 7473  .get_slice_stats
-00029060: 2872 6f69 2c20 6d65 7472 6963 733d 2261  (roi, metrics="a
-00029070: 7265 615f 7261 7469 6f22 2c0a 2020 2020  rea_ratio",.    
-00029080: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029090: 2020 2020 736c 6963 655f 7374 6174 733d      slice_stats=
-000290a0: 736c 6963 655f 7374 6174 732c 0a20 2020  slice_stats,.   
-000290b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000290c0: 2020 2020 2064 6566 6175 6c74 5f62 795f       default_by_
-000290d0: 736c 6963 653d 6465 6661 756c 745f 6279  slice=default_by
-000290e0: 5f73 6c69 6365 2c0a 2020 2020 2020 2020  _slice,.        
-000290f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029100: 6d65 7468 6f64 3d6d 6574 686f 642c 2076  method=method, v
-00029110: 6965 773d 7669 6577 2929 0a0a 2020 2020  iew=view))..    
-00029120: 2020 2020 2020 2020 2320 5375 7266 6163          # Surfac
-00029130: 6520 6469 7374 616e 6365 206d 6574 7269  e distance metri
-00029140: 6373 0a20 2020 2020 2020 2020 2020 2065  cs.            e
-00029150: 6c69 6620 6d20 696e 205b 226d 6561 6e5f  lif m in ["mean_
-00029160: 7375 7266 6163 655f 6469 7374 616e 6365  surface_distance
-00029170: 222c 0a20 2020 2020 2020 2020 2020 2020  ",.             
-00029180: 2020 2020 2020 2022 726d 735f 7375 7266         "rms_surf
-00029190: 6163 655f 6469 7374 616e 6365 222c 2022  ace_distance", "
-000291a0: 6861 7573 646f 7266 665f 6469 7374 616e  hausdorff_distan
-000291b0: 6365 225d 3a0a 2020 2020 2020 2020 2020  ce"]:.          
-000291c0: 2020 2020 2020 6469 7374 616e 6365 7320        distances 
-000291d0: 3d20 2864 6973 7461 6e63 6573 0a20 2020  = (distances.   
-000291e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000291f0: 2020 2020 206f 7220 726f 6930 2e67 6574       or roi0.get
-00029200: 5f73 7572 6661 6365 5f64 6973 7461 6e63  _surface_distanc
-00029210: 655f 6d65 7472 6963 7328 726f 6929 290a  e_metrics(roi)).
-00029220: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029230: 6966 206d 203d 3d20 226d 6561 6e5f 7375  if m == "mean_su
-00029240: 7266 6163 655f 6469 7374 616e 6365 223a  rface_distance":
-00029250: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00029260: 2020 2020 2063 6f6d 705b 6d5d 203d 2064       comp[m] = d
-00029270: 6973 7461 6e63 6573 5b30 5d0a 2020 2020  istances[0].    
-00029280: 2020 2020 2020 2020 2020 2020 656c 6966              elif
-00029290: 206d 203d 3d20 2272 6d73 5f73 7572 6661   m == "rms_surfa
-000292a0: 6365 5f64 6973 7461 6e63 6522 3a0a 2020  ce_distance":.  
-000292b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000292c0: 2020 636f 6d70 5b6d 5d20 3d20 6469 7374    comp[m] = dist
-000292d0: 616e 6365 735b 315d 0a20 2020 2020 2020  ances[1].       
-000292e0: 2020 2020 2020 2020 2065 6c69 6620 6d20           elif m 
-000292f0: 3d3d 2022 6861 7573 646f 7266 665f 6469  == "hausdorff_di
-00029300: 7374 616e 6365 223a 0a20 2020 2020 2020  stance":.       
-00029310: 2020 2020 2020 2020 2020 2020 2063 6f6d               com
-00029320: 705b 6d5d 203d 2064 6973 7461 6e63 6573  p[m] = distances
-00029330: 5b32 5d0a 2020 2020 2020 2020 2020 2020  [2].            
-00029340: 656c 6966 206d 2069 6e20 5b22 6d65 616e  elif m in ["mean
-00029350: 5f73 7572 6661 6365 5f64 6973 7461 6e63  _surface_distanc
-00029360: 655f 666c 6174 222c 0a20 2020 2020 2020  e_flat",.       
-00029370: 2020 2020 2020 2020 2020 2020 2022 726d               "rm
-00029380: 735f 7375 7266 6163 655f 6469 7374 616e  s_surface_distan
-00029390: 6365 5f66 6c61 7422 2c20 2268 6175 7364  ce_flat", "hausd
-000293a0: 6f72 6666 5f64 6973 7461 6e63 655f 666c  orff_distance_fl
-000293b0: 6174 225d 3a0a 2020 2020 2020 2020 2020  at"]:.          
-000293c0: 2020 2020 2020 6469 7374 616e 6365 735f        distances_
-000293d0: 666c 6174 203d 2028 6469 7374 616e 6365  flat = (distance
-000293e0: 735f 666c 6174 0a20 2020 2020 2020 2020  s_flat.         
-000293f0: 2020 2020 2020 2020 2020 2020 2020 206f                 o
-00029400: 7220 726f 6930 2e67 6574 5f73 7572 6661  r roi0.get_surfa
-00029410: 6365 5f64 6973 7461 6e63 655f 6d65 7472  ce_distance_metr
-00029420: 6963 7328 726f 692c 0a20 2020 2020 2020  ics(roi,.       
-00029430: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029440: 2076 6965 773d 7669 6577 2c20 666c 6174   view=view, flat
-00029450: 7465 6e3d 5472 7565 2929 0a20 2020 2020  ten=True)).     
-00029460: 2020 2020 2020 2020 2020 2069 6620 6d20             if m 
-00029470: 3d3d 2022 6d65 616e 5f73 7572 6661 6365  == "mean_surface
-00029480: 5f64 6973 7461 6e63 655f 666c 6174 223a  _distance_flat":
-00029490: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000294a0: 2020 2020 2063 6f6d 705b 6d5d 203d 2064       comp[m] = d
-000294b0: 6973 7461 6e63 6573 5f66 6c61 745b 305d  istances_flat[0]
-000294c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000294d0: 2065 6c69 6620 6d20 3d3d 2022 726d 735f   elif m == "rms_
-000294e0: 7375 7266 6163 655f 6469 7374 616e 6365  surface_distance
-000294f0: 5f66 6c61 7422 3a0a 2020 2020 2020 2020  _flat":.        
-00029500: 2020 2020 2020 2020 2020 2020 636f 6d70              comp
-00029510: 5b6d 5d20 3d20 6469 7374 616e 6365 735f  [m] = distances_
-00029520: 666c 6174 5b31 5d0a 2020 2020 2020 2020  flat[1].        
-00029530: 2020 2020 2020 2020 656c 6966 206d 203d          elif m =
-00029540: 3d20 2268 6175 7364 6f72 6666 5f64 6973  = "hausdorff_dis
-00029550: 7461 6e63 655f 666c 6174 223a 0a20 2020  tance_flat":.   
-00029560: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029570: 2063 6f6d 705b 6d5d 203d 2064 6973 7461   comp[m] = dista
-00029580: 6e63 6573 5f66 6c61 745b 325d 0a20 2020  nces_flat[2].   
-00029590: 2020 2020 2020 2020 2065 6c69 6620 6d20           elif m 
-000295a0: 696e 205b 226d 6561 6e5f 7369 676e 6564  in ["mean_signed
-000295b0: 5f73 7572 6661 6365 5f64 6973 7461 6e63  _surface_distanc
-000295c0: 6522 2c0a 2020 2020 2020 2020 2020 2020  e",.            
-000295d0: 2020 2020 2020 2020 2272 6d73 5f73 6967          "rms_sig
-000295e0: 6e65 645f 7375 7266 6163 655f 6469 7374  ned_surface_dist
-000295f0: 616e 6365 225d 3a0a 2020 2020 2020 2020  ance"]:.        
-00029600: 2020 2020 2020 2020 7369 676e 6564 5f64          signed_d
-00029610: 6973 7461 6e63 6573 203d 2028 7369 676e  istances = (sign
-00029620: 6564 5f64 6973 7461 6e63 6573 0a20 2020  ed_distances.   
-00029630: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029640: 2020 2020 206f 7220 726f 6930 2e67 6574       or roi0.get
-00029650: 5f73 7572 6661 6365 5f64 6973 7461 6e63  _surface_distanc
-00029660: 655f 6d65 7472 6963 7328 726f 692c 2073  e_metrics(roi, s
-00029670: 6967 6e65 643d 5472 7565 2929 0a20 2020  igned=True)).   
-00029680: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00029690: 6d20 3d3d 2022 6d65 616e 5f73 6967 6e65  m == "mean_signe
-000296a0: 645f 7375 7266 6163 655f 6469 7374 616e  d_surface_distan
-000296b0: 6365 223a 0a20 2020 2020 2020 2020 2020  ce":.           
-000296c0: 2020 2020 2020 2020 2063 6f6d 705b 6d5d           comp[m]
-000296d0: 203d 2073 6967 6e65 645f 6469 7374 616e   = signed_distan
-000296e0: 6365 735b 305d 0a20 2020 2020 2020 2020  ces[0].         
-000296f0: 2020 2020 2020 2065 6c69 6620 6d20 3d3d         elif m ==
-00029700: 2022 726d 735f 7369 676e 6564 5f73 7572   "rms_signed_sur
-00029710: 6661 6365 5f64 6973 7461 6e63 6522 3a0a  face_distance":.
-00029720: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029730: 2020 2020 636f 6d70 5b6d 5d20 3d20 7369      comp[m] = si
-00029740: 676e 6564 5f64 6973 7461 6e63 6573 5b31  gned_distances[1
-00029750: 5d0a 2020 2020 2020 2020 2020 2020 656c  ].            el
-00029760: 6966 206d 2069 6e20 5b22 6d65 616e 5f73  if m in ["mean_s
-00029770: 6967 6e65 645f 7375 7266 6163 655f 6469  igned_surface_di
-00029780: 7374 616e 6365 5f66 6c61 7422 2c0a 2020  stance_flat",.  
-00029790: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000297a0: 2020 2272 6d73 5f73 6967 6e65 645f 7375    "rms_signed_su
-000297b0: 7266 6163 655f 6469 7374 616e 6365 5f66  rface_distance_f
-000297c0: 6c61 7422 5d3a 0a20 2020 2020 2020 2020  lat"]:.         
-000297d0: 2020 2020 2020 2073 6967 6e65 645f 6469         signed_di
-000297e0: 7374 616e 6365 735f 666c 6174 203d 2028  stances_flat = (
-000297f0: 7369 676e 6564 5f64 6973 7461 6e63 6573  signed_distances
-00029800: 5f66 6c61 740a 2020 2020 2020 2020 2020  _flat.          
-00029810: 2020 2020 2020 2020 2020 2020 2020 6f72                or
-00029820: 2072 6f69 302e 6765 745f 7375 7266 6163   roi0.get_surfac
-00029830: 655f 6469 7374 616e 6365 5f6d 6574 7269  e_distance_metri
-00029840: 6373 2872 6f69 2c20 7369 676e 6564 3d54  cs(roi, signed=T
-00029850: 7275 652c 0a20 2020 2020 2020 2020 2020  rue,.           
-00029860: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029870: 2076 6965 773d 7669 6577 2c20 666c 6174   view=view, flat
-00029880: 7465 6e3d 5472 7565 2929 0a20 2020 2020  ten=True)).     
-00029890: 2020 2020 2020 2020 2020 2069 6620 6d20             if m 
-000298a0: 3d3d 2022 6d65 616e 5f73 6967 6e65 645f  == "mean_signed_
-000298b0: 7375 7266 6163 655f 6469 7374 616e 6365  surface_distance
-000298c0: 5f66 6c61 7422 3a0a 2020 2020 2020 2020  _flat":.        
-000298d0: 2020 2020 2020 2020 2020 2020 636f 6d70              comp
-000298e0: 5b6d 5d20 3d20 7369 676e 6564 5f64 6973  [m] = signed_dis
-000298f0: 7461 6e63 6573 5f66 6c61 745b 305d 0a20  tances_flat[0]. 
-00029900: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-00029910: 6c69 6620 6d20 3d3d 2022 726d 735f 7369  lif m == "rms_si
-00029920: 676e 6564 5f73 7572 6661 6365 5f64 6973  gned_surface_dis
-00029930: 7461 6e63 655f 666c 6174 223a 0a20 2020  tance_flat":.   
-00029940: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029950: 2063 6f6d 705b 6d5d 203d 2073 6967 6e65   comp[m] = signe
-00029960: 645f 6469 7374 616e 6365 735f 666c 6174  d_distances_flat
-00029970: 5b31 5d0a 2020 2020 2020 2020 2020 2020  [1].            
-00029980: 656c 6966 206d 2069 6e20 5b22 6d65 616e  elif m in ["mean
-00029990: 5f75 6e64 6572 5f63 6f6e 746f 7572 696e  _under_contourin
-000299a0: 6722 2c20 226d 6561 6e5f 6f76 6572 5f63  g", "mean_over_c
-000299b0: 6f6e 746f 7572 696e 6722 2c0a 2020 2020  ontouring",.    
-000299c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000299d0: 226d 6561 6e5f 6469 7374 616e 6365 5f74  "mean_distance_t
-000299e0: 6f5f 636f 6e66 6f72 6d69 7479 225d 3a0a  o_conformity"]:.
-000299f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029a00: 636f 6e66 6f72 6d69 7479 203d 2028 636f  conformity = (co
-00029a10: 6e66 6f72 6d69 7479 0a20 2020 2020 2020  nformity.       
-00029a20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029a30: 206f 7220 726f 6930 2e67 6574 5f6d 6561   or roi0.get_mea
-00029a40: 6e5f 6469 7374 616e 6365 5f74 6f5f 636f  n_distance_to_co
-00029a50: 6e66 6f72 6d69 7479 280a 2020 2020 2020  nformity(.      
-00029a60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029a70: 2020 2020 2020 726f 692c 2076 6f6c 5f75        roi, vol_u
-00029a80: 6e69 7473 2929 0a20 2020 2020 2020 2020  nits)).         
-00029a90: 2020 2020 2020 2069 6620 6d20 3d3d 2022         if m == "
-00029aa0: 6d65 616e 5f75 6e64 6572 5f63 6f6e 746f  mean_under_conto
-00029ab0: 7572 696e 6722 3a0a 2020 2020 2020 2020  uring":.        
-00029ac0: 2020 2020 2020 2020 2020 2020 636f 6d70              comp
-00029ad0: 5b6d 5d20 3d20 636f 6e66 6f72 6d69 7479  [m] = conformity
-00029ae0: 2e6d 6561 6e5f 756e 6465 725f 636f 6e74  .mean_under_cont
-00029af0: 6f75 7269 6e67 0a20 2020 2020 2020 2020  ouring.         
-00029b00: 2020 2020 2020 2069 6620 6d20 3d3d 2022         if m == "
-00029b10: 6d65 616e 5f6f 7665 725f 636f 6e74 6f75  mean_over_contou
-00029b20: 7269 6e67 223a 0a20 2020 2020 2020 2020  ring":.         
-00029b30: 2020 2020 2020 2020 2020 2063 6f6d 705b             comp[
-00029b40: 6d5d 203d 2063 6f6e 666f 726d 6974 792e  m] = conformity.
-00029b50: 6d65 616e 5f6f 7665 725f 636f 6e74 6f75  mean_over_contou
-00029b60: 7269 6e67 0a20 2020 2020 2020 2020 2020  ring.           
-00029b70: 2020 2020 2069 6620 6d20 3d3d 2022 6d65       if m == "me
-00029b80: 616e 5f64 6973 7461 6e63 655f 746f 5f63  an_distance_to_c
-00029b90: 6f6e 666f 726d 6974 7922 3a0a 2020 2020  onformity":.    
-00029ba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029bb0: 636f 6d70 5b6d 5d20 3d20 636f 6e66 6f72  comp[m] = confor
-00029bc0: 6d69 7479 2e6d 6561 6e5f 6469 7374 616e  mity.mean_distan
-00029bd0: 6365 5f74 6f5f 636f 6e66 6f72 6d69 7479  ce_to_conformity
-00029be0: 0a20 2020 2020 2020 2020 2020 2065 6c69  .            eli
-00029bf0: 6620 6d20 696e 205b 226d 6561 6e5f 756e  f m in ["mean_un
-00029c00: 6465 725f 636f 6e74 6f75 7269 6e67 5f66  der_contouring_f
-00029c10: 6c61 7422 2c0a 2020 2020 2020 2020 2020  lat",.          
-00029c20: 2020 2020 2020 2020 2020 226d 6561 6e5f            "mean_
-00029c30: 6f76 6572 5f63 6f6e 746f 7572 696e 675f  over_contouring_
-00029c40: 666c 6174 222c 0a20 2020 2020 2020 2020  flat",.         
-00029c50: 2020 2020 2020 2020 2020 2022 6d65 616e             "mean
-00029c60: 5f64 6973 7461 6e63 655f 746f 5f63 6f6e  _distance_to_con
-00029c70: 666f 726d 6974 795f 666c 6174 225d 3a0a  formity_flat"]:.
-00029c80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029c90: 636f 6e66 6f72 6d69 7479 5f66 6c61 7420  conformity_flat 
-00029ca0: 3d20 2863 6f6e 666f 726d 6974 795f 666c  = (conformity_fl
-00029cb0: 6174 0a20 2020 2020 2020 2020 2020 2020  at.             
-00029cc0: 2020 2020 2020 2020 2020 206f 7220 726f             or ro
-00029cd0: 6930 2e67 6574 5f6d 6561 6e5f 6469 7374  i0.get_mean_dist
-00029ce0: 616e 6365 5f74 6f5f 636f 6e66 6f72 6d69  ance_to_conformi
-00029cf0: 7479 280a 2020 2020 2020 2020 2020 2020  ty(.            
-00029d00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029d10: 726f 692c 2076 6f6c 5f75 6e69 7473 2c20  roi, vol_units, 
-00029d20: 7669 6577 3d76 6965 772c 2066 6c61 7474  view=view, flatt
-00029d30: 656e 3d54 7275 6529 290a 2020 2020 2020  en=True)).      
-00029d40: 2020 2020 2020 2020 2020 6966 206d 203d            if m =
-00029d50: 3d20 226d 6561 6e5f 756e 6465 725f 636f  = "mean_under_co
-00029d60: 6e74 6f75 7269 6e67 5f66 6c61 7422 3a0a  ntouring_flat":.
+00028f80: 6465 6661 756c 745f 6279 5f73 6c69 6365  default_by_slice
+00028f90: 3d64 6566 6175 6c74 5f62 795f 736c 6963  =default_by_slic
+00028fa0: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
+00028fb0: 2020 2020 2020 206d 6574 686f 643d 6d65         method=me
+00028fc0: 7468 6f64 2c20 7669 6577 3d76 6965 7729  thod, view=view)
+00028fd0: 290a 0a20 2020 2020 2020 2020 2020 2065  )..            e
+00028fe0: 6c69 6620 6d20 3d3d 2022 6172 6561 5f72  lif m == "area_r
+00028ff0: 6174 696f 5f66 6c61 7422 3a0a 2020 2020  atio_flat":.    
+00029000: 2020 2020 2020 2020 2020 2020 636f 6d70              comp
+00029010: 5b6d 5d20 3d20 726f 6930 2e67 6574 5f61  [m] = roi0.get_a
+00029020: 7265 615f 7261 7469 6f28 0a20 2020 2020  rea_ratio(.     
+00029030: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00029040: 6f69 2c0a 2020 2020 2020 2020 2020 2020  oi,.            
+00029050: 2020 2020 2020 2020 7669 6577 3d76 6965          view=vie
+00029060: 772c 0a20 2020 2020 2020 2020 2020 2020  w,.             
+00029070: 2020 2020 2020 206d 6574 686f 643d 6d65         method=me
+00029080: 7468 6f64 2c0a 2020 2020 2020 2020 2020  thod,.          
+00029090: 2020 2020 2020 2020 2020 666c 6174 7465            flatte
+000290a0: 6e3d 5472 7565 2c0a 2020 2020 2020 2020  n=True,.        
+000290b0: 2020 2020 2020 2020 290a 0a20 2020 2020          )..     
+000290c0: 2020 2020 2020 2065 6c69 6620 6d20 3d3d         elif m ==
+000290d0: 2022 6172 6561 5f72 6174 696f 5f73 6c69   "area_ratio_sli
+000290e0: 6365 5f73 7461 7473 223a 0a20 2020 2020  ce_stats":.     
+000290f0: 2020 2020 2020 2020 2020 2063 6f6d 702e             comp.
+00029100: 7570 6461 7465 2872 6f69 302e 6765 745f  update(roi0.get_
+00029110: 736c 6963 655f 7374 6174 7328 726f 692c  slice_stats(roi,
+00029120: 206d 6574 7269 6373 3d22 6172 6561 5f72   metrics="area_r
+00029130: 6174 696f 222c 0a20 2020 2020 2020 2020  atio",.         
+00029140: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00029150: 6c69 6365 5f73 7461 7473 3d73 6c69 6365  lice_stats=slice
+00029160: 5f73 7461 7473 2c0a 2020 2020 2020 2020  _stats,.        
+00029170: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029180: 6465 6661 756c 745f 6279 5f73 6c69 6365  default_by_slice
+00029190: 3d64 6566 6175 6c74 5f62 795f 736c 6963  =default_by_slic
+000291a0: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
+000291b0: 2020 2020 2020 2020 2020 206d 6574 686f             metho
+000291c0: 643d 6d65 7468 6f64 2c20 7669 6577 3d76  d=method, view=v
+000291d0: 6965 7729 290a 0a20 2020 2020 2020 2020  iew))..         
+000291e0: 2020 2023 2053 7572 6661 6365 2064 6973     # Surface dis
+000291f0: 7461 6e63 6520 6d65 7472 6963 730a 2020  tance metrics.  
+00029200: 2020 2020 2020 2020 2020 656c 6966 206d            elif m
+00029210: 2069 6e20 5b22 6d65 616e 5f73 7572 6661   in ["mean_surfa
+00029220: 6365 5f64 6973 7461 6e63 6522 2c0a 2020  ce_distance",.  
+00029230: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029240: 2020 2272 6d73 5f73 7572 6661 6365 5f64    "rms_surface_d
+00029250: 6973 7461 6e63 6522 2c20 2268 6175 7364  istance", "hausd
+00029260: 6f72 6666 5f64 6973 7461 6e63 6522 5d3a  orff_distance"]:
+00029270: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00029280: 2064 6973 7461 6e63 6573 203d 2028 6469   distances = (di
+00029290: 7374 616e 6365 730a 2020 2020 2020 2020  stances.        
+000292a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000292b0: 6f72 2072 6f69 302e 6765 745f 7375 7266  or roi0.get_surf
+000292c0: 6163 655f 6469 7374 616e 6365 5f6d 6574  ace_distance_met
+000292d0: 7269 6373 2872 6f69 2929 0a20 2020 2020  rics(roi)).     
+000292e0: 2020 2020 2020 2020 2020 2069 6620 6d20             if m 
+000292f0: 3d3d 2022 6d65 616e 5f73 7572 6661 6365  == "mean_surface
+00029300: 5f64 6973 7461 6e63 6522 3a0a 2020 2020  _distance":.    
+00029310: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029320: 636f 6d70 5b6d 5d20 3d20 6469 7374 616e  comp[m] = distan
+00029330: 6365 735b 305d 0a20 2020 2020 2020 2020  ces[0].         
+00029340: 2020 2020 2020 2065 6c69 6620 6d20 3d3d         elif m ==
+00029350: 2022 726d 735f 7375 7266 6163 655f 6469   "rms_surface_di
+00029360: 7374 616e 6365 223a 0a20 2020 2020 2020  stance":.       
+00029370: 2020 2020 2020 2020 2020 2020 2063 6f6d               com
+00029380: 705b 6d5d 203d 2064 6973 7461 6e63 6573  p[m] = distances
+00029390: 5b31 5d0a 2020 2020 2020 2020 2020 2020  [1].            
+000293a0: 2020 2020 656c 6966 206d 203d 3d20 2268      elif m == "h
+000293b0: 6175 7364 6f72 6666 5f64 6973 7461 6e63  ausdorff_distanc
+000293c0: 6522 3a0a 2020 2020 2020 2020 2020 2020  e":.            
+000293d0: 2020 2020 2020 2020 636f 6d70 5b6d 5d20          comp[m] 
+000293e0: 3d20 6469 7374 616e 6365 735b 325d 0a20  = distances[2]. 
+000293f0: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
+00029400: 6d20 696e 205b 226d 6561 6e5f 7375 7266  m in ["mean_surf
+00029410: 6163 655f 6469 7374 616e 6365 5f66 6c61  ace_distance_fla
+00029420: 7422 2c0a 2020 2020 2020 2020 2020 2020  t",.            
+00029430: 2020 2020 2020 2020 2272 6d73 5f73 7572          "rms_sur
+00029440: 6661 6365 5f64 6973 7461 6e63 655f 666c  face_distance_fl
+00029450: 6174 222c 2022 6861 7573 646f 7266 665f  at", "hausdorff_
+00029460: 6469 7374 616e 6365 5f66 6c61 7422 5d3a  distance_flat"]:
+00029470: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00029480: 2064 6973 7461 6e63 6573 5f66 6c61 7420   distances_flat 
+00029490: 3d20 2864 6973 7461 6e63 6573 5f66 6c61  = (distances_fla
+000294a0: 740a 2020 2020 2020 2020 2020 2020 2020  t.              
+000294b0: 2020 2020 2020 2020 2020 6f72 2072 6f69            or roi
+000294c0: 302e 6765 745f 7375 7266 6163 655f 6469  0.get_surface_di
+000294d0: 7374 616e 6365 5f6d 6574 7269 6373 2872  stance_metrics(r
+000294e0: 6f69 2c0a 2020 2020 2020 2020 2020 2020  oi,.            
+000294f0: 2020 2020 2020 2020 2020 2020 7669 6577              view
+00029500: 3d76 6965 772c 2066 6c61 7474 656e 3d54  =view, flatten=T
+00029510: 7275 6529 290a 2020 2020 2020 2020 2020  rue)).          
+00029520: 2020 2020 2020 6966 206d 203d 3d20 226d        if m == "m
+00029530: 6561 6e5f 7375 7266 6163 655f 6469 7374  ean_surface_dist
+00029540: 616e 6365 5f66 6c61 7422 3a0a 2020 2020  ance_flat":.    
+00029550: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029560: 636f 6d70 5b6d 5d20 3d20 6469 7374 616e  comp[m] = distan
+00029570: 6365 735f 666c 6174 5b30 5d0a 2020 2020  ces_flat[0].    
+00029580: 2020 2020 2020 2020 2020 2020 656c 6966              elif
+00029590: 206d 203d 3d20 2272 6d73 5f73 7572 6661   m == "rms_surfa
+000295a0: 6365 5f64 6973 7461 6e63 655f 666c 6174  ce_distance_flat
+000295b0: 223a 0a20 2020 2020 2020 2020 2020 2020  ":.             
+000295c0: 2020 2020 2020 2063 6f6d 705b 6d5d 203d         comp[m] =
+000295d0: 2064 6973 7461 6e63 6573 5f66 6c61 745b   distances_flat[
+000295e0: 315d 0a20 2020 2020 2020 2020 2020 2020  1].             
+000295f0: 2020 2065 6c69 6620 6d20 3d3d 2022 6861     elif m == "ha
+00029600: 7573 646f 7266 665f 6469 7374 616e 6365  usdorff_distance
+00029610: 5f66 6c61 7422 3a0a 2020 2020 2020 2020  _flat":.        
+00029620: 2020 2020 2020 2020 2020 2020 636f 6d70              comp
+00029630: 5b6d 5d20 3d20 6469 7374 616e 6365 735f  [m] = distances_
+00029640: 666c 6174 5b32 5d0a 2020 2020 2020 2020  flat[2].        
+00029650: 2020 2020 656c 6966 206d 2069 6e20 5b22      elif m in ["
+00029660: 6d65 616e 5f73 6967 6e65 645f 7375 7266  mean_signed_surf
+00029670: 6163 655f 6469 7374 616e 6365 222c 0a20  ace_distance",. 
+00029680: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029690: 2020 2022 726d 735f 7369 676e 6564 5f73     "rms_signed_s
+000296a0: 7572 6661 6365 5f64 6973 7461 6e63 6522  urface_distance"
+000296b0: 5d3a 0a20 2020 2020 2020 2020 2020 2020  ]:.             
+000296c0: 2020 2073 6967 6e65 645f 6469 7374 616e     signed_distan
+000296d0: 6365 7320 3d20 2873 6967 6e65 645f 6469  ces = (signed_di
+000296e0: 7374 616e 6365 730a 2020 2020 2020 2020  stances.        
+000296f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029700: 6f72 2072 6f69 302e 6765 745f 7375 7266  or roi0.get_surf
+00029710: 6163 655f 6469 7374 616e 6365 5f6d 6574  ace_distance_met
+00029720: 7269 6373 2872 6f69 2c20 7369 676e 6564  rics(roi, signed
+00029730: 3d54 7275 6529 290a 2020 2020 2020 2020  =True)).        
+00029740: 2020 2020 2020 2020 6966 206d 203d 3d20          if m == 
+00029750: 226d 6561 6e5f 7369 676e 6564 5f73 7572  "mean_signed_sur
+00029760: 6661 6365 5f64 6973 7461 6e63 6522 3a0a  face_distance":.
+00029770: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029780: 2020 2020 636f 6d70 5b6d 5d20 3d20 7369      comp[m] = si
+00029790: 676e 6564 5f64 6973 7461 6e63 6573 5b30  gned_distances[0
+000297a0: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
+000297b0: 2020 656c 6966 206d 203d 3d20 2272 6d73    elif m == "rms
+000297c0: 5f73 6967 6e65 645f 7375 7266 6163 655f  _signed_surface_
+000297d0: 6469 7374 616e 6365 223a 0a20 2020 2020  distance":.     
+000297e0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+000297f0: 6f6d 705b 6d5d 203d 2073 6967 6e65 645f  omp[m] = signed_
+00029800: 6469 7374 616e 6365 735b 315d 0a20 2020  distances[1].   
+00029810: 2020 2020 2020 2020 2065 6c69 6620 6d20           elif m 
+00029820: 696e 205b 226d 6561 6e5f 7369 676e 6564  in ["mean_signed
+00029830: 5f73 7572 6661 6365 5f64 6973 7461 6e63  _surface_distanc
+00029840: 655f 666c 6174 222c 0a20 2020 2020 2020  e_flat",.       
+00029850: 2020 2020 2020 2020 2020 2020 2022 726d               "rm
+00029860: 735f 7369 676e 6564 5f73 7572 6661 6365  s_signed_surface
+00029870: 5f64 6973 7461 6e63 655f 666c 6174 225d  _distance_flat"]
+00029880: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00029890: 2020 7369 676e 6564 5f64 6973 7461 6e63    signed_distanc
+000298a0: 6573 5f66 6c61 7420 3d20 2873 6967 6e65  es_flat = (signe
+000298b0: 645f 6469 7374 616e 6365 735f 666c 6174  d_distances_flat
+000298c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000298d0: 2020 2020 2020 2020 206f 7220 726f 6930           or roi0
+000298e0: 2e67 6574 5f73 7572 6661 6365 5f64 6973  .get_surface_dis
+000298f0: 7461 6e63 655f 6d65 7472 6963 7328 726f  tance_metrics(ro
+00029900: 692c 2073 6967 6e65 643d 5472 7565 2c0a  i, signed=True,.
+00029910: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029920: 2020 2020 2020 2020 2020 2020 7669 6577              view
+00029930: 3d76 6965 772c 2066 6c61 7474 656e 3d54  =view, flatten=T
+00029940: 7275 6529 290a 2020 2020 2020 2020 2020  rue)).          
+00029950: 2020 2020 2020 6966 206d 203d 3d20 226d        if m == "m
+00029960: 6561 6e5f 7369 676e 6564 5f73 7572 6661  ean_signed_surfa
+00029970: 6365 5f64 6973 7461 6e63 655f 666c 6174  ce_distance_flat
+00029980: 223a 0a20 2020 2020 2020 2020 2020 2020  ":.             
+00029990: 2020 2020 2020 2063 6f6d 705b 6d5d 203d         comp[m] =
+000299a0: 2073 6967 6e65 645f 6469 7374 616e 6365   signed_distance
+000299b0: 735f 666c 6174 5b30 5d0a 2020 2020 2020  s_flat[0].      
+000299c0: 2020 2020 2020 2020 2020 656c 6966 206d            elif m
+000299d0: 203d 3d20 2272 6d73 5f73 6967 6e65 645f   == "rms_signed_
+000299e0: 7375 7266 6163 655f 6469 7374 616e 6365  surface_distance
+000299f0: 5f66 6c61 7422 3a0a 2020 2020 2020 2020  _flat":.        
+00029a00: 2020 2020 2020 2020 2020 2020 636f 6d70              comp
+00029a10: 5b6d 5d20 3d20 7369 676e 6564 5f64 6973  [m] = signed_dis
+00029a20: 7461 6e63 6573 5f66 6c61 745b 315d 0a20  tances_flat[1]. 
+00029a30: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
+00029a40: 6d20 696e 205b 226d 6561 6e5f 756e 6465  m in ["mean_unde
+00029a50: 725f 636f 6e74 6f75 7269 6e67 222c 2022  r_contouring", "
+00029a60: 6d65 616e 5f6f 7665 725f 636f 6e74 6f75  mean_over_contou
+00029a70: 7269 6e67 222c 0a20 2020 2020 2020 2020  ring",.         
+00029a80: 2020 2020 2020 2020 2020 2022 6d65 616e             "mean
+00029a90: 5f64 6973 7461 6e63 655f 746f 5f63 6f6e  _distance_to_con
+00029aa0: 666f 726d 6974 7922 5d3a 0a20 2020 2020  formity"]:.     
+00029ab0: 2020 2020 2020 2020 2020 2063 6f6e 666f             confo
+00029ac0: 726d 6974 7920 3d20 2863 6f6e 666f 726d  rmity = (conform
+00029ad0: 6974 790a 2020 2020 2020 2020 2020 2020  ity.            
+00029ae0: 2020 2020 2020 2020 2020 2020 6f72 2072              or r
+00029af0: 6f69 302e 6765 745f 6d65 616e 5f64 6973  oi0.get_mean_dis
+00029b00: 7461 6e63 655f 746f 5f63 6f6e 666f 726d  tance_to_conform
+00029b10: 6974 7928 0a20 2020 2020 2020 2020 2020  ity(.           
+00029b20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029b30: 2072 6f69 2c20 766f 6c5f 756e 6974 7329   roi, vol_units)
+00029b40: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00029b50: 2020 6966 206d 203d 3d20 226d 6561 6e5f    if m == "mean_
+00029b60: 756e 6465 725f 636f 6e74 6f75 7269 6e67  under_contouring
+00029b70: 223a 0a20 2020 2020 2020 2020 2020 2020  ":.             
+00029b80: 2020 2020 2020 2063 6f6d 705b 6d5d 203d         comp[m] =
+00029b90: 2063 6f6e 666f 726d 6974 792e 6d65 616e   conformity.mean
+00029ba0: 5f75 6e64 6572 5f63 6f6e 746f 7572 696e  _under_contourin
+00029bb0: 670a 2020 2020 2020 2020 2020 2020 2020  g.              
+00029bc0: 2020 6966 206d 203d 3d20 226d 6561 6e5f    if m == "mean_
+00029bd0: 6f76 6572 5f63 6f6e 746f 7572 696e 6722  over_contouring"
+00029be0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00029bf0: 2020 2020 2020 636f 6d70 5b6d 5d20 3d20        comp[m] = 
+00029c00: 636f 6e66 6f72 6d69 7479 2e6d 6561 6e5f  conformity.mean_
+00029c10: 6f76 6572 5f63 6f6e 746f 7572 696e 670a  over_contouring.
+00029c20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029c30: 6966 206d 203d 3d20 226d 6561 6e5f 6469  if m == "mean_di
+00029c40: 7374 616e 6365 5f74 6f5f 636f 6e66 6f72  stance_to_confor
+00029c50: 6d69 7479 223a 0a20 2020 2020 2020 2020  mity":.         
+00029c60: 2020 2020 2020 2020 2020 2063 6f6d 705b             comp[
+00029c70: 6d5d 203d 2063 6f6e 666f 726d 6974 792e  m] = conformity.
+00029c80: 6d65 616e 5f64 6973 7461 6e63 655f 746f  mean_distance_to
+00029c90: 5f63 6f6e 666f 726d 6974 790a 2020 2020  _conformity.    
+00029ca0: 2020 2020 2020 2020 656c 6966 206d 2069          elif m i
+00029cb0: 6e20 5b22 6d65 616e 5f75 6e64 6572 5f63  n ["mean_under_c
+00029cc0: 6f6e 746f 7572 696e 675f 666c 6174 222c  ontouring_flat",
+00029cd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00029ce0: 2020 2020 2022 6d65 616e 5f6f 7665 725f       "mean_over_
+00029cf0: 636f 6e74 6f75 7269 6e67 5f66 6c61 7422  contouring_flat"
+00029d00: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00029d10: 2020 2020 2020 226d 6561 6e5f 6469 7374        "mean_dist
+00029d20: 616e 6365 5f74 6f5f 636f 6e66 6f72 6d69  ance_to_conformi
+00029d30: 7479 5f66 6c61 7422 5d3a 0a20 2020 2020  ty_flat"]:.     
+00029d40: 2020 2020 2020 2020 2020 2063 6f6e 666f             confo
+00029d50: 726d 6974 795f 666c 6174 203d 2028 636f  rmity_flat = (co
+00029d60: 6e66 6f72 6d69 7479 5f66 6c61 740a 2020  nformity_flat.  
 00029d70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029d80: 2020 2020 636f 6d70 5b6d 5d20 3d20 636f      comp[m] = co
-00029d90: 6e66 6f72 6d69 7479 5f66 6c61 742e 6d65  nformity_flat.me
-00029da0: 616e 5f75 6e64 6572 5f63 6f6e 746f 7572  an_under_contour
-00029db0: 696e 670a 2020 2020 2020 2020 2020 2020  ing.            
-00029dc0: 2020 2020 6966 206d 203d 3d20 226d 6561      if m == "mea
-00029dd0: 6e5f 6f76 6572 5f63 6f6e 746f 7572 696e  n_over_contourin
-00029de0: 675f 666c 6174 223a 0a20 2020 2020 2020  g_flat":.       
-00029df0: 2020 2020 2020 2020 2020 2020 2063 6f6d               com
-00029e00: 705b 6d5d 203d 2063 6f6e 666f 726d 6974  p[m] = conformit
-00029e10: 795f 666c 6174 2e6d 6561 6e5f 6f76 6572  y_flat.mean_over
-00029e20: 5f63 6f6e 746f 7572 696e 670a 2020 2020  _contouring.    
-00029e30: 2020 2020 2020 2020 2020 2020 6966 206d              if m
-00029e40: 203d 3d20 226d 6561 6e5f 6469 7374 616e   == "mean_distan
-00029e50: 6365 5f74 6f5f 636f 6e66 6f72 6d69 7479  ce_to_conformity
-00029e60: 5f66 6c61 7422 3a0a 2020 2020 2020 2020  _flat":.        
-00029e70: 2020 2020 2020 2020 2020 2020 636f 6d70              comp
-00029e80: 5b6d 5d20 3d20 636f 6e66 6f72 6d69 7479  [m] = conformity
-00029e90: 5f66 6c61 742e 6d65 616e 5f64 6973 7461  _flat.mean_dista
-00029ea0: 6e63 655f 746f 5f63 6f6e 666f 726d 6974  nce_to_conformit
-00029eb0: 790a 2020 2020 2020 2020 2020 2020 656c  y.            el
-00029ec0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-00029ed0: 2020 2020 2320 5468 6973 2063 6f64 6520      # This code 
-00029ee0: 626c 6f63 6b20 6361 6e20 6265 2072 6561  block can be rea
-00029ef0: 6368 6564 2069 6620 7468 6973 206d 6574  ched if this met
-00029f00: 686f 6420 646f 6573 6e27 7420 6861 6e64  hod doesn't hand
-00029f10: 6c65 0a20 2020 2020 2020 2020 2020 2020  le.             
-00029f20: 2020 2023 2061 206d 6574 7269 6320 7468     # a metric th
-00029f30: 6174 2773 206c 6973 7465 6420 6279 2067  at's listed by g
-00029f40: 6574 5f63 6f6d 7061 7269 736f 6e5f 6d65  et_comparison_me
-00029f50: 7472 6963 7328 292e 0a20 2020 2020 2020  trics()..       
-00029f60: 2020 2020 2020 2020 2066 6f75 6e64 203d           found =
-00029f70: 2046 616c 7365 0a0a 2020 2020 2020 2020   False..        
-00029f80: 2020 2020 2020 2020 2320 4178 6973 2d73          # Axis-s
-00029f90: 7065 6369 6669 6320 6d65 7472 6963 730a  pecific metrics.
-00029fa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029fb0: 666f 7220 692c 2061 7820 696e 2065 6e75  for i, ax in enu
-00029fc0: 6d65 7261 7465 2873 6b72 742e 696d 6167  merate(skrt.imag
-00029fd0: 652e 5f61 7865 7329 3a0a 0a20 2020 2020  e._axes):..     
-00029fe0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-00029ff0: 2047 6c6f 6261 6c20 6365 6e74 726f 6964   Global centroid
-0002a000: 2070 6f73 6974 696f 6e20 6f6e 2061 2067   position on a g
-0002a010: 6976 656e 2061 7869 730a 2020 2020 2020  iven axis.      
-0002a020: 2020 2020 2020 2020 2020 2020 2020 6966                if
-0002a030: 206d 203d 3d20 6622 6365 6e74 726f 6964   m == f"centroid
-0002a040: 5f7b 6178 7d22 3a0a 2020 2020 2020 2020  _{ax}":.        
-0002a050: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a060: 636f 6d70 5b6d 5d20 3d20 726f 6930 2e67  comp[m] = roi0.g
-0002a070: 6574 5f61 6273 5f63 656e 7472 6f69 645f  et_abs_centroid_
-0002a080: 6469 7374 616e 6365 280a 2020 2020 2020  distance(.      
-0002a090: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a0a0: 2020 2020 2020 726f 692c 0a20 2020 2020        roi,.     
-0002a0b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a0c0: 2020 2020 2020 2075 6e69 7473 3d63 656e         units=cen
-0002a0d0: 7472 6f69 645f 756e 6974 732c 0a20 2020  troid_units,.   
-0002a0e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a0f0: 2020 2020 2020 2020 206d 6574 686f 643d           method=
-0002a100: 6d65 7468 6f64 2c0a 2020 2020 2020 2020  method,.        
-0002a110: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a120: 2020 2020 666f 7263 653d 666f 7263 650a      force=force.
-0002a130: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a140: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+00029d80: 2020 2020 2020 6f72 2072 6f69 302e 6765        or roi0.ge
+00029d90: 745f 6d65 616e 5f64 6973 7461 6e63 655f  t_mean_distance_
+00029da0: 746f 5f63 6f6e 666f 726d 6974 7928 0a20  to_conformity(. 
+00029db0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029dc0: 2020 2020 2020 2020 2020 2072 6f69 2c20             roi, 
+00029dd0: 766f 6c5f 756e 6974 732c 2076 6965 773d  vol_units, view=
+00029de0: 7669 6577 2c20 666c 6174 7465 6e3d 5472  view, flatten=Tr
+00029df0: 7565 2929 0a20 2020 2020 2020 2020 2020  ue)).           
+00029e00: 2020 2020 2069 6620 6d20 3d3d 2022 6d65       if m == "me
+00029e10: 616e 5f75 6e64 6572 5f63 6f6e 746f 7572  an_under_contour
+00029e20: 696e 675f 666c 6174 223a 0a20 2020 2020  ing_flat":.     
+00029e30: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+00029e40: 6f6d 705b 6d5d 203d 2063 6f6e 666f 726d  omp[m] = conform
+00029e50: 6974 795f 666c 6174 2e6d 6561 6e5f 756e  ity_flat.mean_un
+00029e60: 6465 725f 636f 6e74 6f75 7269 6e67 0a20  der_contouring. 
+00029e70: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00029e80: 6620 6d20 3d3d 2022 6d65 616e 5f6f 7665  f m == "mean_ove
+00029e90: 725f 636f 6e74 6f75 7269 6e67 5f66 6c61  r_contouring_fla
+00029ea0: 7422 3a0a 2020 2020 2020 2020 2020 2020  t":.            
+00029eb0: 2020 2020 2020 2020 636f 6d70 5b6d 5d20          comp[m] 
+00029ec0: 3d20 636f 6e66 6f72 6d69 7479 5f66 6c61  = conformity_fla
+00029ed0: 742e 6d65 616e 5f6f 7665 725f 636f 6e74  t.mean_over_cont
+00029ee0: 6f75 7269 6e67 0a20 2020 2020 2020 2020  ouring.         
+00029ef0: 2020 2020 2020 2069 6620 6d20 3d3d 2022         if m == "
+00029f00: 6d65 616e 5f64 6973 7461 6e63 655f 746f  mean_distance_to
+00029f10: 5f63 6f6e 666f 726d 6974 795f 666c 6174  _conformity_flat
+00029f20: 223a 0a20 2020 2020 2020 2020 2020 2020  ":.             
+00029f30: 2020 2020 2020 2063 6f6d 705b 6d5d 203d         comp[m] =
+00029f40: 2063 6f6e 666f 726d 6974 795f 666c 6174   conformity_flat
+00029f50: 2e6d 6561 6e5f 6469 7374 616e 6365 5f74  .mean_distance_t
+00029f60: 6f5f 636f 6e66 6f72 6d69 7479 0a20 2020  o_conformity.   
+00029f70: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+00029f80: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+00029f90: 2054 6869 7320 636f 6465 2062 6c6f 636b   This code block
+00029fa0: 2063 616e 2062 6520 7265 6163 6865 6420   can be reached 
+00029fb0: 6966 2074 6869 7320 6d65 7468 6f64 2064  if this method d
+00029fc0: 6f65 736e 2774 2068 616e 646c 650a 2020  oesn't handle.  
+00029fd0: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+00029fe0: 6120 6d65 7472 6963 2074 6861 7427 7320  a metric that's 
+00029ff0: 6c69 7374 6564 2062 7920 6765 745f 636f  listed by get_co
+0002a000: 6d70 6172 6973 6f6e 5f6d 6574 7269 6373  mparison_metrics
+0002a010: 2829 2e0a 2020 2020 2020 2020 2020 2020  ()..            
+0002a020: 2020 2020 666f 756e 6420 3d20 4661 6c73      found = Fals
+0002a030: 650a 0a20 2020 2020 2020 2020 2020 2020  e..             
+0002a040: 2020 2023 2041 7869 732d 7370 6563 6966     # Axis-specif
+0002a050: 6963 206d 6574 7269 6373 0a20 2020 2020  ic metrics.     
+0002a060: 2020 2020 2020 2020 2020 2066 6f72 2069             for i
+0002a070: 2c20 6178 2069 6e20 656e 756d 6572 6174  , ax in enumerat
+0002a080: 6528 736b 7274 2e69 6d61 6765 2e5f 6178  e(skrt.image._ax
+0002a090: 6573 293a 0a0a 2020 2020 2020 2020 2020  es):..          
+0002a0a0: 2020 2020 2020 2020 2020 2320 476c 6f62            # Glob
+0002a0b0: 616c 2063 656e 7472 6f69 6420 706f 7369  al centroid posi
+0002a0c0: 7469 6f6e 206f 6e20 6120 6769 7665 6e20  tion on a given 
+0002a0d0: 6178 6973 0a20 2020 2020 2020 2020 2020  axis.           
+0002a0e0: 2020 2020 2020 2020 2069 6620 6d20 3d3d           if m ==
+0002a0f0: 2066 2263 656e 7472 6f69 645f 7b61 787d   f"centroid_{ax}
+0002a100: 223a 0a20 2020 2020 2020 2020 2020 2020  ":.             
+0002a110: 2020 2020 2020 2020 2020 2063 6f6d 705b             comp[
+0002a120: 6d5d 203d 2072 6f69 302e 6765 745f 6162  m] = roi0.get_ab
+0002a130: 735f 6365 6e74 726f 6964 5f64 6973 7461  s_centroid_dista
+0002a140: 6e63 6528 0a20 2020 2020 2020 2020 2020  nce(.           
 0002a150: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a160: 2020 666f 756e 6420 3d20 5472 7565 0a0a    found = True..
+0002a160: 2072 6f69 2c0a 2020 2020 2020 2020 2020   roi,.          
 0002a170: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a180: 6966 206e 6f74 2066 6f75 6e64 3a0a 2020  if not found:.  
-0002a190: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a1a0: 2020 7261 6973 6520 5275 6e74 696d 6545    raise RuntimeE
-0002a1b0: 7272 6f72 2866 224d 6574 7269 6320 7b6d  rror(f"Metric {m
-0002a1c0: 7d20 6e6f 7420 7265 636f 676e 6973 6564  } not recognised
-0002a1d0: 2062 7920 220a 2020 2020 2020 2020 2020   by ".          
-0002a1e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a1f0: 2020 2020 2020 2020 2020 2020 2022 524f               "RO
-0002a200: 492e 6765 745f 636f 6d70 6172 6973 6f6e  I.get_comparison
-0002a210: 2829 2229 0a0a 2020 2020 2020 2020 2320  ()")..        # 
-0002a220: 4164 6420 756e 6974 7320 746f 206d 6574  Add units to met
-0002a230: 7269 6320 6e61 6d65 7320 6966 2072 6571  ric names if req
-0002a240: 7565 7374 6564 0a20 2020 2020 2020 2063  uested.        c
-0002a250: 6f6d 705f 6e61 6d65 6420 3d20 7b7d 0a20  omp_named = {}. 
-0002a260: 2020 2020 2020 2069 6620 6e6f 7420 756e         if not un
-0002a270: 6974 735f 696e 5f68 6561 6465 723a 0a20  its_in_header:. 
-0002a280: 2020 2020 2020 2020 2020 2063 6f6d 705f             comp_
-0002a290: 6e61 6d65 6420 3d20 636f 6d70 0a20 2020  named = comp.   
-0002a2a0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-0002a2b0: 2020 2020 2020 2066 6f72 206d 6574 7269         for metri
-0002a2c0: 632c 2076 616c 2069 6e20 636f 6d70 2e69  c, val in comp.i
-0002a2d0: 7465 6d73 2829 3a0a 2020 2020 2020 2020  tems():.        
-0002a2e0: 2020 2020 2020 2020 6e61 6d65 203d 206d          name = m
-0002a2f0: 6574 7269 630a 2020 2020 2020 2020 2020  etric.          
-0002a300: 2020 2020 2020 6966 206d 6574 7269 6320        if metric 
-0002a310: 3d3d 2022 766f 6c75 6d65 5f64 6966 6622  == "volume_diff"
-0002a320: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0002a330: 2020 2020 2020 6966 2076 6f6c 5f75 6e69        if vol_uni
-0002a340: 7473 203d 3d20 226d 6d22 3a0a 2020 2020  ts == "mm":.    
-0002a350: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a360: 2020 2020 6e61 6d65 202b 3d20 2220 286d      name += " (m
-0002a370: 6d5e 3329 220a 2020 2020 2020 2020 2020  m^3)".          
-0002a380: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
-0002a390: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a3a0: 2020 2020 2020 2020 6e61 6d65 202b 3d20          name += 
-0002a3b0: 2220 2822 202b 2076 6f6c 5f75 6e69 7473  " (" + vol_units
-0002a3c0: 202b 2022 2922 0a20 2020 2020 2020 2020   + ")".         
-0002a3d0: 2020 2020 2020 2065 6c69 6620 6d65 7472         elif metr
-0002a3e0: 6963 203d 3d20 2261 7265 615f 6469 6666  ic == "area_diff
-0002a3f0: 223a 0a20 2020 2020 2020 2020 2020 2020  ":.             
-0002a400: 2020 2020 2020 2069 6620 6172 6561 5f75         if area_u
-0002a410: 6e69 7473 203d 3d20 226d 6d22 3a0a 2020  nits == "mm":.  
-0002a420: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a430: 2020 2020 2020 6e61 6d65 202b 3d20 2220        name += " 
-0002a440: 286d 6d5e 3229 220a 2020 2020 2020 2020  (mm^2)".        
-0002a450: 2020 2020 2020 2020 2020 2020 656c 7365              else
-0002a460: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0002a470: 2020 2020 2020 2020 2020 6e61 6d65 202b            name +
-0002a480: 3d20 2220 2822 202b 2061 7265 615f 756e  = " (" + area_un
-0002a490: 6974 7320 2b20 2229 220a 2020 2020 2020  its + ")".      
-0002a4a0: 2020 2020 2020 2020 2020 656c 6966 2022            elif "
-0002a4b0: 6365 6e74 726f 6964 2220 696e 206d 6574  centroid" in met
-0002a4c0: 7269 633a 0a20 2020 2020 2020 2020 2020  ric:.           
-0002a4d0: 2020 2020 2020 2020 206e 616d 6520 2b3d           name +=
-0002a4e0: 2022 2028 2220 2b20 6365 6e74 726f 6964   " (" + centroid
-0002a4f0: 5f75 6e69 7473 202b 2022 2922 0a20 2020  _units + ")".   
-0002a500: 2020 2020 2020 2020 2020 2020 2063 6f6d               com
-0002a510: 705f 6e61 6d65 645b 6e61 6d65 5d20 3d20  p_named[name] = 
-0002a520: 7661 6c0a 0a20 2020 2020 2020 2023 2041  val..        # A
-0002a530: 646a 7573 7420 6e75 6d62 6572 206f 6620  djust number of 
-0002a540: 6465 6369 6d61 6c20 706c 6163 6573 0a20  decimal places. 
-0002a550: 2020 2020 2020 2069 6620 6465 6369 6d61         if decima
-0002a560: 6c5f 706c 6163 6573 2069 7320 6e6f 7420  l_places is not 
-0002a570: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-0002a580: 2020 666f 7220 6d65 7472 6963 2c20 7661    for metric, va
-0002a590: 6c20 696e 2063 6f6d 705f 6e61 6d65 642e  l in comp_named.
-0002a5a0: 6974 656d 7328 293a 0a20 2020 2020 2020  items():.       
-0002a5b0: 2020 2020 2020 2020 2066 6d74 203d 2066           fmt = f
-0002a5c0: 227b 7b76 616c 3a2e 7b64 6563 696d 616c  "{{val:.{decimal
-0002a5d0: 5f70 6c61 6365 737d 667d 7d22 0a20 2020  _places}f}}".   
-0002a5e0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-0002a5f0: 636f 6d70 5f6e 616d 6564 5b6d 6574 7269  comp_named[metri
-0002a600: 635d 2069 7320 6e6f 7420 4e6f 6e65 3a0a  c] is not None:.
-0002a610: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a620: 2020 2020 636f 6d70 5f6e 616d 6564 5b6d      comp_named[m
-0002a630: 6574 7269 635d 203d 2066 6c6f 6174 2866  etric] = float(f
-0002a640: 6d74 2e66 6f72 6d61 7428 7661 6c3d 7661  mt.format(val=va
-0002a650: 6c29 290a 0a20 2020 2020 2020 2023 2043  l))..        # C
-0002a660: 6f6e 7665 7274 2074 6f20 7061 6e64 6173  onvert to pandas
-0002a670: 2044 6174 6146 7261 6d65 0a20 2020 2020   DataFrame.     
-0002a680: 2020 2064 6620 3d20 7064 2e44 6174 6146     df = pd.DataF
-0002a690: 7261 6d65 2863 6f6d 705f 6e61 6d65 642c  rame(comp_named,
-0002a6a0: 2069 6e64 6578 3d5b 726f 6930 2e6e 616d   index=[roi0.nam
-0002a6b0: 655d 290a 0a20 2020 2020 2020 2023 2043  e])..        # C
-0002a6c0: 6170 6974 616c 697a 6520 636f 6c75 6d6e  apitalize column
-0002a6d0: 206e 616d 6573 2061 6e64 2072 656d 6f76   names and remov
-0002a6e0: 6520 756e 6465 7273 636f 7265 7320 6966  e underscores if
-0002a6f0: 2072 6571 7565 7374 6564 0a20 2020 2020   requested.     
-0002a700: 2020 2069 6620 6e69 6365 5f63 6f6c 756d     if nice_colum
-0002a710: 6e73 2061 6e64 206e 6f74 2067 6c6f 6261  ns and not globa
-0002a720: 6c5f 7673 5f73 6c69 6365 5f68 6561 6465  l_vs_slice_heade
-0002a730: 723a 0a20 2020 2020 2020 2020 2020 2064  r:.            d
-0002a740: 662e 636f 6c75 6d6e 7320 3d20 5b63 6f6c  f.columns = [col
-0002a750: 2e63 6170 6974 616c 697a 6528 292e 7265  .capitalize().re
-0002a760: 706c 6163 6528 225f 222c 2022 2022 292e  place("_", " ").
-0002a770: 7265 706c 6163 6528 2272 6d73 222c 2022  replace("rms", "
-0002a780: 524d 5322 290a 2020 2020 2020 2020 2020  RMS").          
-0002a790: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a7a0: 666f 7220 636f 6c20 696e 2064 662e 636f  for col in df.co
-0002a7b0: 6c75 6d6e 735d 0a0a 2020 2020 2020 2020  lumns]..        
-0002a7c0: 2320 5475 726e 206e 616d 6520 696e 746f  # Turn name into
-0002a7d0: 2061 2072 6567 756c 6172 2063 6f6c 756d   a regular colum
-0002a7e0: 6e20 6966 2072 6571 7565 7374 6564 0a20  n if requested. 
-0002a7f0: 2020 2020 2020 2069 6620 6e6f 7420 6e61         if not na
-0002a800: 6d65 5f61 735f 696e 6465 783a 0a20 2020  me_as_index:.   
-0002a810: 2020 2020 2020 2020 2064 6620 3d20 6466           df = df
-0002a820: 2e72 6573 6574 5f69 6e64 6578 2829 2e72  .reset_index().r
-0002a830: 656e 616d 6528 7b22 696e 6465 7822 3a20  ename({"index": 
-0002a840: 2252 4f49 227d 2c20 6178 6973 3d31 290a  "ROI"}, axis=1).
-0002a850: 0a20 2020 2020 2020 2023 2041 6464 2067  .        # Add g
-0002a860: 6c6f 6261 6c2f 736c 6963 6520 6865 6164  lobal/slice head
-0002a870: 6572 730a 2020 2020 2020 2020 6966 2067  ers.        if g
-0002a880: 6c6f 6261 6c5f 7673 5f73 6c69 6365 5f68  lobal_vs_slice_h
-0002a890: 6561 6465 723a 0a0a 2020 2020 2020 2020  eader:..        
-0002a8a0: 2020 2020 2320 536f 7274 2063 6f6c 756d      # Sort colum
-0002a8b0: 6e73 2069 6e74 6f20 676c 6f62 616c 206f  ns into global o
-0002a8c0: 7220 736c 6963 650a 2020 2020 2020 2020  r slice.        
-0002a8d0: 2020 2020 6865 6164 6572 7320 3d20 5b5d      headers = []
-0002a8e0: 0a20 2020 2020 2020 2020 2020 2073 6c69  .            sli
-0002a8f0: 6365 5f63 6f6c 7320 3d20 5b5d 0a20 2020  ce_cols = [].   
-0002a900: 2020 2020 2020 2020 2067 6c6f 6261 6c5f           global_
-0002a910: 636f 6c73 203d 205b 5d0a 2020 2020 2020  cols = [].      
-0002a920: 2020 2020 2020 736c 6963 655f 6e61 6d65        slice_name
-0002a930: 203d 2022 736c 6963 6522 2069 6620 6e6f   = "slice" if no
-0002a940: 7420 6e69 6365 5f63 6f6c 756d 6e73 2065  t nice_columns e
-0002a950: 6c73 6520 2253 6c69 6365 220a 2020 2020  lse "Slice".    
-0002a960: 2020 2020 2020 2020 676c 6f62 616c 5f6e          global_n
-0002a970: 616d 6520 3d20 2267 6c6f 6261 6c22 2069  ame = "global" i
-0002a980: 6620 6e6f 7420 6e69 6365 5f63 6f6c 756d  f not nice_colum
-0002a990: 6e73 2065 6c73 6520 2247 6c6f 6261 6c22  ns else "Global"
-0002a9a0: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
-0002a9b0: 206d 6574 7269 6320 696e 2063 6f6d 705f   metric in comp_
-0002a9c0: 6e61 6d65 643a 0a20 2020 2020 2020 2020  named:.         
-0002a9d0: 2020 2020 2020 2069 6620 2273 6c69 6365         if "slice
-0002a9e0: 2220 696e 206d 6574 7269 6320 6f72 205c  " in metric or \
-0002a9f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0002aa00: 2020 2020 2822 6172 6561 2220 696e 206d      ("area" in m
-0002aa10: 6574 7269 6320 616e 6420 2266 6c61 7422  etric and "flat"
-0002aa20: 206e 6f74 2069 6e20 6d65 7472 6963 293a   not in metric):
-0002aa30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0002aa40: 2020 2020 2068 6561 6465 7273 2e61 7070       headers.app
-0002aa50: 656e 6428 2873 6c69 6365 5f6e 616d 652c  end((slice_name,
-0002aa60: 206d 6574 7269 6329 290a 2020 2020 2020   metric)).      
-0002aa70: 2020 2020 2020 2020 2020 2020 2020 736c                sl
-0002aa80: 6963 655f 636f 6c73 2e61 7070 656e 6428  ice_cols.append(
-0002aa90: 6d65 7472 6963 290a 2020 2020 2020 2020  metric).        
-0002aaa0: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-0002aab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002aac0: 2020 6865 6164 6572 732e 6170 7065 6e64    headers.append
-0002aad0: 2828 676c 6f62 616c 5f6e 616d 652c 206d  ((global_name, m
-0002aae0: 6574 7269 6329 290a 2020 2020 2020 2020  etric)).        
-0002aaf0: 2020 2020 2020 2020 2020 2020 676c 6f62              glob
-0002ab00: 616c 5f63 6f6c 732e 6170 7065 6e64 286d  al_cols.append(m
-0002ab10: 6574 7269 6329 0a0a 2020 2020 2020 2020  etric)..        
-0002ab20: 2020 2020 2320 5265 6f72 6465 7220 636f      # Reorder co
-0002ab30: 6c75 6d6e 730a 2020 2020 2020 2020 2020  lumns.          
-0002ab40: 2020 6466 735f 6f72 6465 7265 6420 3d20    dfs_ordered = 
-0002ab50: 5b64 665b 676c 6f62 616c 5f63 6f6c 735d  [df[global_cols]
-0002ab60: 2c20 6466 5b73 6c69 6365 5f63 6f6c 735d  , df[slice_cols]
-0002ab70: 5d0a 2020 2020 2020 2020 2020 2020 6966  ].            if
-0002ab80: 206e 6f74 206e 616d 655f 6173 5f69 6e64   not name_as_ind
-0002ab90: 6578 3a0a 2020 2020 2020 2020 2020 2020  ex:.            
-0002aba0: 2020 2020 6466 735f 6f72 6465 7265 642e      dfs_ordered.
-0002abb0: 696e 7365 7274 2830 2c20 6466 5b22 524f  insert(0, df["RO
-0002abc0: 4922 5d29 0a20 2020 2020 2020 2020 2020  I"]).           
-0002abd0: 2064 6620 3d20 7064 2e63 6f6e 6361 7428   df = pd.concat(
-0002abe0: 6466 735f 6f72 6465 7265 642c 2061 7869  dfs_ordered, axi
-0002abf0: 733d 3129 0a0a 2020 2020 2020 2020 2020  s=1)..          
-0002ac00: 2020 2320 536f 7274 2068 6561 6465 7273    # Sort headers
-0002ac10: 2062 7920 676c 6f62 616c 2f73 6c69 6365   by global/slice
-0002ac20: 0a20 2020 2020 2020 2020 2020 2068 6561  .            hea
-0002ac30: 6465 7273 203d 205b 6820 666f 7220 6820  ders = [h for h 
-0002ac40: 696e 2068 6561 6465 7273 2069 6620 685b  in headers if h[
-0002ac50: 305d 203d 3d20 676c 6f62 616c 5f6e 616d  0] == global_nam
-0002ac60: 655d 205c 0a20 2020 2020 2020 2020 2020  e] \.           
-0002ac70: 2020 2020 2020 2020 202b 205b 6820 666f           + [h fo
-0002ac80: 7220 6820 696e 2068 6561 6465 7273 2069  r h in headers i
-0002ac90: 6620 685b 305d 203d 3d20 736c 6963 655f  f h[0] == slice_
-0002aca0: 6e61 6d65 5d0a 2020 2020 2020 2020 2020  name].          
-0002acb0: 2020 6966 206e 6f74 206e 616d 655f 6173    if not name_as
-0002acc0: 5f69 6e64 6578 3a0a 2020 2020 2020 2020  _index:.        
-0002acd0: 2020 2020 2020 2020 6865 6164 6572 732e          headers.
-0002ace0: 696e 7365 7274 2830 2c20 2822 222c 2022  insert(0, ("", "
-0002acf0: 524f 4922 2929 0a0a 2020 2020 2020 2020  ROI"))..        
-0002ad00: 2020 2020 2320 4164 6420 4d75 6c74 6949      # Add MultiI
-0002ad10: 6e64 6578 0a20 2020 2020 2020 2020 2020  ndex.           
-0002ad20: 2064 662e 636f 6c75 6d6e 7320 3d20 7064   df.columns = pd
-0002ad30: 2e4d 756c 7469 496e 6465 782e 6672 6f6d  .MultiIndex.from
-0002ad40: 5f74 7570 6c65 7328 6865 6164 6572 7329  _tuples(headers)
-0002ad50: 0a0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-0002ad60: 2064 660a 0a20 2020 2064 6566 2067 6574   df..    def get
-0002ad70: 5f63 6f6d 7061 7269 736f 6e5f 6e61 6d65  _comparison_name
-0002ad80: 2873 656c 662c 2072 6f69 2c20 6361 6d65  (self, roi, came
-0002ad90: 6c63 6173 653d 4661 6c73 652c 2063 6f6c  lcase=False, col
-0002ada0: 6f72 6564 3d46 616c 7365 2c0a 2020 2020  ored=False,.    
-0002adb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002adc0: 2020 2020 2020 2020 6772 6579 3d46 616c          grey=Fal
-0002add0: 7365 2c20 726f 695f 6b77 6172 6773 3d7b  se, roi_kwargs={
-0002ade0: 7d29 3a0a 2020 2020 2020 2020 2222 2247  }):.        """G
-0002adf0: 6574 206e 616d 6520 6f66 2063 6f6d 7061  et name of compa
-0002ae00: 7269 736f 6e20 6265 7477 6565 6e20 7468  rison between th
-0002ae10: 6973 2052 4f49 2061 6e64 2061 6e6f 7468  is ROI and anoth
-0002ae20: 6572 2e22 2222 0a0a 2020 2020 2020 2020  er."""..        
-0002ae30: 6f77 6e5f 6e61 6d65 203d 2073 656c 662e  own_name = self.
-0002ae40: 6e61 6d65 0a20 2020 2020 2020 206f 7468  name.        oth
-0002ae50: 6572 5f6e 616d 6520 3d20 726f 692e 6e61  er_name = roi.na
-0002ae60: 6d65 0a0a 2020 2020 2020 2020 6966 2063  me..        if c
-0002ae70: 6f6c 6f72 6564 3a0a 2020 2020 2020 2020  olored:.        
-0002ae80: 2020 2020 6f77 6e5f 636f 6c6f 7220 3d20      own_color = 
-0002ae90: 7365 6c66 2e67 6574 5f63 6f6c 6f72 5f66  self.get_color_f
-0002aea0: 726f 6d5f 6b77 6172 6773 2872 6f69 5f6b  rom_kwargs(roi_k
-0002aeb0: 7761 7267 7329 0a20 2020 2020 2020 2020  wargs).         
-0002aec0: 2020 206f 776e 5f6e 616d 6520 3d20 6765     own_name = ge
-0002aed0: 745f 636f 6c6f 7265 645f 726f 695f 7374  t_colored_roi_st
-0002aee0: 7269 6e67 2873 656c 662c 2067 7265 792c  ring(self, grey,
-0002aef0: 206f 776e 5f63 6f6c 6f72 290a 2020 2020   own_color).    
-0002af00: 2020 2020 2020 2020 6f74 6865 725f 636f          other_co
-0002af10: 6c6f 7220 3d20 726f 692e 6765 745f 636f  lor = roi.get_co
-0002af20: 6c6f 725f 6672 6f6d 5f6b 7761 7267 7328  lor_from_kwargs(
-0002af30: 726f 695f 6b77 6172 6773 290a 2020 2020  roi_kwargs).    
-0002af40: 2020 2020 2020 2020 6f74 6865 725f 6e61          other_na
-0002af50: 6d65 203d 2067 6574 5f63 6f6c 6f72 6564  me = get_colored
-0002af60: 5f72 6f69 5f73 7472 696e 6728 726f 692c  _roi_string(roi,
-0002af70: 2067 7265 792c 206f 7468 6572 5f63 6f6c   grey, other_col
-0002af80: 6f72 290a 0a20 2020 2020 2020 2069 6620  or)..        if 
-0002af90: 7365 6c66 2e6e 616d 6520 3d3d 2072 6f69  self.name == roi
-0002afa0: 2e6e 616d 653a 0a20 2020 2020 2020 2020  .name:.         
-0002afb0: 2020 2069 6620 6361 6d65 6c63 6173 653a     if camelcase:
-0002afc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0002afd0: 2072 6574 7572 6e20 6f77 6e5f 6e61 6d65   return own_name
-0002afe0: 2e72 6570 6c61 6365 2822 2022 2c20 225f  .replace(" ", "_
-0002aff0: 2229 0a20 2020 2020 2020 2020 2020 2072  ").            r
-0002b000: 6574 7572 6e20 6f77 6e5f 6e61 6d65 0a20  eturn own_name. 
-0002b010: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-0002b020: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
-0002b030: 636f 6c6f 7265 643a 0a20 2020 2020 2020  colored:.       
-0002b040: 2020 2020 2020 2020 2069 6620 6361 6d65           if came
-0002b050: 6c63 6173 653a 0a20 2020 2020 2020 2020  lcase:.         
-0002b060: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-0002b070: 6e20 6622 7b6f 776e 5f6e 616d 657d 5f76  n f"{own_name}_v
-0002b080: 735f 7b6f 7468 6572 5f6e 616d 657d 222e  s_{other_name}".
-0002b090: 7265 706c 6163 6528 2220 222c 2022 5f22  replace(" ", "_"
-0002b0a0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0002b0b0: 2020 7265 7475 726e 2066 227b 6f77 6e5f    return f"{own_
-0002b0c0: 6e61 6d65 7d20 7673 2e20 7b6f 7468 6572  name} vs. {other
-0002b0d0: 5f6e 616d 657d 220a 2020 2020 2020 2020  _name}".        
-0002b0e0: 2020 2020 7265 7475 726e 2066 227b 6f77      return f"{ow
-0002b0f0: 6e5f 6e61 6d65 7d7b 6f74 6865 725f 6e61  n_name}{other_na
-0002b100: 6d65 7d22 0a0a 2020 2020 6465 6620 7365  me}"..    def se
-0002b110: 745f 616c 7068 615f 6f76 6572 5f62 6574  t_alpha_over_bet
-0002b120: 6128 7365 6c66 2c20 616c 7068 615f 6f76  a(self, alpha_ov
-0002b130: 6572 5f62 6574 613d 4e6f 6e65 293a 0a20  er_beta=None):. 
-0002b140: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-0002b150: 2020 2053 6574 2072 6174 696f 2066 6f72     Set ratio for
-0002b160: 2052 4f49 2074 6973 7375 6520 6f66 2063   ROI tissue of c
-0002b170: 6f65 6666 6963 6965 6e74 7320 6f66 206c  oefficients of l
-0002b180: 696e 6561 722d 7175 6164 7261 7469 6320  inear-quadratic 
-0002b190: 6571 7561 7469 6f6e 2e0a 0a20 2020 2020  equation...     
-0002b1a0: 2020 202a 2a50 6172 616d 6574 6572 3a2a     **Parameter:*
-0002b1b0: 2a0a 0a20 2020 2020 2020 2061 6c70 6861  *..        alpha
-0002b1c0: 5f6f 7665 725f 6265 7461 203a 2066 6c6f  _over_beta : flo
-0002b1d0: 6174 2c20 6465 6661 756c 743d 4e6f 6e65  at, default=None
-0002b1e0: 0a20 2020 2020 2020 2020 2020 2052 6174  .            Rat
-0002b1f0: 696f 2066 6f72 2052 4f49 2074 6973 7375  io for ROI tissu
-0002b200: 6520 6f66 2063 6f65 6666 6963 6965 6e74  e of coefficient
-0002b210: 732c 2061 6c70 6861 2c20 6265 7461 2c0a  s, alpha, beta,.
-0002b220: 2020 2020 2020 2020 2020 2020 6f66 206c              of l
-0002b230: 696e 6561 722d 7175 6164 7261 7469 6320  inear-quadratic 
-0002b240: 6571 7561 7469 6f6e 2e20 2054 6869 7320  equation.  This 
-0002b250: 7261 7469 6f20 6973 2075 7365 6420 696e  ratio is used in
-0002b260: 0a20 2020 2020 2020 2020 2020 2063 616c  .            cal
-0002b270: 6375 6c61 7469 6e67 2062 696f 6c6f 6769  culating biologi
-0002b280: 6361 6c6c 7920 6566 6665 6374 6976 6520  cally effective 
-0002b290: 646f 7365 2c20 4245 442c 2066 726f 6d0a  dose, BED, from.
-0002b2a0: 2020 2020 2020 2020 2020 2020 7068 7973              phys
-0002b2b0: 6963 616c 2064 6f73 652c 2044 2c20 6465  ical dose, D, de
-0002b2c0: 6c69 7665 7265 6420 6f76 6572 206e 2065  livered over n e
-0002b2d0: 7175 616c 2066 7261 6374 696f 6e73 3a0a  qual fractions:.
-0002b2e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002b2f0: 4245 4420 3d20 4420 2a20 2831 202b 2028  BED = D * (1 + (
-0002b300: 442f 6e29 202f 2028 616c 7068 612f 6265  D/n) / (alpha/be
-0002b310: 7461 2929 2e0a 2020 2020 2020 2020 2020  ta))..          
-0002b320: 2020 4966 204e 6f6e 652c 2074 6865 2062    If None, the b
-0002b330: 696f 6c6f 6769 6361 6c6c 7920 6566 6665  iologically effe
-0002b340: 6374 6976 6520 646f 7365 2069 7320 7461  ctive dose is ta
-0002b350: 6b65 6e20 746f 2062 650a 2020 2020 2020  ken to be.      
-0002b360: 2020 2020 2020 6571 7561 6c20 746f 2074        equal to t
-0002b370: 6865 2070 6879 7369 6361 6c20 646f 7365  he physical dose
-0002b380: 2028 6265 7461 203e 3e20 616c 7068 6129   (beta >> alpha)
-0002b390: 2e0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
-0002b3a0: 2020 2020 2020 7365 6c66 2e61 6c70 6861        self.alpha
-0002b3b0: 5f6f 7665 725f 6265 7461 203d 2061 6c70  _over_beta = alp
-0002b3c0: 6861 5f6f 7665 725f 6265 7461 0a0a 2020  ha_over_beta..  
-0002b3d0: 2020 6465 6620 6765 745f 616c 7068 615f    def get_alpha_
-0002b3e0: 6f76 6572 5f62 6574 6128 7365 6c66 293a  over_beta(self):
-0002b3f0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-0002b400: 2020 2020 2047 6574 2072 6174 696f 2066       Get ratio f
-0002b410: 6f72 2052 4f49 2074 6973 7375 6520 6f66  or ROI tissue of
-0002b420: 2063 6f65 6666 6963 6965 6e74 7320 6f66   coefficients of
-0002b430: 206c 696e 6561 722d 7175 6164 7261 7469   linear-quadrati
-0002b440: 6320 6571 7561 7469 6f6e 2e0a 2020 2020  c equation..    
-0002b450: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-0002b460: 7265 7475 726e 2073 656c 662e 616c 7068  return self.alph
-0002b470: 615f 6f76 6572 5f62 6574 610a 0a20 2020  a_over_beta..   
-0002b480: 2064 6566 2073 6574 5f63 6f6c 6f72 2873   def set_color(s
-0002b490: 656c 662c 2063 6f6c 6f72 293a 0a20 2020  elf, color):.   
-0002b4a0: 2020 2020 2022 2222 5365 7420 706c 6f74       """Set plot
-0002b4b0: 7469 6e67 2063 6f6c 6f72 2e22 2222 0a0a  ting color."""..
-0002b4c0: 2020 2020 2020 2020 6966 2063 6f6c 6f72          if color
-0002b4d0: 2069 7320 6e6f 7420 4e6f 6e65 2061 6e64   is not None and
-0002b4e0: 206e 6f74 206d 6174 706c 6f74 6c69 622e   not matplotlib.
-0002b4f0: 636f 6c6f 7273 2e69 735f 636f 6c6f 725f  colors.is_color_
-0002b500: 6c69 6b65 2863 6f6c 6f72 293a 0a20 2020  like(color):.   
-0002b510: 2020 2020 2020 2020 2070 7269 6e74 2866           print(f
-0002b520: 2257 6172 6e69 6e67 3a20 7b63 6f6c 6f72  "Warning: {color
-0002b530: 7d20 6e6f 7420 6120 7661 6c69 6420 636f  } not a valid co
-0002b540: 6c6f 7221 2229 0a20 2020 2020 2020 2020  lor!").         
-0002b550: 2020 2063 6f6c 6f72 203d 204e 6f6e 650a     color = None.
-0002b560: 2020 2020 2020 2020 6966 2063 6f6c 6f72          if color
-0002b570: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
-0002b580: 2020 2020 2020 636f 6c6f 7220 3d20 524f        color = RO
-0002b590: 4944 6566 6175 6c74 7328 292e 6765 745f  IDefaults().get_
-0002b5a0: 6465 6661 756c 745f 726f 695f 636f 6c6f  default_roi_colo
-0002b5b0: 7228 290a 2020 2020 2020 2020 7365 6c66  r().        self
-0002b5c0: 2e63 6f6c 6f72 203d 206d 6174 706c 6f74  .color = matplot
-0002b5d0: 6c69 622e 636f 6c6f 7273 2e74 6f5f 7267  lib.colors.to_rg
-0002b5e0: 6261 2863 6f6c 6f72 290a 0a20 2020 2064  ba(color)..    d
-0002b5f0: 6566 2070 6c6f 7428 0a20 2020 2020 2020  ef plot(.       
-0002b600: 2073 656c 662c 0a20 2020 2020 2020 2076   self,.        v
-0002b610: 6965 773d 2278 2d79 222c 0a20 2020 2020  iew="x-y",.     
-0002b620: 2020 2070 6c6f 745f 7479 7065 3d4e 6f6e     plot_type=Non
-0002b630: 652c 0a20 2020 2020 2020 2073 6c3d 4e6f  e,.        sl=No
-0002b640: 6e65 2c0a 2020 2020 2020 2020 6964 783d  ne,.        idx=
-0002b650: 4e6f 6e65 2c0a 2020 2020 2020 2020 706f  None,.        po
-0002b660: 733d 4e6f 6e65 2c0a 2020 2020 2020 2020  s=None,.        
-0002b670: 6178 3d4e 6f6e 652c 0a20 2020 2020 2020  ax=None,.       
-0002b680: 2067 733d 4e6f 6e65 2c0a 2020 2020 2020   gs=None,.      
-0002b690: 2020 6669 6773 697a 653d 736b 7274 2e69    figsize=skrt.i
-0002b6a0: 6d61 6765 2e5f 6465 6661 756c 745f 6669  mage._default_fi
-0002b6b0: 6773 697a 652c 0a20 2020 2020 2020 206f  gsize,.        o
-0002b6c0: 7061 6369 7479 3d4e 6f6e 652c 0a20 2020  pacity=None,.   
-0002b6d0: 2020 2020 206c 696e 6577 6964 7468 3d4e       linewidth=N
-0002b6e0: 6f6e 652c 0a20 2020 2020 2020 2063 6f6e  one,.        con
-0002b6f0: 746f 7572 5f6b 7761 7267 733d 4e6f 6e65  tour_kwargs=None
-0002b700: 2c0a 2020 2020 2020 2020 6d61 736b 5f6b  ,.        mask_k
-0002b710: 7761 7267 733d 4e6f 6e65 2c0a 2020 2020  wargs=None,.    
-0002b720: 2020 2020 7a6f 6f6d 3d4e 6f6e 652c 0a20      zoom=None,. 
-0002b730: 2020 2020 2020 207a 6f6f 6d5f 6365 6e74         zoom_cent
-0002b740: 7265 3d4e 6f6e 652c 0a20 2020 2020 2020  re=None,.       
-0002b750: 2063 6f6c 6f72 3d4e 6f6e 652c 0a20 2020   color=None,.   
-0002b760: 2020 2020 2073 686f 773d 5472 7565 2c0a       show=True,.
-0002b770: 2020 2020 2020 2020 7361 7665 5f61 733d          save_as=
-0002b780: 4e6f 6e65 2c0a 2020 2020 2020 2020 696e  None,.        in
-0002b790: 636c 7564 655f 696d 6167 653d 4661 6c73  clude_image=Fals
-0002b7a0: 652c 0a20 2020 2020 2020 206e 6f5f 696e  e,.        no_in
-0002b7b0: 7665 7274 3d46 616c 7365 2c0a 2020 2020  vert=False,.    
-0002b7c0: 2020 2020 2a2a 6b77 6172 6773 2c0a 2020      **kwargs,.  
-0002b7d0: 2020 293a 0a20 2020 2020 2020 2022 2222    ):.        """
-0002b7e0: 506c 6f74 2074 6869 7320 524f 4920 6173  Plot this ROI as
-0002b7f0: 2065 6974 6865 7220 6120 6d61 736b 206f   either a mask o
-0002b800: 7220 6120 636f 6e74 6f75 722e 0a0a 2020  r a contour...  
-0002b810: 2020 2020 2020 2a2a 5061 7261 6d65 7465        **Paramete
-0002b820: 7273 3a2a 2a0a 0a20 2020 2020 2020 2076  rs:**..        v
-0002b830: 6965 7720 3a20 7374 722c 2064 6566 6175  iew : str, defau
-0002b840: 6c74 3d22 782d 7922 0a20 2020 2020 2020  lt="x-y".       
-0002b850: 2020 2020 204f 7269 656e 7461 7469 6f6e       Orientation
-0002b860: 2069 6e20 7768 6963 6820 746f 2070 6c6f   in which to plo
-0002b870: 742e 2043 616e 2062 6520 2278 2d79 222c  t. Can be "x-y",
-0002b880: 2022 792d 7a22 2c20 6f72 2022 782d 7a22   "y-z", or "x-z"
-0002b890: 2e0a 0a20 2020 2020 2020 2070 6c6f 745f  ...        plot_
-0002b8a0: 7479 7065 203a 2073 7472 2c20 6465 6661  type : str, defa
-0002b8b0: 756c 743d 4e6f 6e65 0a20 2020 2020 2020  ult=None.       
-0002b8c0: 2020 2020 2050 6c6f 7474 696e 6720 7479       Plotting ty
-0002b8d0: 7065 2e20 4966 204e 6f6e 652c 2077 696c  pe. If None, wil
-0002b8e0: 6c20 6265 2065 6974 6865 7220 2263 6f6e  l be either "con
-0002b8f0: 746f 7572 2220 6f72 2022 6d61 736b 2220  tour" or "mask" 
-0002b900: 0a20 2020 2020 2020 2020 2020 2064 6570  .            dep
-0002b910: 656e 6469 6e67 206f 6e20 7468 6520 696e  ending on the in
-0002b920: 7075 7420 7479 7065 206f 6620 7468 6520  put type of the 
-0002b930: 524f 492e 204f 7074 696f 6e73 3a0a 0a20  ROI. Options:.. 
-0002b940: 2020 2020 2020 2020 2020 2020 2020 202d                 -
-0002b950: 2022 636f 6e74 6f75 7222 0a20 2020 2020   "contour".     
-0002b960: 2020 2020 2020 2020 2020 202d 2022 6d61             - "ma
-0002b970: 736b 220a 2020 2020 2020 2020 2020 2020  sk".            
-0002b980: 2020 2020 2d20 2263 656e 7472 6f69 6422      - "centroid"
-0002b990: 2028 636f 6e74 6f75 7220 7769 7468 206d   (contour with m
-0002b9a0: 6172 6b65 7220 6174 2063 656e 7472 6f69  arker at centroi
-0002b9b0: 6429 0a20 2020 2020 2020 2020 2020 2020  d).             
-0002b9c0: 2020 202d 2022 6669 6c6c 6564 2220 2874     - "filled" (t
-0002b9d0: 7261 6e73 7061 7265 6e74 206d 6173 6b20  ransparent mask 
-0002b9e0: 2b20 636f 6e74 6f75 7229 0a20 2020 2020  + contour).     
-0002b9f0: 2020 2020 2020 2020 2020 202d 2022 6669             - "fi
-0002ba00: 6c6c 6564 2063 656e 7472 6f69 6422 2028  lled centroid" (
-0002ba10: 6669 6c6c 6564 2077 6974 6820 6d61 726b  filled with mark
-0002ba20: 6572 2061 7420 6365 6e74 726f 6964 290a  er at centroid).
-0002ba30: 0a20 2020 2020 2020 2073 6c20 3a20 696e  .        sl : in
-0002ba40: 742c 2064 6566 6175 6c74 3d4e 6f6e 650a  t, default=None.
-0002ba50: 2020 2020 2020 2020 2020 2020 536c 6963              Slic
-0002ba60: 6520 6e75 6d62 6572 2074 6f20 706c 6f74  e number to plot
-0002ba70: 2e20 4966 206e 6f6e 6520 6f66 203c 736c  . If none of <sl
-0002ba80: 3e2c 203c 6964 783e 206f 7220 3c70 6f73  >, <idx> or <pos
-0002ba90: 3e20 6172 6520 7375 7070 6c69 6564 2c20  > are supplied, 
-0002baa0: 0a20 2020 2020 2020 2020 2020 2074 6865  .            the
-0002bab0: 2063 656e 7472 616c 2073 6c69 6365 206f   central slice o
-0002bac0: 6620 7468 6520 524f 4920 7769 6c6c 2062  f the ROI will b
-0002bad0: 6520 0a20 2020 2020 2020 2020 2020 2075  e .            u
-0002bae0: 7365 642e 0a0a 2020 2020 2020 2020 6964  sed...        id
-0002baf0: 7820 3a20 696e 742c 2064 6566 6175 6c74  x : int, default
-0002bb00: 3d4e 6f6e 650a 2020 2020 2020 2020 2020  =None.          
-0002bb10: 2020 4172 7261 7920 696e 6465 7820 6f66    Array index of
-0002bb20: 2073 6c69 6365 2074 6f20 706c 6f74 2e20   slice to plot. 
-0002bb30: 4966 206e 6f6e 6520 6f66 203c 736c 3e2c  If none of <sl>,
-0002bb40: 203c 6964 783e 206f 7220 3c70 6f73 3e20   <idx> or <pos> 
-0002bb50: 6172 6520 0a20 2020 2020 2020 2020 2020  are .           
-0002bb60: 2073 7570 706c 6965 642c 2074 6865 2063   supplied, the c
-0002bb70: 656e 7472 616c 2073 6c69 6365 206f 6620  entral slice of 
-0002bb80: 7468 6520 524f 4920 7769 6c6c 2062 6520  the ROI will be 
-0002bb90: 7573 6564 2e0a 0a20 2020 2020 2020 2070  used...        p
-0002bba0: 6f73 203a 2066 6c6f 6174 2c20 6465 6661  os : float, defa
-0002bbb0: 756c 743d 4e6f 6e65 0a20 2020 2020 2020  ult=None.       
-0002bbc0: 2020 2020 2050 6f73 6974 696f 6e20 696e       Position in
-0002bbd0: 206d 6d20 6f66 2073 6c69 6365 2074 6f20   mm of slice to 
-0002bbe0: 706c 6f74 2e20 4966 206e 6f6e 6520 6f66  plot. If none of
-0002bbf0: 203c 736c 3e2c 203c 6964 783e 206f 7220   <sl>, <idx> or 
-0002bc00: 3c70 6f73 3e20 0a20 2020 2020 2020 2020  <pos> .         
-0002bc10: 2020 2061 7265 2073 7570 706c 6965 642c     are supplied,
-0002bc20: 2074 6865 2063 656e 7472 616c 2073 6c69   the central sli
-0002bc30: 6365 206f 6620 7468 6520 524f 4920 7769  ce of the ROI wi
-0002bc40: 6c6c 2062 6520 7573 6564 2e0a 0a20 2020  ll be used...   
-0002bc50: 2020 2020 2061 7820 3a20 6d61 7470 6c6f       ax : matplo
-0002bc60: 746c 6962 2e70 7970 6c6f 742e 4178 6573  tlib.pyplot.Axes
-0002bc70: 2c20 6465 6661 756c 743d 4e6f 6e65 0a20  , default=None. 
-0002bc80: 2020 2020 2020 2020 2020 2041 7865 7320             Axes 
-0002bc90: 6f6e 2077 6869 6368 2074 6f20 706c 6f74  on which to plot
-0002bca0: 2e20 4966 204e 6f6e 652c 206e 6577 2061  . If None, new a
-0002bcb0: 7865 7320 7769 6c6c 2062 6520 6372 6561  xes will be crea
-0002bcc0: 7465 642e 0a0a 2020 2020 2020 2020 6773  ted...        gs
-0002bcd0: 203a 206d 6174 706c 6f74 6c69 622e 6772   : matplotlib.gr
-0002bce0: 6964 7370 6563 2e47 7269 6453 7065 632c  idspec.GridSpec,
-0002bcf0: 2064 6566 6175 6c74 3d4e 6f6e 650a 2020   default=None.  
-0002bd00: 2020 2020 2020 2020 2020 4966 206e 6f74            If not
-0002bd10: 204e 6f6e 6520 616e 6420 3c61 783e 2069   None and <ax> i
-0002bd20: 7320 4e6f 6e65 2c20 6e65 7720 6178 6573  s None, new axes
-0002bd30: 2077 696c 6c20 6265 2063 7265 6174 6564   will be created
-0002bd40: 206f 6e20 7468 650a 2020 2020 2020 2020   on the.        
-0002bd50: 2020 2020 6375 7272 656e 7420 6d61 7470      current matp
-0002bd60: 6c6f 746c 6962 2066 6967 7572 6520 7769  lotlib figure wi
-0002bd70: 7468 2074 6869 7320 6772 6964 7370 6563  th this gridspec
-0002bd80: 2e0a 0a20 2020 2020 2020 2066 6967 7369  ...        figsi
-0002bd90: 7a65 203a 2066 6c6f 6174 2c20 6465 6661  ze : float, defa
-0002bda0: 756c 743d 736b 7274 2e69 6d61 6765 2e5f  ult=skrt.image._
-0002bdb0: 6465 6661 756c 745f 6669 6773 697a 650a  default_figsize.
-0002bdc0: 2020 2020 2020 2020 2020 2020 4669 6775              Figu
-0002bdd0: 7265 2068 6569 6768 7420 696e 2069 6e63  re height in inc
-0002bde0: 6865 733b 206f 6e6c 7920 7573 6564 2069  hes; only used i
-0002bdf0: 6620 3c61 783e 2061 6e64 203c 6773 3e20  f <ax> and <gs> 
-0002be00: 6172 6520 4e6f 6e65 2e0a 0a20 2020 2020  are None...     
-0002be10: 2020 206f 7061 6369 7479 203a 2066 6c6f     opacity : flo
-0002be20: 6174 2c20 6465 6661 756c 743d 4e6f 6e65  at, default=None
-0002be30: 0a20 2020 2020 2020 2020 2020 204f 7061  .            Opa
-0002be40: 6369 7479 2074 6f20 7573 6520 6966 2070  city to use if p
-0002be50: 6c6f 7474 696e 6720 6d61 736b 2028 692e  lotting mask (i.
-0002be60: 652e 2070 6c6f 7420 7479 7065 7320 226d  e. plot types "m
-0002be70: 6173 6b22 2c20 2266 696c 6c65 6422 2c20  ask", "filled", 
-0002be80: 0a20 2020 2020 2020 2020 2020 206f 7220  .            or 
-0002be90: 2266 696c 6c65 6420 6365 6e74 726f 6964  "filled centroid
-0002bea0: 2229 2e20 4966 204e 6f6e 652c 206f 7061  "). If None, opa
-0002beb0: 6369 7479 2077 696c 6c20 6265 2031 2062  city will be 1 b
-0002bec0: 7920 6465 6661 756c 7420 666f 7220 0a20  y default for . 
-0002bed0: 2020 2020 2020 2020 2020 2073 6f6c 6964             solid
-0002bee0: 206d 6173 6b20 706c 6f74 7320 616e 6420   mask plots and 
-0002bef0: 302e 3320 6279 2064 6566 6175 6c74 2066  0.3 by default f
-0002bf00: 6f72 2066 696c 6c65 6420 706c 6f74 732e  or filled plots.
-0002bf10: 0a0a 2020 2020 2020 2020 6c69 6e65 7769  ..        linewi
-0002bf20: 6474 6820 3a20 666c 6f61 742c 2064 6566  dth : float, def
-0002bf30: 6175 6c74 3d4e 6f6e 650a 2020 2020 2020  ault=None.      
-0002bf40: 2020 2020 2020 5769 6474 6820 6f66 2063        Width of c
-0002bf50: 6f6e 746f 7572 206c 696e 6573 2e20 4966  ontour lines. If
-0002bf60: 204e 6f6e 652c 2074 6865 206d 6174 706c   None, the matpl
-0002bf70: 6f74 6c69 6220 6465 6661 756c 7420 7365  otlib default se
-0002bf80: 7474 696e 6720 0a20 2020 2020 2020 2020  tting .         
-0002bf90: 2020 2077 696c 6c20 6265 2075 7365 642e     will be used.
-0002bfa0: 0a0a 2020 2020 2020 2020 636f 6e74 6f75  ..        contou
-0002bfb0: 725f 6b77 6172 6773 203a 2064 6963 742c  r_kwargs : dict,
-0002bfc0: 2064 6566 6175 6c74 3d4e 6f6e 650a 2020   default=None.  
-0002bfd0: 2020 2020 2020 2020 2020 4578 7472 6120            Extra 
-0002bfe0: 6b65 7977 6f72 6420 6172 6775 6d65 6e74  keyword argument
-0002bff0: 7320 746f 2070 6173 7320 746f 206d 6174  s to pass to mat
-0002c000: 706c 6f74 6c69 6220 636f 6e74 6f75 7220  plotlib contour 
-0002c010: 706c 6f74 7469 6e67 2e0a 0a20 2020 2020  plotting...     
-0002c020: 2020 206d 6173 6b5f 6b77 6172 6773 203a     mask_kwargs :
-0002c030: 2064 6963 742c 2064 6566 6175 6c74 3d4e   dict, default=N
-0002c040: 6f6e 650a 2020 2020 2020 2020 2020 2020  one.            
-0002c050: 4578 7472 6120 6b65 7977 6f72 6420 6172  Extra keyword ar
-0002c060: 6775 6d65 6e74 7320 746f 2070 6173 7320  guments to pass 
-0002c070: 746f 206d 6174 706c 6f74 6c69 6220 6d61  to matplotlib ma
-0002c080: 736b 2070 6c6f 7474 696e 672e 0a0a 2020  sk plotting...  
-0002c090: 2020 2020 2020 7a6f 6f6d 203a 2069 6e74        zoom : int
-0002c0a0: 2f66 6c6f 6174 2f74 7570 6c65 2c20 6465  /float/tuple, de
-0002c0b0: 6661 756c 743d 4e6f 6e65 0a20 2020 2020  fault=None.     
-0002c0c0: 2020 2020 2020 2046 6163 746f 7220 6279         Factor by
-0002c0d0: 2077 6869 6368 2074 6f20 7a6f 6f6d 2069   which to zoom i
-0002c0e0: 6e2e 2049 6620 6120 7369 6e67 6c65 2069  n. If a single i
-0002c0f0: 6e74 206f 7220 666c 6f61 7420 6973 2067  nt or float is g
-0002c100: 6976 656e 2c0a 2020 2020 2020 2020 2020  iven,.          
-0002c110: 2020 7468 6520 7361 6d65 207a 6f6f 6d20    the same zoom 
-0002c120: 6661 6374 6f72 2077 696c 6c20 6265 2061  factor will be a
-0002c130: 7070 6c69 6564 2069 6e20 616c 6c20 6469  pplied in all di
-0002c140: 7265 6374 696f 6e73 2e20 4966 2061 2074  rections. If a t
-0002c150: 7570 6c65 0a20 2020 2020 2020 2020 2020  uple.           
-0002c160: 206f 6620 7468 7265 6520 7661 6c75 6573   of three values
-0002c170: 2069 7320 6769 7665 6e2c 2074 6865 7365   is given, these
-0002c180: 2077 696c 6c20 6265 2075 7365 6420 6173   will be used as
-0002c190: 2074 6865 207a 6f6f 6d20 6661 6374 6f72   the zoom factor
-0002c1a0: 730a 2020 2020 2020 2020 2020 2020 696e  s.            in
-0002c1b0: 2065 6163 6820 6469 7265 6374 696f 6e20   each direction 
-0002c1c0: 696e 2074 6865 206f 7264 6572 2028 782c  in the order (x,
-0002c1d0: 2079 2c20 7a29 2e20 4966 204e 6f6e 652c   y, z). If None,
-0002c1e0: 2074 6865 2069 6d61 6765 2077 696c 6c0a   the image will.
-0002c1f0: 2020 2020 2020 2020 2020 2020 6e6f 7420              not 
-0002c200: 6265 207a 6f6f 6d65 6420 696e 2e0a 0a20  be zoomed in... 
-0002c210: 2020 2020 2020 207a 6f6f 6d5f 6365 6e74         zoom_cent
-0002c220: 7265 203a 2074 7570 6c65 2c20 6465 6661  re : tuple, defa
-0002c230: 756c 743d 4e6f 6e65 0a20 2020 2020 2020  ult=None.       
-0002c240: 2020 2020 2050 6f73 6974 696f 6e20 6172       Position ar
-0002c250: 6f75 6e64 2077 6869 6368 207a 6f6f 6d69  ound which zoomi
-0002c260: 6e67 2069 7320 6170 706c 6965 642e 2049  ng is applied. I
-0002c270: 6620 4e6f 6e65 2c20 7468 6520 6365 6e74  f None, the cent
-0002c280: 7265 206f 660a 2020 2020 2020 2020 2020  re of.          
-0002c290: 2020 7468 6520 696d 6167 6520 7769 6c6c    the image will
-0002c2a0: 2062 6520 7573 6564 2e0a 0a20 2020 2020   be used...     
-0002c2b0: 2020 2063 6f6c 6f72 203a 206d 6174 706c     color : matpl
-0002c2c0: 6f74 6c69 6220 636f 6c6f 722c 2064 6566  otlib color, def
-0002c2d0: 6175 6c74 3d4e 6f6e 650a 2020 2020 2020  ault=None.      
-0002c2e0: 2020 2020 2020 436f 6c6f 7220 7769 7468        Color with
-0002c2f0: 2077 6869 6368 2074 6f20 706c 6f74 2074   which to plot t
-0002c300: 6865 2052 4f49 3b20 6f76 6572 7269 6465  he ROI; override
-0002c310: 7320 7468 6520 524f 4927 7320 6f77 6e20  s the ROI's own 
-0002c320: 636f 6c6f 722e 2049 6620 0a20 2020 2020  color. If .     
-0002c330: 2020 2020 2020 204e 6f6e 652c 2073 656c         None, sel
-0002c340: 662e 636f 6c6f 7220 7769 6c6c 2062 6520  f.color will be 
-0002c350: 7573 6564 2e0a 0a20 2020 2020 2020 2073  used...        s
-0002c360: 686f 7720 3a20 626f 6f6c 2c20 6465 6661  how : bool, defa
-0002c370: 756c 743d 5472 7565 0a20 2020 2020 2020  ult=True.       
-0002c380: 2020 2020 2049 6620 5472 7565 2c20 7468       If True, th
-0002c390: 6520 706c 6f74 2077 696c 6c20 6265 2064  e plot will be d
-0002c3a0: 6973 706c 6179 6564 2069 6d6d 6564 6961  isplayed immedia
-0002c3b0: 7465 6c79 2e0a 0a20 2020 2020 2020 2073  tely...        s
-0002c3c0: 6176 655f 6173 203a 2073 7472 2c20 6465  ave_as : str, de
-0002c3d0: 6661 756c 743d 4e6f 6e65 0a20 2020 2020  fault=None.     
-0002c3e0: 2020 2020 2020 2049 6620 7365 7420 746f         If set to
-0002c3f0: 2061 2073 7472 696e 672c 2074 6865 2070   a string, the p
-0002c400: 6c6f 7420 7769 6c6c 2062 6520 7361 7665  lot will be save
-0002c410: 6420 746f 2074 6865 2066 696c 656e 616d  d to the filenam
-0002c420: 6520 696e 2074 6865 200a 2020 2020 2020  e in the .      
-0002c430: 2020 2020 2020 7374 7269 6e67 2e0a 0a20        string... 
-0002c440: 2020 2020 2020 2069 6e63 6c75 6465 5f69         include_i
-0002c450: 6d61 6765 203a 2062 6f6f 6c2c 2064 6566  mage : bool, def
-0002c460: 6175 6c74 3d46 616c 7365 0a20 2020 2020  ault=False.     
-0002c470: 2020 2020 2020 2049 6620 5472 7565 2061         If True a
-0002c480: 6e64 2073 656c 662e 696d 6167 6520 6973  nd self.image is
-0002c490: 206e 6f74 204e 6f6e 652c 2074 6865 2052   not None, the R
-0002c4a0: 4f49 2773 2069 6d61 6765 2077 696c 6c20  OI's image will 
-0002c4b0: 6265 2070 6c6f 7474 6564 0a20 2020 2020  be plotted.     
-0002c4c0: 2020 2020 2020 2069 6e20 7468 6520 6261         in the ba
-0002c4d0: 636b 6772 6f75 6e64 2e0a 0a20 2020 2020  ckground...     
-0002c4e0: 2020 206e 6f5f 696e 7665 7274 203a 2062     no_invert : b
-0002c4f0: 6f6f 6c2c 2064 6566 6175 6c74 3d46 616c  ool, default=Fal
-0002c500: 7365 0a20 2020 2020 2020 2020 2020 2049  se.            I
-0002c510: 6620 4661 6c73 652c 2063 6f6e 746f 7572  f False, contour
-0002c520: 2070 6c6f 7473 2077 696c 6c20 6265 2061   plots will be a
-0002c530: 7574 6f6d 6174 6963 616c 6c79 2069 6e76  utomatically inv
-0002c540: 6572 7465 6420 7768 656e 2070 6c6f 7474  erted when plott
-0002c550: 696e 670a 2020 2020 2020 2020 2020 2020  ing.            
-0002c560: 7769 7468 6f75 7420 616e 2075 6e64 6572  without an under
-0002c570: 6c79 696e 6720 696d 6167 6520 746f 2061  lying image to a
-0002c580: 6363 6f75 6e74 2066 6f72 2074 6865 2079  ccount for the y
-0002c590: 2061 7869 7320 696e 6372 6561 7369 6e67   axis increasing
-0002c5a0: 200a 2020 2020 2020 2020 2020 2020 696e   .            in
-0002c5b0: 2074 6865 206f 7070 6f73 6974 6520 6469   the opposite di
-0002c5c0: 7265 6374 696f 6e2e 204f 7468 6572 7769  rection. Otherwi
-0002c5d0: 7365 2c20 7468 6520 706c 6f74 2077 696c  se, the plot wil
-0002c5e0: 6c20 6265 206c 6566 7420 6173 0a20 2020  l be left as.   
-0002c5f0: 2020 2020 2020 2020 2069 7420 6170 7065           it appe
-0002c600: 6172 6564 2077 6865 6e20 6472 6177 6e20  ared when drawn 
-0002c610: 6279 206d 6174 706c 6f74 6c69 622e 0a0a  by matplotlib...
-0002c620: 2020 2020 2020 2020 602a 2a60 6b77 6172          `**`kwar
-0002c630: 6773 203a 0a20 2020 2020 2020 2020 2020  gs :.           
-0002c640: 2045 7874 7261 206b 6579 776f 7264 2061   Extra keyword a
-0002c650: 7267 756d 656e 7473 2074 6f20 7061 7373  rguments to pass
-0002c660: 2074 6f20 7468 6520 7265 6c65 7661 6e74   to the relevant
-0002c670: 2070 6c6f 7420 6675 6e63 7469 6f6e 2e0a   plot function..
-0002c680: 2020 2020 2020 2020 2222 220a 0a20 2020          """..   
-0002c690: 2020 2020 2073 656c 662e 6c6f 6164 2829       self.load()
-0002c6a0: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
-0002c6b0: 2e65 6d70 7479 3a0a 2020 2020 2020 2020  .empty:.        
-0002c6c0: 2020 2020 7265 7475 726e 0a0a 2020 2020      return..    
-0002c6d0: 2020 2020 6966 2070 6c6f 745f 7479 7065      if plot_type
-0002c6e0: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
-0002c6f0: 2020 2020 2020 706c 6f74 5f74 7970 6520        plot_type 
-0002c700: 3d20 6b77 6172 6773 2e67 6574 2822 726f  = kwargs.get("ro
-0002c710: 695f 706c 6f74 5f74 7970 6522 2c20 7365  i_plot_type", se
-0002c720: 6c66 2e64 6566 6175 6c74 5f67 656f 6d5f  lf.default_geom_
-0002c730: 6d65 7468 6f64 290a 0a20 2020 2020 2020  method)..       
-0002c740: 2069 6620 736c 2069 7320 4e6f 6e65 2061   if sl is None a
-0002c750: 6e64 2069 6478 2069 7320 4e6f 6e65 2061  nd idx is None a
-0002c760: 6e64 2070 6f73 2069 7320 4e6f 6e65 3a0a  nd pos is None:.
-0002c770: 2020 2020 2020 2020 2020 2020 6964 7820              idx 
-0002c780: 3d20 7365 6c66 2e67 6574 5f6d 6964 5f69  = self.get_mid_i
-0002c790: 6478 2876 6965 7729 0a20 2020 2020 2020  dx(view).       
-0002c7a0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-0002c7b0: 2020 2069 6478 203d 2073 656c 662e 6765     idx = self.ge
-0002c7c0: 745f 6964 7828 7669 6577 2c20 736c 2c20  t_idx(view, sl, 
-0002c7d0: 6964 782c 2070 6f73 290a 0a20 2020 2020  idx, pos)..     
-0002c7e0: 2020 2073 686f 775f 6365 6e74 726f 6964     show_centroid
-0002c7f0: 203d 2022 6365 6e74 726f 6964 2220 696e   = "centroid" in
-0002c800: 2070 6c6f 745f 7479 7065 0a20 2020 2020   plot_type.     
-0002c810: 2020 2069 6620 7a6f 6f6d 2061 6e64 207a     if zoom and z
-0002c820: 6f6f 6d5f 6365 6e74 7265 2069 7320 4e6f  oom_centre is No
-0002c830: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-0002c840: 7a6f 6f6d 5f63 656e 7472 6520 3d20 7365  zoom_centre = se
-0002c850: 6c66 2e67 6574 5f7a 6f6f 6d5f 6365 6e74  lf.get_zoom_cent
-0002c860: 7265 2876 6965 7729 0a20 2020 2020 2020  re(view).       
-0002c870: 2069 6620 636f 6c6f 7220 6973 204e 6f6e   if color is Non
-0002c880: 653a 0a20 2020 2020 2020 2020 2020 2063  e:.            c
-0002c890: 6f6c 6f72 203d 2073 656c 662e 636f 6c6f  olor = self.colo
-0002c8a0: 720a 2020 2020 2020 2020 656c 7365 3a0a  r.        else:.
-0002c8b0: 2020 2020 2020 2020 2020 2020 636f 6c6f              colo
-0002c8c0: 7220 3d20 6d61 7470 6c6f 746c 6962 2e63  r = matplotlib.c
-0002c8d0: 6f6c 6f72 732e 746f 5f72 6762 6128 636f  olors.to_rgba(co
-0002c8e0: 6c6f 7229 0a0a 2020 2020 2020 2020 6966  lor)..        if
-0002c8f0: 206f 7061 6369 7479 2069 7320 4e6f 6e65   opacity is None
-0002c900: 3a0a 2020 2020 2020 2020 2020 2020 6f70  :.            op
-0002c910: 6163 6974 7920 3d20 6b77 6172 6773 2e67  acity = kwargs.g
-0002c920: 6574 280a 2020 2020 2020 2020 2020 2020  et(.            
-0002c930: 2020 2020 2020 2020 2272 6f69 5f6f 7061          "roi_opa
-0002c940: 6369 7479 222c 2030 2e33 2069 6620 2266  city", 0.3 if "f
-0002c950: 696c 6c65 6422 2069 6e20 706c 6f74 5f74  illed" in plot_t
-0002c960: 7970 6520 656c 7365 2031 290a 0a20 2020  ype else 1)..   
-0002c970: 2020 2020 2023 2053 6574 2075 7020 6178       # Set up ax
-0002c980: 6573 0a20 2020 2020 2020 2073 656c 662e  es.        self.
-0002c990: 7365 745f 6178 2870 6c6f 745f 7479 7065  set_ax(plot_type
-0002c9a0: 2c20 696e 636c 7564 655f 696d 6167 652c  , include_image,
-0002c9b0: 2076 6965 772c 2061 782c 2067 732c 2066   view, ax, gs, f
-0002c9c0: 6967 7369 7a65 290a 0a20 2020 2020 2020  igsize)..       
-0002c9d0: 2023 2041 646a 7573 7420 6365 6e74 726f   # Adjust centro
-0002c9e0: 6964 206d 6172 6b65 7220 7369 7a65 0a20  id marker size. 
-0002c9f0: 2020 2020 2020 2069 6620 636f 6e74 6f75         if contou
-0002ca00: 725f 6b77 6172 6773 2069 7320 4e6f 6e65  r_kwargs is None
-0002ca10: 3a0a 2020 2020 2020 2020 2020 2020 636f  :.            co
-0002ca20: 6e74 6f75 725f 6b77 6172 6773 203d 207b  ntour_kwargs = {
-0002ca30: 7d0a 2020 2020 2020 2020 6966 2022 6365  }.        if "ce
-0002ca40: 6e74 726f 6964 2220 696e 2070 6c6f 745f  ntroid" in plot_
-0002ca50: 7479 7065 206f 7220 2263 6f6e 746f 7572  type or "contour
-0002ca60: 2220 3d3d 2070 6c6f 745f 7479 7065 3a0a  " == plot_type:.
-0002ca70: 2020 2020 2020 2020 2020 2020 6966 206c              if l
-0002ca80: 696e 6577 6964 7468 2069 7320 4e6f 6e65  inewidth is None
-0002ca90: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0002caa0: 2020 6c69 6e65 7769 6474 6820 3d20 6b77    linewidth = kw
-0002cab0: 6172 6773 2e67 6574 2822 726f 695f 6c69  args.get("roi_li
-0002cac0: 6e65 7769 6474 6822 2c0a 2020 2020 2020  newidth",.      
-0002cad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002cae0: 2020 6465 6661 756c 7450 6172 616d 735b    defaultParams[
-0002caf0: 226c 696e 6573 2e6c 696e 6577 6964 7468  "lines.linewidth
-0002cb00: 225d 5b30 5d29 0a20 2020 2020 2020 2069  "][0]).        i
-0002cb10: 6620 2263 656e 7472 6f69 6422 2069 6e20  f "centroid" in 
-0002cb20: 706c 6f74 5f74 7970 653a 0a20 2020 2020  plot_type:.     
-0002cb30: 2020 2020 2020 2063 6f6e 746f 7572 5f6b         contour_k
-0002cb40: 7761 7267 732e 7365 7464 6566 6175 6c74  wargs.setdefault
-0002cb50: 2822 6d61 726b 6572 7369 7a65 222c 2037  ("markersize", 7
-0002cb60: 202a 206e 702e 7371 7274 286c 696e 6577   * np.sqrt(linew
-0002cb70: 6964 7468 2929 0a20 2020 2020 2020 2020  idth)).         
-0002cb80: 2020 2063 6f6e 746f 7572 5f6b 7761 7267     contour_kwarg
-0002cb90: 732e 7365 7464 6566 6175 6c74 2822 6d61  s.setdefault("ma
-0002cba0: 726b 6572 6564 6765 7769 6474 6822 2c20  rkeredgewidth", 
-0002cbb0: 6e70 2e73 7172 7428 6c69 6e65 7769 6474  np.sqrt(linewidt
-0002cbc0: 6829 290a 0a20 2020 2020 2020 2023 2050  h))..        # P
-0002cbd0: 6c6f 7420 6120 6d61 736b 0a20 2020 2020  lot a mask.     
-0002cbe0: 2020 2069 6620 706c 6f74 5f74 7970 6520     if plot_type 
-0002cbf0: 3d3d 2022 6d61 736b 223a 0a20 2020 2020  == "mask":.     
-0002cc00: 2020 2020 2020 2073 656c 662e 5f70 6c6f         self._plo
-0002cc10: 745f 6d61 736b 280a 2020 2020 2020 2020  t_mask(.        
-0002cc20: 2020 2020 2020 2020 7669 6577 2c0a 2020          view,.  
-0002cc30: 2020 2020 2020 2020 2020 2020 2020 6964                id
-0002cc40: 782c 0a20 2020 2020 2020 2020 2020 2020  x,.             
-0002cc50: 2020 206d 6173 6b5f 6b77 6172 6773 2c0a     mask_kwargs,.
-0002cc60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002cc70: 6f70 6163 6974 792c 0a20 2020 2020 2020  opacity,.       
-0002cc80: 2020 2020 2020 2020 207a 6f6f 6d3d 7a6f           zoom=zo
-0002cc90: 6f6d 2c0a 2020 2020 2020 2020 2020 2020  om,.            
-0002cca0: 2020 2020 7a6f 6f6d 5f63 656e 7472 653d      zoom_centre=
-0002ccb0: 7a6f 6f6d 5f63 656e 7472 652c 0a20 2020  zoom_centre,.   
-0002ccc0: 2020 2020 2020 2020 2020 2020 2073 686f               sho
-0002ccd0: 773d 4661 6c73 652c 0a20 2020 2020 2020  w=False,.       
-0002cce0: 2020 2020 2020 2020 2069 6e63 6c75 6465           include
-0002ccf0: 5f69 6d61 6765 3d69 6e63 6c75 6465 5f69  _image=include_i
-0002cd00: 6d61 6765 2c0a 2020 2020 2020 2020 2020  mage,.          
-0002cd10: 2020 2020 2020 636f 6c6f 723d 636f 6c6f        color=colo
-0002cd20: 722c 0a20 2020 2020 2020 2020 2020 2020  r,.             
-0002cd30: 2020 202a 2a6b 7761 7267 732c 0a20 2020     **kwargs,.   
-0002cd40: 2020 2020 2020 2020 2029 0a0a 2020 2020           )..    
-0002cd50: 2020 2020 2320 506c 6f74 2061 2063 6f6e      # Plot a con
-0002cd60: 746f 7572 0a20 2020 2020 2020 2065 6c69  tour.        eli
-0002cd70: 6620 706c 6f74 5f74 7970 6520 696e 205b  f plot_type in [
-0002cd80: 2263 6f6e 746f 7572 222c 2022 6365 6e74  "contour", "cent
-0002cd90: 726f 6964 225d 3a0a 2020 2020 2020 2020  roid"]:.        
-0002cda0: 2020 2020 7365 6c66 2e5f 706c 6f74 5f63      self._plot_c
-0002cdb0: 6f6e 746f 7572 280a 2020 2020 2020 2020  ontour(.        
-0002cdc0: 2020 2020 2020 2020 7669 6577 2c0a 2020          view,.  
-0002cdd0: 2020 2020 2020 2020 2020 2020 2020 6964                id
-0002cde0: 782c 0a20 2020 2020 2020 2020 2020 2020  x,.             
-0002cdf0: 2020 2063 6f6e 746f 7572 5f6b 7761 7267     contour_kwarg
-0002ce00: 732c 0a20 2020 2020 2020 2020 2020 2020  s,.             
-0002ce10: 2020 206c 696e 6577 6964 7468 2c0a 2020     linewidth,.  
-0002ce20: 2020 2020 2020 2020 2020 2020 2020 6365                ce
-0002ce30: 6e74 726f 6964 3d73 686f 775f 6365 6e74  ntroid=show_cent
-0002ce40: 726f 6964 2c0a 2020 2020 2020 2020 2020  roid,.          
-0002ce50: 2020 2020 2020 7a6f 6f6d 3d7a 6f6f 6d2c        zoom=zoom,
-0002ce60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0002ce70: 207a 6f6f 6d5f 6365 6e74 7265 3d7a 6f6f   zoom_centre=zoo
-0002ce80: 6d5f 6365 6e74 7265 2c0a 2020 2020 2020  m_centre,.      
-0002ce90: 2020 2020 2020 2020 2020 636f 6c6f 723d            color=
-0002cea0: 636f 6c6f 722c 0a20 2020 2020 2020 2020  color,.         
-0002ceb0: 2020 2020 2020 2073 686f 773d 4661 6c73         show=Fals
-0002cec0: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
-0002ced0: 2020 2069 6e63 6c75 6465 5f69 6d61 6765     include_image
-0002cee0: 3d69 6e63 6c75 6465 5f69 6d61 6765 2c0a  =include_image,.
-0002cef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002cf00: 2a2a 6b77 6172 6773 2c0a 2020 2020 2020  **kwargs,.      
-0002cf10: 2020 2020 2020 290a 0a20 2020 2020 2020        )..       
-0002cf20: 2023 2050 6c6f 7420 7472 616e 7370 6172   # Plot transpar
-0002cf30: 656e 7420 6d61 736b 202b 2063 6f6e 746f  ent mask + conto
-0002cf40: 7572 0a20 2020 2020 2020 2065 6c69 6620  ur.        elif 
-0002cf50: 2266 696c 6c65 6422 2069 6e20 706c 6f74  "filled" in plot
-0002cf60: 5f74 7970 653a 0a20 2020 2020 2020 2020  _type:.         
-0002cf70: 2020 2069 6620 6f70 6163 6974 7920 6973     if opacity is
-0002cf80: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-0002cf90: 2020 2020 2020 206f 7061 6369 7479 203d         opacity =
-0002cfa0: 2030 2e33 0a20 2020 2020 2020 2020 2020   0.3.           
-0002cfb0: 2073 656c 662e 5f70 6c6f 745f 6d61 736b   self._plot_mask
-0002cfc0: 2876 6965 772c 2069 6478 2c20 6d61 736b  (view, idx, mask
-0002cfd0: 5f6b 7761 7267 732c 206f 7061 6369 7479  _kwargs, opacity
-0002cfe0: 2c20 636f 6c6f 723d 636f 6c6f 722c 0a20  , color=color,. 
-0002cff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002d000: 2020 2020 2020 2020 2020 7368 6f77 3d46            show=F
-0002d010: 616c 7365 2c20 696e 636c 7564 655f 696d  alse, include_im
-0002d020: 6167 653d 696e 636c 7564 655f 696d 6167  age=include_imag
-0002d030: 652c 202a 2a6b 7761 7267 7329 0a20 2020  e, **kwargs).   
-0002d040: 2020 2020 2020 2020 206b 7761 7267 735b           kwargs[
-0002d050: 2261 7822 5d20 3d20 7365 6c66 2e61 780a  "ax"] = self.ax.
-0002d060: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0002d070: 2e5f 706c 6f74 5f63 6f6e 746f 7572 280a  ._plot_contour(.
-0002d080: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002d090: 7669 6577 2c0a 2020 2020 2020 2020 2020  view,.          
-0002d0a0: 2020 2020 2020 6964 782c 0a20 2020 2020        idx,.     
-0002d0b0: 2020 2020 2020 2020 2020 2063 6f6e 746f             conto
-0002d0c0: 7572 5f6b 7761 7267 732c 0a20 2020 2020  ur_kwargs,.     
-0002d0d0: 2020 2020 2020 2020 2020 206c 696e 6577             linew
-0002d0e0: 6964 7468 2c0a 2020 2020 2020 2020 2020  idth,.          
-0002d0f0: 2020 2020 2020 6365 6e74 726f 6964 3d73        centroid=s
-0002d100: 686f 775f 6365 6e74 726f 6964 2c0a 2020  how_centroid,.  
-0002d110: 2020 2020 2020 2020 2020 2020 2020 7a6f                zo
-0002d120: 6f6d 3d7a 6f6f 6d2c 0a20 2020 2020 2020  om=zoom,.       
-0002d130: 2020 2020 2020 2020 207a 6f6f 6d5f 6365           zoom_ce
-0002d140: 6e74 7265 3d7a 6f6f 6d5f 6365 6e74 7265  ntre=zoom_centre
-0002d150: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0002d160: 2020 636f 6c6f 723d 636f 6c6f 722c 0a20    color=color,. 
-0002d170: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0002d180: 686f 773d 4661 6c73 652c 0a20 2020 2020  how=False,.     
-0002d190: 2020 2020 2020 2020 2020 2069 6e63 6c75             inclu
-0002d1a0: 6465 5f69 6d61 6765 3d46 616c 7365 2c0a  de_image=False,.
-0002d1b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002d1c0: 2a2a 6b77 6172 6773 2c0a 2020 2020 2020  **kwargs,.      
-0002d1d0: 2020 2020 2020 290a 0a20 2020 2020 2020        )..       
-0002d1e0: 2023 2043 6865 636b 2077 6865 7468 6572   # Check whether
-0002d1f0: 2079 2061 7869 7320 6e65 6564 7320 746f   y axis needs to
-0002d200: 2062 6520 696e 7665 7274 6564 0a20 2020   be inverted.   
-0002d210: 2020 2020 2069 6620 7669 6577 203d 3d20       if view == 
-0002d220: 2278 2d79 2220 616e 6420 7365 6c66 2e61  "x-y" and self.a
-0002d230: 782e 6765 745f 796c 696d 2829 5b31 5d20  x.get_ylim()[1] 
-0002d240: 3e20 7365 6c66 2e61 782e 6765 745f 796c  > self.ax.get_yl
-0002d250: 696d 2829 5b30 5d3a 0a20 2020 2020 2020  im()[0]:.       
-0002d260: 2020 2020 2073 656c 662e 6178 2e69 6e76       self.ax.inv
-0002d270: 6572 745f 7961 7869 7328 290a 0a20 2020  ert_yaxis()..   
-0002d280: 2020 2020 2023 2044 7261 7720 6c65 6765       # Draw lege
-0002d290: 6e64 0a20 2020 2020 2020 206c 6567 656e  nd.        legen
-0002d2a0: 6420 3d20 6b77 6172 6773 2e67 6574 2822  d = kwargs.get("
-0002d2b0: 6c65 6765 6e64 222c 2046 616c 7365 290a  legend", False).
-0002d2c0: 2020 2020 2020 2020 6966 206c 6567 656e          if legen
-0002d2d0: 643a 0a20 2020 2020 2020 2020 2020 206e  d:.            n
-0002d2e0: 616d 6520 3d20 6b77 6172 6773 2e67 6574  ame = kwargs.get
-0002d2f0: 2822 6e61 6d65 222c 2073 656c 662e 6e61  ("name", self.na
-0002d300: 6d65 290a 2020 2020 2020 2020 2020 2020  me).            
-0002d310: 726f 695f 6861 6e64 6c65 203d 2073 656c  roi_handle = sel
-0002d320: 662e 6765 745f 7061 7463 6828 0a20 2020  f.get_patch(.   
-0002d330: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002d340: 2070 6c6f 745f 7479 7065 2c20 636f 6c6f   plot_type, colo
-0002d350: 722c 206f 7061 6369 7479 2c20 6c69 6e65  r, opacity, line
-0002d360: 7769 6474 682c 206e 616d 6529 0a20 2020  width, name).   
-0002d370: 2020 2020 2020 2020 2069 6620 726f 695f           if roi_
-0002d380: 6861 6e64 6c65 3a0a 2020 2020 2020 2020  handle:.        
-0002d390: 2020 2020 2020 2020 6262 6f78 5f74 6f5f          bbox_to_
-0002d3a0: 616e 6368 6f72 203d 206b 7761 7267 732e  anchor = kwargs.
-0002d3b0: 6765 7428 226c 6567 656e 645f 6262 6f78  get("legend_bbox
-0002d3c0: 5f74 6f5f 616e 6368 6f72 222c 204e 6f6e  _to_anchor", Non
-0002d3d0: 6529 0a20 2020 2020 2020 2020 2020 2020  e).             
-0002d3e0: 2020 206c 6f63 203d 206b 7761 7267 732e     loc = kwargs.
-0002d3f0: 6765 7428 226c 6567 656e 645f 6c6f 6322  get("legend_loc"
-0002d400: 2c20 226c 6f77 6572 206c 6566 7422 290a  , "lower left").
-0002d410: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0002d420: 2073 656c 662e 6178 2e6c 6567 656e 6428   self.ax.legend(
-0002d430: 6861 6e64 6c65 733d 5b72 6f69 5f68 616e  handles=[roi_han
-0002d440: 646c 655d 2c0a 2020 2020 2020 2020 2020  dle],.          
-0002d450: 2020 2020 2020 2020 2020 2020 2020 6262                bb
-0002d460: 6f78 5f74 6f5f 616e 6368 6f72 3d62 626f  ox_to_anchor=bbo
-0002d470: 785f 746f 5f61 6e63 686f 722c 206c 6f63  x_to_anchor, loc
-0002d480: 3d6c 6f63 2c0a 2020 2020 2020 2020 2020  =loc,.          
-0002d490: 2020 2020 2020 2020 2020 2020 2020 6661                fa
-0002d4a0: 6365 636f 6c6f 723d 2277 6869 7465 222c  cecolor="white",
-0002d4b0: 2066 7261 6d65 616c 7068 613d 310a 2020   framealpha=1.  
-0002d4c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002d4d0: 2020 2020 2020 290a 0a20 2020 2020 2020        )..       
-0002d4e0: 2023 2044 6973 706c 6179 2069 6d61 6765   # Display image
-0002d4f0: 0a0a 2020 2020 2020 2020 706c 742e 7469  ..        plt.ti
-0002d500: 6768 745f 6c61 796f 7574 2829 0a20 2020  ght_layout().   
-0002d510: 2020 2020 2069 6620 7368 6f77 3a0a 2020       if show:.  
-0002d520: 2020 2020 2020 2020 2020 706c 742e 7368            plt.sh
-0002d530: 6f77 2829 0a0a 2020 2020 2020 2020 2320  ow()..        # 
-0002d540: 5361 7665 2074 6f20 6669 6c65 0a20 2020  Save to file.   
-0002d550: 2020 2020 2069 6620 7361 7665 5f61 733a       if save_as:
-0002d560: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-0002d570: 662e 6669 672e 7361 7665 6669 6728 7361  f.fig.savefig(sa
-0002d580: 7665 5f61 7329 0a20 2020 2020 2020 2020  ve_as).         
-0002d590: 2020 2070 6c74 2e63 6c6f 7365 2829 0a0a     plt.close()..
-0002d5a0: 2020 2020 6465 6620 6765 745f 6475 6d6d      def get_dumm
-0002d5b0: 795f 696d 6167 6528 7365 6c66 2c20 2a2a  y_image(self, **
-0002d5c0: 6b77 6172 6773 293a 0a20 2020 2020 2020  kwargs):.       
-0002d5d0: 2022 2222 4d61 6b65 2061 2064 756d 6d79   """Make a dummy
-0002d5e0: 2069 6d61 6765 2074 6861 7420 636f 7665   image that cove
-0002d5f0: 7273 2074 6865 2061 7265 6120 7370 616e  rs the area span
-0002d600: 6e65 6420 6279 2074 6869 7320 524f 492e  ned by this ROI.
-0002d610: 200a 2020 2020 2020 2020 5265 7475 726e   .        Return
-0002d620: 7320 616e 2049 6d61 6765 206f 626a 6563  s an Image objec
-0002d630: 742e 0a0a 2020 2020 2020 2020 2a2a 5061  t...        **Pa
-0002d640: 7261 6d65 7465 7273 3a2a 2a0a 2020 2020  rameters:**.    
-0002d650: 2020 2020 0a20 2020 2020 2020 2076 6f78      .        vox
-0002d660: 656c 5f73 697a 6520 3a20 6c69 7374 2c20  el_size : list, 
-0002d670: 6465 6661 756c 743d 4e6f 6e65 0a20 2020  default=None.   
-0002d680: 2020 2020 2020 2020 2056 6f78 656c 2073           Voxel s
-0002d690: 697a 6520 696e 206d 6d20 696e 2074 6865  ize in mm in the
-0002d6a0: 2064 756d 6d79 2069 6d61 6765 2069 6e20   dummy image in 
-0002d6b0: 7468 6520 782d 7920 706c 616e 652c 2067  the x-y plane, g
-0002d6c0: 6976 656e 2061 7320 0a20 2020 2020 2020  iven as .       
-0002d6d0: 2020 2020 205b 7678 2c20 7679 5d2e 2049       [vx, vy]. I
-0002d6e0: 6620 3c73 6861 7065 3e20 616e 6420 3c76  f <shape> and <v
-0002d6f0: 6f78 656c 5f73 697a 653e 2061 7265 2062  oxel_size> are b
-0002d700: 6f74 6820 4e6f 6e65 2c20 766f 7865 6c20  oth None, voxel 
-0002d710: 7369 7a65 7320 6f66 0a20 2020 2020 2020  sizes of.       
-0002d720: 2020 2020 205b 312c 2031 5d20 7769 6c6c       [1, 1] will
-0002d730: 2062 6520 7573 6564 2062 7920 6465 6661   be used by defa
-0002d740: 756c 742e 2054 6865 2076 6f78 656c 2073  ult. The voxel s
-0002d750: 697a 6520 696e 2074 6865 207a 2064 6972  ize in the z dir
-0002d760: 6563 7469 6f6e 200a 2020 2020 2020 2020  ection .        
-0002d770: 2020 2020 6973 2064 6566 696e 6564 2062      is defined b
-0002d780: 7920 3c73 6c69 6365 5f74 6869 636b 6e65  y <slice_thickne
-0002d790: 7373 3e2e 0a0a 2020 2020 2020 2020 7368  ss>...        sh
-0002d7a0: 6170 6520 3a20 6c69 7374 2c20 6465 6661  ape : list, defa
-0002d7b0: 756c 743d 4e6f 6e65 0a20 2020 2020 2020  ult=None.       
-0002d7c0: 2020 2020 204e 756d 6265 7220 6f66 2076       Number of v
-0002d7d0: 6f78 656c 7320 696e 2074 6865 2064 756d  oxels in the dum
-0002d7e0: 6d79 2069 6d61 6765 2069 6e20 7468 6520  my image in the 
-0002d7f0: 782d 7920 706c 616e 652c 2067 6976 656e  x-y plane, given
-0002d800: 2061 730a 2020 2020 2020 2020 2020 2020   as.            
-0002d810: 5b6e 782c 206e 795d 2e20 4f6e 6c79 2075  [nx, ny]. Only u
-0002d820: 7365 6420 6966 203c 766f 7865 6c5f 7369  sed if <voxel_si
-0002d830: 7a65 3e20 6973 204e 6f6e 652e 200a 2020  ze> is None. .  
-0002d840: 2020 2020 2020 2020 2020 5468 6520 6e75            The nu
-0002d850: 6d62 6572 206f 6620 766f 7865 6c73 2069  mber of voxels i
-0002d860: 6e20 7468 6520 7a20 6469 7265 6374 696f  n the z directio
-0002d870: 6e20 7769 6c6c 2062 6520 7461 6b65 6e20  n will be taken 
-0002d880: 6672 6f6d 2074 6865 200a 2020 2020 2020  from the .      
-0002d890: 2020 2020 2020 6e75 6d62 6572 206f 6620        number of 
-0002d8a0: 736c 6963 6573 2069 6e20 7468 6520 782d  slices in the x-
-0002d8b0: 7920 636f 6e74 6f75 7273 2064 6963 7469  y contours dicti
-0002d8c0: 6f6e 6172 792e 0a0a 2020 2020 2020 2020  onary...        
-0002d8d0: 6669 6c6c 5f76 616c 203a 2069 6e74 2f66  fill_val : int/f
-0002d8e0: 6c6f 6174 2c20 6465 6661 756c 743d 3165  loat, default=1e
-0002d8f0: 340a 2020 2020 2020 2020 2020 2020 5661  4.            Va
-0002d900: 6c75 6520 7769 7468 2077 6869 6368 2074  lue with which t
-0002d910: 6865 2076 6f78 656c 7320 696e 2074 6865  he voxels in the
-0002d920: 2064 756d 6d79 2069 6d61 6765 2073 686f   dummy image sho
-0002d930: 756c 6420 6265 2066 696c 6c65 642e 200a  uld be filled. .
-0002d940: 0a20 2020 2020 2020 2062 7566 6665 7220  .        buffer 
-0002d950: 3a20 696e 742c 2064 6566 6175 6c74 3d31  : int, default=1
-0002d960: 0a20 2020 2020 2020 2020 2020 204e 756d  .            Num
-0002d970: 6265 7220 6f66 2065 6d70 7479 2062 7566  ber of empty buf
-0002d980: 6665 7220 766f 7865 6c73 2074 6f20 6164  fer voxels to ad
-0002d990: 6420 6f75 7473 6964 6520 7468 6520 524f  d outside the RO
-0002d9a0: 4920 696e 2065 6163 680a 2020 2020 2020  I in each.      
-0002d9b0: 2020 2020 2020 6469 7265 6374 696f 6e2e        direction.
-0002d9c0: 0a0a 2020 2020 2020 2020 736c 6963 655f  ..        slice_
-0002d9d0: 7468 6963 6b6e 6573 7320 3a20 666c 6f61  thickness : floa
-0002d9e0: 742c 2064 6566 6175 6c74 3d4e 6f6e 650a  t, default=None.
-0002d9f0: 2020 2020 2020 2020 2020 2020 566f 7865              Voxe
-0002da00: 6c20 7369 7a65 2069 6e20 6d6d 2069 6e20  l size in mm in 
-0002da10: 7468 6520 6475 6d6d 7920 696d 6167 6520  the dummy image 
-0002da20: 696e 2074 6865 207a 2064 6972 6563 7469  in the z directi
-0002da30: 6f6e 2e20 2049 6620 4e6f 6e65 2c0a 2020  on.  If None,.  
-0002da40: 2020 2020 2020 2020 2020 7468 6520 7661            the va
-0002da50: 6c75 6520 7573 6564 2069 7320 7468 6520  lue used is the 
-0002da60: 6d69 6e69 6d75 6d20 6469 7374 616e 6365  minimum distance
-0002da70: 2062 6574 7765 656e 2073 6c69 6365 2070   between slice p
-0002da80: 6f73 6974 696f 6e73 0a20 2020 2020 2020  ositions.       
-0002da90: 2020 2020 2069 6e20 7468 6520 782d 7920       in the x-y 
-0002daa0: 636f 6e74 6f75 7273 2064 6963 7469 6f6e  contours diction
-0002dab0: 6172 792e 0a20 2020 2020 2020 2022 2222  ary..        """
-0002dac0: 0a0a 2020 2020 2020 2020 6578 7465 6e74  ..        extent
-0002dad0: 7320 3d20 5b73 656c 662e 6765 745f 6578  s = [self.get_ex
-0002dae0: 7465 6e74 2861 783d 6178 2920 666f 7220  tent(ax=ax) for 
-0002daf0: 6178 2069 6e20 736b 7274 2e69 6d61 6765  ax in skrt.image
-0002db00: 2e5f 6178 6573 5d0a 2020 2020 2020 2020  ._axes].        
-0002db10: 736c 6963 655f 7468 6963 6b6e 6573 7320  slice_thickness 
-0002db20: 3d20 6b77 6172 6773 2e70 6f70 2822 736c  = kwargs.pop("sl
-0002db30: 6963 655f 7468 6963 6b6e 6573 7322 2c20  ice_thickness", 
-0002db40: 4e6f 6e65 290a 2020 2020 2020 2020 736c  None).        sl
-0002db50: 6963 655f 7468 6963 6b6e 6573 7320 3d20  ice_thickness = 
-0002db60: 2873 6c69 6365 5f74 6869 636b 6e65 7373  (slice_thickness
-0002db70: 206f 720a 2020 2020 2020 2020 2020 2020   or.            
-0002db80: 2020 2020 7365 6c66 2e67 6574 5f73 6c69      self.get_sli
-0002db90: 6365 5f74 6869 636b 6e65 7373 5f63 6f6e  ce_thickness_con
-0002dba0: 746f 7572 7328 2929 0a20 2020 2020 2020  tours()).       
-0002dbb0: 2072 6574 7572 6e20 6372 6561 7465 5f64   return create_d
-0002dbc0: 756d 6d79 5f69 6d61 6765 2865 7874 656e  ummy_image(exten
-0002dbd0: 7473 2c20 736c 6963 655f 7468 6963 6b6e  ts, slice_thickn
-0002dbe0: 6573 732c 202a 2a6b 7761 7267 7329 0a0a  ess, **kwargs)..
-0002dbf0: 2020 2020 6465 6620 7365 745f 696d 6167      def set_imag
-0002dc00: 655f 746f 5f64 756d 6d79 2873 656c 662c  e_to_dummy(self,
-0002dc10: 202a 2a6b 7761 7267 7329 3a0a 2020 2020   **kwargs):.    
-0002dc20: 2020 2020 2222 2241 7373 6967 6e20 7365      """Assign se
-0002dc30: 6c66 2e69 6d61 6765 2070 726f 7065 7274  lf.image propert
-0002dc40: 7920 746f 2061 2064 756d 6d79 2069 6d61  y to a dummy ima
-0002dc50: 6765 2063 6f76 6572 696e 6720 7468 6520  ge covering the 
-0002dc60: 6172 6561 200a 2020 2020 2020 2020 7370  area .        sp
-0002dc70: 616e 6e65 6420 6279 2074 6869 7320 524f  anned by this RO
-0002dc80: 492e 2054 6865 2052 4f49 2773 206d 6173  I. The ROI's mas
-0002dc90: 6b20 616e 6420 782d 7a2f 792d 7a20 636f  k and x-z/y-z co
-0002dca0: 6e74 6f75 7273 2077 696c 6c20 6265 200a  ntours will be .
-0002dcb0: 2020 2020 2020 2020 636c 6561 7265 6420          cleared 
-0002dcc0: 736f 2074 6861 7420 7468 6579 2077 696c  so that they wil
-0002dcd0: 6c20 6265 2072 6563 7265 6174 6564 2077  l be recreated w
-0002dce0: 6865 6e20 6765 745f 6d61 736b 2829 206f  hen get_mask() o
-0002dcf0: 7220 6765 745f 636f 6e74 6f75 7273 2829  r get_contours()
-0002dd00: 0a20 2020 2020 2020 2061 7265 206e 6578  .        are nex
-0002dd10: 7420 6361 6c6c 6564 2e0a 0a20 2020 2020  t called...     
-0002dd20: 2020 202a 2a50 6172 616d 6574 6572 733a     **Parameters:
-0002dd30: 2a2a 0a20 2020 2020 2020 200a 2020 2020  **.        .    
-0002dd40: 2020 2020 6b77 6172 6773 203a 200a 2020      kwargs : .  
-0002dd50: 2020 2020 2020 2020 2020 4b65 7977 6f72            Keywor
-0002dd60: 6420 6172 6775 6d65 6e74 7320 746f 2070  d arguments to p
-0002dd70: 6173 7320 746f 2073 656c 662e 6765 745f  ass to self.get_
-0002dd80: 6475 6d6d 795f 696d 6167 6528 2920 7768  dummy_image() wh
-0002dd90: 656e 2063 7265 6174 696e 670a 2020 2020  en creating.    
-0002dda0: 2020 2020 2020 2020 7468 6520 6475 6d6d          the dumm
-0002ddb0: 7920 696d 6167 652e 2053 6565 2064 6f63  y image. See doc
-0002ddc0: 756d 656e 7461 7469 6f6e 206f 6620 524f  umentation of RO
-0002ddd0: 492e 6765 745f 6475 6d6d 795f 696d 6167  I.get_dummy_imag
-0002dde0: 6528 292e 0a20 2020 2020 2020 2022 2222  e()..        """
-0002ddf0: 0a0a 2020 2020 2020 2020 2320 4d61 6b65  ..        # Make
-0002de00: 2069 6d61 6765 0a20 2020 2020 2020 2069   image.        i
-0002de10: 6d20 3d20 7365 6c66 2e67 6574 5f64 756d  m = self.get_dum
-0002de20: 6d79 5f69 6d61 6765 282a 2a6b 7761 7267  my_image(**kwarg
-0002de30: 7329 0a0a 2020 2020 2020 2020 2320 436c  s)..        # Cl
-0002de40: 6561 7220 6d61 736b 2061 6e64 2063 6f6e  ear mask and con
-0002de50: 746f 7572 730a 2020 2020 2020 2020 7365  tours.        se
-0002de60: 6c66 2e69 6e70 7574 5f63 6f6e 746f 7572  lf.input_contour
-0002de70: 7320 3d20 7365 6c66 2e63 6f6e 746f 7572  s = self.contour
-0002de80: 735b 2278 2d79 225d 0a20 2020 2020 2020  s["x-y"].       
-0002de90: 2073 656c 662e 636f 6e74 6f75 7273 203d   self.contours =
-0002dea0: 207b 2278 2d79 223a 2073 656c 662e 696e   {"x-y": self.in
-0002deb0: 7075 745f 636f 6e74 6f75 7273 7d0a 2020  put_contours}.  
-0002dec0: 2020 2020 2020 7365 6c66 2e6c 6f61 6465        self.loade
-0002ded0: 645f 6d61 736b 203d 2046 616c 7365 0a20  d_mask = False. 
-0002dee0: 2020 2020 2020 2073 656c 662e 6d61 736b         self.mask
-0002def0: 203d 204e 6f6e 650a 0a20 2020 2020 2020   = None..       
-0002df00: 2023 2041 7373 6967 6e20 696d 6167 650a   # Assign image.
-0002df10: 2020 2020 2020 2020 7365 6c66 2e73 6574          self.set
-0002df20: 5f69 6d61 6765 2869 6d29 0a0a 2020 2020  _image(im)..    
-0002df30: 6465 6620 7365 745f 696d 6167 6528 7365  def set_image(se
-0002df40: 6c66 2c20 696d 293a 0a20 2020 2020 2020  lf, im):.       
-0002df50: 2022 2222 5365 7420 7365 6c66 2e69 6d61   """Set self.ima
-0002df60: 6765 2074 6f20 6120 6769 7665 6e20 696d  ge to a given im
-0002df70: 6167 6520 616e 6420 6164 6a75 7374 2067  age and adjust g
-0002df80: 656f 6d65 7472 6963 2070 726f 7065 7274  eometric propert
-0002df90: 6965 730a 2020 2020 2020 2020 6163 636f  ies.        acco
-0002dfa0: 7264 696e 676c 792e 204e 6f74 6520 7468  rdingly. Note th
-0002dfb0: 6174 2073 656c 662e 6d61 736b 2077 696c  at self.mask wil
-0002dfc0: 6c20 6265 2072 656d 6f76 6564 2069 6620  l be removed if 
-0002dfd0: 7468 6520 6375 7272 656e 7420 6d61 736b  the current mask
-0002dfe0: 2773 200a 2020 2020 2020 2020 7368 6170  's .        shap
-0002dff0: 6520 646f 6573 6e27 7420 6d61 7463 6820  e doesn't match 
-0002e000: 7468 6520 696d 6167 652e 200a 2020 2020  the image. .    
-0002e010: 2020 2020 2222 220a 0a20 2020 2020 2020      """..       
-0002e020: 2073 656c 662e 6c6f 6164 2829 0a20 2020   self.load().   
-0002e030: 2020 2020 2073 656c 662e 696d 6167 6520       self.image 
-0002e040: 3d20 696d 0a20 2020 2020 2020 2073 656c  = im.        sel
-0002e050: 662e 636f 6e74 6f75 7273 5f6f 6e6c 7920  f.contours_only 
-0002e060: 3d20 4661 6c73 650a 2020 2020 2020 2020  = False.        
-0002e070: 6966 2069 6d20 6973 204e 6f6e 653a 0a20  if im is None:. 
-0002e080: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-0002e090: 6e0a 0a20 2020 2020 2020 2023 2053 6574  n..        # Set
-0002e0a0: 2052 4f49 2076 6f78 656c 2073 697a 6520   ROI voxel size 
-0002e0b0: 746f 2074 6861 7420 6f66 206e 6577 2069  to that of new i
-0002e0c0: 6d61 6765 2e0a 2020 2020 2020 2020 2320  mage..        # 
-0002e0d0: 4974 2077 696c 6c20 6265 206e 6565 6465  It will be neede
-0002e0e0: 6420 746f 2064 6566 696e 6520 736c 6963  d to define slic
-0002e0f0: 6520 7468 6963 6b6e 6573 730a 2020 2020  e thickness.    
-0002e100: 2020 2020 2320 696e 2074 6865 2063 6173      # in the cas
-0002e110: 6520 6f66 2061 6e20 524f 4920 7769 7468  e of an ROI with
-0002e120: 2063 6f6e 746f 7572 2873 2920 6174 2061   contour(s) at a
-0002e130: 2073 696e 676c 6520 7a2d 706f 7369 7469   single z-positi
-0002e140: 6f6e 2e0a 2020 2020 2020 2020 7365 6c66  on..        self
-0002e150: 2e76 6f78 656c 5f73 697a 6520 3d20 696d  .voxel_size = im
-0002e160: 2e67 6574 5f76 6f78 656c 5f73 697a 6528  .get_voxel_size(
-0002e170: 290a 0a20 2020 2020 2020 2023 2049 6620  )..        # If 
-0002e180: 7468 6520 7a2d 6469 7374 616e 6365 2062  the z-distance b
-0002e190: 6574 7765 656e 2063 6f6e 746f 7572 7320  etween contours 
-0002e1a0: 6973 2067 7265 6174 6572 2074 6861 6e20  is greater than 
-0002e1b0: 7468 6520 766f 7865 6c0a 2020 2020 2020  the voxel.      
-0002e1c0: 2020 2320 7a2d 6469 6d65 6e73 696f 6e20    # z-dimension 
-0002e1d0: 666f 7220 7468 6520 6e65 7720 696d 6167  for the new imag
-0002e1e0: 652c 2066 6972 7374 2065 6e73 7572 6520  e, first ensure 
-0002e1f0: 7468 6174 2074 6865 2052 4f49 0a20 2020  that the ROI.   
-0002e200: 2020 2020 2023 206d 6173 6b20 6973 2063       # mask is c
-0002e210: 7265 6174 6564 2077 6974 6820 7468 6520  reated with the 
-0002e220: 696e 7465 722d 636f 6e74 6f75 7220 7a2d  inter-contour z-
-0002e230: 6469 7374 616e 6365 2c20 7468 656e 2072  distance, then r
-0002e240: 6573 697a 650a 2020 2020 2020 2020 2320  esize.        # 
-0002e250: 746f 2074 6865 2069 6d61 6765 2076 6f78  to the image vox
-0002e260: 656c 2073 697a 652e 0a20 2020 2020 2020  el size..       
-0002e270: 2069 6620 7365 6c66 2e67 6574 5f73 6c69   if self.get_sli
-0002e280: 6365 5f74 6869 636b 6e65 7373 5f63 6f6e  ce_thickness_con
-0002e290: 746f 7572 7328 2920 3e20 7365 6c66 2e69  tours() > self.i
-0002e2a0: 6d61 6765 2e67 6574 5f76 6f78 656c 5f73  mage.get_voxel_s
-0002e2b0: 697a 6528 295b 325d 3a0a 2020 2020 2020  ize()[2]:.      
-0002e2c0: 2020 2020 2020 6966 206e 6f74 2028 7365        if not (se
-0002e2d0: 6c66 2e6d 6173 6b20 616e 6420 2873 656c  lf.mask and (sel
-0002e2e0: 662e 766f 7865 6c5f 7369 7a65 203d 3d20  f.voxel_size == 
-0002e2f0: 7365 6c66 2e6d 6173 6b2e 766f 7865 6c5f  self.mask.voxel_
-0002e300: 7369 7a65 2929 3a0a 2020 2020 2020 2020  size)):.        
-0002e310: 2020 2020 2020 2020 7365 6c66 2e63 7265          self.cre
-0002e320: 6174 655f 6d61 736b 2876 6f78 656c 5f73  ate_mask(voxel_s
-0002e330: 697a 653d 7365 6c66 2e76 6f78 656c 5f73  ize=self.voxel_s
-0002e340: 697a 655b 303a 325d 2c20 666f 7263 653d  ize[0:2], force=
-0002e350: 5472 7565 290a 2020 2020 2020 2020 2020  True).          
-0002e360: 2020 2020 2020 2320 5468 6520 6d61 736b        # The mask
-0002e370: 2063 7265 6174 696f 6e20 7769 6c6c 2068   creation will h
-0002e380: 6176 6520 7265 6465 6669 6e65 6420 7468  ave redefined th
-0002e390: 6520 696d 6167 6520 6173 736f 6369 6174  e image associat
-0002e3a0: 696f 6e2c 0a20 2020 2020 2020 2020 2020  ion,.           
-0002e3b0: 2020 2020 2023 2073 6f20 7265 6173 7369       # so reassi
-0002e3c0: 676e 2074 6865 206e 6577 2069 6d61 6765  gn the new image
-0002e3d0: 2e0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0002e3e0: 2020 7365 6c66 2e69 6d61 6765 203d 2069    self.image = i
-0002e3f0: 6d0a 2020 2020 2020 2020 2020 2020 7365  m.            se
-0002e400: 6c66 2e6d 6173 6b2e 6d61 7463 685f 7369  lf.mask.match_si
-0002e410: 7a65 2873 656c 662e 696d 6167 652c 206d  ze(self.image, m
-0002e420: 6574 686f 643d 226e 6561 7265 7374 2229  ethod="nearest")
-0002e430: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0002e440: 6861 7361 7474 7228 7365 6c66 2e6d 6173  hasattr(self.mas
-0002e450: 6b2c 2022 6461 7461 2229 3a0a 2020 2020  k, "data"):.    
-0002e460: 2020 2020 2020 2020 2020 2020 6966 206e              if n
-0002e470: 6f74 2073 656c 662e 6d61 736b 2e64 6174  ot self.mask.dat
-0002e480: 612e 6474 7970 6520 3d3d 2062 6f6f 6c3a  a.dtype == bool:
-0002e490: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0002e4a0: 2020 2020 2073 656c 662e 6d61 736b 2e64       self.mask.d
-0002e4b0: 6174 6120 3d20 7365 6c66 2e6d 6173 6b2e  ata = self.mask.
-0002e4c0: 6461 7461 2e61 7374 7970 6528 626f 6f6c  data.astype(bool
-0002e4d0: 290a 0a20 2020 2020 2020 2023 2049 6620  )..        # If 
-0002e4e0: 6120 6d61 736b 2068 6173 2062 6565 6e20  a mask has been 
-0002e4f0: 6c6f 6164 6564 2c20 6275 7420 646f 6573  loaded, but does
-0002e500: 6e27 7420 6d61 7463 6820 7468 6520 696d  n't match the im
-0002e510: 6167 6520 6765 6f6d 6574 7279 2c0a 2020  age geometry,.  
-0002e520: 2020 2020 2020 2320 6465 6c65 7465 2074        # delete t
-0002e530: 6865 206d 6173 6b20 6461 7461 2e20 2028  he mask data.  (
-0002e540: 5468 6973 2073 686f 756c 6420 6d65 616e  This should mean
-0002e550: 2074 6861 7420 7468 6520 7a2d 6469 7374   that the z-dist
-0002e560: 616e 6365 0a20 2020 2020 2020 2023 2062  ance.        # b
-0002e570: 6574 7765 656e 2063 6f6e 746f 7572 7320  etween contours 
-0002e580: 6973 206c 6573 7320 7468 6174 2074 6865  is less that the
-0002e590: 2076 6f78 656c 207a 2d64 696d 656e 7369   voxel z-dimensi
-0002e5a0: 6f6e 2066 6f72 2074 6865 0a20 2020 2020  on for the.     
-0002e5b0: 2020 2023 206e 6577 2069 6d61 6765 2e29     # new image.)
-0002e5c0: 2020 4120 6e65 7720 6d61 736b 2077 696c    A new mask wil
-0002e5d0: 6c20 6265 2063 7265 6174 6564 2061 7420  l be created at 
-0002e5e0: 7468 6520 6e65 7874 2063 616c 6c0a 2020  the next call.  
-0002e5f0: 2020 2020 2020 2320 746f 2061 6363 6573        # to acces
-0002e600: 7320 7468 6520 6d61 736b 2064 6174 612e  s the mask data.
-0002e610: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
-0002e620: 2e6d 6173 6b20 616e 6420 6e6f 7420 696d  .mask and not im
-0002e630: 2e68 6173 5f73 616d 655f 6765 6f6d 6574  .has_same_geomet
-0002e640: 7279 2873 656c 662e 6d61 736b 293a 0a20  ry(self.mask):. 
-0002e650: 2020 2020 2020 2020 2020 2069 6620 6765             if ge
-0002e660: 7461 7474 7228 7365 6c66 2c20 2269 6e70  tattr(self, "inp
-0002e670: 7574 5f63 6f6e 746f 7572 7322 2c20 4e6f  ut_contours", No
-0002e680: 6e65 2920 6973 204e 6f6e 653a 0a20 2020  ne) is None:.   
-0002e690: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-0002e6a0: 662e 696e 7075 745f 636f 6e74 6f75 7273  f.input_contours
-0002e6b0: 203d 2073 656c 662e 6765 745f 636f 6e74   = self.get_cont
-0002e6c0: 6f75 7273 2822 782d 7922 290a 2020 2020  ours("x-y").    
-0002e6d0: 2020 2020 2020 2020 7365 6c66 2e6d 6173          self.mas
-0002e6e0: 6b20 3d20 4e6f 6e65 0a20 2020 2020 2020  k = None.       
-0002e6f0: 2020 2020 2073 656c 662e 6c6f 6164 6564       self.loaded
-0002e700: 5f6d 6173 6b20 3d20 4661 6c73 650a 0a20  _mask = False.. 
-0002e710: 2020 2020 2020 2023 2053 6574 2067 656f         # Set geo
-0002e720: 656d 7472 6963 2069 6e66 6f0a 2020 2020  emtric info.    
-0002e730: 2020 2020 6461 7461 5f73 6861 7065 203d      data_shape =
-0002e740: 2069 6d2e 6765 745f 6461 7461 2829 2e73   im.get_data().s
-0002e750: 6861 7065 0a20 2020 2020 2020 2073 656c  hape.        sel
-0002e760: 662e 7368 6170 6520 3d20 5b64 6174 615f  f.shape = [data_
-0002e770: 7368 6170 655b 315d 2c20 6461 7461 5f73  shape[1], data_s
-0002e780: 6861 7065 5b30 5d2c 2064 6174 615f 7368  hape[0], data_sh
-0002e790: 6170 655b 325d 5d0a 2020 2020 2020 2020  ape[2]].        
-0002e7a0: 7365 6c66 2e76 6f78 656c 5f73 697a 6520  self.voxel_size 
-0002e7b0: 3d20 696d 2e67 6574 5f76 6f78 656c 5f73  = im.get_voxel_s
-0002e7c0: 697a 6528 290a 2020 2020 2020 2020 7365  ize().        se
-0002e7d0: 6c66 2e6f 7269 6769 6e20 3d20 696d 2e67  lf.origin = im.g
-0002e7e0: 6574 5f6f 7269 6769 6e28 290a 2020 2020  et_origin().    
-0002e7f0: 2020 2020 7365 6c66 2e61 6666 696e 6520      self.affine 
-0002e800: 3d20 696d 2e67 6574 5f61 6666 696e 6528  = im.get_affine(
-0002e810: 290a 0a20 2020 2064 6566 2076 6965 7728  )..    def view(
-0002e820: 7365 6c66 2c20 696e 636c 7564 655f 696d  self, include_im
-0002e830: 6167 653d 4661 6c73 652c 2076 6f78 656c  age=False, voxel
-0002e840: 5f73 697a 653d 5b31 2c20 315d 2c20 6275  _size=[1, 1], bu
-0002e850: 6666 6572 3d35 2c20 2a2a 6b77 6172 6773  ffer=5, **kwargs
-0002e860: 293a 0a20 2020 2020 2020 2022 2222 5669  ):.        """Vi
-0002e870: 6577 2074 6865 2052 4f49 2e0a 0a20 2020  ew the ROI...   
-0002e880: 2020 2020 202a 2a50 6172 616d 6574 6572       **Parameter
-0002e890: 733a 2a2a 0a20 2020 2020 2020 200a 2020  s:**.        .  
-0002e8a0: 2020 2020 2020 696e 636c 7564 655f 696d        include_im
-0002e8b0: 6167 6520 3a20 626f 6f6c 2c20 6465 6661  age : bool, defa
-0002e8c0: 756c 743d 5472 7565 0a20 2020 2020 2020  ult=True.       
-0002e8d0: 2020 2020 2049 6620 5472 7565 2061 6e64       If True and
-0002e8e0: 2074 6869 7320 524f 4920 6861 7320 616e   this ROI has an
-0002e8f0: 2061 7373 6f63 6961 7465 6420 696d 6167   associated imag
-0002e900: 6520 2869 6e20 7365 6c66 2e69 6d61 6765  e (in self.image
-0002e910: 292c 0a20 2020 2020 2020 2020 2020 2074  ),.            t
-0002e920: 6865 2069 6d61 6765 2077 696c 6c20 6265  he image will be
-0002e930: 2064 6973 706c 6179 6564 2062 6568 696e   displayed behin
-0002e940: 6420 7468 6520 524f 492e 0a0a 2020 2020  d the ROI...    
-0002e950: 2020 2020 766f 7865 6c5f 7369 7a65 203a      voxel_size :
-0002e960: 206c 6973 742c 2064 6566 6175 6c74 3d5b   list, default=[
-0002e970: 312c 2031 5d0a 2020 2020 2020 2020 2020  1, 1].          
-0002e980: 2020 4966 2074 6865 2052 4f49 2064 6f65    If the ROI doe
-0002e990: 7320 6e6f 7420 6861 7665 2061 6e20 6173  s not have an as
-0002e9a0: 736f 6369 6174 6564 2069 6d61 6765 2061  sociated image a
-0002e9b0: 6e64 2069 7320 6465 7363 7269 6265 6420  nd is described 
-0002e9c0: 6f6e 6c79 0a20 2020 2020 2020 2020 2020  only.           
-0002e9d0: 2062 7920 636f 6e74 6f75 7273 2c20 7468   by contours, th
-0002e9e0: 6973 2077 696c 6c20 6265 2074 6865 2076  is will be the v
-0002e9f0: 6f78 656c 2073 697a 6573 2075 7365 6420  oxel sizes used 
-0002ea00: 696e 2074 6865 2078 2d79 2064 6972 6563  in the x-y direc
-0002ea10: 7469 6f6e 0a20 2020 2020 2020 2020 2020  tion.           
-0002ea20: 2077 6865 6e20 636f 6e76 6572 7469 6e67   when converting
-0002ea30: 2074 6865 2052 4f49 2074 6f20 6120 6d61   the ROI to a ma
-0002ea40: 736b 2069 6620 6120 6d61 736b 2070 6c6f  sk if a mask plo
-0002ea50: 7420 7479 7065 2069 7320 7365 6c65 6374  t type is select
-0002ea60: 6564 2e0a 0a20 2020 2020 2020 2062 7566  ed...        buf
-0002ea70: 6665 7220 3a20 696e 742c 2064 6566 6175  fer : int, defau
-0002ea80: 6c74 3d35 0a20 2020 2020 2020 2020 2020  lt=5.           
-0002ea90: 2049 6620 7468 6520 524f 4920 646f 6573   If the ROI does
-0002eaa0: 206e 6f74 2068 6176 6520 616e 2061 7373   not have an ass
-0002eab0: 6f63 6961 7465 6420 696d 6167 6520 616e  ociated image an
-0002eac0: 6420 6973 2064 6573 6372 6962 6564 206f  d is described o
-0002ead0: 6e6c 790a 2020 2020 2020 2020 2020 2020  nly.            
-0002eae0: 6279 2063 6f6e 746f 7572 732c 2074 6869  by contours, thi
-0002eaf0: 7320 7769 6c6c 2062 6520 7468 6520 6e75  s will be the nu
-0002eb00: 6d62 6572 206f 6620 6275 6666 6572 2076  mber of buffer v
-0002eb10: 6f78 656c 7320 0a20 2020 2020 2020 2020  oxels .         
-0002eb20: 2020 2028 692e 652e 2077 6869 7465 7370     (i.e. whitesp
-0002eb30: 6163 6529 2064 6973 706c 6179 6564 2061  ace) displayed a
-0002eb40: 726f 756e 6420 7468 6520 524f 492e 0a20  round the ROI.. 
-0002eb50: 2020 2020 2020 2022 2222 0a0a 2020 2020         """..    
-0002eb60: 2020 2020 6672 6f6d 2073 6b72 742e 6265      from skrt.be
-0002eb70: 7474 6572 5f76 6965 7765 7220 696d 706f  tter_viewer impo
-0002eb80: 7274 2042 6574 7465 7256 6965 7765 720a  rt BetterViewer.
-0002eb90: 2020 2020 2020 2020 7365 6c66 2e6c 6f61          self.loa
-0002eba0: 6428 290a 2020 2020 2020 2020 0a20 2020  d().        .   
-0002ebb0: 2020 2020 2023 2053 6574 2069 6e69 7469       # Set initi
-0002ebc0: 616c 207a 6f6f 6d20 616d 6f75 6e74 2061  al zoom amount a
-0002ebd0: 6e64 2063 656e 7472 650a 2020 2020 2020  nd centre.      
-0002ebe0: 2020 6966 2073 656c 662e 696d 6167 6520    if self.image 
-0002ebf0: 6973 206e 6f74 204e 6f6e 6520 616e 6420  is not None and 
-0002ec00: 6e6f 7420 7365 6c66 2e63 6f6e 746f 7572  not self.contour
-0002ec10: 735f 6f6e 6c79 3a0a 2020 2020 2020 2020  s_only:.        
-0002ec20: 2020 2020 7669 6577 203d 206b 7761 7267      view = kwarg
-0002ec30: 732e 6765 7428 2269 6e69 745f 7669 6577  s.get("init_view
-0002ec40: 222c 2022 782d 7922 290a 2020 2020 2020  ", "x-y").      
-0002ec50: 2020 2020 2020 6178 6573 203d 2073 6b72        axes = skr
-0002ec60: 742e 696d 6167 652e 5f70 6c6f 745f 6178  t.image._plot_ax
-0002ec70: 6573 5b76 6965 775d 0a20 2020 2020 2020  es[view].       
-0002ec80: 2020 2020 2065 7874 656e 7473 203d 205b       extents = [
-0002ec90: 7365 6c66 2e67 6574 5f6c 656e 6774 6828  self.get_length(
-0002eca0: 6178 3d61 7829 2066 6f72 2061 7820 696e  ax=ax) for ax in
-0002ecb0: 2061 7865 735d 0a20 2020 2020 2020 2020   axes].         
-0002ecc0: 2020 2069 6d5f 6c69 6d73 203d 205b 7365     im_lims = [se
-0002ecd0: 6c66 2e69 6d61 6765 2e67 6574 5f6c 656e  lf.image.get_len
-0002ece0: 6774 6828 6178 3d61 7829 2066 6f72 2061  gth(ax=ax) for a
-0002ecf0: 7820 696e 2061 7865 735d 0a20 2020 2020  x in axes].     
-0002ed00: 2020 2020 2020 207a 6f6f 6d20 3d20 6d69         zoom = mi
-0002ed10: 6e28 5b69 6d5f 6c69 6d73 5b69 5d20 2f20  n([im_lims[i] / 
-0002ed20: 6578 7465 6e74 735b 695d 2066 6f72 2069  extents[i] for i
-0002ed30: 2069 6e20 7261 6e67 6528 3229 5d29 202a   in range(2)]) *
-0002ed40: 2030 2e38 0a20 2020 2020 2020 2020 2020   0.8.           
-0002ed50: 207a 6f6f 6d5f 6365 6e74 7265 203d 2073   zoom_centre = s
-0002ed60: 656c 662e 6765 745f 6365 6e74 7265 2829  elf.get_centre()
-0002ed70: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0002ed80: 7a6f 6f6d 203e 2031 3a0a 2020 2020 2020  zoom > 1:.      
-0002ed90: 2020 2020 2020 2020 2020 6b77 6172 6773            kwargs
-0002eda0: 2e73 6574 6465 6661 756c 7428 227a 6f6f  .setdefault("zoo
-0002edb0: 6d22 2c20 7a6f 6f6d 290a 2020 2020 2020  m", zoom).      
-0002edc0: 2020 2020 2020 2020 2020 6b77 6172 6773            kwargs
-0002edd0: 2e73 6574 6465 6661 756c 7428 227a 6f6f  .setdefault("zoo
-0002ede0: 6d5f 6365 6e74 7265 222c 207a 6f6f 6d5f  m_centre", zoom_
-0002edf0: 6365 6e74 7265 290a 2020 2020 2020 2020  centre).        
-0002ee00: 2020 2020 6966 2022 696e 6974 5f70 6f73      if "init_pos
-0002ee10: 2220 6e6f 7420 696e 206b 7761 7267 7320  " not in kwargs 
-0002ee20: 616e 6420 2269 6e69 745f 736c 6963 6522  and "init_slice"
-0002ee30: 206e 6f74 2069 6e20 6b77 6172 6773 3a0a   not in kwargs:.
-0002ee40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002ee50: 6b77 6172 6773 5b22 696e 6974 5f70 6f73  kwargs["init_pos
-0002ee60: 225d 203d 205c 0a20 2020 2020 2020 2020  "] = \.         
-0002ee70: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0002ee80: 656c 662e 6765 745f 6365 6e74 7265 2829  elf.get_centre()
-0002ee90: 5b73 6b72 742e 696d 6167 652e 5f73 6c69  [skrt.image._sli
-0002eea0: 6365 5f61 7865 735b 7669 6577 5d5d 0a0a  ce_axes[view]]..
-0002eeb0: 2020 2020 2020 2020 6b77 6172 6773 5b22          kwargs["
-0002eec0: 7368 6f77 225d 203d 2046 616c 7365 0a0a  show"] = False..
-0002eed0: 2020 2020 2020 2020 2320 5669 6577 2077          # View w
-0002eee0: 6974 6820 696d 6167 650a 2020 2020 2020  ith image.      
-0002eef0: 2020 6966 2069 6e63 6c75 6465 5f69 6d61    if include_ima
-0002ef00: 6765 2061 6e64 2073 656c 662e 696d 6167  ge and self.imag
-0002ef10: 6520 6973 206e 6f74 204e 6f6e 653a 0a20  e is not None:. 
-0002ef20: 2020 2020 2020 2020 2020 2062 7620 3d20             bv = 
-0002ef30: 4265 7474 6572 5669 6577 6572 2873 656c  BetterViewer(sel
-0002ef40: 662e 696d 6167 652c 2072 6f69 733d 7365  f.image, rois=se
-0002ef50: 6c66 2c20 2a2a 6b77 6172 6773 290a 0a20  lf, **kwargs).. 
-0002ef60: 2020 2020 2020 2023 2056 6965 7720 7769         # View wi
-0002ef70: 7468 6f75 7420 696d 6167 650a 2020 2020  thout image.    
-0002ef80: 2020 2020 656c 7365 3a0a 0a20 2020 2020      else:..     
-0002ef90: 2020 2020 2020 2072 6f69 5f74 6d70 203d         roi_tmp =
-0002efa0: 2073 656c 660a 0a20 2020 2020 2020 2020   self..         
-0002efb0: 2020 2023 204d 616b 6520 6475 6d6d 7920     # Make dummy 
-0002efc0: 696d 6167 6520 666f 7220 6261 636b 6772  image for backgr
-0002efd0: 6f75 6e64 0a20 2020 2020 2020 2020 2020  ound.           
-0002efe0: 2069 6620 7365 6c66 2e63 6f6e 746f 7572   if self.contour
-0002eff0: 735f 6f6e 6c79 3a0a 2020 2020 2020 2020  s_only:.        
-0002f000: 2020 2020 2020 2020 696d 203d 2073 656c          im = sel
-0002f010: 662e 6765 745f 6475 6d6d 795f 696d 6167  f.get_dummy_imag
-0002f020: 6528 0a20 2020 2020 2020 2020 2020 2020  e(.             
-0002f030: 2020 2020 2020 2076 6f78 656c 5f73 697a         voxel_siz
-0002f040: 653d 766f 7865 6c5f 7369 7a65 2c0a 2020  e=voxel_size,.  
-0002f050: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002f060: 2020 6275 6666 6572 3d62 7566 6665 720a    buffer=buffer.
-0002f070: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002f080: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0002f090: 2020 696d 2e74 6974 6c65 203d 2073 656c    im.title = sel
-0002f0a0: 662e 6e61 6d65 0a20 2020 2020 2020 2020  f.name.         
-0002f0b0: 2020 2020 2020 2072 6f69 5f74 6d70 203d         roi_tmp =
-0002f0c0: 2073 656c 662e 636c 6f6e 6528 636f 7079   self.clone(copy
-0002f0d0: 5f64 6174 613d 4661 6c73 6529 0a20 2020  _data=False).   
-0002f0e0: 2020 2020 2020 2020 2020 2020 2072 6f69               roi
-0002f0f0: 5f74 6d70 2e69 6d61 6765 203d 2069 6d0a  _tmp.image = im.
-0002f100: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002f110: 726f 695f 746d 702e 6c6f 6164 2866 6f72  roi_tmp.load(for
-0002f120: 6365 3d54 7275 6529 0a20 2020 2020 2020  ce=True).       
-0002f130: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-0002f140: 2020 2020 2020 2020 2020 2069 6d20 3d20             im = 
-0002f150: 736b 7274 2e69 6d61 6765 2e49 6d61 6765  skrt.image.Image
-0002f160: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-0002f170: 2020 2020 2020 6e70 2e6f 6e65 7328 7365        np.ones(se
-0002f180: 6c66 2e73 6861 7065 2920 2a20 3165 342c  lf.shape) * 1e4,
-0002f190: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0002f1a0: 2020 2020 2061 6666 696e 653d 7365 6c66       affine=self
-0002f1b0: 2e61 6666 696e 652c 0a20 2020 2020 2020  .affine,.       
-0002f1c0: 2020 2020 2020 2020 2020 2020 2074 6974               tit
-0002f1d0: 6c65 3d73 656c 662e 6e61 6d65 0a20 2020  le=self.name.   
-0002f1e0: 2020 2020 2020 2020 2020 2020 2029 0a0a               )..
-0002f1f0: 2020 2020 2020 2020 2020 2020 2320 4372              # Cr
-0002f200: 6561 7465 2076 6965 7765 720a 2020 2020  eate viewer.    
-0002f210: 2020 2020 2020 2020 6276 203d 2042 6574          bv = Bet
-0002f220: 7465 7256 6965 7765 7228 696d 2c20 726f  terViewer(im, ro
-0002f230: 6973 3d72 6f69 5f74 6d70 2c20 2a2a 6b77  is=roi_tmp, **kw
-0002f240: 6172 6773 290a 0a20 2020 2020 2020 2023  args)..        #
-0002f250: 2041 646a 7573 7420 5549 0a20 2020 2020   Adjust UI.     
-0002f260: 2020 2062 762e 6d61 6b65 5f75 6928 6e6f     bv.make_ui(no
-0002f270: 5f72 6f69 3d54 7275 652c 206e 6f5f 696e  _roi=True, no_in
-0002f280: 7465 6e73 6974 793d 5472 7565 290a 2020  tensity=True).  
-0002f290: 2020 2020 2020 6276 2e73 686f 7728 290a        bv.show().
-0002f2a0: 2020 2020 2020 2020 7265 7475 726e 2062          return b
-0002f2b0: 760a 0a20 2020 2064 6566 205f 706c 6f74  v..    def _plot
-0002f2c0: 5f6d 6173 6b28 0a20 2020 2020 2020 2073  _mask(.        s
-0002f2d0: 656c 662c 0a20 2020 2020 2020 2076 6965  elf,.        vie
-0002f2e0: 772c 0a20 2020 2020 2020 2069 6478 2c0a  w,.        idx,.
-0002f2f0: 2020 2020 2020 2020 6d61 736b 5f6b 7761          mask_kwa
-0002f300: 7267 733d 4e6f 6e65 2c0a 2020 2020 2020  rgs=None,.      
-0002f310: 2020 6f70 6163 6974 793d 4e6f 6e65 2c0a    opacity=None,.
-0002f320: 2020 2020 2020 2020 696e 636c 7564 655f          include_
-0002f330: 696d 6167 653d 4661 6c73 652c 0a20 2020  image=False,.   
-0002f340: 2020 2020 207a 6f6f 6d3d 4e6f 6e65 2c0a       zoom=None,.
-0002f350: 2020 2020 2020 2020 7a6f 6f6d 5f63 656e          zoom_cen
-0002f360: 7472 653d 4e6f 6e65 2c0a 2020 2020 2020  tre=None,.      
-0002f370: 2020 636f 6c6f 723d 4e6f 6e65 2c0a 2020    color=None,.  
-0002f380: 2020 2020 2020 666c 6174 7465 6e3d 4661        flatten=Fa
-0002f390: 6c73 652c 0a20 2020 2020 2020 2073 686f  lse,.        sho
-0002f3a0: 773d 5472 7565 2c0a 2020 2020 2020 2020  w=True,.        
-0002f3b0: 2a2a 6b77 6172 6773 2c0a 2020 2020 293a  **kwargs,.    ):
-0002f3c0: 0a20 2020 2020 2020 2022 2222 506c 6f74  .        """Plot
-0002f3d0: 2074 6865 2052 4f49 2061 7320 6120 6d61   the ROI as a ma
-0002f3e0: 736b 2e22 2222 0a0a 2020 2020 2020 2020  sk."""..        
-0002f3f0: 7365 6c66 2e63 7265 6174 655f 6d61 736b  self.create_mask
-0002f400: 2829 0a20 2020 2020 2020 2069 6620 7365  ().        if se
-0002f410: 6c66 2e65 6d70 7479 3a0a 2020 2020 2020  lf.empty:.      
-0002f420: 2020 2020 2020 7265 7475 726e 0a20 2020        return.   
-0002f430: 2020 2020 206d 6173 6b5f 736c 6963 6520       mask_slice 
-0002f440: 3d20 7365 6c66 2e67 6574 5f73 6c69 6365  = self.get_slice
-0002f450: 2876 6965 772c 2069 6478 3d69 6478 2c20  (view, idx=idx, 
-0002f460: 666c 6174 7465 6e3d 666c 6174 7465 6e29  flatten=flatten)
-0002f470: 0a0a 2020 2020 2020 2020 2320 4d61 6b65  ..        # Make
-0002f480: 2063 6f6c 6f72 6d61 700a 2020 2020 2020   colormap.      
-0002f490: 2020 6e6f 726d 203d 206d 6174 706c 6f74    norm = matplot
-0002f4a0: 6c69 622e 636f 6c6f 7273 2e4e 6f72 6d61  lib.colors.Norma
-0002f4b0: 6c69 7a65 2829 0a20 2020 2020 2020 2063  lize().        c
-0002f4c0: 6d61 7020 3d20 6d61 7470 6c6f 746c 6962  map = matplotlib
-0002f4d0: 2e63 6d2e 6873 760a 2020 2020 2020 2020  .cm.hsv.        
-0002f4e0: 735f 636f 6c6f 7273 203d 2063 6d61 7028  s_colors = cmap(
-0002f4f0: 6e6f 726d 286d 6173 6b5f 736c 6963 6529  norm(mask_slice)
-0002f500: 290a 2020 2020 2020 2020 6966 2063 6f6c  ).        if col
-0002f510: 6f72 2069 7320 4e6f 6e65 3a0a 2020 2020  or is None:.    
-0002f520: 2020 2020 2020 2020 636f 6c6f 7220 3d20          color = 
-0002f530: 7365 6c66 2e63 6f6c 6f72 0a20 2020 2020  self.color.     
-0002f540: 2020 2073 5f63 6f6c 6f72 735b 6d61 736b     s_colors[mask
-0002f550: 5f73 6c69 6365 203e 2030 2c20 3a5d 203d  _slice > 0, :] =
-0002f560: 2063 6f6c 6f72 0a20 2020 2020 2020 2073   color.        s
-0002f570: 5f63 6f6c 6f72 735b 6d61 736b 5f73 6c69  _colors[mask_sli
-0002f580: 6365 203d 3d20 302c 203a 5d20 3d20 2830  ce == 0, :] = (0
-0002f590: 2c20 302c 2030 2c20 3029 0a0a 2020 2020  , 0, 0, 0)..    
-0002f5a0: 2020 2020 2320 4765 7420 706c 6f74 7469      # Get plotti
-0002f5b0: 6e67 2061 7267 756d 656e 7473 0a20 2020  ng arguments.   
-0002f5c0: 2020 2020 2069 6620 6d61 736b 5f6b 7761       if mask_kwa
-0002f5d0: 7267 7320 6973 204e 6f6e 653a 0a20 2020  rgs is None:.   
-0002f5e0: 2020 2020 2020 2020 206d 6173 6b5f 6b77           mask_kw
-0002f5f0: 6172 6773 203d 207b 7d0a 2020 2020 2020  args = {}.      
-0002f600: 2020 6d61 736b 5f6b 7761 7267 732e 7365    mask_kwargs.se
-0002f610: 7464 6566 6175 6c74 2822 616c 7068 6122  tdefault("alpha"
-0002f620: 2c20 6f70 6163 6974 7929 0a20 2020 2020  , opacity).     
-0002f630: 2020 206d 6173 6b5f 6b77 6172 6773 2e73     mask_kwargs.s
-0002f640: 6574 6465 6661 756c 7428 2269 6e74 6572  etdefault("inter
-0002f650: 706f 6c61 7469 6f6e 222c 2022 6e6f 6e65  polation", "none
-0002f660: 2229 0a0a 2020 2020 2020 2020 2320 4d61  ")..        # Ma
-0002f670: 6b65 2070 6c6f 740a 2020 2020 2020 2020  ke plot.        
-0002f680: 6966 2069 6e63 6c75 6465 5f69 6d61 6765  if include_image
-0002f690: 2061 6e64 2073 656c 662e 696d 6167 6520   and self.image 
-0002f6a0: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
-0002f6b0: 2020 2020 2020 2020 2069 6d5f 6d61 736b           im_mask
-0002f6c0: 203d 206b 7761 7267 732e 6765 7428 226d   = kwargs.get("m
-0002f6d0: 6173 6b22 2c20 4e6f 6e65 290a 2020 2020  ask", None).    
-0002f6e0: 2020 2020 2020 2020 696d 5f6d 6173 6b65          im_maske
-0002f6f0: 6420 3d20 6b77 6172 6773 2e67 6574 2822  d = kwargs.get("
-0002f700: 6d61 736b 6564 222c 2054 7275 6529 0a20  masked", True). 
-0002f710: 2020 2020 2020 2020 2020 2069 6d5f 696e             im_in
-0002f720: 7665 7274 5f6d 6173 6b20 3d20 6b77 6172  vert_mask = kwar
-0002f730: 6773 2e67 6574 2822 696e 7665 7274 5f6d  gs.get("invert_m
-0002f740: 6173 6b22 2c20 4661 6c73 6529 0a20 2020  ask", False).   
-0002f750: 2020 2020 2020 2020 2069 6d5f 6d61 736b           im_mask
-0002f760: 5f63 6f6c 6f72 203d 206b 7761 7267 732e  _color = kwargs.
-0002f770: 6765 7428 226d 6173 6b5f 636f 6c6f 7222  get("mask_color"
-0002f780: 2c20 2262 6c61 636b 2229 0a20 2020 2020  , "black").     
-0002f790: 2020 2020 2020 2073 656c 662e 696d 6167         self.imag
-0002f7a0: 652e 706c 6f74 2876 6965 772c 2069 6478  e.plot(view, idx
-0002f7b0: 3d69 6478 2c20 6178 3d73 656c 662e 6178  =idx, ax=self.ax
-0002f7c0: 2c20 7368 6f77 3d46 616c 7365 2c0a 2020  , show=False,.  
-0002f7d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002f7e0: 2020 6d61 736b 3d69 6d5f 6d61 736b 2c20    mask=im_mask, 
-0002f7f0: 6d61 736b 6564 3d69 6d5f 6d61 736b 6564  masked=im_masked
-0002f800: 2c20 696e 7665 7274 5f6d 6173 6b3d 696d  , invert_mask=im
-0002f810: 5f69 6e76 6572 745f 6d61 736b 2c0a 2020  _invert_mask,.  
-0002f820: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002f830: 2020 6d61 736b 5f63 6f6c 6f72 3d69 6d5f    mask_color=im_
-0002f840: 6d61 736b 5f63 6f6c 6f72 290a 0a20 2020  mask_color)..   
-0002f850: 2020 2020 2073 656c 662e 6178 2e69 6d73       self.ax.ims
-0002f860: 686f 7728 735f 636f 6c6f 7273 2c20 6578  how(s_colors, ex
-0002f870: 7465 6e74 3d73 656c 662e 6d61 736b 2e70  tent=self.mask.p
-0002f880: 6c6f 745f 6578 7465 6e74 5b76 6965 775d  lot_extent[view]
-0002f890: 2c20 0a20 2020 2020 2020 2020 2020 2020  , .             
-0002f8a0: 2020 2020 2020 2020 2020 2a2a 6d61 736b            **mask
-0002f8b0: 5f6b 7761 7267 7329 0a0a 2020 2020 2020  _kwargs)..      
-0002f8c0: 2020 2320 4164 6a75 7374 2061 7865 730a    # Adjust axes.
-0002f8d0: 2020 2020 2020 2020 736b 7274 2e69 6d61          skrt.ima
-0002f8e0: 6765 2e49 6d61 6765 2e6c 6162 656c 5f61  ge.Image.label_a
-0002f8f0: 7828 7365 6c66 2c20 7669 6577 2c20 6964  x(self, view, id
-0002f900: 782c 202a 2a6b 7761 7267 7329 0a20 2020  x, **kwargs).   
-0002f910: 2020 2020 2073 6b72 742e 696d 6167 652e       skrt.image.
-0002f920: 496d 6167 652e 7a6f 6f6d 5f61 7828 7365  Image.zoom_ax(se
-0002f930: 6c66 2c20 7669 6577 2c20 7a6f 6f6d 2c20  lf, view, zoom, 
-0002f940: 7a6f 6f6d 5f63 656e 7472 6529 0a20 2020  zoom_centre).   
-0002f950: 2020 2020 2069 6620 7368 6f77 3a0a 2020       if show:.  
-0002f960: 2020 2020 2020 2020 2020 706c 742e 7368            plt.sh
-0002f970: 6f77 2829 0a0a 2020 2020 6465 6620 5f70  ow()..    def _p
-0002f980: 6c6f 745f 636f 6e74 6f75 7228 0a20 2020  lot_contour(.   
-0002f990: 2020 2020 2073 656c 662c 0a20 2020 2020       self,.     
-0002f9a0: 2020 2076 6965 772c 0a20 2020 2020 2020     view,.       
-0002f9b0: 2069 6478 2c0a 2020 2020 2020 2020 636f   idx,.        co
-0002f9c0: 6e74 6f75 725f 6b77 6172 6773 3d4e 6f6e  ntour_kwargs=Non
-0002f9d0: 652c 0a20 2020 2020 2020 206c 696e 6577  e,.        linew
-0002f9e0: 6964 7468 3d4e 6f6e 652c 0a20 2020 2020  idth=None,.     
-0002f9f0: 2020 2063 656e 7472 6f69 643d 4661 6c73     centroid=Fals
-0002fa00: 652c 0a20 2020 2020 2020 2069 6e63 6c75  e,.        inclu
-0002fa10: 6465 5f69 6d61 6765 3d46 616c 7365 2c0a  de_image=False,.
-0002fa20: 2020 2020 2020 2020 7a6f 6f6d 3d4e 6f6e          zoom=Non
-0002fa30: 652c 0a20 2020 2020 2020 207a 6f6f 6d5f  e,.        zoom_
-0002fa40: 6365 6e74 7265 3d4e 6f6e 652c 0a20 2020  centre=None,.   
-0002fa50: 2020 2020 2063 6f6c 6f72 3d4e 6f6e 652c       color=None,
-0002fa60: 0a20 2020 2020 2020 2066 6c61 7474 656e  .        flatten
-0002fa70: 3d46 616c 7365 2c0a 2020 2020 2020 2020  =False,.        
-0002fa80: 7368 6f77 3d54 7275 652c 0a20 2020 2020  show=True,.     
-0002fa90: 2020 202a 2a6b 7761 7267 732c 0a20 2020     **kwargs,.   
-0002faa0: 2029 3a0a 2020 2020 2020 2020 2222 2250   ):.        """P
-0002fab0: 6c6f 7420 7468 6520 524f 4920 6173 2061  lot the ROI as a
-0002fac0: 2063 6f6e 746f 7572 2e22 2222 0a0a 2020   contour."""..  
-0002fad0: 2020 2020 2020 7365 6c66 2e6c 6f61 6428        self.load(
-0002fae0: 290a 2020 2020 2020 2020 6966 2028 6e6f  ).        if (no
-0002faf0: 7420 7365 6c66 2e6f 6e5f 736c 6963 6528  t self.on_slice(
-0002fb00: 7669 6577 2c20 6964 783d 6964 7829 2061  view, idx=idx) a
-0002fb10: 6e64 206e 6f74 2066 6c61 7474 656e 2920  nd not flatten) 
-0002fb20: 6f72 2073 656c 662e 656d 7074 793a 0a20  or self.empty:. 
-0002fb30: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-0002fb40: 6e0a 0a20 2020 2020 2020 2063 6f6e 746f  n..        conto
-0002fb50: 7572 5f6b 7761 7267 7320 3d20 7b7d 2069  ur_kwargs = {} i
-0002fb60: 6620 636f 6e74 6f75 725f 6b77 6172 6773  f contour_kwargs
-0002fb70: 2069 7320 4e6f 6e65 2065 6c73 6520 636f   is None else co
-0002fb80: 6e74 6f75 725f 6b77 6172 6773 0a20 2020  ntour_kwargs.   
-0002fb90: 2020 2020 2063 6f6e 746f 7572 5f6b 7761       contour_kwa
-0002fba0: 7267 732e 7365 7464 6566 6175 6c74 2822  rgs.setdefault("
-0002fbb0: 636f 6c6f 7222 2c20 636f 6c6f 7229 0a20  color", color). 
-0002fbc0: 2020 2020 2020 2063 6f6e 746f 7572 5f6b         contour_k
-0002fbd0: 7761 7267 732e 7365 7464 6566 6175 6c74  wargs.setdefault
-0002fbe0: 2822 6c69 6e65 7769 6474 6822 2c20 6c69  ("linewidth", li
-0002fbf0: 6e65 7769 6474 6829 0a0a 2020 2020 2020  newidth)..      
-0002fc00: 2020 2320 506c 6f74 2075 6e64 6572 6c79    # Plot underly
-0002fc10: 696e 6720 696d 6167 650a 2020 2020 2020  ing image.      
-0002fc20: 2020 6966 2069 6e63 6c75 6465 5f69 6d61    if include_ima
-0002fc30: 6765 2061 6e64 2073 656c 662e 696d 6167  ge and self.imag
-0002fc40: 6520 6973 206e 6f74 204e 6f6e 653a 0a20  e is not None:. 
-0002fc50: 2020 2020 2020 2020 2020 2069 6d5f 6d61             im_ma
-0002fc60: 736b 203d 206b 7761 7267 732e 6765 7428  sk = kwargs.get(
-0002fc70: 226d 6173 6b22 2c20 4e6f 6e65 290a 2020  "mask", None).  
-0002fc80: 2020 2020 2020 2020 2020 696d 5f6d 6173            im_mas
-0002fc90: 6b65 6420 3d20 6b77 6172 6773 2e67 6574  ked = kwargs.get
-0002fca0: 2822 6d61 736b 6564 222c 2054 7275 6529  ("masked", True)
-0002fcb0: 0a20 2020 2020 2020 2020 2020 2069 6d5f  .            im_
-0002fcc0: 696e 7665 7274 5f6d 6173 6b20 3d20 6b77  invert_mask = kw
-0002fcd0: 6172 6773 2e67 6574 2822 696e 7665 7274  args.get("invert
-0002fce0: 5f6d 6173 6b22 2c20 4661 6c73 6529 0a20  _mask", False). 
-0002fcf0: 2020 2020 2020 2020 2020 2069 6d5f 6d61             im_ma
-0002fd00: 736b 5f63 6f6c 6f72 203d 206b 7761 7267  sk_color = kwarg
-0002fd10: 732e 6765 7428 226d 6173 6b5f 636f 6c6f  s.get("mask_colo
-0002fd20: 7222 2c20 2262 6c61 636b 2229 0a20 2020  r", "black").   
-0002fd30: 2020 2020 2020 2020 2073 656c 662e 696d           self.im
-0002fd40: 6167 652e 706c 6f74 2876 6965 772c 2069  age.plot(view, i
-0002fd50: 6478 3d69 6478 2c20 6178 3d73 656c 662e  dx=idx, ax=self.
-0002fd60: 6178 2c20 7368 6f77 3d46 616c 7365 2c0a  ax, show=False,.
-0002fd70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002fd80: 2020 2020 6d61 736b 3d69 6d5f 6d61 736b      mask=im_mask
-0002fd90: 2c20 6d61 736b 6564 3d69 6d5f 6d61 736b  , masked=im_mask
-0002fda0: 6564 2c20 696e 7665 7274 5f6d 6173 6b3d  ed, invert_mask=
-0002fdb0: 696d 5f69 6e76 6572 745f 6d61 736b 2c0a  im_invert_mask,.
-0002fdc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002fdd0: 2020 2020 6d61 736b 5f63 6f6c 6f72 3d69      mask_color=i
-0002fde0: 6d5f 6d61 736b 5f63 6f6c 6f72 290a 0a20  m_mask_color).. 
-0002fdf0: 2020 2020 2020 2023 2047 6574 2063 6f6e         # Get con
-0002fe00: 746f 7572 2070 6f69 6e74 730a 2020 2020  tour points.    
-0002fe10: 2020 2020 6966 2066 6c61 7474 656e 3a0a      if flatten:.
-0002fe20: 2020 2020 2020 2020 2020 2020 6d61 736b              mask
-0002fe30: 203d 2073 656c 662e 6765 745f 736c 6963   = self.get_slic
-0002fe40: 6528 7669 6577 2c20 6964 783d 6964 782c  e(view, idx=idx,
-0002fe50: 2066 6c61 7474 656e 3d54 7275 6529 0a20   flatten=True). 
-0002fe60: 2020 2020 2020 2020 2020 2063 6f6e 746f             conto
-0002fe70: 7572 7320 3d20 7365 6c66 2e6d 6173 6b5f  urs = self.mask_
-0002fe80: 746f 5f63 6f6e 746f 7572 7328 6d61 736b  to_contours(mask
-0002fe90: 2c20 7669 6577 2c20 696e 7665 7274 3d54  , view, invert=T
-0002fea0: 7275 6529 0a20 2020 2020 2020 2065 6c73  rue).        els
-0002feb0: 653a 0a20 2020 2020 2020 2020 2020 2063  e:.            c
-0002fec0: 6f6e 746f 7572 7320 3d20 7365 6c66 2e67  ontours = self.g
-0002fed0: 6574 5f63 6f6e 746f 7572 7328 7669 6577  et_contours(view
-0002fee0: 2c20 6964 785f 6173 5f6b 6579 3d54 7275  , idx_as_key=Tru
-0002fef0: 6529 5b69 6478 5d0a 0a20 2020 2020 2020  e)[idx]..       
-0002ff00: 2023 2050 6c6f 7420 636f 6e74 6f75 720a   # Plot contour.
-0002ff10: 2020 2020 2020 2020 666f 7220 706f 696e          for poin
-0002ff20: 7473 2069 6e20 636f 6e74 6f75 7273 3a0a  ts in contours:.
-0002ff30: 2020 2020 2020 2020 2020 2020 706f 696e              poin
-0002ff40: 7473 5f78 203d 205b 705b 305d 2066 6f72  ts_x = [p[0] for
-0002ff50: 2070 2069 6e20 706f 696e 7473 5d0a 2020   p in points].  
-0002ff60: 2020 2020 2020 2020 2020 706f 696e 7473            points
-0002ff70: 5f79 203d 205b 705b 315d 2066 6f72 2070  _y = [p[1] for p
-0002ff80: 2069 6e20 706f 696e 7473 5d0a 2020 2020   in points].    
-0002ff90: 2020 2020 2020 2020 706f 696e 7473 5f78          points_x
-0002ffa0: 2e61 7070 656e 6428 706f 696e 7473 5f78  .append(points_x
-0002ffb0: 5b30 5d29 0a20 2020 2020 2020 2020 2020  [0]).           
-0002ffc0: 2070 6f69 6e74 735f 792e 6170 7065 6e64   points_y.append
-0002ffd0: 2870 6f69 6e74 735f 795b 305d 290a 2020  (points_y[0]).  
-0002ffe0: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
-0002fff0: 782e 706c 6f74 2870 6f69 6e74 735f 782c  x.plot(points_x,
-00030000: 2070 6f69 6e74 735f 792c 202a 2a63 6f6e   points_y, **con
-00030010: 746f 7572 5f6b 7761 7267 7329 0a0a 2020  tour_kwargs)..  
-00030020: 2020 2020 2020 2320 506c 6f74 2063 656e        # Plot cen
-00030030: 7472 6f69 6420 706f 696e 740a 2020 2020  troid point.    
-00030040: 2020 2020 6966 2063 656e 7472 6f69 643a      if centroid:
-00030050: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00030060: 6e6f 7420 666c 6174 7465 6e3a 0a20 2020  not flatten:.   
-00030070: 2020 2020 2020 2020 2020 2020 2063 656e               cen
-00030080: 7472 6f69 645f 706f 696e 7473 203d 2073  troid_points = s
-00030090: 656c 662e 6765 745f 6365 6e74 726f 6964  elf.get_centroid
-000300a0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-000300b0: 2020 2020 2020 7669 6577 2c20 7369 6e67        view, sing
-000300c0: 6c65 5f73 6c69 6365 3d54 7275 652c 2069  le_slice=True, i
-000300d0: 6478 3d69 6478 290a 2020 2020 2020 2020  dx=idx).        
-000300e0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-000300f0: 2020 2020 2020 2020 2020 6365 6e74 726f            centro
-00030100: 6964 5f33 6420 3d20 7365 6c66 2e67 6574  id_3d = self.get
-00030110: 5f63 656e 7472 6f69 6428 290a 2020 2020  _centroid().    
-00030120: 2020 2020 2020 2020 2020 2020 785f 6178              x_ax
-00030130: 2c20 795f 6178 203d 2073 6b72 742e 696d  , y_ax = skrt.im
-00030140: 6167 652e 5f70 6c6f 745f 6178 6573 5b76  age._plot_axes[v
-00030150: 6965 775d 0a20 2020 2020 2020 2020 2020  iew].           
-00030160: 2020 2020 2063 656e 7472 6f69 645f 706f       centroid_po
-00030170: 696e 7473 203d 205b 6365 6e74 726f 6964  ints = [centroid
-00030180: 5f33 645b 785f 6178 5d2c 2063 656e 7472  _3d[x_ax], centr
-00030190: 6f69 645f 3364 5b79 5f61 785d 5d0a 2020  oid_3d[y_ax]].  
-000301a0: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
-000301b0: 782e 706c 6f74 280a 2020 2020 2020 2020  x.plot(.        
-000301c0: 2020 2020 2020 2020 2a63 656e 7472 6f69          *centroi
-000301d0: 645f 706f 696e 7473 2c0a 2020 2020 2020  d_points,.      
-000301e0: 2020 2020 2020 2020 2020 222b 222c 0a20            "+",. 
-000301f0: 2020 2020 2020 2020 2020 2020 2020 202a                 *
-00030200: 2a63 6f6e 746f 7572 5f6b 7761 7267 732c  *contour_kwargs,
-00030210: 0a20 2020 2020 2020 2020 2020 2029 0a0a  .            )..
-00030220: 2020 2020 2020 2020 2320 4164 6a75 7374          # Adjust
-00030230: 2061 7865 730a 2020 2020 2020 2020 7365   axes.        se
-00030240: 6c66 2e61 782e 7365 745f 6173 7065 6374  lf.ax.set_aspect
-00030250: 2822 6571 7561 6c22 290a 2020 2020 2020  ("equal").      
-00030260: 2020 736b 7274 2e69 6d61 6765 2e49 6d61    skrt.image.Ima
-00030270: 6765 2e6c 6162 656c 5f61 7828 7365 6c66  ge.label_ax(self
-00030280: 2c20 7669 6577 2c20 6964 782c 202a 2a6b  , view, idx, **k
-00030290: 7761 7267 7329 0a20 2020 2020 2020 2073  wargs).        s
-000302a0: 6b72 742e 696d 6167 652e 496d 6167 652e  krt.image.Image.
-000302b0: 7a6f 6f6d 5f61 7828 7365 6c66 2c20 7669  zoom_ax(self, vi
-000302c0: 6577 2c20 7a6f 6f6d 2c20 7a6f 6f6d 5f63  ew, zoom, zoom_c
-000302d0: 656e 7472 6529 0a20 2020 2020 2020 2069  entre).        i
-000302e0: 6620 7368 6f77 3a0a 2020 2020 2020 2020  f show:.        
-000302f0: 2020 2020 706c 742e 7368 6f77 2829 0a0a      plt.show()..
-00030300: 2020 2020 6465 6620 706c 6f74 5f63 6f6d      def plot_com
-00030310: 7061 7269 736f 6e28 0a20 2020 2020 2020  parison(.       
-00030320: 2073 656c 662c 200a 2020 2020 2020 2020   self, .        
-00030330: 6f74 6865 722c 200a 2020 2020 2020 2020  other, .        
-00030340: 7669 6577 3d22 782d 7922 2c0a 2020 2020  view="x-y",.    
-00030350: 2020 2020 736c 3d4e 6f6e 652c 0a20 2020      sl=None,.   
-00030360: 2020 2020 2069 6478 3d4e 6f6e 652c 0a20       idx=None,. 
-00030370: 2020 2020 2020 2070 6f73 3d4e 6f6e 652c         pos=None,
-00030380: 0a20 2020 2020 2020 206d 6964 5f73 6c69  .        mid_sli
-00030390: 6365 5f66 6f72 5f62 6f74 683d 4661 6c73  ce_for_both=Fals
-000303a0: 652c 0a20 2020 2020 2020 206c 6567 656e  e,.        legen
-000303b0: 643d 5472 7565 2c20 0a20 2020 2020 2020  d=True, .       
-000303c0: 2073 6176 655f 6173 3d4e 6f6e 652c 200a   save_as=None, .
-000303d0: 2020 2020 2020 2020 6e61 6d65 733d 4e6f          names=No
-000303e0: 6e65 2c20 0a20 2020 2020 2020 2073 686f  ne, .        sho
-000303f0: 773d 5472 7565 2c20 0a20 2020 2020 2020  w=True, .       
-00030400: 2069 6e63 6c75 6465 5f69 6d61 6765 3d46   include_image=F
-00030410: 616c 7365 2c0a 2020 2020 2020 2020 6c65  alse,.        le
-00030420: 6765 6e64 5f62 626f 785f 746f 5f61 6e63  gend_bbox_to_anc
-00030430: 686f 723d 4e6f 6e65 2c0a 2020 2020 2020  hor=None,.      
-00030440: 2020 6c65 6765 6e64 5f6c 6f63 3d22 6c6f    legend_loc="lo
-00030450: 7765 7220 6c65 6674 222c 0a20 2020 2020  wer left",.     
-00030460: 2020 202a 2a6b 7761 7267 730a 2020 2020     **kwargs.    
-00030470: 293a 0a20 2020 2020 2020 2022 2222 506c  ):.        """Pl
-00030480: 6f74 2063 6f6d 7061 7269 736f 6e20 7769  ot comparison wi
-00030490: 7468 2061 6e6f 7468 6572 2052 4f49 2e20  th another ROI. 
-000304a0: 4966 206e 6f20 736c 2f69 6478 2f70 6f73  If no sl/idx/pos
-000304b0: 2061 7265 2067 6976 656e 2c0a 2020 2020   are given,.    
-000304c0: 2020 2020 7468 6520 6365 6e74 7261 6c20      the central 
-000304d0: 736c 6963 6520 6f66 2074 6869 7320 524f  slice of this RO
-000304e0: 4920 7769 6c6c 2062 6520 706c 6f74 7465  I will be plotte
-000304f0: 642c 2075 6e6c 6573 7320 0a20 2020 2020  d, unless .     
-00030500: 2020 206d 6964 5f73 6c69 6365 5f66 6f72     mid_slice_for
-00030510: 5f62 6f74 683d 5472 7565 2c20 696e 2077  _both=True, in w
-00030520: 6869 6368 2063 6173 6520 7468 6520 6365  hich case the ce
-00030530: 6e74 7261 6c20 736c 6963 6520 6f66 2062  ntral slice of b
-00030540: 6f74 6820 524f 4973 0a20 2020 2020 2020  oth ROIs.       
-00030550: 2077 696c 6c20 6265 2070 6c6f 7474 6564   will be plotted
-00030560: 2028 6576 656e 2074 686f 7567 6820 7468   (even though th
-00030570: 6973 206d 6179 206e 6f74 2063 6f72 7265  is may not corre
-00030580: 7370 6f6e 6420 746f 2074 6865 2073 616d  spond to the sam
-00030590: 6520 0a20 2020 2020 2020 2070 6f69 6e74  e .        point
-000305a0: 2069 6e20 7370 6163 6529 2e0a 0a20 2020   in space)...   
-000305b0: 2020 2020 202a 2a50 6172 616d 6574 6572       **Parameter
-000305c0: 733a 2a2a 0a20 2020 2020 2020 200a 2020  s:**.        .  
-000305d0: 2020 2020 2020 6f74 6865 7220 3a20 524f        other : RO
-000305e0: 490a 2020 2020 2020 2020 2020 2020 4f74  I.            Ot
-000305f0: 6865 7220 524f 4920 7769 7468 2077 6869  her ROI with whi
-00030600: 6368 2074 6f20 706c 6f74 2063 6f6d 7061  ch to plot compa
-00030610: 7269 736f 6e2e 0a0a 2020 2020 2020 2020  rison...        
-00030620: 7669 6577 203a 2073 7472 2c20 6465 6661  view : str, defa
-00030630: 756c 743d 2278 2d79 220a 2020 2020 2020  ult="x-y".      
-00030640: 2020 2020 2020 4f72 6965 6e74 6174 696f        Orientatio
-00030650: 6e20 696e 2077 6869 6368 2074 6f20 706c  n in which to pl
-00030660: 6f74 2052 4f49 732e 200a 0a20 2020 2020  ot ROIs. ..     
-00030670: 2020 2073 6c20 3a20 696e 742c 2064 6566     sl : int, def
-00030680: 6175 6c74 3d4e 6f6e 650a 2020 2020 2020  ault=None.      
-00030690: 2020 2020 2020 536c 6963 6520 6e75 6d62        Slice numb
-000306a0: 6572 2e20 4966 206e 6f6e 6520 6f66 203c  er. If none of <
-000306b0: 736c 3e2c 203c 6964 783e 206f 7220 3c70  sl>, <idx> or <p
-000306c0: 6f73 3e20 6172 6520 7375 7070 6c69 6564  os> are supplied
-000306d0: 2062 7574 0a20 2020 2020 2020 2020 2020   but.           
-000306e0: 203c 7369 6e67 6c65 5f73 6c69 6365 3e20   <single_slice> 
-000306f0: 6973 2054 7275 652c 2074 6865 2063 656e  is True, the cen
-00030700: 7472 616c 2073 6c69 6365 206f 6620 7468  tral slice of th
-00030710: 6520 524f 4920 7769 6c6c 2062 6520 7573  e ROI will be us
-00030720: 6564 2e0a 0a20 2020 2020 2020 2069 6478  ed...        idx
-00030730: 203a 2069 6e74 2c20 6465 6661 756c 743d   : int, default=
-00030740: 4e6f 6e65 0a20 2020 2020 2020 2020 2020  None.           
-00030750: 2041 7272 6179 2069 6e64 6578 206f 6620   Array index of 
-00030760: 736c 6963 652e 2049 6620 6e6f 6e65 206f  slice. If none o
-00030770: 6620 3c73 6c3e 2c20 3c69 6478 3e20 6f72  f <sl>, <idx> or
-00030780: 203c 706f 733e 2061 7265 2073 7570 706c   <pos> are suppl
-00030790: 6965 6420 6275 740a 2020 2020 2020 2020  ied but.        
-000307a0: 2020 2020 3c73 696e 676c 655f 736c 6963      <single_slic
-000307b0: 653e 2069 7320 5472 7565 2c20 7468 6520  e> is True, the 
-000307c0: 6365 6e74 7261 6c20 736c 6963 6520 6f66  central slice of
-000307d0: 2074 6865 2052 4f49 2077 696c 6c20 6265   the ROI will be
-000307e0: 2075 7365 642e 0a0a 2020 2020 2020 2020   used...        
-000307f0: 706f 7320 3a20 666c 6f61 742c 2064 6566  pos : float, def
-00030800: 6175 6c74 3d4e 6f6e 650a 2020 2020 2020  ault=None.      
-00030810: 2020 2020 2020 536c 6963 6520 706f 7369        Slice posi
-00030820: 7469 6f6e 2069 6e20 6d6d 2e20 4966 206e  tion in mm. If n
-00030830: 6f6e 6520 6f66 203c 736c 3e2c 203c 6964  one of <sl>, <id
-00030840: 783e 206f 7220 3c70 6f73 3e20 6172 6520  x> or <pos> are 
-00030850: 7375 7070 6c69 6564 2062 7574 0a20 2020  supplied but.   
-00030860: 2020 2020 2020 2020 203c 7369 6e67 6c65           <single
-00030870: 5f73 6c69 6365 3e20 6973 2054 7275 652c  _slice> is True,
-00030880: 2074 6865 2063 656e 7472 616c 2073 6c69   the central sli
-00030890: 6365 206f 6620 7468 6520 524f 4920 7769  ce of the ROI wi
-000308a0: 6c6c 2062 6520 7573 6564 2e0a 0a20 2020  ll be used...   
-000308b0: 2020 2020 206d 6964 5f73 6c69 6365 5f66       mid_slice_f
-000308c0: 6f72 5f62 6f74 6820 3a20 626f 6f6c 2c20  or_both : bool, 
-000308d0: 6465 6661 756c 743d 4661 6c73 650a 2020  default=False.  
-000308e0: 2020 2020 2020 2020 2020 4966 2054 7275            If Tru
-000308f0: 6520 616e 6420 6e6f 2073 6c2f 6964 782f  e and no sl/idx/
-00030900: 706f 7320 6172 6520 6769 7665 6e2c 2074  pos are given, t
-00030910: 6865 2063 656e 7472 616c 2073 6c69 6365  he central slice
-00030920: 7320 6f66 2062 6f74 680a 2020 2020 2020  s of both.      
-00030930: 2020 2020 2020 524f 4973 2077 696c 6c20        ROIs will 
-00030940: 6265 2070 6c6f 7474 6564 2c20 6576 656e  be plotted, even
-00030950: 2069 6620 7468 6973 2064 6f65 7320 6e6f   if this does no
-00030960: 7420 636f 7272 6573 706f 6e64 2074 6f20  t correspond to 
-00030970: 7468 6520 7361 6d65 0a20 2020 2020 2020  the same.       
-00030980: 2020 2020 2070 6f69 6e74 2069 6e20 7370       point in sp
-00030990: 6163 653b 206f 7468 6572 7769 7365 2c20  ace; otherwise, 
-000309a0: 7468 6520 706f 7369 7469 6f6e 206f 6620  the position of 
-000309b0: 7468 6520 6365 6e74 7261 6c20 736c 6963  the central slic
-000309c0: 6520 6f66 0a20 2020 2020 2020 2020 2020  e of.           
-000309d0: 2074 6869 7320 524f 4920 7769 6c6c 2062   this ROI will b
-000309e0: 6520 706c 6f74 7465 6420 666f 7220 626f  e plotted for bo
-000309f0: 7468 2e0a 0a20 2020 2020 2020 206c 6567  th...        leg
-00030a00: 656e 6420 3a20 626f 6f6c 2c20 6465 6661  end : bool, defa
-00030a10: 756c 743d 5472 7565 0a20 2020 2020 2020  ult=True.       
-00030a20: 2020 2020 2049 6620 5472 7565 2c20 6120       If True, a 
-00030a30: 6c65 6765 6e64 2077 696c 6c20 6265 2061  legend will be a
-00030a40: 6464 6564 2074 6f20 7468 6520 706c 6f74  dded to the plot
-00030a50: 2063 6f6e 7461 696e 696e 6720 7468 6520   containing the 
-00030a60: 6e61 6d65 7320 0a20 2020 2020 2020 2020  names .         
-00030a70: 2020 206f 6620 7468 6520 7477 6f20 524f     of the two RO
-00030a80: 4973 2e0a 0a20 2020 2020 2020 2073 6176  Is...        sav
-00030a90: 655f 6173 203a 2073 7472 2c20 6465 6661  e_as : str, defa
-00030aa0: 756c 743d 4e6f 6e65 0a20 2020 2020 2020  ult=None.       
-00030ab0: 2020 2020 2050 6174 6820 746f 2061 2066       Path to a f
-00030ac0: 696c 6520 6174 2077 6869 6368 2074 6865  ile at which the
-00030ad0: 2070 6c6f 7420 7769 6c6c 2062 6520 7361   plot will be sa
-00030ae0: 7665 642e 2049 6620 4e6f 6e65 2c20 7468  ved. If None, th
-00030af0: 6520 706c 6f74 0a20 2020 2020 2020 2020  e plot.         
-00030b00: 2020 2077 696c 6c20 6e6f 7420 6265 2073     will not be s
-00030b10: 6176 6564 2e0a 0a20 2020 2020 2020 206e  aved...        n
-00030b20: 616d 6573 203a 206c 6973 742c 2064 6566  ames : list, def
-00030b30: 6175 6c74 3d4e 6f6e 650a 2020 2020 2020  ault=None.      
-00030b40: 2020 2020 2020 4375 7374 6f6d 206e 616d        Custom nam
-00030b50: 6573 2074 6f20 7573 6520 666f 7220 7468  es to use for th
-00030b60: 6520 524f 4920 6c65 6765 6e64 2069 6e20  e ROI legend in 
-00030b70: 6f72 6465 7220 5b74 6869 7320 524f 492c  order [this ROI,
-00030b80: 206f 7468 6572 2052 4f49 5d2e 0a20 2020   other ROI]..   
-00030b90: 2020 2020 2020 2020 2049 6620 4e6f 6e65           If None
-00030ba0: 2c20 7468 6520 6e61 6d65 7320 696e 2073  , the names in s
-00030bb0: 656c 662e 6e61 6d65 2061 6e64 2072 6f69  elf.name and roi
-00030bc0: 2e6e 616d 6520 7769 6c6c 2062 6520 7573  .name will be us
-00030bd0: 6564 2e0a 0a20 2020 2020 2020 2073 686f  ed...        sho
-00030be0: 7720 3a20 626f 6f6c 2c20 6465 6661 756c  w : bool, defaul
-00030bf0: 743d 5472 7565 0a20 2020 2020 2020 2020  t=True.         
-00030c00: 2020 2049 6620 5472 7565 2c20 7468 6520     If True, the 
-00030c10: 706c 6f74 2077 696c 6c20 6265 2064 6973  plot will be dis
-00030c20: 706c 6179 6564 2e0a 2020 2020 2020 2020  played..        
-00030c30: 2222 220a 0a20 2020 2020 2020 2023 2045  """..        # E
-00030c40: 6e73 7572 6520 524f 4973 2061 7265 2070  nsure ROIs are p
-00030c50: 6c6f 7474 6564 2069 6e20 6469 6666 6572  lotted in differ
-00030c60: 656e 7420 636f 6c6f 7572 730a 2020 2020  ent colours.    
-00030c70: 2020 2020 6966 2073 656c 662e 636f 6c6f      if self.colo
-00030c80: 7220 3d3d 206f 7468 6572 2e63 6f6c 6f72  r == other.color
-00030c90: 3a0a 2020 2020 2020 2020 2020 2020 726f  :.            ro
-00030ca0: 6932 5f63 6f6c 6f72 203d 2052 4f49 4465  i2_color = ROIDe
-00030cb0: 6661 756c 7473 2829 2e67 6574 5f64 6566  faults().get_def
-00030cc0: 6175 6c74 5f72 6f69 5f63 6f6c 6f72 2829  ault_roi_color()
-00030cd0: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
-00030ce0: 2020 2020 2020 2020 2020 2072 6f69 325f             roi2_
-00030cf0: 636f 6c6f 7220 3d20 6f74 6865 722e 636f  color = other.co
-00030d00: 6c6f 720a 0a20 2020 2020 2020 2023 2047  lor..        # G
-00030d10: 6574 2069 6e64 6578 2074 6f20 706c 6f74  et index to plot
-00030d20: 0a20 2020 2020 2020 207a 5f61 7820 3d20  .        z_ax = 
-00030d30: 736b 7274 2e69 6d61 6765 2e5f 736c 6963  skrt.image._slic
-00030d40: 655f 6178 6573 5b76 6965 775d 0a0a 2020  e_axes[view]..  
-00030d50: 2020 2020 2020 2320 436f 6d70 7574 6520        # Compute 
-00030d60: 706f 7369 7469 6f6e 2069 6e20 6d6d 2074  position in mm t
-00030d70: 6f20 706c 6f74 0a20 2020 2020 2020 2069  o plot.        i
-00030d80: 6620 736c 2069 7320 4e6f 6e65 2061 6e64  f sl is None and
-00030d90: 2070 6f73 2069 7320 4e6f 6e65 2061 6e64   pos is None and
-00030da0: 2069 6478 2069 7320 4e6f 6e65 3a0a 2020   idx is None:.  
-00030db0: 2020 2020 2020 2020 2020 706f 7331 203d            pos1 =
-00030dc0: 2073 656c 662e 6964 785f 746f 5f70 6f73   self.idx_to_pos
-00030dd0: 2873 656c 662e 6765 745f 6d69 645f 6964  (self.get_mid_id
-00030de0: 7828 7669 6577 292c 207a 5f61 7829 0a20  x(view), z_ax). 
-00030df0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-00030e00: 2020 2020 2020 2020 2070 6f73 3120 3d20           pos1 = 
-00030e10: 7365 6c66 2e69 6478 5f74 6f5f 706f 7328  self.idx_to_pos(
-00030e20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00030e30: 2073 656c 662e 6765 745f 6964 7828 7669   self.get_idx(vi
-00030e40: 6577 2c20 736c 3d73 6c2c 2069 6478 3d69  ew, sl=sl, idx=i
-00030e50: 6478 2c20 706f 733d 706f 7329 2c20 0a20  dx, pos=pos), . 
-00030e60: 2020 2020 2020 2020 2020 2020 2020 207a                 z
-00030e70: 5f61 780a 2020 2020 2020 2020 2020 2020  _ax.            
-00030e80: 290a 0a20 2020 2020 2020 2023 2050 6c6f  )..        # Plo
-00030e90: 7420 7468 6520 7361 6d65 2070 6f73 6974  t the same posit
-00030ea0: 696f 6e20 666f 7220 6f74 6865 7220 524f  ion for other RO
-00030eb0: 492c 2075 6e6c 6573 7320 6d69 645f 736c  I, unless mid_sl
-00030ec0: 6963 655f 666f 725f 626f 7468 3d54 7275  ice_for_both=Tru
-00030ed0: 650a 2020 2020 2020 2020 6966 206e 6f74  e.        if not
-00030ee0: 206d 6964 5f73 6c69 6365 5f66 6f72 5f62   mid_slice_for_b
-00030ef0: 6f74 683a 0a20 2020 2020 2020 2020 2020  oth:.           
-00030f00: 2070 6f73 3220 3d20 706f 7331 0a20 2020   pos2 = pos1.   
-00030f10: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-00030f20: 2020 2020 2020 2070 6f73 3220 3d20 6f74         pos2 = ot
-00030f30: 6865 722e 6964 785f 746f 5f70 6f73 286f  her.idx_to_pos(o
-00030f40: 7468 6572 2e67 6574 5f6d 6964 5f69 6478  ther.get_mid_idx
-00030f50: 2876 6965 7729 2c20 7a5f 6178 290a 0a20  (view), z_ax).. 
-00030f60: 2020 2020 2020 2023 2050 6c6f 7420 7365         # Plot se
-00030f70: 6c66 0a20 2020 2020 2020 2073 656c 662e  lf.        self.
-00030f80: 706c 6f74 2873 686f 773d 4661 6c73 652c  plot(show=False,
-00030f90: 2076 6965 773d 7669 6577 2c20 706f 733d   view=view, pos=
-00030fa0: 706f 7331 2c20 696e 636c 7564 655f 696d  pos1, include_im
-00030fb0: 6167 653d 696e 636c 7564 655f 696d 6167  age=include_imag
-00030fc0: 652c 200a 2020 2020 2020 2020 2020 2020  e, .            
-00030fd0: 2020 2020 2020 2a2a 6b77 6172 6773 290a        **kwargs).
-00030fe0: 0a20 2020 2020 2020 2023 2041 646a 7573  .        # Adjus
-00030ff0: 7420 6b77 6172 6773 2066 6f72 2070 6c6f  t kwargs for plo
-00031000: 7474 696e 6720 7365 636f 6e64 2052 4f49  tting second ROI
-00031010: 0a20 2020 2020 2020 206b 7761 7267 735b  .        kwargs[
-00031020: 2261 7822 5d20 3d20 7365 6c66 2e61 780a  "ax"] = self.ax.
-00031030: 2020 2020 2020 2020 6b77 6172 6773 5b22          kwargs["
-00031040: 636f 6c6f 7222 5d20 3d20 726f 6932 5f63  color"] = roi2_c
-00031050: 6f6c 6f72 0a20 2020 2020 2020 206f 7468  olor.        oth
-00031060: 6572 2e70 6c6f 7428 7368 6f77 3d46 616c  er.plot(show=Fal
-00031070: 7365 2c20 7669 6577 3d76 6965 772c 2070  se, view=view, p
-00031080: 6f73 3d70 6f73 322c 2069 6e63 6c75 6465  os=pos2, include
-00031090: 5f69 6d61 6765 3d46 616c 7365 2c20 0a20  _image=False, . 
-000310a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000310b0: 2020 2a2a 6b77 6172 6773 290a 2020 2020    **kwargs).    
-000310c0: 2020 2020 7365 6c66 2e61 782e 7365 745f      self.ax.set_
-000310d0: 7469 746c 6528 7365 6c66 2e67 6574 5f63  title(self.get_c
-000310e0: 6f6d 7061 7269 736f 6e5f 6e61 6d65 286f  omparison_name(o
-000310f0: 7468 6572 2929 0a0a 2020 2020 2020 2020  ther))..        
-00031100: 2320 4372 6561 7465 206c 6567 656e 640a  # Create legend.
-00031110: 2020 2020 2020 2020 6966 206c 6567 656e          if legen
-00031120: 643a 0a20 2020 2020 2020 2020 2020 2070  d:.            p
-00031130: 6c6f 745f 7479 7065 203d 206b 7761 7267  lot_type = kwarg
-00031140: 732e 6765 7428 2270 6c6f 745f 7479 7065  s.get("plot_type
-00031150: 222c 204e 6f6e 6529 0a20 2020 2020 2020  ", None).       
-00031160: 2020 2020 2069 6620 706c 6f74 5f74 7970       if plot_typ
-00031170: 6520 6973 204e 6f6e 653a 0a20 2020 2020  e is None:.     
-00031180: 2020 2020 2020 2020 2020 2070 6c6f 745f             plot_
-00031190: 7479 7065 203d 206b 7761 7267 732e 6765  type = kwargs.ge
-000311a0: 7428 2272 6f69 5f70 6c6f 745f 7479 7065  t("roi_plot_type
-000311b0: 222c 204e 6f6e 6529 0a20 2020 2020 2020  ", None).       
-000311c0: 2020 2020 206c 696e 6577 6964 7468 203d       linewidth =
-000311d0: 206b 7761 7267 732e 6765 7428 226c 696e   kwargs.get("lin
-000311e0: 6577 6964 7468 222c 204e 6f6e 6529 0a20  ewidth", None). 
-000311f0: 2020 2020 2020 2020 2020 206f 7061 6369             opaci
-00031200: 7479 203d 206b 7761 7267 732e 6765 7428  ty = kwargs.get(
-00031210: 226f 7061 6369 7479 222c 204e 6f6e 6529  "opacity", None)
-00031220: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00031230: 6e61 6d65 733a 0a20 2020 2020 2020 2020  names:.         
-00031240: 2020 2020 2020 2072 6f69 315f 6e61 6d65         roi1_name
-00031250: 203d 206e 616d 6573 5b30 5d0a 2020 2020   = names[0].    
-00031260: 2020 2020 2020 2020 2020 2020 726f 6932              roi2
-00031270: 5f6e 616d 6520 3d20 6e61 6d65 735b 315d  _name = names[1]
-00031280: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
-00031290: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-000312a0: 2020 2072 6f69 315f 6e61 6d65 203d 2073     roi1_name = s
-000312b0: 656c 662e 6e61 6d65 0a20 2020 2020 2020  elf.name.       
-000312c0: 2020 2020 2020 2020 2072 6f69 325f 6e61           roi2_na
-000312d0: 6d65 203d 206f 7468 6572 2e6e 616d 650a  me = other.name.
-000312e0: 2020 2020 2020 2020 2020 2020 6861 6e64              hand
-000312f0: 6c65 7320 3d20 5b0a 2020 2020 2020 2020  les = [.        
-00031300: 2020 2020 2020 2020 7365 6c66 2e67 6574          self.get
-00031310: 5f70 6174 6368 280a 2020 2020 2020 2020  _patch(.        
-00031320: 2020 2020 2020 2020 2020 2020 706c 6f74              plot
-00031330: 5f74 7970 652c 2073 656c 662e 636f 6c6f  _type, self.colo
-00031340: 722c 206f 7061 6369 7479 2c20 6c69 6e65  r, opacity, line
-00031350: 7769 6474 682c 2072 6f69 315f 6e61 6d65  width, roi1_name
-00031360: 292c 0a20 2020 2020 2020 2020 2020 2020  ),.             
-00031370: 2020 2073 656c 662e 6765 745f 7061 7463     self.get_patc
-00031380: 6828 0a20 2020 2020 2020 2020 2020 2020  h(.             
-00031390: 2020 2020 2020 2070 6c6f 745f 7479 7065         plot_type
-000313a0: 2c20 726f 6932 5f63 6f6c 6f72 2c20 6f70  , roi2_color, op
-000313b0: 6163 6974 792c 206c 696e 6577 6964 7468  acity, linewidth
-000313c0: 2c20 726f 6932 5f6e 616d 6529 2c0a 2020  , roi2_name),.  
-000313d0: 2020 2020 2020 2020 2020 5d0a 2020 2020            ].    
-000313e0: 2020 2020 2020 2020 7365 6c66 2e61 782e          self.ax.
-000313f0: 6c65 6765 6e64 280a 2020 2020 2020 2020  legend(.        
-00031400: 2020 2020 2020 2020 6861 6e64 6c65 733d          handles=
-00031410: 6861 6e64 6c65 732c 2066 7261 6d65 616c  handles, frameal
-00031420: 7068 613d 312c 2066 6163 6563 6f6c 6f72  pha=1, facecolor
-00031430: 3d22 7768 6974 6522 2c20 0a20 2020 2020  ="white", .     
-00031440: 2020 2020 2020 2020 2020 2062 626f 785f             bbox_
-00031450: 746f 5f61 6e63 686f 723d 6c65 6765 6e64  to_anchor=legend
-00031460: 5f62 626f 785f 746f 5f61 6e63 686f 722c  _bbox_to_anchor,
-00031470: 206c 6f63 3d6c 6567 656e 645f 6c6f 630a   loc=legend_loc.
-00031480: 2020 2020 2020 2020 2020 2020 290a 0a20              ).. 
-00031490: 2020 2020 2020 2023 2053 686f 772f 7361         # Show/sa
-000314a0: 7665 0a20 2020 2020 2020 2069 6620 7368  ve.        if sh
-000314b0: 6f77 3a0a 2020 2020 2020 2020 2020 2020  ow:.            
-000314c0: 706c 742e 7368 6f77 2829 0a20 2020 2020  plt.show().     
-000314d0: 2020 2069 6620 7361 7665 5f61 733a 0a20     if save_as:. 
-000314e0: 2020 2020 2020 2020 2020 2070 6c74 2e74             plt.t
-000314f0: 6967 6874 5f6c 6179 6f75 7428 290a 2020  ight_layout().  
-00031500: 2020 2020 2020 2020 2020 7365 6c66 2e66            self.f
-00031510: 6967 2e73 6176 6566 6967 2873 6176 655f  ig.savefig(save_
-00031520: 6173 290a 0a20 2020 2064 6566 2067 6574  as)..    def get
-00031530: 5f61 7370 6563 745f 7261 7469 6f28 0a20  _aspect_ratio(. 
-00031540: 2020 2020 2020 2073 656c 662c 2076 6965         self, vie
-00031550: 772c 202a 6172 6773 2c20 2a2a 6b77 6172  w, *args, **kwar
-00031560: 6773 0a20 2020 2029 3a0a 2020 2020 2020  gs.    ):.      
-00031570: 2020 2222 2247 6574 2061 7370 6563 7420    """Get aspect 
-00031580: 7261 7469 6f20 666f 7220 7468 6973 2073  ratio for this s
-00031590: 7472 7563 7475 7265 2069 6e20 6120 6769  tructure in a gi
-000315a0: 7665 6e20 6f72 6965 6e74 6174 696f 6e2e  ven orientation.
-000315b0: 2222 220a 0a20 2020 2020 2020 2078 5f61  """..        x_a
-000315c0: 782c 2079 5f61 7820 3d20 736b 7274 2e69  x, y_ax = skrt.i
-000315d0: 6d61 6765 2e5f 706c 6f74 5f61 7865 735b  mage._plot_axes[
-000315e0: 7669 6577 5d0a 2020 2020 2020 2020 7265  view].        re
-000315f0: 7475 726e 2073 656c 662e 6765 745f 6c65  turn self.get_le
-00031600: 6e67 7468 2861 783d 736b 7274 2e69 6d61  ngth(ax=skrt.ima
-00031610: 6765 2e5f 6178 6573 5b78 5f61 785d 2920  ge._axes[x_ax]) 
-00031620: 5c0a 2020 2020 2020 2020 2020 2020 2020  \.              
-00031630: 2020 2f20 7365 6c66 2e67 6574 5f6c 656e    / self.get_len
-00031640: 6774 6828 6178 3d73 6b72 742e 696d 6167  gth(ax=skrt.imag
-00031650: 652e 5f61 7865 735b 795f 6178 5d29 0a0a  e._axes[y_ax])..
-00031660: 2020 2020 6465 6620 7365 745f 6178 2873      def set_ax(s
-00031670: 656c 662c 2070 6c6f 745f 7479 7065 2c20  elf, plot_type, 
-00031680: 696e 636c 7564 655f 696d 6167 652c 202a  include_image, *
-00031690: 6172 6773 2c20 2a2a 6b77 6172 6773 293a  args, **kwargs):
-000316a0: 0a20 2020 2020 2020 2022 2222 5365 7420  .        """Set 
-000316b0: 7570 2061 7865 732e 2222 220a 0a20 2020  up axes."""..   
-000316c0: 2020 2020 2069 6620 706c 6f74 5f74 7970       if plot_typ
-000316d0: 6520 696e 205b 2263 6f6e 746f 7572 222c  e in ["contour",
-000316e0: 2022 6365 6e74 726f 6964 225d 2061 6e64   "centroid"] and
-000316f0: 206e 6f74 2069 6e63 6c75 6465 5f69 6d61   not include_ima
-00031700: 6765 3a0a 2020 2020 2020 2020 2020 2020  ge:.            
-00031710: 6173 7065 6374 5f67 6574 7465 7220 3d20  aspect_getter = 
-00031720: 7365 6c66 2e67 6574 5f61 7370 6563 745f  self.get_aspect_
-00031730: 7261 7469 6f0a 2020 2020 2020 2020 656c  ratio.        el
-00031740: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-00031750: 6966 2073 656c 662e 696d 6167 6520 6973  if self.image is
-00031760: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
-00031770: 2020 2020 2020 2020 2020 2061 7370 6563             aspec
-00031780: 745f 6765 7474 6572 203d 2073 656c 662e  t_getter = self.
-00031790: 696d 6167 652e 6765 745f 706c 6f74 5f61  image.get_plot_a
-000317a0: 7370 6563 745f 7261 7469 6f0a 2020 2020  spect_ratio.    
-000317b0: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-000317c0: 2020 2020 2020 2020 2020 2020 2020 7365                se
-000317d0: 6c66 2e63 7265 6174 655f 6d61 736b 2829  lf.create_mask()
-000317e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000317f0: 2061 7370 6563 745f 6765 7474 6572 203d   aspect_getter =
-00031800: 2073 656c 662e 6d61 736b 2e67 6574 5f70   self.mask.get_p
-00031810: 6c6f 745f 6173 7065 6374 5f72 6174 696f  lot_aspect_ratio
-00031820: 0a20 2020 2020 2020 2073 6b72 742e 696d  .        skrt.im
-00031830: 6167 652e 7365 745f 6178 2873 656c 662c  age.set_ax(self,
-00031840: 202a 6172 6773 2c20 6173 7065 6374 5f67   *args, aspect_g
-00031850: 6574 7465 723d 6173 7065 6374 5f67 6574  etter=aspect_get
-00031860: 7465 722c 202a 2a6b 7761 7267 7329 0a0a  ter, **kwargs)..
-00031870: 2020 2020 6465 6620 6765 745f 7a6f 6f6d      def get_zoom
-00031880: 5f63 656e 7472 6528 7365 6c66 2c20 7669  _centre(self, vi
-00031890: 6577 293a 0a20 2020 2020 2020 2022 2222  ew):.        """
-000318a0: 4765 7420 636f 6f72 6469 6e61 7465 7320  Get coordinates 
-000318b0: 746f 207a 6f6f 6d20 696e 206f 6e20 7468  to zoom in on th
-000318c0: 6973 2052 4f49 2e22 2222 0a0a 2020 2020  is ROI."""..    
-000318d0: 2020 2020 7a6f 6f6d 5f63 656e 7472 6520      zoom_centre 
-000318e0: 3d20 5b4e 6f6e 652c 204e 6f6e 652c 204e  = [None, None, N
-000318f0: 6f6e 655d 0a20 2020 2020 2020 2078 5f61  one].        x_a
-00031900: 782c 2079 5f61 7820 3d20 736b 7274 2e69  x, y_ax = skrt.i
-00031910: 6d61 6765 2e5f 706c 6f74 5f61 7865 735b  mage._plot_axes[
-00031920: 7669 6577 5d0a 2020 2020 2020 2020 782c  view].        x,
-00031930: 2079 203d 2073 656c 662e 6765 745f 6365   y = self.get_ce
-00031940: 6e74 7265 2876 6965 773d 7669 6577 2c20  ntre(view=view, 
-00031950: 7369 6e67 6c65 5f73 6c69 6365 3d54 7275  single_slice=Tru
-00031960: 6529 0a20 2020 2020 2020 207a 6f6f 6d5f  e).        zoom_
-00031970: 6365 6e74 7265 5b78 5f61 785d 203d 2078  centre[x_ax] = x
-00031980: 0a20 2020 2020 2020 207a 6f6f 6d5f 6365  .        zoom_ce
-00031990: 6e74 7265 5b79 5f61 785d 203d 2079 0a20  ntre[y_ax] = y. 
-000319a0: 2020 2020 2020 2072 6574 7572 6e20 7a6f         return zo
-000319b0: 6f6d 5f63 656e 7472 650a 0a20 2020 2064  om_centre..    d
-000319c0: 6566 2077 7269 7465 2873 656c 662c 206f  ef write(self, o
-000319d0: 7574 6e61 6d65 3d4e 6f6e 652c 206f 7574  utname=None, out
-000319e0: 6469 723d 222e 222c 2065 7874 3d4e 6f6e  dir=".", ext=Non
-000319f0: 652c 206f 7665 7277 7269 7465 3d46 616c  e, overwrite=Fal
-00031a00: 7365 2c0a 2020 2020 2020 2020 2020 2020  se,.            
-00031a10: 6865 6164 6572 5f73 6f75 7263 653d 4e6f  header_source=No
-00031a20: 6e65 2c20 7061 7469 656e 745f 6964 3d4e  ne, patient_id=N
-00031a30: 6f6e 652c 2072 6f6f 745f 7569 643d 4e6f  one, root_uid=No
-00031a40: 6e65 2c0a 2020 2020 2020 2020 2020 2020  ne,.            
-00031a50: 7665 7262 6f73 653d 5472 7565 2c20 6865  verbose=True, he
-00031a60: 6164 6572 5f65 7874 7261 733d 7b7d 2c20  ader_extras={}, 
-00031a70: 6b65 6570 5f73 6f75 7263 655f 726f 6973  keep_source_rois
-00031a80: 3d54 7275 652c 202a 2a6b 7761 7267 7329  =True, **kwargs)
-00031a90: 3a0a 0a20 2020 2020 2020 2073 656c 662e  :..        self.
-00031aa0: 6c6f 6164 2829 0a0a 2020 2020 2020 2020  load()..        
-00031ab0: 2320 4765 6e65 7261 7465 206f 7574 7075  # Generate outpu
-00031ac0: 7420 6e61 6d65 2069 6620 6e6f 7420 6769  t name if not gi
-00031ad0: 7665 6e0a 2020 2020 2020 2020 706f 7373  ven.        poss
-00031ae0: 6962 6c65 5f65 7874 203d 205b 222e 6463  ible_ext = [".dc
-00031af0: 6d22 2c20 222e 6e69 692e 677a 222c 2022  m", ".nii.gz", "
-00031b00: 2e6e 6969 222c 2022 2e6e 7079 222c 2022  .nii", ".npy", "
-00031b10: 2e74 7874 225d 0a20 2020 2020 2020 2069  .txt"].        i
-00031b20: 6620 6578 7420 6973 206e 6f74 204e 6f6e  f ext is not Non
-00031b30: 6520 616e 6420 6e6f 7420 6578 742e 7374  e and not ext.st
-00031b40: 6172 7473 7769 7468 2822 2e22 293a 0a20  artswith("."):. 
-00031b50: 2020 2020 2020 2020 2020 2065 7874 203d             ext =
-00031b60: 2066 222e 7b65 7874 7d22 0a20 2020 2020   f".{ext}".     
-00031b70: 2020 2069 6620 6f75 746e 616d 6520 6973     if outname is
-00031b80: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-00031b90: 2020 2069 6620 6578 7420 6973 204e 6f6e     if ext is Non
-00031ba0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-00031bb0: 2020 2065 7874 203d 2022 2e6e 6969 220a     ext = ".nii".
-00031bc0: 2020 2020 2020 2020 2020 2020 656c 7365              else
-00031bd0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00031be0: 2020 6966 2065 7874 206e 6f74 2069 6e20    if ext not in 
-00031bf0: 706f 7373 6962 6c65 5f65 7874 3a0a 2020  possible_ext:.  
-00031c00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00031c10: 2020 7261 6973 6520 5275 6e74 696d 6545    raise RuntimeE
-00031c20: 7272 6f72 2866 2255 6e72 6563 6f67 6e69  rror(f"Unrecogni
-00031c30: 7365 6420 6669 6c65 2065 7874 656e 7369  sed file extensi
-00031c40: 6f6e 3a20 7b65 7874 7d22 290a 2020 2020  on: {ext}").    
-00031c50: 2020 2020 2020 2020 6966 206e 6f74 2065          if not e
-00031c60: 7874 2e73 7461 7274 7377 6974 6828 222e  xt.startswith(".
-00031c70: 2229 3a0a 2020 2020 2020 2020 2020 2020  "):.            
-00031c80: 2020 2020 6578 7420 3d20 6622 2e7b 6578      ext = f".{ex
-00031c90: 747d 220a 2020 2020 2020 2020 2020 2020  t}".            
-00031ca0: 6f75 746e 616d 6520 3d20 6622 7b6f 7574  outname = f"{out
-00031cb0: 6469 727d 2f7b 7365 6c66 2e6e 616d 657d  dir}/{self.name}
-00031cc0: 7b65 7874 7d22 0a0a 2020 2020 2020 2020  {ext}"..        
-00031cd0: 2320 4f74 6865 7277 6973 652c 2069 6e66  # Otherwise, inf
-00031ce0: 6572 2065 7874 656e 7369 6f6e 2066 726f  er extension fro
-00031cf0: 6d20 6669 6c65 6e61 6d65 0a20 2020 2020  m filename.     
-00031d00: 2020 2065 6c73 653a 0a0a 2020 2020 2020     else:..      
-00031d10: 2020 2020 2020 2320 4669 6e64 2061 6e79        # Find any
-00031d20: 206f 6620 7468 6520 7661 6c69 6420 6669   of the valid fi
-00031d30: 6c65 2065 7874 656e 7369 6f6e 730a 2020  le extensions.  
-00031d40: 2020 2020 2020 2020 2020 666f 7220 706f            for po
-00031d50: 7320 696e 2070 6f73 7369 626c 655f 6578  s in possible_ex
-00031d60: 743a 0a20 2020 2020 2020 2020 2020 2020  t:.             
-00031d70: 2020 2069 6620 6f75 746e 616d 652e 656e     if outname.en
-00031d80: 6473 7769 7468 2870 6f73 293a 0a20 2020  dswith(pos):.   
-00031d90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00031da0: 2065 7874 203d 2070 6f73 0a20 2020 2020   ext = pos.     
-00031db0: 2020 2020 2020 2069 6620 6578 7420 6e6f         if ext no
-00031dc0: 7420 696e 2070 6f73 7369 626c 655f 6578  t in possible_ex
-00031dd0: 743a 0a20 2020 2020 2020 2020 2020 2020  t:.             
-00031de0: 2020 2072 6169 7365 2052 756e 7469 6d65     raise Runtime
-00031df0: 4572 726f 7228 6622 556e 7265 636f 676e  Error(f"Unrecogn
-00031e00: 6973 6564 206f 7574 7075 7420 6669 6c65  ised output file
-00031e10: 2074 7970 653a 207b 6f75 746e 616d 657d   type: {outname}
-00031e20: 2229 0a0a 2020 2020 2020 2020 2020 2020  ")..            
-00031e30: 6f75 746e 616d 6520 3d20 6f73 2e70 6174  outname = os.pat
-00031e40: 682e 6a6f 696e 286f 7574 6469 722c 206f  h.join(outdir, o
-00031e50: 7574 6e61 6d65 290a 0a20 2020 2020 2020  utname)..       
-00031e60: 2023 2057 7269 7465 2070 6f69 6e74 7320   # Write points 
-00031e70: 746f 2074 6578 7420 6669 6c65 2c20 696e  to text file, in
-00031e80: 2066 6f72 6d61 7420 7468 6174 2063 616e   format that can
-00031e90: 2062 6520 7265 6164 2062 7920 7472 616e   be read by tran
-00031ea0: 7366 6f72 6d69 780a 2020 2020 2020 2020  sformix.        
-00031eb0: 6966 2065 7874 203d 3d20 222e 7478 7422  if ext == ".txt"
-00031ec0: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
-00031ed0: 6c66 2e67 6574 5f63 6f6e 746f 7572 7328  lf.get_contours(
-00031ee0: 290a 0a20 2020 2020 2020 2020 2020 2070  )..            p
-00031ef0: 6f69 6e74 7320 3d20 5b5d 0a20 2020 2020  oints = [].     
-00031f00: 2020 2020 2020 2066 6f72 207a 2c20 636f         for z, co
-00031f10: 6e74 6f75 7273 2069 6e20 7365 6c66 2e63  ntours in self.c
-00031f20: 6f6e 746f 7572 735b 2278 2d79 225d 2e69  ontours["x-y"].i
-00031f30: 7465 6d73 2829 3a0a 2020 2020 2020 2020  tems():.        
-00031f40: 2020 2020 2020 2020 666f 7220 6964 782c          for idx,
-00031f50: 2063 6f6e 746f 7572 2069 6e20 656e 756d   contour in enum
-00031f60: 6572 6174 6528 636f 6e74 6f75 7273 293a  erate(contours):
-00031f70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00031f80: 2020 2020 2066 6f72 2070 6f69 6e74 2069       for point i
-00031f90: 6e20 636f 6e74 6f75 723a 0a20 2020 2020  n contour:.     
-00031fa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00031fb0: 2020 2023 2041 6464 2074 6872 6565 2064     # Add three d
-00031fc0: 6967 6974 7320 746f 2073 746f 7265 2074  igits to store t
-00031fd0: 6865 2063 6f6e 746f 7572 2069 6e64 6578  he contour index
-00031fe0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00031ff0: 2020 2020 2020 2020 2020 2320 7768 6963            # whic
-00032000: 6820 6973 2075 6e6c 696b 656c 7920 746f  h is unlikely to
-00032010: 206e 6565 6420 6d6f 7265 2074 6861 6e20   need more than 
-00032020: 6120 7369 6e67 6c65 2064 6967 6974 2e0a  a single digit..
-00032030: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00032040: 2020 2020 2020 2020 2320 5468 6973 2068          # This h
-00032050: 6173 206e 6567 6c69 6769 626c 6520 6566  as negligible ef
-00032060: 6665 6374 206f 6e20 7072 6563 6973 696f  fect on precisio
-00032070: 6e2c 0a20 2020 2020 2020 2020 2020 2020  n,.             
-00032080: 2020 2020 2020 2020 2020 2023 2061 6e64             # and
-00032090: 2061 6c6c 6f77 7320 636f 6e74 6f75 722d   allows contour-
-000320a0: 706f 696e 7420 6173 736f 6369 6174 696f  point associatio
-000320b0: 6e73 0a20 2020 2020 2020 2020 2020 2020  ns.             
-000320c0: 2020 2020 2020 2020 2020 2023 2074 6f20             # to 
-000320d0: 6265 2069 6465 6e74 6966 6965 6420 696e  be identified in
-000320e0: 2054 7261 6e73 666f 726d 6978 206f 7574   Transformix out
-000320f0: 7075 742e 0a20 2020 2020 2020 2020 2020  put..           
-00032100: 2020 2020 2020 2020 2020 2020 207a 5f6f               z_o
-00032110: 7574 203d 2066 227b 7a3a 2e33 667d 7b69  ut = f"{z:.3f}{i
-00032120: 6478 3a30 337d 220a 2020 2020 2020 2020  dx:03}".        
-00032130: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00032140: 706f 696e 7473 2e61 7070 656e 6428 6622  points.append(f"
-00032150: 7b70 6f69 6e74 5b30 5d3a 2e33 667d 207b  {point[0]:.3f} {
-00032160: 706f 696e 745b 315d 3a2e 3366 7d20 7b7a  point[1]:.3f} {z
-00032170: 5f6f 7574 7d22 290a 0a20 2020 2020 2020  _out}")..       
-00032180: 2020 2020 2077 6974 6820 6f70 656e 286f       with open(o
-00032190: 7574 6e61 6d65 2c20 2277 2229 2061 7320  utname, "w") as 
-000321a0: 6669 6c65 3a0a 2020 2020 2020 2020 2020  file:.          
-000321b0: 2020 2020 2020 6669 6c65 2e77 7269 7465        file.write
-000321c0: 2822 706f 696e 745c 6e22 290a 2020 2020  ("point\n").    
-000321d0: 2020 2020 2020 2020 2020 2020 6669 6c65              file
-000321e0: 2e77 7269 7465 2866 227b 6c65 6e28 706f  .write(f"{len(po
-000321f0: 696e 7473 297d 5c6e 2229 0a20 2020 2020  ints)}\n").     
-00032200: 2020 2020 2020 2020 2020 2066 696c 652e             file.
-00032210: 7772 6974 6528 225c 6e22 2e6a 6f69 6e28  write("\n".join(
-00032220: 706f 696e 7473 2929 0a0a 2020 2020 2020  points))..      
-00032230: 2020 2020 2020 7265 7475 726e 0a0a 2020        return..  
-00032240: 2020 2020 2020 2320 5772 6974 6520 6172        # Write ar
-00032250: 7261 7920 746f 206e 6966 7469 206f 7220  ray to nifti or 
-00032260: 6e70 790a 2020 2020 2020 2020 656c 6966  npy.        elif
-00032270: 2065 7874 2021 3d20 222e 6463 6d22 3a0a   ext != ".dcm":.
-00032280: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00032290: 2e63 7265 6174 655f 6d61 736b 2829 0a20  .create_mask(). 
-000322a0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-000322b0: 6d61 736b 2e77 7269 7465 286f 7574 6e61  mask.write(outna
-000322c0: 6d65 2c20 7665 7262 6f73 653d 7665 7262  me, verbose=verb
-000322d0: 6f73 652c 202a 2a6b 7761 7267 7329 0a20  ose, **kwargs). 
-000322e0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-000322f0: 2020 2020 2020 2020 2069 6620 6865 6164           if head
-00032300: 6572 5f73 6f75 7263 6520 616e 6420 6b65  er_source and ke
-00032310: 6570 5f73 6f75 7263 655f 726f 6973 3a0a  ep_source_rois:.
-00032320: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00032330: 7374 7275 6374 7572 655f 7365 7420 3d20  structure_set = 
-00032340: 5374 7275 6374 7572 6553 6574 2868 6561  StructureSet(hea
-00032350: 6465 725f 736f 7572 6365 290a 2020 2020  der_source).    
-00032360: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-00032370: 2020 2020 2020 2020 2020 2020 2020 7374                st
-00032380: 7275 6374 7572 655f 7365 7420 3d20 5374  ructure_set = St
-00032390: 7275 6374 7572 6553 6574 2829 0a20 2020  ructureSet().   
-000323a0: 2020 2020 2020 2020 2073 7472 7563 7475           structu
-000323b0: 7265 5f73 6574 2e61 6464 5f72 6f69 2873  re_set.add_roi(s
-000323c0: 656c 6629 0a20 2020 2020 2020 2020 2020  elf).           
-000323d0: 2073 7472 7563 7475 7265 5f73 6574 2e77   structure_set.w
-000323e0: 7269 7465 286f 7574 6469 723d 6f75 7464  rite(outdir=outd
-000323f0: 6972 2c20 6578 743d 6578 742c 206f 7665  ir, ext=ext, ove
-00032400: 7277 7269 7465 3d6f 7665 7277 7269 7465  rwrite=overwrite
-00032410: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00032420: 2020 2020 2020 6865 6164 6572 5f73 6f75        header_sou
-00032430: 7263 653d 6865 6164 6572 5f73 6f75 7263  rce=header_sourc
-00032440: 652c 2070 6174 6965 6e74 5f69 643d 7061  e, patient_id=pa
-00032450: 7469 656e 745f 6964 2c0a 2020 2020 2020  tient_id,.      
-00032460: 2020 2020 2020 2020 2020 2020 2020 726f                ro
-00032470: 6f74 5f75 6964 3d72 6f6f 745f 7569 642c  ot_uid=root_uid,
-00032480: 2076 6572 626f 7365 3d76 6572 626f 7365   verbose=verbose
-00032490: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-000324a0: 2020 2020 2020 6865 6164 6572 5f65 7874        header_ext
-000324b0: 7261 733d 6865 6164 6572 5f65 7874 7261  ras=header_extra
-000324c0: 7329 0a0a 2020 2020 6465 6620 7472 616e  s)..    def tran
-000324d0: 7366 6f72 6d28 7365 6c66 2c20 7363 616c  sform(self, scal
-000324e0: 653d 312c 2074 7261 6e73 6c61 7469 6f6e  e=1, translation
-000324f0: 3d5b 302c 2030 2c20 305d 2c20 726f 7461  =[0, 0, 0], rota
-00032500: 7469 6f6e 3d5b 302c 2030 2c20 305d 2c0a  tion=[0, 0, 0],.
-00032510: 2020 2020 2020 2020 2020 2020 6365 6e74              cent
-00032520: 7265 3d5b 302c 2030 2c20 305d 2c20 7265  re=[0, 0, 0], re
-00032530: 7361 6d70 6c65 3d22 6669 6e65 222c 2072  sample="fine", r
-00032540: 6573 746f 7265 3d54 7275 652c 200a 2020  estore=True, .  
-00032550: 2020 2020 2020 2020 2020 6669 6c6c 5f76            fill_v
-00032560: 616c 7565 3d4e 6f6e 652c 2066 6f72 6365  alue=None, force
-00032570: 5f63 6f6e 746f 7572 733d 4661 6c73 6529  _contours=False)
-00032580: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
-00032590: 2020 2020 2020 4170 706c 7920 7468 7265        Apply thre
-000325a0: 652d 6469 6d65 6e73 696f 6e61 6c20 7369  e-dimensional si
-000325b0: 6d69 6c61 7269 7479 2074 7261 6e73 666f  milarity transfo
-000325c0: 726d 2074 6f20 524f 492e 0a0a 2020 2020  rm to ROI...    
-000325d0: 2020 2020 4966 2074 6865 2074 7261 6e73      If the trans
-000325e0: 666f 726d 2063 6f72 7265 7370 6f6e 6473  form corresponds
-000325f0: 2074 6f20 6120 7472 616e 736c 6174 696f   to a translatio
-00032600: 6e20 616e 642f 6f72 2072 6f74 6174 696f  n and/or rotatio
-00032610: 6e0a 2020 2020 2020 2020 6162 6f75 7420  n.        about 
-00032620: 7468 6520 7a2d 6178 6973 2c20 616e 6420  the z-axis, and 
-00032630: 6569 7468 6572 2074 6865 2072 6f69 2073  either the roi s
-00032640: 6f75 7263 6520 7479 7065 2069 7320 2264  ource type is "d
-00032650: 6963 6f6d 220a 2020 2020 2020 2020 6f72  icom".        or
-00032660: 2066 6f72 6365 2d63 6f6e 746f 7572 7320   force-contours 
-00032670: 6973 2054 7275 652c 2074 6865 2074 7261  is True, the tra
-00032680: 6e73 666f 726d 2069 7320 6170 706c 6965  nsform is applie
-00032690: 6420 746f 2063 6f6e 746f 7572 0a20 2020  d to contour.   
-000326a0: 2020 2020 2070 6f69 6e74 7320 616e 6420       points and 
-000326b0: 7468 6520 726f 6920 6d61 736b 2069 7320  the roi mask is 
-000326c0: 7365 7420 6173 2075 6e6c 6f61 6465 642e  set as unloaded.
-000326d0: 2020 4f74 6865 7277 6973 6520 7468 6520    Otherwise the 
-000326e0: 7472 616e 7366 6f72 6d0a 2020 2020 2020  transform.      
-000326f0: 2020 6973 2061 7070 6c69 6564 2074 6f20    is applied to 
-00032700: 7468 6520 6d61 736b 2061 6e64 2063 6f6e  the mask and con
-00032710: 746f 7572 7320 6172 6520 7365 7420 6173  tours are set as
-00032720: 2075 6e6c 6f61 6465 642e 0a0a 2020 2020   unloaded...    
-00032730: 2020 2020 5468 6520 7472 616e 7366 6f72      The transfor
-00032740: 6d20 6973 2061 7070 6c69 6564 2069 6e20  m is applied in 
-00032750: 7468 6520 6f72 6465 723a 2074 7261 6e73  the order: trans
-00032760: 6c61 7469 6f6e 2c20 7363 616c 696e 672c  lation, scaling,
-00032770: 0a20 2020 2020 2020 2072 6f74 6174 696f  .        rotatio
-00032780: 6e2e 2020 5468 6520 6c61 7474 6572 2074  n.  The latter t
-00032790: 776f 2061 7265 2061 626f 7574 2074 6865  wo are about the
-000327a0: 2063 656e 7472 6520 636f 6f72 6469 6e61   centre coordina
-000327b0: 7465 732e 0a0a 2020 2020 2020 2020 2a2a  tes...        **
-000327c0: 5061 7261 6d65 7465 7273 3a2a 2a0a 2020  Parameters:**.  
-000327d0: 2020 2020 2020 0a20 2020 2020 2020 2066        .        f
-000327e0: 6f72 6365 5f63 6f6e 746f 7572 7320 3a20  orce_contours : 
-000327f0: 626f 6f6c 2c20 6465 6661 756c 743d 4661  bool, default=Fa
-00032800: 6c73 650a 2020 2020 2020 2020 2020 2020  lse.            
-00032810: 4966 2054 7275 652c 2061 6e64 2074 6865  If True, and the
-00032820: 2074 7261 6e73 666f 726d 2063 6f72 7265   transform corre
-00032830: 7370 6f6e 6473 2074 6f20 6120 7472 616e  sponds to a tran
-00032840: 736c 6174 696f 6e0a 2020 2020 2020 2020  slation.        
-00032850: 2020 2020 616e 642f 6f72 2072 6f74 6174      and/or rotat
-00032860: 696f 6e20 6162 6f75 7420 7468 6520 7a2d  ion about the z-
-00032870: 6178 6973 2c20 6170 706c 7920 7472 616e  axis, apply tran
-00032880: 7366 6f72 6d20 746f 2063 6f6e 746f 7572  sform to contour
-00032890: 0a20 2020 2020 2020 2020 2020 2070 6f69  .            poi
-000328a0: 6e74 7320 696e 6465 7065 6e64 656e 746c  nts independentl
-000328b0: 7920 6f66 2074 6865 206f 7269 6769 6e61  y of the origina
-000328c0: 6c20 6461 7461 2073 6f75 7263 652e 0a0a  l data source...
-000328d0: 2020 2020 2020 2020 466f 7220 6f74 6865          For othe
-000328e0: 7220 7061 7261 6d65 7465 7273 2c20 7365  r parameters, se
-000328f0: 6520 646f 6375 6d65 6e74 6174 696f 6e20  e documentation 
-00032900: 666f 720a 2020 2020 2020 2020 736b 7274  for.        skrt
-00032910: 2e69 6d61 6765 2e49 6d61 6765 2e74 7261  .image.Image.tra
-00032920: 6e73 666f 726d 2829 2e20 204e 6f74 6520  nsform().  Note 
-00032930: 7468 6174 2074 6865 2060 606f 7264 6572  that the ``order
-00032940: 6060 0a20 2020 2020 2020 2070 6172 616d  ``.        param
-00032950: 6574 6572 2069 736e 2774 2061 7661 696c  eter isn't avail
-00032960: 6162 6c65 2066 6f72 2072 6f69 2074 7261  able for roi tra
-00032970: 6e73 666f 726d 7320 2d20 6120 7661 6c75  nsforms - a valu
-00032980: 6520 6f66 2030 0a20 2020 2020 2020 2069  e of 0.        i
-00032990: 7320 7573 6564 2061 6c77 6179 732e 0a20  s used always.. 
-000329a0: 2020 2020 2020 2022 2222 0a0a 2020 2020         """..    
-000329b0: 2020 2020 2320 4368 6563 6b20 7768 6574      # Check whet
-000329c0: 6865 7220 7472 616e 7366 6f72 6d20 6973  her transform is
-000329d0: 2074 6f20 6265 2061 7070 6c69 6564 2074   to be applied t
-000329e0: 6f20 636f 6e74 6f75 7273 0a20 2020 2020  o contours.     
-000329f0: 2020 2073 6d61 6c6c 5f6e 756d 6265 7220     small_number 
-00032a00: 3d20 312e 652d 360a 2020 2020 2020 2020  = 1.e-6.        
-00032a10: 7472 616e 7366 6f72 6d5f 636f 6e74 6f75  transform_contou
-00032a20: 7273 203d 2046 616c 7365 0a20 2020 2020  rs = False.     
-00032a30: 2020 2069 6620 7365 6c66 2e73 6f75 7263     if self.sourc
-00032a40: 655f 7479 7065 203d 3d20 2763 6f6e 746f  e_type == 'conto
-00032a50: 7572 2720 6f72 2066 6f72 6365 5f63 6f6e  ur' or force_con
-00032a60: 746f 7572 733a 0a20 2020 2020 2020 2020  tours:.         
-00032a70: 2020 2069 6620 6162 7328 7363 616c 6520     if abs(scale 
-00032a80: 2d20 3129 203c 2073 6d61 6c6c 5f6e 756d  - 1) < small_num
-00032a90: 6265 723a 0a20 2020 2020 2020 2020 2020  ber:.           
-00032aa0: 2020 2020 2069 6620 6162 7328 726f 7461       if abs(rota
-00032ab0: 7469 6f6e 5b30 5d29 203c 2073 6d61 6c6c  tion[0]) < small
-00032ac0: 5f6e 756d 6265 7220 5c0a 2020 2020 2020  _number \.      
-00032ad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00032ae0: 2020 616e 6420 6162 7328 726f 7461 7469    and abs(rotati
-00032af0: 6f6e 5b31 5d29 203c 2073 6d61 6c6c 5f6e  on[1]) < small_n
-00032b00: 756d 6265 723a 0a20 2020 2020 2020 2020  umber:.         
-00032b10: 2020 2020 2020 2020 2020 2074 7261 6e73             trans
-00032b20: 666f 726d 5f63 6f6e 746f 7572 7320 3d20  form_contours = 
-00032b30: 5472 7565 0a0a 2020 2020 2020 2020 6966  True..        if
-00032b40: 2074 7261 6e73 666f 726d 5f63 6f6e 746f   transform_conto
-00032b50: 7572 733a 0a0a 2020 2020 2020 2020 2020  urs:..          
-00032b60: 2020 2320 4170 706c 7920 7472 616e 7366    # Apply transf
-00032b70: 6f72 6d20 746f 2072 6f69 2063 6f6e 746f  orm to roi conto
-00032b80: 7572 730a 2020 2020 2020 2020 2020 2020  urs.            
-00032b90: 7472 616e 736c 6174 696f 6e5f 3264 203d  translation_2d =
-00032ba0: 2028 7472 616e 736c 6174 696f 6e5b 305d   (translation[0]
-00032bb0: 2c20 7472 616e 736c 6174 696f 6e5b 315d  , translation[1]
-00032bc0: 290a 2020 2020 2020 2020 2020 2020 6365  ).            ce
-00032bd0: 6e74 7265 5f32 6420 3d20 2863 656e 7472  ntre_2d = (centr
-00032be0: 655b 305d 2c20 6365 6e74 7265 5b31 5d29  e[0], centre[1])
-00032bf0: 0a20 2020 2020 2020 2020 2020 2061 6e67  .            ang
-00032c00: 6c65 203d 2072 6f74 6174 696f 6e5b 325d  le = rotation[2]
-00032c10: 0a20 2020 2020 2020 2020 2020 206e 6577  .            new
-00032c20: 5f63 6f6e 746f 7572 7320 3d20 7b7d 0a20  _contours = {}. 
-00032c30: 2020 2020 2020 2020 2020 2066 6f72 206b             for k
-00032c40: 6579 2c20 636f 6e74 6f75 7273 2069 6e20  ey, contours in 
-00032c50: 7365 6c66 2e67 6574 5f63 6f6e 746f 7572  self.get_contour
-00032c60: 7328 292e 6974 656d 7328 293a 0a20 2020  s().items():.   
-00032c70: 2020 2020 2020 2020 2020 2020 206e 6577               new
-00032c80: 5f6b 6579 203d 206b 6579 202b 2074 7261  _key = key + tra
-00032c90: 6e73 6c61 7469 6f6e 5b32 5d0a 2020 2020  nslation[2].    
-00032ca0: 2020 2020 2020 2020 2020 2020 6e65 775f              new_
-00032cb0: 636f 6e74 6f75 7273 5b6e 6577 5f6b 6579  contours[new_key
-00032cc0: 5d20 3d20 5b5d 0a20 2020 2020 2020 2020  ] = [].         
-00032cd0: 2020 2020 2020 2066 6f72 2063 6f6e 746f         for conto
-00032ce0: 7572 2069 6e20 636f 6e74 6f75 7273 3a0a  ur in contours:.
-00032cf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00032d00: 2020 2020 706f 6c79 676f 6e20 3d20 636f      polygon = co
-00032d10: 6e74 6f75 725f 746f 5f70 6f6c 7967 6f6e  ntour_to_polygon
-00032d20: 2863 6f6e 746f 7572 290a 2020 2020 2020  (contour).      
-00032d30: 2020 2020 2020 2020 2020 2020 2020 706f                po
-00032d40: 6c79 676f 6e20 3d20 6166 6669 6e69 7479  lygon = affinity
-00032d50: 2e74 7261 6e73 6c61 7465 2870 6f6c 7967  .translate(polyg
-00032d60: 6f6e 2c20 2a74 7261 6e73 6c61 7469 6f6e  on, *translation
-00032d70: 5f32 6429 0a20 2020 2020 2020 2020 2020  _2d).           
-00032d80: 2020 2020 2020 2020 2070 6f6c 7967 6f6e           polygon
-00032d90: 203d 2061 6666 696e 6974 792e 726f 7461   = affinity.rota
-00032da0: 7465 2870 6f6c 7967 6f6e 2c20 616e 676c  te(polygon, angl
-00032db0: 652c 2063 656e 7472 655f 3264 290a 2020  e, centre_2d).  
-00032dc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00032dd0: 2020 706f 6c79 676f 6e20 3d20 6166 6669    polygon = affi
-00032de0: 6e69 7479 2e73 6361 6c65 2870 6f6c 7967  nity.scale(polyg
-00032df0: 6f6e 2c20 7363 616c 652c 2073 6361 6c65  on, scale, scale
-00032e00: 2c20 7363 616c 652c 0a20 2020 2020 2020  , scale,.       
-00032e10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00032e20: 2020 2020 2063 656e 7472 655f 3264 290a       centre_2d).
-00032e30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00032e40: 2020 2020 6e65 775f 636f 6e74 6f75 7273      new_contours
-00032e50: 5b6e 6577 5f6b 6579 5d2e 6170 7065 6e64  [new_key].append
-00032e60: 2870 6f6c 7967 6f6e 5f74 6f5f 636f 6e74  (polygon_to_cont
-00032e70: 6f75 7228 706f 6c79 676f 6e29 290a 0a20  our(polygon)).. 
-00032e80: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00032e90: 7265 7365 745f 636f 6e74 6f75 7273 286e  reset_contours(n
-00032ea0: 6577 5f63 6f6e 746f 7572 7329 0a0a 2020  ew_contours)..  
-00032eb0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-00032ec0: 2020 2020 2020 2020 2320 4170 706c 7920          # Apply 
-00032ed0: 7472 616e 7366 6f72 6d20 746f 2072 6f69  transform to roi
-00032ee0: 206d 6173 6b0a 2020 2020 2020 2020 2020   mask.          
-00032ef0: 2020 7365 6c66 2e63 7265 6174 655f 6d61    self.create_ma
-00032f00: 736b 2829 0a20 2020 2020 2020 2020 2020  sk().           
-00032f10: 2073 656c 662e 6d61 736b 2e74 7261 6e73   self.mask.trans
-00032f20: 666f 726d 2873 6361 6c65 2c20 7472 616e  form(scale, tran
-00032f30: 736c 6174 696f 6e2c 2072 6f74 6174 696f  slation, rotatio
-00032f40: 6e2c 0a20 2020 2020 2020 2020 2020 2020  n,.             
-00032f50: 2020 2020 2020 2063 656e 7472 652c 2072         centre, r
-00032f60: 6573 616d 706c 652c 2072 6573 746f 7265  esample, restore
-00032f70: 2c20 302c 2066 696c 6c5f 7661 6c75 6529  , 0, fill_value)
-00032f80: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00032f90: 662e 7265 7365 745f 6d61 736b 2829 0a0a  f.reset_mask()..
-00032fa0: 2020 2020 6465 6620 6372 6f70 2873 656c      def crop(sel
-00032fb0: 662c 2078 6c69 6d3d 4e6f 6e65 2c20 796c  f, xlim=None, yl
-00032fc0: 696d 3d4e 6f6e 652c 207a 6c69 6d3d 4e6f  im=None, zlim=No
-00032fd0: 6e65 293a 0a20 2020 2020 2020 2022 2222  ne):.        """
-00032fe0: 0a20 2020 2020 2020 2043 726f 7020 524f  .        Crop RO
-00032ff0: 4920 746f 2073 7065 6369 6669 6564 2072  I to specified r
-00033000: 616e 6765 2069 6e20 782c 2079 2c20 7a2e  ange in x, y, z.
-00033010: 0a0a 2020 2020 2020 2020 2a2a 5061 7261  ..        **Para
-00033020: 6d65 7465 7273 3a2a 2a0a 0a20 2020 2020  meters:**..     
-00033030: 2020 2078 6c69 6d20 3a20 7475 706c 652c     xlim : tuple,
-00033040: 2064 6566 6175 6c74 3d4e 6f6e 650a 2020   default=None.  
-00033050: 2020 2020 2020 2020 2020 4c6f 7765 7220            Lower 
-00033060: 616e 6420 7570 7065 7220 626f 756e 6473  and upper bounds
-00033070: 2069 6e20 6d6d 2066 6f72 2063 726f 7070   in mm for cropp
-00033080: 696e 6720 616c 6f6e 6720 782d 6178 6973  ing along x-axis
-00033090: 2e0a 2020 2020 2020 2020 2020 2020 4966  ..            If
-000330a0: 2073 6574 2074 6f20 4e6f 6e65 2c20 6e6f   set to None, no
-000330b0: 2063 726f 7070 696e 6720 6973 2070 6572   cropping is per
-000330c0: 666f 726d 6564 2e20 2049 6620 6120 626f  formed.  If a bo
-000330d0: 756e 640a 2020 2020 2020 2020 2020 2020  und.            
-000330e0: 6973 2073 6574 2074 6f20 4e6f 6e65 2c20  is set to None, 
-000330f0: 7468 6174 2062 6f75 6e64 2069 7320 6469  that bound is di
-00033100: 7372 6567 6172 6465 642e 0a0a 2020 2020  sregarded...    
-00033110: 2020 2020 796c 696d 203a 2074 7570 6c65      ylim : tuple
-00033120: 2c20 6465 6661 756c 743d 4e6f 6e65 0a20  , default=None. 
-00033130: 2020 2020 2020 2020 2020 204c 6f77 6572             Lower
-00033140: 2061 6e64 2075 7070 6572 2062 6f75 6e64   and upper bound
-00033150: 7320 696e 206d 6d20 666f 7220 6372 6f70  s in mm for crop
-00033160: 7069 6e67 2061 6c6f 6e67 2079 2d61 7869  ping along y-axi
-00033170: 732e 0a20 2020 2020 2020 2020 2020 2049  s..            I
-00033180: 6620 7365 7420 746f 204e 6f6e 652c 206e  f set to None, n
-00033190: 6f20 6372 6f70 7069 6e67 2069 7320 7065  o cropping is pe
-000331a0: 7266 6f72 6d65 642e 2020 4966 2061 2062  rformed.  If a b
-000331b0: 6f75 6e64 0a20 2020 2020 2020 2020 2020  ound.           
-000331c0: 2069 7320 7365 7420 746f 204e 6f6e 652c   is set to None,
-000331d0: 2074 6861 7420 626f 756e 6420 6973 2064   that bound is d
-000331e0: 6973 7265 6761 7264 6564 2e0a 0a20 2020  isregarded...   
-000331f0: 2020 2020 207a 6c69 6d20 3a20 7475 706c       zlim : tupl
-00033200: 652c 2064 6566 6175 6c74 3d4e 6f6e 650a  e, default=None.
-00033210: 2020 2020 2020 2020 2020 2020 4c6f 7765              Lowe
-00033220: 7220 616e 6420 7570 7065 7220 626f 756e  r and upper boun
-00033230: 6473 2069 6e20 6d6d 2066 6f72 2063 726f  ds in mm for cro
-00033240: 7070 696e 6720 616c 6f6e 6720 7a2d 6178  pping along z-ax
-00033250: 6973 2e0a 2020 2020 2020 2020 2020 2020  is..            
-00033260: 4966 2073 6574 2074 6f20 4e6f 6e65 2c20  If set to None, 
-00033270: 6e6f 2063 726f 7070 696e 6720 6973 2070  no cropping is p
-00033280: 6572 666f 726d 6564 2e20 2049 6620 6120  erformed.  If a 
-00033290: 626f 756e 640a 2020 2020 2020 2020 2020  bound.          
-000332a0: 2020 6973 2073 6574 2074 6f20 4e6f 6e65    is set to None
-000332b0: 2c20 7468 6174 2062 6f75 6e64 2069 7320  , that bound is 
-000332c0: 6469 7372 6567 6172 6465 642e 0a0a 2020  disregarded...  
-000332d0: 2020 2020 2020 4966 206f 6e6c 7920 7a6c        If only zl
-000332e0: 696d 2069 7320 6e6f 7420 7365 7420 746f  im is not set to
-000332f0: 204e 6f6e 6520 616e 6420 7468 6520 524f   None and the RO
-00033300: 4920 736f 7572 6365 2074 7970 6520 6973  I source type is
-00033310: 2022 636f 6e74 6f75 7222 2c0a 2020 2020   "contour",.    
-00033320: 2020 2020 6372 6f70 7069 6e67 2069 7320      cropping is 
-00033330: 7065 7266 6f72 6d65 6420 6279 2064 6973  performed by dis
-00033340: 6361 7264 696e 6720 636f 6e74 6f75 7273  carding contours
-00033350: 206f 7574 7369 6465 2074 6865 2072 6571   outside the req
-00033360: 7569 7265 640a 2020 2020 2020 2020 7261  uired.        ra
-00033370: 6e67 652e 2020 4f74 6877 6973 6520 6372  nge.  Othwise cr
-00033380: 6f70 7069 6e67 2069 7320 7065 7266 6f72  opping is perfor
-00033390: 6d65 6420 6f6e 2074 6865 2052 4f49 206d  med on the ROI m
-000333a0: 6173 6b2e 0a20 2020 2020 2020 2022 2222  ask..        """
-000333b0: 0a20 2020 2020 2020 2023 2046 6f72 2063  .        # For c
-000333c0: 726f 7070 696e 6720 616c 6f6e 6720 7a2c  ropping along z,
-000333d0: 2061 6e64 2077 6865 7265 2052 4f49 2069   and where ROI i
-000333e0: 7320 6465 6669 6e65 6420 6672 6f6d 2063  s defined from c
-000333f0: 6f6e 746f 7572 732c 0a20 2020 2020 2020  ontours,.       
-00033400: 2023 2064 6973 6361 7264 2063 6f6e 746f   # discard conto
-00033410: 7572 7320 6f75 7473 6964 6520 6372 6f70  urs outside crop
-00033420: 2072 616e 6765 2e0a 2020 2020 2020 2020   range..        
-00033430: 6966 2073 656c 662e 736f 7572 6365 5f74  if self.source_t
-00033440: 7970 6520 3d3d 2022 636f 6e74 6f75 7222  ype == "contour"
-00033450: 2061 6e64 207a 6c69 6d20 616e 6420 6e6f   and zlim and no
-00033460: 7420 786c 696d 2061 6e64 206e 6f74 2079  t xlim and not y
-00033470: 6c69 6d3a 0a20 2020 2020 2020 2020 2020  lim:.           
-00033480: 2063 6f6e 746f 7572 7320 3d20 7365 6c66   contours = self
-00033490: 2e67 6574 5f63 6f6e 746f 7572 7328 290a  .get_contours().
-000334a0: 2020 2020 2020 2020 2020 2020 6966 207a              if z
-000334b0: 6c69 6d5b 305d 2069 7320 4e6f 6e65 3a0a  lim[0] is None:.
-000334c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000334d0: 7a6c 696d 5b30 5d20 3d20 6d69 6e28 636f  zlim[0] = min(co
-000334e0: 6e74 6f75 7273 2920 2d20 310a 2020 2020  ntours) - 1.    
-000334f0: 2020 2020 2020 2020 6966 207a 6c69 6d5b          if zlim[
-00033500: 315d 2069 7320 4e6f 6e65 3a0a 2020 2020  1] is None:.    
-00033510: 2020 2020 2020 2020 2020 2020 7a6c 696d              zlim
-00033520: 5b31 5d20 3d20 6d61 7828 636f 6e74 6f75  [1] = max(contou
-00033530: 7273 2920 2b20 310a 2020 2020 2020 2020  rs) + 1.        
-00033540: 2020 2020 636f 6e74 6f75 7273 203d 207b      contours = {
-00033550: 7a3a 207a 5f63 6f6e 746f 7572 7320 666f  z: z_contours fo
-00033560: 7220 7a2c 207a 5f63 6f6e 746f 7572 7320  r z, z_contours 
-00033570: 696e 2063 6f6e 746f 7572 732e 6974 656d  in contours.item
-00033580: 7328 290a 2020 2020 2020 2020 2020 2020  s().            
-00033590: 2020 2020 2020 2020 6966 2028 7a20 3e20          if (z > 
-000335a0: 7a6c 696d 5b30 5d20 616e 6420 7a20 3c20  zlim[0] and z < 
-000335b0: 7a6c 696d 5b31 5d29 7d0a 0a20 2020 2020  zlim[1])}..     
-000335c0: 2020 2020 2020 2023 2052 6573 6574 2063         # Reset c
-000335d0: 6f6e 746f 7572 732e 0a20 2020 2020 2020  ontours..       
-000335e0: 2020 2020 2073 656c 662e 7265 7365 745f       self.reset_
-000335f0: 636f 6e74 6f75 7273 2863 6f6e 746f 7572  contours(contour
-00033600: 7329 0a0a 2020 2020 2020 2020 2320 466f  s)..        # Fo
-00033610: 7220 616c 6c20 6f74 6865 7220 6361 7365  r all other case
-00033620: 732c 2066 726f 7020 524f 4920 6d61 736b  s, frop ROI mask
-00033630: 2e0a 2020 2020 2020 2020 656c 6966 2078  ..        elif x
-00033640: 6c69 6d20 6f72 2079 6c69 6d20 6f72 207a  lim or ylim or z
-00033650: 6c69 6d3a 0a20 2020 2020 2020 2020 2020  lim:.           
-00033660: 2073 656c 662e 6372 6561 7465 5f6d 6173   self.create_mas
-00033670: 6b28 290a 2020 2020 2020 2020 2020 2020  k().            
-00033680: 0a20 2020 2020 2020 2020 2020 2023 2045  .            # E
-00033690: 6e73 7572 6520 7468 6174 2063 726f 7020  nsure that crop 
-000336a0: 7261 6e67 6520 616c 6f6e 6720 6561 6368  range along each
-000336b0: 2061 7869 7320 6973 204e 6f6e 650a 2020   axis is None.  
-000336c0: 2020 2020 2020 2020 2020 2320 6f72 2061            # or a
-000336d0: 2074 776f 2d65 6c65 6d65 6e74 2074 7570   two-element tup
-000336e0: 6c65 206f 6620 666c 6f61 7473 2e0a 2020  le of floats..  
-000336f0: 2020 2020 2020 2020 2020 6c69 6d73 203d            lims =
-00033700: 205b 786c 696d 2c20 796c 696d 2c20 7a6c   [xlim, ylim, zl
-00033710: 696d 5d0a 2020 2020 2020 2020 2020 2020  im].            
-00033720: 6d61 736b 5f65 7874 656e 7473 203d 2073  mask_extents = s
-00033730: 656c 662e 6d61 736b 2e67 6574 5f65 7874  elf.mask.get_ext
-00033740: 656e 7473 2829 0a20 2020 2020 2020 2020  ents().         
-00033750: 2020 2066 6f72 2069 5f61 782c 206c 696d     for i_ax, lim
-00033760: 2069 6e20 656e 756d 6572 6174 6528 6c69   in enumerate(li
-00033770: 6d73 293a 0a20 2020 2020 2020 2020 2020  ms):.           
-00033780: 2020 2020 2069 6620 6c69 6d3a 0a20 2020       if lim:.   
-00033790: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000337a0: 2066 6f72 2069 6478 2069 6e20 5b30 2c20   for idx in [0, 
-000337b0: 315d 3a0a 2020 2020 2020 2020 2020 2020  1]:.            
-000337c0: 2020 2020 2020 2020 2020 2020 6966 206c              if l
-000337d0: 696d 5b69 6478 5d20 6973 204e 6f6e 653a  im[idx] is None:
-000337e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000337f0: 2020 2020 2020 2020 2020 2020 206c 696d               lim
-00033800: 735b 695f 6178 5d5b 6964 785d 203d 206d  s[i_ax][idx] = m
-00033810: 6173 6b5f 6578 7465 6e74 735b 695f 6178  ask_extents[i_ax
-00033820: 5d5b 6964 785d 0a20 2020 2020 2020 2020  ][idx].         
-00033830: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-00033840: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00033850: 206c 696d 735b 695f 6178 5d20 3d20 4e6f   lims[i_ax] = No
-00033860: 6e65 0a0a 2020 2020 2020 2020 2020 2020  ne..            
-00033870: 2320 4c6f 6f70 206f 7665 7220 6178 6573  # Loop over axes
-00033880: 2e0a 2020 2020 2020 2020 2020 2020 666f  ..            fo
-00033890: 7220 695f 6178 2c20 6c69 6d20 696e 2065  r i_ax, lim in e
-000338a0: 6e75 6d65 7261 7465 286c 696d 7329 3a0a  numerate(lims):.
-000338b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000338c0: 2069 6620 6c69 6d20 6973 204e 6f6e 653a   if lim is None:
-000338d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000338e0: 2020 2020 2063 6f6e 7469 6e75 650a 0a20       continue.. 
-000338f0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-00033900: 2046 696e 6420 6172 7261 7920 696e 6469   Find array indi
-00033910: 6365 7320 6174 2077 6869 6368 2074 6f20  ces at which to 
-00033920: 6372 6f70 2e0a 2020 2020 2020 2020 2020  crop..          
-00033930: 2020 2020 2020 6931 203d 2073 656c 662e        i1 = self.
-00033940: 6d61 736b 2e70 6f73 5f74 6f5f 6964 7828  mask.pos_to_idx(
-00033950: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00033960: 2020 2020 2020 2020 206c 696d 735b 695f           lims[i_
-00033970: 6178 5d5b 305d 2c20 6178 3d69 5f61 782c  ax][0], ax=i_ax,
-00033980: 2072 6574 7572 6e5f 696e 743d 4661 6c73   return_int=Fals
-00033990: 6529 0a20 2020 2020 2020 2020 2020 2020  e).             
-000339a0: 2020 2069 3220 3d20 7365 6c66 2e6d 6173     i2 = self.mas
-000339b0: 6b2e 706f 735f 746f 5f69 6478 286c 696d  k.pos_to_idx(lim
-000339c0: 735b 695f 6178 5d5b 315d 2c20 6178 3d69  s[i_ax][1], ax=i
-000339d0: 5f61 782c 0a20 2020 2020 2020 2020 2020  _ax,.           
-000339e0: 2020 2020 2020 2020 2020 2020 2072 6574               ret
-000339f0: 7572 6e5f 696e 743d 4661 6c73 6529 0a20  urn_int=False). 
-00033a00: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00033a10: 5f62 6967 2c20 695f 736d 616c 6c20 3d20  _big, i_small = 
-00033a20: 6932 2c20 6931 0a20 2020 2020 2020 2020  i2, i1.         
-00033a30: 2020 2020 2020 2069 6620 6931 203e 2069         if i1 > i
-00033a40: 323a 0a20 2020 2020 2020 2020 2020 2020  2:.             
-00033a50: 2020 2020 2020 2069 5f62 6967 2c20 695f         i_big, i_
-00033a60: 736d 616c 6c20 3d20 695f 736d 616c 6c2c  small = i_small,
-00033a70: 2069 5f62 6967 0a20 2020 2020 2020 2020   i_big.         
-00033a80: 2020 2020 2020 2069 5f73 6d61 6c6c 203d         i_small =
-00033a90: 2069 6e74 286e 702e 666c 6f6f 7228 695f   int(np.floor(i_
-00033aa0: 736d 616c 6c20 2b20 302e 3529 290a 2020  small + 0.5)).  
-00033ab0: 2020 2020 2020 2020 2020 2020 2020 695f                i_
-00033ac0: 6269 6720 3d20 696e 7428 6e70 2e66 6c6f  big = int(np.flo
-00033ad0: 6f72 2869 5f62 6967 202b 2030 2e35 2929  or(i_big + 0.5))
-00033ae0: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00033af0: 2020 2320 4372 6f70 2074 6865 206d 6173    # Crop the mas
-00033b00: 6b2e 0a20 2020 2020 2020 2020 2020 2020  k..             
-00033b10: 2020 2061 785f 746f 5f73 6c69 6365 203d     ax_to_slice =
-00033b20: 2073 656c 662e 6d61 736b 2e67 6574 5f61   self.mask.get_a
-00033b30: 7865 7328 292e 696e 6465 7828 695f 6178  xes().index(i_ax
-00033b40: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00033b50: 2020 6966 2069 5f73 6d61 6c6c 203e 2030    if i_small > 0
-00033b60: 2061 6e64 2069 5f73 6d61 6c6c 203c 2073   and i_small < s
-00033b70: 656c 662e 6d61 736b 2e6e 5f76 6f78 656c  elf.mask.n_voxel
-00033b80: 735b 695f 6178 5d3a 0a20 2020 2020 2020  s[i_ax]:.       
-00033b90: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-00033ba0: 662e 6d61 736b 2e64 6174 612e 7377 6170  f.mask.data.swap
-00033bb0: 6178 6573 2830 2c20 6178 5f74 6f5f 736c  axes(0, ax_to_sl
-00033bc0: 6963 6529 5b3a 695f 736d 616c 6c2c 203a  ice)[:i_small, :
-00033bd0: 2c20 3a5d 203d 2030 0a20 2020 2020 2020  , :] = 0.       
-00033be0: 2020 2020 2020 2020 2069 6620 695f 6269           if i_bi
-00033bf0: 6720 3e20 3020 616e 6420 695f 6269 6720  g > 0 and i_big 
-00033c00: 3c20 7365 6c66 2e6d 6173 6b2e 6e5f 766f  < self.mask.n_vo
-00033c10: 7865 6c73 5b69 5f61 785d 3a0a 2020 2020  xels[i_ax]:.    
-00033c20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00033c30: 7365 6c66 2e6d 6173 6b2e 6461 7461 2e73  self.mask.data.s
-00033c40: 7761 7061 7865 7328 302c 2061 785f 746f  wapaxes(0, ax_to
-00033c50: 5f73 6c69 6365 295b 695f 6269 673a 2c20  _slice)[i_big:, 
-00033c60: 3a2c 203a 5d20 3d20 300a 0a20 2020 2020  :, :] = 0..     
-00033c70: 2020 2020 2020 2023 2052 6573 6574 206d         # Reset m
-00033c80: 6173 6b2e 0a20 2020 2020 2020 2020 2020  ask..           
-00033c90: 2073 656c 662e 7265 7365 745f 6d61 736b   self.reset_mask
-00033ca0: 2873 656c 662e 6d61 736b 290a 0a20 2020  (self.mask)..   
-00033cb0: 2064 6566 2063 726f 705f 6279 5f61 6d6f   def crop_by_amo
-00033cc0: 756e 7473 2873 656c 662c 2064 783d 4e6f  unts(self, dx=No
-00033cd0: 6e65 2c20 6479 3d4e 6f6e 652c 2064 7a3d  ne, dy=None, dz=
-00033ce0: 4e6f 6e65 293a 0a20 2020 2020 2020 2022  None):.        "
-00033cf0: 2222 0a20 2020 2020 2020 2043 726f 7020  "".        Crop 
-00033d00: 524f 4920 6279 2074 6865 2061 6d6f 756e  ROI by the amoun
-00033d10: 7473 2064 782c 2064 792c 2064 7a20 696e  ts dx, dy, dz in
-00033d20: 206d 6d2e 0a0a 2020 2020 2020 2020 5468   mm...        Th
-00033d30: 6973 206d 6574 686f 6420 6361 6c6c 7320  is method calls 
-00033d40: 7468 6520 6675 6e63 7469 6f6e 2073 6b72  the function skr
-00033d50: 742e 696d 6167 652e 6372 6f70 5f62 795f  t.image.crop_by_
-00033d60: 616d 6f75 6e74 7328 292c 2077 6974 680a  amounts(), with.
-00033d70: 2020 2020 2020 2020 7365 6c66 2070 6173          self pas
-00033d80: 7365 6420 6173 206f 626a 6563 7420 666f  sed as object fo
-00033d90: 7220 6372 6f70 7069 6e67 2e0a 0a20 2020  r cropping...   
-00033da0: 2020 2020 2054 6865 2061 6d6f 756e 7420       The amount 
-00033db0: 6f66 2063 726f 7070 696e 6720 616c 6f6e  of cropping alon
-00033dc0: 6720 6561 6368 2064 6972 6563 7469 6f6e  g each direction
-00033dd0: 2073 686f 756c 6420 6265 206f 6e65 206f   should be one o
-00033de0: 663a 0a20 2020 2020 2020 202d 2066 6c6f  f:.        - flo
-00033df0: 6174 203a 2074 6865 2052 4f49 2069 7320  at : the ROI is 
-00033e00: 6372 6f70 7065 6420 6279 2074 6869 7320  cropped by this 
-00033e10: 616d 6f75 6e74 206f 6e20 626f 7468 2073  amount on both s
-00033e20: 6964 6573 3b0a 2020 2020 2020 2020 2d20  ides;.        - 
-00033e30: 7477 6f2d 656c 656d 656e 7420 7475 706c  two-element tupl
-00033e40: 653a 2074 6865 2052 4f49 2069 7320 6372  e: the ROI is cr
-00033e50: 6f70 7065 6420 6f6e 2074 6865 2073 6964  opped on the sid
-00033e60: 6573 206f 6620 6c6f 7765 720a 2020 2020  es of lower.    
-00033e70: 2020 2020 2020 616e 6420 6869 6768 6572        and higher
-00033e80: 2076 616c 7565 7320 6279 2074 6865 2061   values by the a
-00033e90: 6d6f 756e 7473 2073 7065 6369 6669 6564  mounts specified
-00033ea0: 3b0a 2020 2020 2020 2020 2d20 4e6f 6e65  ;.        - None
-00033eb0: 203a 206e 6f20 6372 6f70 7069 6e67 2069   : no cropping i
-00033ec0: 7320 7065 7266 6f72 6d65 642e 0a0a 2020  s performed...  
-00033ed0: 2020 2020 2020 466f 7220 6d6f 7265 2064        For more d
-00033ee0: 6574 6169 6c73 2c20 7365 6520 646f 6375  etails, see docu
-00033ef0: 6d65 6e74 6174 696f 6e20 6f66 2073 6b72  mentation of skr
-00033f00: 742e 696d 6167 652e 6372 6f70 5f62 795f  t.image.crop_by_
-00033f10: 616d 6f75 6e74 7328 292e 0a20 2020 2020  amounts()..     
-00033f20: 2020 2022 2222 0a20 2020 2020 2020 2073     """.        s
-00033f30: 6b72 742e 696d 6167 652e 6372 6f70 5f62  krt.image.crop_b
-00033f40: 795f 616d 6f75 6e74 7328 7365 6c66 2c20  y_amounts(self, 
-00033f50: 6478 2c20 6479 2c20 647a 290a 0a20 2020  dx, dy, dz)..   
-00033f60: 2064 6566 2063 726f 705f 746f 5f72 6f69   def crop_to_roi
-00033f70: 5f6c 656e 6774 6828 7365 6c66 2c20 6f74  _length(self, ot
-00033f80: 6865 722c 2061 783d 227a 2229 3a0a 2020  her, ax="z"):.  
-00033f90: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-00033fa0: 2020 4372 6f70 2074 6f20 6c65 6e67 7468    Crop to length
-00033fb0: 206f 6620 6f74 6865 7220 524f 4920 616c   of other ROI al
-00033fc0: 6f6e 6720 6120 6769 7665 6e20 6178 6973  ong a given axis
-00033fd0: 2e0a 0a20 2020 2020 2020 202a 2a50 6172  ...        **Par
-00033fe0: 616d 6574 6572 733a 2a2a 0a20 2020 2020  ameters:**.     
-00033ff0: 2020 206f 7468 6572 203a 2073 6b72 742e     other : skrt.
-00034000: 7374 7275 6374 7572 6573 2e52 4f49 0a20  structures.ROI. 
-00034010: 2020 2020 2020 2020 2020 2052 4f49 206f             ROI o
-00034020: 626a 6563 7420 746f 2077 6869 6368 2074  bject to which t
-00034030: 6f20 6372 6f70 2e0a 2020 2020 2020 2020  o crop..        
-00034040: 2020 200a 2020 2020 2020 2020 6178 203a     .        ax :
-00034050: 2073 7472 2f69 6e74 2c20 6465 6661 756c   str/int, defaul
-00034060: 743d 227a 220a 2020 2020 2020 2020 2020  t="z".          
-00034070: 2020 4178 6973 2061 6c6f 6e67 2077 6869    Axis along whi
-00034080: 6368 2074 6f20 7065 7266 6f72 6d20 6372  ch to perform cr
-00034090: 6f70 7069 6e67 2e20 5368 6f75 6c64 2062  opping. Should b
-000340a0: 6520 6f6e 6520 6f66 0a20 2020 2020 2020  e one of.       
-000340b0: 2020 2020 205b 2278 222c 2022 7922 2c20       ["x", "y", 
-000340c0: 227a 225d 206f 7220 5b30 2c20 312c 2032  "z"] or [0, 1, 2
-000340d0: 5d2e 0a20 2020 2020 2020 2022 2222 0a20  ]..        """. 
-000340e0: 2020 2020 2020 2023 2044 6574 6572 6d69         # Determi
-000340f0: 6e65 2063 726f 7020 7261 6e67 652e 0a20  ne crop range.. 
-00034100: 2020 2020 2020 206c 696d 7320 3d20 3320         lims = 3 
-00034110: 2a20 5b4e 6f6e 655d 0a20 2020 2020 2020  * [None].       
-00034120: 2069 5f61 7820 3d20 736b 7274 2e69 6d61   i_ax = skrt.ima
-00034130: 6765 2e5f 6178 6573 2e69 6e64 6578 2861  ge._axes.index(a
-00034140: 7829 2069 6620 6973 696e 7374 616e 6365  x) if isinstance
-00034150: 2861 782c 2073 7472 2920 656c 7365 2061  (ax, str) else a
-00034160: 780a 2020 2020 2020 2020 6c69 6d73 5b69  x.        lims[i
-00034170: 5f61 785d 203d 206f 7468 6572 2e67 6574  _ax] = other.get
-00034180: 5f65 7874 656e 7428 6178 3d61 7829 0a0a  _extent(ax=ax)..
-00034190: 2020 2020 2020 2020 2320 5065 7266 6f72          # Perfor
-000341a0: 6d20 6372 6f70 7069 6e67 2e0a 2020 2020  m cropping..    
-000341b0: 2020 2020 7365 6c66 2e63 726f 7028 2a6c      self.crop(*l
-000341c0: 696d 7329 0a0a 2020 2020 6465 6620 6372  ims)..    def cr
-000341d0: 6f70 5f74 6f5f 726f 6928 7365 6c66 2c20  op_to_roi(self, 
-000341e0: 726f 692c 202a 2a6b 7761 7267 7329 3a0a  roi, **kwargs):.
-000341f0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00034200: 2020 2020 4372 6f70 2052 4f49 206d 6173      Crop ROI mas
-00034210: 6b20 746f 2072 6567 696f 6e20 636f 7665  k to region cove
-00034220: 7265 6420 6279 2061 6e20 524f 492e 0a20  red by an ROI.. 
-00034230: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-00034240: 2020 2073 656c 662e 6372 6561 7465 5f6d     self.create_m
-00034250: 6173 6b28 290a 2020 2020 2020 2020 7365  ask().        se
-00034260: 6c66 2e6d 6173 6b2e 6372 6f70 5f74 6f5f  lf.mask.crop_to_
-00034270: 726f 6928 726f 692c 202a 2a6b 7761 7267  roi(roi, **kwarg
-00034280: 7329 0a20 2020 2020 2020 2073 656c 662e  s).        self.
-00034290: 7368 6170 6520 3d20 7365 6c66 2e67 6574  shape = self.get
-000342a0: 5f6d 6173 6b28 292e 7368 6170 650a 0a20  _mask().shape.. 
-000342b0: 2020 2064 6566 2061 6464 5f70 6c61 6e28     def add_plan(
-000342c0: 7365 6c66 2c20 706c 616e 293a 0a20 2020  self, plan):.   
-000342d0: 2020 2020 2022 2222 4164 6420 6120 506c       """Add a Pl
-000342e0: 616e 206f 626a 6563 7420 746f 2062 6520  an object to be 
-000342f0: 6173 736f 6369 6174 6564 2077 6974 6820  associated with 
-00034300: 7468 6973 2052 4f49 2e20 5468 6973 0a20  this ROI. This. 
-00034310: 2020 2020 2020 2064 6f65 7320 6e6f 7420         does not 
-00034320: 6166 6665 6374 2074 6865 2073 7472 7563  affect the struc
-00034330: 7475 7265 2073 6574 2061 7373 6f63 6961  ture set associa
-00034340: 7465 6420 7769 7468 2074 6865 2050 6c61  ted with the Pla
-00034350: 6e20 6f62 6a65 6374 2e0a 0a20 2020 2020  n object...     
-00034360: 2020 202a 2a50 6172 616d 6574 6572 733a     **Parameters:
-00034370: 2a2a 0a0a 2020 2020 2020 2020 706c 616e  **..        plan
-00034380: 203a 2073 6b72 742e 646f 7365 2e50 6c61   : skrt.dose.Pla
-00034390: 6e0a 2020 2020 2020 2020 2020 2020 4120  n.            A 
-000343a0: 506c 616e 206f 626a 6563 7420 746f 2061  Plan object to a
-000343b0: 7373 6967 6e20 746f 2074 6869 7320 7374  ssign to this st
-000343c0: 7275 6374 7572 6520 7365 742e 0a20 2020  ructure set..   
-000343d0: 2020 2020 2022 2222 0a0a 2020 2020 2020       """..      
-000343e0: 2020 6966 206e 6f74 2070 6c61 6e20 696e    if not plan in
-000343f0: 2073 656c 662e 706c 616e 733a 0a20 2020   self.plans:.   
-00034400: 2020 2020 2020 2020 2073 656c 662e 706c           self.pl
-00034410: 616e 732e 6170 7065 6e64 2870 6c61 6e29  ans.append(plan)
-00034420: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00034430: 662e 706c 616e 732e 736f 7274 2829 0a0a  f.plans.sort()..
-00034440: 2020 2020 6465 6620 636c 6561 725f 706c      def clear_pl
-00034450: 616e 7328 7365 6c66 293a 0a20 2020 2020  ans(self):.     
-00034460: 2020 2022 2222 436c 6561 7220 616c 6c20     """Clear all 
-00034470: 706c 616e 206d 6170 7320 6173 736f 6369  plan maps associ
-00034480: 6174 6564 2077 6974 6820 7468 6973 2052  ated with this R
-00034490: 4f49 2e22 2222 0a0a 2020 2020 2020 2020  OI."""..        
-000344a0: 7365 6c66 2e70 6c61 6e73 203d 205b 5d0a  self.plans = [].
-000344b0: 0a20 2020 2064 6566 2067 6574 5f70 6c61  .    def get_pla
-000344c0: 6e73 2873 656c 6629 3a0a 2020 2020 2020  ns(self):.      
-000344d0: 2020 2222 2252 6574 7572 6e20 6c69 7374    """Return list
-000344e0: 206f 6620 506c 616e 206f 626a 6563 7473   of Plan objects
-000344f0: 2061 7373 6f63 6961 7465 6420 7769 7468   associated with
-00034500: 2074 6869 7320 524f 492e 2222 220a 0a20   this ROI.""".. 
-00034510: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
-00034520: 6c66 2e70 6c61 6e73 0a0a 2020 2020 6465  lf.plans..    de
-00034530: 6620 6765 745f 636f 6c6f 725f 6672 6f6d  f get_color_from
-00034540: 5f6b 7761 7267 7328 7365 6c66 2c20 6b77  _kwargs(self, kw
-00034550: 6172 6773 3d7b 7d2c 206b 6579 3d27 726f  args={}, key='ro
-00034560: 695f 636f 6c6f 7273 2729 3a0a 2020 2020  i_colors'):.    
-00034570: 2020 2020 2727 270a 2020 2020 2020 2020      '''.        
-00034580: 5265 7475 726e 2052 4f49 2063 6f6c 6f75  Return ROI colou
-00034590: 7220 7061 7373 6564 2076 6961 2064 6963  r passed via dic
-000345a0: 7469 6f6e 6172 7920 6f66 206b 6579 776f  tionary of keywo
-000345b0: 7264 2061 7267 756d 656e 7473 2e0a 0a20  rd arguments... 
-000345c0: 2020 2020 2020 202a 2a50 6172 616d 6574         **Paramet
-000345d0: 6572 733a 2a2a 0a0a 2020 2020 2020 2020  ers:**..        
-000345e0: 6b77 6172 6773 203a 2064 6963 742c 2064  kwargs : dict, d
-000345f0: 6566 6175 6c74 3d7b 7d0a 2020 2020 2020  efault={}.      
-00034600: 2020 2020 2020 4469 6374 696f 6e61 7279        Dictionary
-00034610: 206f 6620 6b65 7977 6f72 6420 6172 6775   of keyword argu
-00034620: 6d65 6e74 732c 2077 6869 6368 206d 6179  ments, which may
-00034630: 2069 6e63 6c75 6465 0a20 2020 2020 2020   include.       
-00034640: 2020 2020 2070 6172 616d 6574 6572 2070       parameter p
-00034650: 726f 7669 6469 6e67 2064 6963 7469 6f6e  roviding diction
-00034660: 6172 7920 6f66 2052 4f49 2063 6f6c 6f75  ary of ROI colou
-00034670: 7273 2066 6f72 2070 6c6f 7474 696e 672e  rs for plotting.
-00034680: 0a0a 2020 2020 2020 2020 6b65 7920 3a20  ..        key : 
-00034690: 7374 722c 2064 6566 6175 6c74 3d27 726f  str, default='ro
-000346a0: 695f 636f 6c6f 7273 270a 2020 2020 2020  i_colors'.      
-000346b0: 2020 2020 2020 4b65 7920 696e 206b 7761        Key in kwa
-000346c0: 7267 7320 6469 6374 696f 6e61 7279 2073  rgs dictionary s
-000346d0: 7065 6369 6679 696e 6720 7061 7261 6d65  pecifying parame
-000346e0: 7465 7220 7468 6174 2c20 6966 0a20 2020  ter that, if.   
-000346f0: 2020 2020 2020 2020 2070 7265 7365 6e74           present
-00034700: 2c20 7072 6f76 6964 6573 2064 6963 7469  , provides dicti
-00034710: 6f6e 6172 7920 6f66 2052 4f49 2063 6f6c  onary of ROI col
-00034720: 6f75 7273 2e0a 2020 2020 2020 2020 2727  ours..        ''
-00034730: 270a 2020 2020 2020 2020 726f 695f 636f  '.        roi_co
-00034740: 6c6f 7273 203d 206b 7761 7267 732e 6765  lors = kwargs.ge
-00034750: 7428 6b65 792c 207b 7d29 0a20 2020 2020  t(key, {}).     
-00034760: 2020 2072 6574 7572 6e20 726f 695f 636f     return roi_co
-00034770: 6c6f 7273 2e67 6574 2873 656c 662e 6e61  lors.get(self.na
-00034780: 6d65 2c20 7365 6c66 2e63 6f6c 6f72 290a  me, self.color).
-00034790: 0a20 2020 2064 6566 2073 706c 6974 2873  .    def split(s
-000347a0: 656c 662c 2076 6f78 656c 5f73 697a 653d  elf, voxel_size=
-000347b0: 4e6f 6e65 2c20 6e61 6d65 733d 4e6f 6e65  None, names=None
-000347c0: 2c20 6f72 6465 723d 2778 2b27 293a 0a20  , order='x+'):. 
-000347d0: 2020 2020 2020 2027 2727 0a20 2020 2020         '''.     
-000347e0: 2020 2053 706c 6974 2061 2063 6f6d 706f     Split a compo
-000347f0: 7369 7465 2052 4f49 2069 6e74 6f20 6974  site ROI into it
-00034800: 7320 636f 6d70 6f6e 656e 7473 2e0a 0a20  s components... 
-00034810: 2020 2020 2020 2041 2063 6f6d 706f 7369         A composi
-00034820: 7465 2052 4f49 206d 6179 2072 6573 756c  te ROI may resul
-00034830: 7420 6265 6361 7573 6520 7068 7969 6361  t because phyica
-00034840: 6c6c 7920 7365 7061 7261 7465 2052 4f49  lly separate ROI
-00034850: 7320 6172 650a 2020 2020 2020 2020 6769  s are.        gi
-00034860: 7665 6e20 7468 6520 7361 6d65 206c 6162  ven the same lab
-00034870: 656c 2064 7572 696e 6720 6d61 6e75 616c  el during manual
-00034880: 2063 6f6e 746f 7572 696e 672c 206f 7220   contouring, or 
-00034890: 6265 6361 7573 650a 2020 2020 2020 2020  because.        
-000348a0: 6d75 6c74 6970 6c65 2052 4f49 7320 6172  multiple ROIs ar
-000348b0: 6520 7265 7475 726e 6564 2062 7920 616e  e returned by an
-000348c0: 2061 7574 6f2d 7365 676d 656e 7461 7469   auto-segmentati
-000348d0: 6f6e 2061 6c67 6f72 6974 686d 2e0a 0a20  on algorithm... 
-000348e0: 2020 2020 2020 2054 6865 2063 6f6d 706f         The compo
-000348f0: 6e65 6e74 2052 4f49 7320 6172 6520 6964  nent ROIs are id
-00034900: 656e 7469 6669 6564 2062 7920 6c61 6265  entified by labe
-00034910: 6c6c 696e 6720 6120 6d61 736b 206f 6620  lling a mask of 
-00034920: 7468 650a 2020 2020 2020 2020 636f 6d70  the.        comp
-00034930: 6f73 6974 652c 2075 7369 6e67 2073 6369  osite, using sci
-00034940: 7079 2e6e 6469 6d61 6765 2e6c 6162 656c  py.ndimage.label
-00034950: 2829 2e0a 0a20 2020 2020 2020 202a 2a50  ()...        **P
-00034960: 6172 616d 6574 6572 733a 2a2a 0a0a 2020  arameters:**..  
-00034970: 2020 2020 2020 766f 7865 6c5f 7369 7a65        voxel_size
-00034980: 203a 2074 7570 6c65 2c20 6465 6661 756c   : tuple, defaul
-00034990: 743d 4e6f 6e65 0a20 2020 2020 2020 2020  t=None.         
-000349a0: 2020 2056 6f78 656c 2073 697a 6520 2878     Voxel size (x
-000349b0: 2c20 7929 2064 696d 656e 7369 6f6e 7320  , y) dimensions 
-000349c0: 746f 2075 7365 2069 6e20 6372 6561 7469  to use in creati
-000349d0: 6e67 206d 6173 6b20 666f 720a 2020 2020  ng mask for.    
-000349e0: 2020 2020 2020 2020 6c61 6265 6c6c 696e          labellin
-000349f0: 672e 2020 5468 6973 2063 616e 2062 6520  g.  This can be 
-00034a00: 7573 6566 756c 2069 6620 7468 6520 524f  useful if the RO
-00034a10: 4920 736f 7572 6365 2069 7320 636f 6e74  I source is cont
-00034a20: 6f75 720a 2020 2020 2020 2020 2020 2020  our.            
-00034a30: 706f 696e 7473 2c20 616e 6420 7468 6520  points, and the 
-00034a40: 7265 736f 6c75 7469 6f6e 2077 616e 7465  resolution wante
-00034a50: 6420 6973 2067 7265 6174 6572 2074 6861  d is greater tha
-00034a60: 6e20 6973 2061 6c6c 6f77 6564 0a20 2020  n is allowed.   
-00034a70: 2020 2020 2020 2020 2062 7920 7468 6520           by the 
-00034a80: 766f 7865 6c20 7369 7a65 206f 6620 7468  voxel size of th
-00034a90: 6520 524f 4920 696d 6167 652e 0a0a 2020  e ROI image...  
-00034aa0: 2020 2020 2020 6e61 6d65 733a 206c 6973        names: lis
-00034ab0: 742c 2064 6566 6175 6c74 3d4e 6f6e 650a  t, default=None.
-00034ac0: 2020 2020 2020 2020 2020 2020 4c69 7374              List
-00034ad0: 206f 6620 6e61 6d65 7320 746f 2062 6520   of names to be 
-00034ae0: 6170 706c 6965 6420 746f 2074 6865 2063  applied to the c
-00034af0: 6f6d 706f 6e65 6e74 2052 4f49 732e 2020  omponent ROIs.  
-00034b00: 4e61 6d65 730a 2020 2020 2020 2020 2020  Names.          
-00034b10: 2020 6172 6520 6170 706c 6965 6420 6166    are applied af
-00034b20: 7465 7220 616e 7920 524f 4920 6f72 6465  ter any ROI orde
-00034b30: 7269 6e67 2e0a 0a20 2020 2020 2020 206f  ring...        o
-00034b40: 7264 6572 203a 2073 7472 2c20 6465 6661  rder : str, defa
-00034b50: 756c 743d 2778 2b27 0a20 2020 2020 2020  ult='x+'.       
-00034b60: 2020 2020 2053 7065 6369 6669 6361 7469       Specificati
-00034b70: 6f6e 206f 6620 7761 7920 6974 2077 6869  on of way it whi
-00034b80: 6368 2052 4f49 7320 6172 6520 746f 2062  ch ROIs are to b
-00034b90: 6520 6f72 6465 7264 3a0a 2020 2020 2020  e orderd:.      
-00034ba0: 2020 2020 2020 2d20 2778 2b27 203a 2069        - 'x+' : i
-00034bb0: 6e20 6f72 6465 7220 6f66 2069 6e63 7265  n order of incre
-00034bc0: 6173 696e 6720 7820 7661 6c75 652e 0a20  asing x value.. 
-00034bd0: 2020 2020 2020 2020 2020 202d 2027 782d             - 'x-
-00034be0: 2720 3a20 696e 206f 7264 6572 206f 6620  ' : in order of 
-00034bf0: 6465 6372 6561 7369 6e67 2078 2076 616c  decreasing x val
-00034c00: 7565 2e0a 2020 2020 2020 2020 2020 2020  ue..            
-00034c10: 2d20 2779 2b27 203a 2069 6e20 6f72 6465  - 'y+' : in orde
-00034c20: 7220 6f66 2069 6e63 7265 6173 696e 6720  r of increasing 
-00034c30: 7920 7661 6c75 652e 0a20 2020 2020 2020  y value..       
-00034c40: 2020 2020 202d 2027 792d 2720 3a20 696e       - 'y-' : in
-00034c50: 206f 7264 6572 206f 6620 6465 6372 6561   order of decrea
-00034c60: 7369 6e67 2079 2076 616c 7565 2e0a 2020  sing y value..  
-00034c70: 2020 2020 2020 2020 2020 2d20 277a 2b27            - 'z+'
-00034c80: 203a 2069 6e20 6f72 6465 7220 6f66 2069   : in order of i
-00034c90: 6e63 7265 6173 696e 6720 7a20 7661 6c75  ncreasing z valu
-00034ca0: 652e 0a20 2020 2020 2020 2020 2020 202d  e..            -
-00034cb0: 2027 7a2d 2720 3a20 696e 206f 7264 6572   'z-' : in order
-00034cc0: 206f 6620 6465 6372 6561 7369 6e67 207a   of decreasing z
-00034cd0: 2076 616c 7565 2e0a 2020 2020 2020 2020   value..        
-00034ce0: 2020 2020 4966 2061 6e79 206f 7468 6572      If any other
-00034cf0: 2076 616c 7565 7320 6973 2067 6976 656e   values is given
-00034d00: 2c20 6e6f 206f 7264 6572 696e 6720 6973  , no ordering is
-00034d10: 2070 6572 666f 726d 6564 2e0a 2020 2020   performed..    
-00034d20: 2020 2020 2727 270a 0a20 2020 2020 2020      '''..       
-00034d30: 2023 2049 6620 6e61 6d65 7320 6e6f 7420   # If names not 
-00034d40: 7370 6563 6966 6965 642c 206d 616b 6520  specified, make 
-00034d50: 6974 2061 6e20 656d 7074 7920 6c69 7374  it an empty list
-00034d60: 2e0a 2020 2020 2020 2020 6966 206e 616d  ..        if nam
-00034d70: 6573 2069 7320 4e6f 6e65 3a0a 2020 2020  es is None:.    
-00034d80: 2020 2020 2020 2020 6e61 6d65 7320 3d20          names = 
-00034d90: 5b5d 0a0a 2020 2020 2020 2020 2320 5265  []..        # Re
-00034da0: 7369 7a65 2052 4f49 206d 6173 6b20 6966  size ROI mask if
-00034db0: 2076 6f78 656c 2073 697a 6520 6973 2074   voxel size is t
-00034dc0: 6f20 6265 2063 6861 6e67 6564 2e0a 2020  o be changed..  
-00034dd0: 2020 2020 2020 6966 2076 6f78 656c 5f73        if voxel_s
-00034de0: 697a 653a 0a20 2020 2020 2020 2020 2020  ize:.           
-00034df0: 2072 6f69 203d 2052 4f49 2873 656c 6629   roi = ROI(self)
-00034e00: 0a20 2020 2020 2020 2020 2020 2076 6f78  .            vox
-00034e10: 656c 5f73 697a 655f 3364 203d 2028 766f  el_size_3d = (vo
-00034e20: 7865 6c5f 7369 7a65 5b30 5d2c 2076 6f78  xel_size[0], vox
-00034e30: 656c 5f73 697a 655b 315d 2c20 4e6f 6e65  el_size[1], None
-00034e40: 290a 2020 2020 2020 2020 2020 2020 726f  ).            ro
-00034e50: 692e 6372 6561 7465 5f6d 6173 6b28 290a  i.create_mask().
-00034e60: 2020 2020 2020 2020 2020 2020 726f 692e              roi.
-00034e70: 6d61 736b 2e72 6573 697a 6528 766f 7865  mask.resize(voxe
-00034e80: 6c5f 7369 7a65 3d76 6f78 656c 5f73 697a  l_size=voxel_siz
-00034e90: 655f 3364 2c20 6d65 7468 6f64 3d27 6e65  e_3d, method='ne
-00034ea0: 6172 6573 7427 2c0a 2020 2020 2020 2020  arest',.        
-00034eb0: 2020 2020 2020 2020 2020 2020 696d 6167              imag
-00034ec0: 655f 7369 7a65 5f75 6e69 743d 276d 6d27  e_size_unit='mm'
-00034ed0: 290a 2020 2020 2020 2020 2020 2020 726f  ).            ro
-00034ee0: 692e 7365 745f 696d 6167 6528 736b 7274  i.set_image(skrt
-00034ef0: 2e69 6d61 6765 2e49 6d61 6765 2872 6f69  .image.Image(roi
-00034f00: 2e6d 6173 6b29 290a 2020 2020 2020 2020  .mask)).        
-00034f10: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-00034f20: 2020 726f 6920 3d20 7365 6c66 0a20 0a20    roi = self. . 
-00034f30: 2020 2020 2020 2023 204c 6162 656c 2052         # Label R
-00034f40: 4f49 2063 6f6d 706f 6e65 6e74 732e 0a20  OI components.. 
-00034f50: 2020 2020 2020 206c 6162 656c 5f6d 6173         label_mas
-00034f60: 6b2c 206e 5f6c 6162 656c 203d 206e 6469  k, n_label = ndi
-00034f70: 6d61 6765 2e6c 6162 656c 2872 6f69 2e67  mage.label(roi.g
-00034f80: 6574 5f6d 6173 6b28 2929 0a0a 2020 2020  et_mask())..    
-00034f90: 2020 2020 6966 2076 6f78 656c 5f73 697a      if voxel_siz
-00034fa0: 6520 616e 6420 2763 6f6e 746f 7572 2720  e and 'contour' 
-00034fb0: 3d3d 2073 656c 662e 736f 7572 6365 5f74  == self.source_t
-00034fc0: 7970 653a 0a20 2020 2020 2020 2020 2020  ype:.           
-00034fd0: 2023 2048 616e 646c 6520 6361 7365 7320   # Handle cases 
-00034fe0: 7768 6572 6520 636f 6d70 6f73 6974 6520  where composite 
-00034ff0: 524f 4920 6973 2066 726f 6d20 636f 6e74  ROI is from cont
-00035000: 6f75 7220 706f 696e 7473 2c0a 2020 2020  our points,.    
-00035010: 2020 2020 2020 2020 2320 616e 6420 6d61          # and ma
-00035020: 736b 2076 6f78 656c 2073 697a 6520 6861  sk voxel size ha
-00035030: 7320 6265 656e 2070 6173 7365 6420 6173  s been passed as
-00035040: 2061 6e20 6172 6775 6d65 6e74 2e0a 2020   an argument..  
-00035050: 2020 2020 2020 2020 2020 2320 496e 2074            # In t
-00035060: 6869 7320 6361 7365 2063 6f6d 706f 6e65  his case compone
-00035070: 6e74 2052 4f49 7320 6172 6520 696e 6974  nt ROIs are init
-00035080: 6961 6c69 7365 6420 6672 6f6d 2063 6f6e  ialised from con
-00035090: 746f 7572 730a 2020 2020 2020 2020 2020  tours.          
-000350a0: 2020 2320 7265 6372 6561 7465 6420 6672    # recreated fr
-000350b0: 6f6d 2074 6865 206d 6173 6b2c 2077 6869  om the mask, whi
-000350c0: 6368 206d 6179 2062 6520 6869 6768 6572  ch may be higher
-000350d0: 2d72 6573 6f6c 7574 696f 6e0a 2020 2020  -resolution.    
-000350e0: 2020 2020 2020 2020 2320 7468 616e 2074          # than t
-000350f0: 6865 2064 6566 6175 6c74 2e0a 2020 2020  he default..    
-00035100: 2020 2020 2020 2020 7373 3020 3d20 5374          ss0 = St
-00035110: 7275 6374 7572 6553 6574 286c 6162 656c  ructureSet(label
-00035120: 5f6d 6173 6b2c 206d 756c 7469 5f6c 6162  _mask, multi_lab
-00035130: 656c 3d54 7275 652c 2069 6d61 6765 3d72  el=True, image=r
-00035140: 6f69 2e6d 6173 6b29 0a20 2020 2020 2020  oi.mask).       
-00035150: 2020 2020 2073 7320 3d20 5374 7275 6374       ss = Struct
-00035160: 7572 6553 6574 2829 0a20 2020 2020 2020  ureSet().       
-00035170: 2020 2020 2066 6f72 2072 6f69 2069 6e20       for roi in 
-00035180: 7373 302e 6765 745f 726f 6973 2829 3a0a  ss0.get_rois():.
-00035190: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000351a0: 7373 2e61 6464 5f72 6f69 2852 4f49 2873  ss.add_roi(ROI(s
-000351b0: 6f75 7263 653d 726f 692e 6765 745f 636f  ource=roi.get_co
-000351c0: 6e74 6f75 7273 2829 2c20 6e61 6d65 3d72  ntours(), name=r
-000351d0: 6f69 2e6e 616d 6529 290a 2020 2020 2020  oi.name)).      
-000351e0: 2020 2020 2020 7373 2e73 6574 5f69 6d61        ss.set_ima
-000351f0: 6765 2873 656c 662e 696d 6167 6529 0a20  ge(self.image). 
-00035200: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-00035210: 2020 2020 2020 2020 2023 2048 616e 646c           # Handl
-00035220: 6520 6361 7365 7320 7768 6572 6520 636f  e cases where co
-00035230: 6d70 6f6e 656e 7420 524f 4973 2061 7265  mponent ROIs are
-00035240: 2069 6e69 7469 616c 6973 6564 2066 726f   initialised fro
-00035250: 6d20 6d61 736b 2e0a 2020 2020 2020 2020  m mask..        
-00035260: 2020 2020 6966 2076 6f78 656c 5f73 697a      if voxel_siz
-00035270: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-00035280: 2020 2023 2049 6620 766f 7865 6c20 7369     # If voxel si
-00035290: 7a65 2063 6861 6e67 6564 2066 6f72 206c  ze changed for l
-000352a0: 6162 656c 6c69 6e67 2c0a 2020 2020 2020  abelling,.      
-000352b0: 2020 2020 2020 2020 2020 2320 7265 6372            # recr
-000352c0: 6561 7465 206c 6162 656c 206d 6173 6b20  eate label mask 
-000352d0: 7769 7468 206f 7269 6769 6e61 6c20 766f  with original vo
-000352e0: 7865 6c20 7369 7a65 2e0a 2020 2020 2020  xel size..      
-000352f0: 2020 2020 2020 2020 2020 726f 692e 6d61            roi.ma
-00035300: 736b 2e64 6174 6120 3d20 6c61 6265 6c5f  sk.data = label_
-00035310: 6d61 736b 0a20 2020 2020 2020 2020 2020  mask.           
-00035320: 2020 2020 2072 6f69 2e6d 6173 6b2e 6d61       roi.mask.ma
-00035330: 7463 685f 7369 7a65 2873 656c 662e 696d  tch_size(self.im
-00035340: 6167 652c 206d 6574 686f 643d 276e 6561  age, method='nea
-00035350: 7265 7374 2729 0a20 2020 2020 2020 2020  rest').         
-00035360: 2020 2020 2020 206c 6162 656c 5f6d 6173         label_mas
-00035370: 6b20 3d20 726f 692e 6d61 736b 2e64 6174  k = roi.mask.dat
-00035380: 610a 0a20 2020 2020 2020 2020 2020 2023  a..            #
-00035390: 2043 7265 6174 6520 7374 7275 6374 7572   Create structur
-000353a0: 6520 7365 7420 6672 6f6d 206c 6162 656c  e set from label
-000353b0: 206d 6173 6b2e 0a20 2020 2020 2020 2020   mask..         
-000353c0: 2020 2073 7320 3d20 5374 7275 6374 7572     ss = Structur
-000353d0: 6553 6574 286c 6162 656c 5f6d 6173 6b2c  eSet(label_mask,
-000353e0: 206d 756c 7469 5f6c 6162 656c 3d54 7275   multi_label=Tru
-000353f0: 652c 2069 6d61 6765 3d73 656c 662e 696d  e, image=self.im
-00035400: 6167 6529 0a0a 2020 2020 2020 2020 2320  age)..        # 
-00035410: 5374 6f72 6520 524f 4973 2069 6e20 7370  Store ROIs in sp
-00035420: 6563 6966 6965 6420 6f72 6465 722e 0a20  ecified order.. 
-00035430: 2020 2020 2020 2073 732e 6f72 6465 725f         ss.order_
-00035440: 726f 6973 286f 7264 6572 290a 0a20 2020  rois(order)..   
-00035450: 2020 2020 2023 2041 7070 6c79 206e 616d       # Apply nam
-00035460: 6573 2e0a 2020 2020 2020 2020 666f 7220  es..        for 
-00035470: 6920 696e 2072 616e 6765 286d 696e 286c  i in range(min(l
-00035480: 656e 286e 616d 6573 292c 206c 656e 2873  en(names), len(s
-00035490: 732e 726f 6973 2929 293a 0a20 2020 2020  s.rois))):.     
-000354a0: 2020 2020 2020 2073 732e 726f 6973 5b69         ss.rois[i
-000354b0: 5d2e 6e61 6d65 203d 206e 616d 6573 5b69  ].name = names[i
-000354c0: 5d0a 0a20 2020 2020 2020 2072 6574 7572  ]..        retur
-000354d0: 6e20 7373 0a0a 2020 2020 6465 6620 7370  n ss..    def sp
-000354e0: 6c69 745f 696e 5f74 776f 2873 656c 662c  lit_in_two(self,
-000354f0: 2061 7869 733d 2778 272c 2076 303d 302c   axis='x', v0=0,
-00035500: 206e 616d 6573 3d4e 6f6e 652c 293a 0a20   names=None,):. 
-00035510: 2020 2020 2020 2027 2727 0a20 2020 2020         '''.     
-00035520: 2020 2053 706c 6974 2061 2063 6f6d 706f     Split a compo
-00035530: 7369 7465 2052 4f49 2069 6e74 6f20 7477  site ROI into tw
-00035540: 6f20 636f 6d70 6f6e 656e 7420 7061 7274  o component part
-00035550: 732e 0a0a 2020 2020 2020 2020 5370 6c69  s...        Spli
-00035560: 7420 616e 2052 4f49 2069 6e74 6f20 7477  t an ROI into tw
-00035570: 6f20 636f 6d70 6f6e 656e 7473 2c20 6569  o components, ei
-00035580: 7468 6572 2073 6964 6520 6f66 2061 2073  ther side of a s
-00035590: 7065 6369 6669 6564 0a20 2020 2020 2020  pecified.       
-000355a0: 2070 6c61 6e65 2e20 2054 6869 7320 6d61   plane.  This ma
-000355b0: 7920 6265 2075 7365 6675 6c2c 2066 6f72  y be useful, for
-000355c0: 2065 7861 6d70 6c65 2c20 7768 656e 206c   example, when l
-000355d0: 6566 7420 616e 6420 7269 6768 740a 2020  eft and right.  
-000355e0: 2020 2020 2020 524f 4973 2068 6176 6520        ROIs have 
-000355f0: 6265 656e 2061 7373 6967 6e65 6420 6120  been assigned a 
-00035600: 636f 6d6d 6f6e 206c 6162 656c 2e0a 0a20  common label... 
-00035610: 2020 2020 2020 2046 6f72 206d 6f72 6520         For more 
-00035620: 6765 6e65 7261 6c20 524f 4920 7370 6c69  general ROI spli
-00035630: 7474 696e 672c 2073 6565 2073 6b72 742e  tting, see skrt.
-00035640: 7374 7275 6374 7572 652e 524f 492e 7370  structure.ROI.sp
-00035650: 6c69 7428 292e 0a20 2020 2020 2020 204e  lit()..        N
-00035660: 6f74 6520 7468 6174 2073 706c 6974 2829  ote that split()
-00035670: 2061 6374 7320 6f6e 2062 696e 6172 7920   acts on binary 
-00035680: 6d61 736b 732c 2077 6865 7265 6173 2073  masks, whereas s
-00035690: 706c 6974 5f69 6e5f 7477 6f28 290a 2020  plit_in_two().  
-000356a0: 2020 2020 2020 6163 7473 206f 6e20 636f        acts on co
-000356b0: 6e74 6f75 7273 2e0a 0a20 2020 2020 2020  ntours...       
-000356c0: 202a 2a50 6172 616d 6574 6572 733a 2a2a   **Parameters:**
-000356d0: 0a0a 2020 2020 2020 2020 6178 6973 203a  ..        axis :
-000356e0: 2027 7374 7227 2c20 6465 6661 756c 743d   'str', default=
-000356f0: 2778 270a 2020 2020 2020 2020 2020 2020  'x'.            
-00035700: 4178 6973 2028 2778 272c 2027 7927 206f  Axis ('x', 'y' o
-00035710: 7220 277a 2729 2070 6572 7065 6e64 6963  r 'z') perpendic
-00035720: 756c 6172 2074 6f20 706c 616e 6520 6162  ular to plane ab
-00035730: 6f75 7420 7768 6963 680a 2020 2020 2020  out which.      
-00035740: 2020 2020 2020 524f 4920 6973 2074 6f20        ROI is to 
-00035750: 6265 2073 706c 6974 2e0a 0a20 2020 2020  be split...     
-00035760: 2020 2076 3020 3a20 666c 6f61 742c 2064     v0 : float, d
-00035770: 6566 6175 6c74 3d30 0a20 2020 2020 2020  efault=0.       
-00035780: 2020 2020 2043 6f6f 7264 696e 6174 6520       Coordinate 
-00035790: 616c 6f6e 6720 7365 6c65 6374 6564 2061  along selected a
-000357a0: 7869 732c 2073 7065 6369 6679 696e 6720  xis, specifying 
-000357b0: 706c 616e 6520 6162 6f75 7420 7768 6963  plane about whic
-000357c0: 680a 2020 2020 2020 2020 2020 2020 524f  h.            RO
-000357d0: 4920 6973 2074 6f20 6265 2073 706c 6974  I is to be split
-000357e0: 2e0a 0a20 2020 2020 2020 206e 616d 6573  ...        names
-000357f0: 3a20 6c69 7374 2c20 6465 6661 756c 743d  : list, default=
-00035800: 4e6f 6e65 0a20 2020 2020 2020 2020 2020  None.           
-00035810: 204c 6973 7420 6f66 206e 616d 6573 2074   List of names t
-00035820: 6f20 6265 2061 7070 6c69 6564 2074 6f20  o be applied to 
-00035830: 7468 6520 636f 6d70 6f6e 656e 7420 524f  the component RO
-00035840: 4973 2e0a 2020 2020 2020 2020 2727 270a  Is..        '''.
-00035850: 0a20 2020 2020 2020 2023 2049 6620 6e61  .        # If na
-00035860: 6d65 7320 6e6f 7420 7370 6563 6966 6965  mes not specifie
-00035870: 642c 2069 6e69 7469 616c 6973 6520 746f  d, initialise to
-00035880: 2065 6d70 7479 206c 6973 742e 0a20 2020   empty list..   
-00035890: 2020 2020 2069 6620 6e61 6d65 7320 6973       if names is
-000358a0: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-000358b0: 2020 206e 616d 6573 203d 205b 5d0a 0a20     names = [].. 
-000358c0: 2020 2020 2020 2023 2042 6173 6564 206f         # Based o
-000358d0: 6e20 7365 6c65 6374 6564 2061 7869 732c  n selected axis,
-000358e0: 2064 6566 696e 6520 7669 6577 2061 6e64   define view and
-000358f0: 2064 6566 6175 6c74 206e 616d 6520 7375   default name su
-00035900: 6666 6978 6573 2e0a 2020 2020 2020 2020  ffixes..        
-00035910: 6966 2027 7827 203d 3d20 6178 6973 2e6c  if 'x' == axis.l
-00035920: 6f77 6572 2829 3a0a 2020 2020 2020 2020  ower():.        
-00035930: 2020 2020 7669 6577 203d 2027 782d 7927      view = 'x-y'
-00035940: 0a20 2020 2020 2020 2020 2020 2073 7566  .            suf
-00035950: 6669 7865 7320 3d20 2827 7269 6768 7427  fixes = ('right'
-00035960: 2c20 276c 6566 7427 290a 2020 2020 2020  , 'left').      
-00035970: 2020 656c 6966 2027 7927 203d 3d20 6178    elif 'y' == ax
-00035980: 6973 2e6c 6f77 6572 2829 3a0a 2020 2020  is.lower():.    
-00035990: 2020 2020 2020 2020 7669 6577 203d 2027          view = '
-000359a0: 782d 7927 0a20 2020 2020 2020 2020 2020  x-y'.           
-000359b0: 2073 7566 6669 7865 7320 3d20 2827 616e   suffixes = ('an
-000359c0: 7465 7269 6f72 272c 2027 706f 7374 6572  terior', 'poster
-000359d0: 696f 7227 290a 2020 2020 2020 2020 656c  ior').        el
-000359e0: 6966 2027 7a27 203d 3d20 6178 6973 2e6c  if 'z' == axis.l
-000359f0: 6f77 6572 2829 3a0a 2020 2020 2020 2020  ower():.        
-00035a00: 2020 2020 7669 6577 203d 2027 792d 7a27      view = 'y-z'
-00035a10: 0a20 2020 2020 2020 2020 2020 2073 7566  .            suf
-00035a20: 6669 7865 7320 3d20 2827 696e 6665 7269  fixes = ('inferi
-00035a30: 6f72 272c 2027 7375 7065 7269 6f72 2729  or', 'superior')
-00035a40: 0a20 2020 2020 2020 2020 2020 2023 2049  .            # I
-00035a50: 6e20 7468 6520 2779 2d7a 2720 7669 6577  n the 'y-z' view
-00035a60: 2c20 7920 616e 6420 7a20 6178 6573 206d  , y and z axes m
-00035a70: 6170 2074 6f20 7368 6170 656c 7920 7820  ap to shapely x 
-00035a80: 616e 6420 7920 6178 6573 2e0a 2020 2020  and y axes..    
-00035a90: 2020 2020 2020 2020 6178 6973 203d 2027          axis = '
-00035aa0: 7927 0a0a 2020 2020 2020 2020 2320 4465  y'..        # De
-00035ab0: 6669 6e65 2070 6f6c 7967 6f6e 2072 6570  fine polygon rep
-00035ac0: 7265 7365 6e74 696e 6720 524f 4920 636f  resenting ROI co
-00035ad0: 6e74 6f75 7220 6173 206c 6f77 206f 7220  ntour as low or 
-00035ae0: 6869 6768 2c0a 2020 2020 2020 2020 2320  high,.        # 
-00035af0: 6465 7065 6e64 696e 6720 6f6e 2077 6865  depending on whe
-00035b00: 7468 6572 2074 6865 2070 6f6c 7967 6f6e  ther the polygon
-00035b10: 2063 656e 7472 6f69 6420 6973 206c 6f77   centroid is low
-00035b20: 6572 206f 7220 6869 6768 6572 0a20 2020  er or higher.   
-00035b30: 2020 2020 2023 2074 6861 6e20 7468 6520       # than the 
-00035b40: 636f 6f72 6469 6e61 7465 206f 6620 7468  coordinate of th
-00035b50: 6520 7370 6c69 7474 696e 6720 706c 616e  e splitting plan
-00035b60: 652e 0a20 2020 2020 2020 2070 6f6c 7967  e..        polyg
-00035b70: 6f6e 735f 6c6f 7720 3d20 7b7d 0a20 2020  ons_low = {}.   
-00035b80: 2020 2020 2070 6f6c 7967 6f6e 735f 6869       polygons_hi
-00035b90: 6768 203d 207b 7d0a 2020 2020 2020 2020  gh = {}.        
-00035ba0: 666f 7220 7a2c 2070 6f6c 7967 6f6e 7320  for z, polygons 
-00035bb0: 696e 2073 656c 662e 6765 745f 706f 6c79  in self.get_poly
-00035bc0: 676f 6e73 2876 6965 7729 2e69 7465 6d73  gons(view).items
-00035bd0: 2829 3a0a 2020 2020 2020 2020 2020 2020  ():.            
-00035be0: 666f 7220 706f 6c79 676f 6e20 696e 2070  for polygon in p
-00035bf0: 6f6c 7967 6f6e 733a 0a20 2020 2020 2020  olygons:.       
-00035c00: 2020 2020 2020 2020 2076 203d 2067 6574           v = get
-00035c10: 6174 7472 2870 6f6c 7967 6f6e 2e63 656e  attr(polygon.cen
-00035c20: 7472 6f69 642c 2061 7869 7329 0a20 2020  troid, axis).   
-00035c30: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00035c40: 7620 3c20 7630 3a0a 2020 2020 2020 2020  v < v0:.        
-00035c50: 2020 2020 2020 2020 2020 2020 6966 206e              if n
-00035c60: 6f74 207a 2069 6e20 706f 6c79 676f 6e73  ot z in polygons
-00035c70: 5f6c 6f77 3a0a 2020 2020 2020 2020 2020  _low:.          
-00035c80: 2020 2020 2020 2020 2020 2020 2020 706f                po
-00035c90: 6c79 676f 6e73 5f6c 6f77 5b7a 5d20 3d20  lygons_low[z] = 
-00035ca0: 5b5d 0a20 2020 2020 2020 2020 2020 2020  [].             
-00035cb0: 2020 2020 2020 2070 6f6c 7967 6f6e 735f         polygons_
-00035cc0: 6c6f 775b 7a5d 2e61 7070 656e 6428 706f  low[z].append(po
-00035cd0: 6c79 676f 6e29 0a20 2020 2020 2020 2020  lygon).         
-00035ce0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-00035cf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00035d00: 2069 6620 6e6f 7420 7a20 696e 2070 6f6c   if not z in pol
-00035d10: 7967 6f6e 735f 6869 6768 3a0a 2020 2020  ygons_high:.    
-00035d20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00035d30: 2020 2020 706f 6c79 676f 6e73 5f68 6967      polygons_hig
-00035d40: 685b 7a5d 203d 205b 5d0a 2020 2020 2020  h[z] = [].      
-00035d50: 2020 2020 2020 2020 2020 2020 2020 706f                po
-00035d60: 6c79 676f 6e73 5f68 6967 685b 7a5d 2e61  lygons_high[z].a
-00035d70: 7070 656e 6428 706f 6c79 676f 6e29 0a0a  ppend(polygon)..
-00035d80: 0a20 2020 2020 2020 2023 2043 7265 6174  .        # Creat
-00035d90: 6520 524f 4920 6672 6f6d 2070 6f6c 7967  e ROI from polyg
-00035da0: 6f6e 7320 6265 6c6f 7720 7468 6520 7370  ons below the sp
-00035db0: 6c69 7474 696e 6720 706c 616e 652e 0a20  litting plane.. 
-00035dc0: 2020 2020 2020 2069 6620 706f 6c79 676f         if polygo
-00035dd0: 6e73 5f6c 6f77 3a0a 2020 2020 2020 2020  ns_low:.        
-00035de0: 2020 2020 726f 695f 6c6f 7720 3d20 524f      roi_low = RO
-00035df0: 4928 736f 7572 6365 3d70 6f6c 7967 6f6e  I(source=polygon
-00035e00: 735f 6c6f 772c 2069 6d61 6765 3d73 656c  s_low, image=sel
-00035e10: 662e 696d 6167 6529 0a20 2020 2020 2020  f.image).       
-00035e20: 2020 2020 2072 6f69 5f6c 6f77 2e6e 616d       roi_low.nam
-00035e30: 6520 3d20 286e 616d 6573 5b30 5d20 6966  e = (names[0] if
-00035e40: 206c 656e 286e 616d 6573 2920 3e20 300a   len(names) > 0.
-00035e50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00035e60: 2020 2020 656c 7365 2066 277b 7365 6c66      else f'{self
-00035e70: 2e6e 616d 657d 5f7b 7375 6666 6978 6573  .name}_{suffixes
-00035e80: 5b30 5d7d 2729 0a20 2020 2020 2020 2065  [0]}').        e
-00035e90: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-00035ea0: 2072 6f69 5f6c 6f77 203d 204e 6f6e 650a   roi_low = None.
-00035eb0: 0a20 2020 2020 2020 2023 2043 7265 6174  .        # Creat
-00035ec0: 6520 524f 4920 6672 6f6d 2070 6f6c 7967  e ROI from polyg
-00035ed0: 6f6e 7320 6162 6f76 6520 7468 6520 7370  ons above the sp
-00035ee0: 6c69 7474 696e 6720 706c 616e 652e 0a20  litting plane.. 
-00035ef0: 2020 2020 2020 2069 6620 706f 6c79 676f         if polygo
-00035f00: 6e73 5f68 6967 683a 0a20 2020 2020 2020  ns_high:.       
-00035f10: 2020 2020 2072 6f69 5f68 6967 6820 3d20       roi_high = 
-00035f20: 524f 4928 736f 7572 6365 3d70 6f6c 7967  ROI(source=polyg
-00035f30: 6f6e 735f 6869 6768 2c20 696d 6167 653d  ons_high, image=
-00035f40: 7365 6c66 2e69 6d61 6765 290a 2020 2020  self.image).    
-00035f50: 2020 2020 2020 2020 726f 695f 6869 6768          roi_high
-00035f60: 2e6e 616d 6520 3d20 286e 616d 6573 5b31  .name = (names[1
-00035f70: 5d20 6966 206c 656e 286e 616d 6573 2920  ] if len(names) 
-00035f80: 3e20 310a 2020 2020 2020 2020 2020 2020  > 1.            
-00035f90: 2020 2020 2020 2020 656c 7365 2066 277b          else f'{
-00035fa0: 7365 6c66 2e6e 616d 657d 5f7b 7375 6666  self.name}_{suff
-00035fb0: 6978 6573 5b31 5d7d 2729 0a20 2020 2020  ixes[1]}').     
-00035fc0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00035fd0: 2020 2020 2072 6f69 5f68 6967 6820 3d20       roi_high = 
-00035fe0: 4e6f 6e65 0a0a 2020 2020 2020 2020 2320  None..        # 
-00035ff0: 4372 6561 7465 2073 7472 7563 7475 7265  Create structure
-00036000: 2073 6574 2066 6f72 2063 6f6d 706f 6e65   set for compone
-00036010: 6e74 2052 4f49 2873 292e 0a20 2020 2020  nt ROI(s)..     
-00036020: 2020 2072 6f69 7320 3d20 6c69 7374 2866     rois = list(f
-00036030: 696c 7465 7228 4e6f 6e65 2c20 5b72 6f69  ilter(None, [roi
-00036040: 5f6c 6f77 2c20 726f 695f 6869 6768 5d29  _low, roi_high])
-00036050: 290a 2020 2020 2020 2020 6966 2072 6f69  ).        if roi
-00036060: 733a 0a20 2020 2020 2020 2020 2020 2073  s:.            s
-00036070: 7320 3d20 5374 7275 6374 7572 6553 6574  s = StructureSet
-00036080: 2870 6174 683d 726f 6973 2c20 6e61 6d65  (path=rois, name
-00036090: 3d73 656c 662e 6e61 6d65 2c20 696d 6167  =self.name, imag
-000360a0: 653d 7365 6c66 2e69 6d61 6765 290a 2020  e=self.image).  
-000360b0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-000360c0: 2020 2020 2020 2020 7373 203d 204e 6f6e          ss = Non
-000360d0: 650a 0a20 2020 2020 2020 2072 6574 7572  e..        retur
-000360e0: 6e20 7373 0a0a 2020 2020 6465 6620 6765  n ss..    def ge
-000360f0: 745f 7061 7463 6828 7365 6c66 2c20 706c  t_patch(self, pl
-00036100: 6f74 5f74 7970 653d 4e6f 6e65 2c20 636f  ot_type=None, co
-00036110: 6c6f 723d 4e6f 6e65 2c20 6f70 6163 6974  lor=None, opacit
-00036120: 793d 4e6f 6e65 2c0a 2020 2020 2020 2020  y=None,.        
-00036130: 2020 2020 6c69 6e65 7769 6474 683d 4e6f      linewidth=No
-00036140: 6e65 2c20 6e61 6d65 3d4e 6f6e 6529 3a0a  ne, name=None):.
-00036150: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00036160: 2020 2020 4f62 7461 696e 2070 6174 6368      Obtain patch
-00036170: 2072 6566 6c65 6374 696e 6720 524f 4920   reflecting ROI 
-00036180: 6368 6172 6163 7465 7269 7374 6963 7320  characteristics 
-00036190: 666f 7220 706c 6f74 7469 6e67 2e0a 0a20  for plotting... 
-000361a0: 2020 2020 2020 2054 6865 2070 6174 6368         The patch
-000361b0: 206f 6274 6169 6e65 6420 6361 6e20 6265   obtained can be
-000361c0: 2075 7365 6420 6173 2061 2068 616e 646c   used as a handl
-000361d0: 6520 696e 206c 6567 656e 6420 6372 6561  e in legend crea
-000361e0: 7469 6f6e 2e0a 0a20 2020 2020 2020 202a  tion...        *
-000361f0: 2a50 6172 616d 6574 6572 733a 2a2a 0a0a  *Parameters:**..
-00036200: 2020 2020 2020 2020 706c 6f74 5f74 7970          plot_typ
-00036210: 6520 3a20 7374 722c 2064 6566 6175 6c74  e : str, default
-00036220: 3d4e 6f6e 650a 2020 2020 2020 2020 2020  =None.          
-00036230: 2020 506c 6f74 7469 6e67 2074 7970 652e    Plotting type.
-00036240: 2049 6620 4e6f 6e65 2c20 7769 6c6c 2062   If None, will b
-00036250: 6520 6569 7468 6572 2022 636f 6e74 6f75  e either "contou
-00036260: 7222 206f 7220 226d 6173 6b22 200a 2020  r" or "mask" .  
-00036270: 2020 2020 2020 2020 2020 6465 7065 6e64            depend
-00036280: 696e 6720 6f6e 2074 6865 2069 6e70 7574  ing on the input
-00036290: 2074 7970 6520 6f66 2074 6865 2052 4f49   type of the ROI
-000362a0: 2e20 4f70 7469 6f6e 733a 0a0a 2020 2020  . Options:..    
-000362b0: 2020 2020 2020 2020 2020 2020 2d20 2263              - "c
-000362c0: 6f6e 746f 7572 220a 2020 2020 2020 2020  ontour".        
-000362d0: 2020 2020 2020 2020 2d20 226d 6173 6b22          - "mask"
-000362e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000362f0: 202d 2022 6365 6e74 726f 6964 2220 2863   - "centroid" (c
-00036300: 6f6e 746f 7572 2077 6974 6820 6d61 726b  ontour with mark
-00036310: 6572 2061 7420 6365 6e74 726f 6964 290a  er at centroid).
-00036320: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00036330: 2d20 2266 696c 6c65 6422 2028 7472 616e  - "filled" (tran
-00036340: 7370 6172 656e 7420 6d61 736b 202b 2063  sparent mask + c
-00036350: 6f6e 746f 7572 290a 2020 2020 2020 2020  ontour).        
-00036360: 2020 2020 2020 2020 2d20 2266 696c 6c65          - "fille
-00036370: 6420 6365 6e74 726f 6964 2220 2866 696c  d centroid" (fil
-00036380: 6c65 6420 7769 7468 206d 6172 6b65 7220  led with marker 
-00036390: 6174 2063 656e 7472 6f69 6429 0a0a 2020  at centroid)..  
-000363a0: 2020 2020 2020 636f 6c6f 7220 3a20 6d61        color : ma
-000363b0: 7470 6c6f 746c 6962 2063 6f6c 6f72 2c20  tplotlib color, 
-000363c0: 6465 6661 756c 743d 4e6f 6e65 0a20 2020  default=None.   
-000363d0: 2020 2020 2020 2020 2043 6f6c 6f72 2077           Color w
-000363e0: 6974 6820 7768 6963 6820 746f 2070 6c6f  ith which to plo
-000363f0: 7420 7468 6520 524f 493b 206f 7665 7272  t the ROI; overr
-00036400: 6964 6573 2074 6865 2052 4f49 2773 206f  ides the ROI's o
-00036410: 776e 2063 6f6c 6f72 2e20 4966 200a 2020  wn color. If .  
-00036420: 2020 2020 2020 2020 2020 4e6f 6e65 2c20            None, 
-00036430: 7365 6c66 2e63 6f6c 6f72 2077 696c 6c20  self.color will 
-00036440: 6265 2075 7365 642e 0a0a 2020 2020 2020  be used...      
-00036450: 2020 6f70 6163 6974 7920 3a20 666c 6f61    opacity : floa
-00036460: 742c 2064 6566 6175 6c74 3d4e 6f6e 650a  t, default=None.
-00036470: 2020 2020 2020 2020 2020 2020 4f70 6163              Opac
-00036480: 6974 7920 746f 2075 7365 2069 6620 706c  ity to use if pl
-00036490: 6f74 7469 6e67 206d 6173 6b20 2869 2e65  otting mask (i.e
-000364a0: 2e20 706c 6f74 2074 7970 6573 2022 6d61  . plot types "ma
-000364b0: 736b 222c 2022 6669 6c6c 6564 222c 200a  sk", "filled", .
-000364c0: 2020 2020 2020 2020 2020 2020 6f72 2022              or "
-000364d0: 6669 6c6c 6564 2063 656e 7472 6f69 6422  filled centroid"
-000364e0: 292e 2049 6620 4e6f 6e65 2c20 6f70 6163  ). If None, opac
-000364f0: 6974 7920 7769 6c6c 2062 6520 3120 6279  ity will be 1 by
-00036500: 2064 6566 6175 6c74 2066 6f72 200a 2020   default for .  
-00036510: 2020 2020 2020 2020 2020 736f 6c69 6420            solid 
-00036520: 6d61 736b 2070 6c6f 7473 2061 6e64 2030  mask plots and 0
-00036530: 2e33 2062 7920 6465 6661 756c 7420 666f  .3 by default fo
-00036540: 7220 6669 6c6c 6564 2070 6c6f 7473 2e0a  r filled plots..
-00036550: 0a20 2020 2020 2020 206c 696e 6577 6964  .        linewid
-00036560: 7468 203a 2066 6c6f 6174 2c20 6465 6661  th : float, defa
-00036570: 756c 743d 4e6f 6e65 0a20 2020 2020 2020  ult=None.       
-00036580: 2020 2020 2057 6964 7468 206f 6620 636f       Width of co
-00036590: 6e74 6f75 7220 6c69 6e65 732e 2049 6620  ntour lines. If 
-000365a0: 4e6f 6e65 2c20 7468 6520 6d61 7470 6c6f  None, the matplo
-000365b0: 746c 6962 2064 6566 6175 6c74 2073 6574  tlib default set
-000365c0: 7469 6e67 200a 2020 2020 2020 2020 2020  ting .          
-000365d0: 2020 7769 6c6c 2062 6520 7573 6564 2e0a    will be used..
-000365e0: 0a20 2020 2020 2020 206e 616d 6520 3a20  .        name : 
-000365f0: 7374 722c 2064 6566 6175 6c74 3d4e 6f6e  str, default=Non
-00036600: 650a 2020 2020 2020 2020 2020 2020 4e61  e.            Na
-00036610: 6d65 2069 6465 6e74 6966 7969 6e67 2052  me identifying R
-00036620: 4f49 2e20 2049 6620 4e6f 6e65 2c20 7365  OI.  If None, se
-00036630: 6c66 2e6e 616d 6520 7769 6c6c 2062 6520  lf.name will be 
-00036640: 7573 6564 2e0a 2020 2020 2020 2020 2222  used..        ""
-00036650: 220a 0a20 2020 2020 2020 2023 2045 6e73  "..        # Ens
-00036660: 7572 6520 7468 6174 2070 6c6f 7474 696e  ure that plottin
-00036670: 6720 6368 6172 6163 7465 7269 7374 6963  g characteristic
-00036680: 7320 6172 6520 6465 6669 6e65 642e 0a20  s are defined.. 
-00036690: 2020 2020 2020 2069 6620 706c 6f74 5f74         if plot_t
-000366a0: 7970 6520 6973 204e 6f6e 653a 0a20 2020  ype is None:.   
-000366b0: 2020 2020 2020 2020 2070 6c6f 745f 7479           plot_ty
-000366c0: 7065 203d 2073 656c 662e 6465 6661 756c  pe = self.defaul
-000366d0: 745f 6765 6f6d 5f6d 6574 686f 640a 0a20  t_geom_method.. 
-000366e0: 2020 2020 2020 2069 6620 636f 6c6f 7220         if color 
-000366f0: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
-00036700: 2020 2020 2063 6f6c 6f72 203d 2073 656c       color = sel
-00036710: 662e 636f 6c6f 720a 0a20 2020 2020 2020  f.color..       
-00036720: 2069 6620 6f70 6163 6974 7920 6973 204e   if opacity is N
-00036730: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-00036740: 206f 7061 6369 7479 203d 2030 2e33 2069   opacity = 0.3 i
-00036750: 6620 2266 696c 6c65 6422 2069 6e20 706c  f "filled" in pl
-00036760: 6f74 5f74 7970 6520 656c 7365 2031 0a0a  ot_type else 1..
-00036770: 2020 2020 2020 2020 6966 206c 696e 6577          if linew
-00036780: 6964 7468 2069 7320 4e6f 6e65 3a0a 2020  idth is None:.  
-00036790: 2020 2020 2020 2020 2020 6c69 6e65 7769            linewi
-000367a0: 6474 6820 3d20 6465 6661 756c 7450 6172  dth = defaultPar
-000367b0: 616d 735b 226c 696e 6573 2e6c 696e 6577  ams["lines.linew
-000367c0: 6964 7468 225d 5b30 5d0a 0a20 2020 2020  idth"][0]..     
-000367d0: 2020 2069 6620 6e61 6d65 2069 7320 4e6f     if name is No
-000367e0: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-000367f0: 6e61 6d65 203d 2073 656c 662e 6e61 6d65  name = self.name
-00036800: 0a0a 2020 2020 2020 2020 2320 5365 7420  ..        # Set 
-00036810: 706f 7465 6e74 6961 6c6c 7920 6469 6666  potentially diff
-00036820: 6572 656e 7420 6f70 6163 6974 6965 7320  erent opacities 
-00036830: 666f 7220 6661 6365 636f 6c6f 7220 616e  for facecolor an
-00036840: 6420 6564 6765 636f 6c6f 720a 2020 2020  d edgecolor.    
-00036850: 2020 2020 6661 6365 636f 6c6f 7220 3d20      facecolor = 
-00036860: 6d61 7470 6c6f 746c 6962 2e63 6f6c 6f72  matplotlib.color
-00036870: 732e 746f 5f72 6762 6128 636f 6c6f 722c  s.to_rgba(color,
-00036880: 2061 6c70 6861 3d6f 7061 6369 7479 290a   alpha=opacity).
-00036890: 2020 2020 2020 2020 6564 6765 636f 6c6f          edgecolo
-000368a0: 7220 3d20 6d61 7470 6c6f 746c 6962 2e63  r = matplotlib.c
-000368b0: 6f6c 6f72 732e 746f 5f72 6762 6128 636f  olors.to_rgba(co
-000368c0: 6c6f 722c 2061 6c70 6861 3d31 290a 0a20  lor, alpha=1).. 
-000368d0: 2020 2020 2020 2023 2044 6566 696e 6520         # Define 
-000368e0: 7061 7463 6820 6163 636f 7264 696e 6720  patch according 
-000368f0: 746f 2070 6c6f 745f 7479 7065 2e0a 2020  to plot_type..  
-00036900: 2020 2020 2020 7061 7463 6820 3d20 4e6f        patch = No
-00036910: 6e65 0a20 2020 2020 2020 2069 6620 706c  ne.        if pl
-00036920: 6f74 5f74 7970 6520 696e 205b 2263 6f6e  ot_type in ["con
-00036930: 746f 7572 222c 2022 6365 6e74 726f 6964  tour", "centroid
-00036940: 225d 3a0a 2020 2020 2020 2020 2020 2020  "]:.            
-00036950: 7061 7463 6820 3d20 6d70 6174 6368 6573  patch = mpatches
-00036960: 2e50 6174 6368 2865 6467 6563 6f6c 6f72  .Patch(edgecolor
-00036970: 3d65 6467 6563 6f6c 6f72 2c0a 2020 2020  =edgecolor,.    
-00036980: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00036990: 6c69 6e65 7769 6474 683d 6c69 6e65 7769  linewidth=linewi
-000369a0: 6474 682c 2066 696c 6c3d 4661 6c73 652c  dth, fill=False,
-000369b0: 206c 6162 656c 3d6e 616d 6529 0a20 2020   label=name).   
-000369c0: 2020 2020 2065 6c69 6620 706c 6f74 5f74       elif plot_t
-000369d0: 7970 6520 696e 205b 2266 696c 6c65 6422  ype in ["filled"
-000369e0: 2c20 2266 696c 6c65 6420 6365 6e74 726f  , "filled centro
-000369f0: 6964 225d 3a0a 2020 2020 2020 2020 2020  id"]:.          
-00036a00: 2020 7061 7463 6820 3d20 6d70 6174 6368    patch = mpatch
-00036a10: 6573 2e50 6174 6368 2865 6467 6563 6f6c  es.Patch(edgecol
-00036a20: 6f72 3d65 6467 6563 6f6c 6f72 2c0a 2020  or=edgecolor,.  
-00036a30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00036a40: 2020 6661 6365 636f 6c6f 723d 6661 6365    facecolor=face
-00036a50: 636f 6c6f 722c 206c 696e 6577 6964 7468  color, linewidth
-00036a60: 3d6c 696e 6577 6964 7468 2c20 6c61 6265  =linewidth, labe
-00036a70: 6c3d 6e61 6d65 290a 2020 2020 2020 2020  l=name).        
-00036a80: 656c 6966 2070 6c6f 745f 7479 7065 2069  elif plot_type i
-00036a90: 6e20 5b22 6d61 736b 225d 3a0a 2020 2020  n ["mask"]:.    
-00036aa0: 2020 2020 2020 2020 7061 7463 6820 3d20          patch = 
-00036ab0: 6d70 6174 6368 6573 2e50 6174 6368 2866  mpatches.Patch(f
-00036ac0: 6163 6563 6f6c 6f72 3d66 6163 6563 6f6c  acecolor=facecol
-00036ad0: 6f72 2c20 6c61 6265 6c3d 6e61 6d65 290a  or, label=name).
-00036ae0: 0a20 2020 2020 2020 2069 6620 7061 7463  .        if patc
-00036af0: 683a 0a20 2020 2020 2020 2020 2020 2070  h:.            p
-00036b00: 6174 6368 2e73 6574 5f61 6c70 6861 284e  atch.set_alpha(N
-00036b10: 6f6e 6529 0a0a 2020 2020 2020 2020 7265  one)..        re
-00036b20: 7475 726e 2070 6174 6368 0a0a 2020 2020  turn patch..    
-00036b30: 6465 6620 6765 745f 696e 7465 6e73 6974  def get_intensit
-00036b40: 6965 735f 3364 2873 656c 662c 2069 6d61  ies_3d(self, ima
-00036b50: 6765 3d4e 6f6e 652c 2073 7461 6e64 6172  ge=None, standar
-00036b60: 6469 7365 3d54 7275 6529 3a0a 2020 2020  dise=True):.    
-00036b70: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-00036b80: 5265 7475 726e 2063 6f70 7920 6f66 2061  Return copy of a
-00036b90: 6e20 696d 6167 6520 6172 7261 7920 7468  n image array th
-00036ba0: 6174 2068 6173 2076 616c 7565 7320 7265  at has values re
-00036bb0: 7461 696e 6564 0a20 2020 2020 2020 2069  tained.        i
-00036bc0: 6e73 6964 6520 7365 6c66 2c20 616e 6420  nside self, and 
-00036bd0: 6973 2073 6574 2074 6f20 7a65 726f 2065  is set to zero e
-00036be0: 6c73 6577 6865 7265 2e0a 0a20 2020 2020  lsewhere...     
-00036bf0: 2020 202a 2a50 6172 616d 6574 6572 3a2a     **Parameter:*
-00036c00: 2a0a 0a20 2020 2020 2020 2069 6d61 6765  *..        image
-00036c10: 203a 2073 6b72 742e 696d 6167 652e 496d   : skrt.image.Im
-00036c20: 6167 652c 2064 6566 6175 6c74 3d4e 6f6e  age, default=Non
-00036c30: 650a 2020 2020 2020 2020 2020 2020 496d  e.            Im
-00036c40: 6167 6520 6f62 6a65 6374 2066 6f72 2077  age object for w
-00036c50: 6869 6368 2033 4420 6172 7261 7920 7769  hich 3D array wi
-00036c60: 7468 2069 6e74 656e 7369 7479 2076 616c  th intensity val
-00036c70: 7565 730a 2020 2020 2020 2020 2020 2020  ues.            
-00036c80: 7265 7461 696e 6564 2069 6e73 6964 6520  retained inside 
-00036c90: 524f 492c 2061 6e64 204e 614e 2065 6c73  ROI, and NaN els
-00036ca0: 6577 6865 7265 2c20 6973 2074 6f20 6265  ewhere, is to be
-00036cb0: 206f 6274 6169 6e65 642e 0a20 2020 2020   obtained..     
-00036cc0: 2020 2020 2020 2049 6620 4e6f 6e65 2c20         If None, 
-00036cd0: 7468 6520 696d 6167 6520 6173 736f 6369  the image associ
-00036ce0: 6174 6564 2077 6974 6820 7468 6520 524f  ated with the RO
-00036cf0: 4920 6973 2075 7365 642e 0a0a 2020 2020  I is used...    
-00036d00: 2020 2020 7374 616e 6461 7264 6973 6520      standardise 
-00036d10: 3a20 626f 6f6c 2c20 6465 6661 756c 743d  : bool, default=
-00036d20: 4661 6c73 650a 2020 2020 2020 2020 2020  False.          
-00036d30: 2020 4966 2046 616c 7365 2c20 7468 6520    If False, the 
-00036d40: 6461 7461 2061 7272 6179 2077 696c 6c20  data array will 
-00036d50: 6265 2072 6574 7572 6e65 6420 696e 2074  be returned in t
-00036d60: 6865 206f 7269 656e 7461 7469 6f6e 2069  he orientation i
-00036d70: 6e20 0a20 2020 2020 2020 2020 2020 2077  n .            w
-00036d80: 6869 6368 2069 7420 7761 7320 6c6f 6164  hich it was load
-00036d90: 6564 3b20 6f74 6865 7277 6973 652c 2069  ed; otherwise, i
-00036da0: 7420 7769 6c6c 2062 6520 7265 7475 726e  t will be return
-00036db0: 6564 2069 6e20 7374 616e 6461 7264 0a20  ed in standard. 
-00036dc0: 2020 2020 2020 2020 2020 2064 6963 6f6d             dicom
-00036dd0: 2d73 7479 6c65 206f 7269 656e 7461 7469  -style orientati
-00036de0: 6f6e 2073 7563 6820 7468 6174 205b 636f  on such that [co
-00036df0: 6c75 6d6e 2c20 726f 772c 2073 6c69 6365  lumn, row, slice
-00036e00: 5d20 636f 7272 6573 706f 6e64 730a 2020  ] corresponds.  
-00036e10: 2020 2020 2020 2020 2020 746f 2074 6865            to the
-00036e20: 205b 782c 2079 2c20 7a5d 2061 7865 732e   [x, y, z] axes.
-00036e30: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-00036e40: 2020 2020 2069 6620 696d 6167 6520 6973       if image is
-00036e50: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-00036e60: 2020 2023 2043 6f6e 7369 6465 7220 696d     # Consider im
-00036e70: 6167 6520 6173 736f 6369 6174 6564 2077  age associated w
-00036e80: 6974 6820 7365 6c66 2e0a 2020 2020 2020  ith self..      
-00036e90: 2020 2020 2020 7365 6c66 2e63 7265 6174        self.creat
-00036ea0: 655f 6d61 736b 2829 0a20 2020 2020 2020  e_mask().       
-00036eb0: 2020 2020 2069 6d61 6765 203d 2073 656c       image = sel
-00036ec0: 662e 696d 6167 650a 2020 2020 2020 2020  f.image.        
-00036ed0: 2020 2020 726f 6920 3d20 7365 6c66 0a20      roi = self. 
-00036ee0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-00036ef0: 2020 2020 2020 2020 2023 2043 6c6f 6e65           # Clone
-00036f00: 2073 656c 662c 2061 6e64 2061 7373 6f63   self, and assoc
-00036f10: 6961 7465 2077 6974 6820 636c 6f6e 6520  iate with clone 
-00036f20: 7468 6520 696d 6167 6520 7370 6563 6966  the image specif
-00036f30: 6965 6420 696e 2069 6e70 7574 2e0a 2020  ied in input..  
-00036f40: 2020 2020 2020 2020 2020 726f 6920 3d20            roi = 
-00036f50: 7365 6c66 2e63 6c6f 6e65 2829 0a20 2020  self.clone().   
-00036f60: 2020 2020 2020 2020 2072 6f69 2e73 6574           roi.set
-00036f70: 5f69 6d61 6765 2869 6d61 6765 290a 0a20  _image(image).. 
-00036f80: 2020 2020 2020 2023 204f 6274 6169 6e20         # Obtain 
-00036f90: 696e 7465 6e73 6974 7920 7661 6c75 6573  intensity values
-00036fa0: 2e0a 2020 2020 2020 2020 696d 5f64 6174  ..        im_dat
-00036fb0: 6120 3d20 696d 6167 652e 6765 745f 6461  a = image.get_da
-00036fc0: 7461 2873 7461 6e64 6172 6469 7365 3d73  ta(standardise=s
-00036fd0: 7461 6e64 6172 6469 7365 290a 2020 2020  tandardise).    
-00036fe0: 2020 2020 6d61 736b 203d 2072 6f69 2e67      mask = roi.g
-00036ff0: 6574 5f6d 6173 6b28 7374 616e 6461 7264  et_mask(standard
-00037000: 6973 653d 7374 616e 6461 7264 6973 6529  ise=standardise)
-00037010: 0a20 2020 2020 2020 2069 6e74 656e 7369  .        intensi
-00037020: 7469 6573 5f69 6e5f 726f 6920 3d20 6e70  ties_in_roi = np
-00037030: 2e66 756c 6c28 696d 5f64 6174 612e 7368  .full(im_data.sh
-00037040: 6170 652c 206e 702e 6e61 6e29 0a20 2020  ape, np.nan).   
-00037050: 2020 2020 2069 6e74 656e 7369 7469 6573       intensities
-00037060: 5f69 6e5f 726f 695b 6d61 736b 203e 2030  _in_roi[mask > 0
-00037070: 5d20 3d20 696d 5f64 6174 615b 6d61 736b  ] = im_data[mask
-00037080: 203e 2030 5d0a 2020 2020 2020 2020 7265   > 0].        re
-00037090: 7475 726e 2069 6e74 656e 7369 7469 6573  turn intensities
-000370a0: 5f69 6e5f 726f 690a 0a20 2020 2064 6566  _in_roi..    def
-000370b0: 2067 6574 5f69 6e74 656e 7369 7469 6573   get_intensities
-000370c0: 2873 656c 662c 2069 6d61 6765 3d4e 6f6e  (self, image=Non
-000370d0: 652c 2073 7461 6e64 6172 6469 7365 3d54  e, standardise=T
-000370e0: 7275 6529 3a0a 2020 2020 2020 2020 2222  rue):.        ""
-000370f0: 220a 2020 2020 2020 2020 5265 7475 726e  ".        Return
-00037100: 2031 4420 6e75 6d70 7920 6172 7261 7920   1D numpy array 
-00037110: 636f 6e74 6169 6e69 6e67 2061 6c6c 206f  containing all o
-00037120: 6620 7468 6520 696e 7465 6e73 6974 7920  f the intensity 
-00037130: 7661 6c75 6573 2066 6f72 2074 6865 200a  values for the .
-00037140: 2020 2020 2020 2020 766f 7865 6c73 2069          voxels i
-00037150: 6e73 6964 6520 7365 6c66 2e0a 0a20 2020  nside self...   
-00037160: 2020 2020 202a 2a50 6172 616d 6574 6572       **Parameter
-00037170: 733a 2a2a 0a0a 2020 2020 2020 2020 696d  s:**..        im
-00037180: 6167 6520 3a20 736b 7274 2e69 6d61 6765  age : skrt.image
-00037190: 2e49 6d61 6765 2c20 6465 6661 756c 743d  .Image, default=
-000371a0: 4e6f 6e65 0a20 2020 2020 2020 2020 2020  None.           
-000371b0: 2049 6d61 6765 206f 626a 6563 7420 666f   Image object fo
-000371c0: 7220 7768 6963 6820 3144 2061 7272 6179  r which 1D array
-000371d0: 206f 6620 696e 7465 6e73 6974 7920 7661   of intensity va
-000371e0: 6c75 6573 2069 730a 2020 2020 2020 2020  lues is.        
-000371f0: 2020 2020 746f 2062 6520 6f62 7461 696e      to be obtain
-00037200: 6564 2e20 2049 6620 4e6f 6e65 2c20 7468  ed.  If None, th
-00037210: 6520 696d 6167 6520 6173 736f 6369 6174  e image associat
-00037220: 6564 2077 6974 6820 7468 650a 2020 2020  ed with the.    
-00037230: 2020 2020 2020 2020 524f 4920 6973 2075          ROI is u
-00037240: 7365 642e 0a0a 2020 2020 2020 2020 7374  sed...        st
-00037250: 616e 6461 7264 6973 6520 3a20 626f 6f6c  andardise : bool
-00037260: 2c20 6465 6661 756c 743d 4661 6c73 650a  , default=False.
-00037270: 2020 2020 2020 2020 2020 2020 4966 2046              If F
-00037280: 616c 7365 2c20 7468 6520 696d 6167 6527  alse, the image'
-00037290: 7320 6461 7461 2061 7272 6179 2077 696c  s data array wil
-000372a0: 6c20 6265 2075 7365 6420 696e 2074 6865  l be used in the
-000372b0: 206f 7269 656e 7461 7469 6f6e 0a20 2020   orientation.   
-000372c0: 2020 2020 2020 2020 2069 6e20 7768 6963           in whic
-000372d0: 6820 6974 2077 6173 206c 6f61 6465 643b  h it was loaded;
-000372e0: 206f 7468 6572 7769 7365 2c20 6974 2077   otherwise, it w
-000372f0: 696c 6c20 6265 2075 7365 6420 696e 2073  ill be used in s
-00037300: 7461 6e64 6172 640a 2020 2020 2020 2020  tandard.        
-00037310: 2020 2020 6469 636f 6d2d 7374 796c 6520      dicom-style 
-00037320: 6f72 6965 6e74 6174 696f 6e20 7375 6368  orientation such
-00037330: 2074 6861 7420 5b63 6f6c 756d 6e2c 2072   that [column, r
-00037340: 6f77 2c20 736c 6963 655d 2063 6f72 7265  ow, slice] corre
-00037350: 7370 6f6e 6473 0a20 2020 2020 2020 2020  sponds.         
-00037360: 2020 2074 6f20 7468 6520 5b78 2c20 792c     to the [x, y,
-00037370: 207a 5d20 6178 6573 2e0a 2020 2020 2020   z] axes..      
-00037380: 2020 2222 220a 2020 2020 2020 2020 696e    """.        in
-00037390: 7465 6e73 6974 6965 7320 3d20 7365 6c66  tensities = self
-000373a0: 2e67 6574 5f69 6e74 656e 7369 7469 6573  .get_intensities
-000373b0: 5f33 6428 696d 6167 652c 2073 7461 6e64  _3d(image, stand
-000373c0: 6172 6469 7365 290a 2020 2020 2020 2020  ardise).        
-000373d0: 7265 7475 726e 2069 6e74 656e 7369 7469  return intensiti
-000373e0: 6573 5b7e 6e70 2e69 736e 616e 2869 6e74  es[~np.isnan(int
-000373f0: 656e 7369 7469 6573 295d 0a20 2020 2020  ensities)].     
-00037400: 2020 200a 636c 6173 7320 5374 7275 6374     .class Struct
-00037410: 7572 6553 6574 2873 6b72 742e 636f 7265  ureSet(skrt.core
-00037420: 2e41 7263 6869 7665 293a 0a20 2020 2022  .Archive):.    "
-00037430: 2222 0a20 2020 2043 6c61 7373 2072 6570  "".    Class rep
-00037440: 7265 7365 6e74 696e 6720 6120 7261 6469  resenting a radi
-00037450: 6f74 6865 7261 7079 2073 7472 7563 7475  otherapy structu
-00037460: 7265 2073 6574 0a20 2020 2061 7320 6120  re set.    as a 
-00037470: 636f 6c6c 6563 7469 6f6e 206f 6620 7265  collection of re
-00037480: 6769 6f6e 7320 6f66 2069 6e74 6572 6573  gions of interes
-00037490: 7420 2852 4f49 7329 2e0a 0a20 2020 2041  t (ROIs)...    A
-000374a0: 7474 7269 6275 7465 7320 6f66 2061 2053  ttributes of a S
-000374b0: 7472 7563 7475 7265 5365 7420 6f62 6a65  tructureSet obje
-000374c0: 6374 2073 686f 756c 6420 7573 7561 6c6c  ct should usuall
-000374d0: 7920 6265 2061 6363 6573 7365 6420 7669  y be accessed vi
-000374e0: 610a 2020 2020 7468 6569 7220 6765 7474  a.    their gett
-000374f0: 6572 206d 6574 686f 6473 2c20 7261 7468  er methods, rath
-00037500: 6572 2074 6861 6e20 6469 7265 6374 6c79  er than directly
-00037510: 2c20 746f 2065 6e73 7572 6520 7468 6174  , to ensure that
-00037520: 0a20 2020 2061 7474 7269 6275 7465 2076  .    attribute v
-00037530: 616c 7565 7320 6861 7665 2062 6565 6e20  alues have been 
-00037540: 6c6f 6164 6564 2e0a 2020 2020 2222 220a  loaded..    """.
-00037550: 0a20 2020 2064 6566 205f 5f69 6e69 745f  .    def __init_
-00037560: 5f28 0a20 2020 2020 2020 2073 656c 662c  _(.        self,
-00037570: 0a20 2020 2020 2020 2070 6174 683d 4e6f  .        path=No
-00037580: 6e65 2c0a 2020 2020 2020 2020 6e61 6d65  ne,.        name
-00037590: 3d4e 6f6e 652c 0a20 2020 2020 2020 2069  =None,.        i
-000375a0: 6d61 6765 3d4e 6f6e 652c 0a20 2020 2020  mage=None,.     
-000375b0: 2020 206c 6f61 643d 5472 7565 2c0a 2020     load=True,.  
-000375c0: 2020 2020 2020 6e61 6d65 733d 4e6f 6e65        names=None
-000375d0: 2c0a 2020 2020 2020 2020 6b65 6570 5f72  ,.        keep_r
-000375e0: 656e 616d 6564 5f6f 6e6c 793d 4661 6c73  enamed_only=Fals
-000375f0: 652c 0a20 2020 2020 2020 2074 6f5f 6b65  e,.        to_ke
-00037600: 6570 3d4e 6f6e 652c 0a20 2020 2020 2020  ep=None,.       
-00037610: 2074 6f5f 7265 6d6f 7665 3d4e 6f6e 652c   to_remove=None,
-00037620: 0a20 2020 2020 2020 206d 756c 7469 5f6c  .        multi_l
-00037630: 6162 656c 3d46 616c 7365 2c0a 2020 2020  abel=False,.    
-00037640: 2020 2020 636f 6c6f 7273 3d4e 6f6e 652c      colors=None,
-00037650: 0a20 2020 2020 2020 2069 676e 6f72 655f  .        ignore_
-00037660: 6469 636f 6d5f 636f 6c6f 7273 3d46 616c  dicom_colors=Fal
-00037670: 7365 2c0a 2020 2020 2020 2020 6175 746f  se,.        auto
-00037680: 5f74 696d 6573 7461 6d70 3d46 616c 7365  _timestamp=False
-00037690: 2c0a 2020 2020 2020 2020 616c 7068 615f  ,.        alpha_
-000376a0: 6265 7461 5f72 6174 696f 733d 4e6f 6e65  beta_ratios=None
-000376b0: 2c0a 2020 2020 2020 2020 2a2a 6b77 6172  ,.        **kwar
-000376c0: 6773 0a20 2020 2029 3a0a 2020 2020 2020  gs.    ):.      
-000376d0: 2020 2222 224c 6f61 6420 7374 7275 6374    """Load struct
-000376e0: 7572 6520 7365 7420 6672 6f6d 2074 6865  ure set from the
-000376f0: 2073 6f75 7263 6528 7329 2067 6976 656e   source(s) given
-00037700: 2069 6e20 3c70 6174 683e 2e0a 0a20 2020   in <path>...   
-00037710: 2020 2020 202a 2a50 6172 616d 6574 6572       **Parameter
-00037720: 732a 2a3a 0a0a 2020 2020 2020 2020 7061  s**:..        pa
-00037730: 7468 203a 2073 7472 2f6c 6973 742c 2064  th : str/list, d
-00037740: 6566 6175 6c74 3d4e 6f6e 650a 2020 2020  efault=None.    
-00037750: 2020 2020 2020 2020 536f 7572 6365 2873          Source(s
-00037760: 2920 6f66 2052 4f49 7320 746f 206c 6f61  ) of ROIs to loa
-00037770: 6420 696e 746f 2074 6869 7320 7374 7275  d into this stru
-00037780: 6374 7572 6520 7365 742e 2043 616e 2062  cture set. Can b
-00037790: 653a 0a0a 2020 2020 2020 2020 2020 2020  e:..            
-000377a0: 2d20 5468 6520 7061 7468 2074 6f20 6120  - The path to a 
-000377b0: 7369 6e67 6c65 2064 6963 6f6d 2073 7472  single dicom str
-000377c0: 7563 7475 7265 2073 6574 2066 696c 653b  ucture set file;
-000377d0: 0a20 2020 2020 2020 2020 2020 202d 2054  .            - T
-000377e0: 6865 2070 6174 6820 746f 2061 2073 696e  he path to a sin
-000377f0: 676c 6520 6e69 6674 6920 6669 6c65 2063  gle nifti file c
-00037800: 6f6e 7461 696e 696e 6720 616e 2052 4f49  ontaining an ROI
-00037810: 206d 6173 6b3b 0a20 2020 2020 2020 2020   mask;.         
-00037820: 2020 202d 2041 206c 6973 7420 6f66 2070     - A list of p
-00037830: 6174 6873 2074 6f20 6e69 6674 6920 6669  aths to nifti fi
-00037840: 6c65 7320 636f 6e74 6169 6e69 6e67 2052  les containing R
-00037850: 4f49 206d 6173 6b73 3b0a 2020 2020 2020  OI masks;.      
-00037860: 2020 2020 2020 2d20 5468 6520 7061 7468        - The path
-00037870: 2074 6f20 6120 6469 7265 6374 6f72 7920   to a directory 
-00037880: 636f 6e74 6169 6e69 6e67 206d 756c 7469  containing multi
-00037890: 706c 6520 6e69 6674 6920 6669 6c65 7320  ple nifti files 
-000378a0: 0a20 2020 2020 2020 2020 2020 2063 6f6e  .            con
-000378b0: 7461 696e 696e 6720 524f 4920 6d61 736b  taining ROI mask
-000378c0: 733b 0a20 2020 2020 2020 2020 2020 202d  s;.            -
-000378d0: 2041 206c 6973 7420 6f66 2052 4f49 206f   A list of ROI o
-000378e0: 626a 6563 7473 3b0a 2020 2020 2020 2020  bjects;.        
-000378f0: 2020 2020 2d20 4120 6c69 7374 206f 6620      - A list of 
-00037900: 6f62 6a65 6374 7320 7468 6174 2063 6f75  objects that cou
-00037910: 6c64 2062 6520 7573 6564 2074 6f20 696e  ld be used to in
-00037920: 6974 6961 6c69 7365 2061 6e20 524f 4920  itialise an ROI 
-00037930: 6f62 6a65 6374 0a20 2020 2020 2020 2020  object.         
-00037940: 2020 2028 652e 672e 2061 206e 756d 7079     (e.g. a numpy
-00037950: 2061 7272 6179 292e 0a0a 2020 2020 2020   array)...      
-00037960: 2020 6e61 6d65 203a 2073 7472 2c20 6465    name : str, de
-00037970: 6661 756c 743d 4e6f 6e65 0a20 2020 2020  fault=None.     
-00037980: 2020 2020 2020 204f 7074 696f 6e61 6c20         Optional 
-00037990: 6e61 6d65 2074 6f20 6173 7369 676e 2074  name to assign t
-000379a0: 6f20 7468 6973 2073 7472 7563 7475 7265  o this structure
-000379b0: 2073 6574 2e20 4966 204e 6f6e 652c 2077   set. If None, w
-000379c0: 696c 6c20 0a20 2020 2020 2020 2020 2020  ill .           
-000379d0: 2061 7474 656d 7074 2074 6f20 696e 6665   attempt to infe
-000379e0: 7220 6672 6f6d 2069 6e70 7574 2066 696c  r from input fil
-000379f0: 656e 616d 652e 0a0a 2020 2020 2020 2020  ename...        
-00037a00: 696d 6167 6520 3a20 736b 7274 2e69 6d61  image : skrt.ima
-00037a10: 6765 2e49 6d61 6765 2c20 6465 6661 756c  ge.Image, defaul
-00037a20: 743d 4e6f 6e65 0a20 2020 2020 2020 2020  t=None.         
-00037a30: 2020 2049 6d61 6765 2061 7373 6f63 6961     Image associa
-00037a40: 7465 6420 7769 7468 2074 6869 7320 7374  ted with this st
-00037a50: 7275 6374 7572 6520 7365 742e 2049 6620  ructure set. If 
-00037a60: 7468 6520 696e 7075 7420 736f 7572 6365  the input source
-00037a70: 2069 7320 610a 2020 2020 2020 2020 2020   is a.          
-00037a80: 2020 6469 636f 6d20 6669 6c65 2063 6f6e    dicom file con
-00037a90: 7461 696e 696e 6720 524f 4920 636f 6e74  taining ROI cont
-00037aa0: 6f75 7273 2c20 7468 6973 2069 6d61 6765  ours, this image
-00037ab0: 2077 696c 6c20 6265 2075 7365 6420 7768   will be used wh
-00037ac0: 656e 0a20 2020 2020 2020 2020 2020 2063  en.            c
-00037ad0: 7265 6174 696e 6720 524f 4920 6269 6e61  reating ROI bina
-00037ae0: 7279 206d 6173 6b73 2e0a 0a20 2020 2020  ry masks...     
-00037af0: 2020 206c 6f61 6420 3a20 626f 6f6c 2c20     load : bool, 
-00037b00: 6465 6661 756c 743d 5472 7565 0a20 2020  default=True.   
-00037b10: 2020 2020 2020 2020 2049 6620 5472 7565           If True
-00037b20: 2c20 524f 4973 2077 696c 6c20 696d 6d65  , ROIs will imme
-00037b30: 6469 6174 656c 7920 6265 206c 6f61 6465  diately be loade
-00037b40: 6420 6672 6f6d 2073 6f75 7263 6573 2e20  d from sources. 
-00037b50: 4f74 6865 7277 6973 652c 0a20 2020 2020  Otherwise,.     
-00037b60: 2020 2020 2020 206c 6f61 6469 6e67 2077         loading w
-00037b70: 696c 6c20 6e6f 7420 6f63 6375 7220 756e  ill not occur un
-00037b80: 7469 6c20 5374 7275 6374 7572 6553 6574  til StructureSet
-00037b90: 2e6c 6f61 6428 2920 6973 2063 616c 6c65  .load() is calle
-00037ba0: 642e 0a20 2020 2020 2020 200a 2020 2020  d..        .    
-00037bb0: 2020 2020 6e61 6d65 7320 3a20 6469 6374      names : dict
-00037bc0: 2f6c 6973 742c 2064 6566 6175 6c74 3d4e  /list, default=N
-00037bd0: 6f6e 650a 2020 2020 2020 2020 2020 2020  one.            
-00037be0: 4f70 7469 6f6e 616c 2064 6963 7420 6f66  Optional dict of
-00037bf0: 2052 4f49 206e 616d 6573 2074 6f20 7573   ROI names to us
-00037c00: 6520 7768 656e 2072 656e 616d 696e 6720  e when renaming 
-00037c10: 6c6f 6164 6564 2052 4f49 732e 204b 6579  loaded ROIs. Key
-00037c20: 7320 0a20 2020 2020 2020 2020 2020 2073  s .            s
-00037c30: 686f 756c 6420 6265 2064 6573 6972 6564  hould be desired
-00037c40: 206e 616d 6573 2c20 616e 6420 7661 6c75   names, and valu
-00037c50: 6573 2073 686f 756c 6420 6265 206c 6973  es should be lis
-00037c60: 7473 206f 6620 706f 7373 6962 6c65 0a20  ts of possible. 
-00037c70: 2020 2020 2020 2020 2020 2069 6e70 7574             input
-00037c80: 206e 616d 6573 206f 7220 7769 6c64 6361   names or wildca
-00037c90: 7264 7320 6d61 7463 6869 6e67 2069 6e70  rds matching inp
-00037ca0: 7574 206e 616d 6573 2e0a 0a20 2020 2020  ut names...     
-00037cb0: 2020 2020 2020 2049 6620 6d75 6c74 695f         If multi_
-00037cc0: 6c61 6265 6c3d 5472 7565 2c20 6e61 6d65  label=True, name
-00037cd0: 7320 6361 6e20 616c 736f 2062 6520 6120  s can also be a 
-00037ce0: 6c69 7374 206f 6620 6e61 6d65 7320 746f  list of names to
-00037cf0: 2061 7373 6967 6e0a 2020 2020 2020 2020   assign.        
-00037d00: 2020 2020 746f 2065 6163 6820 6c61 6265      to each labe
-00037d10: 6c20 666f 756e 6420 696e 206f 7264 6572  l found in order
-00037d20: 2c20 6672 6f6d 2073 6d61 6c6c 6573 7420  , from smallest 
-00037d30: 746f 206c 6172 6765 7374 2e0a 0a20 2020  to largest...   
-00037d40: 2020 2020 2074 6f5f 6b65 6570 203a 206c       to_keep : l
-00037d50: 6973 742c 2064 6566 6175 6c74 3d4e 6f6e  ist, default=Non
-00037d60: 650a 2020 2020 2020 2020 2020 2020 4f70  e.            Op
-00037d70: 7469 6f6e 616c 206c 6973 7420 6f66 2052  tional list of R
-00037d80: 4f49 206e 616d 6573 206f 7220 7769 6c64  OI names or wild
-00037d90: 6361 7264 7320 6d61 7463 6869 6e67 2052  cards matching R
-00037da0: 4f49 206e 616d 6573 206f 6620 524f 4973  OI names of ROIs
-00037db0: 0a20 2020 2020 2020 2020 2020 2074 6f20  .            to 
-00037dc0: 6b65 6570 2069 6e20 7468 6973 2053 7472  keep in this Str
-00037dd0: 7563 7475 7265 5365 7420 6475 7269 6e67  uctureSet during
-00037de0: 206c 6f61 6469 6e67 2e20 524f 4973 206e   loading. ROIs n
-00037df0: 6f74 206d 6174 6368 696e 6720 7769 6c6c  ot matching will
-00037e00: 0a20 2020 2020 2020 2020 2020 2062 6520  .            be 
-00037e10: 6469 7363 6172 6465 642e 204e 6f74 6520  discarded. Note 
-00037e20: 7468 6174 2074 6865 206e 616d 6573 2073  that the names s
-00037e30: 686f 756c 6420 7265 666c 6563 7420 7468  hould reflect th
-00037e40: 6f73 6520 6166 7465 7220 0a20 2020 2020  ose after .     
-00037e50: 2020 2020 2020 2072 656e 616d 696e 6720         renaming 
-00037e60: 7669 6120 7468 6520 3c6e 616d 6573 3e20  via the <names> 
-00037e70: 6469 6374 2e20 4966 204e 6f6e 652c 2061  dict. If None, a
-00037e80: 6c6c 2052 4f49 7320 7769 6c6c 2062 6520  ll ROIs will be 
-00037e90: 6b65 7074 2e0a 0a20 2020 2020 2020 2074  kept...        t
-00037ea0: 6f5f 7265 6d6f 7665 203a 206c 6973 742c  o_remove : list,
-00037eb0: 2064 6566 6175 6c74 3d4e 6f6e 650a 2020   default=None.  
-00037ec0: 2020 2020 2020 2020 2020 4f70 7469 6f6e            Option
-00037ed0: 616c 206c 6973 7420 6f66 2052 4f49 206e  al list of ROI n
-00037ee0: 616d 6573 206f 7220 7769 6c64 6361 7264  ames or wildcard
-00037ef0: 7320 6d61 7463 6869 6e67 2052 4f49 206e  s matching ROI n
-00037f00: 616d 6573 206f 6620 524f 4973 0a20 2020  ames of ROIs.   
-00037f10: 2020 2020 2020 2020 2074 6f20 7265 6d6f           to remo
-00037f20: 7665 2066 726f 6d20 7468 6973 2053 7472  ve from this Str
-00037f30: 7563 7475 7265 5365 7420 6475 7269 6e67  uctureSet during
-00037f40: 206c 6f61 6469 6e67 2e20 524f 4973 206d   loading. ROIs m
-00037f50: 6174 6368 696e 6720 7769 6c6c 0a20 2020  atching will.   
-00037f60: 2020 2020 2020 2020 2062 6520 6469 7363           be disc
-00037f70: 6172 6465 642e 204e 6f74 6520 7468 6174  arded. Note that
-00037f80: 2074 6865 206e 616d 6573 2073 686f 756c   the names shoul
-00037f90: 6420 7265 666c 6563 7420 7468 6f73 6520  d reflect those 
-00037fa0: 6166 7465 7220 0a20 2020 2020 2020 2020  after .         
-00037fb0: 2020 2072 656e 616d 696e 6720 7669 6120     renaming via 
-00037fc0: 7468 6520 3c6e 616d 6573 3e20 6469 6374  the <names> dict
-00037fd0: 2c20 616e 6420 7265 6d6f 7661 6c20 6f63  , and removal oc
-00037fe0: 6375 7273 2061 6674 6572 2066 696c 7465  curs after filte
-00037ff0: 7269 6e67 0a20 2020 2020 2020 2020 2020  ring.           
-00038000: 2077 6974 6820 7468 6520 3c74 6f5f 6b65   with the <to_ke
-00038010: 6570 3e20 6c69 7374 2e20 4966 204e 6f6e  ep> list. If Non
-00038020: 652c 206e 6f20 524f 4973 2077 696c 6c20  e, no ROIs will 
-00038030: 6265 2072 656d 6f76 6564 2e0a 0a20 2020  be removed...   
-00038040: 2020 2020 206d 756c 7469 5f6c 6162 656c       multi_label
-00038050: 203a 2062 6f6f 6c2c 2064 6566 6175 6c74   : bool, default
-00038060: 3d46 616c 7365 0a20 2020 2020 2020 2020  =False.         
-00038070: 2020 2049 6620 5472 7565 2c20 7769 6c6c     If True, will
-00038080: 206c 6f6f 6b20 666f 7220 6d75 6c74 6970   look for multip
-00038090: 6c65 2052 4f49 206d 6173 6b73 2077 6974  le ROI masks wit
-000380a0: 6820 6469 6666 6572 656e 7420 6c61 6265  h different labe
-000380b0: 6c73 200a 2020 2020 2020 2020 2020 2020  ls .            
-000380c0: 696e 7369 6465 2074 6865 2061 7272 6179  inside the array
-000380d0: 2061 6e64 2063 7265 6174 6520 6120 7365   and create a se
-000380e0: 7061 7261 7465 2052 4f49 2066 726f 6d20  parate ROI from 
-000380f0: 6561 6368 2e0a 0a20 2020 2020 2020 2063  each...        c
-00038100: 6f6c 6f72 7320 3a20 6c69 7374 2f64 6963  olors : list/dic
-00038110: 740a 2020 2020 2020 2020 2020 2020 4c69  t.            Li
-00038120: 7374 206f 7220 6469 6374 206f 6620 636f  st or dict of co
-00038130: 6c6f 7273 2e20 4966 2061 2064 6963 742c  lors. If a dict,
-00038140: 2074 6865 206b 6579 7320 7368 6f75 6c64   the keys should
-00038150: 2062 6520 524f 4920 6e61 6d65 7320 6f72   be ROI names or
-00038160: 0a20 2020 2020 2020 2020 2020 2077 696c  .            wil
-00038170: 6463 6172 6473 206d 6174 6368 696e 6720  dcards matching 
-00038180: 524f 4920 6e61 6d65 732c 2061 6e64 2074  ROI names, and t
-00038190: 6865 2076 616c 7565 7320 7368 6f75 6c64  he values should
-000381a0: 2062 6520 6465 7369 7265 6420 0a20 2020   be desired .   
-000381b0: 2020 2020 2020 2020 2063 6f6c 6f72 7320           colors 
-000381c0: 666f 7220 524f 4973 206d 6174 6368 696e  for ROIs matchin
-000381d0: 6720 7468 6174 206e 616d 652e 2049 6620  g that name. If 
-000381e0: 6120 6c69 7374 2c20 7368 6f75 6c64 2063  a list, should c
-000381f0: 6f6e 7461 696e 0a20 2020 2020 2020 2020  ontain.         
-00038200: 2020 2063 6f6c 6f72 7320 7768 6963 6820     colors which 
-00038210: 7769 6c6c 2062 6520 6170 706c 6965 6420  will be applied 
-00038220: 746f 206c 6f61 6465 6420 524f 4973 2069  to loaded ROIs i
-00038230: 6e20 6f72 6465 722e 0a0a 2020 2020 2020  n order...      
-00038240: 2020 6175 746f 5f74 696d 6573 7461 6d70    auto_timestamp
-00038250: 203a 2062 6f6f 6c20 6465 6661 756c 743d   : bool default=
-00038260: 4661 6c73 650a 2020 2020 2020 2020 2020  False.          
-00038270: 2020 4966 2074 7275 6520 616e 6420 6e6f    If true and no
-00038280: 2076 616c 6964 2074 696d 6573 7461 6d70   valid timestamp
-00038290: 2069 7320 666f 756e 6420 7769 7468 696e   is found within
-000382a0: 2074 6865 2070 6174 6820 7374 7269 6e67   the path string
-000382b0: 2c0a 2020 2020 2020 2020 2020 2020 7469  ,.            ti
-000382c0: 6d65 7374 616d 7020 6765 6e65 7261 7465  mestamp generate
-000382d0: 6420 6672 6f6d 2063 7572 7265 6e74 2064  d from current d
-000382e0: 6174 6520 616e 6420 7469 6d65 2e0a 0a20  ate and time... 
-000382f0: 2020 2020 2020 2061 6c70 6861 5f62 6574         alpha_bet
-00038300: 615f 7261 7469 6f73 203a 2064 6963 742c  a_ratios : dict,
-00038310: 2064 6566 6175 6c74 3d4e 6f6e 650a 2020   default=None.  
-00038320: 2020 2020 2020 2020 2020 4469 6374 696f            Dictio
-00038330: 6e61 7279 2077 6865 7265 206b 6579 7320  nary where keys 
-00038340: 6172 6520 524f 4920 6e61 6d65 7320 616e  are ROI names an
-00038350: 6420 7661 6c75 6573 2061 7265 0a20 2020  d values are.   
-00038360: 2020 2020 2020 2020 2072 6174 696f 7320           ratios 
-00038370: 666f 7220 524f 4920 7469 7373 7565 7320  for ROI tissues 
-00038380: 6f66 2063 6f65 6666 6963 6965 6e74 732c  of coefficients,
-00038390: 2061 6c70 6861 2c20 6265 7461 2c0a 2020   alpha, beta,.  
-000383a0: 2020 2020 2020 2020 2020 696e 2074 6865            in the
-000383b0: 206c 696e 6561 722d 7175 6164 7261 7469   linear-quadrati
-000383c0: 6320 6571 7561 7469 6f6e 2e20 2054 6865  c equation.  The
-000383d0: 7365 2072 6174 696f 7320 6172 650a 2020  se ratios are.  
-000383e0: 2020 2020 2020 2020 2020 7573 6564 2069            used i
-000383f0: 6e20 6361 6c63 756c 6174 696e 6720 6269  n calculating bi
-00038400: 6f6c 6f67 6963 616c 6c79 2065 6666 6563  ologically effec
-00038410: 7469 7665 2064 6f73 652c 2042 4544 2c20  tive dose, BED, 
-00038420: 6672 6f6d 0a20 2020 2020 2020 2020 2020  from.           
-00038430: 2070 6879 7369 6361 6c20 646f 7365 2c20   physical dose, 
-00038440: 442c 2064 656c 6976 6572 6564 206f 7665  D, delivered ove
-00038450: 7220 6e20 6571 7561 6c20 6672 6163 7469  r n equal fracti
-00038460: 6f6e 733a 0a20 2020 2020 2020 2020 2020  ons:.           
-00038470: 2020 2020 2042 4544 203d 2044 202a 2028       BED = D * (
-00038480: 3120 2b20 2844 2f6e 2920 2f20 2861 6c70  1 + (D/n) / (alp
-00038490: 6861 2f62 6574 6129 292e 0a20 2020 2020  ha/beta))..     
-000384a0: 2020 2020 2020 2054 6865 2061 7474 7269         The attri
-000384b0: 6275 7465 2061 6c70 6861 5f6f 7665 725f  bute alpha_over_
-000384c0: 7661 6c75 6520 6973 2073 6574 2074 6f20  value is set to 
-000384d0: 7468 6520 6469 6374 696f 6e61 7279 2076  the dictionary v
-000384e0: 616c 7565 0a20 2020 2020 2020 2020 2020  alue.           
-000384f0: 2066 6f72 2061 6e20 524f 4920 6964 656e   for an ROI iden
-00038500: 7469 6669 6564 2062 7920 6120 6b65 792c  tified by a key,
-00038510: 206f 7220 6973 2073 6574 2074 6f20 4e6f   or is set to No
-00038520: 6e65 2066 6f72 2061 6e79 0a20 2020 2020  ne for any.     
-00038530: 2020 2020 2020 206f 7468 6572 2052 4f49         other ROI
-00038540: 732e 0a0a 2020 2020 2020 2020 602a 2a60  s...        `**`
-00038550: 6b77 6172 6773 203a 0a20 2020 2020 2020  kwargs :.       
-00038560: 2020 2020 2041 6464 6974 696f 6e61 6c20       Additional 
-00038570: 6b65 7977 6f72 6420 6172 6773 2074 6f20  keyword args to 
-00038580: 7573 6520 7768 656e 2069 6e69 7469 616c  use when initial
-00038590: 6973 696e 6720 6e65 7720 524f 4920 6f62  ising new ROI ob
-000385a0: 6a65 6374 732e 0a20 2020 2020 2020 2022  jects..        "
-000385b0: 2222 0a0a 2020 2020 2020 2020 2320 436c  ""..        # Cl
-000385c0: 6f6e 6520 6672 6f6d 2061 6e6f 7468 6572  one from another
-000385d0: 2053 7472 7563 7475 7265 5365 7420 6f62   StructureSet ob
-000385e0: 6a65 6374 0a20 2020 2020 2020 2069 6620  ject.        if 
-000385f0: 6973 7375 6263 6c61 7373 2874 7970 6528  issubclass(type(
-00038600: 7061 7468 292c 2053 7472 7563 7475 7265  path), Structure
-00038610: 5365 7429 3a0a 2020 2020 2020 2020 2020  Set):.          
-00038620: 2020 7061 7468 2e63 6c6f 6e65 5f61 7474    path.clone_att
-00038630: 7273 2873 656c 6629 0a20 2020 2020 2020  rs(self).       
-00038640: 2020 2020 2072 6574 7572 6e0a 0a20 2020       return..   
-00038650: 2020 2020 2073 656c 662e 6e61 6d65 203d       self.name =
-00038660: 206e 616d 650a 2020 2020 2020 2020 7061   name.        pa
-00038670: 7468 203d 2073 7472 2870 6174 6829 2069  th = str(path) i
-00038680: 6620 6973 696e 7374 616e 6365 2870 6174  f isinstance(pat
-00038690: 682c 2050 6174 6829 2065 6c73 6520 7061  h, Path) else pa
-000386a0: 7468 0a20 2020 2020 2020 2073 656c 662e  th.        self.
-000386b0: 736f 7572 6365 7320 3d20 7061 7468 0a20  sources = path. 
-000386c0: 2020 2020 2020 2069 6620 7365 6c66 2e73         if self.s
-000386d0: 6f75 7263 6573 2069 7320 4e6f 6e65 3a0a  ources is None:.
-000386e0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-000386f0: 2e73 6f75 7263 6573 203d 205b 5d0a 2020  .sources = [].  
-00038700: 2020 2020 2020 656c 6966 206e 6f74 2073        elif not s
-00038710: 6b72 742e 636f 7265 2e69 735f 6c69 7374  krt.core.is_list
-00038720: 2870 6174 6829 3a0a 2020 2020 2020 2020  (path):.        
-00038730: 2020 2020 7365 6c66 2e73 6f75 7263 6573      self.sources
-00038740: 203d 205b 7061 7468 5d0a 2020 2020 2020   = [path].      
-00038750: 2020 7365 6c66 2e72 6f69 7320 3d20 5b5d    self.rois = []
-00038760: 0a20 2020 2020 2020 2073 656c 662e 7365  .        self.se
-00038770: 745f 696d 6167 6528 696d 6167 6529 0a20  t_image(image). 
-00038780: 2020 2020 2020 2073 656c 662e 746f 5f6b         self.to_k
-00038790: 6565 7020 3d20 746f 5f6b 6565 700a 2020  eep = to_keep.  
-000387a0: 2020 2020 2020 7365 6c66 2e74 6f5f 7265        self.to_re
-000387b0: 6d6f 7665 203d 2074 6f5f 7265 6d6f 7665  move = to_remove
-000387c0: 0a20 2020 2020 2020 2073 656c 662e 6e61  .        self.na
-000387d0: 6d65 7320 3d20 6e61 6d65 730a 2020 2020  mes = names.    
-000387e0: 2020 2020 7365 6c66 2e6b 6565 705f 7265      self.keep_re
-000387f0: 6e61 6d65 645f 6f6e 6c79 203d 206b 6565  named_only = kee
-00038800: 705f 7265 6e61 6d65 645f 6f6e 6c79 0a20  p_renamed_only. 
-00038810: 2020 2020 2020 2073 656c 662e 6d75 6c74         self.mult
-00038820: 695f 6c61 6265 6c20 3d20 6d75 6c74 695f  i_label = multi_
-00038830: 6c61 6265 6c0a 2020 2020 2020 2020 7365  label.        se
-00038840: 6c66 2e63 6f6c 6f72 7320 3d20 636f 6c6f  lf.colors = colo
-00038850: 7273 0a20 2020 2020 2020 2073 656c 662e  rs.        self.
-00038860: 6967 6e6f 7265 5f64 6963 6f6d 5f63 6f6c  ignore_dicom_col
-00038870: 6f72 7320 3d20 6967 6e6f 7265 5f64 6963  ors = ignore_dic
-00038880: 6f6d 5f63 6f6c 6f72 730a 2020 2020 2020  om_colors.      
-00038890: 2020 7365 6c66 2e64 6963 6f6d 5f64 6174    self.dicom_dat
-000388a0: 6173 6574 203d 204e 6f6e 650a 2020 2020  aset = None.    
-000388b0: 2020 2020 7365 6c66 2e61 6c70 6861 5f62      self.alpha_b
-000388c0: 6574 615f 7261 7469 6f73 203d 2061 6c70  eta_ratios = alp
-000388d0: 6861 5f62 6574 615f 7261 7469 6f73 206f  ha_beta_ratios o
-000388e0: 7220 7b7d 0a20 2020 2020 2020 2073 656c  r {}.        sel
-000388f0: 662e 726f 695f 6b77 6172 6773 203d 206b  f.roi_kwargs = k
-00038900: 7761 7267 730a 2020 2020 2020 2020 7365  wargs.        se
-00038910: 6c66 2e70 6c61 6e73 203d 205b 5d0a 2020  lf.plans = [].  
-00038920: 2020 2020 2020 7061 7468 203d 2070 6174        path = pat
-00038930: 6820 6966 2069 7369 6e73 7461 6e63 6528  h if isinstance(
-00038940: 7061 7468 2c20 7374 7229 2065 6c73 6520  path, str) else 
-00038950: 2222 0a20 2020 2020 2020 2073 6b72 742e  "".        skrt.
-00038960: 636f 7265 2e41 7263 6869 7665 2e5f 5f69  core.Archive.__i
-00038970: 6e69 745f 5f28 7365 6c66 2c20 7061 7468  nit__(self, path
-00038980: 2c20 6175 746f 5f74 696d 6573 7461 6d70  , auto_timestamp
-00038990: 290a 2020 2020 2020 2020 6966 2073 656c  ).        if sel
-000389a0: 662e 7061 7468 2061 6e64 206e 6f74 2073  f.path and not s
-000389b0: 656c 662e 6e61 6d65 3a0a 2020 2020 2020  elf.name:.      
-000389c0: 2020 2020 2020 6e61 6d65 203d 2050 6174        name = Pat
-000389d0: 6828 7365 6c66 2e70 6174 6829 2e6e 616d  h(self.path).nam
-000389e0: 652e 7370 6c69 7428 275f 2729 5b30 5d2e  e.split('_')[0].
-000389f0: 6c6f 7765 7228 290a 2020 2020 2020 2020  lower().        
-00038a00: 2020 2020 6966 206e 616d 655b 305d 2e69      if name[0].i
-00038a10: 7361 6c70 6861 2829 3a0a 2020 2020 2020  salpha():.      
-00038a20: 2020 2020 2020 2020 2020 7365 6c66 2e6e            self.n
-00038a30: 616d 6520 3d20 6e61 6d65 0a20 2020 2020  ame = name.     
-00038a40: 2020 2073 656c 662e 7375 6d6d 6564 5f6e     self.summed_n
-00038a50: 616d 6573 203d 205b 5d0a 0a20 2020 2020  ames = []..     
-00038a60: 2020 2073 656c 662e 6c6f 6164 6564 203d     self.loaded =
-00038a70: 2046 616c 7365 0a20 2020 2020 2020 2069   False.        i
-00038a80: 6620 6c6f 6164 3a0a 2020 2020 2020 2020  f load:.        
-00038a90: 2020 2020 7365 6c66 2e6c 6f61 6428 290a      self.load().
-00038aa0: 0a20 2020 2064 6566 205f 5f67 6574 6974  .    def __getit
-00038ab0: 656d 5f5f 2873 656c 662c 2072 6f69 293a  em__(self, roi):
-00038ac0: 0a20 2020 2020 2020 2069 6620 6973 696e  .        if isin
-00038ad0: 7374 616e 6365 2872 6f69 2c20 696e 7429  stance(roi, int)
-00038ae0: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
-00038af0: 7475 726e 2073 656c 662e 6765 745f 726f  turn self.get_ro
-00038b00: 6973 2829 5b72 6f69 5d20 0a20 2020 2020  is()[roi] .     
-00038b10: 2020 2065 6c69 6620 6973 696e 7374 616e     elif isinstan
-00038b20: 6365 2872 6f69 2c20 7374 7229 3a0a 2020  ce(roi, str):.  
-00038b30: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00038b40: 2073 656c 662e 6765 745f 726f 695f 6469   self.get_roi_di
-00038b50: 6374 2829 5b72 6f69 5d0a 0a20 2020 2064  ct()[roi]..    d
-00038b60: 6566 205f 5f69 7465 725f 5f28 7365 6c66  ef __iter__(self
-00038b70: 293a 0a20 2020 2020 2020 2072 6574 7572  ):.        retur
-00038b80: 6e20 5374 7275 6374 7572 6553 6574 4974  n StructureSetIt
-00038b90: 6572 6174 6f72 2873 656c 6629 0a0a 2020  erator(self)..  
-00038ba0: 2020 6465 6620 5f5f 6164 645f 5f28 7365    def __add__(se
-00038bb0: 6c66 2c20 6f74 6865 7229 3a0a 2020 2020  lf, other):.    
-00038bc0: 2020 2020 2727 270a 2020 2020 2020 2020      '''.        
-00038bd0: 4465 6669 6e65 2061 6464 6974 696f 6e20  Define addition 
-00038be0: 6f66 2053 7472 7563 7475 7265 5365 7420  of StructureSet 
-00038bf0: 696e 7374 616e 6365 732e 0a0a 2020 2020  instances...    
-00038c00: 2020 2020 5468 6520 7265 7375 6c74 206f      The result o
-00038c10: 6620 7468 6520 6164 6469 7469 6f6e 206f  f the addition o
-00038c20: 6620 7365 6c66 2061 6e64 206f 7468 6572  f self and other
-00038c30: 2069 7320 6120 5374 7275 6374 7572 6553   is a StructureS
-00038c40: 6574 0a20 2020 2020 2020 206f 626a 6563  et.        objec
-00038c50: 7420 7468 6174 2063 6f6e 7461 696e 7320  t that contains 
-00038c60: 7468 6520 2863 6c6f 6e65 6429 2052 4f49  the (cloned) ROI
-00038c70: 7320 6f66 2062 6f74 682e 2020 4120 7265  s of both.  A re
-00038c80: 7375 6c74 2052 4f49 0a20 2020 2020 2020  sult ROI.       
-00038c90: 2077 696c 6c20 6265 2070 7265 6669 7865   will be prefixe
-00038ca0: 6420 6279 2074 6865 206e 616d 6520 6f66  d by the name of
-00038cb0: 2074 6865 2053 7472 7563 7475 7265 5365   the StructureSe
-00038cc0: 7420 6672 6f6d 2077 6869 6368 2069 740a  t from which it.
-00038cd0: 2020 2020 2020 2020 6f72 6967 696e 6174          originat
-00038ce0: 6573 2e20 2049 6620 7468 6520 524f 4920  es.  If the ROI 
-00038cf0: 6e61 6d65 2062 6566 6f72 6520 7468 6520  name before the 
-00038d00: 6164 6469 7469 6f6e 2068 6173 2074 6865  addition has the
-00038d10: 2053 7472 7563 7475 7265 5365 740a 2020   StructureSet.  
-00038d20: 2020 2020 2020 6e61 6d65 2061 7320 7072        name as pr
-00038d30: 6566 6978 2c20 6e6f 206e 6577 2070 7265  efix, no new pre
-00038d40: 6669 7820 6973 2061 6464 6564 2e20 2054  fix is added.  T
-00038d50: 6865 7265 2069 7320 6e6f 2072 6571 7569  here is no requi
-00038d60: 7265 6d65 6e74 0a20 2020 2020 2020 2074  rement.        t
-00038d70: 6861 7420 524f 4973 206f 7220 7468 6569  hat ROIs or thei
-00038d80: 7220 6e61 6d65 7320 6265 2075 6e69 7175  r names be uniqu
-00038d90: 6520 7769 7468 696e 2061 2053 7472 7563  e within a Struc
-00038da0: 7475 7265 5365 742e 2020 4164 6469 6e67  tureSet.  Adding
-00038db0: 0a20 2020 2020 2020 2061 2053 7472 7563  .        a Struc
-00038dc0: 7475 7265 5365 7420 746f 2069 7473 656c  tureSet to itsel
-00038dd0: 6620 7769 6c6c 2067 6976 6520 6120 7265  f will give a re
-00038de0: 7375 6c74 2069 6e63 6c75 6469 6e67 2064  sult including d
-00038df0: 7570 6c69 6361 7465 0a20 2020 2020 2020  uplicate.       
-00038e00: 2052 4f49 7320 7769 7468 2064 7570 6c69   ROIs with dupli
-00038e10: 6361 7465 206e 616d 6573 2e0a 2020 2020  cate names..    
-00038e20: 2020 2020 2727 270a 2020 2020 2020 2020      '''.        
-00038e30: 2320 456e 7375 7265 2074 6861 7420 5374  # Ensure that St
-00038e40: 7275 6374 7572 6553 6574 2064 6174 6120  ructureSet data 
-00038e50: 6172 6520 6c6f 6164 6564 2e0a 2020 2020  are loaded..    
-00038e60: 2020 2020 7365 6c66 2e6c 6f61 6428 290a      self.load().
-00038e70: 2020 2020 2020 2020 6f74 6865 722e 6c6f          other.lo
-00038e80: 6164 2829 0a0a 2020 2020 2020 2020 2320  ad()..        # 
-00038e90: 4372 6561 7465 206e 6577 2053 7472 7563  Create new Struc
-00038ea0: 7475 7265 5365 7420 696e 7374 616e 6365  tureSet instance
-00038eb0: 2066 6f72 2073 756d 2c0a 2020 2020 2020   for sum,.      
-00038ec0: 2020 2320 616e 6420 7374 6f72 6520 6e61    # and store na
-00038ed0: 6d65 7320 6f66 2063 6f6e 7472 6962 7574  mes of contribut
-00038ee0: 6f72 732e 0a20 2020 2020 2020 2072 6573  ors..        res
-00038ef0: 756c 7420 3d20 5374 7275 6374 7572 6553  ult = StructureS
-00038f00: 6574 2829 0a20 2020 2020 2020 2072 6573  et().        res
-00038f10: 756c 742e 7375 6d6d 6564 5f6e 616d 6573  ult.summed_names
-00038f20: 203d 205b 5d0a 2020 2020 2020 2020 666f   = [].        fo
-00038f30: 7220 6e61 6d65 7320 696e 205b 7365 6c66  r names in [self
-00038f40: 2e73 756d 6d65 645f 6e61 6d65 732c 206f  .summed_names, o
-00038f50: 7468 6572 2e73 756d 6d65 645f 6e61 6d65  ther.summed_name
-00038f60: 732c 0a20 2020 2020 2020 2020 2020 2020  s,.             
-00038f70: 2020 205b 7365 6c66 2e6e 616d 655d 2c20     [self.name], 
-00038f80: 5b6f 7468 6572 2e6e 616d 655d 5d3a 0a20  [other.name]]:. 
-00038f90: 2020 2020 2020 2020 2020 2066 6f72 206e             for n
-00038fa0: 616d 6520 696e 206e 616d 6573 3a0a 2020  ame in names:.  
-00038fb0: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00038fc0: 2069 7369 6e73 7461 6e63 6528 6e61 6d65   isinstance(name
-00038fd0: 2c20 7374 7229 3a0a 2020 2020 2020 2020  , str):.        
-00038fe0: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-00038ff0: 7375 625f 6e61 6d65 2069 6e20 6e61 6d65  sub_name in name
-00039000: 2e73 706c 6974 2822 5f22 293a 0a20 2020  .split("_"):.   
-00039010: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00039020: 2020 2020 2069 6620 7375 625f 6e61 6d65       if sub_name
-00039030: 206e 6f74 2069 6e20 7265 7375 6c74 2e73   not in result.s
-00039040: 756d 6d65 645f 6e61 6d65 733a 0a20 2020  ummed_names:.   
-00039050: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00039060: 2020 2020 2020 2020 2072 6573 756c 742e           result.
-00039070: 7375 6d6d 6564 5f6e 616d 6573 2e61 7070  summed_names.app
-00039080: 656e 6428 7375 625f 6e61 6d65 290a 2020  end(sub_name).  
-00039090: 2020 2020 2020 7265 7375 6c74 2e73 756d        result.sum
-000390a0: 6d65 645f 6e61 6d65 732e 736f 7274 2829  med_names.sort()
-000390b0: 0a0a 2020 2020 2020 2020 2320 4c6f 6f70  ..        # Loop
-000390c0: 206f 7665 7220 5374 7275 6374 7572 6553   over StructureS
-000390d0: 6574 7320 616e 6420 7468 6569 7220 524f  ets and their RO
-000390e0: 4973 2e0a 2020 2020 2020 2020 666f 7220  Is..        for 
-000390f0: 7373 2069 6e20 5b73 656c 662c 206f 7468  ss in [self, oth
-00039100: 6572 5d3a 0a20 2020 2020 2020 2020 2020  er]:.           
-00039110: 2066 6f72 2072 6f69 2069 6e20 7373 2e67   for roi in ss.g
-00039120: 6574 5f72 6f69 7328 293a 0a20 2020 2020  et_rois():.     
-00039130: 2020 2020 2020 2020 2020 2072 6f69 5f63             roi_c
-00039140: 6c6f 6e65 203d 2072 6f69 2e63 6c6f 6e65  lone = roi.clone
-00039150: 2829 0a20 2020 2020 2020 2020 2020 2020  ().             
-00039160: 2020 2023 2054 7279 2074 6f20 7072 6566     # Try to pref
-00039170: 6978 2052 4f49 206e 616d 6520 7769 7468  ix ROI name with
-00039180: 2074 6865 206e 616d 6520 6f66 2074 6865   the name of the
-00039190: 2053 7472 7563 7475 7265 5365 740a 2020   StructureSet.  
-000391a0: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-000391b0: 6672 6f6d 2077 6869 6368 2069 7420 6f72  from which it or
-000391c0: 6967 696e 6174 6573 2e0a 2020 2020 2020  iginates..      
-000391d0: 2020 2020 2020 2020 2020 6966 2028 726f            if (ro
-000391e0: 692e 6e61 6d65 2e73 706c 6974 2822 5f22  i.name.split("_"
-000391f0: 295b 305d 2069 6e20 7265 7375 6c74 2e73  )[0] in result.s
-00039200: 756d 6d65 645f 6e61 6d65 730a 2020 2020  ummed_names.    
-00039210: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00039220: 2020 2020 6f72 2073 732e 6e61 6d65 2069      or ss.name i
-00039230: 7320 4e6f 6e65 293a 0a20 2020 2020 2020  s None):.       
-00039240: 2020 2020 2020 2020 2020 2020 2072 6f69               roi
-00039250: 5f63 6c6f 6e65 2e6e 616d 6520 3d20 726f  _clone.name = ro
-00039260: 692e 6e61 6d65 0a20 2020 2020 2020 2020  i.name.         
-00039270: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-00039280: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00039290: 2072 6f69 5f63 6c6f 6e65 2e6e 616d 6520   roi_clone.name 
-000392a0: 3d20 225f 222e 6a6f 696e 285b 7373 2e6e  = "_".join([ss.n
-000392b0: 616d 652c 2072 6f69 2e6e 616d 655d 290a  ame, roi.name]).
-000392c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000392d0: 2320 4164 6420 524f 4920 746f 2074 6865  # Add ROI to the
-000392e0: 2072 6573 756c 742e 0a20 2020 2020 2020   result..       
-000392f0: 2020 2020 2020 2020 2072 6573 756c 742e           result.
-00039300: 6164 645f 726f 6928 726f 695f 636c 6f6e  add_roi(roi_clon
-00039310: 6529 0a0a 2020 2020 2020 2020 2320 4173  e)..        # As
-00039320: 2072 6573 756c 7420 696d 6167 6520 7365   result image se
-00039330: 7420 7468 6520 696d 6167 6520 6f66 2073  t the image of s
-00039340: 656c 6620 6966 206e 6f6e 2d6e 756c 6c2c  elf if non-null,
-00039350: 0a20 2020 2020 2020 2023 206f 7220 6f74  .        # or ot
-00039360: 6877 6973 6520 7468 6520 696d 6167 6520  hwise the image 
-00039370: 6f66 206f 7468 6572 2e0a 2020 2020 2020  of other..      
-00039380: 2020 696d 6167 6520 3d20 7365 6c66 2e69    image = self.i
-00039390: 6d61 6765 2069 6620 7365 6c66 2e69 6d61  mage if self.ima
-000393a0: 6765 2065 6c73 6520 6f74 6865 722e 696d  ge else other.im
-000393b0: 6167 650a 2020 2020 2020 2020 7265 7375  age.        resu
-000393c0: 6c74 2e73 6574 5f69 6d61 6765 2869 6d61  lt.set_image(ima
-000393d0: 6765 290a 0a20 2020 2020 2020 2023 2053  ge)..        # S
-000393e0: 6574 2074 6865 2072 6573 756c 7420 6e61  et the result na
-000393f0: 6d65 2074 6f20 6265 2074 6865 2063 6f6e  me to be the con
-00039400: 6361 7465 6e61 7469 6f6e 206f 6620 7468  catenation of th
-00039410: 6520 6e61 6d65 730a 2020 2020 2020 2020  e names.        
-00039420: 2320 6f66 2074 6865 2063 6f6e 7472 6962  # of the contrib
-00039430: 7574 6f72 732e 0a20 2020 2020 2020 2069  utors..        i
-00039440: 6620 7265 7375 6c74 2e73 756d 6d65 645f  f result.summed_
-00039450: 6e61 6d65 733a 0a20 2020 2020 2020 2020  names:.         
-00039460: 2020 2072 6573 756c 742e 6e61 6d65 203d     result.name =
-00039470: 2022 5f22 2e6a 6f69 6e28 7265 7375 6c74   "_".join(result
-00039480: 2e73 756d 6d65 645f 6e61 6d65 7329 0a0a  .summed_names)..
-00039490: 2020 2020 2020 2020 7265 7475 726e 2072          return r
-000394a0: 6573 756c 740a 0a20 2020 2064 6566 205f  esult..    def _
-000394b0: 5f69 6164 645f 5f28 7365 6c66 2c20 6f74  _iadd__(self, ot
-000394c0: 6865 7229 3a0a 2020 2020 2020 2020 2727  her):.        ''
-000394d0: 270a 2020 2020 2020 2020 4465 6669 6e65  '.        Define
-000394e0: 2069 6e2d 706c 6163 6520 6f66 2053 7472   in-place of Str
-000394f0: 7563 7475 7265 5365 7420 696e 7374 616e  uctureSet instan
-00039500: 6365 732e 0a0a 2020 2020 2020 2020 5468  ces...        Th
-00039510: 6520 7265 7375 6c74 206f 6620 7468 6520  e result of the 
-00039520: 6164 6469 7469 6f6e 206f 6620 7365 6c66  addition of self
-00039530: 2061 6e64 206f 7468 6572 2069 7320 6120   and other is a 
+0002a180: 2020 756e 6974 733d 6365 6e74 726f 6964    units=centroid
+0002a190: 5f75 6e69 7473 2c0a 2020 2020 2020 2020  _units,.        
+0002a1a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a1b0: 2020 2020 6d65 7468 6f64 3d6d 6574 686f      method=metho
+0002a1c0: 642c 0a20 2020 2020 2020 2020 2020 2020  d,.             
+0002a1d0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+0002a1e0: 6f72 6365 3d66 6f72 6365 0a20 2020 2020  orce=force.     
+0002a1f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a200: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
+0002a210: 2020 2020 2020 2020 2020 2020 2066 6f75               fou
+0002a220: 6e64 203d 2054 7275 650a 0a20 2020 2020  nd = True..     
+0002a230: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
+0002a240: 7420 666f 756e 643a 0a20 2020 2020 2020  t found:.       
+0002a250: 2020 2020 2020 2020 2020 2020 2072 6169               rai
+0002a260: 7365 2052 756e 7469 6d65 4572 726f 7228  se RuntimeError(
+0002a270: 6622 4d65 7472 6963 207b 6d7d 206e 6f74  f"Metric {m} not
+0002a280: 2072 6563 6f67 6e69 7365 6420 6279 2022   recognised by "
+0002a290: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002a2a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a2b0: 2020 2020 2020 2020 2252 4f49 2e67 6574          "ROI.get
+0002a2c0: 5f63 6f6d 7061 7269 736f 6e28 2922 290a  _comparison()").
+0002a2d0: 0a20 2020 2020 2020 2023 2041 6464 2075  .        # Add u
+0002a2e0: 6e69 7473 2074 6f20 6d65 7472 6963 206e  nits to metric n
+0002a2f0: 616d 6573 2069 6620 7265 7175 6573 7465  ames if requeste
+0002a300: 640a 2020 2020 2020 2020 636f 6d70 5f6e  d.        comp_n
+0002a310: 616d 6564 203d 207b 7d0a 2020 2020 2020  amed = {}.      
+0002a320: 2020 6966 206e 6f74 2075 6e69 7473 5f69    if not units_i
+0002a330: 6e5f 6865 6164 6572 3a0a 2020 2020 2020  n_header:.      
+0002a340: 2020 2020 2020 636f 6d70 5f6e 616d 6564        comp_named
+0002a350: 203d 2063 6f6d 700a 2020 2020 2020 2020   = comp.        
+0002a360: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+0002a370: 2020 666f 7220 6d65 7472 6963 2c20 7661    for metric, va
+0002a380: 6c20 696e 2063 6f6d 702e 6974 656d 7328  l in comp.items(
+0002a390: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+0002a3a0: 2020 206e 616d 6520 3d20 6d65 7472 6963     name = metric
+0002a3b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002a3c0: 2069 6620 6d65 7472 6963 203d 3d20 2276   if metric == "v
+0002a3d0: 6f6c 756d 655f 6469 6666 223a 0a20 2020  olume_diff":.   
+0002a3e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a3f0: 2069 6620 766f 6c5f 756e 6974 7320 3d3d   if vol_units ==
+0002a400: 2022 6d6d 223a 0a20 2020 2020 2020 2020   "mm":.         
+0002a410: 2020 2020 2020 2020 2020 2020 2020 206e                 n
+0002a420: 616d 6520 2b3d 2022 2028 6d6d 5e33 2922  ame += " (mm^3)"
+0002a430: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002a440: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+0002a450: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a460: 2020 206e 616d 6520 2b3d 2022 2028 2220     name += " (" 
+0002a470: 2b20 766f 6c5f 756e 6974 7320 2b20 2229  + vol_units + ")
+0002a480: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+0002a490: 2020 656c 6966 206d 6574 7269 6320 3d3d    elif metric ==
+0002a4a0: 2022 6172 6561 5f64 6966 6622 3a0a 2020   "area_diff":.  
+0002a4b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a4c0: 2020 6966 2061 7265 615f 756e 6974 7320    if area_units 
+0002a4d0: 3d3d 2022 6d6d 223a 0a20 2020 2020 2020  == "mm":.       
+0002a4e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a4f0: 206e 616d 6520 2b3d 2022 2028 6d6d 5e32   name += " (mm^2
+0002a500: 2922 0a20 2020 2020 2020 2020 2020 2020  )".             
+0002a510: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+0002a520: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a530: 2020 2020 206e 616d 6520 2b3d 2022 2028       name += " (
+0002a540: 2220 2b20 6172 6561 5f75 6e69 7473 202b  " + area_units +
+0002a550: 2022 2922 0a20 2020 2020 2020 2020 2020   ")".           
+0002a560: 2020 2020 2065 6c69 6620 2263 656e 7472       elif "centr
+0002a570: 6f69 6422 2069 6e20 6d65 7472 6963 3a0a  oid" in metric:.
+0002a580: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a590: 2020 2020 6e61 6d65 202b 3d20 2220 2822      name += " ("
+0002a5a0: 202b 2063 656e 7472 6f69 645f 756e 6974   + centroid_unit
+0002a5b0: 7320 2b20 2229 220a 2020 2020 2020 2020  s + ")".        
+0002a5c0: 2020 2020 2020 2020 636f 6d70 5f6e 616d          comp_nam
+0002a5d0: 6564 5b6e 616d 655d 203d 2076 616c 0a0a  ed[name] = val..
+0002a5e0: 2020 2020 2020 2020 2320 4164 6a75 7374          # Adjust
+0002a5f0: 206e 756d 6265 7220 6f66 2064 6563 696d   number of decim
+0002a600: 616c 2070 6c61 6365 730a 2020 2020 2020  al places.      
+0002a610: 2020 6966 2064 6563 696d 616c 5f70 6c61    if decimal_pla
+0002a620: 6365 7320 6973 206e 6f74 204e 6f6e 653a  ces is not None:
+0002a630: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
+0002a640: 206d 6574 7269 632c 2076 616c 2069 6e20   metric, val in 
+0002a650: 636f 6d70 5f6e 616d 6564 2e69 7465 6d73  comp_named.items
+0002a660: 2829 3a0a 2020 2020 2020 2020 2020 2020  ():.            
+0002a670: 2020 2020 666d 7420 3d20 6622 7b7b 7661      fmt = f"{{va
+0002a680: 6c3a 2e7b 6465 6369 6d61 6c5f 706c 6163  l:.{decimal_plac
+0002a690: 6573 7d66 7d7d 220a 2020 2020 2020 2020  es}f}}".        
+0002a6a0: 2020 2020 2020 2020 6966 2063 6f6d 705f          if comp_
+0002a6b0: 6e61 6d65 645b 6d65 7472 6963 5d20 6973  named[metric] is
+0002a6c0: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
+0002a6d0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+0002a6e0: 6f6d 705f 6e61 6d65 645b 6d65 7472 6963  omp_named[metric
+0002a6f0: 5d20 3d20 666c 6f61 7428 666d 742e 666f  ] = float(fmt.fo
+0002a700: 726d 6174 2876 616c 3d76 616c 2929 0a0a  rmat(val=val))..
+0002a710: 2020 2020 2020 2020 2320 436f 6e76 6572          # Conver
+0002a720: 7420 746f 2070 616e 6461 7320 4461 7461  t to pandas Data
+0002a730: 4672 616d 650a 2020 2020 2020 2020 6466  Frame.        df
+0002a740: 203d 2070 642e 4461 7461 4672 616d 6528   = pd.DataFrame(
+0002a750: 636f 6d70 5f6e 616d 6564 2c20 696e 6465  comp_named, inde
+0002a760: 783d 5b72 6f69 302e 6e61 6d65 5d29 0a0a  x=[roi0.name])..
+0002a770: 2020 2020 2020 2020 2320 4361 7069 7461          # Capita
+0002a780: 6c69 7a65 2063 6f6c 756d 6e20 6e61 6d65  lize column name
+0002a790: 7320 616e 6420 7265 6d6f 7665 2075 6e64  s and remove und
+0002a7a0: 6572 7363 6f72 6573 2069 6620 7265 7175  erscores if requ
+0002a7b0: 6573 7465 640a 2020 2020 2020 2020 6966  ested.        if
+0002a7c0: 206e 6963 655f 636f 6c75 6d6e 7320 616e   nice_columns an
+0002a7d0: 6420 6e6f 7420 676c 6f62 616c 5f76 735f  d not global_vs_
+0002a7e0: 736c 6963 655f 6865 6164 6572 3a0a 2020  slice_header:.  
+0002a7f0: 2020 2020 2020 2020 2020 6466 2e63 6f6c            df.col
+0002a800: 756d 6e73 203d 205b 636f 6c2e 6361 7069  umns = [col.capi
+0002a810: 7461 6c69 7a65 2829 2e72 6570 6c61 6365  talize().replace
+0002a820: 2822 5f22 2c20 2220 2229 2e72 6570 6c61  ("_", " ").repla
+0002a830: 6365 2822 726d 7322 2c20 2252 4d53 2229  ce("rms", "RMS")
+0002a840: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002a850: 2020 2020 2020 2020 2020 2066 6f72 2063             for c
+0002a860: 6f6c 2069 6e20 6466 2e63 6f6c 756d 6e73  ol in df.columns
+0002a870: 5d0a 0a20 2020 2020 2020 2023 2054 7572  ]..        # Tur
+0002a880: 6e20 6e61 6d65 2069 6e74 6f20 6120 7265  n name into a re
+0002a890: 6775 6c61 7220 636f 6c75 6d6e 2069 6620  gular column if 
+0002a8a0: 7265 7175 6573 7465 640a 2020 2020 2020  requested.      
+0002a8b0: 2020 6966 206e 6f74 206e 616d 655f 6173    if not name_as
+0002a8c0: 5f69 6e64 6578 3a0a 2020 2020 2020 2020  _index:.        
+0002a8d0: 2020 2020 6466 203d 2064 662e 7265 7365      df = df.rese
+0002a8e0: 745f 696e 6465 7828 292e 7265 6e61 6d65  t_index().rename
+0002a8f0: 287b 2269 6e64 6578 223a 2022 524f 4922  ({"index": "ROI"
+0002a900: 7d2c 2061 7869 733d 3129 0a0a 2020 2020  }, axis=1)..    
+0002a910: 2020 2020 2320 4164 6420 676c 6f62 616c      # Add global
+0002a920: 2f73 6c69 6365 2068 6561 6465 7273 0a20  /slice headers. 
+0002a930: 2020 2020 2020 2069 6620 676c 6f62 616c         if global
+0002a940: 5f76 735f 736c 6963 655f 6865 6164 6572  _vs_slice_header
+0002a950: 3a0a 0a20 2020 2020 2020 2020 2020 2023  :..            #
+0002a960: 2053 6f72 7420 636f 6c75 6d6e 7320 696e   Sort columns in
+0002a970: 746f 2067 6c6f 6261 6c20 6f72 2073 6c69  to global or sli
+0002a980: 6365 0a20 2020 2020 2020 2020 2020 2068  ce.            h
+0002a990: 6561 6465 7273 203d 205b 5d0a 2020 2020  eaders = [].    
+0002a9a0: 2020 2020 2020 2020 736c 6963 655f 636f          slice_co
+0002a9b0: 6c73 203d 205b 5d0a 2020 2020 2020 2020  ls = [].        
+0002a9c0: 2020 2020 676c 6f62 616c 5f63 6f6c 7320      global_cols 
+0002a9d0: 3d20 5b5d 0a20 2020 2020 2020 2020 2020  = [].           
+0002a9e0: 2073 6c69 6365 5f6e 616d 6520 3d20 2273   slice_name = "s
+0002a9f0: 6c69 6365 2220 6966 206e 6f74 206e 6963  lice" if not nic
+0002aa00: 655f 636f 6c75 6d6e 7320 656c 7365 2022  e_columns else "
+0002aa10: 536c 6963 6522 0a20 2020 2020 2020 2020  Slice".         
+0002aa20: 2020 2067 6c6f 6261 6c5f 6e61 6d65 203d     global_name =
+0002aa30: 2022 676c 6f62 616c 2220 6966 206e 6f74   "global" if not
+0002aa40: 206e 6963 655f 636f 6c75 6d6e 7320 656c   nice_columns el
+0002aa50: 7365 2022 476c 6f62 616c 220a 2020 2020  se "Global".    
+0002aa60: 2020 2020 2020 2020 666f 7220 6d65 7472          for metr
+0002aa70: 6963 2069 6e20 636f 6d70 5f6e 616d 6564  ic in comp_named
+0002aa80: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0002aa90: 2020 6966 2022 736c 6963 6522 2069 6e20    if "slice" in 
+0002aaa0: 6d65 7472 6963 206f 7220 5c0a 2020 2020  metric or \.    
+0002aab0: 2020 2020 2020 2020 2020 2020 2020 2028                 (
+0002aac0: 2261 7265 6122 2069 6e20 6d65 7472 6963  "area" in metric
+0002aad0: 2061 6e64 2022 666c 6174 2220 6e6f 7420   and "flat" not 
+0002aae0: 696e 206d 6574 7269 6329 3a0a 2020 2020  in metric):.    
+0002aaf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002ab00: 6865 6164 6572 732e 6170 7065 6e64 2828  headers.append((
+0002ab10: 736c 6963 655f 6e61 6d65 2c20 6d65 7472  slice_name, metr
+0002ab20: 6963 2929 0a20 2020 2020 2020 2020 2020  ic)).           
+0002ab30: 2020 2020 2020 2020 2073 6c69 6365 5f63           slice_c
+0002ab40: 6f6c 732e 6170 7065 6e64 286d 6574 7269  ols.append(metri
+0002ab50: 6329 0a20 2020 2020 2020 2020 2020 2020  c).             
+0002ab60: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+0002ab70: 2020 2020 2020 2020 2020 2020 2068 6561               hea
+0002ab80: 6465 7273 2e61 7070 656e 6428 2867 6c6f  ders.append((glo
+0002ab90: 6261 6c5f 6e61 6d65 2c20 6d65 7472 6963  bal_name, metric
+0002aba0: 2929 0a20 2020 2020 2020 2020 2020 2020  )).             
+0002abb0: 2020 2020 2020 2067 6c6f 6261 6c5f 636f         global_co
+0002abc0: 6c73 2e61 7070 656e 6428 6d65 7472 6963  ls.append(metric
+0002abd0: 290a 0a20 2020 2020 2020 2020 2020 2023  )..            #
+0002abe0: 2052 656f 7264 6572 2063 6f6c 756d 6e73   Reorder columns
+0002abf0: 0a20 2020 2020 2020 2020 2020 2064 6673  .            dfs
+0002ac00: 5f6f 7264 6572 6564 203d 205b 6466 5b67  _ordered = [df[g
+0002ac10: 6c6f 6261 6c5f 636f 6c73 5d2c 2064 665b  lobal_cols], df[
+0002ac20: 736c 6963 655f 636f 6c73 5d5d 0a20 2020  slice_cols]].   
+0002ac30: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
+0002ac40: 6e61 6d65 5f61 735f 696e 6465 783a 0a20  name_as_index:. 
+0002ac50: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+0002ac60: 6673 5f6f 7264 6572 6564 2e69 6e73 6572  fs_ordered.inser
+0002ac70: 7428 302c 2064 665b 2252 4f49 225d 290a  t(0, df["ROI"]).
+0002ac80: 2020 2020 2020 2020 2020 2020 6466 203d              df =
+0002ac90: 2070 642e 636f 6e63 6174 2864 6673 5f6f   pd.concat(dfs_o
+0002aca0: 7264 6572 6564 2c20 6178 6973 3d31 290a  rdered, axis=1).
+0002acb0: 0a20 2020 2020 2020 2020 2020 2023 2053  .            # S
+0002acc0: 6f72 7420 6865 6164 6572 7320 6279 2067  ort headers by g
+0002acd0: 6c6f 6261 6c2f 736c 6963 650a 2020 2020  lobal/slice.    
+0002ace0: 2020 2020 2020 2020 6865 6164 6572 7320          headers 
+0002acf0: 3d20 5b68 2066 6f72 2068 2069 6e20 6865  = [h for h in he
+0002ad00: 6164 6572 7320 6966 2068 5b30 5d20 3d3d  aders if h[0] ==
+0002ad10: 2067 6c6f 6261 6c5f 6e61 6d65 5d20 5c0a   global_name] \.
+0002ad20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002ad30: 2020 2020 2b20 5b68 2066 6f72 2068 2069      + [h for h i
+0002ad40: 6e20 6865 6164 6572 7320 6966 2068 5b30  n headers if h[0
+0002ad50: 5d20 3d3d 2073 6c69 6365 5f6e 616d 655d  ] == slice_name]
+0002ad60: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+0002ad70: 6e6f 7420 6e61 6d65 5f61 735f 696e 6465  not name_as_inde
+0002ad80: 783a 0a20 2020 2020 2020 2020 2020 2020  x:.             
+0002ad90: 2020 2068 6561 6465 7273 2e69 6e73 6572     headers.inser
+0002ada0: 7428 302c 2028 2222 2c20 2252 4f49 2229  t(0, ("", "ROI")
+0002adb0: 290a 0a20 2020 2020 2020 2020 2020 2023  )..            #
+0002adc0: 2041 6464 204d 756c 7469 496e 6465 780a   Add MultiIndex.
+0002add0: 2020 2020 2020 2020 2020 2020 6466 2e63              df.c
+0002ade0: 6f6c 756d 6e73 203d 2070 642e 4d75 6c74  olumns = pd.Mult
+0002adf0: 6949 6e64 6578 2e66 726f 6d5f 7475 706c  iIndex.from_tupl
+0002ae00: 6573 2868 6561 6465 7273 290a 0a20 2020  es(headers)..   
+0002ae10: 2020 2020 2072 6574 7572 6e20 6466 0a0a       return df..
+0002ae20: 2020 2020 6465 6620 6765 745f 636f 6d70      def get_comp
+0002ae30: 6172 6973 6f6e 5f6e 616d 6528 7365 6c66  arison_name(self
+0002ae40: 2c20 726f 692c 2063 616d 656c 6361 7365  , roi, camelcase
+0002ae50: 3d46 616c 7365 2c20 636f 6c6f 7265 643d  =False, colored=
+0002ae60: 4661 6c73 652c 0a20 2020 2020 2020 2020  False,.         
+0002ae70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002ae80: 2020 2067 7265 793d 4661 6c73 652c 2072     grey=False, r
+0002ae90: 6f69 5f6b 7761 7267 733d 7b7d 293a 0a20  oi_kwargs={}):. 
+0002aea0: 2020 2020 2020 2022 2222 4765 7420 6e61         """Get na
+0002aeb0: 6d65 206f 6620 636f 6d70 6172 6973 6f6e  me of comparison
+0002aec0: 2062 6574 7765 656e 2074 6869 7320 524f   between this RO
+0002aed0: 4920 616e 6420 616e 6f74 6865 722e 2222  I and another.""
+0002aee0: 220a 0a20 2020 2020 2020 206f 776e 5f6e  "..        own_n
+0002aef0: 616d 6520 3d20 7365 6c66 2e6e 616d 650a  ame = self.name.
+0002af00: 2020 2020 2020 2020 6f74 6865 725f 6e61          other_na
+0002af10: 6d65 203d 2072 6f69 2e6e 616d 650a 0a20  me = roi.name.. 
+0002af20: 2020 2020 2020 2069 6620 636f 6c6f 7265         if colore
+0002af30: 643a 0a20 2020 2020 2020 2020 2020 206f  d:.            o
+0002af40: 776e 5f63 6f6c 6f72 203d 2073 656c 662e  wn_color = self.
+0002af50: 6765 745f 636f 6c6f 725f 6672 6f6d 5f6b  get_color_from_k
+0002af60: 7761 7267 7328 726f 695f 6b77 6172 6773  wargs(roi_kwargs
+0002af70: 290a 2020 2020 2020 2020 2020 2020 6f77  ).            ow
+0002af80: 6e5f 6e61 6d65 203d 2067 6574 5f63 6f6c  n_name = get_col
+0002af90: 6f72 6564 5f72 6f69 5f73 7472 696e 6728  ored_roi_string(
+0002afa0: 7365 6c66 2c20 6772 6579 2c20 6f77 6e5f  self, grey, own_
+0002afb0: 636f 6c6f 7229 0a20 2020 2020 2020 2020  color).         
+0002afc0: 2020 206f 7468 6572 5f63 6f6c 6f72 203d     other_color =
+0002afd0: 2072 6f69 2e67 6574 5f63 6f6c 6f72 5f66   roi.get_color_f
+0002afe0: 726f 6d5f 6b77 6172 6773 2872 6f69 5f6b  rom_kwargs(roi_k
+0002aff0: 7761 7267 7329 0a20 2020 2020 2020 2020  wargs).         
+0002b000: 2020 206f 7468 6572 5f6e 616d 6520 3d20     other_name = 
+0002b010: 6765 745f 636f 6c6f 7265 645f 726f 695f  get_colored_roi_
+0002b020: 7374 7269 6e67 2872 6f69 2c20 6772 6579  string(roi, grey
+0002b030: 2c20 6f74 6865 725f 636f 6c6f 7229 0a0a  , other_color)..
+0002b040: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+0002b050: 6e61 6d65 203d 3d20 726f 692e 6e61 6d65  name == roi.name
+0002b060: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
+0002b070: 2063 616d 656c 6361 7365 3a0a 2020 2020   camelcase:.    
+0002b080: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+0002b090: 726e 206f 776e 5f6e 616d 652e 7265 706c  rn own_name.repl
+0002b0a0: 6163 6528 2220 222c 2022 5f22 290a 2020  ace(" ", "_").  
+0002b0b0: 2020 2020 2020 2020 2020 7265 7475 726e            return
+0002b0c0: 206f 776e 5f6e 616d 650a 2020 2020 2020   own_name.      
+0002b0d0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+0002b0e0: 2020 2020 6966 206e 6f74 2063 6f6c 6f72      if not color
+0002b0f0: 6564 3a0a 2020 2020 2020 2020 2020 2020  ed:.            
+0002b100: 2020 2020 6966 2063 616d 656c 6361 7365      if camelcase
+0002b110: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0002b120: 2020 2020 2020 7265 7475 726e 2066 227b        return f"{
+0002b130: 6f77 6e5f 6e61 6d65 7d5f 7673 5f7b 6f74  own_name}_vs_{ot
+0002b140: 6865 725f 6e61 6d65 7d22 2e72 6570 6c61  her_name}".repla
+0002b150: 6365 2822 2022 2c20 225f 2229 0a20 2020  ce(" ", "_").   
+0002b160: 2020 2020 2020 2020 2020 2020 2072 6574               ret
+0002b170: 7572 6e20 6622 7b6f 776e 5f6e 616d 657d  urn f"{own_name}
+0002b180: 2076 732e 207b 6f74 6865 725f 6e61 6d65   vs. {other_name
+0002b190: 7d22 0a20 2020 2020 2020 2020 2020 2072  }".            r
+0002b1a0: 6574 7572 6e20 6622 7b6f 776e 5f6e 616d  eturn f"{own_nam
+0002b1b0: 657d 7b6f 7468 6572 5f6e 616d 657d 220a  e}{other_name}".
+0002b1c0: 0a20 2020 2064 6566 2073 6574 5f61 6c70  .    def set_alp
+0002b1d0: 6861 5f6f 7665 725f 6265 7461 2873 656c  ha_over_beta(sel
+0002b1e0: 662c 2061 6c70 6861 5f6f 7665 725f 6265  f, alpha_over_be
+0002b1f0: 7461 3d4e 6f6e 6529 3a0a 2020 2020 2020  ta=None):.      
+0002b200: 2020 2222 220a 2020 2020 2020 2020 5365    """.        Se
+0002b210: 7420 7261 7469 6f20 666f 7220 524f 4920  t ratio for ROI 
+0002b220: 7469 7373 7565 206f 6620 636f 6566 6669  tissue of coeffi
+0002b230: 6369 656e 7473 206f 6620 6c69 6e65 6172  cients of linear
+0002b240: 2d71 7561 6472 6174 6963 2065 7175 6174  -quadratic equat
+0002b250: 696f 6e2e 0a0a 2020 2020 2020 2020 2a2a  ion...        **
+0002b260: 5061 7261 6d65 7465 723a 2a2a 0a0a 2020  Parameter:**..  
+0002b270: 2020 2020 2020 616c 7068 615f 6f76 6572        alpha_over
+0002b280: 5f62 6574 6120 3a20 666c 6f61 742c 2064  _beta : float, d
+0002b290: 6566 6175 6c74 3d4e 6f6e 650a 2020 2020  efault=None.    
+0002b2a0: 2020 2020 2020 2020 5261 7469 6f20 666f          Ratio fo
+0002b2b0: 7220 524f 4920 7469 7373 7565 206f 6620  r ROI tissue of 
+0002b2c0: 636f 6566 6669 6369 656e 7473 2c20 616c  coefficients, al
+0002b2d0: 7068 612c 2062 6574 612c 0a20 2020 2020  pha, beta,.     
+0002b2e0: 2020 2020 2020 206f 6620 6c69 6e65 6172         of linear
+0002b2f0: 2d71 7561 6472 6174 6963 2065 7175 6174  -quadratic equat
+0002b300: 696f 6e2e 2020 5468 6973 2072 6174 696f  ion.  This ratio
+0002b310: 2069 7320 7573 6564 2069 6e0a 2020 2020   is used in.    
+0002b320: 2020 2020 2020 2020 6361 6c63 756c 6174          calculat
+0002b330: 696e 6720 6269 6f6c 6f67 6963 616c 6c79  ing biologically
+0002b340: 2065 6666 6563 7469 7665 2064 6f73 652c   effective dose,
+0002b350: 2042 4544 2c20 6672 6f6d 0a20 2020 2020   BED, from.     
+0002b360: 2020 2020 2020 2070 6879 7369 6361 6c20         physical 
+0002b370: 646f 7365 2c20 442c 2064 656c 6976 6572  dose, D, deliver
+0002b380: 6564 206f 7665 7220 6e20 6571 7561 6c20  ed over n equal 
+0002b390: 6672 6163 7469 6f6e 733a 0a20 2020 2020  fractions:.     
+0002b3a0: 2020 2020 2020 2020 2020 2042 4544 203d             BED =
+0002b3b0: 2044 202a 2028 3120 2b20 2844 2f6e 2920   D * (1 + (D/n) 
+0002b3c0: 2f20 2861 6c70 6861 2f62 6574 6129 292e  / (alpha/beta)).
+0002b3d0: 0a20 2020 2020 2020 2020 2020 2049 6620  .            If 
+0002b3e0: 4e6f 6e65 2c20 7468 6520 6269 6f6c 6f67  None, the biolog
+0002b3f0: 6963 616c 6c79 2065 6666 6563 7469 7665  ically effective
+0002b400: 2064 6f73 6520 6973 2074 616b 656e 2074   dose is taken t
+0002b410: 6f20 6265 0a20 2020 2020 2020 2020 2020  o be.           
+0002b420: 2065 7175 616c 2074 6f20 7468 6520 7068   equal to the ph
+0002b430: 7973 6963 616c 2064 6f73 6520 2862 6574  ysical dose (bet
+0002b440: 6120 3e3e 2061 6c70 6861 292e 0a20 2020  a >> alpha)..   
+0002b450: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+0002b460: 2073 656c 662e 616c 7068 615f 6f76 6572   self.alpha_over
+0002b470: 5f62 6574 6120 3d20 616c 7068 615f 6f76  _beta = alpha_ov
+0002b480: 6572 5f62 6574 610a 0a20 2020 2064 6566  er_beta..    def
+0002b490: 2067 6574 5f61 6c70 6861 5f6f 7665 725f   get_alpha_over_
+0002b4a0: 6265 7461 2873 656c 6629 3a0a 2020 2020  beta(self):.    
+0002b4b0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+0002b4c0: 4765 7420 7261 7469 6f20 666f 7220 524f  Get ratio for RO
+0002b4d0: 4920 7469 7373 7565 206f 6620 636f 6566  I tissue of coef
+0002b4e0: 6669 6369 656e 7473 206f 6620 6c69 6e65  ficients of line
+0002b4f0: 6172 2d71 7561 6472 6174 6963 2065 7175  ar-quadratic equ
+0002b500: 6174 696f 6e2e 0a20 2020 2020 2020 2022  ation..        "
+0002b510: 2222 0a20 2020 2020 2020 2072 6574 7572  "".        retur
+0002b520: 6e20 7365 6c66 2e61 6c70 6861 5f6f 7665  n self.alpha_ove
+0002b530: 725f 6265 7461 0a0a 2020 2020 6465 6620  r_beta..    def 
+0002b540: 7365 745f 636f 6c6f 7228 7365 6c66 2c20  set_color(self, 
+0002b550: 636f 6c6f 7229 3a0a 2020 2020 2020 2020  color):.        
+0002b560: 2222 2253 6574 2070 6c6f 7474 696e 6720  """Set plotting 
+0002b570: 636f 6c6f 722e 2222 220a 0a20 2020 2020  color."""..     
+0002b580: 2020 2069 6620 636f 6c6f 7220 6973 206e     if color is n
+0002b590: 6f74 204e 6f6e 6520 616e 6420 6e6f 7420  ot None and not 
+0002b5a0: 6d61 7470 6c6f 746c 6962 2e63 6f6c 6f72  matplotlib.color
+0002b5b0: 732e 6973 5f63 6f6c 6f72 5f6c 696b 6528  s.is_color_like(
+0002b5c0: 636f 6c6f 7229 3a0a 2020 2020 2020 2020  color):.        
+0002b5d0: 2020 2020 7072 696e 7428 6622 5761 726e      print(f"Warn
+0002b5e0: 696e 673a 207b 636f 6c6f 727d 206e 6f74  ing: {color} not
+0002b5f0: 2061 2076 616c 6964 2063 6f6c 6f72 2122   a valid color!"
+0002b600: 290a 2020 2020 2020 2020 2020 2020 636f  ).            co
+0002b610: 6c6f 7220 3d20 4e6f 6e65 0a20 2020 2020  lor = None.     
+0002b620: 2020 2069 6620 636f 6c6f 7220 6973 204e     if color is N
+0002b630: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+0002b640: 2063 6f6c 6f72 203d 2052 4f49 4465 6661   color = ROIDefa
+0002b650: 756c 7473 2829 2e67 6574 5f64 6566 6175  ults().get_defau
+0002b660: 6c74 5f72 6f69 5f63 6f6c 6f72 2829 0a20  lt_roi_color(). 
+0002b670: 2020 2020 2020 2073 656c 662e 636f 6c6f         self.colo
+0002b680: 7220 3d20 6d61 7470 6c6f 746c 6962 2e63  r = matplotlib.c
+0002b690: 6f6c 6f72 732e 746f 5f72 6762 6128 636f  olors.to_rgba(co
+0002b6a0: 6c6f 7229 0a0a 2020 2020 6465 6620 706c  lor)..    def pl
+0002b6b0: 6f74 280a 2020 2020 2020 2020 7365 6c66  ot(.        self
+0002b6c0: 2c0a 2020 2020 2020 2020 7669 6577 3d22  ,.        view="
+0002b6d0: 782d 7922 2c0a 2020 2020 2020 2020 706c  x-y",.        pl
+0002b6e0: 6f74 5f74 7970 653d 2263 6f6e 746f 7572  ot_type="contour
+0002b6f0: 222c 0a20 2020 2020 2020 2073 6c3d 4e6f  ",.        sl=No
+0002b700: 6e65 2c0a 2020 2020 2020 2020 6964 783d  ne,.        idx=
+0002b710: 4e6f 6e65 2c0a 2020 2020 2020 2020 706f  None,.        po
+0002b720: 733d 4e6f 6e65 2c0a 2020 2020 2020 2020  s=None,.        
+0002b730: 6178 3d4e 6f6e 652c 0a20 2020 2020 2020  ax=None,.       
+0002b740: 2067 733d 4e6f 6e65 2c0a 2020 2020 2020   gs=None,.      
+0002b750: 2020 6669 6773 697a 653d 736b 7274 2e69    figsize=skrt.i
+0002b760: 6d61 6765 2e5f 6465 6661 756c 745f 6669  mage._default_fi
+0002b770: 6773 697a 652c 0a20 2020 2020 2020 206f  gsize,.        o
+0002b780: 7061 6369 7479 3d4e 6f6e 652c 0a20 2020  pacity=None,.   
+0002b790: 2020 2020 206c 696e 6577 6964 7468 3d4e       linewidth=N
+0002b7a0: 6f6e 652c 0a20 2020 2020 2020 2063 6f6e  one,.        con
+0002b7b0: 746f 7572 5f6b 7761 7267 733d 4e6f 6e65  tour_kwargs=None
+0002b7c0: 2c0a 2020 2020 2020 2020 6d61 736b 5f6b  ,.        mask_k
+0002b7d0: 7761 7267 733d 4e6f 6e65 2c0a 2020 2020  wargs=None,.    
+0002b7e0: 2020 2020 7a6f 6f6d 3d4e 6f6e 652c 0a20      zoom=None,. 
+0002b7f0: 2020 2020 2020 207a 6f6f 6d5f 6365 6e74         zoom_cent
+0002b800: 7265 3d4e 6f6e 652c 0a20 2020 2020 2020  re=None,.       
+0002b810: 2063 6f6c 6f72 3d4e 6f6e 652c 0a20 2020   color=None,.   
+0002b820: 2020 2020 2073 686f 773d 5472 7565 2c0a       show=True,.
+0002b830: 2020 2020 2020 2020 7361 7665 5f61 733d          save_as=
+0002b840: 4e6f 6e65 2c0a 2020 2020 2020 2020 696e  None,.        in
+0002b850: 636c 7564 655f 696d 6167 653d 4661 6c73  clude_image=Fals
+0002b860: 652c 0a20 2020 2020 2020 206e 6f5f 696e  e,.        no_in
+0002b870: 7665 7274 3d46 616c 7365 2c0a 2020 2020  vert=False,.    
+0002b880: 2020 2020 2a2a 6b77 6172 6773 2c0a 2020      **kwargs,.  
+0002b890: 2020 293a 0a20 2020 2020 2020 2022 2222    ):.        """
+0002b8a0: 506c 6f74 2074 6869 7320 524f 4920 6173  Plot this ROI as
+0002b8b0: 2065 6974 6865 7220 6120 6d61 736b 206f   either a mask o
+0002b8c0: 7220 6120 636f 6e74 6f75 722e 0a0a 2020  r a contour...  
+0002b8d0: 2020 2020 2020 2a2a 5061 7261 6d65 7465        **Paramete
+0002b8e0: 7273 3a2a 2a0a 0a20 2020 2020 2020 2076  rs:**..        v
+0002b8f0: 6965 7720 3a20 7374 722c 2064 6566 6175  iew : str, defau
+0002b900: 6c74 3d22 782d 7922 0a20 2020 2020 2020  lt="x-y".       
+0002b910: 2020 2020 204f 7269 656e 7461 7469 6f6e       Orientation
+0002b920: 2069 6e20 7768 6963 6820 746f 2070 6c6f   in which to plo
+0002b930: 742e 2043 616e 2062 6520 2278 2d79 222c  t. Can be "x-y",
+0002b940: 2022 792d 7a22 2c20 6f72 2022 782d 7a22   "y-z", or "x-z"
+0002b950: 2e0a 0a20 2020 2020 2020 2070 6c6f 745f  ...        plot_
+0002b960: 7479 7065 203a 2073 7472 2c20 6465 6661  type : str, defa
+0002b970: 756c 743d 2263 6f6e 746f 7572 220a 2020  ult="contour".  
+0002b980: 2020 2020 2020 2020 2020 506c 6f74 7469            Plotti
+0002b990: 6e67 2074 7970 652e 2049 6620 4e6f 6e65  ng type. If None
+0002b9a0: 2c20 7769 6c6c 2062 6520 6569 7468 6572  , will be either
+0002b9b0: 2022 636f 6e74 6f75 7222 206f 7220 226d   "contour" or "m
+0002b9c0: 6173 6b22 200a 2020 2020 2020 2020 2020  ask" .          
+0002b9d0: 2020 6465 7065 6e64 696e 6720 6f6e 2074    depending on t
+0002b9e0: 6865 2069 6e70 7574 2074 7970 6520 6f66  he input type of
+0002b9f0: 2074 6865 2052 4f49 2e20 4f70 7469 6f6e   the ROI. Option
+0002ba00: 733a 0a0a 2020 2020 2020 2020 2020 2020  s:..            
+0002ba10: 2020 2020 2d20 2263 6f6e 746f 7572 220a      - "contour".
+0002ba20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002ba30: 2d20 226d 6173 6b22 0a20 2020 2020 2020  - "mask".       
+0002ba40: 2020 2020 2020 2020 202d 2022 6365 6e74           - "cent
+0002ba50: 726f 6964 2220 2863 6f6e 746f 7572 2077  roid" (contour w
+0002ba60: 6974 6820 6d61 726b 6572 2061 7420 6365  ith marker at ce
+0002ba70: 6e74 726f 6964 290a 2020 2020 2020 2020  ntroid).        
+0002ba80: 2020 2020 2020 2020 2d20 2266 696c 6c65          - "fille
+0002ba90: 6422 2028 7472 616e 7370 6172 656e 7420  d" (transparent 
+0002baa0: 6d61 736b 202b 2063 6f6e 746f 7572 290a  mask + contour).
+0002bab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002bac0: 2d20 2266 696c 6c65 6420 6365 6e74 726f  - "filled centro
+0002bad0: 6964 2220 2866 696c 6c65 6420 7769 7468  id" (filled with
+0002bae0: 206d 6172 6b65 7220 6174 2063 656e 7472   marker at centr
+0002baf0: 6f69 6429 0a0a 2020 2020 2020 2020 736c  oid)..        sl
+0002bb00: 203a 2069 6e74 2c20 6465 6661 756c 743d   : int, default=
+0002bb10: 4e6f 6e65 0a20 2020 2020 2020 2020 2020  None.           
+0002bb20: 2053 6c69 6365 206e 756d 6265 7220 746f   Slice number to
+0002bb30: 2070 6c6f 742e 2049 6620 6e6f 6e65 206f   plot. If none o
+0002bb40: 6620 3c73 6c3e 2c20 3c69 6478 3e20 6f72  f <sl>, <idx> or
+0002bb50: 203c 706f 733e 2061 7265 2073 7570 706c   <pos> are suppl
+0002bb60: 6965 642c 200a 2020 2020 2020 2020 2020  ied, .          
+0002bb70: 2020 7468 6520 6365 6e74 7261 6c20 736c    the central sl
+0002bb80: 6963 6520 6f66 2074 6865 2052 4f49 2077  ice of the ROI w
+0002bb90: 696c 6c20 6265 200a 2020 2020 2020 2020  ill be .        
+0002bba0: 2020 2020 7573 6564 2e0a 0a20 2020 2020      used...     
+0002bbb0: 2020 2069 6478 203a 2069 6e74 2c20 6465     idx : int, de
+0002bbc0: 6661 756c 743d 4e6f 6e65 0a20 2020 2020  fault=None.     
+0002bbd0: 2020 2020 2020 2041 7272 6179 2069 6e64         Array ind
+0002bbe0: 6578 206f 6620 736c 6963 6520 746f 2070  ex of slice to p
+0002bbf0: 6c6f 742e 2049 6620 6e6f 6e65 206f 6620  lot. If none of 
+0002bc00: 3c73 6c3e 2c20 3c69 6478 3e20 6f72 203c  <sl>, <idx> or <
+0002bc10: 706f 733e 2061 7265 200a 2020 2020 2020  pos> are .      
+0002bc20: 2020 2020 2020 7375 7070 6c69 6564 2c20        supplied, 
+0002bc30: 7468 6520 6365 6e74 7261 6c20 736c 6963  the central slic
+0002bc40: 6520 6f66 2074 6865 2052 4f49 2077 696c  e of the ROI wil
+0002bc50: 6c20 6265 2075 7365 642e 0a0a 2020 2020  l be used...    
+0002bc60: 2020 2020 706f 7320 3a20 666c 6f61 742c      pos : float,
+0002bc70: 2064 6566 6175 6c74 3d4e 6f6e 650a 2020   default=None.  
+0002bc80: 2020 2020 2020 2020 2020 506f 7369 7469            Positi
+0002bc90: 6f6e 2069 6e20 6d6d 206f 6620 736c 6963  on in mm of slic
+0002bca0: 6520 746f 2070 6c6f 742e 2049 6620 6e6f  e to plot. If no
+0002bcb0: 6e65 206f 6620 3c73 6c3e 2c20 3c69 6478  ne of <sl>, <idx
+0002bcc0: 3e20 6f72 203c 706f 733e 200a 2020 2020  > or <pos> .    
+0002bcd0: 2020 2020 2020 2020 6172 6520 7375 7070          are supp
+0002bce0: 6c69 6564 2c20 7468 6520 6365 6e74 7261  lied, the centra
+0002bcf0: 6c20 736c 6963 6520 6f66 2074 6865 2052  l slice of the R
+0002bd00: 4f49 2077 696c 6c20 6265 2075 7365 642e  OI will be used.
+0002bd10: 0a0a 2020 2020 2020 2020 6178 203a 206d  ..        ax : m
+0002bd20: 6174 706c 6f74 6c69 622e 7079 706c 6f74  atplotlib.pyplot
+0002bd30: 2e41 7865 732c 2064 6566 6175 6c74 3d4e  .Axes, default=N
+0002bd40: 6f6e 650a 2020 2020 2020 2020 2020 2020  one.            
+0002bd50: 4178 6573 206f 6e20 7768 6963 6820 746f  Axes on which to
+0002bd60: 2070 6c6f 742e 2049 6620 4e6f 6e65 2c20   plot. If None, 
+0002bd70: 6e65 7720 6178 6573 2077 696c 6c20 6265  new axes will be
+0002bd80: 2063 7265 6174 6564 2e0a 0a20 2020 2020   created...     
+0002bd90: 2020 2067 7320 3a20 6d61 7470 6c6f 746c     gs : matplotl
+0002bda0: 6962 2e67 7269 6473 7065 632e 4772 6964  ib.gridspec.Grid
+0002bdb0: 5370 6563 2c20 6465 6661 756c 743d 4e6f  Spec, default=No
+0002bdc0: 6e65 0a20 2020 2020 2020 2020 2020 2049  ne.            I
+0002bdd0: 6620 6e6f 7420 4e6f 6e65 2061 6e64 203c  f not None and <
+0002bde0: 6178 3e20 6973 204e 6f6e 652c 206e 6577  ax> is None, new
+0002bdf0: 2061 7865 7320 7769 6c6c 2062 6520 6372   axes will be cr
+0002be00: 6561 7465 6420 6f6e 2074 6865 0a20 2020  eated on the.   
+0002be10: 2020 2020 2020 2020 2063 7572 7265 6e74           current
+0002be20: 206d 6174 706c 6f74 6c69 6220 6669 6775   matplotlib figu
+0002be30: 7265 2077 6974 6820 7468 6973 2067 7269  re with this gri
+0002be40: 6473 7065 632e 0a0a 2020 2020 2020 2020  dspec...        
+0002be50: 6669 6773 697a 6520 3a20 666c 6f61 742c  figsize : float,
+0002be60: 2064 6566 6175 6c74 3d73 6b72 742e 696d   default=skrt.im
+0002be70: 6167 652e 5f64 6566 6175 6c74 5f66 6967  age._default_fig
+0002be80: 7369 7a65 0a20 2020 2020 2020 2020 2020  size.           
+0002be90: 2046 6967 7572 6520 6865 6967 6874 2069   Figure height i
+0002bea0: 6e20 696e 6368 6573 3b20 6f6e 6c79 2075  n inches; only u
+0002beb0: 7365 6420 6966 203c 6178 3e20 616e 6420  sed if <ax> and 
+0002bec0: 3c67 733e 2061 7265 204e 6f6e 652e 0a0a  <gs> are None...
+0002bed0: 2020 2020 2020 2020 6f70 6163 6974 7920          opacity 
+0002bee0: 3a20 666c 6f61 742c 2064 6566 6175 6c74  : float, default
+0002bef0: 3d4e 6f6e 650a 2020 2020 2020 2020 2020  =None.          
+0002bf00: 2020 4f70 6163 6974 7920 746f 2075 7365    Opacity to use
+0002bf10: 2069 6620 706c 6f74 7469 6e67 206d 6173   if plotting mas
+0002bf20: 6b20 2869 2e65 2e20 706c 6f74 2074 7970  k (i.e. plot typ
+0002bf30: 6573 2022 6d61 736b 222c 2022 6669 6c6c  es "mask", "fill
+0002bf40: 6564 222c 200a 2020 2020 2020 2020 2020  ed", .          
+0002bf50: 2020 6f72 2022 6669 6c6c 6564 2063 656e    or "filled cen
+0002bf60: 7472 6f69 6422 292e 2049 6620 4e6f 6e65  troid"). If None
+0002bf70: 2c20 6f70 6163 6974 7920 7769 6c6c 2062  , opacity will b
+0002bf80: 6520 3120 6279 2064 6566 6175 6c74 2066  e 1 by default f
+0002bf90: 6f72 200a 2020 2020 2020 2020 2020 2020  or .            
+0002bfa0: 736f 6c69 6420 6d61 736b 2070 6c6f 7473  solid mask plots
+0002bfb0: 2061 6e64 2030 2e33 2062 7920 6465 6661   and 0.3 by defa
+0002bfc0: 756c 7420 666f 7220 6669 6c6c 6564 2070  ult for filled p
+0002bfd0: 6c6f 7473 2e0a 0a20 2020 2020 2020 206c  lots...        l
+0002bfe0: 696e 6577 6964 7468 203a 2066 6c6f 6174  inewidth : float
+0002bff0: 2c20 6465 6661 756c 743d 4e6f 6e65 0a20  , default=None. 
+0002c000: 2020 2020 2020 2020 2020 2057 6964 7468             Width
+0002c010: 206f 6620 636f 6e74 6f75 7220 6c69 6e65   of contour line
+0002c020: 732e 2049 6620 4e6f 6e65 2c20 7468 6520  s. If None, the 
+0002c030: 6d61 7470 6c6f 746c 6962 2064 6566 6175  matplotlib defau
+0002c040: 6c74 2073 6574 7469 6e67 200a 2020 2020  lt setting .    
+0002c050: 2020 2020 2020 2020 7769 6c6c 2062 6520          will be 
+0002c060: 7573 6564 2e0a 0a20 2020 2020 2020 2063  used...        c
+0002c070: 6f6e 746f 7572 5f6b 7761 7267 7320 3a20  ontour_kwargs : 
+0002c080: 6469 6374 2c20 6465 6661 756c 743d 4e6f  dict, default=No
+0002c090: 6e65 0a20 2020 2020 2020 2020 2020 2045  ne.            E
+0002c0a0: 7874 7261 206b 6579 776f 7264 2061 7267  xtra keyword arg
+0002c0b0: 756d 656e 7473 2074 6f20 7061 7373 2074  uments to pass t
+0002c0c0: 6f20 6d61 7470 6c6f 746c 6962 2063 6f6e  o matplotlib con
+0002c0d0: 746f 7572 2070 6c6f 7474 696e 672e 0a0a  tour plotting...
+0002c0e0: 2020 2020 2020 2020 6d61 736b 5f6b 7761          mask_kwa
+0002c0f0: 7267 7320 3a20 6469 6374 2c20 6465 6661  rgs : dict, defa
+0002c100: 756c 743d 4e6f 6e65 0a20 2020 2020 2020  ult=None.       
+0002c110: 2020 2020 2045 7874 7261 206b 6579 776f       Extra keywo
+0002c120: 7264 2061 7267 756d 656e 7473 2074 6f20  rd arguments to 
+0002c130: 7061 7373 2074 6f20 6d61 7470 6c6f 746c  pass to matplotl
+0002c140: 6962 206d 6173 6b20 706c 6f74 7469 6e67  ib mask plotting
+0002c150: 2e0a 0a20 2020 2020 2020 207a 6f6f 6d20  ...        zoom 
+0002c160: 3a20 696e 742f 666c 6f61 742f 7475 706c  : int/float/tupl
+0002c170: 652c 2064 6566 6175 6c74 3d4e 6f6e 650a  e, default=None.
+0002c180: 2020 2020 2020 2020 2020 2020 4661 6374              Fact
+0002c190: 6f72 2062 7920 7768 6963 6820 746f 207a  or by which to z
+0002c1a0: 6f6f 6d20 696e 2e20 4966 2061 2073 696e  oom in. If a sin
+0002c1b0: 676c 6520 696e 7420 6f72 2066 6c6f 6174  gle int or float
+0002c1c0: 2069 7320 6769 7665 6e2c 0a20 2020 2020   is given,.     
+0002c1d0: 2020 2020 2020 2074 6865 2073 616d 6520         the same 
+0002c1e0: 7a6f 6f6d 2066 6163 746f 7220 7769 6c6c  zoom factor will
+0002c1f0: 2062 6520 6170 706c 6965 6420 696e 2061   be applied in a
+0002c200: 6c6c 2064 6972 6563 7469 6f6e 732e 2049  ll directions. I
+0002c210: 6620 6120 7475 706c 650a 2020 2020 2020  f a tuple.      
+0002c220: 2020 2020 2020 6f66 2074 6872 6565 2076        of three v
+0002c230: 616c 7565 7320 6973 2067 6976 656e 2c20  alues is given, 
+0002c240: 7468 6573 6520 7769 6c6c 2062 6520 7573  these will be us
+0002c250: 6564 2061 7320 7468 6520 7a6f 6f6d 2066  ed as the zoom f
+0002c260: 6163 746f 7273 0a20 2020 2020 2020 2020  actors.         
+0002c270: 2020 2069 6e20 6561 6368 2064 6972 6563     in each direc
+0002c280: 7469 6f6e 2069 6e20 7468 6520 6f72 6465  tion in the orde
+0002c290: 7220 2878 2c20 792c 207a 292e 2049 6620  r (x, y, z). If 
+0002c2a0: 4e6f 6e65 2c20 7468 6520 696d 6167 6520  None, the image 
+0002c2b0: 7769 6c6c 0a20 2020 2020 2020 2020 2020  will.           
+0002c2c0: 206e 6f74 2062 6520 7a6f 6f6d 6564 2069   not be zoomed i
+0002c2d0: 6e2e 0a0a 2020 2020 2020 2020 7a6f 6f6d  n...        zoom
+0002c2e0: 5f63 656e 7472 6520 3a20 7475 706c 652c  _centre : tuple,
+0002c2f0: 2064 6566 6175 6c74 3d4e 6f6e 650a 2020   default=None.  
+0002c300: 2020 2020 2020 2020 2020 506f 7369 7469            Positi
+0002c310: 6f6e 2061 726f 756e 6420 7768 6963 6820  on around which 
+0002c320: 7a6f 6f6d 696e 6720 6973 2061 7070 6c69  zooming is appli
+0002c330: 6564 2e20 4966 204e 6f6e 652c 2074 6865  ed. If None, the
+0002c340: 2063 656e 7472 6520 6f66 0a20 2020 2020   centre of.     
+0002c350: 2020 2020 2020 2074 6865 2069 6d61 6765         the image
+0002c360: 2077 696c 6c20 6265 2075 7365 642e 0a0a   will be used...
+0002c370: 2020 2020 2020 2020 636f 6c6f 7220 3a20          color : 
+0002c380: 6d61 7470 6c6f 746c 6962 2063 6f6c 6f72  matplotlib color
+0002c390: 2c20 6465 6661 756c 743d 4e6f 6e65 0a20  , default=None. 
+0002c3a0: 2020 2020 2020 2020 2020 2043 6f6c 6f72             Color
+0002c3b0: 2077 6974 6820 7768 6963 6820 746f 2070   with which to p
+0002c3c0: 6c6f 7420 7468 6520 524f 493b 206f 7665  lot the ROI; ove
+0002c3d0: 7272 6964 6573 2074 6865 2052 4f49 2773  rrides the ROI's
+0002c3e0: 206f 776e 2063 6f6c 6f72 2e20 4966 200a   own color. If .
+0002c3f0: 2020 2020 2020 2020 2020 2020 4e6f 6e65              None
+0002c400: 2c20 7365 6c66 2e63 6f6c 6f72 2077 696c  , self.color wil
+0002c410: 6c20 6265 2075 7365 642e 0a0a 2020 2020  l be used...    
+0002c420: 2020 2020 7368 6f77 203a 2062 6f6f 6c2c      show : bool,
+0002c430: 2064 6566 6175 6c74 3d54 7275 650a 2020   default=True.  
+0002c440: 2020 2020 2020 2020 2020 4966 2054 7275            If Tru
+0002c450: 652c 2074 6865 2070 6c6f 7420 7769 6c6c  e, the plot will
+0002c460: 2062 6520 6469 7370 6c61 7965 6420 696d   be displayed im
+0002c470: 6d65 6469 6174 656c 792e 0a0a 2020 2020  mediately...    
+0002c480: 2020 2020 7361 7665 5f61 7320 3a20 7374      save_as : st
+0002c490: 722c 2064 6566 6175 6c74 3d4e 6f6e 650a  r, default=None.
+0002c4a0: 2020 2020 2020 2020 2020 2020 4966 2073              If s
+0002c4b0: 6574 2074 6f20 6120 7374 7269 6e67 2c20  et to a string, 
+0002c4c0: 7468 6520 706c 6f74 2077 696c 6c20 6265  the plot will be
+0002c4d0: 2073 6176 6564 2074 6f20 7468 6520 6669   saved to the fi
+0002c4e0: 6c65 6e61 6d65 2069 6e20 7468 6520 0a20  lename in the . 
+0002c4f0: 2020 2020 2020 2020 2020 2073 7472 696e             strin
+0002c500: 672e 0a0a 2020 2020 2020 2020 696e 636c  g...        incl
+0002c510: 7564 655f 696d 6167 6520 3a20 626f 6f6c  ude_image : bool
+0002c520: 2c20 6465 6661 756c 743d 4661 6c73 650a  , default=False.
+0002c530: 2020 2020 2020 2020 2020 2020 4966 2054              If T
+0002c540: 7275 6520 616e 6420 7365 6c66 2e69 6d61  rue and self.ima
+0002c550: 6765 2069 7320 6e6f 7420 4e6f 6e65 2c20  ge is not None, 
+0002c560: 7468 6520 524f 4927 7320 696d 6167 6520  the ROI's image 
+0002c570: 7769 6c6c 2062 6520 706c 6f74 7465 640a  will be plotted.
+0002c580: 2020 2020 2020 2020 2020 2020 696e 2074              in t
+0002c590: 6865 2062 6163 6b67 726f 756e 642e 0a0a  he background...
+0002c5a0: 2020 2020 2020 2020 6e6f 5f69 6e76 6572          no_inver
+0002c5b0: 7420 3a20 626f 6f6c 2c20 6465 6661 756c  t : bool, defaul
+0002c5c0: 743d 4661 6c73 650a 2020 2020 2020 2020  t=False.        
+0002c5d0: 2020 2020 4966 2046 616c 7365 2c20 636f      If False, co
+0002c5e0: 6e74 6f75 7220 706c 6f74 7320 7769 6c6c  ntour plots will
+0002c5f0: 2062 6520 6175 746f 6d61 7469 6361 6c6c   be automaticall
+0002c600: 7920 696e 7665 7274 6564 2077 6865 6e20  y inverted when 
+0002c610: 706c 6f74 7469 6e67 0a20 2020 2020 2020  plotting.       
+0002c620: 2020 2020 2077 6974 686f 7574 2061 6e20       without an 
+0002c630: 756e 6465 726c 7969 6e67 2069 6d61 6765  underlying image
+0002c640: 2074 6f20 6163 636f 756e 7420 666f 7220   to account for 
+0002c650: 7468 6520 7920 6178 6973 2069 6e63 7265  the y axis incre
+0002c660: 6173 696e 6720 0a20 2020 2020 2020 2020  asing .         
+0002c670: 2020 2069 6e20 7468 6520 6f70 706f 7369     in the opposi
+0002c680: 7465 2064 6972 6563 7469 6f6e 2e20 4f74  te direction. Ot
+0002c690: 6865 7277 6973 652c 2074 6865 2070 6c6f  herwise, the plo
+0002c6a0: 7420 7769 6c6c 2062 6520 6c65 6674 2061  t will be left a
+0002c6b0: 730a 2020 2020 2020 2020 2020 2020 6974  s.            it
+0002c6c0: 2061 7070 6561 7265 6420 7768 656e 2064   appeared when d
+0002c6d0: 7261 776e 2062 7920 6d61 7470 6c6f 746c  rawn by matplotl
+0002c6e0: 6962 2e0a 0a20 2020 2020 2020 2060 2a2a  ib...        `**
+0002c6f0: 606b 7761 7267 7320 3a0a 2020 2020 2020  `kwargs :.      
+0002c700: 2020 2020 2020 4578 7472 6120 6b65 7977        Extra keyw
+0002c710: 6f72 6420 6172 6775 6d65 6e74 7320 746f  ord arguments to
+0002c720: 2070 6173 7320 746f 2074 6865 2072 656c   pass to the rel
+0002c730: 6576 616e 7420 706c 6f74 2066 756e 6374  evant plot funct
+0002c740: 696f 6e2e 0a20 2020 2020 2020 2022 2222  ion..        """
+0002c750: 0a0a 2020 2020 2020 2020 7365 6c66 2e6c  ..        self.l
+0002c760: 6f61 6428 290a 2020 2020 2020 2020 6966  oad().        if
+0002c770: 2073 656c 662e 656d 7074 793a 0a20 2020   self.empty:.   
+0002c780: 2020 2020 2020 2020 2072 6574 7572 6e0a           return.
+0002c790: 0a20 2020 2020 2020 2069 6620 706c 6f74  .        if plot
+0002c7a0: 5f74 7970 6520 6973 204e 6f6e 653a 0a20  _type is None:. 
+0002c7b0: 2020 2020 2020 2020 2020 2070 6c6f 745f             plot_
+0002c7c0: 7479 7065 203d 206b 7761 7267 732e 6765  type = kwargs.ge
+0002c7d0: 7428 2272 6f69 5f70 6c6f 745f 7479 7065  t("roi_plot_type
+0002c7e0: 222c 2073 656c 662e 6465 6661 756c 745f  ", self.default_
+0002c7f0: 6765 6f6d 5f6d 6574 686f 6429 0a0a 2020  geom_method)..  
+0002c800: 2020 2020 2020 6966 2073 6c20 6973 204e        if sl is N
+0002c810: 6f6e 6520 616e 6420 6964 7820 6973 204e  one and idx is N
+0002c820: 6f6e 6520 616e 6420 706f 7320 6973 204e  one and pos is N
+0002c830: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+0002c840: 2069 6478 203d 2073 656c 662e 6765 745f   idx = self.get_
+0002c850: 6d69 645f 6964 7828 7669 6577 290a 2020  mid_idx(view).  
+0002c860: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+0002c870: 2020 2020 2020 2020 6964 7820 3d20 7365          idx = se
+0002c880: 6c66 2e67 6574 5f69 6478 2876 6965 772c  lf.get_idx(view,
+0002c890: 2073 6c2c 2069 6478 2c20 706f 7329 0a0a   sl, idx, pos)..
+0002c8a0: 2020 2020 2020 2020 7368 6f77 5f63 656e          show_cen
+0002c8b0: 7472 6f69 6420 3d20 2263 656e 7472 6f69  troid = "centroi
+0002c8c0: 6422 2069 6e20 706c 6f74 5f74 7970 650a  d" in plot_type.
+0002c8d0: 2020 2020 2020 2020 6966 207a 6f6f 6d20          if zoom 
+0002c8e0: 616e 6420 7a6f 6f6d 5f63 656e 7472 6520  and zoom_centre 
+0002c8f0: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
+0002c900: 2020 2020 207a 6f6f 6d5f 6365 6e74 7265       zoom_centre
+0002c910: 203d 2073 656c 662e 6765 745f 7a6f 6f6d   = self.get_zoom
+0002c920: 5f63 656e 7472 6528 7669 6577 290a 2020  _centre(view).  
+0002c930: 2020 2020 2020 6966 2063 6f6c 6f72 2069        if color i
+0002c940: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
+0002c950: 2020 2020 636f 6c6f 7220 3d20 7365 6c66      color = self
+0002c960: 2e63 6f6c 6f72 0a20 2020 2020 2020 2065  .color.        e
+0002c970: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+0002c980: 2063 6f6c 6f72 203d 206d 6174 706c 6f74   color = matplot
+0002c990: 6c69 622e 636f 6c6f 7273 2e74 6f5f 7267  lib.colors.to_rg
+0002c9a0: 6261 2863 6f6c 6f72 290a 0a20 2020 2020  ba(color)..     
+0002c9b0: 2020 2069 6620 6f70 6163 6974 7920 6973     if opacity is
+0002c9c0: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+0002c9d0: 2020 206f 7061 6369 7479 203d 206b 7761     opacity = kwa
+0002c9e0: 7267 732e 6765 7428 0a20 2020 2020 2020  rgs.get(.       
+0002c9f0: 2020 2020 2020 2020 2020 2020 2022 726f               "ro
+0002ca00: 695f 6f70 6163 6974 7922 2c20 302e 3320  i_opacity", 0.3 
+0002ca10: 6966 2022 6669 6c6c 6564 2220 696e 2070  if "filled" in p
+0002ca20: 6c6f 745f 7479 7065 2065 6c73 6520 3129  lot_type else 1)
+0002ca30: 0a0a 2020 2020 2020 2020 2320 5365 7420  ..        # Set 
+0002ca40: 7570 2061 7865 730a 2020 2020 2020 2020  up axes.        
+0002ca50: 7365 6c66 2e73 6574 5f61 7828 706c 6f74  self.set_ax(plot
+0002ca60: 5f74 7970 652c 2069 6e63 6c75 6465 5f69  _type, include_i
+0002ca70: 6d61 6765 2c20 7669 6577 2c20 6178 2c20  mage, view, ax, 
+0002ca80: 6773 2c20 6669 6773 697a 6529 0a0a 2020  gs, figsize)..  
+0002ca90: 2020 2020 2020 2320 4164 6a75 7374 2063        # Adjust c
+0002caa0: 656e 7472 6f69 6420 6d61 726b 6572 2073  entroid marker s
+0002cab0: 697a 650a 2020 2020 2020 2020 6966 2063  ize.        if c
+0002cac0: 6f6e 746f 7572 5f6b 7761 7267 7320 6973  ontour_kwargs is
+0002cad0: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+0002cae0: 2020 2063 6f6e 746f 7572 5f6b 7761 7267     contour_kwarg
+0002caf0: 7320 3d20 7b7d 0a20 2020 2020 2020 2069  s = {}.        i
+0002cb00: 6620 2263 656e 7472 6f69 6422 2069 6e20  f "centroid" in 
+0002cb10: 706c 6f74 5f74 7970 6520 6f72 2022 636f  plot_type or "co
+0002cb20: 6e74 6f75 7222 203d 3d20 706c 6f74 5f74  ntour" == plot_t
+0002cb30: 7970 653a 0a20 2020 2020 2020 2020 2020  ype:.           
+0002cb40: 2069 6620 6c69 6e65 7769 6474 6820 6973   if linewidth is
+0002cb50: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+0002cb60: 2020 2020 2020 206c 696e 6577 6964 7468         linewidth
+0002cb70: 203d 206b 7761 7267 732e 6765 7428 2272   = kwargs.get("r
+0002cb80: 6f69 5f6c 696e 6577 6964 7468 222c 0a20  oi_linewidth",. 
+0002cb90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002cba0: 2020 2020 2020 2064 6566 6175 6c74 5061         defaultPa
+0002cbb0: 7261 6d73 5b22 6c69 6e65 732e 6c69 6e65  rams["lines.line
+0002cbc0: 7769 6474 6822 5d5b 305d 290a 2020 2020  width"][0]).    
+0002cbd0: 2020 2020 6966 2022 6365 6e74 726f 6964      if "centroid
+0002cbe0: 2220 696e 2070 6c6f 745f 7479 7065 3a0a  " in plot_type:.
+0002cbf0: 2020 2020 2020 2020 2020 2020 636f 6e74              cont
+0002cc00: 6f75 725f 6b77 6172 6773 2e73 6574 6465  our_kwargs.setde
+0002cc10: 6661 756c 7428 226d 6172 6b65 7273 697a  fault("markersiz
+0002cc20: 6522 2c20 3720 2a20 6e70 2e73 7172 7428  e", 7 * np.sqrt(
+0002cc30: 6c69 6e65 7769 6474 6829 290a 2020 2020  linewidth)).    
+0002cc40: 2020 2020 2020 2020 636f 6e74 6f75 725f          contour_
+0002cc50: 6b77 6172 6773 2e73 6574 6465 6661 756c  kwargs.setdefaul
+0002cc60: 7428 226d 6172 6b65 7265 6467 6577 6964  t("markeredgewid
+0002cc70: 7468 222c 206e 702e 7371 7274 286c 696e  th", np.sqrt(lin
+0002cc80: 6577 6964 7468 2929 0a0a 2020 2020 2020  ewidth))..      
+0002cc90: 2020 2320 506c 6f74 2061 206d 6173 6b0a    # Plot a mask.
+0002cca0: 2020 2020 2020 2020 6966 2070 6c6f 745f          if plot_
+0002ccb0: 7479 7065 203d 3d20 226d 6173 6b22 3a0a  type == "mask":.
+0002ccc0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0002ccd0: 2e5f 706c 6f74 5f6d 6173 6b28 0a20 2020  ._plot_mask(.   
+0002cce0: 2020 2020 2020 2020 2020 2020 2076 6965               vie
+0002ccf0: 772c 0a20 2020 2020 2020 2020 2020 2020  w,.             
+0002cd00: 2020 2069 6478 2c0a 2020 2020 2020 2020     idx,.        
+0002cd10: 2020 2020 2020 2020 6d61 736b 5f6b 7761          mask_kwa
+0002cd20: 7267 732c 0a20 2020 2020 2020 2020 2020  rgs,.           
+0002cd30: 2020 2020 206f 7061 6369 7479 2c0a 2020       opacity,.  
+0002cd40: 2020 2020 2020 2020 2020 2020 2020 7a6f                zo
+0002cd50: 6f6d 3d7a 6f6f 6d2c 0a20 2020 2020 2020  om=zoom,.       
+0002cd60: 2020 2020 2020 2020 207a 6f6f 6d5f 6365           zoom_ce
+0002cd70: 6e74 7265 3d7a 6f6f 6d5f 6365 6e74 7265  ntre=zoom_centre
+0002cd80: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0002cd90: 2020 7368 6f77 3d46 616c 7365 2c0a 2020    show=False,.  
+0002cda0: 2020 2020 2020 2020 2020 2020 2020 696e                in
+0002cdb0: 636c 7564 655f 696d 6167 653d 696e 636c  clude_image=incl
+0002cdc0: 7564 655f 696d 6167 652c 0a20 2020 2020  ude_image,.     
+0002cdd0: 2020 2020 2020 2020 2020 2063 6f6c 6f72             color
+0002cde0: 3d63 6f6c 6f72 2c0a 2020 2020 2020 2020  =color,.        
+0002cdf0: 2020 2020 2020 2020 2a2a 6b77 6172 6773          **kwargs
+0002ce00: 2c0a 2020 2020 2020 2020 2020 2020 290a  ,.            ).
+0002ce10: 0a20 2020 2020 2020 2023 2050 6c6f 7420  .        # Plot 
+0002ce20: 6120 636f 6e74 6f75 720a 2020 2020 2020  a contour.      
+0002ce30: 2020 656c 6966 2070 6c6f 745f 7479 7065    elif plot_type
+0002ce40: 2069 6e20 5b22 636f 6e74 6f75 7222 2c20   in ["contour", 
+0002ce50: 2263 656e 7472 6f69 6422 5d3a 0a20 2020  "centroid"]:.   
+0002ce60: 2020 2020 2020 2020 2073 656c 662e 5f70           self._p
+0002ce70: 6c6f 745f 636f 6e74 6f75 7228 0a20 2020  lot_contour(.   
+0002ce80: 2020 2020 2020 2020 2020 2020 2076 6965               vie
+0002ce90: 772c 0a20 2020 2020 2020 2020 2020 2020  w,.             
+0002cea0: 2020 2069 6478 2c0a 2020 2020 2020 2020     idx,.        
+0002ceb0: 2020 2020 2020 2020 636f 6e74 6f75 725f          contour_
+0002cec0: 6b77 6172 6773 2c0a 2020 2020 2020 2020  kwargs,.        
+0002ced0: 2020 2020 2020 2020 6c69 6e65 7769 6474          linewidt
+0002cee0: 682c 0a20 2020 2020 2020 2020 2020 2020  h,.             
+0002cef0: 2020 2063 656e 7472 6f69 643d 7368 6f77     centroid=show
+0002cf00: 5f63 656e 7472 6f69 642c 0a20 2020 2020  _centroid,.     
+0002cf10: 2020 2020 2020 2020 2020 207a 6f6f 6d3d             zoom=
+0002cf20: 7a6f 6f6d 2c0a 2020 2020 2020 2020 2020  zoom,.          
+0002cf30: 2020 2020 2020 7a6f 6f6d 5f63 656e 7472        zoom_centr
+0002cf40: 653d 7a6f 6f6d 5f63 656e 7472 652c 0a20  e=zoom_centre,. 
+0002cf50: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+0002cf60: 6f6c 6f72 3d63 6f6c 6f72 2c0a 2020 2020  olor=color,.    
+0002cf70: 2020 2020 2020 2020 2020 2020 7368 6f77              show
+0002cf80: 3d46 616c 7365 2c0a 2020 2020 2020 2020  =False,.        
+0002cf90: 2020 2020 2020 2020 696e 636c 7564 655f          include_
+0002cfa0: 696d 6167 653d 696e 636c 7564 655f 696d  image=include_im
+0002cfb0: 6167 652c 0a20 2020 2020 2020 2020 2020  age,.           
+0002cfc0: 2020 2020 202a 2a6b 7761 7267 732c 0a20       **kwargs,. 
+0002cfd0: 2020 2020 2020 2020 2020 2029 0a0a 2020             )..  
+0002cfe0: 2020 2020 2020 2320 506c 6f74 2074 7261        # Plot tra
+0002cff0: 6e73 7061 7265 6e74 206d 6173 6b20 2b20  nsparent mask + 
+0002d000: 636f 6e74 6f75 720a 2020 2020 2020 2020  contour.        
+0002d010: 656c 6966 2022 6669 6c6c 6564 2220 696e  elif "filled" in
+0002d020: 2070 6c6f 745f 7479 7065 3a0a 2020 2020   plot_type:.    
+0002d030: 2020 2020 2020 2020 6966 206f 7061 6369          if opaci
+0002d040: 7479 2069 7320 4e6f 6e65 3a0a 2020 2020  ty is None:.    
+0002d050: 2020 2020 2020 2020 2020 2020 6f70 6163              opac
+0002d060: 6974 7920 3d20 302e 330a 2020 2020 2020  ity = 0.3.      
+0002d070: 2020 2020 2020 7365 6c66 2e5f 706c 6f74        self._plot
+0002d080: 5f6d 6173 6b28 7669 6577 2c20 6964 782c  _mask(view, idx,
+0002d090: 206d 6173 6b5f 6b77 6172 6773 2c20 6f70   mask_kwargs, op
+0002d0a0: 6163 6974 792c 2063 6f6c 6f72 3d63 6f6c  acity, color=col
+0002d0b0: 6f72 2c0a 2020 2020 2020 2020 2020 2020  or,.            
+0002d0c0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0002d0d0: 686f 773d 4661 6c73 652c 2069 6e63 6c75  how=False, inclu
+0002d0e0: 6465 5f69 6d61 6765 3d69 6e63 6c75 6465  de_image=include
+0002d0f0: 5f69 6d61 6765 2c20 2a2a 6b77 6172 6773  _image, **kwargs
+0002d100: 290a 2020 2020 2020 2020 2020 2020 6b77  ).            kw
+0002d110: 6172 6773 5b22 6178 225d 203d 2073 656c  args["ax"] = sel
+0002d120: 662e 6178 0a20 2020 2020 2020 2020 2020  f.ax.           
+0002d130: 2073 656c 662e 5f70 6c6f 745f 636f 6e74   self._plot_cont
+0002d140: 6f75 7228 0a20 2020 2020 2020 2020 2020  our(.           
+0002d150: 2020 2020 2076 6965 772c 0a20 2020 2020       view,.     
+0002d160: 2020 2020 2020 2020 2020 2069 6478 2c0a             idx,.
+0002d170: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002d180: 636f 6e74 6f75 725f 6b77 6172 6773 2c0a  contour_kwargs,.
+0002d190: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002d1a0: 6c69 6e65 7769 6474 682c 0a20 2020 2020  linewidth,.     
+0002d1b0: 2020 2020 2020 2020 2020 2063 656e 7472             centr
+0002d1c0: 6f69 643d 7368 6f77 5f63 656e 7472 6f69  oid=show_centroi
+0002d1d0: 642c 0a20 2020 2020 2020 2020 2020 2020  d,.             
+0002d1e0: 2020 207a 6f6f 6d3d 7a6f 6f6d 2c0a 2020     zoom=zoom,.  
+0002d1f0: 2020 2020 2020 2020 2020 2020 2020 7a6f                zo
+0002d200: 6f6d 5f63 656e 7472 653d 7a6f 6f6d 5f63  om_centre=zoom_c
+0002d210: 656e 7472 652c 0a20 2020 2020 2020 2020  entre,.         
+0002d220: 2020 2020 2020 2063 6f6c 6f72 3d63 6f6c         color=col
+0002d230: 6f72 2c0a 2020 2020 2020 2020 2020 2020  or,.            
+0002d240: 2020 2020 7368 6f77 3d46 616c 7365 2c0a      show=False,.
+0002d250: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002d260: 696e 636c 7564 655f 696d 6167 653d 4661  include_image=Fa
+0002d270: 6c73 652c 0a20 2020 2020 2020 2020 2020  lse,.           
+0002d280: 2020 2020 202a 2a6b 7761 7267 732c 0a20       **kwargs,. 
+0002d290: 2020 2020 2020 2020 2020 2029 0a0a 2020             )..  
+0002d2a0: 2020 2020 2020 2320 4368 6563 6b20 7768        # Check wh
+0002d2b0: 6574 6865 7220 7920 6178 6973 206e 6565  ether y axis nee
+0002d2c0: 6473 2074 6f20 6265 2069 6e76 6572 7465  ds to be inverte
+0002d2d0: 640a 2020 2020 2020 2020 6966 2076 6965  d.        if vie
+0002d2e0: 7720 3d3d 2022 782d 7922 2061 6e64 2073  w == "x-y" and s
+0002d2f0: 656c 662e 6178 2e67 6574 5f79 6c69 6d28  elf.ax.get_ylim(
+0002d300: 295b 315d 203e 2073 656c 662e 6178 2e67  )[1] > self.ax.g
+0002d310: 6574 5f79 6c69 6d28 295b 305d 3a0a 2020  et_ylim()[0]:.  
+0002d320: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
+0002d330: 782e 696e 7665 7274 5f79 6178 6973 2829  x.invert_yaxis()
+0002d340: 0a0a 2020 2020 2020 2020 2320 4472 6177  ..        # Draw
+0002d350: 206c 6567 656e 640a 2020 2020 2020 2020   legend.        
+0002d360: 6c65 6765 6e64 203d 206b 7761 7267 732e  legend = kwargs.
+0002d370: 6765 7428 226c 6567 656e 6422 2c20 4661  get("legend", Fa
+0002d380: 6c73 6529 0a20 2020 2020 2020 2069 6620  lse).        if 
+0002d390: 6c65 6765 6e64 3a0a 2020 2020 2020 2020  legend:.        
+0002d3a0: 2020 2020 6e61 6d65 203d 206b 7761 7267      name = kwarg
+0002d3b0: 732e 6765 7428 226e 616d 6522 2c20 7365  s.get("name", se
+0002d3c0: 6c66 2e6e 616d 6529 0a20 2020 2020 2020  lf.name).       
+0002d3d0: 2020 2020 2072 6f69 5f68 616e 646c 6520       roi_handle 
+0002d3e0: 3d20 7365 6c66 2e67 6574 5f70 6174 6368  = self.get_patch
+0002d3f0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+0002d400: 2020 2020 2020 706c 6f74 5f74 7970 652c        plot_type,
+0002d410: 2063 6f6c 6f72 2c20 6f70 6163 6974 792c   color, opacity,
+0002d420: 206c 696e 6577 6964 7468 2c20 6e61 6d65   linewidth, name
+0002d430: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
+0002d440: 2072 6f69 5f68 616e 646c 653a 0a20 2020   roi_handle:.   
+0002d450: 2020 2020 2020 2020 2020 2020 2062 626f               bbo
+0002d460: 785f 746f 5f61 6e63 686f 7220 3d20 6b77  x_to_anchor = kw
+0002d470: 6172 6773 2e67 6574 2822 6c65 6765 6e64  args.get("legend
+0002d480: 5f62 626f 785f 746f 5f61 6e63 686f 7222  _bbox_to_anchor"
+0002d490: 2c20 4e6f 6e65 290a 2020 2020 2020 2020  , None).        
+0002d4a0: 2020 2020 2020 2020 6c6f 6320 3d20 6b77          loc = kw
+0002d4b0: 6172 6773 2e67 6574 2822 6c65 6765 6e64  args.get("legend
+0002d4c0: 5f6c 6f63 222c 2022 6c6f 7765 7220 6c65  _loc", "lower le
+0002d4d0: 6674 2229 0a0a 2020 2020 2020 2020 2020  ft")..          
+0002d4e0: 2020 2020 2020 7365 6c66 2e61 782e 6c65        self.ax.le
+0002d4f0: 6765 6e64 2868 616e 646c 6573 3d5b 726f  gend(handles=[ro
+0002d500: 695f 6861 6e64 6c65 5d2c 0a20 2020 2020  i_handle],.     
+0002d510: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002d520: 2020 2062 626f 785f 746f 5f61 6e63 686f     bbox_to_ancho
+0002d530: 723d 6262 6f78 5f74 6f5f 616e 6368 6f72  r=bbox_to_anchor
+0002d540: 2c20 6c6f 633d 6c6f 632c 0a20 2020 2020  , loc=loc,.     
+0002d550: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002d560: 2020 2066 6163 6563 6f6c 6f72 3d22 7768     facecolor="wh
+0002d570: 6974 6522 2c20 6672 616d 6561 6c70 6861  ite", framealpha
+0002d580: 3d31 0a20 2020 2020 2020 2020 2020 2020  =1.             
+0002d590: 2020 2020 2020 2020 2020 2029 0a0a 2020             )..  
+0002d5a0: 2020 2020 2020 2320 4469 7370 6c61 7920        # Display 
+0002d5b0: 696d 6167 650a 0a20 2020 2020 2020 2070  image..        p
+0002d5c0: 6c74 2e74 6967 6874 5f6c 6179 6f75 7428  lt.tight_layout(
+0002d5d0: 290a 2020 2020 2020 2020 6966 2073 686f  ).        if sho
+0002d5e0: 773a 0a20 2020 2020 2020 2020 2020 2070  w:.            p
+0002d5f0: 6c74 2e73 686f 7728 290a 0a20 2020 2020  lt.show()..     
+0002d600: 2020 2023 2053 6176 6520 746f 2066 696c     # Save to fil
+0002d610: 650a 2020 2020 2020 2020 6966 2073 6176  e.        if sav
+0002d620: 655f 6173 3a0a 2020 2020 2020 2020 2020  e_as:.          
+0002d630: 2020 7365 6c66 2e66 6967 2e73 6176 6566    self.fig.savef
+0002d640: 6967 2873 6176 655f 6173 290a 2020 2020  ig(save_as).    
+0002d650: 2020 2020 2020 2020 706c 742e 636c 6f73          plt.clos
+0002d660: 6528 290a 0a20 2020 2064 6566 2067 6574  e()..    def get
+0002d670: 5f64 756d 6d79 5f69 6d61 6765 2873 656c  _dummy_image(sel
+0002d680: 662c 202a 2a6b 7761 7267 7329 3a0a 2020  f, **kwargs):.  
+0002d690: 2020 2020 2020 2222 224d 616b 6520 6120        """Make a 
+0002d6a0: 6475 6d6d 7920 696d 6167 6520 7468 6174  dummy image that
+0002d6b0: 2063 6f76 6572 7320 7468 6520 6172 6561   covers the area
+0002d6c0: 2073 7061 6e6e 6564 2062 7920 7468 6973   spanned by this
+0002d6d0: 2052 4f49 2e20 0a20 2020 2020 2020 2052   ROI. .        R
+0002d6e0: 6574 7572 6e73 2061 6e20 496d 6167 6520  eturns an Image 
+0002d6f0: 6f62 6a65 6374 2e0a 0a20 2020 2020 2020  object...       
+0002d700: 202a 2a50 6172 616d 6574 6572 733a 2a2a   **Parameters:**
+0002d710: 0a20 2020 2020 2020 200a 2020 2020 2020  .        .      
+0002d720: 2020 766f 7865 6c5f 7369 7a65 203a 206c    voxel_size : l
+0002d730: 6973 742c 2064 6566 6175 6c74 3d4e 6f6e  ist, default=Non
+0002d740: 650a 2020 2020 2020 2020 2020 2020 566f  e.            Vo
+0002d750: 7865 6c20 7369 7a65 2069 6e20 6d6d 2069  xel size in mm i
+0002d760: 6e20 7468 6520 6475 6d6d 7920 696d 6167  n the dummy imag
+0002d770: 6520 696e 2074 6865 2078 2d79 2070 6c61  e in the x-y pla
+0002d780: 6e65 2c20 6769 7665 6e20 6173 200a 2020  ne, given as .  
+0002d790: 2020 2020 2020 2020 2020 5b76 782c 2076            [vx, v
+0002d7a0: 795d 2e20 4966 203c 7368 6170 653e 2061  y]. If <shape> a
+0002d7b0: 6e64 203c 766f 7865 6c5f 7369 7a65 3e20  nd <voxel_size> 
+0002d7c0: 6172 6520 626f 7468 204e 6f6e 652c 2076  are both None, v
+0002d7d0: 6f78 656c 2073 697a 6573 206f 660a 2020  oxel sizes of.  
+0002d7e0: 2020 2020 2020 2020 2020 5b31 2c20 315d            [1, 1]
+0002d7f0: 2077 696c 6c20 6265 2075 7365 6420 6279   will be used by
+0002d800: 2064 6566 6175 6c74 2e20 5468 6520 766f   default. The vo
+0002d810: 7865 6c20 7369 7a65 2069 6e20 7468 6520  xel size in the 
+0002d820: 7a20 6469 7265 6374 696f 6e20 0a20 2020  z direction .   
+0002d830: 2020 2020 2020 2020 2069 7320 6465 6669           is defi
+0002d840: 6e65 6420 6279 203c 736c 6963 655f 7468  ned by <slice_th
+0002d850: 6963 6b6e 6573 733e 2e0a 0a20 2020 2020  ickness>...     
+0002d860: 2020 2073 6861 7065 203a 206c 6973 742c     shape : list,
+0002d870: 2064 6566 6175 6c74 3d4e 6f6e 650a 2020   default=None.  
+0002d880: 2020 2020 2020 2020 2020 4e75 6d62 6572            Number
+0002d890: 206f 6620 766f 7865 6c73 2069 6e20 7468   of voxels in th
+0002d8a0: 6520 6475 6d6d 7920 696d 6167 6520 696e  e dummy image in
+0002d8b0: 2074 6865 2078 2d79 2070 6c61 6e65 2c20   the x-y plane, 
+0002d8c0: 6769 7665 6e20 6173 0a20 2020 2020 2020  given as.       
+0002d8d0: 2020 2020 205b 6e78 2c20 6e79 5d2e 204f       [nx, ny]. O
+0002d8e0: 6e6c 7920 7573 6564 2069 6620 3c76 6f78  nly used if <vox
+0002d8f0: 656c 5f73 697a 653e 2069 7320 4e6f 6e65  el_size> is None
+0002d900: 2e20 0a20 2020 2020 2020 2020 2020 2054  . .            T
+0002d910: 6865 206e 756d 6265 7220 6f66 2076 6f78  he number of vox
+0002d920: 656c 7320 696e 2074 6865 207a 2064 6972  els in the z dir
+0002d930: 6563 7469 6f6e 2077 696c 6c20 6265 2074  ection will be t
+0002d940: 616b 656e 2066 726f 6d20 7468 6520 0a20  aken from the . 
+0002d950: 2020 2020 2020 2020 2020 206e 756d 6265             numbe
+0002d960: 7220 6f66 2073 6c69 6365 7320 696e 2074  r of slices in t
+0002d970: 6865 2078 2d79 2063 6f6e 746f 7572 7320  he x-y contours 
+0002d980: 6469 6374 696f 6e61 7279 2e0a 0a20 2020  dictionary...   
+0002d990: 2020 2020 2066 696c 6c5f 7661 6c20 3a20       fill_val : 
+0002d9a0: 696e 742f 666c 6f61 742c 2064 6566 6175  int/float, defau
+0002d9b0: 6c74 3d31 6534 0a20 2020 2020 2020 2020  lt=1e4.         
+0002d9c0: 2020 2056 616c 7565 2077 6974 6820 7768     Value with wh
+0002d9d0: 6963 6820 7468 6520 766f 7865 6c73 2069  ich the voxels i
+0002d9e0: 6e20 7468 6520 6475 6d6d 7920 696d 6167  n the dummy imag
+0002d9f0: 6520 7368 6f75 6c64 2062 6520 6669 6c6c  e should be fill
+0002da00: 6564 2e20 0a0a 2020 2020 2020 2020 6275  ed. ..        bu
+0002da10: 6666 6572 203a 2069 6e74 2c20 6465 6661  ffer : int, defa
+0002da20: 756c 743d 310a 2020 2020 2020 2020 2020  ult=1.          
+0002da30: 2020 4e75 6d62 6572 206f 6620 656d 7074    Number of empt
+0002da40: 7920 6275 6666 6572 2076 6f78 656c 7320  y buffer voxels 
+0002da50: 746f 2061 6464 206f 7574 7369 6465 2074  to add outside t
+0002da60: 6865 2052 4f49 2069 6e20 6561 6368 0a20  he ROI in each. 
+0002da70: 2020 2020 2020 2020 2020 2064 6972 6563             direc
+0002da80: 7469 6f6e 2e0a 0a20 2020 2020 2020 2073  tion...        s
+0002da90: 6c69 6365 5f74 6869 636b 6e65 7373 203a  lice_thickness :
+0002daa0: 2066 6c6f 6174 2c20 6465 6661 756c 743d   float, default=
+0002dab0: 4e6f 6e65 0a20 2020 2020 2020 2020 2020  None.           
+0002dac0: 2056 6f78 656c 2073 697a 6520 696e 206d   Voxel size in m
+0002dad0: 6d20 696e 2074 6865 2064 756d 6d79 2069  m in the dummy i
+0002dae0: 6d61 6765 2069 6e20 7468 6520 7a20 6469  mage in the z di
+0002daf0: 7265 6374 696f 6e2e 2020 4966 204e 6f6e  rection.  If Non
+0002db00: 652c 0a20 2020 2020 2020 2020 2020 2074  e,.            t
+0002db10: 6865 2076 616c 7565 2075 7365 6420 6973  he value used is
+0002db20: 2074 6865 206d 696e 696d 756d 2064 6973   the minimum dis
+0002db30: 7461 6e63 6520 6265 7477 6565 6e20 736c  tance between sl
+0002db40: 6963 6520 706f 7369 7469 6f6e 730a 2020  ice positions.  
+0002db50: 2020 2020 2020 2020 2020 696e 2074 6865            in the
+0002db60: 2078 2d79 2063 6f6e 746f 7572 7320 6469   x-y contours di
+0002db70: 6374 696f 6e61 7279 2e0a 2020 2020 2020  ctionary..      
+0002db80: 2020 2222 220a 0a20 2020 2020 2020 2065    """..        e
+0002db90: 7874 656e 7473 203d 205b 7365 6c66 2e67  xtents = [self.g
+0002dba0: 6574 5f65 7874 656e 7428 6178 3d61 7829  et_extent(ax=ax)
+0002dbb0: 2066 6f72 2061 7820 696e 2073 6b72 742e   for ax in skrt.
+0002dbc0: 696d 6167 652e 5f61 7865 735d 0a20 2020  image._axes].   
+0002dbd0: 2020 2020 2073 6c69 6365 5f74 6869 636b       slice_thick
+0002dbe0: 6e65 7373 203d 206b 7761 7267 732e 706f  ness = kwargs.po
+0002dbf0: 7028 2273 6c69 6365 5f74 6869 636b 6e65  p("slice_thickne
+0002dc00: 7373 222c 204e 6f6e 6529 0a20 2020 2020  ss", None).     
+0002dc10: 2020 2073 6c69 6365 5f74 6869 636b 6e65     slice_thickne
+0002dc20: 7373 203d 2028 736c 6963 655f 7468 6963  ss = (slice_thic
+0002dc30: 6b6e 6573 7320 6f72 0a20 2020 2020 2020  kness or.       
+0002dc40: 2020 2020 2020 2020 2073 656c 662e 6765           self.ge
+0002dc50: 745f 736c 6963 655f 7468 6963 6b6e 6573  t_slice_thicknes
+0002dc60: 735f 636f 6e74 6f75 7273 2829 290a 2020  s_contours()).  
+0002dc70: 2020 2020 2020 7265 7475 726e 2063 7265        return cre
+0002dc80: 6174 655f 6475 6d6d 795f 696d 6167 6528  ate_dummy_image(
+0002dc90: 6578 7465 6e74 732c 2073 6c69 6365 5f74  extents, slice_t
+0002dca0: 6869 636b 6e65 7373 2c20 2a2a 6b77 6172  hickness, **kwar
+0002dcb0: 6773 290a 0a20 2020 2064 6566 2073 6574  gs)..    def set
+0002dcc0: 5f69 6d61 6765 5f74 6f5f 6475 6d6d 7928  _image_to_dummy(
+0002dcd0: 7365 6c66 2c20 2a2a 6b77 6172 6773 293a  self, **kwargs):
+0002dce0: 0a20 2020 2020 2020 2022 2222 4173 7369  .        """Assi
+0002dcf0: 676e 2073 656c 662e 696d 6167 6520 7072  gn self.image pr
+0002dd00: 6f70 6572 7479 2074 6f20 6120 6475 6d6d  operty to a dumm
+0002dd10: 7920 696d 6167 6520 636f 7665 7269 6e67  y image covering
+0002dd20: 2074 6865 2061 7265 6120 0a20 2020 2020   the area .     
+0002dd30: 2020 2073 7061 6e6e 6564 2062 7920 7468     spanned by th
+0002dd40: 6973 2052 4f49 2e20 5468 6520 524f 4927  is ROI. The ROI'
+0002dd50: 7320 6d61 736b 2061 6e64 2078 2d7a 2f79  s mask and x-z/y
+0002dd60: 2d7a 2063 6f6e 746f 7572 7320 7769 6c6c  -z contours will
+0002dd70: 2062 6520 0a20 2020 2020 2020 2063 6c65   be .        cle
+0002dd80: 6172 6564 2073 6f20 7468 6174 2074 6865  ared so that the
+0002dd90: 7920 7769 6c6c 2062 6520 7265 6372 6561  y will be recrea
+0002dda0: 7465 6420 7768 656e 2067 6574 5f6d 6173  ted when get_mas
+0002ddb0: 6b28 2920 6f72 2067 6574 5f63 6f6e 746f  k() or get_conto
+0002ddc0: 7572 7328 290a 2020 2020 2020 2020 6172  urs().        ar
+0002ddd0: 6520 6e65 7874 2063 616c 6c65 642e 0a0a  e next called...
+0002dde0: 2020 2020 2020 2020 2a2a 5061 7261 6d65          **Parame
+0002ddf0: 7465 7273 3a2a 2a0a 2020 2020 2020 2020  ters:**.        
+0002de00: 0a20 2020 2020 2020 206b 7761 7267 7320  .        kwargs 
+0002de10: 3a20 0a20 2020 2020 2020 2020 2020 204b  : .            K
+0002de20: 6579 776f 7264 2061 7267 756d 656e 7473  eyword arguments
+0002de30: 2074 6f20 7061 7373 2074 6f20 7365 6c66   to pass to self
+0002de40: 2e67 6574 5f64 756d 6d79 5f69 6d61 6765  .get_dummy_image
+0002de50: 2829 2077 6865 6e20 6372 6561 7469 6e67  () when creating
+0002de60: 0a20 2020 2020 2020 2020 2020 2074 6865  .            the
+0002de70: 2064 756d 6d79 2069 6d61 6765 2e20 5365   dummy image. Se
+0002de80: 6520 646f 6375 6d65 6e74 6174 696f 6e20  e documentation 
+0002de90: 6f66 2052 4f49 2e67 6574 5f64 756d 6d79  of ROI.get_dummy
+0002dea0: 5f69 6d61 6765 2829 2e0a 2020 2020 2020  _image()..      
+0002deb0: 2020 2222 220a 0a20 2020 2020 2020 2023    """..        #
+0002dec0: 204d 616b 6520 696d 6167 650a 2020 2020   Make image.    
+0002ded0: 2020 2020 696d 203d 2073 656c 662e 6765      im = self.ge
+0002dee0: 745f 6475 6d6d 795f 696d 6167 6528 2a2a  t_dummy_image(**
+0002def0: 6b77 6172 6773 290a 0a20 2020 2020 2020  kwargs)..       
+0002df00: 2023 2043 6c65 6172 206d 6173 6b20 616e   # Clear mask an
+0002df10: 6420 636f 6e74 6f75 7273 0a20 2020 2020  d contours.     
+0002df20: 2020 2073 656c 662e 696e 7075 745f 636f     self.input_co
+0002df30: 6e74 6f75 7273 203d 2073 656c 662e 636f  ntours = self.co
+0002df40: 6e74 6f75 7273 5b22 782d 7922 5d0a 2020  ntours["x-y"].  
+0002df50: 2020 2020 2020 7365 6c66 2e63 6f6e 746f        self.conto
+0002df60: 7572 7320 3d20 7b22 782d 7922 3a20 7365  urs = {"x-y": se
+0002df70: 6c66 2e69 6e70 7574 5f63 6f6e 746f 7572  lf.input_contour
+0002df80: 737d 0a20 2020 2020 2020 2073 656c 662e  s}.        self.
+0002df90: 6c6f 6164 6564 5f6d 6173 6b20 3d20 4661  loaded_mask = Fa
+0002dfa0: 6c73 650a 2020 2020 2020 2020 7365 6c66  lse.        self
+0002dfb0: 2e6d 6173 6b20 3d20 4e6f 6e65 0a0a 2020  .mask = None..  
+0002dfc0: 2020 2020 2020 2320 4173 7369 676e 2069        # Assign i
+0002dfd0: 6d61 6765 0a20 2020 2020 2020 2073 656c  mage.        sel
+0002dfe0: 662e 7365 745f 696d 6167 6528 696d 290a  f.set_image(im).
+0002dff0: 0a20 2020 2064 6566 2073 6574 5f69 6d61  .    def set_ima
+0002e000: 6765 2873 656c 662c 2069 6d29 3a0a 2020  ge(self, im):.  
+0002e010: 2020 2020 2020 2222 2253 6574 2073 656c        """Set sel
+0002e020: 662e 696d 6167 6520 746f 2061 2067 6976  f.image to a giv
+0002e030: 656e 2069 6d61 6765 2061 6e64 2061 646a  en image and adj
+0002e040: 7573 7420 6765 6f6d 6574 7269 6320 7072  ust geometric pr
+0002e050: 6f70 6572 7469 6573 0a20 2020 2020 2020  operties.       
+0002e060: 2061 6363 6f72 6469 6e67 6c79 2e20 4e6f   accordingly. No
+0002e070: 7465 2074 6861 7420 7365 6c66 2e6d 6173  te that self.mas
+0002e080: 6b20 7769 6c6c 2062 6520 7265 6d6f 7665  k will be remove
+0002e090: 6420 6966 2074 6865 2063 7572 7265 6e74  d if the current
+0002e0a0: 206d 6173 6b27 7320 0a20 2020 2020 2020   mask's .       
+0002e0b0: 2073 6861 7065 2064 6f65 736e 2774 206d   shape doesn't m
+0002e0c0: 6174 6368 2074 6865 2069 6d61 6765 2e20  atch the image. 
+0002e0d0: 0a20 2020 2020 2020 2022 2222 0a0a 2020  .        """..  
+0002e0e0: 2020 2020 2020 7365 6c66 2e6c 6f61 6428        self.load(
+0002e0f0: 290a 2020 2020 2020 2020 7365 6c66 2e69  ).        self.i
+0002e100: 6d61 6765 203d 2069 6d0a 2020 2020 2020  mage = im.      
+0002e110: 2020 7365 6c66 2e63 6f6e 746f 7572 735f    self.contours_
+0002e120: 6f6e 6c79 203d 2046 616c 7365 0a20 2020  only = False.   
+0002e130: 2020 2020 2069 6620 696d 2069 7320 4e6f       if im is No
+0002e140: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+0002e150: 7265 7475 726e 0a0a 2020 2020 2020 2020  return..        
+0002e160: 2320 5365 7420 524f 4920 766f 7865 6c20  # Set ROI voxel 
+0002e170: 7369 7a65 2074 6f20 7468 6174 206f 6620  size to that of 
+0002e180: 6e65 7720 696d 6167 652e 0a20 2020 2020  new image..     
+0002e190: 2020 2023 2049 7420 7769 6c6c 2062 6520     # It will be 
+0002e1a0: 6e65 6564 6564 2074 6f20 6465 6669 6e65  needed to define
+0002e1b0: 2073 6c69 6365 2074 6869 636b 6e65 7373   slice thickness
+0002e1c0: 0a20 2020 2020 2020 2023 2069 6e20 7468  .        # in th
+0002e1d0: 6520 6361 7365 206f 6620 616e 2052 4f49  e case of an ROI
+0002e1e0: 2077 6974 6820 636f 6e74 6f75 7228 7329   with contour(s)
+0002e1f0: 2061 7420 6120 7369 6e67 6c65 207a 2d70   at a single z-p
+0002e200: 6f73 6974 696f 6e2e 0a20 2020 2020 2020  osition..       
+0002e210: 2073 656c 662e 766f 7865 6c5f 7369 7a65   self.voxel_size
+0002e220: 203d 2069 6d2e 6765 745f 766f 7865 6c5f   = im.get_voxel_
+0002e230: 7369 7a65 2829 0a0a 2020 2020 2020 2020  size()..        
+0002e240: 2320 4966 2074 6865 207a 2d64 6973 7461  # If the z-dista
+0002e250: 6e63 6520 6265 7477 6565 6e20 636f 6e74  nce between cont
+0002e260: 6f75 7273 2069 7320 6772 6561 7465 7220  ours is greater 
+0002e270: 7468 616e 2074 6865 2076 6f78 656c 0a20  than the voxel. 
+0002e280: 2020 2020 2020 2023 207a 2d64 696d 656e         # z-dimen
+0002e290: 7369 6f6e 2066 6f72 2074 6865 206e 6577  sion for the new
+0002e2a0: 2069 6d61 6765 2c20 6669 7273 7420 656e   image, first en
+0002e2b0: 7375 7265 2074 6861 7420 7468 6520 524f  sure that the RO
+0002e2c0: 490a 2020 2020 2020 2020 2320 6d61 736b  I.        # mask
+0002e2d0: 2069 7320 6372 6561 7465 6420 7769 7468   is created with
+0002e2e0: 2074 6865 2069 6e74 6572 2d63 6f6e 746f   the inter-conto
+0002e2f0: 7572 207a 2d64 6973 7461 6e63 652c 2074  ur z-distance, t
+0002e300: 6865 6e20 7265 7369 7a65 0a20 2020 2020  hen resize.     
+0002e310: 2020 2023 2074 6f20 7468 6520 696d 6167     # to the imag
+0002e320: 6520 766f 7865 6c20 7369 7a65 2e0a 2020  e voxel size..  
+0002e330: 2020 2020 2020 6966 2073 656c 662e 6765        if self.ge
+0002e340: 745f 736c 6963 655f 7468 6963 6b6e 6573  t_slice_thicknes
+0002e350: 735f 636f 6e74 6f75 7273 2829 203e 2073  s_contours() > s
+0002e360: 656c 662e 696d 6167 652e 6765 745f 766f  elf.image.get_vo
+0002e370: 7865 6c5f 7369 7a65 2829 5b32 5d3a 0a20  xel_size()[2]:. 
+0002e380: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
+0002e390: 7420 2873 656c 662e 6d61 736b 2061 6e64  t (self.mask and
+0002e3a0: 2028 7365 6c66 2e76 6f78 656c 5f73 697a   (self.voxel_siz
+0002e3b0: 6520 3d3d 2073 656c 662e 6d61 736b 2e76  e == self.mask.v
+0002e3c0: 6f78 656c 5f73 697a 6529 293a 0a20 2020  oxel_size)):.   
+0002e3d0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+0002e3e0: 662e 6372 6561 7465 5f6d 6173 6b28 766f  f.create_mask(vo
+0002e3f0: 7865 6c5f 7369 7a65 3d73 656c 662e 766f  xel_size=self.vo
+0002e400: 7865 6c5f 7369 7a65 5b30 3a32 5d2c 2066  xel_size[0:2], f
+0002e410: 6f72 6365 3d54 7275 6529 0a20 2020 2020  orce=True).     
+0002e420: 2020 2020 2020 2020 2020 2023 2054 6865             # The
+0002e430: 206d 6173 6b20 6372 6561 7469 6f6e 2077   mask creation w
+0002e440: 696c 6c20 6861 7665 2072 6564 6566 696e  ill have redefin
+0002e450: 6564 2074 6865 2069 6d61 6765 2061 7373  ed the image ass
+0002e460: 6f63 6961 7469 6f6e 2c0a 2020 2020 2020  ociation,.      
+0002e470: 2020 2020 2020 2020 2020 2320 736f 2072            # so r
+0002e480: 6561 7373 6967 6e20 7468 6520 6e65 7720  eassign the new 
+0002e490: 696d 6167 652e 0a20 2020 2020 2020 2020  image..         
+0002e4a0: 2020 2020 2020 2073 656c 662e 696d 6167         self.imag
+0002e4b0: 6520 3d20 696d 0a20 2020 2020 2020 2020  e = im.         
+0002e4c0: 2020 2073 656c 662e 6d61 736b 2e6d 6174     self.mask.mat
+0002e4d0: 6368 5f73 697a 6528 7365 6c66 2e69 6d61  ch_size(self.ima
+0002e4e0: 6765 2c20 6d65 7468 6f64 3d22 6e65 6172  ge, method="near
+0002e4f0: 6573 7422 290a 2020 2020 2020 2020 2020  est").          
+0002e500: 2020 6966 2068 6173 6174 7472 2873 656c    if hasattr(sel
+0002e510: 662e 6d61 736b 2c20 2264 6174 6122 293a  f.mask, "data"):
+0002e520: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002e530: 2069 6620 6e6f 7420 7365 6c66 2e6d 6173   if not self.mas
+0002e540: 6b2e 6461 7461 2e64 7479 7065 203d 3d20  k.data.dtype == 
+0002e550: 626f 6f6c 3a0a 2020 2020 2020 2020 2020  bool:.          
+0002e560: 2020 2020 2020 2020 2020 7365 6c66 2e6d            self.m
+0002e570: 6173 6b2e 6461 7461 203d 2073 656c 662e  ask.data = self.
+0002e580: 6d61 736b 2e64 6174 612e 6173 7479 7065  mask.data.astype
+0002e590: 2862 6f6f 6c29 0a0a 2020 2020 2020 2020  (bool)..        
+0002e5a0: 2320 4966 2061 206d 6173 6b20 6861 7320  # If a mask has 
+0002e5b0: 6265 656e 206c 6f61 6465 642c 2062 7574  been loaded, but
+0002e5c0: 2064 6f65 736e 2774 206d 6174 6368 2074   doesn't match t
+0002e5d0: 6865 2069 6d61 6765 2067 656f 6d65 7472  he image geometr
+0002e5e0: 792c 0a20 2020 2020 2020 2023 2064 656c  y,.        # del
+0002e5f0: 6574 6520 7468 6520 6d61 736b 2064 6174  ete the mask dat
+0002e600: 612e 2020 2854 6869 7320 7368 6f75 6c64  a.  (This should
+0002e610: 206d 6561 6e20 7468 6174 2074 6865 207a   mean that the z
+0002e620: 2d64 6973 7461 6e63 650a 2020 2020 2020  -distance.      
+0002e630: 2020 2320 6265 7477 6565 6e20 636f 6e74    # between cont
+0002e640: 6f75 7273 2069 7320 6c65 7373 2074 6861  ours is less tha
+0002e650: 7420 7468 6520 766f 7865 6c20 7a2d 6469  t the voxel z-di
+0002e660: 6d65 6e73 696f 6e20 666f 7220 7468 650a  mension for the.
+0002e670: 2020 2020 2020 2020 2320 6e65 7720 696d          # new im
+0002e680: 6167 652e 2920 2041 206e 6577 206d 6173  age.)  A new mas
+0002e690: 6b20 7769 6c6c 2062 6520 6372 6561 7465  k will be create
+0002e6a0: 6420 6174 2074 6865 206e 6578 7420 6361  d at the next ca
+0002e6b0: 6c6c 0a20 2020 2020 2020 2023 2074 6f20  ll.        # to 
+0002e6c0: 6163 6365 7373 2074 6865 206d 6173 6b20  access the mask 
+0002e6d0: 6461 7461 2e0a 2020 2020 2020 2020 6966  data..        if
+0002e6e0: 2073 656c 662e 6d61 736b 2061 6e64 206e   self.mask and n
+0002e6f0: 6f74 2069 6d2e 6861 735f 7361 6d65 5f67  ot im.has_same_g
+0002e700: 656f 6d65 7472 7928 7365 6c66 2e6d 6173  eometry(self.mas
+0002e710: 6b29 3a0a 2020 2020 2020 2020 2020 2020  k):.            
+0002e720: 6966 2067 6574 6174 7472 2873 656c 662c  if getattr(self,
+0002e730: 2022 696e 7075 745f 636f 6e74 6f75 7273   "input_contours
+0002e740: 222c 204e 6f6e 6529 2069 7320 4e6f 6e65  ", None) is None
+0002e750: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0002e760: 2020 7365 6c66 2e69 6e70 7574 5f63 6f6e    self.input_con
+0002e770: 746f 7572 7320 3d20 7365 6c66 2e67 6574  tours = self.get
+0002e780: 5f63 6f6e 746f 7572 7328 2278 2d79 2229  _contours("x-y")
+0002e790: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+0002e7a0: 662e 6d61 736b 203d 204e 6f6e 650a 2020  f.mask = None.  
+0002e7b0: 2020 2020 2020 2020 2020 7365 6c66 2e6c            self.l
+0002e7c0: 6f61 6465 645f 6d61 736b 203d 2046 616c  oaded_mask = Fal
+0002e7d0: 7365 0a0a 2020 2020 2020 2020 2320 5365  se..        # Se
+0002e7e0: 7420 6765 6f65 6d74 7269 6320 696e 666f  t geoemtric info
+0002e7f0: 0a20 2020 2020 2020 2064 6174 615f 7368  .        data_sh
+0002e800: 6170 6520 3d20 696d 2e67 6574 5f64 6174  ape = im.get_dat
+0002e810: 6128 292e 7368 6170 650a 2020 2020 2020  a().shape.      
+0002e820: 2020 7365 6c66 2e73 6861 7065 203d 205b    self.shape = [
+0002e830: 6461 7461 5f73 6861 7065 5b31 5d2c 2064  data_shape[1], d
+0002e840: 6174 615f 7368 6170 655b 305d 2c20 6461  ata_shape[0], da
+0002e850: 7461 5f73 6861 7065 5b32 5d5d 0a20 2020  ta_shape[2]].   
+0002e860: 2020 2020 2073 656c 662e 766f 7865 6c5f       self.voxel_
+0002e870: 7369 7a65 203d 2069 6d2e 6765 745f 766f  size = im.get_vo
+0002e880: 7865 6c5f 7369 7a65 2829 0a20 2020 2020  xel_size().     
+0002e890: 2020 2073 656c 662e 6f72 6967 696e 203d     self.origin =
+0002e8a0: 2069 6d2e 6765 745f 6f72 6967 696e 2829   im.get_origin()
+0002e8b0: 0a20 2020 2020 2020 2073 656c 662e 6166  .        self.af
+0002e8c0: 6669 6e65 203d 2069 6d2e 6765 745f 6166  fine = im.get_af
+0002e8d0: 6669 6e65 2829 0a0a 2020 2020 6465 6620  fine()..    def 
+0002e8e0: 7669 6577 2873 656c 662c 2069 6e63 6c75  view(self, inclu
+0002e8f0: 6465 5f69 6d61 6765 3d46 616c 7365 2c20  de_image=False, 
+0002e900: 766f 7865 6c5f 7369 7a65 3d5b 312c 2031  voxel_size=[1, 1
+0002e910: 5d2c 2062 7566 6665 723d 352c 202a 2a6b  ], buffer=5, **k
+0002e920: 7761 7267 7329 3a0a 2020 2020 2020 2020  wargs):.        
+0002e930: 2222 2256 6965 7720 7468 6520 524f 492e  """View the ROI.
+0002e940: 0a0a 2020 2020 2020 2020 2a2a 5061 7261  ..        **Para
+0002e950: 6d65 7465 7273 3a2a 2a0a 2020 2020 2020  meters:**.      
+0002e960: 2020 0a20 2020 2020 2020 2069 6e63 6c75    .        inclu
+0002e970: 6465 5f69 6d61 6765 203a 2062 6f6f 6c2c  de_image : bool,
+0002e980: 2064 6566 6175 6c74 3d54 7275 650a 2020   default=True.  
+0002e990: 2020 2020 2020 2020 2020 4966 2054 7275            If Tru
+0002e9a0: 6520 616e 6420 7468 6973 2052 4f49 2068  e and this ROI h
+0002e9b0: 6173 2061 6e20 6173 736f 6369 6174 6564  as an associated
+0002e9c0: 2069 6d61 6765 2028 696e 2073 656c 662e   image (in self.
+0002e9d0: 696d 6167 6529 2c0a 2020 2020 2020 2020  image),.        
+0002e9e0: 2020 2020 7468 6520 696d 6167 6520 7769      the image wi
+0002e9f0: 6c6c 2062 6520 6469 7370 6c61 7965 6420  ll be displayed 
+0002ea00: 6265 6869 6e64 2074 6865 2052 4f49 2e0a  behind the ROI..
+0002ea10: 0a20 2020 2020 2020 2076 6f78 656c 5f73  .        voxel_s
+0002ea20: 697a 6520 3a20 6c69 7374 2c20 6465 6661  ize : list, defa
+0002ea30: 756c 743d 5b31 2c20 315d 0a20 2020 2020  ult=[1, 1].     
+0002ea40: 2020 2020 2020 2049 6620 7468 6520 524f         If the RO
+0002ea50: 4920 646f 6573 206e 6f74 2068 6176 6520  I does not have 
+0002ea60: 616e 2061 7373 6f63 6961 7465 6420 696d  an associated im
+0002ea70: 6167 6520 616e 6420 6973 2064 6573 6372  age and is descr
+0002ea80: 6962 6564 206f 6e6c 790a 2020 2020 2020  ibed only.      
+0002ea90: 2020 2020 2020 6279 2063 6f6e 746f 7572        by contour
+0002eaa0: 732c 2074 6869 7320 7769 6c6c 2062 6520  s, this will be 
+0002eab0: 7468 6520 766f 7865 6c20 7369 7a65 7320  the voxel sizes 
+0002eac0: 7573 6564 2069 6e20 7468 6520 782d 7920  used in the x-y 
+0002ead0: 6469 7265 6374 696f 6e0a 2020 2020 2020  direction.      
+0002eae0: 2020 2020 2020 7768 656e 2063 6f6e 7665        when conve
+0002eaf0: 7274 696e 6720 7468 6520 524f 4920 746f  rting the ROI to
+0002eb00: 2061 206d 6173 6b20 6966 2061 206d 6173   a mask if a mas
+0002eb10: 6b20 706c 6f74 2074 7970 6520 6973 2073  k plot type is s
+0002eb20: 656c 6563 7465 642e 0a0a 2020 2020 2020  elected...      
+0002eb30: 2020 6275 6666 6572 203a 2069 6e74 2c20    buffer : int, 
+0002eb40: 6465 6661 756c 743d 350a 2020 2020 2020  default=5.      
+0002eb50: 2020 2020 2020 4966 2074 6865 2052 4f49        If the ROI
+0002eb60: 2064 6f65 7320 6e6f 7420 6861 7665 2061   does not have a
+0002eb70: 6e20 6173 736f 6369 6174 6564 2069 6d61  n associated ima
+0002eb80: 6765 2061 6e64 2069 7320 6465 7363 7269  ge and is descri
+0002eb90: 6265 6420 6f6e 6c79 0a20 2020 2020 2020  bed only.       
+0002eba0: 2020 2020 2062 7920 636f 6e74 6f75 7273       by contours
+0002ebb0: 2c20 7468 6973 2077 696c 6c20 6265 2074  , this will be t
+0002ebc0: 6865 206e 756d 6265 7220 6f66 2062 7566  he number of buf
+0002ebd0: 6665 7220 766f 7865 6c73 200a 2020 2020  fer voxels .    
+0002ebe0: 2020 2020 2020 2020 2869 2e65 2e20 7768          (i.e. wh
+0002ebf0: 6974 6573 7061 6365 2920 6469 7370 6c61  itespace) displa
+0002ec00: 7965 6420 6172 6f75 6e64 2074 6865 2052  yed around the R
+0002ec10: 4f49 2e0a 2020 2020 2020 2020 2222 220a  OI..        """.
+0002ec20: 0a20 2020 2020 2020 2066 726f 6d20 736b  .        from sk
+0002ec30: 7274 2e62 6574 7465 725f 7669 6577 6572  rt.better_viewer
+0002ec40: 2069 6d70 6f72 7420 4265 7474 6572 5669   import BetterVi
+0002ec50: 6577 6572 0a20 2020 2020 2020 2073 656c  ewer.        sel
+0002ec60: 662e 6c6f 6164 2829 0a20 2020 2020 2020  f.load().       
+0002ec70: 200a 2020 2020 2020 2020 2320 5365 7420   .        # Set 
+0002ec80: 696e 6974 6961 6c20 7a6f 6f6d 2061 6d6f  initial zoom amo
+0002ec90: 756e 7420 616e 6420 6365 6e74 7265 0a20  unt and centre. 
+0002eca0: 2020 2020 2020 2069 6620 7365 6c66 2e69         if self.i
+0002ecb0: 6d61 6765 2069 7320 6e6f 7420 4e6f 6e65  mage is not None
+0002ecc0: 2061 6e64 206e 6f74 2073 656c 662e 636f   and not self.co
+0002ecd0: 6e74 6f75 7273 5f6f 6e6c 793a 0a20 2020  ntours_only:.   
+0002ece0: 2020 2020 2020 2020 2076 6965 7720 3d20           view = 
+0002ecf0: 6b77 6172 6773 2e67 6574 2822 696e 6974  kwargs.get("init
+0002ed00: 5f76 6965 7722 2c20 2278 2d79 2229 0a20  _view", "x-y"). 
+0002ed10: 2020 2020 2020 2020 2020 2061 7865 7320             axes 
+0002ed20: 3d20 736b 7274 2e69 6d61 6765 2e5f 706c  = skrt.image._pl
+0002ed30: 6f74 5f61 7865 735b 7669 6577 5d0a 2020  ot_axes[view].  
+0002ed40: 2020 2020 2020 2020 2020 6578 7465 6e74            extent
+0002ed50: 7320 3d20 5b73 656c 662e 6765 745f 6c65  s = [self.get_le
+0002ed60: 6e67 7468 2861 783d 6178 2920 666f 7220  ngth(ax=ax) for 
+0002ed70: 6178 2069 6e20 6178 6573 5d0a 2020 2020  ax in axes].    
+0002ed80: 2020 2020 2020 2020 696d 5f6c 696d 7320          im_lims 
+0002ed90: 3d20 5b73 656c 662e 696d 6167 652e 6765  = [self.image.ge
+0002eda0: 745f 6c65 6e67 7468 2861 783d 6178 2920  t_length(ax=ax) 
+0002edb0: 666f 7220 6178 2069 6e20 6178 6573 5d0a  for ax in axes].
+0002edc0: 2020 2020 2020 2020 2020 2020 7a6f 6f6d              zoom
+0002edd0: 203d 206d 696e 285b 696d 5f6c 696d 735b   = min([im_lims[
+0002ede0: 695d 202f 2065 7874 656e 7473 5b69 5d20  i] / extents[i] 
+0002edf0: 666f 7220 6920 696e 2072 616e 6765 2832  for i in range(2
+0002ee00: 295d 2920 2a20 302e 380a 2020 2020 2020  )]) * 0.8.      
+0002ee10: 2020 2020 2020 7a6f 6f6d 5f63 656e 7472        zoom_centr
+0002ee20: 6520 3d20 7365 6c66 2e67 6574 5f63 656e  e = self.get_cen
+0002ee30: 7472 6528 290a 2020 2020 2020 2020 2020  tre().          
+0002ee40: 2020 6966 207a 6f6f 6d20 3e20 313a 0a20    if zoom > 1:. 
+0002ee50: 2020 2020 2020 2020 2020 2020 2020 206b                 k
+0002ee60: 7761 7267 732e 7365 7464 6566 6175 6c74  wargs.setdefault
+0002ee70: 2822 7a6f 6f6d 222c 207a 6f6f 6d29 0a20  ("zoom", zoom). 
+0002ee80: 2020 2020 2020 2020 2020 2020 2020 206b                 k
+0002ee90: 7761 7267 732e 7365 7464 6566 6175 6c74  wargs.setdefault
+0002eea0: 2822 7a6f 6f6d 5f63 656e 7472 6522 2c20  ("zoom_centre", 
+0002eeb0: 7a6f 6f6d 5f63 656e 7472 6529 0a20 2020  zoom_centre).   
+0002eec0: 2020 2020 2020 2020 2069 6620 2269 6e69           if "ini
+0002eed0: 745f 706f 7322 206e 6f74 2069 6e20 6b77  t_pos" not in kw
+0002eee0: 6172 6773 2061 6e64 2022 696e 6974 5f73  args and "init_s
+0002eef0: 6c69 6365 2220 6e6f 7420 696e 206b 7761  lice" not in kwa
+0002ef00: 7267 733a 0a20 2020 2020 2020 2020 2020  rgs:.           
+0002ef10: 2020 2020 206b 7761 7267 735b 2269 6e69       kwargs["ini
+0002ef20: 745f 706f 7322 5d20 3d20 5c0a 2020 2020  t_pos"] = \.    
+0002ef30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002ef40: 2020 2020 7365 6c66 2e67 6574 5f63 656e      self.get_cen
+0002ef50: 7472 6528 295b 736b 7274 2e69 6d61 6765  tre()[skrt.image
+0002ef60: 2e5f 736c 6963 655f 6178 6573 5b76 6965  ._slice_axes[vie
+0002ef70: 775d 5d0a 0a20 2020 2020 2020 206b 7761  w]]..        kwa
+0002ef80: 7267 735b 2273 686f 7722 5d20 3d20 4661  rgs["show"] = Fa
+0002ef90: 6c73 650a 2020 2020 2020 2020 6966 2022  lse.        if "
+0002efa0: 706c 6f74 5f74 7970 6522 2069 6e20 6b77  plot_type" in kw
+0002efb0: 6172 6773 3a0a 2020 2020 2020 2020 2020  args:.          
+0002efc0: 2020 6b77 6172 6773 5b22 726f 695f 706c    kwargs["roi_pl
+0002efd0: 6f74 5f74 7970 6522 5d20 3d20 6b77 6172  ot_type"] = kwar
+0002efe0: 6773 2e70 6f70 2822 706c 6f74 5f74 7970  gs.pop("plot_typ
+0002eff0: 6522 290a 0a20 2020 2020 2020 2023 2056  e")..        # V
+0002f000: 6965 7720 7769 7468 2069 6d61 6765 0a20  iew with image. 
+0002f010: 2020 2020 2020 2069 6620 696e 636c 7564         if includ
+0002f020: 655f 696d 6167 6520 616e 6420 7365 6c66  e_image and self
+0002f030: 2e69 6d61 6765 2069 7320 6e6f 7420 4e6f  .image is not No
+0002f040: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+0002f050: 6276 203d 2042 6574 7465 7256 6965 7765  bv = BetterViewe
+0002f060: 7228 7365 6c66 2e69 6d61 6765 2c20 726f  r(self.image, ro
+0002f070: 6973 3d73 656c 662c 202a 2a6b 7761 7267  is=self, **kwarg
+0002f080: 7329 0a0a 2020 2020 2020 2020 2320 5669  s)..        # Vi
+0002f090: 6577 2077 6974 686f 7574 2069 6d61 6765  ew without image
+0002f0a0: 0a20 2020 2020 2020 2065 6c73 653a 0a0a  .        else:..
+0002f0b0: 2020 2020 2020 2020 2020 2020 2320 4d61              # Ma
+0002f0c0: 6b65 2064 756d 6d79 2069 6d61 6765 2066  ke dummy image f
+0002f0d0: 6f72 2062 6163 6b67 726f 756e 640a 2020  or background.  
+0002f0e0: 2020 2020 2020 2020 2020 726f 695f 746d            roi_tm
+0002f0f0: 7020 3d20 7365 6c66 2e63 6c6f 6e65 2863  p = self.clone(c
+0002f100: 6f70 795f 6461 7461 3d46 616c 7365 290a  opy_data=False).
+0002f110: 2020 2020 2020 2020 2020 2020 696d 203d              im =
+0002f120: 2073 656c 662e 6765 745f 6475 6d6d 795f   self.get_dummy_
+0002f130: 696d 6167 6528 0a20 2020 2020 2020 2020  image(.         
+0002f140: 2020 2020 2020 2076 6f78 656c 5f73 697a         voxel_siz
+0002f150: 653d 766f 7865 6c5f 7369 7a65 2c0a 2020  e=voxel_size,.  
+0002f160: 2020 2020 2020 2020 2020 2020 2020 6275                bu
+0002f170: 6666 6572 3d62 7566 6665 720a 2020 2020  ffer=buffer.    
+0002f180: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+0002f190: 2020 2020 2020 696d 2e74 6974 6c65 203d        im.title =
+0002f1a0: 2073 656c 662e 6e61 6d65 0a20 2020 2020   self.name.     
+0002f1b0: 2020 2020 2020 2072 6f69 5f74 6d70 2e73         roi_tmp.s
+0002f1c0: 6574 5f69 6d61 6765 2869 6d29 0a0a 2020  et_image(im)..  
+0002f1d0: 2020 2020 2020 2020 2020 2222 220a 2020            """.  
+0002f1e0: 2020 2020 2020 2020 2020 726f 695f 746d            roi_tm
+0002f1f0: 7020 3d20 7365 6c66 0a0a 2020 2020 2020  p = self..      
+0002f200: 2020 2020 2020 2320 4d61 6b65 2064 756d        # Make dum
+0002f210: 6d79 2069 6d61 6765 2066 6f72 2062 6163  my image for bac
+0002f220: 6b67 726f 756e 640a 2020 2020 2020 2020  kground.        
+0002f230: 2020 2020 6966 2073 656c 662e 636f 6e74      if self.cont
+0002f240: 6f75 7273 5f6f 6e6c 793a 0a20 2020 2020  ours_only:.     
+0002f250: 2020 2020 2020 2020 2020 2069 6d20 3d20             im = 
+0002f260: 7365 6c66 2e67 6574 5f64 756d 6d79 5f69  self.get_dummy_i
+0002f270: 6d61 6765 280a 2020 2020 2020 2020 2020  mage(.          
+0002f280: 2020 2020 2020 2020 2020 766f 7865 6c5f            voxel_
+0002f290: 7369 7a65 3d76 6f78 656c 5f73 697a 652c  size=voxel_size,
+0002f2a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002f2b0: 2020 2020 2062 7566 6665 723d 6275 6666       buffer=buff
+0002f2c0: 6572 0a20 2020 2020 2020 2020 2020 2020  er.             
+0002f2d0: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
+0002f2e0: 2020 2020 2069 6d2e 7469 746c 6520 3d20       im.title = 
+0002f2f0: 7365 6c66 2e6e 616d 650a 2020 2020 2020  self.name.      
+0002f300: 2020 2020 2020 2020 2020 726f 695f 746d            roi_tm
+0002f310: 7020 3d20 7365 6c66 2e63 6c6f 6e65 2863  p = self.clone(c
+0002f320: 6f70 795f 6461 7461 3d46 616c 7365 290a  opy_data=False).
+0002f330: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002f340: 726f 695f 746d 702e 7365 745f 696d 6167  roi_tmp.set_imag
+0002f350: 6528 696d 290a 2020 2020 2020 2020 2020  e(im).          
+0002f360: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+0002f370: 2020 2020 2020 2020 696d 203d 2073 6b72          im = skr
+0002f380: 742e 696d 6167 652e 496d 6167 6528 0a20  t.image.Image(. 
+0002f390: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002f3a0: 2020 206e 702e 6f6e 6573 2873 656c 662e     np.ones(self.
+0002f3b0: 7368 6170 6529 202a 2031 6534 2c0a 2020  shape) * 1e4,.  
+0002f3c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002f3d0: 2020 6166 6669 6e65 3d73 656c 662e 6166    affine=self.af
+0002f3e0: 6669 6e65 2c0a 2020 2020 2020 2020 2020  fine,.          
+0002f3f0: 2020 2020 2020 2020 2020 7469 746c 653d            title=
+0002f400: 7365 6c66 2e6e 616d 650a 2020 2020 2020  self.name.      
+0002f410: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+0002f420: 2020 2020 2020 2020 2222 220a 0a20 2020          """..   
+0002f430: 2020 2020 2020 2020 2023 2043 7265 6174           # Creat
+0002f440: 6520 7669 6577 6572 0a20 2020 2020 2020  e viewer.       
+0002f450: 2020 2020 2062 7620 3d20 4265 7474 6572       bv = Better
+0002f460: 5669 6577 6572 2869 6d2c 2072 6f69 733d  Viewer(im, rois=
+0002f470: 726f 695f 746d 702c 202a 2a6b 7761 7267  roi_tmp, **kwarg
+0002f480: 7329 0a0a 2020 2020 2020 2020 2020 2020  s)..            
+0002f490: 2320 4164 6a75 7374 2055 490a 2020 2020  # Adjust UI.    
+0002f4a0: 2020 2020 2020 2020 6e6f 5f75 6920 3d20          no_ui = 
+0002f4b0: 6b77 6172 6773 2e67 6574 2822 6e6f 5f75  kwargs.get("no_u
+0002f4c0: 6922 2c20 736b 7274 2e63 6f72 652e 4465  i", skrt.core.De
+0002f4d0: 6661 756c 7473 2829 2e6e 6f5f 7569 290a  faults().no_ui).
+0002f4e0: 2020 2020 2020 2020 2020 2020 6966 206e              if n
+0002f4f0: 6f74 206e 6f5f 7569 3a0a 2020 2020 2020  ot no_ui:.      
+0002f500: 2020 2020 2020 2020 2020 6276 2e6d 616b            bv.mak
+0002f510: 655f 7569 286e 6f5f 726f 693d 5472 7565  e_ui(no_roi=True
+0002f520: 2c20 6e6f 5f69 6e74 656e 7369 7479 3d54  , no_intensity=T
+0002f530: 7275 6529 0a20 2020 2020 2020 2020 2020  rue).           
+0002f540: 2020 2020 2062 762e 7368 6f77 2829 0a20       bv.show(). 
+0002f550: 2020 2020 2020 2072 6574 7572 6e20 6276         return bv
+0002f560: 0a0a 2020 2020 6465 6620 5f70 6c6f 745f  ..    def _plot_
+0002f570: 6d61 736b 280a 2020 2020 2020 2020 7365  mask(.        se
+0002f580: 6c66 2c0a 2020 2020 2020 2020 7669 6577  lf,.        view
+0002f590: 2c0a 2020 2020 2020 2020 6964 782c 0a20  ,.        idx,. 
+0002f5a0: 2020 2020 2020 206d 6173 6b5f 6b77 6172         mask_kwar
+0002f5b0: 6773 3d4e 6f6e 652c 0a20 2020 2020 2020  gs=None,.       
+0002f5c0: 206f 7061 6369 7479 3d4e 6f6e 652c 0a20   opacity=None,. 
+0002f5d0: 2020 2020 2020 2069 6e63 6c75 6465 5f69         include_i
+0002f5e0: 6d61 6765 3d46 616c 7365 2c0a 2020 2020  mage=False,.    
+0002f5f0: 2020 2020 7a6f 6f6d 3d4e 6f6e 652c 0a20      zoom=None,. 
+0002f600: 2020 2020 2020 207a 6f6f 6d5f 6365 6e74         zoom_cent
+0002f610: 7265 3d4e 6f6e 652c 0a20 2020 2020 2020  re=None,.       
+0002f620: 2063 6f6c 6f72 3d4e 6f6e 652c 0a20 2020   color=None,.   
+0002f630: 2020 2020 2066 6c61 7474 656e 3d46 616c       flatten=Fal
+0002f640: 7365 2c0a 2020 2020 2020 2020 7368 6f77  se,.        show
+0002f650: 3d54 7275 652c 0a20 2020 2020 2020 202a  =True,.        *
+0002f660: 2a6b 7761 7267 732c 0a20 2020 2029 3a0a  *kwargs,.    ):.
+0002f670: 2020 2020 2020 2020 2222 2250 6c6f 7420          """Plot 
+0002f680: 7468 6520 524f 4920 6173 2061 206d 6173  the ROI as a mas
+0002f690: 6b2e 2222 220a 0a20 2020 2020 2020 2073  k."""..        s
+0002f6a0: 656c 662e 6372 6561 7465 5f6d 6173 6b28  elf.create_mask(
+0002f6b0: 290a 2020 2020 2020 2020 6966 2073 656c  ).        if sel
+0002f6c0: 662e 656d 7074 793a 0a20 2020 2020 2020  f.empty:.       
+0002f6d0: 2020 2020 2072 6574 7572 6e0a 2020 2020       return.    
+0002f6e0: 2020 2020 6d61 736b 5f73 6c69 6365 203d      mask_slice =
+0002f6f0: 2073 656c 662e 6765 745f 736c 6963 6528   self.get_slice(
+0002f700: 7669 6577 2c20 6964 783d 6964 782c 2066  view, idx=idx, f
+0002f710: 6c61 7474 656e 3d66 6c61 7474 656e 290a  latten=flatten).
+0002f720: 0a20 2020 2020 2020 2023 204d 616b 6520  .        # Make 
+0002f730: 636f 6c6f 726d 6170 0a20 2020 2020 2020  colormap.       
+0002f740: 206e 6f72 6d20 3d20 6d61 7470 6c6f 746c   norm = matplotl
+0002f750: 6962 2e63 6f6c 6f72 732e 4e6f 726d 616c  ib.colors.Normal
+0002f760: 697a 6528 290a 2020 2020 2020 2020 636d  ize().        cm
+0002f770: 6170 203d 206d 6174 706c 6f74 6c69 622e  ap = matplotlib.
+0002f780: 636d 2e68 7376 0a20 2020 2020 2020 2073  cm.hsv.        s
+0002f790: 5f63 6f6c 6f72 7320 3d20 636d 6170 286e  _colors = cmap(n
+0002f7a0: 6f72 6d28 6d61 736b 5f73 6c69 6365 2929  orm(mask_slice))
+0002f7b0: 0a20 2020 2020 2020 2069 6620 636f 6c6f  .        if colo
+0002f7c0: 7220 6973 204e 6f6e 653a 0a20 2020 2020  r is None:.     
+0002f7d0: 2020 2020 2020 2063 6f6c 6f72 203d 2073         color = s
+0002f7e0: 656c 662e 636f 6c6f 720a 2020 2020 2020  elf.color.      
+0002f7f0: 2020 735f 636f 6c6f 7273 5b6d 6173 6b5f    s_colors[mask_
+0002f800: 736c 6963 6520 3e20 302c 203a 5d20 3d20  slice > 0, :] = 
+0002f810: 636f 6c6f 720a 2020 2020 2020 2020 735f  color.        s_
+0002f820: 636f 6c6f 7273 5b6d 6173 6b5f 736c 6963  colors[mask_slic
+0002f830: 6520 3d3d 2030 2c20 3a5d 203d 2028 302c  e == 0, :] = (0,
+0002f840: 2030 2c20 302c 2030 290a 0a20 2020 2020   0, 0, 0)..     
+0002f850: 2020 2023 2047 6574 2070 6c6f 7474 696e     # Get plottin
+0002f860: 6720 6172 6775 6d65 6e74 730a 2020 2020  g arguments.    
+0002f870: 2020 2020 6966 206d 6173 6b5f 6b77 6172      if mask_kwar
+0002f880: 6773 2069 7320 4e6f 6e65 3a0a 2020 2020  gs is None:.    
+0002f890: 2020 2020 2020 2020 6d61 736b 5f6b 7761          mask_kwa
+0002f8a0: 7267 7320 3d20 7b7d 0a20 2020 2020 2020  rgs = {}.       
+0002f8b0: 206d 6173 6b5f 6b77 6172 6773 2e73 6574   mask_kwargs.set
+0002f8c0: 6465 6661 756c 7428 2261 6c70 6861 222c  default("alpha",
+0002f8d0: 206f 7061 6369 7479 290a 2020 2020 2020   opacity).      
+0002f8e0: 2020 6d61 736b 5f6b 7761 7267 732e 7365    mask_kwargs.se
+0002f8f0: 7464 6566 6175 6c74 2822 696e 7465 7270  tdefault("interp
+0002f900: 6f6c 6174 696f 6e22 2c20 226e 6f6e 6522  olation", "none"
+0002f910: 290a 0a20 2020 2020 2020 2023 204d 616b  )..        # Mak
+0002f920: 6520 706c 6f74 0a20 2020 2020 2020 2069  e plot.        i
+0002f930: 6620 696e 636c 7564 655f 696d 6167 6520  f include_image 
+0002f940: 616e 6420 7365 6c66 2e69 6d61 6765 2069  and self.image i
+0002f950: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
+0002f960: 2020 2020 2020 2020 696d 5f6d 6173 6b20          im_mask 
+0002f970: 3d20 6b77 6172 6773 2e67 6574 2822 6d61  = kwargs.get("ma
+0002f980: 736b 222c 204e 6f6e 6529 0a20 2020 2020  sk", None).     
+0002f990: 2020 2020 2020 2069 6d5f 6d61 736b 6564         im_masked
+0002f9a0: 203d 206b 7761 7267 732e 6765 7428 226d   = kwargs.get("m
+0002f9b0: 6173 6b65 6422 2c20 5472 7565 290a 2020  asked", True).  
+0002f9c0: 2020 2020 2020 2020 2020 696d 5f69 6e76            im_inv
+0002f9d0: 6572 745f 6d61 736b 203d 206b 7761 7267  ert_mask = kwarg
+0002f9e0: 732e 6765 7428 2269 6e76 6572 745f 6d61  s.get("invert_ma
+0002f9f0: 736b 222c 2046 616c 7365 290a 2020 2020  sk", False).    
+0002fa00: 2020 2020 2020 2020 696d 5f6d 6173 6b5f          im_mask_
+0002fa10: 636f 6c6f 7220 3d20 6b77 6172 6773 2e67  color = kwargs.g
+0002fa20: 6574 2822 6d61 736b 5f63 6f6c 6f72 222c  et("mask_color",
+0002fa30: 2022 626c 6163 6b22 290a 2020 2020 2020   "black").      
+0002fa40: 2020 2020 2020 7365 6c66 2e69 6d61 6765        self.image
+0002fa50: 2e70 6c6f 7428 7669 6577 2c20 6964 783d  .plot(view, idx=
+0002fa60: 6964 782c 2061 783d 7365 6c66 2e61 782c  idx, ax=self.ax,
+0002fa70: 2073 686f 773d 4661 6c73 652c 0a20 2020   show=False,.   
+0002fa80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002fa90: 206d 6173 6b3d 696d 5f6d 6173 6b2c 206d   mask=im_mask, m
+0002faa0: 6173 6b65 643d 696d 5f6d 6173 6b65 642c  asked=im_masked,
+0002fab0: 2069 6e76 6572 745f 6d61 736b 3d69 6d5f   invert_mask=im_
+0002fac0: 696e 7665 7274 5f6d 6173 6b2c 0a20 2020  invert_mask,.   
+0002fad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002fae0: 206d 6173 6b5f 636f 6c6f 723d 696d 5f6d   mask_color=im_m
+0002faf0: 6173 6b5f 636f 6c6f 7229 0a20 2020 2020  ask_color).     
+0002fb00: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+0002fb10: 2020 2020 2069 6620 6b77 6172 6773 2e67       if kwargs.g
+0002fb20: 6574 2822 7469 746c 6522 2c20 4e6f 6e65  et("title", None
+0002fb30: 2920 6973 204e 6f6e 653a 0a20 2020 2020  ) is None:.     
+0002fb40: 2020 2020 2020 2020 2020 206b 7761 7267             kwarg
+0002fb50: 735b 2274 6974 6c65 225d 203d 2073 656c  s["title"] = sel
+0002fb60: 662e 6e61 6d65 0a0a 2020 2020 2020 2020  f.name..        
+0002fb70: 7365 6c66 2e61 782e 696d 7368 6f77 2873  self.ax.imshow(s
+0002fb80: 5f63 6f6c 6f72 732c 2065 7874 656e 743d  _colors, extent=
+0002fb90: 7365 6c66 2e6d 6173 6b2e 706c 6f74 5f65  self.mask.plot_e
+0002fba0: 7874 656e 745b 7669 6577 5d2c 200a 2020  xtent[view], .  
+0002fbb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002fbc0: 2020 2020 202a 2a6d 6173 6b5f 6b77 6172       **mask_kwar
+0002fbd0: 6773 290a 0a20 2020 2020 2020 2023 2041  gs)..        # A
+0002fbe0: 646a 7573 7420 6178 6573 0a20 2020 2020  djust axes.     
+0002fbf0: 2020 2073 6b72 742e 696d 6167 652e 496d     skrt.image.Im
+0002fc00: 6167 652e 6c61 6265 6c5f 6178 2873 656c  age.label_ax(sel
+0002fc10: 662c 2076 6965 772c 2069 6478 2c20 2a2a  f, view, idx, **
+0002fc20: 6b77 6172 6773 290a 2020 2020 2020 2020  kwargs).        
+0002fc30: 736b 7274 2e69 6d61 6765 2e49 6d61 6765  skrt.image.Image
+0002fc40: 2e7a 6f6f 6d5f 6178 2873 656c 662c 2076  .zoom_ax(self, v
+0002fc50: 6965 772c 207a 6f6f 6d2c 207a 6f6f 6d5f  iew, zoom, zoom_
+0002fc60: 6365 6e74 7265 290a 2020 2020 2020 2020  centre).        
+0002fc70: 6966 2073 686f 773a 0a20 2020 2020 2020  if show:.       
+0002fc80: 2020 2020 2070 6c74 2e73 686f 7728 290a       plt.show().
+0002fc90: 0a20 2020 2064 6566 205f 706c 6f74 5f63  .    def _plot_c
+0002fca0: 6f6e 746f 7572 280a 2020 2020 2020 2020  ontour(.        
+0002fcb0: 7365 6c66 2c0a 2020 2020 2020 2020 7669  self,.        vi
+0002fcc0: 6577 2c0a 2020 2020 2020 2020 6964 782c  ew,.        idx,
+0002fcd0: 0a20 2020 2020 2020 2063 6f6e 746f 7572  .        contour
+0002fce0: 5f6b 7761 7267 733d 4e6f 6e65 2c0a 2020  _kwargs=None,.  
+0002fcf0: 2020 2020 2020 6c69 6e65 7769 6474 683d        linewidth=
+0002fd00: 4e6f 6e65 2c0a 2020 2020 2020 2020 6365  None,.        ce
+0002fd10: 6e74 726f 6964 3d46 616c 7365 2c0a 2020  ntroid=False,.  
+0002fd20: 2020 2020 2020 696e 636c 7564 655f 696d        include_im
+0002fd30: 6167 653d 4661 6c73 652c 0a20 2020 2020  age=False,.     
+0002fd40: 2020 207a 6f6f 6d3d 4e6f 6e65 2c0a 2020     zoom=None,.  
+0002fd50: 2020 2020 2020 7a6f 6f6d 5f63 656e 7472        zoom_centr
+0002fd60: 653d 4e6f 6e65 2c0a 2020 2020 2020 2020  e=None,.        
+0002fd70: 636f 6c6f 723d 4e6f 6e65 2c0a 2020 2020  color=None,.    
+0002fd80: 2020 2020 666c 6174 7465 6e3d 4661 6c73      flatten=Fals
+0002fd90: 652c 0a20 2020 2020 2020 2073 686f 773d  e,.        show=
+0002fda0: 5472 7565 2c0a 2020 2020 2020 2020 2a2a  True,.        **
+0002fdb0: 6b77 6172 6773 2c0a 2020 2020 293a 0a20  kwargs,.    ):. 
+0002fdc0: 2020 2020 2020 2022 2222 506c 6f74 2074         """Plot t
+0002fdd0: 6865 2052 4f49 2061 7320 6120 636f 6e74  he ROI as a cont
+0002fde0: 6f75 722e 2222 220a 0a20 2020 2020 2020  our."""..       
+0002fdf0: 2073 656c 662e 6c6f 6164 2829 0a20 2020   self.load().   
+0002fe00: 2020 2020 2069 6620 286e 6f74 2073 656c       if (not sel
+0002fe10: 662e 6f6e 5f73 6c69 6365 2876 6965 772c  f.on_slice(view,
+0002fe20: 2069 6478 3d69 6478 2920 616e 6420 6e6f   idx=idx) and no
+0002fe30: 7420 666c 6174 7465 6e29 206f 7220 7365  t flatten) or se
+0002fe40: 6c66 2e65 6d70 7479 3a0a 2020 2020 2020  lf.empty:.      
+0002fe50: 2020 2020 2020 7265 7475 726e 0a0a 2020        return..  
+0002fe60: 2020 2020 2020 636f 6e74 6f75 725f 6b77        contour_kw
+0002fe70: 6172 6773 203d 207b 7d20 6966 2063 6f6e  args = {} if con
+0002fe80: 746f 7572 5f6b 7761 7267 7320 6973 204e  tour_kwargs is N
+0002fe90: 6f6e 6520 656c 7365 2063 6f6e 746f 7572  one else contour
+0002fea0: 5f6b 7761 7267 730a 2020 2020 2020 2020  _kwargs.        
+0002feb0: 636f 6e74 6f75 725f 6b77 6172 6773 2e73  contour_kwargs.s
+0002fec0: 6574 6465 6661 756c 7428 2263 6f6c 6f72  etdefault("color
+0002fed0: 222c 2063 6f6c 6f72 290a 2020 2020 2020  ", color).      
+0002fee0: 2020 636f 6e74 6f75 725f 6b77 6172 6773    contour_kwargs
+0002fef0: 2e73 6574 6465 6661 756c 7428 226c 696e  .setdefault("lin
+0002ff00: 6577 6964 7468 222c 206c 696e 6577 6964  ewidth", linewid
+0002ff10: 7468 290a 0a20 2020 2020 2020 2023 2050  th)..        # P
+0002ff20: 6c6f 7420 756e 6465 726c 7969 6e67 2069  lot underlying i
+0002ff30: 6d61 6765 0a20 2020 2020 2020 2069 6620  mage.        if 
+0002ff40: 696e 636c 7564 655f 696d 6167 6520 616e  include_image an
+0002ff50: 6420 7365 6c66 2e69 6d61 6765 2069 7320  d self.image is 
+0002ff60: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
+0002ff70: 2020 2020 2020 696d 5f6d 6173 6b20 3d20        im_mask = 
+0002ff80: 6b77 6172 6773 2e67 6574 2822 6d61 736b  kwargs.get("mask
+0002ff90: 222c 204e 6f6e 6529 0a20 2020 2020 2020  ", None).       
+0002ffa0: 2020 2020 2069 6d5f 6d61 736b 6564 203d       im_masked =
+0002ffb0: 206b 7761 7267 732e 6765 7428 226d 6173   kwargs.get("mas
+0002ffc0: 6b65 6422 2c20 5472 7565 290a 2020 2020  ked", True).    
+0002ffd0: 2020 2020 2020 2020 696d 5f69 6e76 6572          im_inver
+0002ffe0: 745f 6d61 736b 203d 206b 7761 7267 732e  t_mask = kwargs.
+0002fff0: 6765 7428 2269 6e76 6572 745f 6d61 736b  get("invert_mask
+00030000: 222c 2046 616c 7365 290a 2020 2020 2020  ", False).      
+00030010: 2020 2020 2020 696d 5f6d 6173 6b5f 636f        im_mask_co
+00030020: 6c6f 7220 3d20 6b77 6172 6773 2e67 6574  lor = kwargs.get
+00030030: 2822 6d61 736b 5f63 6f6c 6f72 222c 2022  ("mask_color", "
+00030040: 626c 6163 6b22 290a 2020 2020 2020 2020  black").        
+00030050: 2020 2020 7365 6c66 2e69 6d61 6765 2e70      self.image.p
+00030060: 6c6f 7428 7669 6577 2c20 6964 783d 6964  lot(view, idx=id
+00030070: 782c 2061 783d 7365 6c66 2e61 782c 2073  x, ax=self.ax, s
+00030080: 686f 773d 4661 6c73 652c 0a20 2020 2020  how=False,.     
+00030090: 2020 2020 2020 2020 2020 2020 2020 206d                 m
+000300a0: 6173 6b3d 696d 5f6d 6173 6b2c 206d 6173  ask=im_mask, mas
+000300b0: 6b65 643d 696d 5f6d 6173 6b65 642c 2069  ked=im_masked, i
+000300c0: 6e76 6572 745f 6d61 736b 3d69 6d5f 696e  nvert_mask=im_in
+000300d0: 7665 7274 5f6d 6173 6b2c 0a20 2020 2020  vert_mask,.     
+000300e0: 2020 2020 2020 2020 2020 2020 2020 206d                 m
+000300f0: 6173 6b5f 636f 6c6f 723d 696d 5f6d 6173  ask_color=im_mas
+00030100: 6b5f 636f 6c6f 7229 0a20 2020 2020 2020  k_color).       
+00030110: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+00030120: 2020 2069 6620 6b77 6172 6773 2e67 6574     if kwargs.get
+00030130: 2822 7469 746c 6522 2c20 4e6f 6e65 2920  ("title", None) 
+00030140: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
+00030150: 2020 2020 2020 2020 206b 7761 7267 735b           kwargs[
+00030160: 2274 6974 6c65 225d 203d 2073 656c 662e  "title"] = self.
+00030170: 6e61 6d65 0a0a 2020 2020 2020 2020 2320  name..        # 
+00030180: 4765 7420 636f 6e74 6f75 7220 706f 696e  Get contour poin
+00030190: 7473 0a20 2020 2020 2020 2069 6620 666c  ts.        if fl
+000301a0: 6174 7465 6e3a 0a20 2020 2020 2020 2020  atten:.         
+000301b0: 2020 206d 6173 6b20 3d20 7365 6c66 2e67     mask = self.g
+000301c0: 6574 5f73 6c69 6365 2876 6965 772c 2069  et_slice(view, i
+000301d0: 6478 3d69 6478 2c20 666c 6174 7465 6e3d  dx=idx, flatten=
+000301e0: 5472 7565 290a 2020 2020 2020 2020 2020  True).          
+000301f0: 2020 636f 6e74 6f75 7273 203d 2073 656c    contours = sel
+00030200: 662e 6d61 736b 5f74 6f5f 636f 6e74 6f75  f.mask_to_contou
+00030210: 7273 286d 6173 6b2c 2076 6965 772c 2069  rs(mask, view, i
+00030220: 6e76 6572 743d 5472 7565 290a 2020 2020  nvert=True).    
+00030230: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00030240: 2020 2020 2020 636f 6e74 6f75 7273 203d        contours =
+00030250: 2073 656c 662e 6765 745f 636f 6e74 6f75   self.get_contou
+00030260: 7273 2876 6965 772c 2069 6478 5f61 735f  rs(view, idx_as_
+00030270: 6b65 793d 5472 7565 295b 6964 785d 0a0a  key=True)[idx]..
+00030280: 2020 2020 2020 2020 2320 506c 6f74 2063          # Plot c
+00030290: 6f6e 746f 7572 0a20 2020 2020 2020 2066  ontour.        f
+000302a0: 6f72 2070 6f69 6e74 7320 696e 2063 6f6e  or points in con
+000302b0: 746f 7572 733a 0a20 2020 2020 2020 2020  tours:.         
+000302c0: 2020 2070 6f69 6e74 735f 7820 3d20 5b70     points_x = [p
+000302d0: 5b30 5d20 666f 7220 7020 696e 2070 6f69  [0] for p in poi
+000302e0: 6e74 735d 0a20 2020 2020 2020 2020 2020  nts].           
+000302f0: 2070 6f69 6e74 735f 7920 3d20 5b70 5b31   points_y = [p[1
+00030300: 5d20 666f 7220 7020 696e 2070 6f69 6e74  ] for p in point
+00030310: 735d 0a20 2020 2020 2020 2020 2020 2070  s].            p
+00030320: 6f69 6e74 735f 782e 6170 7065 6e64 2870  oints_x.append(p
+00030330: 6f69 6e74 735f 785b 305d 290a 2020 2020  oints_x[0]).    
+00030340: 2020 2020 2020 2020 706f 696e 7473 5f79          points_y
+00030350: 2e61 7070 656e 6428 706f 696e 7473 5f79  .append(points_y
+00030360: 5b30 5d29 0a20 2020 2020 2020 2020 2020  [0]).           
+00030370: 2073 656c 662e 6178 2e70 6c6f 7428 706f   self.ax.plot(po
+00030380: 696e 7473 5f78 2c20 706f 696e 7473 5f79  ints_x, points_y
+00030390: 2c20 2a2a 636f 6e74 6f75 725f 6b77 6172  , **contour_kwar
+000303a0: 6773 290a 0a20 2020 2020 2020 2023 2050  gs)..        # P
+000303b0: 6c6f 7420 6365 6e74 726f 6964 2070 6f69  lot centroid poi
+000303c0: 6e74 0a20 2020 2020 2020 2069 6620 6365  nt.        if ce
+000303d0: 6e74 726f 6964 3a0a 2020 2020 2020 2020  ntroid:.        
+000303e0: 2020 2020 6966 206e 6f74 2066 6c61 7474      if not flatt
+000303f0: 656e 3a0a 2020 2020 2020 2020 2020 2020  en:.            
+00030400: 2020 2020 6365 6e74 726f 6964 5f70 6f69      centroid_poi
+00030410: 6e74 7320 3d20 7365 6c66 2e67 6574 5f63  nts = self.get_c
+00030420: 656e 7472 6f69 6428 0a20 2020 2020 2020  entroid(.       
+00030430: 2020 2020 2020 2020 2020 2020 2076 6965               vie
+00030440: 772c 2073 696e 676c 655f 736c 6963 653d  w, single_slice=
+00030450: 5472 7565 2c20 6964 783d 6964 7829 0a20  True, idx=idx). 
+00030460: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+00030470: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00030480: 2063 656e 7472 6f69 645f 3364 203d 2073   centroid_3d = s
+00030490: 656c 662e 6765 745f 6365 6e74 726f 6964  elf.get_centroid
+000304a0: 2829 0a20 2020 2020 2020 2020 2020 2020  ().             
+000304b0: 2020 2078 5f61 782c 2079 5f61 7820 3d20     x_ax, y_ax = 
+000304c0: 736b 7274 2e69 6d61 6765 2e5f 706c 6f74  skrt.image._plot
+000304d0: 5f61 7865 735b 7669 6577 5d0a 2020 2020  _axes[view].    
+000304e0: 2020 2020 2020 2020 2020 2020 6365 6e74              cent
+000304f0: 726f 6964 5f70 6f69 6e74 7320 3d20 5b63  roid_points = [c
+00030500: 656e 7472 6f69 645f 3364 5b78 5f61 785d  entroid_3d[x_ax]
+00030510: 2c20 6365 6e74 726f 6964 5f33 645b 795f  , centroid_3d[y_
+00030520: 6178 5d5d 0a20 2020 2020 2020 2020 2020  ax]].           
+00030530: 2073 656c 662e 6178 2e70 6c6f 7428 0a20   self.ax.plot(. 
+00030540: 2020 2020 2020 2020 2020 2020 2020 202a                 *
+00030550: 6365 6e74 726f 6964 5f70 6f69 6e74 732c  centroid_points,
+00030560: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00030570: 2022 2b22 2c0a 2020 2020 2020 2020 2020   "+",.          
+00030580: 2020 2020 2020 2a2a 636f 6e74 6f75 725f        **contour_
+00030590: 6b77 6172 6773 2c0a 2020 2020 2020 2020  kwargs,.        
+000305a0: 2020 2020 290a 0a20 2020 2020 2020 2023      )..        #
+000305b0: 2041 646a 7573 7420 6178 6573 0a20 2020   Adjust axes.   
+000305c0: 2020 2020 2073 656c 662e 6178 2e73 6574       self.ax.set
+000305d0: 5f61 7370 6563 7428 2265 7175 616c 2229  _aspect("equal")
+000305e0: 0a20 2020 2020 2020 2073 6b72 742e 696d  .        skrt.im
+000305f0: 6167 652e 496d 6167 652e 6c61 6265 6c5f  age.Image.label_
+00030600: 6178 2873 656c 662c 2076 6965 772c 2069  ax(self, view, i
+00030610: 6478 2c20 2a2a 6b77 6172 6773 290a 2020  dx, **kwargs).  
+00030620: 2020 2020 2020 736b 7274 2e69 6d61 6765        skrt.image
+00030630: 2e49 6d61 6765 2e7a 6f6f 6d5f 6178 2873  .Image.zoom_ax(s
+00030640: 656c 662c 2076 6965 772c 207a 6f6f 6d2c  elf, view, zoom,
+00030650: 207a 6f6f 6d5f 6365 6e74 7265 290a 2020   zoom_centre).  
+00030660: 2020 2020 2020 6966 2073 686f 773a 0a20        if show:. 
+00030670: 2020 2020 2020 2020 2020 2070 6c74 2e73             plt.s
+00030680: 686f 7728 290a 0a20 2020 2064 6566 2070  how()..    def p
+00030690: 6c6f 745f 636f 6d70 6172 6973 6f6e 280a  lot_comparison(.
+000306a0: 2020 2020 2020 2020 7365 6c66 2c20 0a20          self, . 
+000306b0: 2020 2020 2020 206f 7468 6572 2c20 0a20         other, . 
+000306c0: 2020 2020 2020 2076 6965 773d 2278 2d79         view="x-y
+000306d0: 222c 0a20 2020 2020 2020 2073 6c3d 4e6f  ",.        sl=No
+000306e0: 6e65 2c0a 2020 2020 2020 2020 6964 783d  ne,.        idx=
+000306f0: 4e6f 6e65 2c0a 2020 2020 2020 2020 706f  None,.        po
+00030700: 733d 4e6f 6e65 2c0a 2020 2020 2020 2020  s=None,.        
+00030710: 6d69 645f 736c 6963 655f 666f 725f 626f  mid_slice_for_bo
+00030720: 7468 3d46 616c 7365 2c0a 2020 2020 2020  th=False,.      
+00030730: 2020 6c65 6765 6e64 3d54 7275 652c 200a    legend=True, .
+00030740: 2020 2020 2020 2020 7361 7665 5f61 733d          save_as=
+00030750: 4e6f 6e65 2c20 0a20 2020 2020 2020 206e  None, .        n
+00030760: 616d 6573 3d4e 6f6e 652c 200a 2020 2020  ames=None, .    
+00030770: 2020 2020 7368 6f77 3d54 7275 652c 200a      show=True, .
+00030780: 2020 2020 2020 2020 696e 636c 7564 655f          include_
+00030790: 696d 6167 653d 4661 6c73 652c 0a20 2020  image=False,.   
+000307a0: 2020 2020 206c 6567 656e 645f 6262 6f78       legend_bbox
+000307b0: 5f74 6f5f 616e 6368 6f72 3d4e 6f6e 652c  _to_anchor=None,
+000307c0: 0a20 2020 2020 2020 206c 6567 656e 645f  .        legend_
+000307d0: 6c6f 633d 226c 6f77 6572 206c 6566 7422  loc="lower left"
+000307e0: 2c0a 2020 2020 2020 2020 2a2a 6b77 6172  ,.        **kwar
+000307f0: 6773 0a20 2020 2029 3a0a 2020 2020 2020  gs.    ):.      
+00030800: 2020 2222 2250 6c6f 7420 636f 6d70 6172    """Plot compar
+00030810: 6973 6f6e 2077 6974 6820 616e 6f74 6865  ison with anothe
+00030820: 7220 524f 492e 2049 6620 6e6f 2073 6c2f  r ROI. If no sl/
+00030830: 6964 782f 706f 7320 6172 6520 6769 7665  idx/pos are give
+00030840: 6e2c 0a20 2020 2020 2020 2074 6865 2063  n,.        the c
+00030850: 656e 7472 616c 2073 6c69 6365 206f 6620  entral slice of 
+00030860: 7468 6973 2052 4f49 2077 696c 6c20 6265  this ROI will be
+00030870: 2070 6c6f 7474 6564 2c20 756e 6c65 7373   plotted, unless
+00030880: 200a 2020 2020 2020 2020 6d69 645f 736c   .        mid_sl
+00030890: 6963 655f 666f 725f 626f 7468 3d54 7275  ice_for_both=Tru
+000308a0: 652c 2069 6e20 7768 6963 6820 6361 7365  e, in which case
+000308b0: 2074 6865 2063 656e 7472 616c 2073 6c69   the central sli
+000308c0: 6365 206f 6620 626f 7468 2052 4f49 730a  ce of both ROIs.
+000308d0: 2020 2020 2020 2020 7769 6c6c 2062 6520          will be 
+000308e0: 706c 6f74 7465 6420 2865 7665 6e20 7468  plotted (even th
+000308f0: 6f75 6768 2074 6869 7320 6d61 7920 6e6f  ough this may no
+00030900: 7420 636f 7272 6573 706f 6e64 2074 6f20  t correspond to 
+00030910: 7468 6520 7361 6d65 200a 2020 2020 2020  the same .      
+00030920: 2020 706f 696e 7420 696e 2073 7061 6365    point in space
+00030930: 292e 0a0a 2020 2020 2020 2020 2a2a 5061  )...        **Pa
+00030940: 7261 6d65 7465 7273 3a2a 2a0a 2020 2020  rameters:**.    
+00030950: 2020 2020 0a20 2020 2020 2020 206f 7468      .        oth
+00030960: 6572 203a 2052 4f49 0a20 2020 2020 2020  er : ROI.       
+00030970: 2020 2020 204f 7468 6572 2052 4f49 2077       Other ROI w
+00030980: 6974 6820 7768 6963 6820 746f 2070 6c6f  ith which to plo
+00030990: 7420 636f 6d70 6172 6973 6f6e 2e0a 0a20  t comparison... 
+000309a0: 2020 2020 2020 2076 6965 7720 3a20 7374         view : st
+000309b0: 722c 2064 6566 6175 6c74 3d22 782d 7922  r, default="x-y"
+000309c0: 0a20 2020 2020 2020 2020 2020 204f 7269  .            Ori
+000309d0: 656e 7461 7469 6f6e 2069 6e20 7768 6963  entation in whic
+000309e0: 6820 746f 2070 6c6f 7420 524f 4973 2e20  h to plot ROIs. 
+000309f0: 0a0a 2020 2020 2020 2020 736c 203a 2069  ..        sl : i
+00030a00: 6e74 2c20 6465 6661 756c 743d 4e6f 6e65  nt, default=None
+00030a10: 0a20 2020 2020 2020 2020 2020 2053 6c69  .            Sli
+00030a20: 6365 206e 756d 6265 722e 2049 6620 6e6f  ce number. If no
+00030a30: 6e65 206f 6620 3c73 6c3e 2c20 3c69 6478  ne of <sl>, <idx
+00030a40: 3e20 6f72 203c 706f 733e 2061 7265 2073  > or <pos> are s
+00030a50: 7570 706c 6965 6420 6275 740a 2020 2020  upplied but.    
+00030a60: 2020 2020 2020 2020 3c73 696e 676c 655f          <single_
+00030a70: 736c 6963 653e 2069 7320 5472 7565 2c20  slice> is True, 
+00030a80: 7468 6520 6365 6e74 7261 6c20 736c 6963  the central slic
+00030a90: 6520 6f66 2074 6865 2052 4f49 2077 696c  e of the ROI wil
+00030aa0: 6c20 6265 2075 7365 642e 0a0a 2020 2020  l be used...    
+00030ab0: 2020 2020 6964 7820 3a20 696e 742c 2064      idx : int, d
+00030ac0: 6566 6175 6c74 3d4e 6f6e 650a 2020 2020  efault=None.    
+00030ad0: 2020 2020 2020 2020 4172 7261 7920 696e          Array in
+00030ae0: 6465 7820 6f66 2073 6c69 6365 2e20 4966  dex of slice. If
+00030af0: 206e 6f6e 6520 6f66 203c 736c 3e2c 203c   none of <sl>, <
+00030b00: 6964 783e 206f 7220 3c70 6f73 3e20 6172  idx> or <pos> ar
+00030b10: 6520 7375 7070 6c69 6564 2062 7574 0a20  e supplied but. 
+00030b20: 2020 2020 2020 2020 2020 203c 7369 6e67             <sing
+00030b30: 6c65 5f73 6c69 6365 3e20 6973 2054 7275  le_slice> is Tru
+00030b40: 652c 2074 6865 2063 656e 7472 616c 2073  e, the central s
+00030b50: 6c69 6365 206f 6620 7468 6520 524f 4920  lice of the ROI 
+00030b60: 7769 6c6c 2062 6520 7573 6564 2e0a 0a20  will be used... 
+00030b70: 2020 2020 2020 2070 6f73 203a 2066 6c6f         pos : flo
+00030b80: 6174 2c20 6465 6661 756c 743d 4e6f 6e65  at, default=None
+00030b90: 0a20 2020 2020 2020 2020 2020 2053 6c69  .            Sli
+00030ba0: 6365 2070 6f73 6974 696f 6e20 696e 206d  ce position in m
+00030bb0: 6d2e 2049 6620 6e6f 6e65 206f 6620 3c73  m. If none of <s
+00030bc0: 6c3e 2c20 3c69 6478 3e20 6f72 203c 706f  l>, <idx> or <po
+00030bd0: 733e 2061 7265 2073 7570 706c 6965 6420  s> are supplied 
+00030be0: 6275 740a 2020 2020 2020 2020 2020 2020  but.            
+00030bf0: 3c73 696e 676c 655f 736c 6963 653e 2069  <single_slice> i
+00030c00: 7320 5472 7565 2c20 7468 6520 6365 6e74  s True, the cent
+00030c10: 7261 6c20 736c 6963 6520 6f66 2074 6865  ral slice of the
+00030c20: 2052 4f49 2077 696c 6c20 6265 2075 7365   ROI will be use
+00030c30: 642e 0a0a 2020 2020 2020 2020 6d69 645f  d...        mid_
+00030c40: 736c 6963 655f 666f 725f 626f 7468 203a  slice_for_both :
+00030c50: 2062 6f6f 6c2c 2064 6566 6175 6c74 3d46   bool, default=F
+00030c60: 616c 7365 0a20 2020 2020 2020 2020 2020  alse.           
+00030c70: 2049 6620 5472 7565 2061 6e64 206e 6f20   If True and no 
+00030c80: 736c 2f69 6478 2f70 6f73 2061 7265 2067  sl/idx/pos are g
+00030c90: 6976 656e 2c20 7468 6520 6365 6e74 7261  iven, the centra
+00030ca0: 6c20 736c 6963 6573 206f 6620 626f 7468  l slices of both
+00030cb0: 0a20 2020 2020 2020 2020 2020 2052 4f49  .            ROI
+00030cc0: 7320 7769 6c6c 2062 6520 706c 6f74 7465  s will be plotte
+00030cd0: 642c 2065 7665 6e20 6966 2074 6869 7320  d, even if this 
+00030ce0: 646f 6573 206e 6f74 2063 6f72 7265 7370  does not corresp
+00030cf0: 6f6e 6420 746f 2074 6865 2073 616d 650a  ond to the same.
+00030d00: 2020 2020 2020 2020 2020 2020 706f 696e              poin
+00030d10: 7420 696e 2073 7061 6365 3b20 6f74 6865  t in space; othe
+00030d20: 7277 6973 652c 2074 6865 2070 6f73 6974  rwise, the posit
+00030d30: 696f 6e20 6f66 2074 6865 2063 656e 7472  ion of the centr
+00030d40: 616c 2073 6c69 6365 206f 660a 2020 2020  al slice of.    
+00030d50: 2020 2020 2020 2020 7468 6973 2052 4f49          this ROI
+00030d60: 2077 696c 6c20 6265 2070 6c6f 7474 6564   will be plotted
+00030d70: 2066 6f72 2062 6f74 682e 0a0a 2020 2020   for both...    
+00030d80: 2020 2020 6c65 6765 6e64 203a 2062 6f6f      legend : boo
+00030d90: 6c2c 2064 6566 6175 6c74 3d54 7275 650a  l, default=True.
+00030da0: 2020 2020 2020 2020 2020 2020 4966 2054              If T
+00030db0: 7275 652c 2061 206c 6567 656e 6420 7769  rue, a legend wi
+00030dc0: 6c6c 2062 6520 6164 6465 6420 746f 2074  ll be added to t
+00030dd0: 6865 2070 6c6f 7420 636f 6e74 6169 6e69  he plot containi
+00030de0: 6e67 2074 6865 206e 616d 6573 200a 2020  ng the names .  
+00030df0: 2020 2020 2020 2020 2020 6f66 2074 6865            of the
+00030e00: 2074 776f 2052 4f49 732e 0a0a 2020 2020   two ROIs...    
+00030e10: 2020 2020 7361 7665 5f61 7320 3a20 7374      save_as : st
+00030e20: 722c 2064 6566 6175 6c74 3d4e 6f6e 650a  r, default=None.
+00030e30: 2020 2020 2020 2020 2020 2020 5061 7468              Path
+00030e40: 2074 6f20 6120 6669 6c65 2061 7420 7768   to a file at wh
+00030e50: 6963 6820 7468 6520 706c 6f74 2077 696c  ich the plot wil
+00030e60: 6c20 6265 2073 6176 6564 2e20 4966 204e  l be saved. If N
+00030e70: 6f6e 652c 2074 6865 2070 6c6f 740a 2020  one, the plot.  
+00030e80: 2020 2020 2020 2020 2020 7769 6c6c 206e            will n
+00030e90: 6f74 2062 6520 7361 7665 642e 0a0a 2020  ot be saved...  
+00030ea0: 2020 2020 2020 6e61 6d65 7320 3a20 6c69        names : li
+00030eb0: 7374 2c20 6465 6661 756c 743d 4e6f 6e65  st, default=None
+00030ec0: 0a20 2020 2020 2020 2020 2020 2043 7573  .            Cus
+00030ed0: 746f 6d20 6e61 6d65 7320 746f 2075 7365  tom names to use
+00030ee0: 2066 6f72 2074 6865 2052 4f49 206c 6567   for the ROI leg
+00030ef0: 656e 6420 696e 206f 7264 6572 205b 7468  end in order [th
+00030f00: 6973 2052 4f49 2c20 6f74 6865 7220 524f  is ROI, other RO
+00030f10: 495d 2e0a 2020 2020 2020 2020 2020 2020  I]..            
+00030f20: 4966 204e 6f6e 652c 2074 6865 206e 616d  If None, the nam
+00030f30: 6573 2069 6e20 7365 6c66 2e6e 616d 6520  es in self.name 
+00030f40: 616e 6420 726f 692e 6e61 6d65 2077 696c  and roi.name wil
+00030f50: 6c20 6265 2075 7365 642e 0a0a 2020 2020  l be used...    
+00030f60: 2020 2020 7368 6f77 203a 2062 6f6f 6c2c      show : bool,
+00030f70: 2064 6566 6175 6c74 3d54 7275 650a 2020   default=True.  
+00030f80: 2020 2020 2020 2020 2020 4966 2054 7275            If Tru
+00030f90: 652c 2074 6865 2070 6c6f 7420 7769 6c6c  e, the plot will
+00030fa0: 2062 6520 6469 7370 6c61 7965 642e 0a20   be displayed.. 
+00030fb0: 2020 2020 2020 2022 2222 0a0a 2020 2020         """..    
+00030fc0: 2020 2020 2320 456e 7375 7265 2052 4f49      # Ensure ROI
+00030fd0: 7320 6172 6520 706c 6f74 7465 6420 696e  s are plotted in
+00030fe0: 2064 6966 6665 7265 6e74 2063 6f6c 6f75   different colou
+00030ff0: 7273 0a20 2020 2020 2020 2069 6620 7365  rs.        if se
+00031000: 6c66 2e63 6f6c 6f72 203d 3d20 6f74 6865  lf.color == othe
+00031010: 722e 636f 6c6f 723a 0a20 2020 2020 2020  r.color:.       
+00031020: 2020 2020 2072 6f69 325f 636f 6c6f 7220       roi2_color 
+00031030: 3d20 524f 4944 6566 6175 6c74 7328 292e  = ROIDefaults().
+00031040: 6765 745f 6465 6661 756c 745f 726f 695f  get_default_roi_
+00031050: 636f 6c6f 7228 290a 2020 2020 2020 2020  color().        
+00031060: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+00031070: 2020 726f 6932 5f63 6f6c 6f72 203d 206f    roi2_color = o
+00031080: 7468 6572 2e63 6f6c 6f72 0a0a 2020 2020  ther.color..    
+00031090: 2020 2020 2320 4765 7420 696e 6465 7820      # Get index 
+000310a0: 746f 2070 6c6f 740a 2020 2020 2020 2020  to plot.        
+000310b0: 7a5f 6178 203d 2073 6b72 742e 696d 6167  z_ax = skrt.imag
+000310c0: 652e 5f73 6c69 6365 5f61 7865 735b 7669  e._slice_axes[vi
+000310d0: 6577 5d0a 0a20 2020 2020 2020 2023 2043  ew]..        # C
+000310e0: 6f6d 7075 7465 2070 6f73 6974 696f 6e20  ompute position 
+000310f0: 696e 206d 6d20 746f 2070 6c6f 740a 2020  in mm to plot.  
+00031100: 2020 2020 2020 6966 2073 6c20 6973 204e        if sl is N
+00031110: 6f6e 6520 616e 6420 706f 7320 6973 204e  one and pos is N
+00031120: 6f6e 6520 616e 6420 6964 7820 6973 204e  one and idx is N
+00031130: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+00031140: 2070 6f73 3120 3d20 7365 6c66 2e69 6478   pos1 = self.idx
+00031150: 5f74 6f5f 706f 7328 7365 6c66 2e67 6574  _to_pos(self.get
+00031160: 5f6d 6964 5f69 6478 2876 6965 7729 2c20  _mid_idx(view), 
+00031170: 7a5f 6178 290a 2020 2020 2020 2020 656c  z_ax).        el
+00031180: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+00031190: 706f 7331 203d 2073 656c 662e 6964 785f  pos1 = self.idx_
+000311a0: 746f 5f70 6f73 280a 2020 2020 2020 2020  to_pos(.        
+000311b0: 2020 2020 2020 2020 7365 6c66 2e67 6574          self.get
+000311c0: 5f69 6478 2876 6965 772c 2073 6c3d 736c  _idx(view, sl=sl
+000311d0: 2c20 6964 783d 6964 782c 2070 6f73 3d70  , idx=idx, pos=p
+000311e0: 6f73 292c 200a 2020 2020 2020 2020 2020  os), .          
+000311f0: 2020 2020 2020 7a5f 6178 0a20 2020 2020        z_ax.     
+00031200: 2020 2020 2020 2029 0a0a 2020 2020 2020         )..      
+00031210: 2020 2320 506c 6f74 2074 6865 2073 616d    # Plot the sam
+00031220: 6520 706f 7369 7469 6f6e 2066 6f72 206f  e position for o
+00031230: 7468 6572 2052 4f49 2c20 756e 6c65 7373  ther ROI, unless
+00031240: 206d 6964 5f73 6c69 6365 5f66 6f72 5f62   mid_slice_for_b
+00031250: 6f74 683d 5472 7565 0a20 2020 2020 2020  oth=True.       
+00031260: 2069 6620 6e6f 7420 6d69 645f 736c 6963   if not mid_slic
+00031270: 655f 666f 725f 626f 7468 3a0a 2020 2020  e_for_both:.    
+00031280: 2020 2020 2020 2020 706f 7332 203d 2070          pos2 = p
+00031290: 6f73 310a 2020 2020 2020 2020 656c 7365  os1.        else
+000312a0: 3a0a 2020 2020 2020 2020 2020 2020 706f  :.            po
+000312b0: 7332 203d 206f 7468 6572 2e69 6478 5f74  s2 = other.idx_t
+000312c0: 6f5f 706f 7328 6f74 6865 722e 6765 745f  o_pos(other.get_
+000312d0: 6d69 645f 6964 7828 7669 6577 292c 207a  mid_idx(view), z
+000312e0: 5f61 7829 0a0a 2020 2020 2020 2020 2320  _ax)..        # 
+000312f0: 506c 6f74 2073 656c 660a 2020 2020 2020  Plot self.      
+00031300: 2020 7365 6c66 2e70 6c6f 7428 7368 6f77    self.plot(show
+00031310: 3d46 616c 7365 2c20 7669 6577 3d76 6965  =False, view=vie
+00031320: 772c 2070 6f73 3d70 6f73 312c 2069 6e63  w, pos=pos1, inc
+00031330: 6c75 6465 5f69 6d61 6765 3d69 6e63 6c75  lude_image=inclu
+00031340: 6465 5f69 6d61 6765 2c20 0a20 2020 2020  de_image, .     
+00031350: 2020 2020 2020 2020 2020 2020 202a 2a6b               **k
+00031360: 7761 7267 7329 0a0a 2020 2020 2020 2020  wargs)..        
+00031370: 2320 4164 6a75 7374 206b 7761 7267 7320  # Adjust kwargs 
+00031380: 666f 7220 706c 6f74 7469 6e67 2073 6563  for plotting sec
+00031390: 6f6e 6420 524f 490a 2020 2020 2020 2020  ond ROI.        
+000313a0: 6b77 6172 6773 5b22 6178 225d 203d 2073  kwargs["ax"] = s
+000313b0: 656c 662e 6178 0a20 2020 2020 2020 206b  elf.ax.        k
+000313c0: 7761 7267 735b 2263 6f6c 6f72 225d 203d  wargs["color"] =
+000313d0: 2072 6f69 325f 636f 6c6f 720a 2020 2020   roi2_color.    
+000313e0: 2020 2020 6f74 6865 722e 706c 6f74 2873      other.plot(s
+000313f0: 686f 773d 4661 6c73 652c 2076 6965 773d  how=False, view=
+00031400: 7669 6577 2c20 706f 733d 706f 7332 2c20  view, pos=pos2, 
+00031410: 696e 636c 7564 655f 696d 6167 653d 4661  include_image=Fa
+00031420: 6c73 652c 200a 2020 2020 2020 2020 2020  lse, .          
+00031430: 2020 2020 2020 2020 202a 2a6b 7761 7267           **kwarg
+00031440: 7329 0a20 2020 2020 2020 2073 656c 662e  s).        self.
+00031450: 6178 2e73 6574 5f74 6974 6c65 2873 656c  ax.set_title(sel
+00031460: 662e 6765 745f 636f 6d70 6172 6973 6f6e  f.get_comparison
+00031470: 5f6e 616d 6528 6f74 6865 7229 290a 0a20  _name(other)).. 
+00031480: 2020 2020 2020 2023 2043 7265 6174 6520         # Create 
+00031490: 6c65 6765 6e64 0a20 2020 2020 2020 2069  legend.        i
+000314a0: 6620 6c65 6765 6e64 3a0a 2020 2020 2020  f legend:.      
+000314b0: 2020 2020 2020 706c 6f74 5f74 7970 6520        plot_type 
+000314c0: 3d20 6b77 6172 6773 2e67 6574 2822 706c  = kwargs.get("pl
+000314d0: 6f74 5f74 7970 6522 2c20 4e6f 6e65 290a  ot_type", None).
+000314e0: 2020 2020 2020 2020 2020 2020 6966 2070              if p
+000314f0: 6c6f 745f 7479 7065 2069 7320 4e6f 6e65  lot_type is None
+00031500: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00031510: 2020 706c 6f74 5f74 7970 6520 3d20 6b77    plot_type = kw
+00031520: 6172 6773 2e67 6574 2822 726f 695f 706c  args.get("roi_pl
+00031530: 6f74 5f74 7970 6522 2c20 4e6f 6e65 290a  ot_type", None).
+00031540: 2020 2020 2020 2020 2020 2020 6c69 6e65              line
+00031550: 7769 6474 6820 3d20 6b77 6172 6773 2e67  width = kwargs.g
+00031560: 6574 2822 6c69 6e65 7769 6474 6822 2c20  et("linewidth", 
+00031570: 4e6f 6e65 290a 2020 2020 2020 2020 2020  None).          
+00031580: 2020 6f70 6163 6974 7920 3d20 6b77 6172    opacity = kwar
+00031590: 6773 2e67 6574 2822 6f70 6163 6974 7922  gs.get("opacity"
+000315a0: 2c20 4e6f 6e65 290a 2020 2020 2020 2020  , None).        
+000315b0: 2020 2020 6966 206e 616d 6573 3a0a 2020      if names:.  
+000315c0: 2020 2020 2020 2020 2020 2020 2020 726f                ro
+000315d0: 6931 5f6e 616d 6520 3d20 6e61 6d65 735b  i1_name = names[
+000315e0: 305d 0a20 2020 2020 2020 2020 2020 2020  0].             
+000315f0: 2020 2072 6f69 325f 6e61 6d65 203d 206e     roi2_name = n
+00031600: 616d 6573 5b31 5d0a 2020 2020 2020 2020  ames[1].        
+00031610: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00031620: 2020 2020 2020 2020 2020 726f 6931 5f6e            roi1_n
+00031630: 616d 6520 3d20 7365 6c66 2e6e 616d 650a  ame = self.name.
+00031640: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00031650: 726f 6932 5f6e 616d 6520 3d20 6f74 6865  roi2_name = othe
+00031660: 722e 6e61 6d65 0a20 2020 2020 2020 2020  r.name.         
+00031670: 2020 2068 616e 646c 6573 203d 205b 0a20     handles = [. 
+00031680: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00031690: 656c 662e 6765 745f 7061 7463 6828 0a20  elf.get_patch(. 
+000316a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000316b0: 2020 2070 6c6f 745f 7479 7065 2c20 7365     plot_type, se
+000316c0: 6c66 2e63 6f6c 6f72 2c20 6f70 6163 6974  lf.color, opacit
+000316d0: 792c 206c 696e 6577 6964 7468 2c20 726f  y, linewidth, ro
+000316e0: 6931 5f6e 616d 6529 2c0a 2020 2020 2020  i1_name),.      
+000316f0: 2020 2020 2020 2020 2020 7365 6c66 2e67            self.g
+00031700: 6574 5f70 6174 6368 280a 2020 2020 2020  et_patch(.      
+00031710: 2020 2020 2020 2020 2020 2020 2020 706c                pl
+00031720: 6f74 5f74 7970 652c 2072 6f69 325f 636f  ot_type, roi2_co
+00031730: 6c6f 722c 206f 7061 6369 7479 2c20 6c69  lor, opacity, li
+00031740: 6e65 7769 6474 682c 2072 6f69 325f 6e61  newidth, roi2_na
+00031750: 6d65 292c 0a20 2020 2020 2020 2020 2020  me),.           
+00031760: 205d 0a20 2020 2020 2020 2020 2020 2073   ].            s
+00031770: 656c 662e 6178 2e6c 6567 656e 6428 0a20  elf.ax.legend(. 
+00031780: 2020 2020 2020 2020 2020 2020 2020 2068                 h
+00031790: 616e 646c 6573 3d68 616e 646c 6573 2c20  andles=handles, 
+000317a0: 6672 616d 6561 6c70 6861 3d31 2c20 6661  framealpha=1, fa
+000317b0: 6365 636f 6c6f 723d 2277 6869 7465 222c  cecolor="white",
+000317c0: 200a 2020 2020 2020 2020 2020 2020 2020   .              
+000317d0: 2020 6262 6f78 5f74 6f5f 616e 6368 6f72    bbox_to_anchor
+000317e0: 3d6c 6567 656e 645f 6262 6f78 5f74 6f5f  =legend_bbox_to_
+000317f0: 616e 6368 6f72 2c20 6c6f 633d 6c65 6765  anchor, loc=lege
+00031800: 6e64 5f6c 6f63 0a20 2020 2020 2020 2020  nd_loc.         
+00031810: 2020 2029 0a0a 2020 2020 2020 2020 2320     )..        # 
+00031820: 5368 6f77 2f73 6176 650a 2020 2020 2020  Show/save.      
+00031830: 2020 6966 2073 686f 773a 0a20 2020 2020    if show:.     
+00031840: 2020 2020 2020 2070 6c74 2e73 686f 7728         plt.show(
+00031850: 290a 2020 2020 2020 2020 6966 2073 6176  ).        if sav
+00031860: 655f 6173 3a0a 2020 2020 2020 2020 2020  e_as:.          
+00031870: 2020 706c 742e 7469 6768 745f 6c61 796f    plt.tight_layo
+00031880: 7574 2829 0a20 2020 2020 2020 2020 2020  ut().           
+00031890: 2073 656c 662e 6669 672e 7361 7665 6669   self.fig.savefi
+000318a0: 6728 7361 7665 5f61 7329 0a0a 2020 2020  g(save_as)..    
+000318b0: 6465 6620 6765 745f 6173 7065 6374 5f72  def get_aspect_r
+000318c0: 6174 696f 280a 2020 2020 2020 2020 7365  atio(.        se
+000318d0: 6c66 2c20 7669 6577 2c20 2a61 7267 732c  lf, view, *args,
+000318e0: 202a 2a6b 7761 7267 730a 2020 2020 293a   **kwargs.    ):
+000318f0: 0a20 2020 2020 2020 2022 2222 4765 7420  .        """Get 
+00031900: 6173 7065 6374 2072 6174 696f 2066 6f72  aspect ratio for
+00031910: 2074 6869 7320 7374 7275 6374 7572 6520   this structure 
+00031920: 696e 2061 2067 6976 656e 206f 7269 656e  in a given orien
+00031930: 7461 7469 6f6e 2e22 2222 0a0a 2020 2020  tation."""..    
+00031940: 2020 2020 785f 6178 2c20 795f 6178 203d      x_ax, y_ax =
+00031950: 2073 6b72 742e 696d 6167 652e 5f70 6c6f   skrt.image._plo
+00031960: 745f 6178 6573 5b76 6965 775d 0a20 2020  t_axes[view].   
+00031970: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+00031980: 2e67 6574 5f6c 656e 6774 6828 6178 3d73  .get_length(ax=s
+00031990: 6b72 742e 696d 6167 652e 5f61 7865 735b  krt.image._axes[
+000319a0: 785f 6178 5d29 205c 0a20 2020 2020 2020  x_ax]) \.       
+000319b0: 2020 2020 2020 2020 202f 2073 656c 662e           / self.
+000319c0: 6765 745f 6c65 6e67 7468 2861 783d 736b  get_length(ax=sk
+000319d0: 7274 2e69 6d61 6765 2e5f 6178 6573 5b79  rt.image._axes[y
+000319e0: 5f61 785d 290a 0a20 2020 2064 6566 2073  _ax])..    def s
+000319f0: 6574 5f61 7828 7365 6c66 2c20 706c 6f74  et_ax(self, plot
+00031a00: 5f74 7970 652c 2069 6e63 6c75 6465 5f69  _type, include_i
+00031a10: 6d61 6765 2c20 2a61 7267 732c 202a 2a6b  mage, *args, **k
+00031a20: 7761 7267 7329 3a0a 2020 2020 2020 2020  wargs):.        
+00031a30: 2222 2253 6574 2075 7020 6178 6573 2e22  """Set up axes."
+00031a40: 2222 0a0a 2020 2020 2020 2020 6966 2070  ""..        if p
+00031a50: 6c6f 745f 7479 7065 2069 6e20 5b22 636f  lot_type in ["co
+00031a60: 6e74 6f75 7222 2c20 2263 656e 7472 6f69  ntour", "centroi
+00031a70: 6422 5d20 616e 6420 6e6f 7420 696e 636c  d"] and not incl
+00031a80: 7564 655f 696d 6167 653a 0a20 2020 2020  ude_image:.     
+00031a90: 2020 2020 2020 2061 7370 6563 745f 6765         aspect_ge
+00031aa0: 7474 6572 203d 2073 656c 662e 6765 745f  tter = self.get_
+00031ab0: 6173 7065 6374 5f72 6174 696f 0a20 2020  aspect_ratio.   
+00031ac0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+00031ad0: 2020 2020 2020 2069 6620 7365 6c66 2e69         if self.i
+00031ae0: 6d61 6765 2069 7320 6e6f 7420 4e6f 6e65  mage is not None
+00031af0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00031b00: 2020 6173 7065 6374 5f67 6574 7465 7220    aspect_getter 
+00031b10: 3d20 7365 6c66 2e69 6d61 6765 2e67 6574  = self.image.get
+00031b20: 5f70 6c6f 745f 6173 7065 6374 5f72 6174  _plot_aspect_rat
+00031b30: 696f 0a20 2020 2020 2020 2020 2020 2065  io.            e
+00031b40: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+00031b50: 2020 2020 2073 656c 662e 6372 6561 7465       self.create
+00031b60: 5f6d 6173 6b28 290a 2020 2020 2020 2020  _mask().        
+00031b70: 2020 2020 2020 2020 6173 7065 6374 5f67          aspect_g
+00031b80: 6574 7465 7220 3d20 7365 6c66 2e6d 6173  etter = self.mas
+00031b90: 6b2e 6765 745f 706c 6f74 5f61 7370 6563  k.get_plot_aspec
+00031ba0: 745f 7261 7469 6f0a 2020 2020 2020 2020  t_ratio.        
+00031bb0: 736b 7274 2e69 6d61 6765 2e73 6574 5f61  skrt.image.set_a
+00031bc0: 7828 7365 6c66 2c20 2a61 7267 732c 2061  x(self, *args, a
+00031bd0: 7370 6563 745f 6765 7474 6572 3d61 7370  spect_getter=asp
+00031be0: 6563 745f 6765 7474 6572 2c20 2a2a 6b77  ect_getter, **kw
+00031bf0: 6172 6773 290a 0a20 2020 2064 6566 2067  args)..    def g
+00031c00: 6574 5f7a 6f6f 6d5f 6365 6e74 7265 2873  et_zoom_centre(s
+00031c10: 656c 662c 2076 6965 7729 3a0a 2020 2020  elf, view):.    
+00031c20: 2020 2020 2222 2247 6574 2063 6f6f 7264      """Get coord
+00031c30: 696e 6174 6573 2074 6f20 7a6f 6f6d 2069  inates to zoom i
+00031c40: 6e20 6f6e 2074 6869 7320 524f 492e 2222  n on this ROI.""
+00031c50: 220a 0a20 2020 2020 2020 207a 6f6f 6d5f  "..        zoom_
+00031c60: 6365 6e74 7265 203d 205b 4e6f 6e65 2c20  centre = [None, 
+00031c70: 4e6f 6e65 2c20 4e6f 6e65 5d0a 2020 2020  None, None].    
+00031c80: 2020 2020 785f 6178 2c20 795f 6178 203d      x_ax, y_ax =
+00031c90: 2073 6b72 742e 696d 6167 652e 5f70 6c6f   skrt.image._plo
+00031ca0: 745f 6178 6573 5b76 6965 775d 0a20 2020  t_axes[view].   
+00031cb0: 2020 2020 2078 2c20 7920 3d20 7365 6c66       x, y = self
+00031cc0: 2e67 6574 5f63 656e 7472 6528 7669 6577  .get_centre(view
+00031cd0: 3d76 6965 772c 2073 696e 676c 655f 736c  =view, single_sl
+00031ce0: 6963 653d 5472 7565 290a 2020 2020 2020  ice=True).      
+00031cf0: 2020 7a6f 6f6d 5f63 656e 7472 655b 785f    zoom_centre[x_
+00031d00: 6178 5d20 3d20 780a 2020 2020 2020 2020  ax] = x.        
+00031d10: 7a6f 6f6d 5f63 656e 7472 655b 795f 6178  zoom_centre[y_ax
+00031d20: 5d20 3d20 790a 2020 2020 2020 2020 7265  ] = y.        re
+00031d30: 7475 726e 207a 6f6f 6d5f 6365 6e74 7265  turn zoom_centre
+00031d40: 0a0a 2020 2020 6465 6620 7772 6974 6528  ..    def write(
+00031d50: 7365 6c66 2c20 6f75 746e 616d 653d 4e6f  self, outname=No
+00031d60: 6e65 2c20 6f75 7464 6972 3d22 2e22 2c20  ne, outdir=".", 
+00031d70: 6578 743d 4e6f 6e65 2c20 6f76 6572 7772  ext=None, overwr
+00031d80: 6974 653d 4661 6c73 652c 0a20 2020 2020  ite=False,.     
+00031d90: 2020 2020 2020 2068 6561 6465 725f 736f         header_so
+00031da0: 7572 6365 3d4e 6f6e 652c 2070 6174 6965  urce=None, patie
+00031db0: 6e74 5f69 643d 4e6f 6e65 2c20 726f 6f74  nt_id=None, root
+00031dc0: 5f75 6964 3d4e 6f6e 652c 0a20 2020 2020  _uid=None,.     
+00031dd0: 2020 2020 2020 2076 6572 626f 7365 3d54         verbose=T
+00031de0: 7275 652c 2068 6561 6465 725f 6578 7472  rue, header_extr
+00031df0: 6173 3d7b 7d2c 206b 6565 705f 736f 7572  as={}, keep_sour
+00031e00: 6365 5f72 6f69 733d 5472 7565 2c20 2a2a  ce_rois=True, **
+00031e10: 6b77 6172 6773 293a 0a0a 2020 2020 2020  kwargs):..      
+00031e20: 2020 7365 6c66 2e6c 6f61 6428 290a 0a20    self.load().. 
+00031e30: 2020 2020 2020 2023 2047 656e 6572 6174         # Generat
+00031e40: 6520 6f75 7470 7574 206e 616d 6520 6966  e output name if
+00031e50: 206e 6f74 2067 6976 656e 0a20 2020 2020   not given.     
+00031e60: 2020 2070 6f73 7369 626c 655f 6578 7420     possible_ext 
+00031e70: 3d20 5b22 2e64 636d 222c 2022 2e6e 6969  = [".dcm", ".nii
+00031e80: 2e67 7a22 2c20 222e 6e69 6922 2c20 222e  .gz", ".nii", ".
+00031e90: 6e70 7922 2c20 222e 7478 7422 5d0a 2020  npy", ".txt"].  
+00031ea0: 2020 2020 2020 6966 2065 7874 2069 7320        if ext is 
+00031eb0: 6e6f 7420 4e6f 6e65 2061 6e64 206e 6f74  not None and not
+00031ec0: 2065 7874 2e73 7461 7274 7377 6974 6828   ext.startswith(
+00031ed0: 222e 2229 3a0a 2020 2020 2020 2020 2020  "."):.          
+00031ee0: 2020 6578 7420 3d20 6622 2e7b 6578 747d    ext = f".{ext}
+00031ef0: 220a 2020 2020 2020 2020 6966 206f 7574  ".        if out
+00031f00: 6e61 6d65 2069 7320 4e6f 6e65 3a0a 2020  name is None:.  
+00031f10: 2020 2020 2020 2020 2020 6966 2065 7874            if ext
+00031f20: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
+00031f30: 2020 2020 2020 2020 2020 6578 7420 3d20            ext = 
+00031f40: 222e 6e69 6922 0a20 2020 2020 2020 2020  ".nii".         
+00031f50: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+00031f60: 2020 2020 2020 2020 2069 6620 6578 7420           if ext 
+00031f70: 6e6f 7420 696e 2070 6f73 7369 626c 655f  not in possible_
+00031f80: 6578 743a 0a20 2020 2020 2020 2020 2020  ext:.           
+00031f90: 2020 2020 2020 2020 2072 6169 7365 2052           raise R
+00031fa0: 756e 7469 6d65 4572 726f 7228 6622 556e  untimeError(f"Un
+00031fb0: 7265 636f 676e 6973 6564 2066 696c 6520  recognised file 
+00031fc0: 6578 7465 6e73 696f 6e3a 207b 6578 747d  extension: {ext}
+00031fd0: 2229 0a20 2020 2020 2020 2020 2020 2069  ").            i
+00031fe0: 6620 6e6f 7420 6578 742e 7374 6172 7473  f not ext.starts
+00031ff0: 7769 7468 2822 2e22 293a 0a20 2020 2020  with("."):.     
+00032000: 2020 2020 2020 2020 2020 2065 7874 203d             ext =
+00032010: 2066 222e 7b65 7874 7d22 0a20 2020 2020   f".{ext}".     
+00032020: 2020 2020 2020 206f 7574 6e61 6d65 203d         outname =
+00032030: 2066 227b 6f75 7464 6972 7d2f 7b73 656c   f"{outdir}/{sel
+00032040: 662e 6e61 6d65 7d7b 6578 747d 220a 0a20  f.name}{ext}".. 
+00032050: 2020 2020 2020 2023 204f 7468 6572 7769         # Otherwi
+00032060: 7365 2c20 696e 6665 7220 6578 7465 6e73  se, infer extens
+00032070: 696f 6e20 6672 6f6d 2066 696c 656e 616d  ion from filenam
+00032080: 650a 2020 2020 2020 2020 656c 7365 3a0a  e.        else:.
+00032090: 0a20 2020 2020 2020 2020 2020 2023 2046  .            # F
+000320a0: 696e 6420 616e 7920 6f66 2074 6865 2076  ind any of the v
+000320b0: 616c 6964 2066 696c 6520 6578 7465 6e73  alid file extens
+000320c0: 696f 6e73 0a20 2020 2020 2020 2020 2020  ions.           
+000320d0: 2066 6f72 2070 6f73 2069 6e20 706f 7373   for pos in poss
+000320e0: 6962 6c65 5f65 7874 3a0a 2020 2020 2020  ible_ext:.      
+000320f0: 2020 2020 2020 2020 2020 6966 206f 7574            if out
+00032100: 6e61 6d65 2e65 6e64 7377 6974 6828 706f  name.endswith(po
+00032110: 7329 3a0a 2020 2020 2020 2020 2020 2020  s):.            
+00032120: 2020 2020 2020 2020 6578 7420 3d20 706f          ext = po
+00032130: 730a 2020 2020 2020 2020 2020 2020 6966  s.            if
+00032140: 2065 7874 206e 6f74 2069 6e20 706f 7373   ext not in poss
+00032150: 6962 6c65 5f65 7874 3a0a 2020 2020 2020  ible_ext:.      
+00032160: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+00032170: 5275 6e74 696d 6545 7272 6f72 2866 2255  RuntimeError(f"U
+00032180: 6e72 6563 6f67 6e69 7365 6420 6f75 7470  nrecognised outp
+00032190: 7574 2066 696c 6520 7479 7065 3a20 7b6f  ut file type: {o
+000321a0: 7574 6e61 6d65 7d22 290a 0a20 2020 2020  utname}")..     
+000321b0: 2020 2020 2020 206f 7574 6e61 6d65 203d         outname =
+000321c0: 206f 732e 7061 7468 2e6a 6f69 6e28 6f75   os.path.join(ou
+000321d0: 7464 6972 2c20 6f75 746e 616d 6529 0a0a  tdir, outname)..
+000321e0: 2020 2020 2020 2020 2320 5772 6974 6520          # Write 
+000321f0: 706f 696e 7473 2074 6f20 7465 7874 2066  points to text f
+00032200: 696c 652c 2069 6e20 666f 726d 6174 2074  ile, in format t
+00032210: 6861 7420 6361 6e20 6265 2072 6561 6420  hat can be read 
+00032220: 6279 2074 7261 6e73 666f 726d 6978 0a20  by transformix. 
+00032230: 2020 2020 2020 2069 6620 6578 7420 3d3d         if ext ==
+00032240: 2022 2e74 7874 223a 0a20 2020 2020 2020   ".txt":.       
+00032250: 2020 2020 2073 656c 662e 6765 745f 636f       self.get_co
+00032260: 6e74 6f75 7273 2829 0a0a 2020 2020 2020  ntours()..      
+00032270: 2020 2020 2020 706f 696e 7473 203d 205b        points = [
+00032280: 5d0a 2020 2020 2020 2020 2020 2020 666f  ].            fo
+00032290: 7220 7a2c 2063 6f6e 746f 7572 7320 696e  r z, contours in
+000322a0: 2073 656c 662e 636f 6e74 6f75 7273 5b22   self.contours["
+000322b0: 782d 7922 5d2e 6974 656d 7328 293a 0a20  x-y"].items():. 
+000322c0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+000322d0: 6f72 2069 6478 2c20 636f 6e74 6f75 7220  or idx, contour 
+000322e0: 696e 2065 6e75 6d65 7261 7465 2863 6f6e  in enumerate(con
+000322f0: 746f 7572 7329 3a0a 2020 2020 2020 2020  tours):.        
+00032300: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+00032310: 706f 696e 7420 696e 2063 6f6e 746f 7572  point in contour
+00032320: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00032330: 2020 2020 2020 2020 2020 2320 4164 6420            # Add 
+00032340: 7468 7265 6520 6469 6769 7473 2074 6f20  three digits to 
+00032350: 7374 6f72 6520 7468 6520 636f 6e74 6f75  store the contou
+00032360: 7220 696e 6465 782c 0a20 2020 2020 2020  r index,.       
+00032370: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00032380: 2023 2077 6869 6368 2069 7320 756e 6c69   # which is unli
+00032390: 6b65 6c79 2074 6f20 6e65 6564 206d 6f72  kely to need mor
+000323a0: 6520 7468 616e 2061 2073 696e 676c 6520  e than a single 
+000323b0: 6469 6769 742e 0a20 2020 2020 2020 2020  digit..         
+000323c0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+000323d0: 2054 6869 7320 6861 7320 6e65 676c 6967   This has neglig
+000323e0: 6962 6c65 2065 6666 6563 7420 6f6e 2070  ible effect on p
+000323f0: 7265 6369 7369 6f6e 2c0a 2020 2020 2020  recision,.      
+00032400: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00032410: 2020 2320 616e 6420 616c 6c6f 7773 2063    # and allows c
+00032420: 6f6e 746f 7572 2d70 6f69 6e74 2061 7373  ontour-point ass
+00032430: 6f63 6961 7469 6f6e 730a 2020 2020 2020  ociations.      
+00032440: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00032450: 2020 2320 746f 2062 6520 6964 656e 7469    # to be identi
+00032460: 6669 6564 2069 6e20 5472 616e 7366 6f72  fied in Transfor
+00032470: 6d69 7820 6f75 7470 7574 2e0a 2020 2020  mix output..    
+00032480: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00032490: 2020 2020 7a5f 6f75 7420 3d20 6622 7b7a      z_out = f"{z
+000324a0: 3a2e 3366 7d7b 6964 783a 3033 7d22 0a20  :.3f}{idx:03}". 
+000324b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000324c0: 2020 2020 2020 2070 6f69 6e74 732e 6170         points.ap
+000324d0: 7065 6e64 2866 227b 706f 696e 745b 305d  pend(f"{point[0]
+000324e0: 3a2e 3366 7d20 7b70 6f69 6e74 5b31 5d3a  :.3f} {point[1]:
+000324f0: 2e33 667d 207b 7a5f 6f75 747d 2229 0a0a  .3f} {z_out}")..
+00032500: 2020 2020 2020 2020 2020 2020 7769 7468              with
+00032510: 206f 7065 6e28 6f75 746e 616d 652c 2022   open(outname, "
+00032520: 7722 2920 6173 2066 696c 653a 0a20 2020  w") as file:.   
+00032530: 2020 2020 2020 2020 2020 2020 2066 696c               fil
+00032540: 652e 7772 6974 6528 2270 6f69 6e74 5c6e  e.write("point\n
+00032550: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
+00032560: 2020 2066 696c 652e 7772 6974 6528 6622     file.write(f"
+00032570: 7b6c 656e 2870 6f69 6e74 7329 7d5c 6e22  {len(points)}\n"
+00032580: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00032590: 2020 6669 6c65 2e77 7269 7465 2822 5c6e    file.write("\n
+000325a0: 222e 6a6f 696e 2870 6f69 6e74 7329 290a  ".join(points)).
+000325b0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+000325c0: 7572 6e0a 0a20 2020 2020 2020 2023 2057  urn..        # W
+000325d0: 7269 7465 2061 7272 6179 2074 6f20 6e69  rite array to ni
+000325e0: 6674 6920 6f72 206e 7079 0a20 2020 2020  fti or npy.     
+000325f0: 2020 2065 6c69 6620 6578 7420 213d 2022     elif ext != "
+00032600: 2e64 636d 223a 0a20 2020 2020 2020 2020  .dcm":.         
+00032610: 2020 2073 656c 662e 6372 6561 7465 5f6d     self.create_m
+00032620: 6173 6b28 290a 2020 2020 2020 2020 2020  ask().          
+00032630: 2020 7365 6c66 2e6d 6173 6b2e 7772 6974    self.mask.writ
+00032640: 6528 6f75 746e 616d 652c 2076 6572 626f  e(outname, verbo
+00032650: 7365 3d76 6572 626f 7365 2c20 2a2a 6b77  se=verbose, **kw
+00032660: 6172 6773 290a 2020 2020 2020 2020 656c  args).        el
+00032670: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+00032680: 6966 2068 6561 6465 725f 736f 7572 6365  if header_source
+00032690: 2061 6e64 206b 6565 705f 736f 7572 6365   and keep_source
+000326a0: 5f72 6f69 733a 0a20 2020 2020 2020 2020  _rois:.         
+000326b0: 2020 2020 2020 2073 7472 7563 7475 7265         structure
+000326c0: 5f73 6574 203d 2053 7472 7563 7475 7265  _set = Structure
+000326d0: 5365 7428 6865 6164 6572 5f73 6f75 7263  Set(header_sourc
+000326e0: 6529 0a20 2020 2020 2020 2020 2020 2065  e).            e
+000326f0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+00032700: 2020 2020 2073 7472 7563 7475 7265 5f73       structure_s
+00032710: 6574 203d 2053 7472 7563 7475 7265 5365  et = StructureSe
+00032720: 7428 290a 2020 2020 2020 2020 2020 2020  t().            
+00032730: 7374 7275 6374 7572 655f 7365 742e 6164  structure_set.ad
+00032740: 645f 726f 6928 7365 6c66 290a 2020 2020  d_roi(self).    
+00032750: 2020 2020 2020 2020 7374 7275 6374 7572          structur
+00032760: 655f 7365 742e 7772 6974 6528 6f75 7464  e_set.write(outd
+00032770: 6972 3d6f 7574 6469 722c 2065 7874 3d65  ir=outdir, ext=e
+00032780: 7874 2c20 6f76 6572 7772 6974 653d 6f76  xt, overwrite=ov
+00032790: 6572 7772 6974 652c 0a20 2020 2020 2020  erwrite,.       
+000327a0: 2020 2020 2020 2020 2020 2020 2068 6561               hea
+000327b0: 6465 725f 736f 7572 6365 3d68 6561 6465  der_source=heade
+000327c0: 725f 736f 7572 6365 2c20 7061 7469 656e  r_source, patien
+000327d0: 745f 6964 3d70 6174 6965 6e74 5f69 642c  t_id=patient_id,
+000327e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000327f0: 2020 2020 2072 6f6f 745f 7569 643d 726f       root_uid=ro
+00032800: 6f74 5f75 6964 2c20 7665 7262 6f73 653d  ot_uid, verbose=
+00032810: 7665 7262 6f73 652c 0a20 2020 2020 2020  verbose,.       
+00032820: 2020 2020 2020 2020 2020 2020 2068 6561               hea
+00032830: 6465 725f 6578 7472 6173 3d68 6561 6465  der_extras=heade
+00032840: 725f 6578 7472 6173 290a 0a20 2020 2064  r_extras)..    d
+00032850: 6566 2074 7261 6e73 666f 726d 2873 656c  ef transform(sel
+00032860: 662c 2073 6361 6c65 3d31 2c20 7472 616e  f, scale=1, tran
+00032870: 736c 6174 696f 6e3d 5b30 2c20 302c 2030  slation=[0, 0, 0
+00032880: 5d2c 2072 6f74 6174 696f 6e3d 5b30 2c20  ], rotation=[0, 
+00032890: 302c 2030 5d2c 0a20 2020 2020 2020 2020  0, 0],.         
+000328a0: 2020 2063 656e 7472 653d 5b30 2c20 302c     centre=[0, 0,
+000328b0: 2030 5d2c 2072 6573 616d 706c 653d 2266   0], resample="f
+000328c0: 696e 6522 2c20 7265 7374 6f72 653d 5472  ine", restore=Tr
+000328d0: 7565 2c20 0a20 2020 2020 2020 2020 2020  ue, .           
+000328e0: 2066 696c 6c5f 7661 6c75 653d 4e6f 6e65   fill_value=None
+000328f0: 2c20 666f 7263 655f 636f 6e74 6f75 7273  , force_contours
+00032900: 3d46 616c 7365 293a 0a20 2020 2020 2020  =False):.       
+00032910: 2022 2222 0a20 2020 2020 2020 2041 7070   """.        App
+00032920: 6c79 2074 6872 6565 2d64 696d 656e 7369  ly three-dimensi
+00032930: 6f6e 616c 2073 696d 696c 6172 6974 7920  onal similarity 
+00032940: 7472 616e 7366 6f72 6d20 746f 2052 4f49  transform to ROI
+00032950: 2e0a 0a20 2020 2020 2020 2049 6620 7468  ...        If th
+00032960: 6520 7472 616e 7366 6f72 6d20 636f 7272  e transform corr
+00032970: 6573 706f 6e64 7320 746f 2061 2074 7261  esponds to a tra
+00032980: 6e73 6c61 7469 6f6e 2061 6e64 2f6f 7220  nslation and/or 
+00032990: 726f 7461 7469 6f6e 0a20 2020 2020 2020  rotation.       
+000329a0: 2061 626f 7574 2074 6865 207a 2d61 7869   about the z-axi
+000329b0: 732c 2061 6e64 2065 6974 6865 7220 7468  s, and either th
+000329c0: 6520 726f 6920 736f 7572 6365 2074 7970  e roi source typ
+000329d0: 6520 6973 2022 6469 636f 6d22 0a20 2020  e is "dicom".   
+000329e0: 2020 2020 206f 7220 666f 7263 652d 636f       or force-co
+000329f0: 6e74 6f75 7273 2069 7320 5472 7565 2c20  ntours is True, 
+00032a00: 7468 6520 7472 616e 7366 6f72 6d20 6973  the transform is
+00032a10: 2061 7070 6c69 6564 2074 6f20 636f 6e74   applied to cont
+00032a20: 6f75 720a 2020 2020 2020 2020 706f 696e  our.        poin
+00032a30: 7473 2061 6e64 2074 6865 2072 6f69 206d  ts and the roi m
+00032a40: 6173 6b20 6973 2073 6574 2061 7320 756e  ask is set as un
+00032a50: 6c6f 6164 6564 2e20 204f 7468 6572 7769  loaded.  Otherwi
+00032a60: 7365 2074 6865 2074 7261 6e73 666f 726d  se the transform
+00032a70: 0a20 2020 2020 2020 2069 7320 6170 706c  .        is appl
+00032a80: 6965 6420 746f 2074 6865 206d 6173 6b20  ied to the mask 
+00032a90: 616e 6420 636f 6e74 6f75 7273 2061 7265  and contours are
+00032aa0: 2073 6574 2061 7320 756e 6c6f 6164 6564   set as unloaded
+00032ab0: 2e0a 0a20 2020 2020 2020 2054 6865 2074  ...        The t
+00032ac0: 7261 6e73 666f 726d 2069 7320 6170 706c  ransform is appl
+00032ad0: 6965 6420 696e 2074 6865 206f 7264 6572  ied in the order
+00032ae0: 3a20 7472 616e 736c 6174 696f 6e2c 2073  : translation, s
+00032af0: 6361 6c69 6e67 2c0a 2020 2020 2020 2020  caling,.        
+00032b00: 726f 7461 7469 6f6e 2e20 2054 6865 206c  rotation.  The l
+00032b10: 6174 7465 7220 7477 6f20 6172 6520 6162  atter two are ab
+00032b20: 6f75 7420 7468 6520 6365 6e74 7265 2063  out the centre c
+00032b30: 6f6f 7264 696e 6174 6573 2e0a 0a20 2020  oordinates...   
+00032b40: 2020 2020 202a 2a50 6172 616d 6574 6572       **Parameter
+00032b50: 733a 2a2a 0a20 2020 2020 2020 200a 2020  s:**.        .  
+00032b60: 2020 2020 2020 666f 7263 655f 636f 6e74        force_cont
+00032b70: 6f75 7273 203a 2062 6f6f 6c2c 2064 6566  ours : bool, def
+00032b80: 6175 6c74 3d46 616c 7365 0a20 2020 2020  ault=False.     
+00032b90: 2020 2020 2020 2049 6620 5472 7565 2c20         If True, 
+00032ba0: 616e 6420 7468 6520 7472 616e 7366 6f72  and the transfor
+00032bb0: 6d20 636f 7272 6573 706f 6e64 7320 746f  m corresponds to
+00032bc0: 2061 2074 7261 6e73 6c61 7469 6f6e 0a20   a translation. 
+00032bd0: 2020 2020 2020 2020 2020 2061 6e64 2f6f             and/o
+00032be0: 7220 726f 7461 7469 6f6e 2061 626f 7574  r rotation about
+00032bf0: 2074 6865 207a 2d61 7869 732c 2061 7070   the z-axis, app
+00032c00: 6c79 2074 7261 6e73 666f 726d 2074 6f20  ly transform to 
+00032c10: 636f 6e74 6f75 720a 2020 2020 2020 2020  contour.        
+00032c20: 2020 2020 706f 696e 7473 2069 6e64 6570      points indep
+00032c30: 656e 6465 6e74 6c79 206f 6620 7468 6520  endently of the 
+00032c40: 6f72 6967 696e 616c 2064 6174 6120 736f  original data so
+00032c50: 7572 6365 2e0a 0a20 2020 2020 2020 2046  urce...        F
+00032c60: 6f72 206f 7468 6572 2070 6172 616d 6574  or other paramet
+00032c70: 6572 732c 2073 6565 2064 6f63 756d 656e  ers, see documen
+00032c80: 7461 7469 6f6e 2066 6f72 0a20 2020 2020  tation for.     
+00032c90: 2020 2073 6b72 742e 696d 6167 652e 496d     skrt.image.Im
+00032ca0: 6167 652e 7472 616e 7366 6f72 6d28 292e  age.transform().
+00032cb0: 2020 4e6f 7465 2074 6861 7420 7468 6520    Note that the 
+00032cc0: 6060 6f72 6465 7260 600a 2020 2020 2020  ``order``.      
+00032cd0: 2020 7061 7261 6d65 7465 7220 6973 6e27    parameter isn'
+00032ce0: 7420 6176 6169 6c61 626c 6520 666f 7220  t available for 
+00032cf0: 726f 6920 7472 616e 7366 6f72 6d73 202d  roi transforms -
+00032d00: 2061 2076 616c 7565 206f 6620 300a 2020   a value of 0.  
+00032d10: 2020 2020 2020 6973 2075 7365 6420 616c        is used al
+00032d20: 7761 7973 2e0a 2020 2020 2020 2020 2222  ways..        ""
+00032d30: 220a 0a20 2020 2020 2020 2023 2043 6865  "..        # Che
+00032d40: 636b 2077 6865 7468 6572 2074 7261 6e73  ck whether trans
+00032d50: 666f 726d 2069 7320 746f 2062 6520 6170  form is to be ap
+00032d60: 706c 6965 6420 746f 2063 6f6e 746f 7572  plied to contour
+00032d70: 730a 2020 2020 2020 2020 736d 616c 6c5f  s.        small_
+00032d80: 6e75 6d62 6572 203d 2031 2e65 2d36 0a20  number = 1.e-6. 
+00032d90: 2020 2020 2020 2074 7261 6e73 666f 726d         transform
+00032da0: 5f63 6f6e 746f 7572 7320 3d20 4661 6c73  _contours = Fals
+00032db0: 650a 2020 2020 2020 2020 6966 2073 656c  e.        if sel
+00032dc0: 662e 736f 7572 6365 5f74 7970 6520 3d3d  f.source_type ==
+00032dd0: 2027 636f 6e74 6f75 7227 206f 7220 666f   'contour' or fo
+00032de0: 7263 655f 636f 6e74 6f75 7273 3a0a 2020  rce_contours:.  
+00032df0: 2020 2020 2020 2020 2020 6966 2061 6273            if abs
+00032e00: 2873 6361 6c65 202d 2031 2920 3c20 736d  (scale - 1) < sm
+00032e10: 616c 6c5f 6e75 6d62 6572 3a0a 2020 2020  all_number:.    
+00032e20: 2020 2020 2020 2020 2020 2020 6966 2061              if a
+00032e30: 6273 2872 6f74 6174 696f 6e5b 305d 2920  bs(rotation[0]) 
+00032e40: 3c20 736d 616c 6c5f 6e75 6d62 6572 205c  < small_number \
+00032e50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00032e60: 2020 2020 2020 2020 2061 6e64 2061 6273           and abs
+00032e70: 2872 6f74 6174 696f 6e5b 315d 2920 3c20  (rotation[1]) < 
+00032e80: 736d 616c 6c5f 6e75 6d62 6572 3a0a 2020  small_number:.  
+00032e90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00032ea0: 2020 7472 616e 7366 6f72 6d5f 636f 6e74    transform_cont
+00032eb0: 6f75 7273 203d 2054 7275 650a 0a20 2020  ours = True..   
+00032ec0: 2020 2020 2069 6620 7472 616e 7366 6f72       if transfor
+00032ed0: 6d5f 636f 6e74 6f75 7273 3a0a 0a20 2020  m_contours:..   
+00032ee0: 2020 2020 2020 2020 2023 2041 7070 6c79           # Apply
+00032ef0: 2074 7261 6e73 666f 726d 2074 6f20 726f   transform to ro
+00032f00: 6920 636f 6e74 6f75 7273 0a20 2020 2020  i contours.     
+00032f10: 2020 2020 2020 2074 7261 6e73 6c61 7469         translati
+00032f20: 6f6e 5f32 6420 3d20 2874 7261 6e73 6c61  on_2d = (transla
+00032f30: 7469 6f6e 5b30 5d2c 2074 7261 6e73 6c61  tion[0], transla
+00032f40: 7469 6f6e 5b31 5d29 0a20 2020 2020 2020  tion[1]).       
+00032f50: 2020 2020 2063 656e 7472 655f 3264 203d       centre_2d =
+00032f60: 2028 6365 6e74 7265 5b30 5d2c 2063 656e   (centre[0], cen
+00032f70: 7472 655b 315d 290a 2020 2020 2020 2020  tre[1]).        
+00032f80: 2020 2020 616e 676c 6520 3d20 726f 7461      angle = rota
+00032f90: 7469 6f6e 5b32 5d0a 2020 2020 2020 2020  tion[2].        
+00032fa0: 2020 2020 6e65 775f 636f 6e74 6f75 7273      new_contours
+00032fb0: 203d 207b 7d0a 2020 2020 2020 2020 2020   = {}.          
+00032fc0: 2020 666f 7220 6b65 792c 2063 6f6e 746f    for key, conto
+00032fd0: 7572 7320 696e 2073 656c 662e 6765 745f  urs in self.get_
+00032fe0: 636f 6e74 6f75 7273 2829 2e69 7465 6d73  contours().items
+00032ff0: 2829 3a0a 2020 2020 2020 2020 2020 2020  ():.            
+00033000: 2020 2020 6e65 775f 6b65 7920 3d20 6b65      new_key = ke
+00033010: 7920 2b20 7472 616e 736c 6174 696f 6e5b  y + translation[
+00033020: 325d 0a20 2020 2020 2020 2020 2020 2020  2].             
+00033030: 2020 206e 6577 5f63 6f6e 746f 7572 735b     new_contours[
+00033040: 6e65 775f 6b65 795d 203d 205b 5d0a 2020  new_key] = [].  
+00033050: 2020 2020 2020 2020 2020 2020 2020 666f                fo
+00033060: 7220 636f 6e74 6f75 7220 696e 2063 6f6e  r contour in con
+00033070: 746f 7572 733a 0a20 2020 2020 2020 2020  tours:.         
+00033080: 2020 2020 2020 2020 2020 2070 6f6c 7967             polyg
+00033090: 6f6e 203d 2063 6f6e 746f 7572 5f74 6f5f  on = contour_to_
+000330a0: 706f 6c79 676f 6e28 636f 6e74 6f75 7229  polygon(contour)
+000330b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000330c0: 2020 2020 2070 6f6c 7967 6f6e 203d 2061       polygon = a
+000330d0: 6666 696e 6974 792e 7472 616e 736c 6174  ffinity.translat
+000330e0: 6528 706f 6c79 676f 6e2c 202a 7472 616e  e(polygon, *tran
+000330f0: 736c 6174 696f 6e5f 3264 290a 2020 2020  slation_2d).    
+00033100: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00033110: 706f 6c79 676f 6e20 3d20 6166 6669 6e69  polygon = affini
+00033120: 7479 2e72 6f74 6174 6528 706f 6c79 676f  ty.rotate(polygo
+00033130: 6e2c 2061 6e67 6c65 2c20 6365 6e74 7265  n, angle, centre
+00033140: 5f32 6429 0a20 2020 2020 2020 2020 2020  _2d).           
+00033150: 2020 2020 2020 2020 2070 6f6c 7967 6f6e           polygon
+00033160: 203d 2061 6666 696e 6974 792e 7363 616c   = affinity.scal
+00033170: 6528 706f 6c79 676f 6e2c 2073 6361 6c65  e(polygon, scale
+00033180: 2c20 7363 616c 652c 2073 6361 6c65 2c0a  , scale, scale,.
+00033190: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000331a0: 2020 2020 2020 2020 2020 2020 6365 6e74              cent
+000331b0: 7265 5f32 6429 0a20 2020 2020 2020 2020  re_2d).         
+000331c0: 2020 2020 2020 2020 2020 206e 6577 5f63             new_c
+000331d0: 6f6e 746f 7572 735b 6e65 775f 6b65 795d  ontours[new_key]
+000331e0: 2e61 7070 656e 6428 706f 6c79 676f 6e5f  .append(polygon_
+000331f0: 746f 5f63 6f6e 746f 7572 2870 6f6c 7967  to_contour(polyg
+00033200: 6f6e 2929 0a0a 2020 2020 2020 2020 2020  on))..          
+00033210: 2020 7365 6c66 2e72 6573 6574 5f63 6f6e    self.reset_con
+00033220: 746f 7572 7328 6e65 775f 636f 6e74 6f75  tours(new_contou
+00033230: 7273 290a 0a20 2020 2020 2020 2065 6c73  rs)..        els
+00033240: 653a 0a20 2020 2020 2020 2020 2020 2023  e:.            #
+00033250: 2041 7070 6c79 2074 7261 6e73 666f 726d   Apply transform
+00033260: 2074 6f20 726f 6920 6d61 736b 0a20 2020   to roi mask.   
+00033270: 2020 2020 2020 2020 2073 656c 662e 6372           self.cr
+00033280: 6561 7465 5f6d 6173 6b28 290a 2020 2020  eate_mask().    
+00033290: 2020 2020 2020 2020 7365 6c66 2e6d 6173          self.mas
+000332a0: 6b2e 7472 616e 7366 6f72 6d28 7363 616c  k.transform(scal
+000332b0: 652c 2074 7261 6e73 6c61 7469 6f6e 2c20  e, translation, 
+000332c0: 726f 7461 7469 6f6e 2c0a 2020 2020 2020  rotation,.      
+000332d0: 2020 2020 2020 2020 2020 2020 2020 6365                ce
+000332e0: 6e74 7265 2c20 7265 7361 6d70 6c65 2c20  ntre, resample, 
+000332f0: 7265 7374 6f72 652c 2030 2c20 6669 6c6c  restore, 0, fill
+00033300: 5f76 616c 7565 290a 2020 2020 2020 2020  _value).        
+00033310: 2020 2020 7365 6c66 2e72 6573 6574 5f6d      self.reset_m
+00033320: 6173 6b28 290a 0a20 2020 2064 6566 2063  ask()..    def c
+00033330: 726f 7028 7365 6c66 2c20 786c 696d 3d4e  rop(self, xlim=N
+00033340: 6f6e 652c 2079 6c69 6d3d 4e6f 6e65 2c20  one, ylim=None, 
+00033350: 7a6c 696d 3d4e 6f6e 6529 3a0a 2020 2020  zlim=None):.    
+00033360: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+00033370: 4372 6f70 2052 4f49 2074 6f20 7370 6563  Crop ROI to spec
+00033380: 6966 6965 6420 7261 6e67 6520 696e 2078  ified range in x
+00033390: 2c20 792c 207a 2e0a 0a20 2020 2020 2020  , y, z...       
+000333a0: 202a 2a50 6172 616d 6574 6572 733a 2a2a   **Parameters:**
+000333b0: 0a0a 2020 2020 2020 2020 786c 696d 203a  ..        xlim :
+000333c0: 2074 7570 6c65 2c20 6465 6661 756c 743d   tuple, default=
+000333d0: 4e6f 6e65 0a20 2020 2020 2020 2020 2020  None.           
+000333e0: 204c 6f77 6572 2061 6e64 2075 7070 6572   Lower and upper
+000333f0: 2062 6f75 6e64 7320 696e 206d 6d20 666f   bounds in mm fo
+00033400: 7220 6372 6f70 7069 6e67 2061 6c6f 6e67  r cropping along
+00033410: 2078 2d61 7869 732e 0a20 2020 2020 2020   x-axis..       
+00033420: 2020 2020 2049 6620 7365 7420 746f 204e       If set to N
+00033430: 6f6e 652c 206e 6f20 6372 6f70 7069 6e67  one, no cropping
+00033440: 2069 7320 7065 7266 6f72 6d65 642e 2020   is performed.  
+00033450: 4966 2061 2062 6f75 6e64 0a20 2020 2020  If a bound.     
+00033460: 2020 2020 2020 2069 7320 7365 7420 746f         is set to
+00033470: 204e 6f6e 652c 2074 6861 7420 626f 756e   None, that boun
+00033480: 6420 6973 2064 6973 7265 6761 7264 6564  d is disregarded
+00033490: 2e0a 0a20 2020 2020 2020 2079 6c69 6d20  ...        ylim 
+000334a0: 3a20 7475 706c 652c 2064 6566 6175 6c74  : tuple, default
+000334b0: 3d4e 6f6e 650a 2020 2020 2020 2020 2020  =None.          
+000334c0: 2020 4c6f 7765 7220 616e 6420 7570 7065    Lower and uppe
+000334d0: 7220 626f 756e 6473 2069 6e20 6d6d 2066  r bounds in mm f
+000334e0: 6f72 2063 726f 7070 696e 6720 616c 6f6e  or cropping alon
+000334f0: 6720 792d 6178 6973 2e0a 2020 2020 2020  g y-axis..      
+00033500: 2020 2020 2020 4966 2073 6574 2074 6f20        If set to 
+00033510: 4e6f 6e65 2c20 6e6f 2063 726f 7070 696e  None, no croppin
+00033520: 6720 6973 2070 6572 666f 726d 6564 2e20  g is performed. 
+00033530: 2049 6620 6120 626f 756e 640a 2020 2020   If a bound.    
+00033540: 2020 2020 2020 2020 6973 2073 6574 2074          is set t
+00033550: 6f20 4e6f 6e65 2c20 7468 6174 2062 6f75  o None, that bou
+00033560: 6e64 2069 7320 6469 7372 6567 6172 6465  nd is disregarde
+00033570: 642e 0a0a 2020 2020 2020 2020 7a6c 696d  d...        zlim
+00033580: 203a 2074 7570 6c65 2c20 6465 6661 756c   : tuple, defaul
+00033590: 743d 4e6f 6e65 0a20 2020 2020 2020 2020  t=None.         
+000335a0: 2020 204c 6f77 6572 2061 6e64 2075 7070     Lower and upp
+000335b0: 6572 2062 6f75 6e64 7320 696e 206d 6d20  er bounds in mm 
+000335c0: 666f 7220 6372 6f70 7069 6e67 2061 6c6f  for cropping alo
+000335d0: 6e67 207a 2d61 7869 732e 0a20 2020 2020  ng z-axis..     
+000335e0: 2020 2020 2020 2049 6620 7365 7420 746f         If set to
+000335f0: 204e 6f6e 652c 206e 6f20 6372 6f70 7069   None, no croppi
+00033600: 6e67 2069 7320 7065 7266 6f72 6d65 642e  ng is performed.
+00033610: 2020 4966 2061 2062 6f75 6e64 0a20 2020    If a bound.   
+00033620: 2020 2020 2020 2020 2069 7320 7365 7420           is set 
+00033630: 746f 204e 6f6e 652c 2074 6861 7420 626f  to None, that bo
+00033640: 756e 6420 6973 2064 6973 7265 6761 7264  und is disregard
+00033650: 6564 2e0a 0a20 2020 2020 2020 2049 6620  ed...        If 
+00033660: 6f6e 6c79 207a 6c69 6d20 6973 206e 6f74  only zlim is not
+00033670: 2073 6574 2074 6f20 4e6f 6e65 2061 6e64   set to None and
+00033680: 2074 6865 2052 4f49 2073 6f75 7263 6520   the ROI source 
+00033690: 7479 7065 2069 7320 2263 6f6e 746f 7572  type is "contour
+000336a0: 222c 0a20 2020 2020 2020 2063 726f 7070  ",.        cropp
+000336b0: 696e 6720 6973 2070 6572 666f 726d 6564  ing is performed
+000336c0: 2062 7920 6469 7363 6172 6469 6e67 2063   by discarding c
+000336d0: 6f6e 746f 7572 7320 6f75 7473 6964 6520  ontours outside 
+000336e0: 7468 6520 7265 7175 6972 6564 0a20 2020  the required.   
+000336f0: 2020 2020 2072 616e 6765 2e20 204f 7468       range.  Oth
+00033700: 7769 7365 2063 726f 7070 696e 6720 6973  wise cropping is
+00033710: 2070 6572 666f 726d 6564 206f 6e20 7468   performed on th
+00033720: 6520 524f 4920 6d61 736b 2e0a 2020 2020  e ROI mask..    
+00033730: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+00033740: 2320 466f 7220 6372 6f70 7069 6e67 2061  # For cropping a
+00033750: 6c6f 6e67 207a 2c20 616e 6420 7768 6572  long z, and wher
+00033760: 6520 524f 4920 6973 2064 6566 696e 6564  e ROI is defined
+00033770: 2066 726f 6d20 636f 6e74 6f75 7273 2c0a   from contours,.
+00033780: 2020 2020 2020 2020 2320 6469 7363 6172          # discar
+00033790: 6420 636f 6e74 6f75 7273 206f 7574 7369  d contours outsi
+000337a0: 6465 2063 726f 7020 7261 6e67 652e 0a20  de crop range.. 
+000337b0: 2020 2020 2020 2069 6620 7365 6c66 2e73         if self.s
+000337c0: 6f75 7263 655f 7479 7065 203d 3d20 2263  ource_type == "c
+000337d0: 6f6e 746f 7572 2220 616e 6420 7a6c 696d  ontour" and zlim
+000337e0: 2061 6e64 206e 6f74 2078 6c69 6d20 616e   and not xlim an
+000337f0: 6420 6e6f 7420 796c 696d 3a0a 2020 2020  d not ylim:.    
+00033800: 2020 2020 2020 2020 636f 6e74 6f75 7273          contours
+00033810: 203d 2073 656c 662e 6765 745f 636f 6e74   = self.get_cont
+00033820: 6f75 7273 2829 0a20 2020 2020 2020 2020  ours().         
+00033830: 2020 2069 6620 7a6c 696d 5b30 5d20 6973     if zlim[0] is
+00033840: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+00033850: 2020 2020 2020 207a 6c69 6d5b 305d 203d         zlim[0] =
+00033860: 206d 696e 2863 6f6e 746f 7572 7329 202d   min(contours) -
+00033870: 2031 0a20 2020 2020 2020 2020 2020 2069   1.            i
+00033880: 6620 7a6c 696d 5b31 5d20 6973 204e 6f6e  f zlim[1] is Non
+00033890: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+000338a0: 2020 207a 6c69 6d5b 315d 203d 206d 6178     zlim[1] = max
+000338b0: 2863 6f6e 746f 7572 7329 202b 2031 0a20  (contours) + 1. 
+000338c0: 2020 2020 2020 2020 2020 2063 6f6e 746f             conto
+000338d0: 7572 7320 3d20 7b7a 3a20 7a5f 636f 6e74  urs = {z: z_cont
+000338e0: 6f75 7273 2066 6f72 207a 2c20 7a5f 636f  ours for z, z_co
+000338f0: 6e74 6f75 7273 2069 6e20 636f 6e74 6f75  ntours in contou
+00033900: 7273 2e69 7465 6d73 2829 0a20 2020 2020  rs.items().     
+00033910: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00033920: 6620 287a 203e 207a 6c69 6d5b 305d 2061  f (z > zlim[0] a
+00033930: 6e64 207a 203c 207a 6c69 6d5b 315d 297d  nd z < zlim[1])}
+00033940: 0a0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
+00033950: 5265 7365 7420 636f 6e74 6f75 7273 2e0a  Reset contours..
+00033960: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00033970: 2e72 6573 6574 5f63 6f6e 746f 7572 7328  .reset_contours(
+00033980: 636f 6e74 6f75 7273 290a 0a20 2020 2020  contours)..     
+00033990: 2020 2023 2046 6f72 2061 6c6c 206f 7468     # For all oth
+000339a0: 6572 2063 6173 6573 2c20 6672 6f70 2052  er cases, frop R
+000339b0: 4f49 206d 6173 6b2e 0a20 2020 2020 2020  OI mask..       
+000339c0: 2065 6c69 6620 786c 696d 206f 7220 796c   elif xlim or yl
+000339d0: 696d 206f 7220 7a6c 696d 3a0a 2020 2020  im or zlim:.    
+000339e0: 2020 2020 2020 2020 7365 6c66 2e63 7265          self.cre
+000339f0: 6174 655f 6d61 736b 2829 0a20 2020 2020  ate_mask().     
+00033a00: 2020 2020 2020 200a 2020 2020 2020 2020         .        
+00033a10: 2020 2020 2320 456e 7375 7265 2074 6861      # Ensure tha
+00033a20: 7420 6372 6f70 2072 616e 6765 2061 6c6f  t crop range alo
+00033a30: 6e67 2065 6163 6820 6178 6973 2069 7320  ng each axis is 
+00033a40: 4e6f 6e65 0a20 2020 2020 2020 2020 2020  None.           
+00033a50: 2023 206f 7220 6120 7477 6f2d 656c 656d   # or a two-elem
+00033a60: 656e 7420 7475 706c 6520 6f66 2066 6c6f  ent tuple of flo
+00033a70: 6174 732e 0a20 2020 2020 2020 2020 2020  ats..           
+00033a80: 206c 696d 7320 3d20 5b78 6c69 6d2c 2079   lims = [xlim, y
+00033a90: 6c69 6d2c 207a 6c69 6d5d 0a20 2020 2020  lim, zlim].     
+00033aa0: 2020 2020 2020 206d 6173 6b5f 6578 7465         mask_exte
+00033ab0: 6e74 7320 3d20 7365 6c66 2e6d 6173 6b2e  nts = self.mask.
+00033ac0: 6765 745f 6578 7465 6e74 7328 290a 2020  get_extents().  
+00033ad0: 2020 2020 2020 2020 2020 666f 7220 695f            for i_
+00033ae0: 6178 2c20 6c69 6d20 696e 2065 6e75 6d65  ax, lim in enume
+00033af0: 7261 7465 286c 696d 7329 3a0a 2020 2020  rate(lims):.    
+00033b00: 2020 2020 2020 2020 2020 2020 6966 206c              if l
+00033b10: 696d 3a0a 2020 2020 2020 2020 2020 2020  im:.            
+00033b20: 2020 2020 2020 2020 666f 7220 6964 7820          for idx 
+00033b30: 696e 205b 302c 2031 5d3a 0a20 2020 2020  in [0, 1]:.     
+00033b40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00033b50: 2020 2069 6620 6c69 6d5b 6964 785d 2069     if lim[idx] i
+00033b60: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
+00033b70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00033b80: 2020 2020 6c69 6d73 5b69 5f61 785d 5b69      lims[i_ax][i
+00033b90: 6478 5d20 3d20 6d61 736b 5f65 7874 656e  dx] = mask_exten
+00033ba0: 7473 5b69 5f61 785d 5b69 6478 5d0a 2020  ts[i_ax][idx].  
+00033bb0: 2020 2020 2020 2020 2020 2020 2020 656c                el
+00033bc0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+00033bd0: 2020 2020 2020 2020 6c69 6d73 5b69 5f61          lims[i_a
+00033be0: 785d 203d 204e 6f6e 650a 0a20 2020 2020  x] = None..     
+00033bf0: 2020 2020 2020 2023 204c 6f6f 7020 6f76         # Loop ov
+00033c00: 6572 2061 7865 732e 0a20 2020 2020 2020  er axes..       
+00033c10: 2020 2020 2066 6f72 2069 5f61 782c 206c       for i_ax, l
+00033c20: 696d 2069 6e20 656e 756d 6572 6174 6528  im in enumerate(
+00033c30: 6c69 6d73 293a 0a0a 2020 2020 2020 2020  lims):..        
+00033c40: 2020 2020 2020 2020 6966 206c 696d 2069          if lim i
+00033c50: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
+00033c60: 2020 2020 2020 2020 2020 2020 636f 6e74              cont
+00033c70: 696e 7565 0a0a 2020 2020 2020 2020 2020  inue..          
+00033c80: 2020 2020 2020 2320 4669 6e64 2061 7272        # Find arr
+00033c90: 6179 2069 6e64 6963 6573 2061 7420 7768  ay indices at wh
+00033ca0: 6963 6820 746f 2063 726f 702e 0a20 2020  ich to crop..   
+00033cb0: 2020 2020 2020 2020 2020 2020 2069 3120               i1 
+00033cc0: 3d20 7365 6c66 2e6d 6173 6b2e 706f 735f  = self.mask.pos_
+00033cd0: 746f 5f69 6478 280a 2020 2020 2020 2020  to_idx(.        
+00033ce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00033cf0: 6c69 6d73 5b69 5f61 785d 5b30 5d2c 2061  lims[i_ax][0], a
+00033d00: 783d 695f 6178 2c20 7265 7475 726e 5f69  x=i_ax, return_i
+00033d10: 6e74 3d46 616c 7365 290a 2020 2020 2020  nt=False).      
+00033d20: 2020 2020 2020 2020 2020 6932 203d 2073            i2 = s
+00033d30: 656c 662e 6d61 736b 2e70 6f73 5f74 6f5f  elf.mask.pos_to_
+00033d40: 6964 7828 6c69 6d73 5b69 5f61 785d 5b31  idx(lims[i_ax][1
+00033d50: 5d2c 2061 783d 695f 6178 2c0a 2020 2020  ], ax=i_ax,.    
+00033d60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00033d70: 2020 2020 7265 7475 726e 5f69 6e74 3d46      return_int=F
+00033d80: 616c 7365 290a 2020 2020 2020 2020 2020  alse).          
+00033d90: 2020 2020 2020 695f 6269 672c 2069 5f73        i_big, i_s
+00033da0: 6d61 6c6c 203d 2069 322c 2069 310a 2020  mall = i2, i1.  
+00033db0: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00033dc0: 2069 3120 3e20 6932 3a0a 2020 2020 2020   i1 > i2:.      
+00033dd0: 2020 2020 2020 2020 2020 2020 2020 695f                i_
+00033de0: 6269 672c 2069 5f73 6d61 6c6c 203d 2069  big, i_small = i
+00033df0: 5f73 6d61 6c6c 2c20 695f 6269 670a 2020  _small, i_big.  
+00033e00: 2020 2020 2020 2020 2020 2020 2020 695f                i_
+00033e10: 736d 616c 6c20 3d20 696e 7428 6e70 2e66  small = int(np.f
+00033e20: 6c6f 6f72 2869 5f73 6d61 6c6c 202b 2030  loor(i_small + 0
+00033e30: 2e35 2929 0a20 2020 2020 2020 2020 2020  .5)).           
+00033e40: 2020 2020 2069 5f62 6967 203d 2069 6e74       i_big = int
+00033e50: 286e 702e 666c 6f6f 7228 695f 6269 6720  (np.floor(i_big 
+00033e60: 2b20 302e 3529 290a 0a20 2020 2020 2020  + 0.5))..       
+00033e70: 2020 2020 2020 2020 2023 2043 726f 7020           # Crop 
+00033e80: 7468 6520 6d61 736b 2e0a 2020 2020 2020  the mask..      
+00033e90: 2020 2020 2020 2020 2020 6178 5f74 6f5f            ax_to_
+00033ea0: 736c 6963 6520 3d20 7365 6c66 2e6d 6173  slice = self.mas
+00033eb0: 6b2e 6765 745f 6178 6573 2829 2e69 6e64  k.get_axes().ind
+00033ec0: 6578 2869 5f61 7829 0a20 2020 2020 2020  ex(i_ax).       
+00033ed0: 2020 2020 2020 2020 2069 6620 695f 736d           if i_sm
+00033ee0: 616c 6c20 3e20 3020 616e 6420 695f 736d  all > 0 and i_sm
+00033ef0: 616c 6c20 3c20 7365 6c66 2e6d 6173 6b2e  all < self.mask.
+00033f00: 6e5f 766f 7865 6c73 5b69 5f61 785d 3a0a  n_voxels[i_ax]:.
+00033f10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00033f20: 2020 2020 7365 6c66 2e6d 6173 6b2e 6461      self.mask.da
+00033f30: 7461 2e73 7761 7061 7865 7328 302c 2061  ta.swapaxes(0, a
+00033f40: 785f 746f 5f73 6c69 6365 295b 3a69 5f73  x_to_slice)[:i_s
+00033f50: 6d61 6c6c 2c20 3a2c 203a 5d20 3d20 300a  mall, :, :] = 0.
+00033f60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00033f70: 6966 2069 5f62 6967 203e 2030 2061 6e64  if i_big > 0 and
+00033f80: 2069 5f62 6967 203c 2073 656c 662e 6d61   i_big < self.ma
+00033f90: 736b 2e6e 5f76 6f78 656c 735b 695f 6178  sk.n_voxels[i_ax
+00033fa0: 5d3a 0a20 2020 2020 2020 2020 2020 2020  ]:.             
+00033fb0: 2020 2020 2020 2073 656c 662e 6d61 736b         self.mask
+00033fc0: 2e64 6174 612e 7377 6170 6178 6573 2830  .data.swapaxes(0
+00033fd0: 2c20 6178 5f74 6f5f 736c 6963 6529 5b69  , ax_to_slice)[i
+00033fe0: 5f62 6967 3a2c 203a 2c20 3a5d 203d 2030  _big:, :, :] = 0
+00033ff0: 0a0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
+00034000: 5265 7365 7420 6d61 736b 2e0a 2020 2020  Reset mask..    
+00034010: 2020 2020 2020 2020 7365 6c66 2e72 6573          self.res
+00034020: 6574 5f6d 6173 6b28 7365 6c66 2e6d 6173  et_mask(self.mas
+00034030: 6b29 0a0a 2020 2020 6465 6620 6372 6f70  k)..    def crop
+00034040: 5f62 795f 616d 6f75 6e74 7328 7365 6c66  _by_amounts(self
+00034050: 2c20 6478 3d4e 6f6e 652c 2064 793d 4e6f  , dx=None, dy=No
+00034060: 6e65 2c20 647a 3d4e 6f6e 6529 3a0a 2020  ne, dz=None):.  
+00034070: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+00034080: 2020 4372 6f70 2052 4f49 2062 7920 7468    Crop ROI by th
+00034090: 6520 616d 6f75 6e74 7320 6478 2c20 6479  e amounts dx, dy
+000340a0: 2c20 647a 2069 6e20 6d6d 2e0a 0a20 2020  , dz in mm...   
+000340b0: 2020 2020 2054 6869 7320 6d65 7468 6f64       This method
+000340c0: 2063 616c 6c73 2074 6865 2066 756e 6374   calls the funct
+000340d0: 696f 6e20 736b 7274 2e69 6d61 6765 2e63  ion skrt.image.c
+000340e0: 726f 705f 6279 5f61 6d6f 756e 7473 2829  rop_by_amounts()
+000340f0: 2c20 7769 7468 0a20 2020 2020 2020 2073  , with.        s
+00034100: 656c 6620 7061 7373 6564 2061 7320 6f62  elf passed as ob
+00034110: 6a65 6374 2066 6f72 2063 726f 7070 696e  ject for croppin
+00034120: 672e 0a0a 2020 2020 2020 2020 5468 6520  g...        The 
+00034130: 616d 6f75 6e74 206f 6620 6372 6f70 7069  amount of croppi
+00034140: 6e67 2061 6c6f 6e67 2065 6163 6820 6469  ng along each di
+00034150: 7265 6374 696f 6e20 7368 6f75 6c64 2062  rection should b
+00034160: 6520 6f6e 6520 6f66 3a0a 2020 2020 2020  e one of:.      
+00034170: 2020 2d20 666c 6f61 7420 3a20 7468 6520    - float : the 
+00034180: 524f 4920 6973 2063 726f 7070 6564 2062  ROI is cropped b
+00034190: 7920 7468 6973 2061 6d6f 756e 7420 6f6e  y this amount on
+000341a0: 2062 6f74 6820 7369 6465 733b 0a20 2020   both sides;.   
+000341b0: 2020 2020 202d 2074 776f 2d65 6c65 6d65       - two-eleme
+000341c0: 6e74 2074 7570 6c65 3a20 7468 6520 524f  nt tuple: the RO
+000341d0: 4920 6973 2063 726f 7070 6564 206f 6e20  I is cropped on 
+000341e0: 7468 6520 7369 6465 7320 6f66 206c 6f77  the sides of low
+000341f0: 6572 0a20 2020 2020 2020 2020 2061 6e64  er.          and
+00034200: 2068 6967 6865 7220 7661 6c75 6573 2062   higher values b
+00034210: 7920 7468 6520 616d 6f75 6e74 7320 7370  y the amounts sp
+00034220: 6563 6966 6965 643b 0a20 2020 2020 2020  ecified;.       
+00034230: 202d 204e 6f6e 6520 3a20 6e6f 2063 726f   - None : no cro
+00034240: 7070 696e 6720 6973 2070 6572 666f 726d  pping is perform
+00034250: 6564 2e0a 0a20 2020 2020 2020 2046 6f72  ed...        For
+00034260: 206d 6f72 6520 6465 7461 696c 732c 2073   more details, s
+00034270: 6565 2064 6f63 756d 656e 7461 7469 6f6e  ee documentation
+00034280: 206f 6620 736b 7274 2e69 6d61 6765 2e63   of skrt.image.c
+00034290: 726f 705f 6279 5f61 6d6f 756e 7473 2829  rop_by_amounts()
+000342a0: 2e0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
+000342b0: 2020 2020 2020 736b 7274 2e69 6d61 6765        skrt.image
+000342c0: 2e63 726f 705f 6279 5f61 6d6f 756e 7473  .crop_by_amounts
+000342d0: 2873 656c 662c 2064 782c 2064 792c 2064  (self, dx, dy, d
+000342e0: 7a29 0a0a 2020 2020 6465 6620 6372 6f70  z)..    def crop
+000342f0: 5f74 6f5f 726f 695f 6c65 6e67 7468 2873  _to_roi_length(s
+00034300: 656c 662c 206f 7468 6572 2c20 6178 3d22  elf, other, ax="
+00034310: 7a22 293a 0a20 2020 2020 2020 2022 2222  z"):.        """
+00034320: 0a20 2020 2020 2020 2043 726f 7020 746f  .        Crop to
+00034330: 206c 656e 6774 6820 6f66 206f 7468 6572   length of other
+00034340: 2052 4f49 2061 6c6f 6e67 2061 2067 6976   ROI along a giv
+00034350: 656e 2061 7869 732e 0a0a 2020 2020 2020  en axis...      
+00034360: 2020 2a2a 5061 7261 6d65 7465 7273 3a2a    **Parameters:*
+00034370: 2a0a 2020 2020 2020 2020 6f74 6865 7220  *.        other 
+00034380: 3a20 736b 7274 2e73 7472 7563 7475 7265  : skrt.structure
+00034390: 732e 524f 490a 2020 2020 2020 2020 2020  s.ROI.          
+000343a0: 2020 524f 4920 6f62 6a65 6374 2074 6f20    ROI object to 
+000343b0: 7768 6963 6820 746f 2063 726f 702e 0a20  which to crop.. 
+000343c0: 2020 2020 2020 2020 2020 0a20 2020 2020            .     
+000343d0: 2020 2061 7820 3a20 7374 722f 696e 742c     ax : str/int,
+000343e0: 2064 6566 6175 6c74 3d22 7a22 0a20 2020   default="z".   
+000343f0: 2020 2020 2020 2020 2041 7869 7320 616c           Axis al
+00034400: 6f6e 6720 7768 6963 6820 746f 2070 6572  ong which to per
+00034410: 666f 726d 2063 726f 7070 696e 672e 2053  form cropping. S
+00034420: 686f 756c 6420 6265 206f 6e65 206f 660a  hould be one of.
+00034430: 2020 2020 2020 2020 2020 2020 5b22 7822              ["x"
+00034440: 2c20 2279 222c 2022 7a22 5d20 6f72 205b  , "y", "z"] or [
+00034450: 302c 2031 2c20 325d 2e0a 2020 2020 2020  0, 1, 2]..      
+00034460: 2020 2222 220a 2020 2020 2020 2020 2320    """.        # 
+00034470: 4465 7465 726d 696e 6520 6372 6f70 2072  Determine crop r
+00034480: 616e 6765 2e0a 2020 2020 2020 2020 6c69  ange..        li
+00034490: 6d73 203d 2033 202a 205b 4e6f 6e65 5d0a  ms = 3 * [None].
+000344a0: 2020 2020 2020 2020 695f 6178 203d 2073          i_ax = s
+000344b0: 6b72 742e 696d 6167 652e 5f61 7865 732e  krt.image._axes.
+000344c0: 696e 6465 7828 6178 2920 6966 2069 7369  index(ax) if isi
+000344d0: 6e73 7461 6e63 6528 6178 2c20 7374 7229  nstance(ax, str)
+000344e0: 2065 6c73 6520 6178 0a20 2020 2020 2020   else ax.       
+000344f0: 206c 696d 735b 695f 6178 5d20 3d20 6f74   lims[i_ax] = ot
+00034500: 6865 722e 6765 745f 6578 7465 6e74 2861  her.get_extent(a
+00034510: 783d 6178 290a 0a20 2020 2020 2020 2023  x=ax)..        #
+00034520: 2050 6572 666f 726d 2063 726f 7070 696e   Perform croppin
+00034530: 672e 0a20 2020 2020 2020 2073 656c 662e  g..        self.
+00034540: 6372 6f70 282a 6c69 6d73 290a 0a20 2020  crop(*lims)..   
+00034550: 2064 6566 2063 726f 705f 746f 5f72 6f69   def crop_to_roi
+00034560: 2873 656c 662c 2072 6f69 2c20 2a2a 6b77  (self, roi, **kw
+00034570: 6172 6773 293a 0a20 2020 2020 2020 2022  args):.        "
+00034580: 2222 0a20 2020 2020 2020 2043 726f 7020  "".        Crop 
+00034590: 524f 4920 6d61 736b 2074 6f20 7265 6769  ROI mask to regi
+000345a0: 6f6e 2063 6f76 6572 6564 2062 7920 616e  on covered by an
+000345b0: 2052 4f49 2e0a 2020 2020 2020 2020 2222   ROI..        ""
+000345c0: 220a 2020 2020 2020 2020 7365 6c66 2e63  ".        self.c
+000345d0: 7265 6174 655f 6d61 736b 2829 0a20 2020  reate_mask().   
+000345e0: 2020 2020 2073 656c 662e 6d61 736b 2e63       self.mask.c
+000345f0: 726f 705f 746f 5f72 6f69 2872 6f69 2c20  rop_to_roi(roi, 
+00034600: 2a2a 6b77 6172 6773 290a 2020 2020 2020  **kwargs).      
+00034610: 2020 7365 6c66 2e73 6861 7065 203d 2073    self.shape = s
+00034620: 656c 662e 6765 745f 6d61 736b 2829 2e73  elf.get_mask().s
+00034630: 6861 7065 0a0a 2020 2020 6465 6620 6164  hape..    def ad
+00034640: 645f 706c 616e 2873 656c 662c 2070 6c61  d_plan(self, pla
+00034650: 6e29 3a0a 2020 2020 2020 2020 2222 2241  n):.        """A
+00034660: 6464 2061 2050 6c61 6e20 6f62 6a65 6374  dd a Plan object
+00034670: 2074 6f20 6265 2061 7373 6f63 6961 7465   to be associate
+00034680: 6420 7769 7468 2074 6869 7320 524f 492e  d with this ROI.
+00034690: 2054 6869 730a 2020 2020 2020 2020 646f   This.        do
+000346a0: 6573 206e 6f74 2061 6666 6563 7420 7468  es not affect th
+000346b0: 6520 7374 7275 6374 7572 6520 7365 7420  e structure set 
+000346c0: 6173 736f 6369 6174 6564 2077 6974 6820  associated with 
+000346d0: 7468 6520 506c 616e 206f 626a 6563 742e  the Plan object.
+000346e0: 0a0a 2020 2020 2020 2020 2a2a 5061 7261  ..        **Para
+000346f0: 6d65 7465 7273 3a2a 2a0a 0a20 2020 2020  meters:**..     
+00034700: 2020 2070 6c61 6e20 3a20 736b 7274 2e64     plan : skrt.d
+00034710: 6f73 652e 506c 616e 0a20 2020 2020 2020  ose.Plan.       
+00034720: 2020 2020 2041 2050 6c61 6e20 6f62 6a65       A Plan obje
+00034730: 6374 2074 6f20 6173 7369 676e 2074 6f20  ct to assign to 
+00034740: 7468 6973 2073 7472 7563 7475 7265 2073  this structure s
+00034750: 6574 2e0a 2020 2020 2020 2020 2222 220a  et..        """.
+00034760: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
+00034770: 706c 616e 2069 6e20 7365 6c66 2e70 6c61  plan in self.pla
+00034780: 6e73 3a0a 2020 2020 2020 2020 2020 2020  ns:.            
+00034790: 7365 6c66 2e70 6c61 6e73 2e61 7070 656e  self.plans.appen
+000347a0: 6428 706c 616e 290a 2020 2020 2020 2020  d(plan).        
+000347b0: 2020 2020 7365 6c66 2e70 6c61 6e73 2e73      self.plans.s
+000347c0: 6f72 7428 290a 0a20 2020 2064 6566 2063  ort()..    def c
+000347d0: 6c65 6172 5f70 6c61 6e73 2873 656c 6629  lear_plans(self)
+000347e0: 3a0a 2020 2020 2020 2020 2222 2243 6c65  :.        """Cle
+000347f0: 6172 2061 6c6c 2070 6c61 6e20 6d61 7073  ar all plan maps
+00034800: 2061 7373 6f63 6961 7465 6420 7769 7468   associated with
+00034810: 2074 6869 7320 524f 492e 2222 220a 0a20   this ROI.""".. 
+00034820: 2020 2020 2020 2073 656c 662e 706c 616e         self.plan
+00034830: 7320 3d20 5b5d 0a0a 2020 2020 6465 6620  s = []..    def 
+00034840: 6765 745f 706c 616e 7328 7365 6c66 293a  get_plans(self):
+00034850: 0a20 2020 2020 2020 2022 2222 5265 7475  .        """Retu
+00034860: 726e 206c 6973 7420 6f66 2050 6c61 6e20  rn list of Plan 
+00034870: 6f62 6a65 6374 7320 6173 736f 6369 6174  objects associat
+00034880: 6564 2077 6974 6820 7468 6973 2052 4f49  ed with this ROI
+00034890: 2e22 2222 0a0a 2020 2020 2020 2020 7265  ."""..        re
+000348a0: 7475 726e 2073 656c 662e 706c 616e 730a  turn self.plans.
+000348b0: 0a20 2020 2064 6566 2067 6574 5f63 6f6c  .    def get_col
+000348c0: 6f72 5f66 726f 6d5f 6b77 6172 6773 2873  or_from_kwargs(s
+000348d0: 656c 662c 206b 7761 7267 733d 7b7d 2c20  elf, kwargs={}, 
+000348e0: 6b65 793d 2772 6f69 5f63 6f6c 6f72 7327  key='roi_colors'
+000348f0: 293a 0a20 2020 2020 2020 2027 2727 0a20  ):.        '''. 
+00034900: 2020 2020 2020 2052 6574 7572 6e20 524f         Return RO
+00034910: 4920 636f 6c6f 7572 2070 6173 7365 6420  I colour passed 
+00034920: 7669 6120 6469 6374 696f 6e61 7279 206f  via dictionary o
+00034930: 6620 6b65 7977 6f72 6420 6172 6775 6d65  f keyword argume
+00034940: 6e74 732e 0a0a 2020 2020 2020 2020 2a2a  nts...        **
+00034950: 5061 7261 6d65 7465 7273 3a2a 2a0a 0a20  Parameters:**.. 
+00034960: 2020 2020 2020 206b 7761 7267 7320 3a20         kwargs : 
+00034970: 6469 6374 2c20 6465 6661 756c 743d 7b7d  dict, default={}
+00034980: 0a20 2020 2020 2020 2020 2020 2044 6963  .            Dic
+00034990: 7469 6f6e 6172 7920 6f66 206b 6579 776f  tionary of keywo
+000349a0: 7264 2061 7267 756d 656e 7473 2c20 7768  rd arguments, wh
+000349b0: 6963 6820 6d61 7920 696e 636c 7564 650a  ich may include.
+000349c0: 2020 2020 2020 2020 2020 2020 7061 7261              para
+000349d0: 6d65 7465 7220 7072 6f76 6964 696e 6720  meter providing 
+000349e0: 6469 6374 696f 6e61 7279 206f 6620 524f  dictionary of RO
+000349f0: 4920 636f 6c6f 7572 7320 666f 7220 706c  I colours for pl
+00034a00: 6f74 7469 6e67 2e0a 0a20 2020 2020 2020  otting...       
+00034a10: 206b 6579 203a 2073 7472 2c20 6465 6661   key : str, defa
+00034a20: 756c 743d 2772 6f69 5f63 6f6c 6f72 7327  ult='roi_colors'
+00034a30: 0a20 2020 2020 2020 2020 2020 204b 6579  .            Key
+00034a40: 2069 6e20 6b77 6172 6773 2064 6963 7469   in kwargs dicti
+00034a50: 6f6e 6172 7920 7370 6563 6966 7969 6e67  onary specifying
+00034a60: 2070 6172 616d 6574 6572 2074 6861 742c   parameter that,
+00034a70: 2069 660a 2020 2020 2020 2020 2020 2020   if.            
+00034a80: 7072 6573 656e 742c 2070 726f 7669 6465  present, provide
+00034a90: 7320 6469 6374 696f 6e61 7279 206f 6620  s dictionary of 
+00034aa0: 524f 4920 636f 6c6f 7572 732e 0a20 2020  ROI colours..   
+00034ab0: 2020 2020 2027 2727 0a20 2020 2020 2020       '''.       
+00034ac0: 2072 6f69 5f63 6f6c 6f72 7320 3d20 6b77   roi_colors = kw
+00034ad0: 6172 6773 2e67 6574 286b 6579 2c20 7b7d  args.get(key, {}
+00034ae0: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
+00034af0: 2072 6f69 5f63 6f6c 6f72 732e 6765 7428   roi_colors.get(
+00034b00: 7365 6c66 2e6e 616d 652c 2073 656c 662e  self.name, self.
+00034b10: 636f 6c6f 7229 0a0a 2020 2020 6465 6620  color)..    def 
+00034b20: 7370 6c69 7428 7365 6c66 2c20 766f 7865  split(self, voxe
+00034b30: 6c5f 7369 7a65 3d4e 6f6e 652c 206e 616d  l_size=None, nam
+00034b40: 6573 3d4e 6f6e 652c 206f 7264 6572 3d27  es=None, order='
+00034b50: 782b 2729 3a0a 2020 2020 2020 2020 2727  x+'):.        ''
+00034b60: 270a 2020 2020 2020 2020 5370 6c69 7420  '.        Split 
+00034b70: 6120 636f 6d70 6f73 6974 6520 524f 4920  a composite ROI 
+00034b80: 696e 746f 2069 7473 2063 6f6d 706f 6e65  into its compone
+00034b90: 6e74 732e 0a0a 2020 2020 2020 2020 4120  nts...        A 
+00034ba0: 636f 6d70 6f73 6974 6520 524f 4920 6d61  composite ROI ma
+00034bb0: 7920 7265 7375 6c74 2062 6563 6175 7365  y result because
+00034bc0: 2070 6879 6963 616c 6c79 2073 6570 6172   phyically separ
+00034bd0: 6174 6520 524f 4973 2061 7265 0a20 2020  ate ROIs are.   
+00034be0: 2020 2020 2067 6976 656e 2074 6865 2073       given the s
+00034bf0: 616d 6520 6c61 6265 6c20 6475 7269 6e67  ame label during
+00034c00: 206d 616e 7561 6c20 636f 6e74 6f75 7269   manual contouri
+00034c10: 6e67 2c20 6f72 2062 6563 6175 7365 0a20  ng, or because. 
+00034c20: 2020 2020 2020 206d 756c 7469 706c 6520         multiple 
+00034c30: 524f 4973 2061 7265 2072 6574 7572 6e65  ROIs are returne
+00034c40: 6420 6279 2061 6e20 6175 746f 2d73 6567  d by an auto-seg
+00034c50: 6d65 6e74 6174 696f 6e20 616c 676f 7269  mentation algori
+00034c60: 7468 6d2e 0a0a 2020 2020 2020 2020 5468  thm...        Th
+00034c70: 6520 636f 6d70 6f6e 656e 7420 524f 4973  e component ROIs
+00034c80: 2061 7265 2069 6465 6e74 6966 6965 6420   are identified 
+00034c90: 6279 206c 6162 656c 6c69 6e67 2061 206d  by labelling a m
+00034ca0: 6173 6b20 6f66 2074 6865 0a20 2020 2020  ask of the.     
+00034cb0: 2020 2063 6f6d 706f 7369 7465 2c20 7573     composite, us
+00034cc0: 696e 6720 7363 6970 792e 6e64 696d 6167  ing scipy.ndimag
+00034cd0: 652e 6c61 6265 6c28 292e 0a0a 2020 2020  e.label()...    
+00034ce0: 2020 2020 2a2a 5061 7261 6d65 7465 7273      **Parameters
+00034cf0: 3a2a 2a0a 0a20 2020 2020 2020 2076 6f78  :**..        vox
+00034d00: 656c 5f73 697a 6520 3a20 7475 706c 652c  el_size : tuple,
+00034d10: 2064 6566 6175 6c74 3d4e 6f6e 650a 2020   default=None.  
+00034d20: 2020 2020 2020 2020 2020 566f 7865 6c20            Voxel 
+00034d30: 7369 7a65 2028 782c 2079 2920 6469 6d65  size (x, y) dime
+00034d40: 6e73 696f 6e73 2074 6f20 7573 6520 696e  nsions to use in
+00034d50: 2063 7265 6174 696e 6720 6d61 736b 2066   creating mask f
+00034d60: 6f72 0a20 2020 2020 2020 2020 2020 206c  or.            l
+00034d70: 6162 656c 6c69 6e67 2e20 2054 6869 7320  abelling.  This 
+00034d80: 6361 6e20 6265 2075 7365 6675 6c20 6966  can be useful if
+00034d90: 2074 6865 2052 4f49 2073 6f75 7263 6520   the ROI source 
+00034da0: 6973 2063 6f6e 746f 7572 0a20 2020 2020  is contour.     
+00034db0: 2020 2020 2020 2070 6f69 6e74 732c 2061         points, a
+00034dc0: 6e64 2074 6865 2072 6573 6f6c 7574 696f  nd the resolutio
+00034dd0: 6e20 7761 6e74 6564 2069 7320 6772 6561  n wanted is grea
+00034de0: 7465 7220 7468 616e 2069 7320 616c 6c6f  ter than is allo
+00034df0: 7765 640a 2020 2020 2020 2020 2020 2020  wed.            
+00034e00: 6279 2074 6865 2076 6f78 656c 2073 697a  by the voxel siz
+00034e10: 6520 6f66 2074 6865 2052 4f49 2069 6d61  e of the ROI ima
+00034e20: 6765 2e0a 0a20 2020 2020 2020 206e 616d  ge...        nam
+00034e30: 6573 3a20 6c69 7374 2c20 6465 6661 756c  es: list, defaul
+00034e40: 743d 4e6f 6e65 0a20 2020 2020 2020 2020  t=None.         
+00034e50: 2020 204c 6973 7420 6f66 206e 616d 6573     List of names
+00034e60: 2074 6f20 6265 2061 7070 6c69 6564 2074   to be applied t
+00034e70: 6f20 7468 6520 636f 6d70 6f6e 656e 7420  o the component 
+00034e80: 524f 4973 2e20 204e 616d 6573 0a20 2020  ROIs.  Names.   
+00034e90: 2020 2020 2020 2020 2061 7265 2061 7070           are app
+00034ea0: 6c69 6564 2061 6674 6572 2061 6e79 2052  lied after any R
+00034eb0: 4f49 206f 7264 6572 696e 672e 0a0a 2020  OI ordering...  
+00034ec0: 2020 2020 2020 6f72 6465 7220 3a20 7374        order : st
+00034ed0: 722c 2064 6566 6175 6c74 3d27 782b 270a  r, default='x+'.
+00034ee0: 2020 2020 2020 2020 2020 2020 5370 6563              Spec
+00034ef0: 6966 6963 6174 696f 6e20 6f66 2077 6179  ification of way
+00034f00: 2069 7420 7768 6963 6820 524f 4973 2061   it which ROIs a
+00034f10: 7265 2074 6f20 6265 206f 7264 6572 643a  re to be orderd:
+00034f20: 0a20 2020 2020 2020 2020 2020 202d 2027  .            - '
+00034f30: 782b 2720 3a20 696e 206f 7264 6572 206f  x+' : in order o
+00034f40: 6620 696e 6372 6561 7369 6e67 2078 2076  f increasing x v
+00034f50: 616c 7565 2e0a 2020 2020 2020 2020 2020  alue..          
+00034f60: 2020 2d20 2778 2d27 203a 2069 6e20 6f72    - 'x-' : in or
+00034f70: 6465 7220 6f66 2064 6563 7265 6173 696e  der of decreasin
+00034f80: 6720 7820 7661 6c75 652e 0a20 2020 2020  g x value..     
+00034f90: 2020 2020 2020 202d 2027 792b 2720 3a20         - 'y+' : 
+00034fa0: 696e 206f 7264 6572 206f 6620 696e 6372  in order of incr
+00034fb0: 6561 7369 6e67 2079 2076 616c 7565 2e0a  easing y value..
+00034fc0: 2020 2020 2020 2020 2020 2020 2d20 2779              - 'y
+00034fd0: 2d27 203a 2069 6e20 6f72 6465 7220 6f66  -' : in order of
+00034fe0: 2064 6563 7265 6173 696e 6720 7920 7661   decreasing y va
+00034ff0: 6c75 652e 0a20 2020 2020 2020 2020 2020  lue..           
+00035000: 202d 2027 7a2b 2720 3a20 696e 206f 7264   - 'z+' : in ord
+00035010: 6572 206f 6620 696e 6372 6561 7369 6e67  er of increasing
+00035020: 207a 2076 616c 7565 2e0a 2020 2020 2020   z value..      
+00035030: 2020 2020 2020 2d20 277a 2d27 203a 2069        - 'z-' : i
+00035040: 6e20 6f72 6465 7220 6f66 2064 6563 7265  n order of decre
+00035050: 6173 696e 6720 7a20 7661 6c75 652e 0a20  asing z value.. 
+00035060: 2020 2020 2020 2020 2020 2049 6620 616e             If an
+00035070: 7920 6f74 6865 7220 7661 6c75 6573 2069  y other values i
+00035080: 7320 6769 7665 6e2c 206e 6f20 6f72 6465  s given, no orde
+00035090: 7269 6e67 2069 7320 7065 7266 6f72 6d65  ring is performe
+000350a0: 642e 0a20 2020 2020 2020 2027 2727 0a0a  d..        '''..
+000350b0: 2020 2020 2020 2020 2320 4966 206e 616d          # If nam
+000350c0: 6573 206e 6f74 2073 7065 6369 6669 6564  es not specified
+000350d0: 2c20 6d61 6b65 2069 7420 616e 2065 6d70  , make it an emp
+000350e0: 7479 206c 6973 742e 0a20 2020 2020 2020  ty list..       
+000350f0: 2069 6620 6e61 6d65 7320 6973 204e 6f6e   if names is Non
+00035100: 653a 0a20 2020 2020 2020 2020 2020 206e  e:.            n
+00035110: 616d 6573 203d 205b 5d0a 0a20 2020 2020  ames = []..     
+00035120: 2020 2023 2052 6573 697a 6520 524f 4920     # Resize ROI 
+00035130: 6d61 736b 2069 6620 766f 7865 6c20 7369  mask if voxel si
+00035140: 7a65 2069 7320 746f 2062 6520 6368 616e  ze is to be chan
+00035150: 6765 642e 0a20 2020 2020 2020 2069 6620  ged..        if 
+00035160: 766f 7865 6c5f 7369 7a65 3a0a 2020 2020  voxel_size:.    
+00035170: 2020 2020 2020 2020 726f 6920 3d20 524f          roi = RO
+00035180: 4928 7365 6c66 290a 2020 2020 2020 2020  I(self).        
+00035190: 2020 2020 766f 7865 6c5f 7369 7a65 5f33      voxel_size_3
+000351a0: 6420 3d20 2876 6f78 656c 5f73 697a 655b  d = (voxel_size[
+000351b0: 305d 2c20 766f 7865 6c5f 7369 7a65 5b31  0], voxel_size[1
+000351c0: 5d2c 204e 6f6e 6529 0a20 2020 2020 2020  ], None).       
+000351d0: 2020 2020 2072 6f69 2e63 7265 6174 655f       roi.create_
+000351e0: 6d61 736b 2829 0a20 2020 2020 2020 2020  mask().         
+000351f0: 2020 2072 6f69 2e6d 6173 6b2e 7265 7369     roi.mask.resi
+00035200: 7a65 2876 6f78 656c 5f73 697a 653d 766f  ze(voxel_size=vo
+00035210: 7865 6c5f 7369 7a65 5f33 642c 206d 6574  xel_size_3d, met
+00035220: 686f 643d 276e 6561 7265 7374 272c 0a20  hod='nearest',. 
+00035230: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00035240: 2020 2069 6d61 6765 5f73 697a 655f 756e     image_size_un
+00035250: 6974 3d27 6d6d 2729 0a20 2020 2020 2020  it='mm').       
+00035260: 2020 2020 2072 6f69 2e73 6574 5f69 6d61       roi.set_ima
+00035270: 6765 2873 6b72 742e 696d 6167 652e 496d  ge(skrt.image.Im
+00035280: 6167 6528 726f 692e 6d61 736b 2929 0a20  age(roi.mask)). 
+00035290: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+000352a0: 2020 2020 2020 2020 2072 6f69 203d 2073           roi = s
+000352b0: 656c 660a 200a 2020 2020 2020 2020 2320  elf. .        # 
+000352c0: 4c61 6265 6c20 524f 4920 636f 6d70 6f6e  Label ROI compon
+000352d0: 656e 7473 2e0a 2020 2020 2020 2020 6c61  ents..        la
+000352e0: 6265 6c5f 6d61 736b 2c20 6e5f 6c61 6265  bel_mask, n_labe
+000352f0: 6c20 3d20 6e64 696d 6167 652e 6c61 6265  l = ndimage.labe
+00035300: 6c28 726f 692e 6765 745f 6d61 736b 2829  l(roi.get_mask()
+00035310: 290a 0a20 2020 2020 2020 2069 6620 766f  )..        if vo
+00035320: 7865 6c5f 7369 7a65 2061 6e64 2027 636f  xel_size and 'co
+00035330: 6e74 6f75 7227 203d 3d20 7365 6c66 2e73  ntour' == self.s
+00035340: 6f75 7263 655f 7479 7065 3a0a 2020 2020  ource_type:.    
+00035350: 2020 2020 2020 2020 2320 4861 6e64 6c65          # Handle
+00035360: 2063 6173 6573 2077 6865 7265 2063 6f6d   cases where com
+00035370: 706f 7369 7465 2052 4f49 2069 7320 6672  posite ROI is fr
+00035380: 6f6d 2063 6f6e 746f 7572 2070 6f69 6e74  om contour point
+00035390: 732c 0a20 2020 2020 2020 2020 2020 2023  s,.            #
+000353a0: 2061 6e64 206d 6173 6b20 766f 7865 6c20   and mask voxel 
+000353b0: 7369 7a65 2068 6173 2062 6565 6e20 7061  size has been pa
+000353c0: 7373 6564 2061 7320 616e 2061 7267 756d  ssed as an argum
+000353d0: 656e 742e 0a20 2020 2020 2020 2020 2020  ent..           
+000353e0: 2023 2049 6e20 7468 6973 2063 6173 6520   # In this case 
+000353f0: 636f 6d70 6f6e 656e 7420 524f 4973 2061  component ROIs a
+00035400: 7265 2069 6e69 7469 616c 6973 6564 2066  re initialised f
+00035410: 726f 6d20 636f 6e74 6f75 7273 0a20 2020  rom contours.   
+00035420: 2020 2020 2020 2020 2023 2072 6563 7265           # recre
+00035430: 6174 6564 2066 726f 6d20 7468 6520 6d61  ated from the ma
+00035440: 736b 2c20 7768 6963 6820 6d61 7920 6265  sk, which may be
+00035450: 2068 6967 6865 722d 7265 736f 6c75 7469   higher-resoluti
+00035460: 6f6e 0a20 2020 2020 2020 2020 2020 2023  on.            #
+00035470: 2074 6861 6e20 7468 6520 6465 6661 756c   than the defaul
+00035480: 742e 0a20 2020 2020 2020 2020 2020 2073  t..            s
+00035490: 7330 203d 2053 7472 7563 7475 7265 5365  s0 = StructureSe
+000354a0: 7428 6c61 6265 6c5f 6d61 736b 2c20 6d75  t(label_mask, mu
+000354b0: 6c74 695f 6c61 6265 6c3d 5472 7565 2c20  lti_label=True, 
+000354c0: 696d 6167 653d 726f 692e 6d61 736b 290a  image=roi.mask).
+000354d0: 2020 2020 2020 2020 2020 2020 7373 203d              ss =
+000354e0: 2053 7472 7563 7475 7265 5365 7428 290a   StructureSet().
+000354f0: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+00035500: 726f 6920 696e 2073 7330 2e67 6574 5f72  roi in ss0.get_r
+00035510: 6f69 7328 293a 0a20 2020 2020 2020 2020  ois():.         
+00035520: 2020 2020 2020 2073 732e 6164 645f 726f         ss.add_ro
+00035530: 6928 524f 4928 736f 7572 6365 3d72 6f69  i(ROI(source=roi
+00035540: 2e67 6574 5f63 6f6e 746f 7572 7328 292c  .get_contours(),
+00035550: 206e 616d 653d 726f 692e 6e61 6d65 2929   name=roi.name))
+00035560: 0a20 2020 2020 2020 2020 2020 2073 732e  .            ss.
+00035570: 7365 745f 696d 6167 6528 7365 6c66 2e69  set_image(self.i
+00035580: 6d61 6765 290a 2020 2020 2020 2020 656c  mage).        el
+00035590: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+000355a0: 2320 4861 6e64 6c65 2063 6173 6573 2077  # Handle cases w
+000355b0: 6865 7265 2063 6f6d 706f 6e65 6e74 2052  here component R
+000355c0: 4f49 7320 6172 6520 696e 6974 6961 6c69  OIs are initiali
+000355d0: 7365 6420 6672 6f6d 206d 6173 6b2e 0a20  sed from mask.. 
+000355e0: 2020 2020 2020 2020 2020 2069 6620 766f             if vo
+000355f0: 7865 6c5f 7369 7a65 3a0a 2020 2020 2020  xel_size:.      
+00035600: 2020 2020 2020 2020 2020 2320 4966 2076            # If v
+00035610: 6f78 656c 2073 697a 6520 6368 616e 6765  oxel size change
+00035620: 6420 666f 7220 6c61 6265 6c6c 696e 672c  d for labelling,
+00035630: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00035640: 2023 2072 6563 7265 6174 6520 6c61 6265   # recreate labe
+00035650: 6c20 6d61 736b 2077 6974 6820 6f72 6967  l mask with orig
+00035660: 696e 616c 2076 6f78 656c 2073 697a 652e  inal voxel size.
+00035670: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00035680: 2072 6f69 2e6d 6173 6b2e 6461 7461 203d   roi.mask.data =
+00035690: 206c 6162 656c 5f6d 6173 6b0a 2020 2020   label_mask.    
+000356a0: 2020 2020 2020 2020 2020 2020 726f 692e              roi.
+000356b0: 6d61 736b 2e6d 6174 6368 5f73 697a 6528  mask.match_size(
+000356c0: 7365 6c66 2e69 6d61 6765 2c20 6d65 7468  self.image, meth
+000356d0: 6f64 3d27 6e65 6172 6573 7427 290a 2020  od='nearest').  
+000356e0: 2020 2020 2020 2020 2020 2020 2020 6c61                la
+000356f0: 6265 6c5f 6d61 736b 203d 2072 6f69 2e6d  bel_mask = roi.m
+00035700: 6173 6b2e 6461 7461 0a0a 2020 2020 2020  ask.data..      
+00035710: 2020 2020 2020 2320 4372 6561 7465 2073        # Create s
+00035720: 7472 7563 7475 7265 2073 6574 2066 726f  tructure set fro
+00035730: 6d20 6c61 6265 6c20 6d61 736b 2e0a 2020  m label mask..  
+00035740: 2020 2020 2020 2020 2020 7373 203d 2053            ss = S
+00035750: 7472 7563 7475 7265 5365 7428 6c61 6265  tructureSet(labe
+00035760: 6c5f 6d61 736b 2c20 6d75 6c74 695f 6c61  l_mask, multi_la
+00035770: 6265 6c3d 5472 7565 2c20 696d 6167 653d  bel=True, image=
+00035780: 7365 6c66 2e69 6d61 6765 290a 0a20 2020  self.image)..   
+00035790: 2020 2020 2023 2053 746f 7265 2052 4f49       # Store ROI
+000357a0: 7320 696e 2073 7065 6369 6669 6564 206f  s in specified o
+000357b0: 7264 6572 2e0a 2020 2020 2020 2020 7373  rder..        ss
+000357c0: 2e6f 7264 6572 5f72 6f69 7328 6f72 6465  .order_rois(orde
+000357d0: 7229 0a0a 2020 2020 2020 2020 2320 4170  r)..        # Ap
+000357e0: 706c 7920 6e61 6d65 732e 0a20 2020 2020  ply names..     
+000357f0: 2020 2066 6f72 2069 2069 6e20 7261 6e67     for i in rang
+00035800: 6528 6d69 6e28 6c65 6e28 6e61 6d65 7329  e(min(len(names)
+00035810: 2c20 6c65 6e28 7373 2e72 6f69 7329 2929  , len(ss.rois)))
+00035820: 3a0a 2020 2020 2020 2020 2020 2020 7373  :.            ss
+00035830: 2e72 6f69 735b 695d 2e6e 616d 6520 3d20  .rois[i].name = 
+00035840: 6e61 6d65 735b 695d 0a0a 2020 2020 2020  names[i]..      
+00035850: 2020 7265 7475 726e 2073 730a 0a20 2020    return ss..   
+00035860: 2064 6566 2073 706c 6974 5f69 6e5f 7477   def split_in_tw
+00035870: 6f28 7365 6c66 2c20 6178 6973 3d27 7827  o(self, axis='x'
+00035880: 2c20 7630 3d30 2c20 6e61 6d65 733d 4e6f  , v0=0, names=No
+00035890: 6e65 2c29 3a0a 2020 2020 2020 2020 2727  ne,):.        ''
+000358a0: 270a 2020 2020 2020 2020 5370 6c69 7420  '.        Split 
+000358b0: 6120 636f 6d70 6f73 6974 6520 524f 4920  a composite ROI 
+000358c0: 696e 746f 2074 776f 2063 6f6d 706f 6e65  into two compone
+000358d0: 6e74 2070 6172 7473 2e0a 0a20 2020 2020  nt parts...     
+000358e0: 2020 2053 706c 6974 2061 6e20 524f 4920     Split an ROI 
+000358f0: 696e 746f 2074 776f 2063 6f6d 706f 6e65  into two compone
+00035900: 6e74 732c 2065 6974 6865 7220 7369 6465  nts, either side
+00035910: 206f 6620 6120 7370 6563 6966 6965 640a   of a specified.
+00035920: 2020 2020 2020 2020 706c 616e 652e 2020          plane.  
+00035930: 5468 6973 206d 6179 2062 6520 7573 6566  This may be usef
+00035940: 756c 2c20 666f 7220 6578 616d 706c 652c  ul, for example,
+00035950: 2077 6865 6e20 6c65 6674 2061 6e64 2072   when left and r
+00035960: 6967 6874 0a20 2020 2020 2020 2052 4f49  ight.        ROI
+00035970: 7320 6861 7665 2062 6565 6e20 6173 7369  s have been assi
+00035980: 676e 6564 2061 2063 6f6d 6d6f 6e20 6c61  gned a common la
+00035990: 6265 6c2e 0a0a 2020 2020 2020 2020 466f  bel...        Fo
+000359a0: 7220 6d6f 7265 2067 656e 6572 616c 2052  r more general R
+000359b0: 4f49 2073 706c 6974 7469 6e67 2c20 7365  OI splitting, se
+000359c0: 6520 736b 7274 2e73 7472 7563 7475 7265  e skrt.structure
+000359d0: 2e52 4f49 2e73 706c 6974 2829 2e0a 2020  .ROI.split()..  
+000359e0: 2020 2020 2020 4e6f 7465 2074 6861 7420        Note that 
+000359f0: 7370 6c69 7428 2920 6163 7473 206f 6e20  split() acts on 
+00035a00: 6269 6e61 7279 206d 6173 6b73 2c20 7768  binary masks, wh
+00035a10: 6572 6561 7320 7370 6c69 745f 696e 5f74  ereas split_in_t
+00035a20: 776f 2829 0a20 2020 2020 2020 2061 6374  wo().        act
+00035a30: 7320 6f6e 2063 6f6e 746f 7572 732e 0a0a  s on contours...
+00035a40: 2020 2020 2020 2020 2a2a 5061 7261 6d65          **Parame
+00035a50: 7465 7273 3a2a 2a0a 0a20 2020 2020 2020  ters:**..       
+00035a60: 2061 7869 7320 3a20 2773 7472 272c 2064   axis : 'str', d
+00035a70: 6566 6175 6c74 3d27 7827 0a20 2020 2020  efault='x'.     
+00035a80: 2020 2020 2020 2041 7869 7320 2827 7827         Axis ('x'
+00035a90: 2c20 2779 2720 6f72 2027 7a27 2920 7065  , 'y' or 'z') pe
+00035aa0: 7270 656e 6469 6375 6c61 7220 746f 2070  rpendicular to p
+00035ab0: 6c61 6e65 2061 626f 7574 2077 6869 6368  lane about which
+00035ac0: 0a20 2020 2020 2020 2020 2020 2052 4f49  .            ROI
+00035ad0: 2069 7320 746f 2062 6520 7370 6c69 742e   is to be split.
+00035ae0: 0a0a 2020 2020 2020 2020 7630 203a 2066  ..        v0 : f
+00035af0: 6c6f 6174 2c20 6465 6661 756c 743d 300a  loat, default=0.
+00035b00: 2020 2020 2020 2020 2020 2020 436f 6f72              Coor
+00035b10: 6469 6e61 7465 2061 6c6f 6e67 2073 656c  dinate along sel
+00035b20: 6563 7465 6420 6178 6973 2c20 7370 6563  ected axis, spec
+00035b30: 6966 7969 6e67 2070 6c61 6e65 2061 626f  ifying plane abo
+00035b40: 7574 2077 6869 6368 0a20 2020 2020 2020  ut which.       
+00035b50: 2020 2020 2052 4f49 2069 7320 746f 2062       ROI is to b
+00035b60: 6520 7370 6c69 742e 0a0a 2020 2020 2020  e split...      
+00035b70: 2020 6e61 6d65 733a 206c 6973 742c 2064    names: list, d
+00035b80: 6566 6175 6c74 3d4e 6f6e 650a 2020 2020  efault=None.    
+00035b90: 2020 2020 2020 2020 4c69 7374 206f 6620          List of 
+00035ba0: 6e61 6d65 7320 746f 2062 6520 6170 706c  names to be appl
+00035bb0: 6965 6420 746f 2074 6865 2063 6f6d 706f  ied to the compo
+00035bc0: 6e65 6e74 2052 4f49 732e 0a20 2020 2020  nent ROIs..     
+00035bd0: 2020 2027 2727 0a0a 2020 2020 2020 2020     '''..        
+00035be0: 2320 4966 206e 616d 6573 206e 6f74 2073  # If names not s
+00035bf0: 7065 6369 6669 6564 2c20 696e 6974 6961  pecified, initia
+00035c00: 6c69 7365 2074 6f20 656d 7074 7920 6c69  lise to empty li
+00035c10: 7374 2e0a 2020 2020 2020 2020 6966 206e  st..        if n
+00035c20: 616d 6573 2069 7320 4e6f 6e65 3a0a 2020  ames is None:.  
+00035c30: 2020 2020 2020 2020 2020 6e61 6d65 7320            names 
+00035c40: 3d20 5b5d 0a0a 2020 2020 2020 2020 2320  = []..        # 
+00035c50: 4261 7365 6420 6f6e 2073 656c 6563 7465  Based on selecte
+00035c60: 6420 6178 6973 2c20 6465 6669 6e65 2076  d axis, define v
+00035c70: 6965 7720 616e 6420 6465 6661 756c 7420  iew and default 
+00035c80: 6e61 6d65 2073 7566 6669 7865 732e 0a20  name suffixes.. 
+00035c90: 2020 2020 2020 2069 6620 2778 2720 3d3d         if 'x' ==
+00035ca0: 2061 7869 732e 6c6f 7765 7228 293a 0a20   axis.lower():. 
+00035cb0: 2020 2020 2020 2020 2020 2076 6965 7720             view 
+00035cc0: 3d20 2778 2d79 270a 2020 2020 2020 2020  = 'x-y'.        
+00035cd0: 2020 2020 7375 6666 6978 6573 203d 2028      suffixes = (
+00035ce0: 2772 6967 6874 272c 2027 6c65 6674 2729  'right', 'left')
+00035cf0: 0a20 2020 2020 2020 2065 6c69 6620 2779  .        elif 'y
+00035d00: 2720 3d3d 2061 7869 732e 6c6f 7765 7228  ' == axis.lower(
+00035d10: 293a 0a20 2020 2020 2020 2020 2020 2076  ):.            v
+00035d20: 6965 7720 3d20 2778 2d79 270a 2020 2020  iew = 'x-y'.    
+00035d30: 2020 2020 2020 2020 7375 6666 6978 6573          suffixes
+00035d40: 203d 2028 2761 6e74 6572 696f 7227 2c20   = ('anterior', 
+00035d50: 2770 6f73 7465 7269 6f72 2729 0a20 2020  'posterior').   
+00035d60: 2020 2020 2065 6c69 6620 277a 2720 3d3d       elif 'z' ==
+00035d70: 2061 7869 732e 6c6f 7765 7228 293a 0a20   axis.lower():. 
+00035d80: 2020 2020 2020 2020 2020 2076 6965 7720             view 
+00035d90: 3d20 2779 2d7a 270a 2020 2020 2020 2020  = 'y-z'.        
+00035da0: 2020 2020 7375 6666 6978 6573 203d 2028      suffixes = (
+00035db0: 2769 6e66 6572 696f 7227 2c20 2773 7570  'inferior', 'sup
+00035dc0: 6572 696f 7227 290a 2020 2020 2020 2020  erior').        
+00035dd0: 2020 2020 2320 496e 2074 6865 2027 792d      # In the 'y-
+00035de0: 7a27 2076 6965 772c 2079 2061 6e64 207a  z' view, y and z
+00035df0: 2061 7865 7320 6d61 7020 746f 2073 6861   axes map to sha
+00035e00: 7065 6c79 2078 2061 6e64 2079 2061 7865  pely x and y axe
+00035e10: 732e 0a20 2020 2020 2020 2020 2020 2061  s..            a
+00035e20: 7869 7320 3d20 2779 270a 0a20 2020 2020  xis = 'y'..     
+00035e30: 2020 2023 2044 6566 696e 6520 706f 6c79     # Define poly
+00035e40: 676f 6e20 7265 7072 6573 656e 7469 6e67  gon representing
+00035e50: 2052 4f49 2063 6f6e 746f 7572 2061 7320   ROI contour as 
+00035e60: 6c6f 7720 6f72 2068 6967 682c 0a20 2020  low or high,.   
+00035e70: 2020 2020 2023 2064 6570 656e 6469 6e67       # depending
+00035e80: 206f 6e20 7768 6574 6865 7220 7468 6520   on whether the 
+00035e90: 706f 6c79 676f 6e20 6365 6e74 726f 6964  polygon centroid
+00035ea0: 2069 7320 6c6f 7765 7220 6f72 2068 6967   is lower or hig
+00035eb0: 6865 720a 2020 2020 2020 2020 2320 7468  her.        # th
+00035ec0: 616e 2074 6865 2063 6f6f 7264 696e 6174  an the coordinat
+00035ed0: 6520 6f66 2074 6865 2073 706c 6974 7469  e of the splitti
+00035ee0: 6e67 2070 6c61 6e65 2e0a 2020 2020 2020  ng plane..      
+00035ef0: 2020 706f 6c79 676f 6e73 5f6c 6f77 203d    polygons_low =
+00035f00: 207b 7d0a 2020 2020 2020 2020 706f 6c79   {}.        poly
+00035f10: 676f 6e73 5f68 6967 6820 3d20 7b7d 0a20  gons_high = {}. 
+00035f20: 2020 2020 2020 2066 6f72 207a 2c20 706f         for z, po
+00035f30: 6c79 676f 6e73 2069 6e20 7365 6c66 2e67  lygons in self.g
+00035f40: 6574 5f70 6f6c 7967 6f6e 7328 7669 6577  et_polygons(view
+00035f50: 292e 6974 656d 7328 293a 0a20 2020 2020  ).items():.     
+00035f60: 2020 2020 2020 2066 6f72 2070 6f6c 7967         for polyg
+00035f70: 6f6e 2069 6e20 706f 6c79 676f 6e73 3a0a  on in polygons:.
+00035f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00035f90: 7620 3d20 6765 7461 7474 7228 706f 6c79  v = getattr(poly
+00035fa0: 676f 6e2e 6365 6e74 726f 6964 2c20 6178  gon.centroid, ax
+00035fb0: 6973 290a 2020 2020 2020 2020 2020 2020  is).            
+00035fc0: 2020 2020 6966 2076 203c 2076 303a 0a20      if v < v0:. 
+00035fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00035fe0: 2020 2069 6620 6e6f 7420 7a20 696e 2070     if not z in p
+00035ff0: 6f6c 7967 6f6e 735f 6c6f 773a 0a20 2020  olygons_low:.   
+00036000: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00036010: 2020 2020 2070 6f6c 7967 6f6e 735f 6c6f       polygons_lo
+00036020: 775b 7a5d 203d 205b 5d0a 2020 2020 2020  w[z] = [].      
+00036030: 2020 2020 2020 2020 2020 2020 2020 706f                po
+00036040: 6c79 676f 6e73 5f6c 6f77 5b7a 5d2e 6170  lygons_low[z].ap
+00036050: 7065 6e64 2870 6f6c 7967 6f6e 290a 2020  pend(polygon).  
+00036060: 2020 2020 2020 2020 2020 2020 2020 656c                el
+00036070: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+00036080: 2020 2020 2020 2020 6966 206e 6f74 207a          if not z
+00036090: 2069 6e20 706f 6c79 676f 6e73 5f68 6967   in polygons_hig
+000360a0: 683a 0a20 2020 2020 2020 2020 2020 2020  h:.             
+000360b0: 2020 2020 2020 2020 2020 2070 6f6c 7967             polyg
+000360c0: 6f6e 735f 6869 6768 5b7a 5d20 3d20 5b5d  ons_high[z] = []
+000360d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000360e0: 2020 2020 2070 6f6c 7967 6f6e 735f 6869       polygons_hi
+000360f0: 6768 5b7a 5d2e 6170 7065 6e64 2870 6f6c  gh[z].append(pol
+00036100: 7967 6f6e 290a 0a0a 2020 2020 2020 2020  ygon)...        
+00036110: 2320 4372 6561 7465 2052 4f49 2066 726f  # Create ROI fro
+00036120: 6d20 706f 6c79 676f 6e73 2062 656c 6f77  m polygons below
+00036130: 2074 6865 2073 706c 6974 7469 6e67 2070   the splitting p
+00036140: 6c61 6e65 2e0a 2020 2020 2020 2020 6966  lane..        if
+00036150: 2070 6f6c 7967 6f6e 735f 6c6f 773a 0a20   polygons_low:. 
+00036160: 2020 2020 2020 2020 2020 2072 6f69 5f6c             roi_l
+00036170: 6f77 203d 2052 4f49 2873 6f75 7263 653d  ow = ROI(source=
+00036180: 706f 6c79 676f 6e73 5f6c 6f77 2c20 696d  polygons_low, im
+00036190: 6167 653d 7365 6c66 2e69 6d61 6765 290a  age=self.image).
+000361a0: 2020 2020 2020 2020 2020 2020 726f 695f              roi_
+000361b0: 6c6f 772e 6e61 6d65 203d 2028 6e61 6d65  low.name = (name
+000361c0: 735b 305d 2069 6620 6c65 6e28 6e61 6d65  s[0] if len(name
+000361d0: 7329 203e 2030 0a20 2020 2020 2020 2020  s) > 0.         
+000361e0: 2020 2020 2020 2020 2020 2065 6c73 6520             else 
+000361f0: 6627 7b73 656c 662e 6e61 6d65 7d5f 7b73  f'{self.name}_{s
+00036200: 7566 6669 7865 735b 305d 7d27 290a 2020  uffixes[0]}').  
+00036210: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+00036220: 2020 2020 2020 2020 726f 695f 6c6f 7720          roi_low 
+00036230: 3d20 4e6f 6e65 0a0a 2020 2020 2020 2020  = None..        
+00036240: 2320 4372 6561 7465 2052 4f49 2066 726f  # Create ROI fro
+00036250: 6d20 706f 6c79 676f 6e73 2061 626f 7665  m polygons above
+00036260: 2074 6865 2073 706c 6974 7469 6e67 2070   the splitting p
+00036270: 6c61 6e65 2e0a 2020 2020 2020 2020 6966  lane..        if
+00036280: 2070 6f6c 7967 6f6e 735f 6869 6768 3a0a   polygons_high:.
+00036290: 2020 2020 2020 2020 2020 2020 726f 695f              roi_
+000362a0: 6869 6768 203d 2052 4f49 2873 6f75 7263  high = ROI(sourc
+000362b0: 653d 706f 6c79 676f 6e73 5f68 6967 682c  e=polygons_high,
+000362c0: 2069 6d61 6765 3d73 656c 662e 696d 6167   image=self.imag
+000362d0: 6529 0a20 2020 2020 2020 2020 2020 2072  e).            r
+000362e0: 6f69 5f68 6967 682e 6e61 6d65 203d 2028  oi_high.name = (
+000362f0: 6e61 6d65 735b 315d 2069 6620 6c65 6e28  names[1] if len(
+00036300: 6e61 6d65 7329 203e 2031 0a20 2020 2020  names) > 1.     
+00036310: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+00036320: 6c73 6520 6627 7b73 656c 662e 6e61 6d65  lse f'{self.name
+00036330: 7d5f 7b73 7566 6669 7865 735b 315d 7d27  }_{suffixes[1]}'
+00036340: 290a 2020 2020 2020 2020 656c 7365 3a0a  ).        else:.
+00036350: 2020 2020 2020 2020 2020 2020 726f 695f              roi_
+00036360: 6869 6768 203d 204e 6f6e 650a 0a20 2020  high = None..   
+00036370: 2020 2020 2023 2043 7265 6174 6520 7374       # Create st
+00036380: 7275 6374 7572 6520 7365 7420 666f 7220  ructure set for 
+00036390: 636f 6d70 6f6e 656e 7420 524f 4928 7329  component ROI(s)
+000363a0: 2e0a 2020 2020 2020 2020 726f 6973 203d  ..        rois =
+000363b0: 206c 6973 7428 6669 6c74 6572 284e 6f6e   list(filter(Non
+000363c0: 652c 205b 726f 695f 6c6f 772c 2072 6f69  e, [roi_low, roi
+000363d0: 5f68 6967 685d 2929 0a20 2020 2020 2020  _high])).       
+000363e0: 2069 6620 726f 6973 3a0a 2020 2020 2020   if rois:.      
+000363f0: 2020 2020 2020 7373 203d 2053 7472 7563        ss = Struc
+00036400: 7475 7265 5365 7428 7061 7468 3d72 6f69  tureSet(path=roi
+00036410: 732c 206e 616d 653d 7365 6c66 2e6e 616d  s, name=self.nam
+00036420: 652c 2069 6d61 6765 3d73 656c 662e 696d  e, image=self.im
+00036430: 6167 6529 0a20 2020 2020 2020 2065 6c73  age).        els
+00036440: 653a 0a20 2020 2020 2020 2020 2020 2073  e:.            s
+00036450: 7320 3d20 4e6f 6e65 0a0a 2020 2020 2020  s = None..      
+00036460: 2020 7265 7475 726e 2073 730a 0a20 2020    return ss..   
+00036470: 2064 6566 2067 6574 5f70 6174 6368 2873   def get_patch(s
+00036480: 656c 662c 2070 6c6f 745f 7479 7065 3d4e  elf, plot_type=N
+00036490: 6f6e 652c 2063 6f6c 6f72 3d4e 6f6e 652c  one, color=None,
+000364a0: 206f 7061 6369 7479 3d4e 6f6e 652c 0a20   opacity=None,. 
+000364b0: 2020 2020 2020 2020 2020 206c 696e 6577             linew
+000364c0: 6964 7468 3d4e 6f6e 652c 206e 616d 653d  idth=None, name=
+000364d0: 4e6f 6e65 293a 0a20 2020 2020 2020 2022  None):.        "
+000364e0: 2222 0a20 2020 2020 2020 204f 6274 6169  "".        Obtai
+000364f0: 6e20 7061 7463 6820 7265 666c 6563 7469  n patch reflecti
+00036500: 6e67 2052 4f49 2063 6861 7261 6374 6572  ng ROI character
+00036510: 6973 7469 6373 2066 6f72 2070 6c6f 7474  istics for plott
+00036520: 696e 672e 0a0a 2020 2020 2020 2020 5468  ing...        Th
+00036530: 6520 7061 7463 6820 6f62 7461 696e 6564  e patch obtained
+00036540: 2063 616e 2062 6520 7573 6564 2061 7320   can be used as 
+00036550: 6120 6861 6e64 6c65 2069 6e20 6c65 6765  a handle in lege
+00036560: 6e64 2063 7265 6174 696f 6e2e 0a0a 2020  nd creation...  
+00036570: 2020 2020 2020 2a2a 5061 7261 6d65 7465        **Paramete
+00036580: 7273 3a2a 2a0a 0a20 2020 2020 2020 2070  rs:**..        p
+00036590: 6c6f 745f 7479 7065 203a 2073 7472 2c20  lot_type : str, 
+000365a0: 6465 6661 756c 743d 4e6f 6e65 0a20 2020  default=None.   
+000365b0: 2020 2020 2020 2020 2050 6c6f 7474 696e           Plottin
+000365c0: 6720 7479 7065 2e20 4966 204e 6f6e 652c  g type. If None,
+000365d0: 2077 696c 6c20 6265 2065 6974 6865 7220   will be either 
+000365e0: 2263 6f6e 746f 7572 2220 6f72 2022 6d61  "contour" or "ma
+000365f0: 736b 2220 0a20 2020 2020 2020 2020 2020  sk" .           
+00036600: 2064 6570 656e 6469 6e67 206f 6e20 7468   depending on th
+00036610: 6520 696e 7075 7420 7479 7065 206f 6620  e input type of 
+00036620: 7468 6520 524f 492e 204f 7074 696f 6e73  the ROI. Options
+00036630: 3a0a 0a20 2020 2020 2020 2020 2020 2020  :..             
+00036640: 2020 202d 2022 636f 6e74 6f75 7222 0a20     - "contour". 
+00036650: 2020 2020 2020 2020 2020 2020 2020 202d                 -
+00036660: 2022 6d61 736b 220a 2020 2020 2020 2020   "mask".        
+00036670: 2020 2020 2020 2020 2d20 2263 656e 7472          - "centr
+00036680: 6f69 6422 2028 636f 6e74 6f75 7220 7769  oid" (contour wi
+00036690: 7468 206d 6172 6b65 7220 6174 2063 656e  th marker at cen
+000366a0: 7472 6f69 6429 0a20 2020 2020 2020 2020  troid).         
+000366b0: 2020 2020 2020 202d 2022 6669 6c6c 6564         - "filled
+000366c0: 2220 2874 7261 6e73 7061 7265 6e74 206d  " (transparent m
+000366d0: 6173 6b20 2b20 636f 6e74 6f75 7229 0a20  ask + contour). 
+000366e0: 2020 2020 2020 2020 2020 2020 2020 202d                 -
+000366f0: 2022 6669 6c6c 6564 2063 656e 7472 6f69   "filled centroi
+00036700: 6422 2028 6669 6c6c 6564 2077 6974 6820  d" (filled with 
+00036710: 6d61 726b 6572 2061 7420 6365 6e74 726f  marker at centro
+00036720: 6964 290a 0a20 2020 2020 2020 2063 6f6c  id)..        col
+00036730: 6f72 203a 206d 6174 706c 6f74 6c69 6220  or : matplotlib 
+00036740: 636f 6c6f 722c 2064 6566 6175 6c74 3d4e  color, default=N
+00036750: 6f6e 650a 2020 2020 2020 2020 2020 2020  one.            
+00036760: 436f 6c6f 7220 7769 7468 2077 6869 6368  Color with which
+00036770: 2074 6f20 706c 6f74 2074 6865 2052 4f49   to plot the ROI
+00036780: 3b20 6f76 6572 7269 6465 7320 7468 6520  ; overrides the 
+00036790: 524f 4927 7320 6f77 6e20 636f 6c6f 722e  ROI's own color.
+000367a0: 2049 6620 0a20 2020 2020 2020 2020 2020   If .           
+000367b0: 204e 6f6e 652c 2073 656c 662e 636f 6c6f   None, self.colo
+000367c0: 7220 7769 6c6c 2062 6520 7573 6564 2e0a  r will be used..
+000367d0: 0a20 2020 2020 2020 206f 7061 6369 7479  .        opacity
+000367e0: 203a 2066 6c6f 6174 2c20 6465 6661 756c   : float, defaul
+000367f0: 743d 4e6f 6e65 0a20 2020 2020 2020 2020  t=None.         
+00036800: 2020 204f 7061 6369 7479 2074 6f20 7573     Opacity to us
+00036810: 6520 6966 2070 6c6f 7474 696e 6720 6d61  e if plotting ma
+00036820: 736b 2028 692e 652e 2070 6c6f 7420 7479  sk (i.e. plot ty
+00036830: 7065 7320 226d 6173 6b22 2c20 2266 696c  pes "mask", "fil
+00036840: 6c65 6422 2c20 0a20 2020 2020 2020 2020  led", .         
+00036850: 2020 206f 7220 2266 696c 6c65 6420 6365     or "filled ce
+00036860: 6e74 726f 6964 2229 2e20 4966 204e 6f6e  ntroid"). If Non
+00036870: 652c 206f 7061 6369 7479 2077 696c 6c20  e, opacity will 
+00036880: 6265 2031 2062 7920 6465 6661 756c 7420  be 1 by default 
+00036890: 666f 7220 0a20 2020 2020 2020 2020 2020  for .           
+000368a0: 2073 6f6c 6964 206d 6173 6b20 706c 6f74   solid mask plot
+000368b0: 7320 616e 6420 302e 3320 6279 2064 6566  s and 0.3 by def
+000368c0: 6175 6c74 2066 6f72 2066 696c 6c65 6420  ault for filled 
+000368d0: 706c 6f74 732e 0a0a 2020 2020 2020 2020  plots...        
+000368e0: 6c69 6e65 7769 6474 6820 3a20 666c 6f61  linewidth : floa
+000368f0: 742c 2064 6566 6175 6c74 3d4e 6f6e 650a  t, default=None.
+00036900: 2020 2020 2020 2020 2020 2020 5769 6474              Widt
+00036910: 6820 6f66 2063 6f6e 746f 7572 206c 696e  h of contour lin
+00036920: 6573 2e20 4966 204e 6f6e 652c 2074 6865  es. If None, the
+00036930: 206d 6174 706c 6f74 6c69 6220 6465 6661   matplotlib defa
+00036940: 756c 7420 7365 7474 696e 6720 0a20 2020  ult setting .   
+00036950: 2020 2020 2020 2020 2077 696c 6c20 6265           will be
+00036960: 2075 7365 642e 0a0a 2020 2020 2020 2020   used...        
+00036970: 6e61 6d65 203a 2073 7472 2c20 6465 6661  name : str, defa
+00036980: 756c 743d 4e6f 6e65 0a20 2020 2020 2020  ult=None.       
+00036990: 2020 2020 204e 616d 6520 6964 656e 7469       Name identi
+000369a0: 6679 696e 6720 524f 492e 2020 4966 204e  fying ROI.  If N
+000369b0: 6f6e 652c 2073 656c 662e 6e61 6d65 2077  one, self.name w
+000369c0: 696c 6c20 6265 2075 7365 642e 0a20 2020  ill be used..   
+000369d0: 2020 2020 2022 2222 0a0a 2020 2020 2020       """..      
+000369e0: 2020 2320 456e 7375 7265 2074 6861 7420    # Ensure that 
+000369f0: 706c 6f74 7469 6e67 2063 6861 7261 6374  plotting charact
+00036a00: 6572 6973 7469 6373 2061 7265 2064 6566  eristics are def
+00036a10: 696e 6564 2e0a 2020 2020 2020 2020 6966  ined..        if
+00036a20: 2070 6c6f 745f 7479 7065 2069 7320 4e6f   plot_type is No
+00036a30: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+00036a40: 706c 6f74 5f74 7970 6520 3d20 7365 6c66  plot_type = self
+00036a50: 2e64 6566 6175 6c74 5f67 656f 6d5f 6d65  .default_geom_me
+00036a60: 7468 6f64 0a0a 2020 2020 2020 2020 6966  thod..        if
+00036a70: 2063 6f6c 6f72 2069 7320 4e6f 6e65 3a0a   color is None:.
+00036a80: 2020 2020 2020 2020 2020 2020 636f 6c6f              colo
+00036a90: 7220 3d20 7365 6c66 2e63 6f6c 6f72 0a0a  r = self.color..
+00036aa0: 2020 2020 2020 2020 6966 206f 7061 6369          if opaci
+00036ab0: 7479 2069 7320 4e6f 6e65 3a0a 2020 2020  ty is None:.    
+00036ac0: 2020 2020 2020 2020 6f70 6163 6974 7920          opacity 
+00036ad0: 3d20 302e 3320 6966 2022 6669 6c6c 6564  = 0.3 if "filled
+00036ae0: 2220 696e 2070 6c6f 745f 7479 7065 2065  " in plot_type e
+00036af0: 6c73 6520 310a 0a20 2020 2020 2020 2069  lse 1..        i
+00036b00: 6620 6c69 6e65 7769 6474 6820 6973 204e  f linewidth is N
+00036b10: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+00036b20: 206c 696e 6577 6964 7468 203d 2064 6566   linewidth = def
+00036b30: 6175 6c74 5061 7261 6d73 5b22 6c69 6e65  aultParams["line
+00036b40: 732e 6c69 6e65 7769 6474 6822 5d5b 305d  s.linewidth"][0]
+00036b50: 0a0a 2020 2020 2020 2020 6966 206e 616d  ..        if nam
+00036b60: 6520 6973 204e 6f6e 653a 0a20 2020 2020  e is None:.     
+00036b70: 2020 2020 2020 206e 616d 6520 3d20 7365         name = se
+00036b80: 6c66 2e6e 616d 650a 0a20 2020 2020 2020  lf.name..       
+00036b90: 2023 2053 6574 2070 6f74 656e 7469 616c   # Set potential
+00036ba0: 6c79 2064 6966 6665 7265 6e74 206f 7061  ly different opa
+00036bb0: 6369 7469 6573 2066 6f72 2066 6163 6563  cities for facec
+00036bc0: 6f6c 6f72 2061 6e64 2065 6467 6563 6f6c  olor and edgecol
+00036bd0: 6f72 0a20 2020 2020 2020 2066 6163 6563  or.        facec
+00036be0: 6f6c 6f72 203d 206d 6174 706c 6f74 6c69  olor = matplotli
+00036bf0: 622e 636f 6c6f 7273 2e74 6f5f 7267 6261  b.colors.to_rgba
+00036c00: 2863 6f6c 6f72 2c20 616c 7068 613d 6f70  (color, alpha=op
+00036c10: 6163 6974 7929 0a20 2020 2020 2020 2065  acity).        e
+00036c20: 6467 6563 6f6c 6f72 203d 206d 6174 706c  dgecolor = matpl
+00036c30: 6f74 6c69 622e 636f 6c6f 7273 2e74 6f5f  otlib.colors.to_
+00036c40: 7267 6261 2863 6f6c 6f72 2c20 616c 7068  rgba(color, alph
+00036c50: 613d 3129 0a0a 2020 2020 2020 2020 2320  a=1)..        # 
+00036c60: 4465 6669 6e65 2070 6174 6368 2061 6363  Define patch acc
+00036c70: 6f72 6469 6e67 2074 6f20 706c 6f74 5f74  ording to plot_t
+00036c80: 7970 652e 0a20 2020 2020 2020 2070 6174  ype..        pat
+00036c90: 6368 203d 204e 6f6e 650a 2020 2020 2020  ch = None.      
+00036ca0: 2020 6966 2070 6c6f 745f 7479 7065 2069    if plot_type i
+00036cb0: 6e20 5b22 636f 6e74 6f75 7222 2c20 2263  n ["contour", "c
+00036cc0: 656e 7472 6f69 6422 5d3a 0a20 2020 2020  entroid"]:.     
+00036cd0: 2020 2020 2020 2070 6174 6368 203d 206d         patch = m
+00036ce0: 7061 7463 6865 732e 5061 7463 6828 6564  patches.Patch(ed
+00036cf0: 6765 636f 6c6f 723d 6564 6765 636f 6c6f  gecolor=edgecolo
+00036d00: 722c 0a20 2020 2020 2020 2020 2020 2020  r,.             
+00036d10: 2020 2020 2020 206c 696e 6577 6964 7468         linewidth
+00036d20: 3d6c 696e 6577 6964 7468 2c20 6669 6c6c  =linewidth, fill
+00036d30: 3d46 616c 7365 2c20 6c61 6265 6c3d 6e61  =False, label=na
+00036d40: 6d65 290a 2020 2020 2020 2020 656c 6966  me).        elif
+00036d50: 2070 6c6f 745f 7479 7065 2069 6e20 5b22   plot_type in ["
+00036d60: 6669 6c6c 6564 222c 2022 6669 6c6c 6564  filled", "filled
+00036d70: 2063 656e 7472 6f69 6422 5d3a 0a20 2020   centroid"]:.   
+00036d80: 2020 2020 2020 2020 2070 6174 6368 203d           patch =
+00036d90: 206d 7061 7463 6865 732e 5061 7463 6828   mpatches.Patch(
+00036da0: 6564 6765 636f 6c6f 723d 6564 6765 636f  edgecolor=edgeco
+00036db0: 6c6f 722c 0a20 2020 2020 2020 2020 2020  lor,.           
+00036dc0: 2020 2020 2020 2020 2066 6163 6563 6f6c           facecol
+00036dd0: 6f72 3d66 6163 6563 6f6c 6f72 2c20 6c69  or=facecolor, li
+00036de0: 6e65 7769 6474 683d 6c69 6e65 7769 6474  newidth=linewidt
+00036df0: 682c 206c 6162 656c 3d6e 616d 6529 0a20  h, label=name). 
+00036e00: 2020 2020 2020 2065 6c69 6620 706c 6f74         elif plot
+00036e10: 5f74 7970 6520 696e 205b 226d 6173 6b22  _type in ["mask"
+00036e20: 5d3a 0a20 2020 2020 2020 2020 2020 2070  ]:.            p
+00036e30: 6174 6368 203d 206d 7061 7463 6865 732e  atch = mpatches.
+00036e40: 5061 7463 6828 6661 6365 636f 6c6f 723d  Patch(facecolor=
+00036e50: 6661 6365 636f 6c6f 722c 206c 6162 656c  facecolor, label
+00036e60: 3d6e 616d 6529 0a0a 2020 2020 2020 2020  =name)..        
+00036e70: 6966 2070 6174 6368 3a0a 2020 2020 2020  if patch:.      
+00036e80: 2020 2020 2020 7061 7463 682e 7365 745f        patch.set_
+00036e90: 616c 7068 6128 4e6f 6e65 290a 0a20 2020  alpha(None)..   
+00036ea0: 2020 2020 2072 6574 7572 6e20 7061 7463       return patc
+00036eb0: 680a 0a20 2020 2064 6566 2067 6574 5f69  h..    def get_i
+00036ec0: 6e74 656e 7369 7469 6573 5f33 6428 7365  ntensities_3d(se
+00036ed0: 6c66 2c20 696d 6167 653d 4e6f 6e65 2c20  lf, image=None, 
+00036ee0: 7374 616e 6461 7264 6973 653d 5472 7565  standardise=True
+00036ef0: 293a 0a20 2020 2020 2020 2022 2222 0a20  ):.        """. 
+00036f00: 2020 2020 2020 2052 6574 7572 6e20 636f         Return co
+00036f10: 7079 206f 6620 616e 2069 6d61 6765 2061  py of an image a
+00036f20: 7272 6179 2074 6861 7420 6861 7320 7661  rray that has va
+00036f30: 6c75 6573 2072 6574 6169 6e65 640a 2020  lues retained.  
+00036f40: 2020 2020 2020 696e 7369 6465 2073 656c        inside sel
+00036f50: 662c 2061 6e64 2069 7320 7365 7420 746f  f, and is set to
+00036f60: 207a 6572 6f20 656c 7365 7768 6572 652e   zero elsewhere.
+00036f70: 0a0a 2020 2020 2020 2020 2a2a 5061 7261  ..        **Para
+00036f80: 6d65 7465 723a 2a2a 0a0a 2020 2020 2020  meter:**..      
+00036f90: 2020 696d 6167 6520 3a20 736b 7274 2e69    image : skrt.i
+00036fa0: 6d61 6765 2e49 6d61 6765 2c20 6465 6661  mage.Image, defa
+00036fb0: 756c 743d 4e6f 6e65 0a20 2020 2020 2020  ult=None.       
+00036fc0: 2020 2020 2049 6d61 6765 206f 626a 6563       Image objec
+00036fd0: 7420 666f 7220 7768 6963 6820 3344 2061  t for which 3D a
+00036fe0: 7272 6179 2077 6974 6820 696e 7465 6e73  rray with intens
+00036ff0: 6974 7920 7661 6c75 6573 0a20 2020 2020  ity values.     
+00037000: 2020 2020 2020 2072 6574 6169 6e65 6420         retained 
+00037010: 696e 7369 6465 2052 4f49 2c20 616e 6420  inside ROI, and 
+00037020: 4e61 4e20 656c 7365 7768 6572 652c 2069  NaN elsewhere, i
+00037030: 7320 746f 2062 6520 6f62 7461 696e 6564  s to be obtained
+00037040: 2e0a 2020 2020 2020 2020 2020 2020 4966  ..            If
+00037050: 204e 6f6e 652c 2074 6865 2069 6d61 6765   None, the image
+00037060: 2061 7373 6f63 6961 7465 6420 7769 7468   associated with
+00037070: 2074 6865 2052 4f49 2069 7320 7573 6564   the ROI is used
+00037080: 2e0a 0a20 2020 2020 2020 2073 7461 6e64  ...        stand
+00037090: 6172 6469 7365 203a 2062 6f6f 6c2c 2064  ardise : bool, d
+000370a0: 6566 6175 6c74 3d46 616c 7365 0a20 2020  efault=False.   
+000370b0: 2020 2020 2020 2020 2049 6620 4661 6c73           If Fals
+000370c0: 652c 2074 6865 2064 6174 6120 6172 7261  e, the data arra
+000370d0: 7920 7769 6c6c 2062 6520 7265 7475 726e  y will be return
+000370e0: 6564 2069 6e20 7468 6520 6f72 6965 6e74  ed in the orient
+000370f0: 6174 696f 6e20 696e 200a 2020 2020 2020  ation in .      
+00037100: 2020 2020 2020 7768 6963 6820 6974 2077        which it w
+00037110: 6173 206c 6f61 6465 643b 206f 7468 6572  as loaded; other
+00037120: 7769 7365 2c20 6974 2077 696c 6c20 6265  wise, it will be
+00037130: 2072 6574 7572 6e65 6420 696e 2073 7461   returned in sta
+00037140: 6e64 6172 640a 2020 2020 2020 2020 2020  ndard.          
+00037150: 2020 6469 636f 6d2d 7374 796c 6520 6f72    dicom-style or
+00037160: 6965 6e74 6174 696f 6e20 7375 6368 2074  ientation such t
+00037170: 6861 7420 5b63 6f6c 756d 6e2c 2072 6f77  hat [column, row
+00037180: 2c20 736c 6963 655d 2063 6f72 7265 7370  , slice] corresp
+00037190: 6f6e 6473 0a20 2020 2020 2020 2020 2020  onds.           
+000371a0: 2074 6f20 7468 6520 5b78 2c20 792c 207a   to the [x, y, z
+000371b0: 5d20 6178 6573 2e0a 2020 2020 2020 2020  ] axes..        
+000371c0: 2222 220a 2020 2020 2020 2020 6966 2069  """.        if i
+000371d0: 6d61 6765 2069 7320 4e6f 6e65 3a0a 2020  mage is None:.  
+000371e0: 2020 2020 2020 2020 2020 2320 436f 6e73            # Cons
+000371f0: 6964 6572 2069 6d61 6765 2061 7373 6f63  ider image assoc
+00037200: 6961 7465 6420 7769 7468 2073 656c 662e  iated with self.
+00037210: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00037220: 662e 6372 6561 7465 5f6d 6173 6b28 290a  f.create_mask().
+00037230: 2020 2020 2020 2020 2020 2020 696d 6167              imag
+00037240: 6520 3d20 7365 6c66 2e69 6d61 6765 0a20  e = self.image. 
+00037250: 2020 2020 2020 2020 2020 2072 6f69 203d             roi =
+00037260: 2073 656c 660a 2020 2020 2020 2020 656c   self.        el
+00037270: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+00037280: 2320 436c 6f6e 6520 7365 6c66 2c20 616e  # Clone self, an
+00037290: 6420 6173 736f 6369 6174 6520 7769 7468  d associate with
+000372a0: 2063 6c6f 6e65 2074 6865 2069 6d61 6765   clone the image
+000372b0: 2073 7065 6369 6669 6564 2069 6e20 696e   specified in in
+000372c0: 7075 742e 0a20 2020 2020 2020 2020 2020  put..           
+000372d0: 2072 6f69 203d 2073 656c 662e 636c 6f6e   roi = self.clon
+000372e0: 6528 290a 2020 2020 2020 2020 2020 2020  e().            
+000372f0: 726f 692e 7365 745f 696d 6167 6528 696d  roi.set_image(im
+00037300: 6167 6529 0a0a 2020 2020 2020 2020 2320  age)..        # 
+00037310: 4f62 7461 696e 2069 6e74 656e 7369 7479  Obtain intensity
+00037320: 2076 616c 7565 732e 0a20 2020 2020 2020   values..       
+00037330: 2069 6d5f 6461 7461 203d 2069 6d61 6765   im_data = image
+00037340: 2e67 6574 5f64 6174 6128 7374 616e 6461  .get_data(standa
+00037350: 7264 6973 653d 7374 616e 6461 7264 6973  rdise=standardis
+00037360: 6529 0a20 2020 2020 2020 206d 6173 6b20  e).        mask 
+00037370: 3d20 726f 692e 6765 745f 6d61 736b 2873  = roi.get_mask(s
+00037380: 7461 6e64 6172 6469 7365 3d73 7461 6e64  tandardise=stand
+00037390: 6172 6469 7365 290a 2020 2020 2020 2020  ardise).        
+000373a0: 696e 7465 6e73 6974 6965 735f 696e 5f72  intensities_in_r
+000373b0: 6f69 203d 206e 702e 6675 6c6c 2869 6d5f  oi = np.full(im_
+000373c0: 6461 7461 2e73 6861 7065 2c20 6e70 2e6e  data.shape, np.n
+000373d0: 616e 290a 2020 2020 2020 2020 696e 7465  an).        inte
+000373e0: 6e73 6974 6965 735f 696e 5f72 6f69 5b6d  nsities_in_roi[m
+000373f0: 6173 6b20 3e20 305d 203d 2069 6d5f 6461  ask > 0] = im_da
+00037400: 7461 5b6d 6173 6b20 3e20 305d 0a20 2020  ta[mask > 0].   
+00037410: 2020 2020 2072 6574 7572 6e20 696e 7465       return inte
+00037420: 6e73 6974 6965 735f 696e 5f72 6f69 0a0a  nsities_in_roi..
+00037430: 2020 2020 6465 6620 6765 745f 696e 7465      def get_inte
+00037440: 6e73 6974 6965 7328 7365 6c66 2c20 696d  nsities(self, im
+00037450: 6167 653d 4e6f 6e65 2c20 7374 616e 6461  age=None, standa
+00037460: 7264 6973 653d 5472 7565 293a 0a20 2020  rdise=True):.   
+00037470: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+00037480: 2052 6574 7572 6e20 3144 206e 756d 7079   Return 1D numpy
+00037490: 2061 7272 6179 2063 6f6e 7461 696e 696e   array containin
+000374a0: 6720 616c 6c20 6f66 2074 6865 2069 6e74  g all of the int
+000374b0: 656e 7369 7479 2076 616c 7565 7320 666f  ensity values fo
+000374c0: 7220 7468 6520 0a20 2020 2020 2020 2076  r the .        v
+000374d0: 6f78 656c 7320 696e 7369 6465 2073 656c  oxels inside sel
+000374e0: 662e 0a0a 2020 2020 2020 2020 2a2a 5061  f...        **Pa
+000374f0: 7261 6d65 7465 7273 3a2a 2a0a 0a20 2020  rameters:**..   
+00037500: 2020 2020 2069 6d61 6765 203a 2073 6b72       image : skr
+00037510: 742e 696d 6167 652e 496d 6167 652c 2064  t.image.Image, d
+00037520: 6566 6175 6c74 3d4e 6f6e 650a 2020 2020  efault=None.    
+00037530: 2020 2020 2020 2020 496d 6167 6520 6f62          Image ob
+00037540: 6a65 6374 2066 6f72 2077 6869 6368 2031  ject for which 1
+00037550: 4420 6172 7261 7920 6f66 2069 6e74 656e  D array of inten
+00037560: 7369 7479 2076 616c 7565 7320 6973 0a20  sity values is. 
+00037570: 2020 2020 2020 2020 2020 2074 6f20 6265             to be
+00037580: 206f 6274 6169 6e65 642e 2020 4966 204e   obtained.  If N
+00037590: 6f6e 652c 2074 6865 2069 6d61 6765 2061  one, the image a
+000375a0: 7373 6f63 6961 7465 6420 7769 7468 2074  ssociated with t
+000375b0: 6865 0a20 2020 2020 2020 2020 2020 2052  he.            R
+000375c0: 4f49 2069 7320 7573 6564 2e0a 0a20 2020  OI is used...   
+000375d0: 2020 2020 2073 7461 6e64 6172 6469 7365       standardise
+000375e0: 203a 2062 6f6f 6c2c 2064 6566 6175 6c74   : bool, default
+000375f0: 3d46 616c 7365 0a20 2020 2020 2020 2020  =False.         
+00037600: 2020 2049 6620 4661 6c73 652c 2074 6865     If False, the
+00037610: 2069 6d61 6765 2773 2064 6174 6120 6172   image's data ar
+00037620: 7261 7920 7769 6c6c 2062 6520 7573 6564  ray will be used
+00037630: 2069 6e20 7468 6520 6f72 6965 6e74 6174   in the orientat
+00037640: 696f 6e0a 2020 2020 2020 2020 2020 2020  ion.            
+00037650: 696e 2077 6869 6368 2069 7420 7761 7320  in which it was 
+00037660: 6c6f 6164 6564 3b20 6f74 6865 7277 6973  loaded; otherwis
+00037670: 652c 2069 7420 7769 6c6c 2062 6520 7573  e, it will be us
+00037680: 6564 2069 6e20 7374 616e 6461 7264 0a20  ed in standard. 
+00037690: 2020 2020 2020 2020 2020 2064 6963 6f6d             dicom
+000376a0: 2d73 7479 6c65 206f 7269 656e 7461 7469  -style orientati
+000376b0: 6f6e 2073 7563 6820 7468 6174 205b 636f  on such that [co
+000376c0: 6c75 6d6e 2c20 726f 772c 2073 6c69 6365  lumn, row, slice
+000376d0: 5d20 636f 7272 6573 706f 6e64 730a 2020  ] corresponds.  
+000376e0: 2020 2020 2020 2020 2020 746f 2074 6865            to the
+000376f0: 205b 782c 2079 2c20 7a5d 2061 7865 732e   [x, y, z] axes.
+00037700: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+00037710: 2020 2020 2069 6e74 656e 7369 7469 6573       intensities
+00037720: 203d 2073 656c 662e 6765 745f 696e 7465   = self.get_inte
+00037730: 6e73 6974 6965 735f 3364 2869 6d61 6765  nsities_3d(image
+00037740: 2c20 7374 616e 6461 7264 6973 6529 0a20  , standardise). 
+00037750: 2020 2020 2020 2072 6574 7572 6e20 696e         return in
+00037760: 7465 6e73 6974 6965 735b 7e6e 702e 6973  tensities[~np.is
+00037770: 6e61 6e28 696e 7465 6e73 6974 6965 7329  nan(intensities)
+00037780: 5d0a 2020 2020 2020 2020 0a63 6c61 7373  ].        .class
+00037790: 2053 7472 7563 7475 7265 5365 7428 736b   StructureSet(sk
+000377a0: 7274 2e63 6f72 652e 4172 6368 6976 6529  rt.core.Archive)
+000377b0: 3a0a 2020 2020 2222 220a 2020 2020 436c  :.    """.    Cl
+000377c0: 6173 7320 7265 7072 6573 656e 7469 6e67  ass representing
+000377d0: 2061 2072 6164 696f 7468 6572 6170 7920   a radiotherapy 
+000377e0: 7374 7275 6374 7572 6520 7365 740a 2020  structure set.  
+000377f0: 2020 6173 2061 2063 6f6c 6c65 6374 696f    as a collectio
+00037800: 6e20 6f66 2072 6567 696f 6e73 206f 6620  n of regions of 
+00037810: 696e 7465 7265 7374 2028 524f 4973 292e  interest (ROIs).
+00037820: 0a0a 2020 2020 4174 7472 6962 7574 6573  ..    Attributes
+00037830: 206f 6620 6120 5374 7275 6374 7572 6553   of a StructureS
+00037840: 6574 206f 626a 6563 7420 7368 6f75 6c64  et object should
+00037850: 2075 7375 616c 6c79 2062 6520 6163 6365   usually be acce
+00037860: 7373 6564 2076 6961 0a20 2020 2074 6865  ssed via.    the
+00037870: 6972 2067 6574 7465 7220 6d65 7468 6f64  ir getter method
+00037880: 732c 2072 6174 6865 7220 7468 616e 2064  s, rather than d
+00037890: 6972 6563 746c 792c 2074 6f20 656e 7375  irectly, to ensu
+000378a0: 7265 2074 6861 740a 2020 2020 6174 7472  re that.    attr
+000378b0: 6962 7574 6520 7661 6c75 6573 2068 6176  ibute values hav
+000378c0: 6520 6265 656e 206c 6f61 6465 642e 0a20  e been loaded.. 
+000378d0: 2020 2022 2222 0a0a 2020 2020 6465 6620     """..    def 
+000378e0: 5f5f 696e 6974 5f5f 280a 2020 2020 2020  __init__(.      
+000378f0: 2020 7365 6c66 2c0a 2020 2020 2020 2020    self,.        
+00037900: 7061 7468 3d4e 6f6e 652c 0a20 2020 2020  path=None,.     
+00037910: 2020 206e 616d 653d 4e6f 6e65 2c0a 2020     name=None,.  
+00037920: 2020 2020 2020 696d 6167 653d 4e6f 6e65        image=None
+00037930: 2c0a 2020 2020 2020 2020 6c6f 6164 3d54  ,.        load=T
+00037940: 7275 652c 0a20 2020 2020 2020 206e 616d  rue,.        nam
+00037950: 6573 3d4e 6f6e 652c 0a20 2020 2020 2020  es=None,.       
+00037960: 206b 6565 705f 7265 6e61 6d65 645f 6f6e   keep_renamed_on
+00037970: 6c79 3d46 616c 7365 2c0a 2020 2020 2020  ly=False,.      
+00037980: 2020 746f 5f6b 6565 703d 4e6f 6e65 2c0a    to_keep=None,.
+00037990: 2020 2020 2020 2020 746f 5f72 656d 6f76          to_remov
+000379a0: 653d 4e6f 6e65 2c0a 2020 2020 2020 2020  e=None,.        
+000379b0: 6d75 6c74 695f 6c61 6265 6c3d 4661 6c73  multi_label=Fals
+000379c0: 652c 0a20 2020 2020 2020 2063 6f6c 6f72  e,.        color
+000379d0: 733d 4e6f 6e65 2c0a 2020 2020 2020 2020  s=None,.        
+000379e0: 6967 6e6f 7265 5f64 6963 6f6d 5f63 6f6c  ignore_dicom_col
+000379f0: 6f72 733d 4661 6c73 652c 0a20 2020 2020  ors=False,.     
+00037a00: 2020 2061 7574 6f5f 7469 6d65 7374 616d     auto_timestam
+00037a10: 703d 4661 6c73 652c 0a20 2020 2020 2020  p=False,.       
+00037a20: 2061 6c70 6861 5f62 6574 615f 7261 7469   alpha_beta_rati
+00037a30: 6f73 3d4e 6f6e 652c 0a20 2020 2020 2020  os=None,.       
+00037a40: 202a 2a6b 7761 7267 730a 2020 2020 293a   **kwargs.    ):
+00037a50: 0a20 2020 2020 2020 2022 2222 4c6f 6164  .        """Load
+00037a60: 2073 7472 7563 7475 7265 2073 6574 2066   structure set f
+00037a70: 726f 6d20 7468 6520 736f 7572 6365 2873  rom the source(s
+00037a80: 2920 6769 7665 6e20 696e 203c 7061 7468  ) given in <path
+00037a90: 3e2e 0a0a 2020 2020 2020 2020 2a2a 5061  >...        **Pa
+00037aa0: 7261 6d65 7465 7273 2a2a 3a0a 0a20 2020  rameters**:..   
+00037ab0: 2020 2020 2070 6174 6820 3a20 7374 722f       path : str/
+00037ac0: 6c69 7374 2c20 6465 6661 756c 743d 4e6f  list, default=No
+00037ad0: 6e65 0a20 2020 2020 2020 2020 2020 2053  ne.            S
+00037ae0: 6f75 7263 6528 7329 206f 6620 524f 4973  ource(s) of ROIs
+00037af0: 2074 6f20 6c6f 6164 2069 6e74 6f20 7468   to load into th
+00037b00: 6973 2073 7472 7563 7475 7265 2073 6574  is structure set
+00037b10: 2e20 4361 6e20 6265 3a0a 0a20 2020 2020  . Can be:..     
+00037b20: 2020 2020 2020 202d 2054 6865 2070 6174         - The pat
+00037b30: 6820 746f 2061 2073 696e 676c 6520 6469  h to a single di
+00037b40: 636f 6d20 7374 7275 6374 7572 6520 7365  com structure se
+00037b50: 7420 6669 6c65 3b0a 2020 2020 2020 2020  t file;.        
+00037b60: 2020 2020 2d20 5468 6520 7061 7468 2074      - The path t
+00037b70: 6f20 6120 7369 6e67 6c65 206e 6966 7469  o a single nifti
+00037b80: 2066 696c 6520 636f 6e74 6169 6e69 6e67   file containing
+00037b90: 2061 6e20 524f 4920 6d61 736b 3b0a 2020   an ROI mask;.  
+00037ba0: 2020 2020 2020 2020 2020 2d20 4120 6c69            - A li
+00037bb0: 7374 206f 6620 7061 7468 7320 746f 206e  st of paths to n
+00037bc0: 6966 7469 2066 696c 6573 2063 6f6e 7461  ifti files conta
+00037bd0: 696e 696e 6720 524f 4920 6d61 736b 733b  ining ROI masks;
+00037be0: 0a20 2020 2020 2020 2020 2020 202d 2054  .            - T
+00037bf0: 6865 2070 6174 6820 746f 2061 2064 6972  he path to a dir
+00037c00: 6563 746f 7279 2063 6f6e 7461 696e 696e  ectory containin
+00037c10: 6720 6d75 6c74 6970 6c65 206e 6966 7469  g multiple nifti
+00037c20: 2066 696c 6573 200a 2020 2020 2020 2020   files .        
+00037c30: 2020 2020 636f 6e74 6169 6e69 6e67 2052      containing R
+00037c40: 4f49 206d 6173 6b73 3b0a 2020 2020 2020  OI masks;.      
+00037c50: 2020 2020 2020 2d20 4120 6c69 7374 206f        - A list o
+00037c60: 6620 524f 4920 6f62 6a65 6374 733b 0a20  f ROI objects;. 
+00037c70: 2020 2020 2020 2020 2020 202d 2041 206c             - A l
+00037c80: 6973 7420 6f66 206f 626a 6563 7473 2074  ist of objects t
+00037c90: 6861 7420 636f 756c 6420 6265 2075 7365  hat could be use
+00037ca0: 6420 746f 2069 6e69 7469 616c 6973 6520  d to initialise 
+00037cb0: 616e 2052 4f49 206f 626a 6563 740a 2020  an ROI object.  
+00037cc0: 2020 2020 2020 2020 2020 2865 2e67 2e20            (e.g. 
+00037cd0: 6120 6e75 6d70 7920 6172 7261 7929 2e0a  a numpy array)..
+00037ce0: 0a20 2020 2020 2020 206e 616d 6520 3a20  .        name : 
+00037cf0: 7374 722c 2064 6566 6175 6c74 3d4e 6f6e  str, default=Non
+00037d00: 650a 2020 2020 2020 2020 2020 2020 4f70  e.            Op
+00037d10: 7469 6f6e 616c 206e 616d 6520 746f 2061  tional name to a
+00037d20: 7373 6967 6e20 746f 2074 6869 7320 7374  ssign to this st
+00037d30: 7275 6374 7572 6520 7365 742e 2049 6620  ructure set. If 
+00037d40: 4e6f 6e65 2c20 7769 6c6c 200a 2020 2020  None, will .    
+00037d50: 2020 2020 2020 2020 6174 7465 6d70 7420          attempt 
+00037d60: 746f 2069 6e66 6572 2066 726f 6d20 696e  to infer from in
+00037d70: 7075 7420 6669 6c65 6e61 6d65 2e0a 0a20  put filename... 
+00037d80: 2020 2020 2020 2069 6d61 6765 203a 2073         image : s
+00037d90: 6b72 742e 696d 6167 652e 496d 6167 652c  krt.image.Image,
+00037da0: 2064 6566 6175 6c74 3d4e 6f6e 650a 2020   default=None.  
+00037db0: 2020 2020 2020 2020 2020 496d 6167 6520            Image 
+00037dc0: 6173 736f 6369 6174 6564 2077 6974 6820  associated with 
+00037dd0: 7468 6973 2073 7472 7563 7475 7265 2073  this structure s
+00037de0: 6574 2e20 4966 2074 6865 2069 6e70 7574  et. If the input
+00037df0: 2073 6f75 7263 6520 6973 2061 0a20 2020   source is a.   
+00037e00: 2020 2020 2020 2020 2064 6963 6f6d 2066           dicom f
+00037e10: 696c 6520 636f 6e74 6169 6e69 6e67 2052  ile containing R
+00037e20: 4f49 2063 6f6e 746f 7572 732c 2074 6869  OI contours, thi
+00037e30: 7320 696d 6167 6520 7769 6c6c 2062 6520  s image will be 
+00037e40: 7573 6564 2077 6865 6e0a 2020 2020 2020  used when.      
+00037e50: 2020 2020 2020 6372 6561 7469 6e67 2052        creating R
+00037e60: 4f49 2062 696e 6172 7920 6d61 736b 732e  OI binary masks.
+00037e70: 0a0a 2020 2020 2020 2020 6c6f 6164 203a  ..        load :
+00037e80: 2062 6f6f 6c2c 2064 6566 6175 6c74 3d54   bool, default=T
+00037e90: 7275 650a 2020 2020 2020 2020 2020 2020  rue.            
+00037ea0: 4966 2054 7275 652c 2052 4f49 7320 7769  If True, ROIs wi
+00037eb0: 6c6c 2069 6d6d 6564 6961 7465 6c79 2062  ll immediately b
+00037ec0: 6520 6c6f 6164 6564 2066 726f 6d20 736f  e loaded from so
+00037ed0: 7572 6365 732e 204f 7468 6572 7769 7365  urces. Otherwise
+00037ee0: 2c0a 2020 2020 2020 2020 2020 2020 6c6f  ,.            lo
+00037ef0: 6164 696e 6720 7769 6c6c 206e 6f74 206f  ading will not o
+00037f00: 6363 7572 2075 6e74 696c 2053 7472 7563  ccur until Struc
+00037f10: 7475 7265 5365 742e 6c6f 6164 2829 2069  tureSet.load() i
+00037f20: 7320 6361 6c6c 6564 2e0a 2020 2020 2020  s called..      
+00037f30: 2020 0a20 2020 2020 2020 206e 616d 6573    .        names
+00037f40: 203a 2064 6963 742f 6c69 7374 2c20 6465   : dict/list, de
+00037f50: 6661 756c 743d 4e6f 6e65 0a20 2020 2020  fault=None.     
+00037f60: 2020 2020 2020 204f 7074 696f 6e61 6c20         Optional 
+00037f70: 6469 6374 206f 6620 524f 4920 6e61 6d65  dict of ROI name
+00037f80: 7320 746f 2075 7365 2077 6865 6e20 7265  s to use when re
+00037f90: 6e61 6d69 6e67 206c 6f61 6465 6420 524f  naming loaded RO
+00037fa0: 4973 2e20 4b65 7973 200a 2020 2020 2020  Is. Keys .      
+00037fb0: 2020 2020 2020 7368 6f75 6c64 2062 6520        should be 
+00037fc0: 6465 7369 7265 6420 6e61 6d65 732c 2061  desired names, a
+00037fd0: 6e64 2076 616c 7565 7320 7368 6f75 6c64  nd values should
+00037fe0: 2062 6520 6c69 7374 7320 6f66 2070 6f73   be lists of pos
+00037ff0: 7369 626c 650a 2020 2020 2020 2020 2020  sible.          
+00038000: 2020 696e 7075 7420 6e61 6d65 7320 6f72    input names or
+00038010: 2077 696c 6463 6172 6473 206d 6174 6368   wildcards match
+00038020: 696e 6720 696e 7075 7420 6e61 6d65 732e  ing input names.
+00038030: 0a0a 2020 2020 2020 2020 2020 2020 4966  ..            If
+00038040: 206d 756c 7469 5f6c 6162 656c 3d54 7275   multi_label=Tru
+00038050: 652c 206e 616d 6573 2063 616e 2061 6c73  e, names can als
+00038060: 6f20 6265 2061 206c 6973 7420 6f66 206e  o be a list of n
+00038070: 616d 6573 2074 6f20 6173 7369 676e 0a20  ames to assign. 
+00038080: 2020 2020 2020 2020 2020 2074 6f20 6561             to ea
+00038090: 6368 206c 6162 656c 2066 6f75 6e64 2069  ch label found i
+000380a0: 6e20 6f72 6465 722c 2066 726f 6d20 736d  n order, from sm
+000380b0: 616c 6c65 7374 2074 6f20 6c61 7267 6573  allest to larges
+000380c0: 742e 0a0a 2020 2020 2020 2020 746f 5f6b  t...        to_k
+000380d0: 6565 7020 3a20 6c69 7374 2c20 6465 6661  eep : list, defa
+000380e0: 756c 743d 4e6f 6e65 0a20 2020 2020 2020  ult=None.       
+000380f0: 2020 2020 204f 7074 696f 6e61 6c20 6c69       Optional li
+00038100: 7374 206f 6620 524f 4920 6e61 6d65 7320  st of ROI names 
+00038110: 6f72 2077 696c 6463 6172 6473 206d 6174  or wildcards mat
+00038120: 6368 696e 6720 524f 4920 6e61 6d65 7320  ching ROI names 
+00038130: 6f66 2052 4f49 730a 2020 2020 2020 2020  of ROIs.        
+00038140: 2020 2020 746f 206b 6565 7020 696e 2074      to keep in t
+00038150: 6869 7320 5374 7275 6374 7572 6553 6574  his StructureSet
+00038160: 2064 7572 696e 6720 6c6f 6164 696e 672e   during loading.
+00038170: 2052 4f49 7320 6e6f 7420 6d61 7463 6869   ROIs not matchi
+00038180: 6e67 2077 696c 6c0a 2020 2020 2020 2020  ng will.        
+00038190: 2020 2020 6265 2064 6973 6361 7264 6564      be discarded
+000381a0: 2e20 4e6f 7465 2074 6861 7420 7468 6520  . Note that the 
+000381b0: 6e61 6d65 7320 7368 6f75 6c64 2072 6566  names should ref
+000381c0: 6c65 6374 2074 686f 7365 2061 6674 6572  lect those after
+000381d0: 200a 2020 2020 2020 2020 2020 2020 7265   .            re
+000381e0: 6e61 6d69 6e67 2076 6961 2074 6865 203c  naming via the <
+000381f0: 6e61 6d65 733e 2064 6963 742e 2049 6620  names> dict. If 
+00038200: 4e6f 6e65 2c20 616c 6c20 524f 4973 2077  None, all ROIs w
+00038210: 696c 6c20 6265 206b 6570 742e 0a0a 2020  ill be kept...  
+00038220: 2020 2020 2020 746f 5f72 656d 6f76 6520        to_remove 
+00038230: 3a20 6c69 7374 2c20 6465 6661 756c 743d  : list, default=
+00038240: 4e6f 6e65 0a20 2020 2020 2020 2020 2020  None.           
+00038250: 204f 7074 696f 6e61 6c20 6c69 7374 206f   Optional list o
+00038260: 6620 524f 4920 6e61 6d65 7320 6f72 2077  f ROI names or w
+00038270: 696c 6463 6172 6473 206d 6174 6368 696e  ildcards matchin
+00038280: 6720 524f 4920 6e61 6d65 7320 6f66 2052  g ROI names of R
+00038290: 4f49 730a 2020 2020 2020 2020 2020 2020  OIs.            
+000382a0: 746f 2072 656d 6f76 6520 6672 6f6d 2074  to remove from t
+000382b0: 6869 7320 5374 7275 6374 7572 6553 6574  his StructureSet
+000382c0: 2064 7572 696e 6720 6c6f 6164 696e 672e   during loading.
+000382d0: 2052 4f49 7320 6d61 7463 6869 6e67 2077   ROIs matching w
+000382e0: 696c 6c0a 2020 2020 2020 2020 2020 2020  ill.            
+000382f0: 6265 2064 6973 6361 7264 6564 2e20 4e6f  be discarded. No
+00038300: 7465 2074 6861 7420 7468 6520 6e61 6d65  te that the name
+00038310: 7320 7368 6f75 6c64 2072 6566 6c65 6374  s should reflect
+00038320: 2074 686f 7365 2061 6674 6572 200a 2020   those after .  
+00038330: 2020 2020 2020 2020 2020 7265 6e61 6d69            renami
+00038340: 6e67 2076 6961 2074 6865 203c 6e61 6d65  ng via the <name
+00038350: 733e 2064 6963 742c 2061 6e64 2072 656d  s> dict, and rem
+00038360: 6f76 616c 206f 6363 7572 7320 6166 7465  oval occurs afte
+00038370: 7220 6669 6c74 6572 696e 670a 2020 2020  r filtering.    
+00038380: 2020 2020 2020 2020 7769 7468 2074 6865          with the
+00038390: 203c 746f 5f6b 6565 703e 206c 6973 742e   <to_keep> list.
+000383a0: 2049 6620 4e6f 6e65 2c20 6e6f 2052 4f49   If None, no ROI
+000383b0: 7320 7769 6c6c 2062 6520 7265 6d6f 7665  s will be remove
+000383c0: 642e 0a0a 2020 2020 2020 2020 6d75 6c74  d...        mult
+000383d0: 695f 6c61 6265 6c20 3a20 626f 6f6c 2c20  i_label : bool, 
+000383e0: 6465 6661 756c 743d 4661 6c73 650a 2020  default=False.  
+000383f0: 2020 2020 2020 2020 2020 4966 2054 7275            If Tru
+00038400: 652c 2077 696c 6c20 6c6f 6f6b 2066 6f72  e, will look for
+00038410: 206d 756c 7469 706c 6520 524f 4920 6d61   multiple ROI ma
+00038420: 736b 7320 7769 7468 2064 6966 6665 7265  sks with differe
+00038430: 6e74 206c 6162 656c 7320 0a20 2020 2020  nt labels .     
+00038440: 2020 2020 2020 2069 6e73 6964 6520 7468         inside th
+00038450: 6520 6172 7261 7920 616e 6420 6372 6561  e array and crea
+00038460: 7465 2061 2073 6570 6172 6174 6520 524f  te a separate RO
+00038470: 4920 6672 6f6d 2065 6163 682e 0a0a 2020  I from each...  
+00038480: 2020 2020 2020 636f 6c6f 7273 203a 206c        colors : l
+00038490: 6973 742f 6469 6374 0a20 2020 2020 2020  ist/dict.       
+000384a0: 2020 2020 204c 6973 7420 6f72 2064 6963       List or dic
+000384b0: 7420 6f66 2063 6f6c 6f72 732e 2049 6620  t of colors. If 
+000384c0: 6120 6469 6374 2c20 7468 6520 6b65 7973  a dict, the keys
+000384d0: 2073 686f 756c 6420 6265 2052 4f49 206e   should be ROI n
+000384e0: 616d 6573 206f 720a 2020 2020 2020 2020  ames or.        
+000384f0: 2020 2020 7769 6c64 6361 7264 7320 6d61      wildcards ma
+00038500: 7463 6869 6e67 2052 4f49 206e 616d 6573  tching ROI names
+00038510: 2c20 616e 6420 7468 6520 7661 6c75 6573  , and the values
+00038520: 2073 686f 756c 6420 6265 2064 6573 6972   should be desir
+00038530: 6564 200a 2020 2020 2020 2020 2020 2020  ed .            
+00038540: 636f 6c6f 7273 2066 6f72 2052 4f49 7320  colors for ROIs 
+00038550: 6d61 7463 6869 6e67 2074 6861 7420 6e61  matching that na
+00038560: 6d65 2e20 4966 2061 206c 6973 742c 2073  me. If a list, s
+00038570: 686f 756c 6420 636f 6e74 6169 6e0a 2020  hould contain.  
+00038580: 2020 2020 2020 2020 2020 636f 6c6f 7273            colors
+00038590: 2077 6869 6368 2077 696c 6c20 6265 2061   which will be a
+000385a0: 7070 6c69 6564 2074 6f20 6c6f 6164 6564  pplied to loaded
+000385b0: 2052 4f49 7320 696e 206f 7264 6572 2e0a   ROIs in order..
+000385c0: 0a20 2020 2020 2020 2061 7574 6f5f 7469  .        auto_ti
+000385d0: 6d65 7374 616d 7020 3a20 626f 6f6c 2064  mestamp : bool d
+000385e0: 6566 6175 6c74 3d46 616c 7365 0a20 2020  efault=False.   
+000385f0: 2020 2020 2020 2020 2049 6620 7472 7565           If true
+00038600: 2061 6e64 206e 6f20 7661 6c69 6420 7469   and no valid ti
+00038610: 6d65 7374 616d 7020 6973 2066 6f75 6e64  mestamp is found
+00038620: 2077 6974 6869 6e20 7468 6520 7061 7468   within the path
+00038630: 2073 7472 696e 672c 0a20 2020 2020 2020   string,.       
+00038640: 2020 2020 2074 696d 6573 7461 6d70 2067       timestamp g
+00038650: 656e 6572 6174 6564 2066 726f 6d20 6375  enerated from cu
+00038660: 7272 656e 7420 6461 7465 2061 6e64 2074  rrent date and t
+00038670: 696d 652e 0a0a 2020 2020 2020 2020 616c  ime...        al
+00038680: 7068 615f 6265 7461 5f72 6174 696f 7320  pha_beta_ratios 
+00038690: 3a20 6469 6374 2c20 6465 6661 756c 743d  : dict, default=
+000386a0: 4e6f 6e65 0a20 2020 2020 2020 2020 2020  None.           
+000386b0: 2044 6963 7469 6f6e 6172 7920 7768 6572   Dictionary wher
+000386c0: 6520 6b65 7973 2061 7265 2052 4f49 206e  e keys are ROI n
+000386d0: 616d 6573 2061 6e64 2076 616c 7565 7320  ames and values 
+000386e0: 6172 650a 2020 2020 2020 2020 2020 2020  are.            
+000386f0: 7261 7469 6f73 2066 6f72 2052 4f49 2074  ratios for ROI t
+00038700: 6973 7375 6573 206f 6620 636f 6566 6669  issues of coeffi
+00038710: 6369 656e 7473 2c20 616c 7068 612c 2062  cients, alpha, b
+00038720: 6574 612c 0a20 2020 2020 2020 2020 2020  eta,.           
+00038730: 2069 6e20 7468 6520 6c69 6e65 6172 2d71   in the linear-q
+00038740: 7561 6472 6174 6963 2065 7175 6174 696f  uadratic equatio
+00038750: 6e2e 2020 5468 6573 6520 7261 7469 6f73  n.  These ratios
+00038760: 2061 7265 0a20 2020 2020 2020 2020 2020   are.           
+00038770: 2075 7365 6420 696e 2063 616c 6375 6c61   used in calcula
+00038780: 7469 6e67 2062 696f 6c6f 6769 6361 6c6c  ting biologicall
+00038790: 7920 6566 6665 6374 6976 6520 646f 7365  y effective dose
+000387a0: 2c20 4245 442c 2066 726f 6d0a 2020 2020  , BED, from.    
+000387b0: 2020 2020 2020 2020 7068 7973 6963 616c          physical
+000387c0: 2064 6f73 652c 2044 2c20 6465 6c69 7665   dose, D, delive
+000387d0: 7265 6420 6f76 6572 206e 2065 7175 616c  red over n equal
+000387e0: 2066 7261 6374 696f 6e73 3a0a 2020 2020   fractions:.    
+000387f0: 2020 2020 2020 2020 2020 2020 4245 4420              BED 
+00038800: 3d20 4420 2a20 2831 202b 2028 442f 6e29  = D * (1 + (D/n)
+00038810: 202f 2028 616c 7068 612f 6265 7461 2929   / (alpha/beta))
+00038820: 2e0a 2020 2020 2020 2020 2020 2020 5468  ..            Th
+00038830: 6520 6174 7472 6962 7574 6520 616c 7068  e attribute alph
+00038840: 615f 6f76 6572 5f76 616c 7565 2069 7320  a_over_value is 
+00038850: 7365 7420 746f 2074 6865 2064 6963 7469  set to the dicti
+00038860: 6f6e 6172 7920 7661 6c75 650a 2020 2020  onary value.    
+00038870: 2020 2020 2020 2020 666f 7220 616e 2052          for an R
+00038880: 4f49 2069 6465 6e74 6966 6965 6420 6279  OI identified by
+00038890: 2061 206b 6579 2c20 6f72 2069 7320 7365   a key, or is se
+000388a0: 7420 746f 204e 6f6e 6520 666f 7220 616e  t to None for an
+000388b0: 790a 2020 2020 2020 2020 2020 2020 6f74  y.            ot
+000388c0: 6865 7220 524f 4973 2e0a 0a20 2020 2020  her ROIs...     
+000388d0: 2020 2060 2a2a 606b 7761 7267 7320 3a0a     `**`kwargs :.
+000388e0: 2020 2020 2020 2020 2020 2020 4164 6469              Addi
+000388f0: 7469 6f6e 616c 206b 6579 776f 7264 2061  tional keyword a
+00038900: 7267 7320 746f 2075 7365 2077 6865 6e20  rgs to use when 
+00038910: 696e 6974 6961 6c69 7369 6e67 206e 6577  initialising new
+00038920: 2052 4f49 206f 626a 6563 7473 2e0a 2020   ROI objects..  
+00038930: 2020 2020 2020 2222 220a 0a20 2020 2020        """..     
+00038940: 2020 2023 2043 6c6f 6e65 2066 726f 6d20     # Clone from 
+00038950: 616e 6f74 6865 7220 5374 7275 6374 7572  another Structur
+00038960: 6553 6574 206f 626a 6563 740a 2020 2020  eSet object.    
+00038970: 2020 2020 6966 2069 7373 7562 636c 6173      if issubclas
+00038980: 7328 7479 7065 2870 6174 6829 2c20 5374  s(type(path), St
+00038990: 7275 6374 7572 6553 6574 293a 0a20 2020  ructureSet):.   
+000389a0: 2020 2020 2020 2020 2070 6174 682e 636c           path.cl
+000389b0: 6f6e 655f 6174 7472 7328 7365 6c66 290a  one_attrs(self).
+000389c0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+000389d0: 726e 0a0a 2020 2020 2020 2020 7365 6c66  rn..        self
+000389e0: 2e6e 616d 6520 3d20 6e61 6d65 0a20 2020  .name = name.   
+000389f0: 2020 2020 2070 6174 6820 3d20 2873 6b72       path = (skr
+00038a00: 742e 636f 7265 2e66 756c 6c70 6174 6828  t.core.fullpath(
+00038a10: 7061 7468 290a 2020 2020 2020 2020 2020  path).          
+00038a20: 2020 2020 2020 6966 2069 7369 6e73 7461        if isinsta
+00038a30: 6e63 6528 7061 7468 2c20 2873 7472 2c20  nce(path, (str, 
+00038a40: 5061 7468 2929 2065 6c73 6520 7061 7468  Path)) else path
+00038a50: 290a 2020 2020 2020 2020 7365 6c66 2e73  ).        self.s
+00038a60: 6f75 7263 6573 203d 2070 6174 680a 2020  ources = path.  
+00038a70: 2020 2020 2020 6966 2073 656c 662e 736f        if self.so
+00038a80: 7572 6365 7320 6973 204e 6f6e 653a 0a20  urces is None:. 
+00038a90: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00038aa0: 736f 7572 6365 7320 3d20 5b5d 0a20 2020  sources = [].   
+00038ab0: 2020 2020 2065 6c69 6620 6e6f 7420 736b       elif not sk
+00038ac0: 7274 2e63 6f72 652e 6973 5f6c 6973 7428  rt.core.is_list(
+00038ad0: 7061 7468 293a 0a20 2020 2020 2020 2020  path):.         
+00038ae0: 2020 2073 656c 662e 736f 7572 6365 7320     self.sources 
+00038af0: 3d20 5b70 6174 685d 0a20 2020 2020 2020  = [path].       
+00038b00: 2073 656c 662e 726f 6973 203d 205b 5d0a   self.rois = [].
+00038b10: 2020 2020 2020 2020 7365 6c66 2e73 6574          self.set
+00038b20: 5f69 6d61 6765 2869 6d61 6765 290a 2020  _image(image).  
+00038b30: 2020 2020 2020 7365 6c66 2e74 6f5f 6b65        self.to_ke
+00038b40: 6570 203d 2074 6f5f 6b65 6570 0a20 2020  ep = to_keep.   
+00038b50: 2020 2020 2073 656c 662e 746f 5f72 656d       self.to_rem
+00038b60: 6f76 6520 3d20 746f 5f72 656d 6f76 650a  ove = to_remove.
+00038b70: 2020 2020 2020 2020 7365 6c66 2e6e 616d          self.nam
+00038b80: 6573 203d 206e 616d 6573 0a20 2020 2020  es = names.     
+00038b90: 2020 2073 656c 662e 6b65 6570 5f72 656e     self.keep_ren
+00038ba0: 616d 6564 5f6f 6e6c 7920 3d20 6b65 6570  amed_only = keep
+00038bb0: 5f72 656e 616d 6564 5f6f 6e6c 790a 2020  _renamed_only.  
+00038bc0: 2020 2020 2020 7365 6c66 2e6d 756c 7469        self.multi
+00038bd0: 5f6c 6162 656c 203d 206d 756c 7469 5f6c  _label = multi_l
+00038be0: 6162 656c 0a20 2020 2020 2020 2073 656c  abel.        sel
+00038bf0: 662e 636f 6c6f 7273 203d 2063 6f6c 6f72  f.colors = color
+00038c00: 730a 2020 2020 2020 2020 7365 6c66 2e69  s.        self.i
+00038c10: 676e 6f72 655f 6469 636f 6d5f 636f 6c6f  gnore_dicom_colo
+00038c20: 7273 203d 2069 676e 6f72 655f 6469 636f  rs = ignore_dico
+00038c30: 6d5f 636f 6c6f 7273 0a20 2020 2020 2020  m_colors.       
+00038c40: 2073 656c 662e 6469 636f 6d5f 6461 7461   self.dicom_data
+00038c50: 7365 7420 3d20 4e6f 6e65 0a20 2020 2020  set = None.     
+00038c60: 2020 2073 656c 662e 616c 7068 615f 6265     self.alpha_be
+00038c70: 7461 5f72 6174 696f 7320 3d20 616c 7068  ta_ratios = alph
+00038c80: 615f 6265 7461 5f72 6174 696f 7320 6f72  a_beta_ratios or
+00038c90: 207b 7d0a 2020 2020 2020 2020 7365 6c66   {}.        self
+00038ca0: 2e72 6f69 5f6b 7761 7267 7320 3d20 6b77  .roi_kwargs = kw
+00038cb0: 6172 6773 0a20 2020 2020 2020 2073 656c  args.        sel
+00038cc0: 662e 706c 616e 7320 3d20 5b5d 0a20 2020  f.plans = [].   
+00038cd0: 2020 2020 2070 6174 6820 3d20 7061 7468       path = path
+00038ce0: 2069 6620 6973 696e 7374 616e 6365 2870   if isinstance(p
+00038cf0: 6174 682c 2073 7472 2920 656c 7365 2022  ath, str) else "
+00038d00: 220a 2020 2020 2020 2020 736b 7274 2e63  ".        skrt.c
+00038d10: 6f72 652e 4172 6368 6976 652e 5f5f 696e  ore.Archive.__in
+00038d20: 6974 5f5f 2873 656c 662c 2070 6174 682c  it__(self, path,
+00038d30: 2061 7574 6f5f 7469 6d65 7374 616d 7029   auto_timestamp)
+00038d40: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
+00038d50: 2e70 6174 6820 616e 6420 6e6f 7420 7365  .path and not se
+00038d60: 6c66 2e6e 616d 653a 0a20 2020 2020 2020  lf.name:.       
+00038d70: 2020 2020 206e 616d 6520 3d20 5061 7468       name = Path
+00038d80: 2873 656c 662e 7061 7468 292e 6e61 6d65  (self.path).name
+00038d90: 2e73 706c 6974 2827 5f27 295b 305d 2e6c  .split('_')[0].l
+00038da0: 6f77 6572 2829 0a20 2020 2020 2020 2020  ower().         
+00038db0: 2020 2069 6620 6e61 6d65 5b30 5d2e 6973     if name[0].is
+00038dc0: 616c 7068 6128 293a 0a20 2020 2020 2020  alpha():.       
+00038dd0: 2020 2020 2020 2020 2073 656c 662e 6e61           self.na
+00038de0: 6d65 203d 206e 616d 650a 2020 2020 2020  me = name.      
+00038df0: 2020 7365 6c66 2e73 756d 6d65 645f 6e61    self.summed_na
+00038e00: 6d65 7320 3d20 5b5d 0a0a 2020 2020 2020  mes = []..      
+00038e10: 2020 7365 6c66 2e6c 6f61 6465 6420 3d20    self.loaded = 
+00038e20: 4661 6c73 650a 2020 2020 2020 2020 6966  False.        if
+00038e30: 206c 6f61 643a 0a20 2020 2020 2020 2020   load:.         
+00038e40: 2020 2073 656c 662e 6c6f 6164 2829 0a0a     self.load()..
+00038e50: 2020 2020 6465 6620 5f5f 6765 7469 7465      def __getite
+00038e60: 6d5f 5f28 7365 6c66 2c20 726f 6929 3a0a  m__(self, roi):.
+00038e70: 2020 2020 2020 2020 6966 2069 7369 6e73          if isins
+00038e80: 7461 6e63 6528 726f 692c 2069 6e74 293a  tance(roi, int):
+00038e90: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+00038ea0: 7572 6e20 7365 6c66 2e67 6574 5f72 6f69  urn self.get_roi
+00038eb0: 7328 295b 726f 695d 200a 2020 2020 2020  s()[roi] .      
+00038ec0: 2020 656c 6966 2069 7369 6e73 7461 6e63    elif isinstanc
+00038ed0: 6528 726f 692c 2073 7472 293a 0a20 2020  e(roi, str):.   
+00038ee0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00038ef0: 7365 6c66 2e67 6574 5f72 6f69 5f64 6963  self.get_roi_dic
+00038f00: 7428 295b 726f 695d 0a0a 2020 2020 6465  t()[roi]..    de
+00038f10: 6620 5f5f 6974 6572 5f5f 2873 656c 6629  f __iter__(self)
+00038f20: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
+00038f30: 2053 7472 7563 7475 7265 5365 7449 7465   StructureSetIte
+00038f40: 7261 746f 7228 7365 6c66 290a 0a20 2020  rator(self)..   
+00038f50: 2064 6566 205f 5f61 6464 5f5f 2873 656c   def __add__(sel
+00038f60: 662c 206f 7468 6572 293a 0a20 2020 2020  f, other):.     
+00038f70: 2020 2027 2727 0a20 2020 2020 2020 2044     '''.        D
+00038f80: 6566 696e 6520 6164 6469 7469 6f6e 206f  efine addition o
+00038f90: 6620 5374 7275 6374 7572 6553 6574 2069  f StructureSet i
+00038fa0: 6e73 7461 6e63 6573 2e0a 0a20 2020 2020  nstances...     
+00038fb0: 2020 2054 6865 2072 6573 756c 7420 6f66     The result of
+00038fc0: 2074 6865 2061 6464 6974 696f 6e20 6f66   the addition of
+00038fd0: 2073 656c 6620 616e 6420 6f74 6865 7220   self and other 
+00038fe0: 6973 2061 2053 7472 7563 7475 7265 5365  is a StructureSe
+00038ff0: 740a 2020 2020 2020 2020 6f62 6a65 6374  t.        object
+00039000: 2074 6861 7420 636f 6e74 6169 6e73 2074   that contains t
+00039010: 6865 2028 636c 6f6e 6564 2920 524f 4973  he (cloned) ROIs
+00039020: 206f 6620 626f 7468 2e20 2041 2072 6573   of both.  A res
+00039030: 756c 7420 524f 490a 2020 2020 2020 2020  ult ROI.        
+00039040: 7769 6c6c 2062 6520 7072 6566 6978 6564  will be prefixed
+00039050: 2062 7920 7468 6520 6e61 6d65 206f 6620   by the name of 
+00039060: 7468 6520 5374 7275 6374 7572 6553 6574  the StructureSet
+00039070: 2066 726f 6d20 7768 6963 6820 6974 0a20   from which it. 
+00039080: 2020 2020 2020 206f 7269 6769 6e61 7465         originate
+00039090: 732e 2020 4966 2074 6865 2052 4f49 206e  s.  If the ROI n
+000390a0: 616d 6520 6265 666f 7265 2074 6865 2061  ame before the a
+000390b0: 6464 6974 696f 6e20 6861 7320 7468 6520  ddition has the 
+000390c0: 5374 7275 6374 7572 6553 6574 0a20 2020  StructureSet.   
+000390d0: 2020 2020 206e 616d 6520 6173 2070 7265       name as pre
+000390e0: 6669 782c 206e 6f20 6e65 7720 7072 6566  fix, no new pref
+000390f0: 6978 2069 7320 6164 6465 642e 2020 5468  ix is added.  Th
+00039100: 6572 6520 6973 206e 6f20 7265 7175 6972  ere is no requir
+00039110: 656d 656e 740a 2020 2020 2020 2020 7468  ement.        th
+00039120: 6174 2052 4f49 7320 6f72 2074 6865 6972  at ROIs or their
+00039130: 206e 616d 6573 2062 6520 756e 6971 7565   names be unique
+00039140: 2077 6974 6869 6e20 6120 5374 7275 6374   within a Struct
+00039150: 7572 6553 6574 2e20 2041 6464 696e 670a  ureSet.  Adding.
+00039160: 2020 2020 2020 2020 6120 5374 7275 6374          a Struct
+00039170: 7572 6553 6574 2074 6f20 6974 7365 6c66  ureSet to itself
+00039180: 2077 696c 6c20 6769 7665 2061 2072 6573   will give a res
+00039190: 756c 7420 696e 636c 7564 696e 6720 6475  ult including du
+000391a0: 706c 6963 6174 650a 2020 2020 2020 2020  plicate.        
+000391b0: 524f 4973 2077 6974 6820 6475 706c 6963  ROIs with duplic
+000391c0: 6174 6520 6e61 6d65 732e 0a20 2020 2020  ate names..     
+000391d0: 2020 2027 2727 0a20 2020 2020 2020 2023     '''.        #
+000391e0: 2045 6e73 7572 6520 7468 6174 2053 7472   Ensure that Str
+000391f0: 7563 7475 7265 5365 7420 6461 7461 2061  uctureSet data a
+00039200: 7265 206c 6f61 6465 642e 0a20 2020 2020  re loaded..     
+00039210: 2020 2073 656c 662e 6c6f 6164 2829 0a20     self.load(). 
+00039220: 2020 2020 2020 206f 7468 6572 2e6c 6f61         other.loa
+00039230: 6428 290a 0a20 2020 2020 2020 2023 2043  d()..        # C
+00039240: 7265 6174 6520 6e65 7720 5374 7275 6374  reate new Struct
+00039250: 7572 6553 6574 2069 6e73 7461 6e63 6520  ureSet instance 
+00039260: 666f 7220 7375 6d2c 0a20 2020 2020 2020  for sum,.       
+00039270: 2023 2061 6e64 2073 746f 7265 206e 616d   # and store nam
+00039280: 6573 206f 6620 636f 6e74 7269 6275 746f  es of contributo
+00039290: 7273 2e0a 2020 2020 2020 2020 7265 7375  rs..        resu
+000392a0: 6c74 203d 2053 7472 7563 7475 7265 5365  lt = StructureSe
+000392b0: 7428 290a 2020 2020 2020 2020 7265 7375  t().        resu
+000392c0: 6c74 2e73 756d 6d65 645f 6e61 6d65 7320  lt.summed_names 
+000392d0: 3d20 5b5d 0a20 2020 2020 2020 2066 6f72  = [].        for
+000392e0: 206e 616d 6573 2069 6e20 5b73 656c 662e   names in [self.
+000392f0: 7375 6d6d 6564 5f6e 616d 6573 2c20 6f74  summed_names, ot
+00039300: 6865 722e 7375 6d6d 6564 5f6e 616d 6573  her.summed_names
+00039310: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00039320: 2020 5b73 656c 662e 6e61 6d65 5d2c 205b    [self.name], [
+00039330: 6f74 6865 722e 6e61 6d65 5d5d 3a0a 2020  other.name]]:.  
+00039340: 2020 2020 2020 2020 2020 666f 7220 6e61            for na
+00039350: 6d65 2069 6e20 6e61 6d65 733a 0a20 2020  me in names:.   
+00039360: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00039370: 6973 696e 7374 616e 6365 286e 616d 652c  isinstance(name,
+00039380: 2073 7472 293a 0a20 2020 2020 2020 2020   str):.         
+00039390: 2020 2020 2020 2020 2020 2066 6f72 2073             for s
+000393a0: 7562 5f6e 616d 6520 696e 206e 616d 652e  ub_name in name.
+000393b0: 7370 6c69 7428 225f 2229 3a0a 2020 2020  split("_"):.    
+000393c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000393d0: 2020 2020 6966 2073 7562 5f6e 616d 6520      if sub_name 
+000393e0: 6e6f 7420 696e 2072 6573 756c 742e 7375  not in result.su
+000393f0: 6d6d 6564 5f6e 616d 6573 3a0a 2020 2020  mmed_names:.    
+00039400: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00039410: 2020 2020 2020 2020 7265 7375 6c74 2e73          result.s
+00039420: 756d 6d65 645f 6e61 6d65 732e 6170 7065  ummed_names.appe
+00039430: 6e64 2873 7562 5f6e 616d 6529 0a20 2020  nd(sub_name).   
+00039440: 2020 2020 2072 6573 756c 742e 7375 6d6d       result.summ
+00039450: 6564 5f6e 616d 6573 2e73 6f72 7428 290a  ed_names.sort().
+00039460: 0a20 2020 2020 2020 2023 204c 6f6f 7020  .        # Loop 
+00039470: 6f76 6572 2053 7472 7563 7475 7265 5365  over StructureSe
+00039480: 7473 2061 6e64 2074 6865 6972 2052 4f49  ts and their ROI
+00039490: 732e 0a20 2020 2020 2020 2066 6f72 2073  s..        for s
+000394a0: 7320 696e 205b 7365 6c66 2c20 6f74 6865  s in [self, othe
+000394b0: 725d 3a0a 2020 2020 2020 2020 2020 2020  r]:.            
+000394c0: 666f 7220 726f 6920 696e 2073 732e 6765  for roi in ss.ge
+000394d0: 745f 726f 6973 2829 3a0a 2020 2020 2020  t_rois():.      
+000394e0: 2020 2020 2020 2020 2020 726f 695f 636c            roi_cl
+000394f0: 6f6e 6520 3d20 726f 692e 636c 6f6e 6528  one = roi.clone(
+00039500: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00039510: 2020 2320 5472 7920 746f 2070 7265 6669    # Try to prefi
+00039520: 7820 524f 4920 6e61 6d65 2077 6974 6820  x ROI name with 
+00039530: 7468 6520 6e61 6d65 206f 6620 7468 6520  the name of the 
 00039540: 5374 7275 6374 7572 6553 6574 0a20 2020  StructureSet.   
-00039550: 2020 2020 206f 626a 6563 7420 7468 6174       object that
-00039560: 2063 6f6e 7461 696e 7320 7468 6520 2863   contains the (c
-00039570: 6c6f 6e65 6429 2052 4f49 7320 6f66 2062  loned) ROIs of b
-00039580: 6f74 682e 2020 4120 7265 7375 6c74 2052  oth.  A result R
-00039590: 4f49 0a20 2020 2020 2020 2077 696c 6c20  OI.        will 
-000395a0: 6265 2070 7265 6669 7865 6420 6279 2074  be prefixed by t
-000395b0: 6865 206e 616d 6520 6f66 2074 6865 2053  he name of the S
-000395c0: 7472 7563 7475 7265 5365 7420 6672 6f6d  tructureSet from
-000395d0: 2077 6869 6368 2069 740a 2020 2020 2020   which it.      
-000395e0: 2020 6f72 6967 696e 6174 6573 2e20 2049    originates.  I
-000395f0: 6620 7468 6520 524f 4920 6e61 6d65 2062  f the ROI name b
-00039600: 6566 6f72 6520 7468 6520 6164 6469 7469  efore the additi
-00039610: 6f6e 2068 6173 2074 6865 2053 7472 7563  on has the Struc
-00039620: 7475 7265 5365 740a 2020 2020 2020 2020  tureSet.        
-00039630: 6e61 6d65 2061 7320 7072 6566 6978 2c20  name as prefix, 
-00039640: 6e6f 206e 6577 2070 7265 6669 7820 6973  no new prefix is
-00039650: 2061 6464 6564 2e20 2054 6865 7265 2069   added.  There i
-00039660: 7320 6e6f 2072 6571 7569 7265 6d65 6e74  s no requirement
-00039670: 0a20 2020 2020 2020 2074 6861 7420 524f  .        that RO
-00039680: 4973 206f 7220 7468 6569 7220 6e61 6d65  Is or their name
-00039690: 7320 6265 2075 6e69 7175 6520 7769 7468  s be unique with
-000396a0: 696e 2061 2053 7472 7563 7475 7265 5365  in a StructureSe
-000396b0: 742e 2020 4164 6469 6e67 0a20 2020 2020  t.  Adding.     
-000396c0: 2020 2061 2053 7472 7563 7475 7265 5365     a StructureSe
-000396d0: 7420 746f 2069 7473 656c 6620 7769 6c6c  t to itself will
-000396e0: 2067 6976 6520 6120 7265 7375 6c74 2069   give a result i
-000396f0: 6e63 6c75 6469 6e67 2064 7570 6c69 6361  ncluding duplica
-00039700: 7465 0a20 2020 2020 2020 2052 4f49 7320  te.        ROIs 
-00039710: 7769 7468 2064 7570 6c69 6361 7465 206e  with duplicate n
-00039720: 616d 6573 2e0a 2020 2020 2020 2020 2727  ames..        ''
-00039730: 270a 2020 2020 2020 2020 7265 7475 726e  '.        return
-00039740: 2073 656c 6620 2b20 6f74 6865 720a 0a20   self + other.. 
-00039750: 2020 2064 6566 206c 6f61 6428 7365 6c66     def load(self
-00039760: 2c20 736f 7572 6365 733d 4e6f 6e65 2c20  , sources=None, 
-00039770: 666f 7263 653d 4661 6c73 6529 3a0a 2020  force=False):.  
-00039780: 2020 2020 2020 2222 224c 6f61 6420 7374        """Load st
-00039790: 7275 6374 7572 6520 7365 7420 6672 6f6d  ructure set from
-000397a0: 2073 6f75 7263 6528 7329 2e20 4966 204e   source(s). If N
-000397b0: 6f6e 652c 2077 696c 6c20 6c6f 6164 2066  one, will load f
-000397c0: 726f 6d20 6f77 6e0a 2020 2020 2020 2020  rom own.        
-000397d0: 7365 6c66 2e73 6f75 7263 6573 2e22 2222  self.sources."""
-000397e0: 0a0a 2020 2020 2020 2020 6966 2073 656c  ..        if sel
-000397f0: 662e 6c6f 6164 6564 2061 6e64 206e 6f74  f.loaded and not
-00039800: 2066 6f72 6365 2061 6e64 2073 6f75 7263   force and sourc
-00039810: 6573 2069 7320 4e6f 6e65 3a0a 2020 2020  es is None:.    
-00039820: 2020 2020 2020 2020 7265 7475 726e 0a0a          return..
-00039830: 2020 2020 2020 2020 6966 2073 6f75 7263          if sourc
-00039840: 6573 2069 7320 4e6f 6e65 3a0a 2020 2020  es is None:.    
-00039850: 2020 2020 2020 2020 736f 7572 6365 7320          sources 
-00039860: 3d20 7365 6c66 2e73 6f75 7263 6573 0a0a  = self.sources..
-00039870: 2020 2020 2020 2020 2320 4c61 6f64 2066          # Laod f
-00039880: 726f 6d20 6d75 6c74 692d 6c61 6265 6c20  rom multi-label 
-00039890: 6172 7261 790a 2020 2020 2020 2020 6966  array.        if
-000398a0: 2073 656c 662e 6d75 6c74 695f 6c61 6265   self.multi_labe
-000398b0: 6c3a 0a0a 2020 2020 2020 2020 2020 2020  l:..            
-000398c0: 6966 2069 7369 6e73 7461 6e63 6528 736f  if isinstance(so
-000398d0: 7572 6365 732c 206c 6973 7429 2061 6e64  urces, list) and
-000398e0: 206c 656e 2873 6f75 7263 6573 2920 3d3d   len(sources) ==
-000398f0: 2031 3a0a 2020 2020 2020 2020 2020 2020   1:.            
-00039900: 2020 2020 736f 7572 6365 7320 3d20 736f      sources = so
-00039910: 7572 6365 735b 305d 0a20 2020 2020 2020  urces[0].       
-00039920: 2020 2020 2069 6620 6e6f 7420 6973 696e       if not isin
-00039930: 7374 616e 6365 2873 6f75 7263 6573 2c20  stance(sources, 
-00039940: 7374 7229 2061 6e64 206e 6f74 2069 7369  str) and not isi
-00039950: 6e73 7461 6e63 6528 736f 7572 6365 732c  nstance(sources,
-00039960: 206e 702e 6e64 6172 7261 7929 3a0a 2020   np.ndarray):.  
-00039970: 2020 2020 2020 2020 2020 2020 2020 7261                ra
-00039980: 6973 6520 5479 7065 4572 726f 7228 2249  ise TypeError("I
-00039990: 6e70 7574 2066 6f72 2061 206d 756c 7469  nput for a multi
-000399a0: 2d6c 6162 656c 2069 6d61 6765 206d 7573  -label image mus
-000399b0: 7420 6265 2066 696c 6570 6174 6820 220a  t be filepath ".
-000399c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000399d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000399e0: 6622 6f72 206e 756d 7079 2061 7272 6179  f"or numpy array
-000399f0: 2e20 5479 7065 2066 6f75 6e64 3a20 7b74  . Type found: {t
-00039a00: 7970 6528 736f 7572 6365 7329 7d2e 2229  ype(sources)}.")
-00039a10: 0a20 2020 2020 2020 2020 2020 2073 696e  .            sin
-00039a20: 676c 655f 736f 7572 6365 203d 2054 7275  gle_source = Tru
-00039a30: 650a 0a20 2020 2020 2020 2020 2020 2023  e..            #
-00039a40: 204c 6f61 6420 696e 7075 7420 6172 7261   Load input arra
-00039a50: 7920 696e 746f 2069 6d61 6765 0a20 2020  y into image.   
-00039a60: 2020 2020 2020 2020 2061 7272 6179 203d           array =
-00039a70: 2073 6b72 742e 696d 6167 652e 496d 6167   skrt.image.Imag
-00039a80: 6528 736f 7572 6365 7329 2e67 6574 5f64  e(sources).get_d
-00039a90: 6174 6128 7374 616e 6461 7264 6973 653d  ata(standardise=
-00039aa0: 5472 7565 292e 6173 7479 7065 2869 6e74  True).astype(int
-00039ab0: 290a 2020 2020 2020 2020 2020 2020 6e20  ).            n 
-00039ac0: 3d20 6172 7261 792e 6d61 7828 290a 0a20  = array.max().. 
-00039ad0: 2020 2020 2020 2020 2020 2023 2045 6e66             # Enf
-00039ae0: 6f72 6365 2044 6963 6f6d 2063 6f6e 7665  orce Dicom conve
-00039af0: 6e74 696f 6e20 666f 7220 6461 7461 2061  ntion for data a
-00039b00: 7272 6179 206f 6620 696d 6167 6520 6f62  rray of image ob
-00039b10: 6a65 6374 2c0a 2020 2020 2020 2020 2020  ject,.          
-00039b20: 2020 2320 736f 2074 6861 7420 6166 6669    # so that affi
-00039b30: 6e65 206d 6174 7269 7820 7769 6c6c 2062  ne matrix will b
-00039b40: 6520 636f 7272 6563 746c 7920 6465 6669  e correctly defi
-00039b50: 6e65 6420 666f 7220 6d61 736b 2063 7265  ned for mask cre
-00039b60: 6174 696f 6e2e 0a20 2020 2020 2020 2020  ation..         
-00039b70: 2020 2069 6d20 3d20 736b 7274 2e69 6d61     im = skrt.ima
-00039b80: 6765 2e49 6d61 6765 2873 6f75 7263 6573  ge.Image(sources
-00039b90: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
-00039ba0: 2027 6e69 6674 6927 2069 6e20 696d 2e73   'nifti' in im.s
-00039bb0: 6f75 7263 655f 7479 7065 3a0a 2020 2020  ource_type:.    
-00039bc0: 2020 2020 2020 2020 2020 2020 696d 203d              im =
-00039bd0: 2069 6d2e 6173 7479 7065 2827 6463 6d27   im.astype('dcm'
-00039be0: 290a 2020 2020 2020 2020 2020 2020 695f  ).            i_
-00039bf0: 6e61 6d65 203d 2030 0a20 2020 2020 2020  name = 0.       
-00039c00: 2020 2020 2066 6f72 2069 2069 6e20 7261       for i in ra
-00039c10: 6e67 6528 302c 206e 293a 0a20 2020 2020  nge(0, n):.     
-00039c20: 2020 2020 2020 2020 2020 2069 6620 7365             if se
-00039c30: 6c66 2e6e 616d 6573 2069 7320 6e6f 7420  lf.names is not 
-00039c40: 4e6f 6e65 2061 6e64 2069 5f6e 616d 6520  None and i_name 
-00039c50: 3c20 6c65 6e28 7365 6c66 2e6e 616d 6573  < len(self.names
-00039c60: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-00039c70: 2020 2020 2020 206e 616d 6520 3d20 7365         name = se
-00039c80: 6c66 2e6e 616d 6573 5b69 5f6e 616d 655d  lf.names[i_name]
-00039c90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00039ca0: 2020 2020 2069 5f6e 616d 6520 2b3d 2031       i_name += 1
-00039cb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00039cc0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-00039cd0: 2020 2020 2020 2020 2020 206e 616d 6520             name 
-00039ce0: 3d20 6622 524f 4920 7b69 7d22 0a0a 2020  = f"ROI {i}"..  
-00039cf0: 2020 2020 2020 2020 2020 2020 2020 2369                #i
-00039d00: 6d32 2e64 6174 6120 3d20 2869 6d31 2e64  m2.data = (im1.d
-00039d10: 6174 6120 3d3d 2069 202b 2031 290a 2020  ata == i + 1).  
-00039d20: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00039d30: 6c66 2e72 6f69 732e 6170 7065 6e64 2852  lf.rois.append(R
-00039d40: 4f49 280a 2020 2020 2020 2020 2020 2020  OI(.            
-00039d50: 2020 2020 2020 2020 6172 7261 7920 3d3d          array ==
-00039d60: 2069 202b 2031 2c20 0a20 2020 2020 2020   i + 1, .       
-00039d70: 2020 2020 2020 2020 2020 2020 2061 6666               aff
-00039d80: 696e 6520 3d20 696d 2e67 6574 5f61 6666  ine = im.get_aff
-00039d90: 696e 6528 292c 0a20 2020 2020 2020 2020  ine(),.         
-00039da0: 2020 2020 2020 2020 2020 2076 6f78 656c             voxel
-00039db0: 5f73 697a 6520 3d20 4e6f 6e65 2c0a 2020  _size = None,.  
-00039dc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00039dd0: 2020 6f72 6967 696e 203d 204e 6f6e 652c    origin = None,
-00039de0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00039df0: 2020 2020 2069 6d61 6765 3d73 656c 662e       image=self.
-00039e00: 696d 6167 652c 0a20 2020 2020 2020 2020  image,.         
-00039e10: 2020 2020 2020 2020 2020 206e 616d 653d             name=
-00039e20: 6e61 6d65 2c0a 2020 2020 2020 2020 2020  name,.          
-00039e30: 2020 2020 2020 2020 2020 2a2a 7365 6c66            **self
-00039e40: 2e72 6f69 5f6b 7761 7267 730a 2020 2020  .roi_kwargs.    
-00039e50: 2020 2020 2020 2020 2020 2020 2929 0a20              )). 
-00039e60: 2020 2020 2020 2020 2020 2073 6f75 7263             sourc
-00039e70: 6573 203d 205b 5d0a 0a20 2020 2020 2020  es = []..       
-00039e80: 2020 2020 2023 2046 6f72 204e 4966 5449       # For NIfTI
-00039e90: 2073 6f75 7263 652c 2072 6576 6572 7420   source, revert 
-00039ea0: 746f 204e 4966 5449 2063 6f6e 7665 6e74  to NIfTI convent
-00039eb0: 696f 6e20 666f 7220 6461 7461 2061 7272  ion for data arr
-00039ec0: 6179 0a20 2020 2020 2020 2020 2020 2023  ay.            #
-00039ed0: 206f 6620 6d61 736b 2c20 736f 2074 6861   of mask, so tha
-00039ee0: 7420 6974 2063 616e 2062 6520 7772 6974  t it can be writ
-00039ef0: 7465 6e20 636f 7272 6563 746c 7920 746f  ten correctly to
-00039f00: 2066 696c 652e 0a20 2020 2020 2020 2020   file..         
-00039f10: 2020 2069 6620 276e 6966 7469 2720 696e     if 'nifti' in
-00039f20: 2069 6d2e 736f 7572 6365 5f74 7970 653a   im.source_type:
-00039f30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00039f40: 2066 6f72 2069 6478 2069 6e20 7261 6e67   for idx in rang
-00039f50: 6528 6c65 6e28 7365 6c66 2e72 6f69 7329  e(len(self.rois)
-00039f60: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-00039f70: 2020 2020 2020 2073 656c 662e 726f 6973         self.rois
-00039f80: 5b69 6478 5d2e 6d61 736b 203d 2073 656c  [idx].mask = sel
-00039f90: 662e 726f 6973 5b69 6478 5d2e 6d61 736b  f.rois[idx].mask
-00039fa0: 2e61 7374 7970 6528 276e 6969 2729 0a0a  .astype('nii')..
-00039fb0: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-00039fc0: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
-00039fd0: 2073 6b72 742e 636f 7265 2e69 735f 6c69   skrt.core.is_li
-00039fe0: 7374 2873 6f75 7263 6573 2920 6f72 2069  st(sources) or i
-00039ff0: 7369 6e73 7461 6e63 6528 736f 7572 6365  sinstance(source
-0003a000: 732c 206e 702e 6e64 6172 7261 7929 3a0a  s, np.ndarray):.
-0003a010: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003a020: 736f 7572 6365 7320 3d20 5b73 6f75 7263  sources = [sourc
-0003a030: 6573 5d0a 2020 2020 2020 2020 2020 2020  es].            
-0003a040: 2020 2020 7369 6e67 6c65 5f73 6f75 7263      single_sourc
-0003a050: 6520 3d20 5472 7565 0a20 2020 2020 2020  e = True.       
-0003a060: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-0003a070: 2020 2020 2020 2020 2020 2073 696e 676c             singl
-0003a080: 655f 736f 7572 6365 203d 2046 616c 7365  e_source = False
-0003a090: 0a0a 2020 2020 2020 2020 2320 4578 7061  ..        # Expa
-0003a0a0: 6e64 2061 6e79 2064 6972 6563 746f 7269  nd any directori
-0003a0b0: 6573 0a20 2020 2020 2020 2073 6f75 7263  es.        sourc
-0003a0c0: 6573 5f65 7870 616e 6465 6420 3d20 5b5d  es_expanded = []
-0003a0d0: 0a20 2020 2020 2020 2066 6f72 2073 6f75  .        for sou
-0003a0e0: 7263 6520 696e 2073 6f75 7263 6573 3a0a  rce in sources:.
-0003a0f0: 2020 2020 2020 2020 2020 2020 6966 2069              if i
-0003a100: 7369 6e73 7461 6e63 6528 736f 7572 6365  sinstance(source
-0003a110: 2c20 7374 7229 2061 6e64 206f 732e 7061  , str) and os.pa
-0003a120: 7468 2e69 7364 6972 2873 6f75 7263 6529  th.isdir(source)
-0003a130: 3a0a 0a20 2020 2020 2020 2020 2020 2020  :..             
-0003a140: 2020 2073 6f75 7263 6573 5f65 7870 616e     sources_expan
-0003a150: 6465 642e 6578 7465 6e64 280a 2020 2020  ded.extend(.    
-0003a160: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003a170: 5b6f 732e 7061 7468 2e6a 6f69 6e28 736f  [os.path.join(so
-0003a180: 7572 6365 2c20 6669 6c65 2920 666f 7220  urce, file) for 
-0003a190: 6669 6c65 2069 6e20 6f73 2e6c 6973 7464  file in os.listd
-0003a1a0: 6972 2873 6f75 7263 6529 5d0a 2020 2020  ir(source)].    
-0003a1b0: 2020 2020 2020 2020 2020 2020 290a 0a20              ).. 
-0003a1c0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-0003a1d0: 2041 7574 6f2d 6173 7369 676e 206e 616d   Auto-assign nam
-0003a1e0: 6520 746f 2064 6972 6563 746f 7279 206e  e to directory n
-0003a1f0: 616d 650a 2020 2020 2020 2020 2020 2020  ame.            
-0003a200: 2020 2020 6966 2073 696e 676c 655f 736f      if single_so
-0003a210: 7572 6365 2061 6e64 2073 656c 662e 6e61  urce and self.na
-0003a220: 6d65 2069 7320 4e6f 6e65 3a0a 2020 2020  me is None:.    
-0003a230: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003a240: 7365 6c66 2e6e 616d 6520 3d20 736f 7572  self.name = sour
-0003a250: 6365 0a0a 2020 2020 2020 2020 2020 2020  ce..            
-0003a260: 656c 6966 206e 6f74 2073 656c 662e 6c6f  elif not self.lo
-0003a270: 6164 6564 3a0a 2020 2020 2020 2020 2020  aded:.          
-0003a280: 2020 2020 2020 736f 7572 6365 735f 6578        sources_ex
-0003a290: 7061 6e64 6564 2e61 7070 656e 6428 736f  panded.append(so
-0003a2a0: 7572 6365 290a 0a20 2020 2020 2020 2066  urce)..        f
-0003a2b0: 6f72 2073 6f75 7263 6520 696e 2073 6f75  or source in sou
-0003a2c0: 7263 6573 5f65 7870 616e 6465 643a 0a0a  rces_expanded:..
-0003a2d0: 2020 2020 2020 2020 2020 2020 6966 2069              if i
-0003a2e0: 7369 6e73 7461 6e63 6528 736f 7572 6365  sinstance(source
-0003a2f0: 2c20 524f 4929 3a0a 2020 2020 2020 2020  , ROI):.        
-0003a300: 2020 2020 2020 2020 7365 6c66 2e72 6f69          self.roi
-0003a310: 732e 6170 7065 6e64 2873 6f75 7263 6529  s.append(source)
-0003a320: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0003a330: 2063 6f6e 7469 6e75 650a 0a20 2020 2020   continue..     
-0003a340: 2020 2020 2020 2069 6620 6973 696e 7374         if isinst
-0003a350: 616e 6365 2873 6f75 7263 652c 2073 7472  ance(source, str
-0003a360: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-0003a370: 2020 2069 6620 6f73 2e70 6174 682e 6261     if os.path.ba
-0003a380: 7365 6e61 6d65 2873 6f75 7263 6529 2e73  sename(source).s
-0003a390: 7461 7274 7377 6974 6828 222e 2229 206f  tartswith(".") o
-0003a3a0: 7220 736f 7572 6365 2e65 6e64 7377 6974  r source.endswit
-0003a3b0: 6828 222e 7478 7422 293a 0a20 2020 2020  h(".txt"):.     
-0003a3c0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-0003a3d0: 6f6e 7469 6e75 650a 2020 2020 2020 2020  ontinue.        
-0003a3e0: 2020 2020 2020 2020 6966 206f 732e 7061          if os.pa
-0003a3f0: 7468 2e69 7364 6972 2873 6f75 7263 6529  th.isdir(source)
-0003a400: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0003a410: 2020 2020 2020 636f 6e74 696e 7565 0a0a        continue..
-0003a420: 2020 2020 2020 2020 2020 2020 2320 4174              # At
-0003a430: 7465 6d70 7420 746f 206c 6f61 6420 6672  tempt to load fr
-0003a440: 6f6d 2064 6963 6f6d 0a20 2020 2020 2020  om dicom.       
-0003a450: 2020 2020 2072 6f69 7320 3d20 5b5d 0a20       rois = []. 
-0003a460: 2020 2020 2020 2020 2020 2069 6620 6973             if is
-0003a470: 696e 7374 616e 6365 2873 6f75 7263 652c  instance(source,
-0003a480: 2073 7472 293a 0a20 2020 2020 2020 2020   str):.         
-0003a490: 2020 2020 2020 2069 6620 6f73 2e70 6174         if os.pat
-0003a4a0: 682e 7370 6c69 7465 7874 2873 6f75 7263  h.splitext(sourc
-0003a4b0: 6529 5b31 5d20 213d 2027 2e6e 6969 273a  e)[1] != '.nii':
-0003a4c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0003a4d0: 2020 2020 2072 6f69 732c 2064 7320 3d20       rois, ds = 
-0003a4e0: 6c6f 6164 5f72 6f69 735f 6469 636f 6d28  load_rois_dicom(
-0003a4f0: 736f 7572 6365 290a 2020 2020 2020 2020  source).        
-0003a500: 2020 2020 6966 206c 656e 2872 6f69 7329      if len(rois)
-0003a510: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0003a520: 2020 666f 7220 6e75 6d62 6572 2c20 726f    for number, ro
-0003a530: 6920 696e 2072 6f69 732e 6974 656d 7328  i in rois.items(
-0003a540: 293a 0a0a 2020 2020 2020 2020 2020 2020  ):..            
-0003a550: 2020 2020 2020 2020 2320 4967 6e6f 7265          # Ignore
-0003a560: 2065 6e74 7269 6573 2077 6974 6820 6e6f   entries with no
-0003a570: 2063 6f6e 746f 7572 730a 2020 2020 2020   contours.      
-0003a580: 2020 2020 2020 2020 2020 2020 2020 6966                if
-0003a590: 2022 636f 6e74 6f75 7273 2220 6e6f 7420   "contours" not 
-0003a5a0: 696e 2072 6f69 3a0a 2020 2020 2020 2020  in roi:.        
-0003a5b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003a5c0: 636f 6e74 696e 7565 0a0a 2020 2020 2020  continue..      
-0003a5d0: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-0003a5e0: 4967 6e6f 7265 2065 6e74 7269 6573 2063  Ignore entries c
-0003a5f0: 6f6e 7461 696e 696e 6720 6f6e 6c79 2061  ontaining only a
-0003a600: 2073 696e 676c 6520 706f 696e 740a 2020   single point.  
-0003a610: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003a620: 2020 636f 6e74 6f75 7273 203d 2072 6f69    contours = roi
-0003a630: 5b22 636f 6e74 6f75 7273 225d 0a20 2020  ["contours"].   
-0003a640: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003a650: 2069 6620 6c65 6e28 636f 6e74 6f75 7273   if len(contours
-0003a660: 2920 3d3d 2031 3a0a 2020 2020 2020 2020  ) == 1:.        
-0003a670: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003a680: 7369 6e67 6c65 5f63 6f6e 746f 7572 203d  single_contour =
-0003a690: 2063 6f6e 746f 7572 735b 6c69 7374 2863   contours[list(c
-0003a6a0: 6f6e 746f 7572 732e 6b65 7973 2829 295b  ontours.keys())[
-0003a6b0: 305d 5d5b 305d 0a20 2020 2020 2020 2020  0]][0].         
-0003a6c0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0003a6d0: 6620 7369 6e67 6c65 5f63 6f6e 746f 7572  f single_contour
-0003a6e0: 2e73 6861 7065 5b30 5d20 3d3d 2031 3a0a  .shape[0] == 1:.
-0003a6f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003a700: 2020 2020 2020 2020 2020 2020 636f 6e74              cont
-0003a710: 696e 7565 0a0a 2020 2020 2020 2020 2020  inue..          
-0003a720: 2020 2020 2020 2020 2020 636f 6c6f 7220            color 
-0003a730: 3d20 726f 695b 2263 6f6c 6f72 225d 2069  = roi["color"] i
-0003a740: 6620 6e6f 7420 7365 6c66 2e69 676e 6f72  f not self.ignor
-0003a750: 655f 6469 636f 6d5f 636f 6c6f 7273 2065  e_dicom_colors e
-0003a760: 6c73 6520 4e6f 6e65 0a20 2020 2020 2020  lse None.       
-0003a770: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-0003a780: 662e 726f 6973 2e61 7070 656e 6428 0a20  f.rois.append(. 
-0003a790: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003a7a0: 2020 2020 2020 2052 4f49 280a 2020 2020         ROI(.    
-0003a7b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003a7c0: 2020 2020 2020 2020 726f 695b 2263 6f6e          roi["con
-0003a7d0: 746f 7572 7322 5d2c 0a20 2020 2020 2020  tours"],.       
-0003a7e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003a7f0: 2020 2020 206e 616d 653d 726f 695b 226e       name=roi["n
-0003a800: 616d 6522 5d2c 0a20 2020 2020 2020 2020  ame"],.         
-0003a810: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003a820: 2020 2063 6f6c 6f72 3d63 6f6c 6f72 2c0a     color=color,.
-0003a830: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003a840: 2020 2020 2020 2020 2020 2020 696d 6167              imag
-0003a850: 653d 7365 6c66 2e69 6d61 6765 2c0a 2020  e=self.image,.  
-0003a860: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003a870: 2020 2020 2020 2020 2020 2a2a 7365 6c66            **self
-0003a880: 2e72 6f69 5f6b 7761 7267 730a 2020 2020  .roi_kwargs.    
-0003a890: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003a8a0: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
-0003a8b0: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
-0003a8c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003a8d0: 7365 6c66 2e72 6f69 735b 2d31 5d2e 6469  self.rois[-1].di
-0003a8e0: 636f 6d5f 6461 7461 7365 7420 3d20 6473  com_dataset = ds
-0003a8f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0003a900: 2020 2020 2073 656c 662e 726f 6973 5b2d       self.rois[-
-0003a910: 315d 2e6e 756d 6265 7220 3d20 6e75 6d62  1].number = numb
-0003a920: 6572 0a20 2020 2020 2020 2020 2020 2020  er.             
-0003a930: 2020 2073 656c 662e 6469 636f 6d5f 6461     self.dicom_da
-0003a940: 7461 7365 7420 3d20 6473 0a0a 2020 2020  taset = ds..    
-0003a950: 2020 2020 2020 2020 2020 2020 2320 4175              # Au
-0003a960: 746f 2d61 7373 6967 6e20 6e61 6d65 2066  to-assign name f
-0003a970: 726f 6d20 6469 636f 6d20 6669 6c65 6e61  rom dicom filena
-0003a980: 6d65 0a20 2020 2020 2020 2020 2020 2020  me.             
-0003a990: 2020 2069 6620 7369 6e67 6c65 5f73 6f75     if single_sou
-0003a9a0: 7263 6520 616e 6420 7365 6c66 2e6e 616d  rce and self.nam
-0003a9b0: 6520 6973 204e 6f6e 653a 0a20 2020 2020  e is None:.     
-0003a9c0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0003a9d0: 656c 662e 6e61 6d65 203d 206f 732e 7061  elf.name = os.pa
-0003a9e0: 7468 2e62 6173 656e 616d 6528 736f 7572  th.basename(sour
-0003a9f0: 6365 292e 7265 706c 6163 6528 222e 6463  ce).replace(".dc
-0003aa00: 6d22 2c20 2222 290a 0a20 2020 2020 2020  m", "")..       
-0003aa10: 2020 2020 2023 204c 6f61 6420 6672 6f6d       # Load from
-0003aa20: 2052 4f49 206d 6173 6b0a 2020 2020 2020   ROI mask.      
-0003aa30: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-0003aa40: 2020 2020 2020 2020 2020 2020 7472 793a              try:
-0003aa50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0003aa60: 2020 2020 2073 656c 662e 726f 6973 2e61       self.rois.a
-0003aa70: 7070 656e 6428 524f 4928 0a20 2020 2020  ppend(ROI(.     
-0003aa80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003aa90: 2020 2073 6f75 7263 652c 200a 2020 2020     source, .    
-0003aaa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003aab0: 2020 2020 696d 6167 653d 7365 6c66 2e69      image=self.i
-0003aac0: 6d61 6765 2c0a 2020 2020 2020 2020 2020  mage,.          
-0003aad0: 2020 2020 2020 2020 2020 2020 2020 2a2a                **
-0003aae0: 7365 6c66 2e72 6f69 5f6b 7761 7267 730a  self.roi_kwargs.
-0003aaf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003ab00: 2020 2020 2929 0a20 2020 2020 2020 2020      )).         
-0003ab10: 2020 2020 2020 2065 7863 6570 7420 5275         except Ru
-0003ab20: 6e74 696d 6545 7272 6f72 3a0a 2020 2020  ntimeError:.    
-0003ab30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003ab40: 636f 6e74 696e 7565 0a0a 2020 2020 2020  continue..      
-0003ab50: 2020 7365 6c66 2e6c 6f61 6465 6420 3d20    self.loaded = 
-0003ab60: 5472 7565 0a0a 2020 2020 2020 2020 7365  True..        se
-0003ab70: 6c66 2e72 656e 616d 655f 726f 6973 286b  lf.rename_rois(k
-0003ab80: 6565 705f 7265 6e61 6d65 645f 6f6e 6c79  eep_renamed_only
-0003ab90: 3d73 656c 662e 6b65 6570 5f72 656e 616d  =self.keep_renam
-0003aba0: 6564 5f6f 6e6c 7929 0a20 2020 2020 2020  ed_only).       
-0003abb0: 2073 656c 662e 6669 6c74 6572 5f72 6f69   self.filter_roi
-0003abc0: 7328 290a 2020 2020 2020 2020 7365 6c66  s().        self
-0003abd0: 2e72 6563 6f6c 6f72 5f72 6f69 7328 7365  .recolor_rois(se
-0003abe0: 6c66 2e63 6f6c 6f72 7329 0a20 2020 2020  lf.colors).     
-0003abf0: 2020 2073 6c69 6365 5f74 6869 636b 6e65     slice_thickne
-0003ac00: 7373 6573 203d 205b 5d0a 2020 2020 2020  sses = [].      
-0003ac10: 2020 726f 6973 203d 205b 5d0a 2020 2020    rois = [].    
-0003ac20: 2020 2020 666f 7220 726f 6920 696e 2073      for roi in s
-0003ac30: 656c 662e 726f 6973 3a0a 2020 2020 2020  elf.rois:.      
-0003ac40: 2020 2020 2020 726f 692e 7374 7275 6374        roi.struct
-0003ac50: 7572 655f 7365 7420 3d20 7365 6c66 0a20  ure_set = self. 
-0003ac60: 2020 2020 2020 2020 2020 2072 6f69 2e73             roi.s
-0003ac70: 6574 5f61 6c70 6861 5f6f 7665 725f 6265  et_alpha_over_be
-0003ac80: 7461 2873 656c 662e 616c 7068 615f 6265  ta(self.alpha_be
-0003ac90: 7461 5f72 6174 696f 732e 6765 7428 726f  ta_ratios.get(ro
-0003aca0: 692e 6e61 6d65 2c20 4e6f 6e65 2929 0a20  i.name, None)). 
-0003acb0: 2020 2020 2020 2020 2020 2066 6f72 2070             for p
-0003acc0: 6c61 6e20 696e 2073 656c 662e 706c 616e  lan in self.plan
-0003acd0: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
-0003ace0: 2020 2072 6f69 2e61 6464 5f70 6c61 6e28     roi.add_plan(
-0003acf0: 706c 616e 290a 0a20 2020 2020 2020 2020  plan)..         
-0003ad00: 2020 2069 6620 726f 692e 736f 7572 6365     if roi.source
-0003ad10: 5f74 7970 6520 3d3d 2022 636f 6e74 6f75  _type == "contou
-0003ad20: 7222 3a0a 2020 2020 2020 2020 2020 2020  r":.            
-0003ad30: 2020 2020 6966 2072 6f69 2e73 6c69 6365      if roi.slice
-0003ad40: 5f74 6869 636b 6e65 7373 5f63 6f6e 746f  _thickness_conto
-0003ad50: 7572 7320 6973 206e 6f74 204e 6f6e 653a  urs is not None:
-0003ad60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0003ad70: 2020 2020 2073 6c69 6365 5f74 6869 636b       slice_thick
-0003ad80: 6e65 7373 6573 2e61 7070 656e 6428 726f  nesses.append(ro
-0003ad90: 692e 736c 6963 655f 7468 6963 6b6e 6573  i.slice_thicknes
-0003ada0: 735f 636f 6e74 6f75 7273 290a 2020 2020  s_contours).    
-0003adb0: 2020 2020 2020 2020 2020 2020 656c 7365              else
-0003adc0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0003add0: 2020 2020 2020 726f 6973 2e61 7070 656e        rois.appen
-0003ade0: 6428 726f 6929 0a0a 2020 2020 2020 2020  d(roi)..        
-0003adf0: 2320 4966 2073 6c69 6365 2074 6869 636b  # If slice thick
-0003ae00: 6e65 7373 2069 736e 2774 2073 6574 2066  ness isn't set f
-0003ae10: 6f72 2061 6e20 524f 4920 6672 6f6d 2063  or an ROI from c
-0003ae20: 6f6e 746f 7572 732c 0a20 2020 2020 2020  ontours,.       
-0003ae30: 2023 2073 6574 2069 7473 2074 6869 636b   # set its thick
-0003ae40: 6e65 7373 2074 6f20 7468 6520 6d69 6e69  ness to the mini
-0003ae50: 6d75 6d20 666f 7220 616c 6c20 6f74 6865  mum for all othe
-0003ae60: 7220 524f 4973 0a20 2020 2020 2020 2023  r ROIs.        #
-0003ae70: 2069 6e20 7468 6520 7374 7275 6374 7572   in the structur
-0003ae80: 6520 7365 742e 0a20 2020 2020 2020 2069  e set..        i
-0003ae90: 6620 726f 6973 2061 6e64 2073 6c69 6365  f rois and slice
-0003aea0: 5f74 6869 636b 6e65 7373 6573 3a0a 2020  _thicknesses:.  
-0003aeb0: 2020 2020 2020 2020 2020 736c 6963 655f            slice_
-0003aec0: 7468 6963 6b6e 6573 7320 3d20 6d69 6e28  thickness = min(
-0003aed0: 736c 6963 655f 7468 6963 6b6e 6573 7365  slice_thicknesse
-0003aee0: 7329 0a20 2020 2020 2020 2020 2020 2066  s).            f
-0003aef0: 6f72 2072 6f69 2069 6e20 726f 6973 3a0a  or roi in rois:.
-0003af00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003af10: 726f 692e 736c 6963 655f 7468 6963 6b6e  roi.slice_thickn
-0003af20: 6573 735f 636f 6e74 6f75 7273 203d 2073  ess_contours = s
-0003af30: 6c69 6365 5f74 6869 636b 6e65 7373 0a0a  lice_thickness..
-0003af40: 2020 2020 6465 6620 6765 745f 6469 636f      def get_dico
-0003af50: 6d5f 6461 7461 7365 7428 7365 6c66 293a  m_dataset(self):
-0003af60: 0a20 2020 2020 2020 2022 2222 5265 7475  .        """Retu
-0003af70: 726e 2070 7964 6963 6f6d 2e64 6174 6173  rn pydicom.datas
-0003af80: 6574 2e46 696c 6544 6174 6173 6574 206f  et.FileDataset o
-0003af90: 626a 6563 7420 6173 736f 6369 6174 6564  bject associated
-0003afa0: 2077 6974 6820 7468 6973 2049 6d61 6765   with this Image
-0003afb0: 2c0a 2020 2020 2020 2020 6966 206c 6f61  ,.        if loa
-0003afc0: 6465 6420 6672 6f6d 2064 6963 6f6d 3b20  ded from dicom; 
-0003afd0: 6f74 6865 7277 6973 652c 2072 6574 7572  otherwise, retur
-0003afe0: 6e20 4e6f 6e65 2e22 2222 0a0a 2020 2020  n None."""..    
-0003aff0: 2020 2020 7365 6c66 2e6c 6f61 6428 290a      self.load().
-0003b000: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-0003b010: 656c 662e 6469 636f 6d5f 6461 7461 7365  elf.dicom_datase
-0003b020: 740a 0a20 2020 2064 6566 2072 6573 6574  t..    def reset
-0003b030: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
-0003b040: 2222 2252 656c 6f61 6420 7374 7275 6374  """Reload struct
-0003b050: 7572 6520 7365 7420 6672 6f6d 206f 7269  ure set from ori
-0003b060: 6769 6e61 6c20 736f 7572 6365 2873 292e  ginal source(s).
-0003b070: 2222 220a 0a20 2020 2020 2020 2073 656c  """..        sel
-0003b080: 662e 726f 6973 203d 205b 5d0a 2020 2020  f.rois = [].    
-0003b090: 2020 2020 7365 6c66 2e6c 6f61 6465 6420      self.loaded 
-0003b0a0: 3d20 4661 6c73 650a 2020 2020 2020 2020  = False.        
-0003b0b0: 7365 6c66 2e6c 6f61 6428 666f 7263 653d  self.load(force=
-0003b0c0: 5472 7565 290a 0a20 2020 2064 6566 2072  True)..    def r
-0003b0d0: 6573 6574 5f63 6f6e 746f 7572 7328 7365  eset_contours(se
-0003b0e0: 6c66 2c20 636f 6e74 6f75 7273 3d4e 6f6e  lf, contours=Non
-0003b0f0: 652c 206d 6f73 745f 706f 696e 7473 3d46  e, most_points=F
-0003b100: 616c 7365 293a 0a20 2020 2020 2020 2022  alse):.        "
-0003b110: 2222 0a20 2020 2020 2020 2052 6573 6574  "".        Reset
-0003b120: 2078 2d79 2063 6f6e 746f 7572 7320 666f   x-y contours fo
-0003b130: 7220 524f 4973 206f 6620 7374 7275 6374  r ROIs of struct
-0003b140: 7572 6520 7365 742e 0a0a 2020 2020 2020  ure set...      
-0003b150: 2020 2a2a 5061 7261 6d65 7465 7273 3a2a    **Parameters:*
-0003b160: 2a0a 2020 2020 2020 2020 0a20 2020 2020  *.        .     
-0003b170: 2020 2063 6f6e 746f 7572 7320 3a20 6469     contours : di
-0003b180: 6374 2c20 6465 6661 756c 743d 4e6f 6e65  ct, default=None
-0003b190: 0a20 2020 2020 2020 2020 2020 2044 6963  .            Dic
-0003b1a0: 7469 6f6e 6172 7920 7768 6572 6520 6b65  tionary where ke
-0003b1b0: 7973 2061 7265 2052 4f49 206e 616d 6573  ys are ROI names
-0003b1c0: 2061 6e64 2076 616c 7565 7320 6172 6520   and values are 
-0003b1d0: 6469 6374 696f 6e61 7269 6573 0a20 2020  dictionaries.   
-0003b1e0: 2020 2020 2020 2020 206f 6620 736c 6963           of slic
-0003b1f0: 6520 616e 6420 636f 6e74 6f75 7220 6c69  e and contour li
-0003b200: 7374 732e 2020 4966 204e 6f6e 652c 2061  sts.  If None, a
-0003b210: 6e20 656d 7074 7920 6469 6374 696f 6e61  n empty dictiona
-0003b220: 7279 2069 730a 2020 2020 2020 2020 2020  ry is.          
-0003b230: 2020 7573 6564 2e20 2049 6620 616e 2052    used.  If an R
-0003b240: 4f49 2068 6173 2061 206e 616d 6520 6e6f  OI has a name no
-0003b250: 7420 696e 636c 7564 6564 2069 6e20 7468  t included in th
-0003b260: 6520 746f 702d 6c65 7665 6c0a 2020 2020  e top-level.    
-0003b270: 2020 2020 2020 2020 6469 6374 696f 6e61          dictiona
-0003b280: 7279 2c20 6f72 2068 6173 2061 206e 616d  ry, or has a nam
-0003b290: 6520 7769 7468 2061 7373 6f63 6961 7465  e with associate
-0003b2a0: 6420 7661 6c75 6520 4e6f 6e65 2c20 7468  d value None, th
-0003b2b0: 650a 2020 2020 2020 2020 2020 2020 524f  e.            RO
-0003b2c0: 4920 636f 6e74 6f75 7273 2077 696c 6c20  I contours will 
-0003b2d0: 6265 2072 6573 6574 2075 7369 6e67 2074  be reset using t
-0003b2e0: 6865 2052 4f49 2773 206f 776e 2078 2d79  he ROI's own x-y
-0003b2f0: 2063 6f6e 746f 7572 732e 0a0a 2020 2020   contours...    
-0003b300: 2020 2020 6d6f 7374 5f70 6f69 6e74 7320      most_points 
-0003b310: 3a20 626f 6f6c 2c20 6465 6661 756c 743d  : bool, default=
-0003b320: 4661 6c73 650a 2020 2020 2020 2020 2020  False.          
-0003b330: 2020 4966 2054 7275 652c 206f 6e6c 7920    If True, only 
-0003b340: 7468 6520 636f 6e74 6f75 7220 7769 7468  the contour with
-0003b350: 206d 6f73 7420 706f 696e 7473 2066 6f72   most points for
-0003b360: 2065 6163 6820 736c 6963 650a 2020 2020   each slice.    
-0003b370: 2020 2020 2020 2020 6973 2072 6574 6169          is retai
-0003b380: 6e65 6420 6166 7465 7220 7265 7365 7474  ned after resett
-0003b390: 696e 672e 2020 4966 2046 616c 7365 2c20  ing.  If False, 
-0003b3a0: 616c 6c20 636f 6e74 6f75 7273 2066 6f72  all contours for
-0003b3b0: 2065 6163 680a 2020 2020 2020 2020 2020   each.          
-0003b3c0: 2020 736c 6963 6520 6172 6520 7265 7461    slice are reta
-0003b3d0: 696e 6564 2e0a 2020 2020 2020 2020 2222  ined..        ""
-0003b3e0: 220a 2020 2020 2020 2020 636f 6e74 6f75  ".        contou
-0003b3f0: 7273 203d 2063 6f6e 746f 7572 7320 6f72  rs = contours or
-0003b400: 207b 7d0a 2020 2020 2020 2020 666f 7220   {}.        for 
-0003b410: 726f 6920 696e 2073 656c 662e 6765 745f  roi in self.get_
-0003b420: 726f 6973 2829 3a0a 2020 2020 2020 2020  rois():.        
-0003b430: 2020 2020 726f 692e 7265 7365 745f 636f      roi.reset_co
-0003b440: 6e74 6f75 7273 2863 6f6e 746f 7572 732e  ntours(contours.
-0003b450: 6765 7428 726f 692e 6e61 6d65 2c20 4e6f  get(roi.name, No
-0003b460: 6e65 292c 206d 6f73 745f 706f 696e 7473  ne), most_points
-0003b470: 290a 0a20 2020 2064 6566 2073 6574 5f69  )..    def set_i
-0003b480: 6d61 6765 5f74 6f5f 6475 6d6d 7928 7365  mage_to_dummy(se
-0003b490: 6c66 2c20 2a2a 6b77 6172 6773 293a 0a20  lf, **kwargs):. 
-0003b4a0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-0003b4b0: 2020 2053 6574 2069 6d61 6765 2066 6f72     Set image for
-0003b4c0: 2073 656c 6620 616e 6420 616c 6c20 524f   self and all RO
-0003b4d0: 4973 2074 6f20 6265 2061 2064 756d 6d79  Is to be a dummy
-0003b4e0: 2069 6d61 6765 2063 6f76 6572 696e 670a   image covering.
-0003b4f0: 2020 2020 2020 2020 7468 6520 7265 6769          the regi
-0003b500: 6f6e 2063 6f6e 7461 696e 696e 6720 616c  on containing al
-0003b510: 6c20 524f 4973 2069 6e20 7468 6520 7374  l ROIs in the st
-0003b520: 7275 6374 7572 6520 7365 742e 2020 5468  ructure set.  Th
-0003b530: 6520 6d61 736b 0a20 2020 2020 2020 2061  e mask.        a
-0003b540: 6e64 2078 2d7a 2f79 2d7a 2063 6f6e 746f  nd x-z/y-z conto
-0003b550: 7572 7320 6f66 2065 6163 6820 524f 4920  urs of each ROI 
-0003b560: 7769 6c6c 2062 6520 636c 6561 7265 642c  will be cleared,
-0003b570: 2073 6f20 7468 6174 2074 6865 790a 2020   so that they.  
-0003b580: 2020 2020 2020 7769 6c6c 2062 6520 7265        will be re
-0003b590: 6372 6561 7465 6420 7768 656e 2067 6574  created when get
-0003b5a0: 5f6d 6173 6b28 2920 6f72 2067 6574 5f63  _mask() or get_c
-0003b5b0: 6f6e 746f 7572 7328 2920 6172 6520 6e65  ontours() are ne
-0003b5c0: 7874 2063 616c 6c65 642e 0a0a 2020 2020  xt called...    
-0003b5d0: 2020 2020 2a2a 5061 7261 6d65 7465 7273      **Parameters
-0003b5e0: 3a2a 2a0a 2020 2020 2020 2020 0a20 2020  :**.        .   
-0003b5f0: 2020 2020 206b 7761 7267 7320 3a20 0a20       kwargs : . 
-0003b600: 2020 2020 2020 2020 2020 204b 6579 776f             Keywo
-0003b610: 7264 2061 7267 756d 656e 7473 2074 6f20  rd arguments to 
-0003b620: 7061 7373 2074 6f20 7365 6c66 2e67 6574  pass to self.get
-0003b630: 5f64 756d 6d79 5f69 6d61 6765 2829 2077  _dummy_image() w
-0003b640: 6865 6e0a 2020 2020 2020 2020 2020 2020  hen.            
-0003b650: 6372 6561 7469 6e67 2074 6865 2064 756d  creating the dum
-0003b660: 6d79 2069 6d61 6765 2e20 5365 6520 646f  my image. See do
-0003b670: 6375 6d65 6e74 6174 696f 6e20 6f66 0a20  cumentation of. 
-0003b680: 2020 2020 2020 2020 2020 2053 7472 7563             Struc
-0003b690: 7475 7265 5365 742e 6765 745f 6475 6d6d  tureSet.get_dumm
-0003b6a0: 795f 696d 6167 6528 292e 0a20 2020 2020  y_image()..     
-0003b6b0: 2222 220a 2020 2020 2020 2020 2320 4d61  """.        # Ma
-0003b6c0: 6b65 2069 6d61 6765 0a20 2020 2020 2020  ke image.       
-0003b6d0: 2069 6d20 3d20 7365 6c66 2e67 6574 5f64   im = self.get_d
-0003b6e0: 756d 6d79 5f69 6d61 6765 282a 2a6b 7761  ummy_image(**kwa
-0003b6f0: 7267 7329 0a0a 2020 2020 2020 2020 2320  rgs)..        # 
-0003b700: 436c 6561 7220 6d61 736b 2061 6e64 2063  Clear mask and c
-0003b710: 6f6e 746f 7572 730a 2020 2020 2020 2020  ontours.        
-0003b720: 666f 7220 726f 6920 696e 2073 656c 662e  for roi in self.
-0003b730: 726f 6973 3a0a 2020 2020 2020 2020 2020  rois:.          
-0003b740: 2020 726f 692e 696e 7075 745f 636f 6e74    roi.input_cont
-0003b750: 6f75 7273 203d 2072 6f69 2e67 6574 5f63  ours = roi.get_c
-0003b760: 6f6e 746f 7572 7328 2278 2d79 2229 0a20  ontours("x-y"). 
-0003b770: 2020 2020 2020 2020 2020 2072 6f69 2e63             roi.c
-0003b780: 6f6e 746f 7572 7320 3d20 7b22 782d 7922  ontours = {"x-y"
-0003b790: 3a20 726f 692e 696e 7075 745f 636f 6e74  : roi.input_cont
-0003b7a0: 6f75 7273 7d0a 2020 2020 2020 2020 2020  ours}.          
-0003b7b0: 2020 726f 692e 6c6f 6164 6564 5f6d 6173    roi.loaded_mas
-0003b7c0: 6b20 3d20 4661 6c73 650a 2020 2020 2020  k = False.      
-0003b7d0: 2020 2020 2020 726f 692e 6d61 736b 203d        roi.mask =
-0003b7e0: 204e 6f6e 650a 0a20 2020 2020 2020 2023   None..        #
-0003b7f0: 2041 7373 6967 6e20 696d 6167 650a 2020   Assign image.  
-0003b800: 2020 2020 2020 7365 6c66 2e73 6574 5f69        self.set_i
-0003b810: 6d61 6765 2869 6d29 0a0a 2020 2020 6465  mage(im)..    de
-0003b820: 6620 7365 745f 696d 6167 6528 7365 6c66  f set_image(self
-0003b830: 2c20 696d 6167 652c 2061 6464 5f74 6f5f  , image, add_to_
-0003b840: 696d 6167 653d 5472 7565 293a 0a20 2020  image=True):.   
-0003b850: 2020 2020 2022 2222 5365 7420 696d 6167       """Set imag
-0003b860: 6520 666f 7220 7365 6c66 2061 6e64 2061  e for self and a
-0003b870: 6c6c 2052 4f49 732e 0a20 2020 2020 2020  ll ROIs..       
-0003b880: 2049 6620 6164 645f 746f 5f69 6d61 6765   If add_to_image
-0003b890: 2069 7320 5472 7565 2c20 696d 6167 652e   is True, image.
-0003b8a0: 6164 645f 7374 7275 6374 7572 655f 7365  add_structure_se
-0003b8b0: 7428 7365 6c66 290a 2020 2020 2020 2020  t(self).        
-0003b8c0: 7769 6c6c 2061 6c73 6f20 6265 2063 616c  will also be cal
-0003b8d0: 6c65 642e 2222 220a 0a20 2020 2020 2020  led."""..       
-0003b8e0: 2023 2043 6f6e 7665 7274 2074 6f20 496d   # Convert to Im
-0003b8f0: 6167 6520 6f62 6a65 6374 2069 6620 6e65  age object if ne
-0003b900: 6564 6564 0a20 2020 2020 2020 2069 6620  eded.        if 
-0003b910: 696d 6167 6520 616e 6420 6e6f 7420 6973  image and not is
-0003b920: 696e 7374 616e 6365 2869 6d61 6765 2c20  instance(image, 
-0003b930: 736b 7274 2e69 6d61 6765 2e49 6d61 6765  skrt.image.Image
-0003b940: 293a 0a20 2020 2020 2020 2020 2020 2069  ):.            i
-0003b950: 6d61 6765 203d 2073 6b72 742e 696d 6167  mage = skrt.imag
-0003b960: 652e 496d 6167 6528 696d 6167 6529 0a0a  e.Image(image)..
-0003b970: 2020 2020 2020 2020 2320 4173 7369 676e          # Assign
-0003b980: 2074 6f20 7365 6c66 2061 6e64 2061 6c6c   to self and all
-0003b990: 2052 4f49 730a 2020 2020 2020 2020 7365   ROIs.        se
-0003b9a0: 6c66 2e69 6d61 6765 203d 2069 6d61 6765  lf.image = image
-0003b9b0: 0a20 2020 2020 2020 2066 6f72 2072 6f69  .        for roi
-0003b9c0: 2069 6e20 7365 6c66 2e72 6f69 733a 0a20   in self.rois:. 
-0003b9d0: 2020 2020 2020 2020 2020 2072 6f69 2e73             roi.s
-0003b9e0: 6574 5f69 6d61 6765 2869 6d61 6765 290a  et_image(image).
-0003b9f0: 0a20 2020 2020 2020 2023 2041 7373 6967  .        # Assig
-0003ba00: 6e20 7365 6c66 2074 6f20 7468 6520 696d  n self to the im
-0003ba10: 6167 650a 2020 2020 2020 2020 6966 2069  age.        if i
-0003ba20: 6d61 6765 2069 7320 6e6f 7420 4e6f 6e65  mage is not None
-0003ba30: 2061 6e64 2061 6464 5f74 6f5f 696d 6167   and add_to_imag
-0003ba40: 653a 0a20 2020 2020 2020 2020 2020 2069  e:.            i
-0003ba50: 6d61 6765 2e61 6464 5f73 7472 7563 7475  mage.add_structu
-0003ba60: 7265 5f73 6574 2873 656c 6629 0a0a 2020  re_set(self)..  
-0003ba70: 2020 6465 6620 636f 6e74 6169 6e73 2873    def contains(s
-0003ba80: 656c 662c 2072 6f69 5f6e 616d 6573 2c20  elf, roi_names, 
-0003ba90: 696e 5f69 6d61 6765 3d46 616c 7365 293a  in_image=False):
-0003baa0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-0003bab0: 2020 2020 2052 6574 7572 6e20 7768 6574       Return whet
-0003bac0: 6865 7220 7374 7275 6374 7572 6520 7365  her structure se
-0003bad0: 7420 636f 6e74 6169 6e73 206e 616d 6564  t contains named
-0003bae0: 2052 4f49 732c 0a20 2020 2020 2020 206f   ROIs,.        o
-0003baf0: 7074 696f 6e61 6c6c 7920 7465 7374 696e  ptionally testin
-0003bb00: 6720 7768 6574 6865 7220 7468 6520 524f  g whether the RO
-0003bb10: 4973 2062 6520 6675 6c6c 7920 636f 6e74  Is be fully cont
-0003bb20: 6169 6e65 6420 696e 2061 6e20 696d 6167  ained in an imag
-0003bb30: 652e 0a0a 2020 2020 2020 2020 2a2a 5061  e...        **Pa
-0003bb40: 7261 6d65 7465 7273 3a2a 2a0a 0a20 2020  rameters:**..   
-0003bb50: 2020 2020 2072 6f69 5f6e 616d 6573 203a       roi_names :
-0003bb60: 206c 6973 742f 7374 720a 2020 2020 2020   list/str.      
-0003bb70: 2020 2020 2020 5369 6e67 6c65 2073 7472        Single str
-0003bb80: 696e 672c 206f 7220 6c69 7374 206f 6620  ing, or list of 
-0003bb90: 7374 7269 6e67 732c 2069 6e64 6963 6174  strings, indicat
-0003bba0: 696e 6720 6e61 6d65 2873 2920 6f66 2052  ing name(s) of R
-0003bbb0: 4f49 2873 290a 2020 2020 2020 2020 2020  OI(s).          
-0003bbc0: 2020 746f 2062 6520 636f 6e73 6964 6572    to be consider
-0003bbd0: 6564 2e0a 0a20 2020 2020 2020 2069 6e5f  ed...        in_
-0003bbe0: 696d 6167 6520 3a20 626f 6f6c 2f73 6b72  image : bool/skr
-0003bbf0: 742e 696d 6167 652e 496d 6167 652c 2064  t.image.Image, d
-0003bc00: 6566 6175 6c74 3d46 616c 7365 0a20 2020  efault=False.   
-0003bc10: 2020 2020 2020 2020 2053 7065 6369 6669           Specifi
-0003bc20: 6361 7469 6f6e 206f 6620 7768 6574 6865  cation of whethe
-0003bc30: 7220 746f 2074 6573 7420 7468 6174 2052  r to test that R
-0003bc40: 4f49 7320 6172 6520 6675 6c6c 7920 636f  OIs are fully co
-0003bc50: 6e74 6169 6e65 640a 2020 2020 2020 2020  ntained.        
-0003bc60: 2020 2020 696e 2061 6e20 696d 6167 652e      in an image.
-0003bc70: 2020 4966 2069 6e5f 696d 6167 6520 6973    If in_image is
-0003bc80: 2069 6e20 496d 6167 6520 6f62 6a65 6374   in Image object
-0003bc90: 2c20 7468 6520 626f 6f6c 6561 6e20 7265  , the boolean re
-0003bca0: 7475 726e 6564 0a20 2020 2020 2020 2020  turned.         
-0003bcb0: 2020 2069 6e64 6963 6174 6573 2077 6865     indicates whe
-0003bcc0: 7468 6572 2061 6c6c 206e 616d 6564 2052  ther all named R
-0003bcd0: 4f49 7320 6172 6520 636f 6e74 6169 6e65  OIs are containe
-0003bce0: 6420 7769 7468 696e 2074 6869 7320 696d  d within this im
-0003bcf0: 6167 652e 0a20 2020 2020 2020 2020 2020  age..           
-0003bd00: 2049 6620 696e 5f69 6d61 6765 2069 7320   If in_image is 
-0003bd10: 5472 7565 2c20 7468 6520 626f 6f6c 6561  True, the boolea
-0003bd20: 6e20 7265 7475 726e 6564 2069 6e64 6963  n returned indic
-0003bd30: 6174 6573 2077 6865 7468 6572 0a20 2020  ates whether.   
-0003bd40: 2020 2020 2020 2020 2061 6c6c 206e 616d           all nam
-0003bd50: 6564 2052 4f49 7320 6172 6520 636f 6e74  ed ROIs are cont
-0003bd60: 6169 6e65 6420 7769 7468 696e 2074 6865  ained within the
-0003bd70: 2069 6d61 6765 2061 7373 6f63 6961 7465   image associate
-0003bd80: 6420 7769 7468 0a20 2020 2020 2020 2020  d with.         
-0003bd90: 2020 2073 656c 662e 0a20 2020 2020 2020     self..       
-0003bda0: 2022 2222 0a20 2020 2020 2020 2069 6620   """.        if 
-0003bdb0: 6973 696e 7374 616e 6365 2872 6f69 5f6e  isinstance(roi_n
-0003bdc0: 616d 6573 2c20 7374 7229 3a0a 2020 2020  ames, str):.    
-0003bdd0: 2020 2020 2020 2020 726f 695f 6e61 6d65          roi_name
-0003bde0: 7320 3d20 5b72 6f69 5f6e 616d 6573 5d0a  s = [roi_names].
-0003bdf0: 0a20 2020 2020 2020 2023 2043 6865 636b  .        # Check
-0003be00: 2077 6865 7468 6572 2073 7472 7563 7475   whether structu
-0003be10: 7265 2073 6574 2063 6f6e 7461 696e 7320  re set contains 
-0003be20: 616c 6c20 6e61 6d65 6420 524f 4973 2e0a  all named ROIs..
-0003be30: 2020 2020 2020 2020 7373 5f72 6f69 5f6e          ss_roi_n
-0003be40: 616d 6573 203d 2073 656c 662e 6765 745f  ames = self.get_
-0003be50: 726f 695f 6e61 6d65 7328 290a 2020 2020  roi_names().    
-0003be60: 2020 2020 666f 7220 726f 695f 6e61 6d65      for roi_name
-0003be70: 2069 6e20 726f 695f 6e61 6d65 733a 0a20   in roi_names:. 
-0003be80: 2020 2020 2020 2020 2020 2069 6620 726f             if ro
-0003be90: 695f 6e61 6d65 206e 6f74 2069 6e20 7373  i_name not in ss
-0003bea0: 5f72 6f69 5f6e 616d 6573 3a0a 2020 2020  _roi_names:.    
-0003beb0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-0003bec0: 726e 2046 616c 7365 0a0a 2020 2020 2020  rn False..      
-0003bed0: 2020 2320 4465 7465 726d 696e 6520 7768    # Determine wh
-0003bee0: 6574 6865 7220 746f 2063 6865 636b 2074  ether to check t
-0003bef0: 6861 7420 6e61 6d65 6420 524f 4973 2061  hat named ROIs a
-0003bf00: 7265 2063 6f6e 7461 696e 6564 2069 6e20  re contained in 
-0003bf10: 616e 2069 6d61 6765 2e0a 2020 2020 2020  an image..      
-0003bf20: 2020 6966 206e 6f74 2069 6e5f 696d 6167    if not in_imag
-0003bf30: 653a 0a20 2020 2020 2020 2020 2020 2072  e:.            r
-0003bf40: 6574 7572 6e20 5472 7565 0a0a 2020 2020  eturn True..    
-0003bf50: 2020 2020 2320 4368 6563 6b20 7468 6174      # Check that
-0003bf60: 2069 6d61 6765 2069 7320 7370 6563 6966   image is specif
-0003bf70: 6965 642e 0a20 2020 2020 2020 2023 2049  ied..        # I
-0003bf80: 6620 7965 732c 2020 656e 7375 7265 2074  f yes,  ensure t
-0003bf90: 6861 7420 524f 4920 6d61 736b 7320 6861  hat ROI masks ha
-0003bfa0: 7665 2074 6865 2073 616d 6520 766f 7865  ve the same voxe
-0003bfb0: 6c20 7369 7a65 2061 7320 7468 6973 2069  l size as this i
-0003bfc0: 6d61 6765 2e0a 2020 2020 2020 2020 6966  mage..        if
-0003bfd0: 2069 7369 6e73 7461 6e63 6528 696e 5f69   isinstance(in_i
-0003bfe0: 6d61 6765 2c20 736b 7274 2e69 6d61 6765  mage, skrt.image
-0003bff0: 2e49 6d61 6765 293a 0a20 2020 2020 2020  .Image):.       
-0003c000: 2020 2020 2069 6d20 3d20 696e 5f69 6d61       im = in_ima
-0003c010: 6765 0a20 2020 2020 2020 2020 2020 2073  ge.            s
-0003c020: 7320 3d20 7365 6c66 2e63 6c6f 6e65 2829  s = self.clone()
-0003c030: 0a20 2020 2020 2020 2020 2020 2073 732e  .            ss.
-0003c040: 7365 745f 696d 6167 6528 696d 2c20 6164  set_image(im, ad
-0003c050: 645f 746f 5f69 6d61 6765 3d46 616c 7365  d_to_image=False
-0003c060: 290a 2020 2020 2020 2020 656c 7365 3a0a  ).        else:.
-0003c070: 2020 2020 2020 2020 2020 2020 696d 203d              im =
-0003c080: 2073 656c 662e 696d 6167 650a 2020 2020   self.image.    
-0003c090: 2020 2020 2020 2020 7373 203d 2073 656c          ss = sel
-0003c0a0: 660a 2020 2020 2020 2020 6966 206e 6f74  f.        if not
-0003c0b0: 2069 7369 6e73 7461 6e63 6528 696d 2c20   isinstance(im, 
-0003c0c0: 736b 7274 2e69 6d61 6765 2e49 6d61 6765  skrt.image.Image
-0003c0d0: 293a 0a20 2020 2020 2020 2020 2020 2072  ):.            r
-0003c0e0: 6574 7572 6e20 4661 6c73 650a 0a20 2020  eturn False..   
-0003c0f0: 2020 2020 2023 2043 6865 636b 2077 6865       # Check whe
-0003c100: 7468 6572 2052 4f49 7320 6172 6520 636f  ther ROIs are co
-0003c110: 6e74 6169 6e65 6420 696e 2069 6d61 6765  ntained in image
-0003c120: 2e0a 2020 2020 2020 2020 696d 5f65 7874  ..        im_ext
-0003c130: 656e 7473 203d 2069 6d2e 6765 745f 6578  ents = im.get_ex
-0003c140: 7465 6e74 7328 290a 2020 2020 2020 2020  tents().        
-0003c150: 666f 7220 726f 695f 6e61 6d65 2069 6e20  for roi_name in 
-0003c160: 726f 695f 6e61 6d65 733a 0a20 2020 2020  roi_names:.     
-0003c170: 2020 2020 2020 2072 6f69 5f65 7874 656e         roi_exten
-0003c180: 7473 203d 2073 735b 726f 695f 6e61 6d65  ts = ss[roi_name
-0003c190: 5d2e 6765 745f 6578 7465 6e74 7328 302e  ].get_extents(0.
-0003c1a0: 352c 2022 766f 7865 6c73 2229 0a20 2020  5, "voxels").   
-0003c1b0: 2020 2020 2020 2020 2066 6f72 2069 6478           for idx
-0003c1c0: 2069 6e20 7261 6e67 6528 3329 3a0a 2020   in range(3):.  
-0003c1d0: 2020 2020 2020 2020 2020 2020 2020 6966                if
-0003c1e0: 2072 6f69 5f65 7874 656e 7473 5b69 6478   roi_extents[idx
-0003c1f0: 5d5b 305d 203c 2069 6d5f 6578 7465 6e74  ][0] < im_extent
-0003c200: 735b 6964 785d 5b30 5d3a 0a20 2020 2020  s[idx][0]:.     
-0003c210: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-0003c220: 6574 7572 6e20 4661 6c73 650a 2020 2020  eturn False.    
-0003c230: 2020 2020 2020 2020 2020 2020 6966 2072              if r
-0003c240: 6f69 5f65 7874 656e 7473 5b69 6478 5d5b  oi_extents[idx][
-0003c250: 315d 203e 2069 6d5f 6578 7465 6e74 735b  1] > im_extents[
-0003c260: 6964 785d 5b31 5d3a 0a20 2020 2020 2020  idx][1]:.       
-0003c270: 2020 2020 2020 2020 2020 2020 2072 6574               ret
-0003c280: 7572 6e20 4661 6c73 650a 0a20 2020 2020  urn False..     
-0003c290: 2020 2072 6574 7572 6e20 5472 7565 0a0a     return True..
-0003c2a0: 2020 2020 6465 6620 6d69 7373 696e 6728      def missing(
-0003c2b0: 7365 6c66 2c20 726f 695f 6e61 6d65 732c  self, roi_names,
-0003c2c0: 2069 6e5f 696d 6167 653d 4661 6c73 6529   in_image=False)
-0003c2d0: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
-0003c2e0: 2020 2020 2020 4964 656e 7469 6679 2061        Identify a
-0003c2f0: 6d6f 6e67 206e 616d 6564 2052 4f49 7320  mong named ROIs 
-0003c300: 7468 6f73 6520 7468 6174 2061 7265 206d  those that are m
-0003c310: 6973 7369 6e67 2066 726f 6d20 7374 7275  issing from stru
-0003c320: 6374 7572 6520 7365 742c 0a20 2020 2020  cture set,.     
-0003c330: 2020 206f 7220 6172 6520 6e6f 7420 6675     or are not fu
-0003c340: 6c6c 7920 636f 6e74 6169 6e65 6420 696e  lly contained in
-0003c350: 2061 6e20 696d 6167 652e 0a0a 2020 2020   an image...    
-0003c360: 2020 2020 2a2a 5061 7261 6d65 7465 7273      **Parameters
-0003c370: 3a2a 2a0a 0a20 2020 2020 2020 2072 6f69  :**..        roi
-0003c380: 5f6e 616d 6573 203a 206c 6973 742f 7374  _names : list/st
-0003c390: 720a 2020 2020 2020 2020 2020 2020 5369  r.            Si
-0003c3a0: 6e67 6c65 2073 7472 696e 672c 206f 7220  ngle string, or 
-0003c3b0: 6c69 7374 206f 6620 7374 7269 6e67 732c  list of strings,
-0003c3c0: 2069 6e64 6963 6174 696e 6720 6e61 6d65   indicating name
-0003c3d0: 2873 2920 6f66 2052 4f49 2873 290a 2020  (s) of ROI(s).  
-0003c3e0: 2020 2020 2020 2020 2020 746f 2062 6520            to be 
-0003c3f0: 636f 6e73 6964 6572 6564 2e0a 0a20 2020  considered...   
-0003c400: 2020 2020 2069 6e5f 696d 6167 6520 3a20       in_image : 
-0003c410: 626f 6f6c 2f73 6b72 742e 696d 6167 652e  bool/skrt.image.
-0003c420: 496d 6167 652c 2064 6566 6175 6c74 3d46  Image, default=F
-0003c430: 616c 7365 0a20 2020 2020 2020 2020 2020  alse.           
-0003c440: 2053 7065 6369 6669 6361 7469 6f6e 206f   Specification o
-0003c450: 6620 7768 6574 6865 7220 746f 2074 6573  f whether to tes
-0003c460: 7420 7468 6174 2052 4f49 7320 6172 6520  t that ROIs are 
-0003c470: 6675 6c6c 7920 636f 6e74 6169 6e65 640a  fully contained.
-0003c480: 2020 2020 2020 2020 2020 2020 696e 2061              in a
-0003c490: 6e20 696d 6167 652e 2020 4966 2069 6e5f  n image.  If in_
-0003c4a0: 696d 6167 6520 6973 2069 6e20 496d 6167  image is in Imag
-0003c4b0: 6520 6f62 6a65 6374 2c20 616e 2052 4f49  e object, an ROI
-0003c4c0: 2069 730a 2020 2020 2020 2020 2020 2020   is.            
-0003c4d0: 6964 656e 7469 6669 6564 2061 7320 6d69  identified as mi
-0003c4e0: 7373 696e 6720 6966 206e 6f74 2063 6f6e  ssing if not con
-0003c4f0: 7461 696e 6564 2077 6974 6869 6e20 7468  tained within th
-0003c500: 6973 2069 6d61 6765 2e0a 2020 2020 2020  is image..      
-0003c510: 2020 2020 2020 4966 2069 6e5f 696d 6167        If in_imag
-0003c520: 6520 6973 2054 7275 652c 2061 6e20 524f  e is True, an RO
-0003c530: 4920 6973 2069 6465 6e74 6966 6965 6420  I is identified 
-0003c540: 6173 206d 6973 7369 6e67 2069 6620 6e6f  as missing if no
-0003c550: 740a 2020 2020 2020 2020 2020 2020 636f  t.            co
-0003c560: 6e74 6169 6e65 6420 7769 7468 696e 2074  ntained within t
-0003c570: 6865 2069 6d61 6765 2061 7373 6f63 6961  he image associa
-0003c580: 7465 6420 7769 7468 2073 656c 662e 0a20  ted with self.. 
-0003c590: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-0003c5a0: 2020 2069 6620 6973 696e 7374 616e 6365     if isinstance
-0003c5b0: 2872 6f69 5f6e 616d 6573 2c20 7374 7229  (roi_names, str)
-0003c5c0: 3a0a 2020 2020 2020 2020 2020 2020 726f  :.            ro
-0003c5d0: 695f 6e61 6d65 7320 3d20 5b72 6f69 5f6e  i_names = [roi_n
-0003c5e0: 616d 6573 5d0a 2020 2020 2020 2020 6d69  ames].        mi
-0003c5f0: 7373 696e 675f 726f 6973 203d 2073 6574  ssing_rois = set
-0003c600: 2829 0a0a 2020 2020 2020 2020 2320 4368  ()..        # Ch
-0003c610: 6563 6b20 666f 7220 524f 4973 206e 6f74  eck for ROIs not
-0003c620: 2063 6f6e 7461 696e 6564 2069 6e20 7374   contained in st
-0003c630: 7275 6374 7572 6520 7365 742e 0a20 2020  ructure set..   
-0003c640: 2020 2020 2073 735f 726f 695f 6e61 6d65       ss_roi_name
-0003c650: 7320 3d20 7365 6c66 2e67 6574 5f72 6f69  s = self.get_roi
-0003c660: 5f6e 616d 6573 2829 0a20 2020 2020 2020  _names().       
-0003c670: 2066 6f72 2072 6f69 5f6e 616d 6520 696e   for roi_name in
-0003c680: 2072 6f69 5f6e 616d 6573 3a0a 2020 2020   roi_names:.    
-0003c690: 2020 2020 2020 2020 6966 2072 6f69 5f6e          if roi_n
-0003c6a0: 616d 6520 6e6f 7420 696e 2073 735f 726f  ame not in ss_ro
-0003c6b0: 695f 6e61 6d65 733a 0a20 2020 2020 2020  i_names:.       
-0003c6c0: 2020 2020 2020 2020 206d 6973 7369 6e67           missing
-0003c6d0: 5f72 6f69 732e 6164 6428 726f 695f 6e61  _rois.add(roi_na
-0003c6e0: 6d65 290a 0a20 2020 2020 2020 2023 2044  me)..        # D
-0003c6f0: 6574 6572 6d69 6e65 2077 6865 7468 6572  etermine whether
-0003c700: 2074 6f20 6368 6563 6b20 7468 6174 206e   to check that n
-0003c710: 616d 6564 2052 4f49 7320 6172 6520 636f  amed ROIs are co
-0003c720: 6e74 6169 6e65 6420 696e 2061 6e20 696d  ntained in an im
-0003c730: 6167 652e 0a20 2020 2020 2020 2069 6620  age..        if 
-0003c740: 6e6f 7420 696e 5f69 6d61 6765 3a0a 2020  not in_image:.  
-0003c750: 2020 2020 2020 2020 2020 7265 7475 726e            return
-0003c760: 2073 6f72 7465 6428 6c69 7374 286d 6973   sorted(list(mis
-0003c770: 7369 6e67 5f72 6f69 7329 290a 0a20 2020  sing_rois))..   
-0003c780: 2020 2020 2023 2043 6865 636b 2074 6861       # Check tha
-0003c790: 7420 696d 6167 6520 6973 2073 7065 6369  t image is speci
-0003c7a0: 6669 6564 2e0a 2020 2020 2020 2020 2320  fied..        # 
-0003c7b0: 4966 2079 6573 2c20 2065 6e73 7572 6520  If yes,  ensure 
-0003c7c0: 7468 6174 2052 4f49 206d 6173 6b73 2068  that ROI masks h
-0003c7d0: 6176 6520 7468 6520 7361 6d65 2076 6f78  ave the same vox
-0003c7e0: 656c 2073 697a 6520 6173 2074 6869 7320  el size as this 
-0003c7f0: 696d 6167 652e 0a20 2020 2020 2020 2069  image..        i
-0003c800: 6620 6973 696e 7374 616e 6365 2869 6e5f  f isinstance(in_
-0003c810: 696d 6167 652c 2073 6b72 742e 696d 6167  image, skrt.imag
-0003c820: 652e 496d 6167 6529 3a0a 2020 2020 2020  e.Image):.      
-0003c830: 2020 2020 2020 696d 203d 2069 6e5f 696d        im = in_im
-0003c840: 6167 650a 2020 2020 2020 2020 2020 2020  age.            
-0003c850: 7373 203d 2073 656c 662e 636c 6f6e 6528  ss = self.clone(
-0003c860: 290a 2020 2020 2020 2020 2020 2020 7373  ).            ss
-0003c870: 2e73 6574 5f69 6d61 6765 2869 6d2c 2061  .set_image(im, a
-0003c880: 6464 5f74 6f5f 696d 6167 653d 4661 6c73  dd_to_image=Fals
-0003c890: 6529 0a20 2020 2020 2020 2065 6c73 653a  e).        else:
-0003c8a0: 0a20 2020 2020 2020 2020 2020 2069 6d20  .            im 
-0003c8b0: 3d20 7365 6c66 2e69 6d61 6765 0a20 2020  = self.image.   
-0003c8c0: 2020 2020 2020 2020 2073 7320 3d20 7365           ss = se
-0003c8d0: 6c66 0a20 2020 2020 2020 2069 6620 6e6f  lf.        if no
-0003c8e0: 7420 6973 696e 7374 616e 6365 2869 6d2c  t isinstance(im,
-0003c8f0: 2073 6b72 742e 696d 6167 652e 496d 6167   skrt.image.Imag
-0003c900: 6529 3a0a 2020 2020 2020 2020 2020 2020  e):.            
-0003c910: 7261 6973 6520 5275 6e74 696d 6545 7272  raise RuntimeErr
-0003c920: 6f72 2866 2249 6e76 616c 6964 2069 6d61  or(f"Invalid ima
-0003c930: 6765 2073 7065 6369 6669 6361 7469 6f6e  ge specification
-0003c940: 2229 0a0a 2020 2020 2020 2020 2320 4368  ")..        # Ch
-0003c950: 6563 6b20 7768 6574 6865 7220 524f 4973  eck whether ROIs
-0003c960: 2061 7265 2063 6f6e 7461 696e 6564 2069   are contained i
-0003c970: 6e20 696d 6167 652e 0a20 2020 2020 2020  n image..       
-0003c980: 2069 6d5f 6578 7465 6e74 7320 3d20 696d   im_extents = im
-0003c990: 2e67 6574 5f65 7874 656e 7473 2829 0a20  .get_extents(). 
-0003c9a0: 2020 2020 2020 2061 6374 6976 655f 726f         active_ro
-0003c9b0: 6973 203d 2073 6574 2872 6f69 5f6e 616d  is = set(roi_nam
-0003c9c0: 6573 2920 2d20 6d69 7373 696e 675f 726f  es) - missing_ro
-0003c9d0: 6973 0a20 2020 2020 2020 2066 6f72 2072  is.        for r
-0003c9e0: 6f69 5f6e 616d 6520 696e 2061 6374 6976  oi_name in activ
-0003c9f0: 655f 726f 6973 3a0a 2020 2020 2020 2020  e_rois:.        
-0003ca00: 2020 2020 726f 695f 6578 7465 6e74 7320      roi_extents 
-0003ca10: 3d20 7373 5b72 6f69 5f6e 616d 655d 2e67  = ss[roi_name].g
-0003ca20: 6574 5f65 7874 656e 7473 2830 2e35 2c20  et_extents(0.5, 
-0003ca30: 2276 6f78 656c 7322 290a 2020 2020 2020  "voxels").      
-0003ca40: 2020 2020 2020 666f 7220 6964 7820 696e        for idx in
-0003ca50: 2072 616e 6765 2833 293a 0a20 2020 2020   range(3):.     
-0003ca60: 2020 2020 2020 2020 2020 2069 6620 2872             if (r
-0003ca70: 6f69 5f65 7874 656e 7473 5b69 6478 5d5b  oi_extents[idx][
-0003ca80: 305d 203c 2069 6d5f 6578 7465 6e74 735b  0] < im_extents[
-0003ca90: 6964 785d 5b30 5d0a 2020 2020 2020 2020  idx][0].        
-0003caa0: 2020 2020 2020 2020 2020 2020 6f72 2072              or r
-0003cab0: 6f69 5f65 7874 656e 7473 5b69 6478 5d5b  oi_extents[idx][
-0003cac0: 315d 203e 2069 6d5f 6578 7465 6e74 735b  1] > im_extents[
-0003cad0: 6964 785d 5b31 5d29 3a0a 2020 2020 2020  idx][1]):.      
-0003cae0: 2020 2020 2020 2020 2020 2020 2020 6d69                mi
-0003caf0: 7373 696e 675f 726f 6973 2e61 6464 2872  ssing_rois.add(r
-0003cb00: 6f69 5f6e 616d 6529 0a0a 2020 2020 2020  oi_name)..      
-0003cb10: 2020 7265 7475 726e 2073 6f72 7465 6428    return sorted(
-0003cb20: 6c69 7374 286d 6973 7369 6e67 5f72 6f69  list(missing_roi
-0003cb30: 7329 290a 0a20 2020 2064 6566 2068 6173  s))..    def has
-0003cb40: 5f72 6f69 7328 7365 6c66 2c20 6e61 6d65  _rois(self, name
-0003cb50: 733d 4e6f 6e65 2c20 696e 636c 7564 655f  s=None, include_
-0003cb60: 6b65 7973 3d46 616c 7365 293a 0a20 2020  keys=False):.   
-0003cb70: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-0003cb80: 2044 6574 6572 6d69 6e65 2077 6865 7468   Determine wheth
-0003cb90: 6572 2073 7472 7563 7475 7265 2073 6574  er structure set
-0003cba0: 2063 6f6e 7461 696e 7320 7370 6563 6966   contains specif
-0003cbb0: 6965 6420 524f 4973 2c0a 2020 2020 2020  ied ROIs,.      
-0003cbc0: 2020 6964 656e 7469 6669 6564 2062 7920    identified by 
-0003cbd0: 6120 6e6f 6d69 6e61 6c20 6e61 6d65 206f  a nominal name o
-0003cbe0: 7220 6279 2061 6e20 616c 6961 732e 0a0a  r by an alias...
-0003cbf0: 2020 2020 2020 2020 5468 6973 206d 6574          This met
-0003cc00: 686f 6420 7265 7475 726e 7320 5472 7565  hod returns True
-0003cc10: 2069 6620 616c 6c20 7370 6563 6966 6965   if all specifie
-0003cc20: 6420 524f 4920 6e61 6d65 7320 6172 6520  d ROI names are 
-0003cc30: 6d61 7463 6865 640a 2020 2020 2020 2020  matched.        
-0003cc40: 7769 7468 2074 6865 206e 616d 6520 6f66  with the name of
-0003cc50: 2061 6e20 524f 4920 696e 2074 6865 2073   an ROI in the s
-0003cc60: 7472 7563 7475 7265 2073 6574 2c20 616e  tructure set, an
-0003cc70: 6420 7265 7475 726e 7320 4661 6c73 650a  d returns False.
-0003cc80: 2020 2020 2020 2020 6f74 6865 7277 6973          otherwis
-0003cc90: 652e 2020 4d61 7463 6869 6e67 2069 7320  e.  Matching is 
-0003cca0: 6361 7365 2069 6e73 656e 7369 7469 7665  case insensitive
-0003ccb0: 2e0a 0a20 2020 2020 2020 206e 616d 6573  ...        names
-0003ccc0: 203a 2073 7472 2f6c 6973 742f 6469 6374   : str/list/dict
-0003ccd0: 0a20 2020 2020 2020 2020 2020 2053 7065  .            Spe
-0003cce0: 6369 6669 6361 7469 6f6e 206f 6620 524f  cification of RO
-0003ccf0: 4973 3a0a 2020 2020 2020 2020 2020 2020  Is:.            
-0003cd00: 2d20 6120 7369 6e67 6c65 2052 4f49 206e  - a single ROI n
-0003cd10: 616d 652c 206f 7074 696f 6e61 6c6c 7920  ame, optionally 
-0003cd20: 696e 636c 7564 696e 6720 7769 6c64 6361  including wildca
-0003cd30: 7264 733b 0a20 2020 2020 2020 2020 2020  rds;.           
-0003cd40: 202d 2061 206c 6973 7420 6f66 2052 4f49   - a list of ROI
-0003cd50: 206e 616d 6573 2c20 6561 6368 206f 7074   names, each opt
-0003cd60: 696f 6e61 6c6c 7920 696e 636c 7564 696e  ionally includin
-0003cd70: 6720 7769 6c64 6361 7264 733b 0a20 2020  g wildcards;.   
-0003cd80: 2020 2020 2020 2020 202d 2061 2064 6963           - a dic
-0003cd90: 7469 6f6e 6172 792c 2077 6865 7265 206b  tionary, where k
-0003cda0: 6579 7320 6172 6520 6e6f 6d69 6e61 6c20  eys are nominal 
-0003cdb0: 524f 4920 6e61 6d65 732c 0a20 2020 2020  ROI names,.     
-0003cdc0: 2020 2020 2020 2061 6e64 2076 616c 7565         and value
-0003cdd0: 7320 6172 6520 6c69 7374 7320 6f66 2070  s are lists of p
-0003cde0: 6f73 7369 626c 6520 6e61 6d65 732c 206f  ossible names, o
-0003cdf0: 7074 696f 6e61 6c6c 7920 696e 636c 7564  ptionally includ
-0003ce00: 696e 670a 2020 2020 2020 2020 2020 2020  ing.            
-0003ce10: 7769 6c64 6361 7264 732e 0a0a 2020 2020  wildcards...    
-0003ce20: 2020 2020 696e 636c 7564 655f 6b65 7973      include_keys
-0003ce30: 203a 2062 6f6f 6c2c 2064 6566 6175 6c74   : bool, default
-0003ce40: 3d54 7275 650a 2020 2020 2020 2020 2020  =True.          
-0003ce50: 2020 4966 2054 7275 652c 2063 6f6e 7369    If True, consi
-0003ce60: 6465 7220 626f 7468 206b 6579 7320 616e  der both keys an
-0003ce70: 6420 7661 6c75 6573 2066 6f72 206d 6174  d values for mat
-0003ce80: 6368 696e 6720 6966 2052 4f49 206e 616d  ching if ROI nam
-0003ce90: 6573 0a20 2020 2020 2020 2020 2020 2061  es.            a
-0003cea0: 7265 2073 7065 6369 6669 6564 2061 7320  re specified as 
-0003ceb0: 6120 6469 6374 696f 6e61 7279 2e20 2049  a dictionary.  I
-0003cec0: 6620 4661 6c73 652c 2063 6f6e 7369 6465  f False, conside
-0003ced0: 7220 7661 6c75 6573 206f 6e6c 792e 0a20  r values only.. 
-0003cee0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-0003cef0: 2020 2023 2043 6f6e 7665 7274 206e 616d     # Convert nam
-0003cf00: 6573 2074 6f20 6120 6469 6374 696f 6e61  es to a dictiona
-0003cf10: 7279 2c20 7768 6572 6520 6561 6368 2076  ry, where each v
-0003cf20: 616c 7565 2069 7320 6120 6c69 7374 2e0a  alue is a list..
-0003cf30: 2020 2020 2020 2020 6966 2069 7369 6e73          if isins
-0003cf40: 7461 6e63 6528 6e61 6d65 732c 2073 7472  tance(names, str
-0003cf50: 293a 0a20 2020 2020 2020 2020 2020 206e  ):.            n
-0003cf60: 616d 6573 203d 207b 6e61 6d65 733a 205b  ames = {names: [
-0003cf70: 6e61 6d65 735d 7d0a 2020 2020 2020 2020  names]}.        
-0003cf80: 656c 6966 2073 6b72 742e 636f 7265 2e69  elif skrt.core.i
-0003cf90: 735f 6c69 7374 286e 616d 6573 293a 0a20  s_list(names):. 
-0003cfa0: 2020 2020 2020 2020 2020 206e 616d 6573             names
-0003cfb0: 203d 207b 6e61 6d65 3a20 5b6e 616d 655d   = {name: [name]
-0003cfc0: 2066 6f72 206e 616d 6520 696e 206e 616d   for name in nam
-0003cfd0: 6573 7d0a 2020 2020 2020 2020 656c 6966  es}.        elif
-0003cfe0: 2069 7369 6e73 7461 6e63 6528 6e61 6d65   isinstance(name
-0003cff0: 732c 2064 6963 7429 3a0a 2020 2020 2020  s, dict):.      
-0003d000: 2020 2020 2020 666f 7220 6e61 6d65 2069        for name i
-0003d010: 6e20 6e61 6d65 733a 0a20 2020 2020 2020  n names:.       
-0003d020: 2020 2020 2020 2020 2069 6620 6973 696e           if isin
-0003d030: 7374 616e 6365 286e 616d 6573 5b6e 616d  stance(names[nam
-0003d040: 655d 2c20 7374 7229 3a0a 2020 2020 2020  e], str):.      
-0003d050: 2020 2020 2020 2020 2020 2020 2020 6e61                na
-0003d060: 6d65 735b 6e61 6d65 5d20 3d20 5b6e 616d  mes[name] = [nam
-0003d070: 6573 5b6e 616d 655d 5d0a 0a20 2020 2020  es[name]]..     
-0003d080: 2020 2023 2045 7869 7420 6973 206e 616d     # Exit is nam
-0003d090: 6573 2069 736e 2774 2061 2064 6963 7469  es isn't a dicti
-0003d0a0: 6f6e 6172 792e 0a20 2020 2020 2020 2069  onary..        i
-0003d0b0: 6620 6e6f 7420 6973 696e 7374 616e 6365  f not isinstance
-0003d0c0: 286e 616d 6573 2c20 6469 6374 293a 0a20  (names, dict):. 
-0003d0d0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-0003d0e0: 6e20 4661 6c73 650a 0a20 2020 2020 2020  n False..       
-0003d0f0: 2023 2054 7279 2074 6f20 6d61 7463 6820   # Try to match 
-0003d100: 6561 6368 2052 4f49 206e 616d 6520 7769  each ROI name wi
-0003d110: 7468 206e 6f6d 696e 616c 206e 616d 6520  th nominal name 
-0003d120: 6f72 2061 6e79 2061 6c69 6173 6573 2e0a  or any aliases..
-0003d130: 2020 2020 2020 2020 666f 7220 6e61 6d65          for name
-0003d140: 2c20 616c 6961 7365 7320 696e 206e 616d  , aliases in nam
-0003d150: 6573 2e69 7465 6d73 2829 3a0a 2020 2020  es.items():.    
-0003d160: 2020 2020 2020 2020 6966 2069 6e63 6c75          if inclu
-0003d170: 6465 5f6b 6579 733a 0a20 2020 2020 2020  de_keys:.       
-0003d180: 2020 2020 2020 2020 206e 616d 6573 5f74           names_t
-0003d190: 6f5f 6d61 7463 6820 3d20 5b6e 616d 655d  o_match = [name]
-0003d1a0: 202b 2061 6c69 6173 6573 0a20 2020 2020   + aliases.     
-0003d1b0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-0003d1c0: 2020 2020 2020 2020 2020 2020 206e 616d               nam
-0003d1d0: 6573 5f74 6f5f 6d61 7463 6820 3d20 616c  es_to_match = al
-0003d1e0: 6961 7365 730a 2020 2020 2020 2020 2020  iases.          
-0003d1f0: 2020 666f 7220 6e61 6d65 5f74 6f5f 6d61    for name_to_ma
-0003d200: 7463 6820 696e 206e 616d 6573 5f74 6f5f  tch in names_to_
-0003d210: 6d61 7463 683a 0a20 2020 2020 2020 2020  match:.         
-0003d220: 2020 2020 2020 2066 6f72 2072 6f69 5f6e         for roi_n
-0003d230: 616d 6520 696e 2073 656c 662e 6765 745f  ame in self.get_
-0003d240: 726f 695f 6e61 6d65 7328 293a 0a20 2020  roi_names():.   
-0003d250: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003d260: 206d 6174 6368 203d 2066 6e6d 6174 6368   match = fnmatch
-0003d270: 2e66 6e6d 6174 6368 280a 2020 2020 2020  .fnmatch(.      
-0003d280: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003d290: 2020 2020 2020 726f 695f 6e61 6d65 2e6c        roi_name.l
-0003d2a0: 6f77 6572 2829 2c20 6e61 6d65 5f74 6f5f  ower(), name_to_
-0003d2b0: 6d61 7463 682e 6c6f 7765 7228 2929 0a20  match.lower()). 
-0003d2c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003d2d0: 2020 2069 6620 6d61 7463 683a 0a20 2020     if match:.   
-0003d2e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003d2f0: 2020 2020 2062 7265 616b 0a20 2020 2020       break.     
-0003d300: 2020 2020 2020 2020 2020 2069 6620 6d61             if ma
-0003d310: 7463 683a 0a20 2020 2020 2020 2020 2020  tch:.           
-0003d320: 2020 2020 2020 2020 2062 7265 616b 0a20           break. 
-0003d330: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
-0003d340: 7420 6d61 7463 683a 0a20 2020 2020 2020  t match:.       
-0003d350: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-0003d360: 4661 6c73 650a 0a20 2020 2020 2020 2072  False..        r
-0003d370: 6574 7572 6e20 5472 7565 0a0a 2020 2020  eturn True..    
-0003d380: 6465 6620 7265 6e61 6d65 5f72 6f69 7328  def rename_rois(
-0003d390: 0a20 2020 2020 2020 2073 656c 662c 206e  .        self, n
-0003d3a0: 616d 6573 3d4e 6f6e 652c 2066 6972 7374  ames=None, first
-0003d3b0: 5f6d 6174 6368 5f6f 6e6c 793d 5472 7565  _match_only=True
-0003d3c0: 2c20 6b65 6570 5f72 656e 616d 6564 5f6f  , keep_renamed_o
-0003d3d0: 6e6c 793d 4661 6c73 650a 2020 2020 293a  nly=False.    ):
-0003d3e0: 0a20 2020 2020 2020 2022 2222 5265 6e61  .        """Rena
-0003d3f0: 6d65 2052 4f49 7320 696e 2074 6869 7320  me ROIs in this 
-0003d400: 5374 7275 6374 7572 6553 6574 2e0a 2020  StructureSet..  
-0003d410: 2020 2020 2020 3c66 6972 7374 5f6d 6174        <first_mat
-0003d420: 6368 5f6f 6e6c 793e 2069 7320 5472 7565  ch_only> is True
-0003d430: 2c20 6f6e 6c79 2074 6865 2066 6972 7374  , only the first
-0003d440: 2052 4f49 206d 6174 6368 696e 6720 7468   ROI matching th
-0003d450: 650a 2020 2020 2020 2020 706f 7373 6962  e.        possib
-0003d460: 6c65 206d 6174 6368 6573 2077 696c 6c20  le matches will 
-0003d470: 6265 2072 656e 616d 6564 2e0a 0a20 2020  be renamed...   
-0003d480: 2020 2020 202a 2a50 6172 616d 6574 6572       **Parameter
-0003d490: 733a 2a2a 0a20 2020 2020 2020 200a 2020  s:**.        .  
-0003d4a0: 2020 2020 2020 6e61 6d65 7320 3a20 6469        names : di
-0003d4b0: 6374 2c20 6465 6661 756c 743d 4e6f 6e65  ct, default=None
-0003d4c0: 0a20 2020 2020 2020 2020 2020 2044 6963  .            Dic
-0003d4d0: 7469 6f6e 6172 7920 6f66 206e 616d 6573  tionary of names
-0003d4e0: 2066 6f72 2072 656e 616d 696e 6720 524f   for renaming RO
-0003d4f0: 4973 2c20 7768 6572 6520 7468 6520 6b65  Is, where the ke
-0003d500: 7973 2061 7265 206e 6577 200a 2020 2020  ys are new .    
-0003d510: 2020 2020 2020 2020 6e61 6d65 7320 616e          names an
-0003d520: 6420 7661 6c75 6573 2061 7265 206c 6973  d values are lis
-0003d530: 7473 206f 6620 706f 7373 6962 6c65 206e  ts of possible n
-0003d540: 616d 6573 206f 6620 524f 4973 2074 6861  ames of ROIs tha
-0003d550: 7420 7368 6f75 6c64 0a20 2020 2020 2020  t should.       
-0003d560: 2020 2020 2062 6520 6173 7369 676e 6564       be assigned
-0003d570: 2074 6865 206e 6577 206e 616d 652e 2054   the new name. T
-0003d580: 6865 7365 206e 616d 6573 2063 616e 2061  hese names can a
-0003d590: 6c73 6f20 636f 6e74 6169 6e20 7769 6c64  lso contain wild
-0003d5a0: 6361 7264 730a 2020 2020 2020 2020 2020  cards.          
-0003d5b0: 2020 7769 7468 2074 6865 2027 2a27 2073    with the '*' s
-0003d5c0: 796d 626f 6c2e 0a0a 2020 2020 2020 2020  ymbol...        
-0003d5d0: 6669 7273 745f 6d61 7463 685f 6f6e 6c79  first_match_only
-0003d5e0: 203a 2062 6f6f 6c2c 2064 6566 6175 6c74   : bool, default
-0003d5f0: 3d54 7275 650a 2020 2020 2020 2020 2020  =True.          
-0003d600: 2020 4966 2054 7275 652c 206f 6e6c 7920    If True, only 
-0003d610: 7468 6520 6669 7273 7420 524f 4920 6d61  the first ROI ma
-0003d620: 7463 6869 6e67 2074 6865 2070 6f73 7369  tching the possi
-0003d630: 626c 6520 6e61 6d65 7320 696e 2074 6865  ble names in the
-0003d640: 200a 2020 2020 2020 2020 2020 2020 7661   .            va
-0003d650: 6c75 6573 206f 6620 3c6e 616d 6573 3e20  lues of <names> 
-0003d660: 7769 6c6c 2062 6520 7265 6e61 6d65 643b  will be renamed;
-0003d670: 2074 6869 7320 7072 6576 656e 7473 206e   this prevents n
-0003d680: 616d 6520 6475 706c 6963 6174 696f 6e0a  ame duplication.
-0003d690: 2020 2020 2020 2020 2020 2020 6966 206d              if m
-0003d6a0: 756c 7469 706c 6520 524f 4973 2069 6e20  ultiple ROIs in 
-0003d6b0: 7468 6520 5374 7275 6374 7572 6553 6574  the StructureSet
-0003d6c0: 2061 7265 2061 206d 6174 6368 2e0a 0a20   are a match... 
-0003d6d0: 2020 2020 2020 206b 6565 705f 7265 6e61         keep_rena
-0003d6e0: 6d65 645f 6f6e 6c79 203a 2062 6f6f 6c2c  med_only : bool,
-0003d6f0: 2064 6566 6175 6c74 3d46 616c 7365 0a20   default=False. 
-0003d700: 2020 2020 2020 2020 2020 2049 6620 5472             If Tr
-0003d710: 7565 2c20 616e 7920 524f 4973 2074 6861  ue, any ROIs tha
-0003d720: 7420 646f 206e 6f74 2067 6574 2072 656e  t do not get ren
-0003d730: 616d 6564 2077 696c 6c20 6265 2072 656d  amed will be rem
-0003d740: 6f76 6564 2066 726f 6d0a 2020 2020 2020  oved from.      
-0003d750: 2020 2020 2020 7468 6520 5374 7275 6374        the Struct
-0003d760: 7572 6553 6574 2e0a 2020 2020 2020 2020  ureSet..        
-0003d770: 2222 220a 0a20 2020 2020 2020 2069 6620  """..        if 
-0003d780: 6e61 6d65 7320 6973 204e 6f6e 653a 0a20  names is None:. 
-0003d790: 2020 2020 2020 2020 2020 206e 616d 6573             names
-0003d7a0: 203d 2073 656c 662e 6e61 6d65 730a 2020   = self.names.  
-0003d7b0: 2020 2020 2020 6966 206e 6f74 206e 616d        if not nam
-0003d7c0: 6573 206f 7220 6e6f 7420 6973 696e 7374  es or not isinst
-0003d7d0: 616e 6365 286e 616d 6573 2c20 6469 6374  ance(names, dict
-0003d7e0: 293a 0a20 2020 2020 2020 2020 2020 2072  ):.            r
-0003d7f0: 6574 7572 6e0a 0a20 2020 2020 2020 2023  eturn..        #
-0003d800: 204c 6f6f 7020 7468 726f 7567 6820 6561   Loop through ea
-0003d810: 6368 206e 6577 206e 616d 650a 2020 2020  ch new name.    
-0003d820: 2020 2020 616c 7265 6164 795f 7265 6e61      already_rena
-0003d830: 6d65 6420 3d20 5b5d 0a20 2020 2020 2020  med = [].       
-0003d840: 2066 6f72 206e 616d 652c 206d 6174 6368   for name, match
-0003d850: 6573 2069 6e20 6e61 6d65 732e 6974 656d  es in names.item
-0003d860: 7328 293a 0a0a 2020 2020 2020 2020 2020  s():..          
-0003d870: 2020 6966 206e 6f74 2073 6b72 742e 636f    if not skrt.co
-0003d880: 7265 2e69 735f 6c69 7374 286d 6174 6368  re.is_list(match
-0003d890: 6573 293a 0a20 2020 2020 2020 2020 2020  es):.           
-0003d8a0: 2020 2020 206d 6174 6368 6573 203d 205b       matches = [
-0003d8b0: 6d61 7463 6865 735d 0a0a 2020 2020 2020  matches]..      
-0003d8c0: 2020 2020 2020 2320 4c6f 6f70 2074 6872        # Loop thr
-0003d8d0: 6f75 6768 2061 6c6c 2070 6f73 7369 626c  ough all possibl
-0003d8e0: 6520 6f72 6967 696e 616c 206e 616d 6573  e original names
-0003d8f0: 0a20 2020 2020 2020 2020 2020 206e 616d  .            nam
-0003d900: 655f 6d61 7463 6865 6420 3d20 4661 6c73  e_matched = Fals
-0003d910: 650a 2020 2020 2020 2020 2020 2020 666f  e.            fo
-0003d920: 7220 6d20 696e 206d 6174 6368 6573 3a0a  r m in matches:.
-0003d930: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0003d940: 2023 204c 6f6f 7020 7468 726f 7567 6820   # Loop through 
-0003d950: 524f 4973 2061 6e64 2073 6565 2069 6620  ROIs and see if 
-0003d960: 7468 6572 6527 7320 6120 6d61 7463 680a  there's a match.
-0003d970: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003d980: 666f 7220 692c 2073 2069 6e20 656e 756d  for i, s in enum
-0003d990: 6572 6174 6528 7365 6c66 2e67 6574 5f72  erate(self.get_r
-0003d9a0: 6f69 7328 2929 3a0a 0a20 2020 2020 2020  ois()):..       
-0003d9b0: 2020 2020 2020 2020 2020 2020 2023 2044               # D
-0003d9c0: 6f6e 2774 2072 656e 616d 6520 616e 2052  on't rename an R
-0003d9d0: 4f49 206d 6f72 6520 7468 616e 206f 6e63  OI more than onc
-0003d9e0: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
-0003d9f0: 2020 2020 2020 6966 2069 2069 6e20 616c        if i in al
-0003da00: 7265 6164 795f 7265 6e61 6d65 643a 0a20  ready_renamed:. 
-0003da10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003da20: 2020 2020 2020 2063 6f6e 7469 6e75 650a         continue.
-0003da30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0003da40: 2020 2020 2069 6620 666e 6d61 7463 682e       if fnmatch.
-0003da50: 666e 6d61 7463 6828 732e 6e61 6d65 2e6c  fnmatch(s.name.l
-0003da60: 6f77 6572 2829 2c20 6d2e 6c6f 7765 7228  ower(), m.lower(
-0003da70: 2929 3a0a 2020 2020 2020 2020 2020 2020  )):.            
-0003da80: 2020 2020 2020 2020 2020 2020 732e 6e61              s.na
-0003da90: 6d65 203d 206e 616d 650a 2020 2020 2020  me = name.      
-0003daa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003dab0: 2020 6e61 6d65 5f6d 6174 6368 6564 203d    name_matched =
-0003dac0: 2054 7275 650a 2020 2020 2020 2020 2020   True.          
-0003dad0: 2020 2020 2020 2020 2020 2020 2020 616c                al
-0003dae0: 7265 6164 795f 7265 6e61 6d65 642e 6170  ready_renamed.ap
-0003daf0: 7065 6e64 2869 290a 2020 2020 2020 2020  pend(i).        
-0003db00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003db10: 6966 2066 6972 7374 5f6d 6174 6368 5f6f  if first_match_o
-0003db20: 6e6c 793a 0a20 2020 2020 2020 2020 2020  nly:.           
-0003db30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003db40: 2062 7265 616b 0a0a 2020 2020 2020 2020   break..        
-0003db50: 2020 2020 2020 2020 2320 4966 2066 6972          # If fir
-0003db60: 7374 5f6d 6174 6368 5f6f 6e6c 792c 2064  st_match_only, d
-0003db70: 6f6e 2774 2072 656e 616d 6520 6d6f 7265  on't rename more
-0003db80: 2074 6861 6e20 6f6e 6520 524f 490a 2020   than one ROI.  
-0003db90: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-0003dba0: 7769 7468 2074 6869 7320 6e65 7720 6e61  with this new na
-0003dbb0: 6d65 0a20 2020 2020 2020 2020 2020 2020  me.             
-0003dbc0: 2020 2069 6620 6e61 6d65 5f6d 6174 6368     if name_match
-0003dbd0: 6564 2061 6e64 2066 6972 7374 5f6d 6174  ed and first_mat
-0003dbe0: 6368 5f6f 6e6c 793a 0a20 2020 2020 2020  ch_only:.       
-0003dbf0: 2020 2020 2020 2020 2020 2020 2062 7265               bre
-0003dc00: 616b 0a0a 2020 2020 2020 2020 2320 4b65  ak..        # Ke
-0003dc10: 6570 206f 6e6c 7920 7468 6520 7265 6e61  ep only the rena
-0003dc20: 6d65 6420 524f 4973 2069 6620 7265 7175  med ROIs if requ
-0003dc30: 6573 7465 640a 2020 2020 2020 2020 6966  ested.        if
-0003dc40: 206b 6565 705f 7265 6e61 6d65 645f 6f6e   keep_renamed_on
-0003dc50: 6c79 3a0a 2020 2020 2020 2020 2020 2020  ly:.            
-0003dc60: 7265 6e61 6d65 645f 726f 6973 203d 205b  renamed_rois = [
-0003dc70: 7365 6c66 2e72 6f69 735b 695d 2066 6f72  self.rois[i] for
-0003dc80: 2069 2069 6e20 616c 7265 6164 795f 7265   i in already_re
-0003dc90: 6e61 6d65 645d 0a20 2020 2020 2020 2020  named].         
-0003dca0: 2020 2073 656c 662e 726f 6973 203d 2072     self.rois = r
-0003dcb0: 656e 616d 6564 5f72 6f69 730a 0a20 2020  enamed_rois..   
-0003dcc0: 2064 6566 2066 696c 7465 725f 726f 6973   def filter_rois
-0003dcd0: 2873 656c 662c 2074 6f5f 6b65 6570 3d4e  (self, to_keep=N
-0003dce0: 6f6e 652c 2074 6f5f 7265 6d6f 7665 3d4e  one, to_remove=N
-0003dcf0: 6f6e 6529 3a0a 2020 2020 2020 2020 2222  one):.        ""
-0003dd00: 224b 6565 7020 6f6e 6c79 2074 6865 2052  "Keep only the R
-0003dd10: 4f49 7320 696e 2074 6865 2074 6f5f 6b65  OIs in the to_ke
-0003dd20: 6570 206c 6973 7420 616e 6420 7265 6d6f  ep list and remo
-0003dd30: 7665 2061 6e79 2069 6e20 7468 650a 2020  ve any in the.  
-0003dd40: 2020 2020 2020 746f 5f72 656d 6f76 6520        to_remove 
-0003dd50: 6c69 7374 2e0a 0a20 2020 2020 2020 202a  list...        *
-0003dd60: 2a50 6172 616d 6574 6572 733a 2a2a 0a20  *Parameters:**. 
-0003dd70: 2020 2020 2020 200a 0a20 2020 2020 2020         ..       
-0003dd80: 2074 6f5f 6b65 6570 203a 206c 6973 742c   to_keep : list,
-0003dd90: 2064 6566 6175 6c74 3d4e 6f6e 650a 2020   default=None.  
-0003dda0: 2020 2020 2020 2020 2020 4c69 7374 206f            List o
-0003ddb0: 6620 6e61 6d65 7320 6f66 2052 4f49 7320  f names of ROIs 
-0003ddc0: 746f 206b 6565 7020 696e 2074 6865 2063  to keep in the c
-0003ddd0: 6f70 6965 6420 5374 7275 6374 7572 6553  opied StructureS
-0003dde0: 6574 3b20 616c 6c20 0a20 2020 2020 2020  et; all .       
-0003ddf0: 2020 2020 206f 7468 6572 7320 7769 6c6c       others will
-0003de00: 2062 6520 7265 6d6f 7665 642e 2054 6865   be removed. The
-0003de10: 7365 206e 616d 6573 2063 616e 2061 6c73  se names can als
-0003de20: 6f20 636f 6e74 6169 6e20 7769 6c64 6361  o contain wildca
-0003de30: 7264 730a 2020 2020 2020 2020 2020 2020  rds.            
-0003de40: 7769 7468 2074 6865 2027 2a27 2073 796d  with the '*' sym
-0003de50: 626f 6c2e 200a 0a20 2020 2020 2020 2074  bol. ..        t
-0003de60: 6f5f 7265 6d6f 7665 203a 206c 6973 742c  o_remove : list,
-0003de70: 2064 6566 6175 6c74 3d4e 6f6e 650a 2020   default=None.  
-0003de80: 2020 2020 2020 2020 2020 4c69 7374 206f            List o
-0003de90: 6620 6e61 6d65 7320 6f66 2052 4f49 7320  f names of ROIs 
-0003dea0: 746f 2072 656d 6f76 6520 6672 6f6d 2074  to remove from t
-0003deb0: 6865 2063 6f70 6965 6420 5374 7275 6374  he copied Struct
-0003dec0: 7572 6553 6574 3b20 616c 6c20 0a20 2020  ureSet; all .   
-0003ded0: 2020 2020 2020 2020 206f 7468 6572 7320           others 
-0003dee0: 7769 6c6c 2062 6520 7265 6d6f 7665 642e  will be removed.
-0003def0: 2054 6865 7365 206e 616d 6573 2063 616e   These names can
-0003df00: 2061 6c73 6f20 636f 6e74 6169 6e20 7769   also contain wi
-0003df10: 6c64 6361 7264 730a 2020 2020 2020 2020  ldcards.        
-0003df20: 2020 2020 7769 7468 2074 6865 2027 2a27      with the '*'
-0003df30: 2073 796d 626f 6c2e 2041 7070 6c69 6564   symbol. Applied
-0003df40: 2061 6674 6572 2066 696c 7465 7269 6e67   after filtering
-0003df50: 2077 6974 6820 3c74 6f5f 6b65 6570 3e2e   with <to_keep>.
-0003df60: 0a20 2020 2020 2020 2022 2222 0a0a 2020  .        """..  
-0003df70: 2020 2020 2020 2320 456e 7375 7265 2074        # Ensure t
-0003df80: 6f5f 6b65 6570 2061 6e64 2074 6f5f 7265  o_keep and to_re
-0003df90: 6d6f 7665 2061 7265 206c 6973 7473 0a20  move are lists. 
-0003dfa0: 2020 2020 2020 2069 6620 746f 5f6b 6565         if to_kee
-0003dfb0: 7020 6973 204e 6f6e 653a 0a20 2020 2020  p is None:.     
-0003dfc0: 2020 2020 2020 2074 6f5f 6b65 6570 203d         to_keep =
-0003dfd0: 2073 656c 662e 746f 5f6b 6565 700a 2020   self.to_keep.  
-0003dfe0: 2020 2020 2020 656c 6966 206e 6f74 2073        elif not s
-0003dff0: 6b72 742e 636f 7265 2e69 735f 6c69 7374  krt.core.is_list
-0003e000: 2874 6f5f 6b65 6570 293a 0a20 2020 2020  (to_keep):.     
-0003e010: 2020 2020 2020 2074 6f5f 6b65 6570 203d         to_keep =
-0003e020: 205b 746f 5f6b 6565 705d 0a20 2020 2020   [to_keep].     
-0003e030: 2020 2069 6620 746f 5f72 656d 6f76 6520     if to_remove 
-0003e040: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
-0003e050: 2020 2020 2074 6f5f 7265 6d6f 7665 203d       to_remove =
-0003e060: 2073 656c 662e 746f 5f72 656d 6f76 650a   self.to_remove.
-0003e070: 2020 2020 2020 2020 656c 6966 206e 6f74          elif not
-0003e080: 2073 6b72 742e 636f 7265 2e69 735f 6c69   skrt.core.is_li
-0003e090: 7374 2874 6f5f 7265 6d6f 7665 293a 0a20  st(to_remove):. 
-0003e0a0: 2020 2020 2020 2020 2020 2074 6f5f 7265             to_re
-0003e0b0: 6d6f 7665 203d 205b 746f 5f72 656d 6f76  move = [to_remov
-0003e0c0: 655d 0a0a 2020 2020 2020 2020 2320 4b65  e]..        # Ke
-0003e0d0: 6570 206f 6e6c 7920 7468 6520 524f 4973  ep only the ROIs
-0003e0e0: 2069 6e20 746f 5f6b 6565 700a 2020 2020   in to_keep.    
-0003e0f0: 2020 2020 7365 6c66 2e6c 6f61 6428 290a      self.load().
-0003e100: 2020 2020 2020 2020 6966 2074 6f5f 6b65          if to_ke
-0003e110: 6570 2069 7320 6e6f 7420 4e6f 6e65 3a0a  ep is not None:.
-0003e120: 2020 2020 2020 2020 2020 2020 6b65 6570              keep
-0003e130: 203d 205b 5d0a 2020 2020 2020 2020 2020   = [].          
-0003e140: 2020 666f 7220 726f 6920 696e 2073 656c    for roi in sel
-0003e150: 662e 726f 6973 3a0a 2020 2020 2020 2020  f.rois:.        
-0003e160: 2020 2020 2020 2020 6966 2061 6e79 285b          if any([
-0003e170: 666e 6d61 7463 682e 666e 6d61 7463 6828  fnmatch.fnmatch(
-0003e180: 726f 692e 6e61 6d65 2e6c 6f77 6572 2829  roi.name.lower()
-0003e190: 2c20 6b2e 6c6f 7765 7228 2929 200a 2020  , k.lower()) .  
-0003e1a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003e1b0: 2020 2020 2020 666f 7220 6b20 696e 2074        for k in t
-0003e1c0: 6f5f 6b65 6570 5d29 3a0a 2020 2020 2020  o_keep]):.      
-0003e1d0: 2020 2020 2020 2020 2020 2020 2020 6b65                ke
-0003e1e0: 6570 2e61 7070 656e 6428 726f 6929 0a20  ep.append(roi). 
-0003e1f0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0003e200: 726f 6973 203d 206b 6565 700a 0a20 2020  rois = keep..   
-0003e210: 2020 2020 2023 2052 656d 6f76 6520 7468       # Remove th
-0003e220: 6520 524f 4973 2069 6e20 746f 5f72 656d  e ROIs in to_rem
-0003e230: 6f76 650a 2020 2020 2020 2020 6966 2074  ove.        if t
-0003e240: 6f5f 7265 6d6f 7665 2069 7320 6e6f 7420  o_remove is not 
-0003e250: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-0003e260: 2020 6b65 6570 203d 205b 5d0a 2020 2020    keep = [].    
-0003e270: 2020 2020 2020 2020 666f 7220 726f 6920          for roi 
-0003e280: 696e 2073 656c 662e 726f 6973 3a0a 2020  in self.rois:.  
-0003e290: 2020 2020 2020 2020 2020 2020 2020 6966                if
-0003e2a0: 206e 6f74 2061 6e79 280a 2020 2020 2020   not any(.      
-0003e2b0: 2020 2020 2020 2020 2020 2020 2020 5b66                [f
-0003e2c0: 6e6d 6174 6368 2e66 6e6d 6174 6368 2872  nmatch.fnmatch(r
-0003e2d0: 6f69 2e6e 616d 652e 6c6f 7765 7228 292c  oi.name.lower(),
-0003e2e0: 2072 2e6c 6f77 6572 2829 2920 0a20 2020   r.lower()) .   
-0003e2f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003e300: 2020 666f 7220 7220 696e 2074 6f5f 7265    for r in to_re
-0003e310: 6d6f 7665 5d0a 2020 2020 2020 2020 2020  move].          
-0003e320: 2020 2020 2020 293a 0a20 2020 2020 2020        ):.       
-0003e330: 2020 2020 2020 2020 2020 2020 206b 6565               kee
-0003e340: 702e 6170 7065 6e64 2872 6f69 290a 2020  p.append(roi).  
-0003e350: 2020 2020 2020 2020 2020 7365 6c66 2e72            self.r
-0003e360: 6f69 7320 3d20 6b65 6570 0a0a 2020 2020  ois = keep..    
-0003e370: 6465 6620 7365 745f 616c 7068 615f 6265  def set_alpha_be
-0003e380: 7461 5f72 6174 696f 7328 0a20 2020 2020  ta_ratios(.     
-0003e390: 2020 2020 2020 2073 656c 662c 2061 6c70         self, alp
-0003e3a0: 6861 5f62 6574 615f 7261 7469 6f73 3d4e  ha_beta_ratios=N
-0003e3b0: 6f6e 652c 2073 6574 5f61 735f 6465 6661  one, set_as_defa
-0003e3c0: 756c 743d 5472 7565 293a 0a20 2020 2020  ult=True):.     
-0003e3d0: 2020 2022 2222 0a20 2020 2020 2020 2053     """.        S
-0003e3e0: 6574 2072 6174 696f 7320 666f 7220 524f  et ratios for RO
-0003e3f0: 4920 7469 7373 7565 7320 6f66 2063 6f65  I tissues of coe
-0003e400: 6666 6963 6965 6e74 7320 6f66 206c 696e  fficients of lin
-0003e410: 6561 722d 7175 6164 7261 7469 6320 6571  ear-quadratic eq
-0003e420: 7561 7469 6f6e 2e0a 0a20 2020 2020 2020  uation...       
-0003e430: 204f 7074 696f 6e61 6c6c 7920 696e 7075   Optionally inpu
-0003e440: 7420 7661 6c75 6573 2066 6f72 2072 6174  t values for rat
-0003e450: 696f 7320 6173 2073 7472 7563 7475 7265  ios as structure
-0003e460: 2d73 6574 2064 6566 6175 6c74 2e0a 0a20  -set default... 
-0003e470: 2020 2020 2020 202a 2a50 6172 616d 6574         **Paramet
-0003e480: 6572 3a2a 2a0a 0a20 2020 2020 2020 2061  er:**..        a
-0003e490: 6c70 6861 5f62 6574 615f 7261 7469 6f73  lpha_beta_ratios
-0003e4a0: 203a 2064 6963 742c 2064 6566 6175 6c74   : dict, default
-0003e4b0: 3d4e 6f6e 650a 2020 2020 2020 2020 2020  =None.          
-0003e4c0: 2020 4469 6374 696f 6e61 7279 2077 6865    Dictionary whe
-0003e4d0: 7265 206b 6579 7320 6172 6520 524f 4920  re keys are ROI 
-0003e4e0: 6e61 6d65 7320 616e 6420 7661 6c75 6573  names and values
-0003e4f0: 2061 7265 0a20 2020 2020 2020 2020 2020   are.           
-0003e500: 2072 6174 696f 7320 666f 7220 524f 4920   ratios for ROI 
-0003e510: 7469 7373 7565 7320 6f66 2063 6f65 6666  tissues of coeff
-0003e520: 6963 6965 6e74 732c 2061 6c70 6861 2c20  icients, alpha, 
-0003e530: 6265 7461 2c0a 2020 2020 2020 2020 2020  beta,.          
-0003e540: 2020 696e 2074 6865 206c 696e 6561 722d    in the linear-
-0003e550: 7175 6164 7261 7469 6320 6571 7561 7469  quadratic equati
-0003e560: 6f6e 2e20 2054 6865 7365 2072 6174 696f  on.  These ratio
-0003e570: 7320 6172 650a 2020 2020 2020 2020 2020  s are.          
-0003e580: 2020 7573 6564 2069 6e20 6361 6c63 756c    used in calcul
-0003e590: 6174 696e 6720 6269 6f6c 6f67 6963 616c  ating biological
-0003e5a0: 6c79 2065 6666 6563 7469 7665 2064 6f73  ly effective dos
-0003e5b0: 652c 2042 4544 2c20 6672 6f6d 0a20 2020  e, BED, from.   
-0003e5c0: 2020 2020 2020 2020 2070 6879 7369 6361           physica
-0003e5d0: 6c20 646f 7365 2c20 442c 2064 656c 6976  l dose, D, deliv
-0003e5e0: 6572 6564 206f 7665 7220 6e20 6571 7561  ered over n equa
-0003e5f0: 6c20 6672 6163 7469 6f6e 733a 0a20 2020  l fractions:.   
-0003e600: 2020 2020 2020 2020 2020 2020 2042 4544               BED
-0003e610: 203d 2044 202a 2028 3120 2b20 2844 2f6e   = D * (1 + (D/n
-0003e620: 2920 2f20 2861 6c70 6861 2f62 6574 6129  ) / (alpha/beta)
-0003e630: 292e 0a20 2020 2020 2020 2020 2020 2054  )..            T
-0003e640: 6865 2061 7474 7269 6275 7465 2061 6c70  he attribute alp
-0003e650: 6861 5f6f 7665 725f 7661 6c75 6520 6973  ha_over_value is
-0003e660: 2073 6574 2074 6f20 7468 6520 6469 6374   set to the dict
-0003e670: 696f 6e61 7279 2076 616c 7565 0a20 2020  ionary value.   
-0003e680: 2020 2020 2020 2020 2066 6f72 2061 6e20           for an 
-0003e690: 524f 4920 6964 656e 7469 6669 6564 2062  ROI identified b
-0003e6a0: 7920 6120 6b65 792c 206f 7220 6973 2073  y a key, or is s
-0003e6b0: 6574 2074 6f20 4e6f 6e65 2066 6f72 2061  et to None for a
-0003e6c0: 6e79 0a20 2020 2020 2020 2020 2020 206f  ny.            o
-0003e6d0: 7468 6572 2052 4f49 732e 2020 4966 2074  ther ROIs.  If t
-0003e6e0: 6869 7320 7061 7261 6d65 7465 7220 6973  his parameter is
-0003e6f0: 2073 6574 2074 6f20 4e6f 6e65 2c20 7661   set to None, va
-0003e700: 6c75 6573 2061 7265 2073 6574 0a20 2020  lues are set.   
-0003e710: 2020 2020 2020 2020 2066 726f 6d20 7365           from se
-0003e720: 6c66 2e61 6c70 6861 5f62 6574 615f 7261  lf.alpha_beta_ra
-0003e730: 7469 6f73 2e0a 0a20 2020 2020 2020 2073  tios...        s
-0003e740: 6574 5f61 735f 6465 6661 756c 7420 3a20  et_as_default : 
-0003e750: 626f 6f6c 2c20 6465 6661 756c 743d 5472  bool, default=Tr
-0003e760: 7565 0a20 2020 2020 2020 2020 2020 2049  ue.            I
-0003e770: 6620 5472 7565 2c20 616e 6420 616c 7068  f True, and alph
-0003e780: 615f 6265 7461 5f72 6174 696f 7320 6973  a_beta_ratios is
-0003e790: 6e27 7420 4e6f 6e65 2c20 7365 740a 2020  n't None, set.  
-0003e7a0: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
-0003e7b0: 6c70 6861 5f62 6574 615f 7261 7469 6f73  lpha_beta_ratios
-0003e7c0: 2074 6f20 7468 6520 7661 6c75 6520 6f66   to the value of
-0003e7d0: 2061 6c70 6861 5f62 6574 615f 7261 7469   alpha_beta_rati
-0003e7e0: 6f73 2e0a 2020 2020 2020 2020 2222 220a  os..        """.
-0003e7f0: 2020 2020 2020 2020 6966 2061 6c70 6861          if alpha
-0003e800: 5f62 6574 615f 7261 7469 6f73 2069 7320  _beta_ratios is 
-0003e810: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-0003e820: 2020 616c 7068 615f 6265 7461 5f72 6174    alpha_beta_rat
-0003e830: 696f 7320 3d20 7365 6c66 2e61 6c70 6861  ios = self.alpha
-0003e840: 5f62 6574 615f 7261 7469 6f73 0a20 2020  _beta_ratios.   
-0003e850: 2020 2020 2065 6c69 6620 7365 745f 6173       elif set_as
-0003e860: 5f64 6566 6175 6c74 3a0a 2020 2020 2020  _default:.      
-0003e870: 2020 2020 2020 7365 6c66 2e61 6c70 6861        self.alpha
-0003e880: 5f62 6574 615f 7261 7469 6f73 203d 2061  _beta_ratios = a
-0003e890: 6c70 6861 5f62 6574 615f 7261 7469 6f73  lpha_beta_ratios
-0003e8a0: 0a0a 2020 2020 2020 2020 666f 7220 726f  ..        for ro
-0003e8b0: 6920 696e 2073 656c 662e 6765 745f 726f  i in self.get_ro
-0003e8c0: 6973 2829 3a0a 2020 2020 2020 2020 2020  is():.          
-0003e8d0: 2020 726f 692e 7365 745f 616c 7068 615f    roi.set_alpha_
-0003e8e0: 6f76 6572 5f62 6574 6128 616c 7068 615f  over_beta(alpha_
-0003e8f0: 6265 7461 5f72 6174 696f 732e 6765 7428  beta_ratios.get(
-0003e900: 726f 692e 6e61 6d65 2c20 4e6f 6e65 2929  roi.name, None))
-0003e910: 0a0a 2020 2020 6465 6620 6765 745f 616c  ..    def get_al
-0003e920: 7068 615f 6265 7461 5f72 6174 696f 7328  pha_beta_ratios(
-0003e930: 7365 6c66 293a 0a20 2020 2020 2020 2022  self):.        "
-0003e940: 2222 0a20 2020 2020 2020 2047 6574 2064  "".        Get d
-0003e950: 6963 7469 6f6e 6172 7920 6f66 2072 6174  ictionary of rat
-0003e960: 696f 206f 6620 636f 6566 6669 6369 656e  io of coefficien
-0003e970: 7473 206f 6620 6c69 6e65 6172 2d71 7561  ts of linear-qua
-0003e980: 6472 6174 6963 2065 7175 6174 696f 6e2e  dratic equation.
-0003e990: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-0003e9a0: 2020 2020 2072 6574 7572 6e20 7b72 6f69       return {roi
-0003e9b0: 5f6e 616d 6520 3a20 7365 6c66 5b72 6f69  _name : self[roi
-0003e9c0: 5f6e 616d 655d 2e67 6574 5f61 6c70 6861  _name].get_alpha
-0003e9d0: 5f6f 7665 725f 6265 7461 2829 0a20 2020  _over_beta().   
-0003e9e0: 2020 2020 2020 2020 2020 2020 2066 6f72               for
-0003e9f0: 2072 6f69 5f6e 616d 6520 696e 2073 6f72   roi_name in sor
-0003ea00: 7465 6428 7365 6c66 2e67 6574 5f72 6f69  ted(self.get_roi
-0003ea10: 5f6e 616d 6573 2829 297d 0a0a 2020 2020  _names())}..    
-0003ea20: 6465 6620 6765 745f 636f 6c6f 7273 2873  def get_colors(s
-0003ea30: 656c 6629 3a0a 2020 2020 2020 2020 2222  elf):.        ""
-0003ea40: 2247 6574 2064 6963 7420 6f66 2052 4f49  "Get dict of ROI
-0003ea50: 2063 6f6c 6f72 7320 666f 7220 6561 6368   colors for each
-0003ea60: 206e 616d 652e 2222 220a 0a20 2020 2020   name."""..     
-0003ea70: 2020 2072 6574 7572 6e20 7b72 6f69 2e6e     return {roi.n
-0003ea80: 616d 653a 2072 6f69 2e63 6f6c 6f72 2066  ame: roi.color f
-0003ea90: 6f72 2072 6f69 2069 6e20 7365 6c66 2e67  or roi in self.g
-0003eaa0: 6574 5f72 6f69 7328 297d 0a0a 2020 2020  et_rois()}..    
-0003eab0: 6465 6620 7265 636f 6c6f 725f 726f 6973  def recolor_rois
-0003eac0: 2873 656c 662c 2063 6f6c 6f72 7329 3a0a  (self, colors):.
-0003ead0: 2020 2020 2020 2020 2222 2253 6574 2063          """Set c
-0003eae0: 6f6c 6f72 7320 6f66 2052 4f49 7320 7573  olors of ROIs us
-0003eaf0: 696e 6720 6120 6c69 7374 206f 7220 6469  ing a list or di
-0003eb00: 6374 2067 6976 656e 2069 6e20 3c63 6f6c  ct given in <col
-0003eb10: 6f72 733e 2e0a 0a20 2020 2020 2020 202a  ors>...        *
-0003eb20: 2a50 6172 616d 6574 6572 732a 2a3a 0a0a  *Parameters**:..
-0003eb30: 2020 2020 2020 2020 636f 6c6f 7273 203a          colors :
-0003eb40: 206c 6973 742f 6469 6374 0a20 2020 2020   list/dict.     
-0003eb50: 2020 2020 2020 204c 6973 7420 6f72 2064         List or d
-0003eb60: 6963 7420 6f66 2063 6f6c 6f72 732e 2049  ict of colors. I
-0003eb70: 6620 6120 6469 6374 2c20 7468 6520 6b65  f a dict, the ke
-0003eb80: 7973 2073 686f 756c 6420 6265 2052 4f49  ys should be ROI
-0003eb90: 206e 616d 6573 206f 720a 2020 2020 2020   names or.      
-0003eba0: 2020 2020 2020 7769 6c64 6361 7264 7320        wildcards 
-0003ebb0: 6d61 7463 6869 6e67 2052 4f49 206e 616d  matching ROI nam
-0003ebc0: 6573 2c20 616e 6420 7468 6520 7661 6c75  es, and the valu
-0003ebd0: 6573 2073 686f 756c 6420 6265 2064 6573  es should be des
-0003ebe0: 6972 6564 200a 2020 2020 2020 2020 2020  ired .          
-0003ebf0: 2020 636f 6c6f 7273 2066 6f72 2052 4f49    colors for ROI
-0003ec00: 7320 6d61 7463 6869 6e67 2074 6861 7420  s matching that 
-0003ec10: 6e61 6d65 2e20 4966 2061 206c 6973 742c  name. If a list,
-0003ec20: 2073 686f 756c 6420 636f 6e74 6169 6e0a   should contain.
-0003ec30: 2020 2020 2020 2020 2020 2020 636f 6c6f              colo
-0003ec40: 7273 2077 6869 6368 2077 696c 6c20 6265  rs which will be
-0003ec50: 2061 7070 6c69 6564 2074 6f20 6c6f 6164   applied to load
-0003ec60: 6564 2052 4f49 7320 696e 206f 7264 6572  ed ROIs in order
-0003ec70: 2e0a 2020 2020 2020 2020 2222 220a 0a20  ..        """.. 
-0003ec80: 2020 2020 2020 2069 6620 636f 6c6f 7273         if colors
-0003ec90: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
-0003eca0: 2020 2020 2020 7265 7475 726e 0a0a 2020        return..  
-0003ecb0: 2020 2020 2020 6966 2069 7369 6e73 7461        if isinsta
-0003ecc0: 6e63 6528 636f 6c6f 7273 2c20 6469 6374  nce(colors, dict
-0003ecd0: 293a 0a20 2020 2020 2020 2020 2020 2066  ):.            f
-0003ece0: 6f72 206e 616d 652c 2063 6f6c 6f72 2069  or name, color i
-0003ecf0: 6e20 636f 6c6f 7273 2e69 7465 6d73 2829  n colors.items()
-0003ed00: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0003ed10: 2020 666f 7220 726f 6920 696e 2073 656c    for roi in sel
-0003ed20: 662e 726f 6973 3a0a 2020 2020 2020 2020  f.rois:.        
-0003ed30: 2020 2020 2020 2020 2020 2020 6966 2066              if f
-0003ed40: 6e6d 6174 6368 2e66 6e6d 6174 6368 2872  nmatch.fnmatch(r
-0003ed50: 6f69 2e6e 616d 652e 6c6f 7765 7228 292c  oi.name.lower(),
-0003ed60: 206e 616d 652e 6c6f 7765 7228 2929 3a0a   name.lower()):.
-0003ed70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003ed80: 2020 2020 2020 2020 726f 692e 7365 745f          roi.set_
-0003ed90: 636f 6c6f 7228 636f 6c6f 7229 0a20 2020  color(color).   
-0003eda0: 2020 2020 2065 6c69 6620 6973 696e 7374       elif isinst
-0003edb0: 616e 6365 2863 6f6c 6f72 732c 206c 6973  ance(colors, lis
-0003edc0: 7429 3a0a 2020 2020 2020 2020 2020 2020  t):.            
-0003edd0: 666f 7220 692c 2063 6f6c 6f72 2069 6e20  for i, color in 
-0003ede0: 656e 756d 6572 6174 6528 636f 6c6f 7273  enumerate(colors
-0003edf0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-0003ee00: 2020 2069 6620 6920 3e3d 206c 656e 2873     if i >= len(s
-0003ee10: 656c 662e 726f 6973 293a 0a20 2020 2020  elf.rois):.     
-0003ee20: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-0003ee30: 6574 7572 6e0a 2020 2020 2020 2020 2020  eturn.          
-0003ee40: 2020 2020 2020 7365 6c66 2e72 6f69 735b        self.rois[
-0003ee50: 695d 2e73 6574 5f63 6f6c 6f72 2863 6f6c  i].set_color(col
-0003ee60: 6f72 290a 2020 2020 2020 2020 656c 7365  or).        else
-0003ee70: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
-0003ee80: 6973 6520 5479 7065 4572 726f 7228 223c  ise TypeError("<
-0003ee90: 636f 6c6f 7273 3e20 6d75 7374 2062 6520  colors> must be 
-0003eea0: 6c69 7374 206f 7220 6469 6374 2e22 290a  list or dict.").
-0003eeb0: 0a20 2020 2064 6566 2061 6464 5f72 6f69  .    def add_roi
-0003eec0: 7328 7365 6c66 2c20 736f 7572 6365 7329  s(self, sources)
-0003eed0: 3a0a 2020 2020 2020 2020 2222 2241 6464  :.        """Add
-0003eee0: 2061 6464 6974 696f 6e61 6c20 524f 4973   additional ROIs
-0003eef0: 2066 726f 6d20 736f 7572 6365 2873 292e   from source(s).
-0003ef00: 2222 220a 0a20 2020 2020 2020 2069 6620  """..        if 
-0003ef10: 6e6f 7420 736b 7274 2e63 6f72 652e 6973  not skrt.core.is
-0003ef20: 5f6c 6973 7428 736f 7572 6365 7329 3a0a  _list(sources):.
-0003ef30: 2020 2020 2020 2020 2020 2020 736f 7572              sour
-0003ef40: 6365 7320 3d20 5b73 6f75 7263 6573 5d0a  ces = [sources].
-0003ef50: 2020 2020 2020 2020 7365 6c66 2e73 6f75          self.sou
-0003ef60: 7263 6573 2e65 7874 656e 6428 736f 7572  rces.extend(sour
-0003ef70: 6365 7329 0a20 2020 2020 2020 2073 656c  ces).        sel
-0003ef80: 662e 6c6f 6164 2873 6f75 7263 6573 290a  f.load(sources).
-0003ef90: 0a20 2020 2064 6566 2061 6464 5f72 6f69  .    def add_roi
-0003efa0: 2873 656c 662c 2073 6f75 7263 652c 202a  (self, source, *
-0003efb0: 2a6b 7761 7267 7329 3a0a 2020 2020 2020  *kwargs):.      
-0003efc0: 2020 2222 2241 6464 2061 2073 696e 676c    """Add a singl
-0003efd0: 6520 524f 4920 7769 7468 2020 6f70 7469  e ROI with  opti
-0003efe0: 6f6e 616c 206b 7761 7267 732e 2222 220a  onal kwargs.""".
-0003eff0: 0a20 2020 2020 2020 2073 656c 662e 736f  .        self.so
-0003f000: 7572 6365 732e 6170 7065 6e64 2873 6f75  urces.append(sou
-0003f010: 7263 6529 0a20 2020 2020 2020 2069 6620  rce).        if 
-0003f020: 6973 696e 7374 616e 6365 2873 6f75 7263  isinstance(sourc
-0003f030: 652c 2052 4f49 293a 0a20 2020 2020 2020  e, ROI):.       
-0003f040: 2020 2020 2072 6f69 203d 2073 6f75 7263       roi = sourc
-0003f050: 650a 2020 2020 2020 2020 656c 7365 3a0a  e.        else:.
-0003f060: 2020 2020 2020 2020 2020 2020 726f 695f              roi_
-0003f070: 6b77 6172 6773 203d 2073 656c 662e 726f  kwargs = self.ro
-0003f080: 695f 6b77 6172 6773 2e63 6f70 7928 290a  i_kwargs.copy().
-0003f090: 2020 2020 2020 2020 2020 2020 726f 695f              roi_
-0003f0a0: 6b77 6172 6773 2e75 7064 6174 6528 6b77  kwargs.update(kw
-0003f0b0: 6172 6773 290a 2020 2020 2020 2020 2020  args).          
-0003f0c0: 2020 726f 6920 3d20 524f 4928 736f 7572    roi = ROI(sour
-0003f0d0: 6365 2c20 2a2a 726f 695f 6b77 6172 6773  ce, **roi_kwargs
-0003f0e0: 290a 2020 2020 2020 2020 726f 692e 7374  ).        roi.st
-0003f0f0: 7275 6374 7572 655f 7365 7420 3d20 7365  ructure_set = se
-0003f100: 6c66 0a20 2020 2020 2020 2073 656c 662e  lf.        self.
-0003f110: 726f 6973 2e61 7070 656e 6428 726f 6929  rois.append(roi)
-0003f120: 0a0a 2020 2020 6465 6620 636c 6f6e 655f  ..    def clone_
-0003f130: 6174 7472 7328 7365 6c66 2c20 6f62 6a2c  attrs(self, obj,
-0003f140: 2063 6f70 795f 726f 6973 3d54 7275 652c   copy_rois=True,
-0003f150: 2063 6f70 795f 726f 695f 6461 7461 3d54   copy_roi_data=T
-0003f160: 7275 6529 3a0a 2020 2020 2020 2020 2222  rue):.        ""
-0003f170: 2241 7373 6967 6e20 616c 6c20 6174 7472  "Assign all attr
-0003f180: 6962 7574 6573 206f 6620 3c73 656c 663e  ibutes of <self>
-0003f190: 2074 6f20 616e 6f74 6865 7220 6f62 6a65   to another obje
-0003f1a0: 6374 2c20 3c6f 626a 3e2c 2065 6e73 7572  ct, <obj>, ensur
-0003f1b0: 696e 670a 2020 2020 2020 2020 7468 6174  ing.        that
-0003f1c0: 2052 4f49 7320 6172 6520 636f 7069 6564   ROIs are copied
-0003f1d0: 2069 6620 636f 7079 5f72 6f69 733d 5472   if copy_rois=Tr
-0003f1e0: 7565 2e22 2222 0a0a 2020 2020 2020 2020  ue."""..        
-0003f1f0: 736b 7274 2e63 6f72 652e 4461 7461 2e63  skrt.core.Data.c
-0003f200: 6c6f 6e65 5f61 7474 7273 2873 656c 662c  lone_attrs(self,
-0003f210: 206f 626a 290a 2020 2020 2020 2020 6966   obj).        if
-0003f220: 2063 6f70 795f 726f 6973 3a0a 2020 2020   copy_rois:.    
-0003f230: 2020 2020 2020 2020 6f62 6a2e 726f 6973          obj.rois
-0003f240: 203d 205b 5d0a 2020 2020 2020 2020 2020   = [].          
-0003f250: 2020 666f 7220 726f 6920 696e 2073 656c    for roi in sel
-0003f260: 662e 726f 6973 3a0a 2020 2020 2020 2020  f.rois:.        
-0003f270: 2020 2020 2020 2020 6f62 6a2e 726f 6973          obj.rois
-0003f280: 2e61 7070 656e 6428 726f 692e 636c 6f6e  .append(roi.clon
-0003f290: 6528 636f 7079 5f64 6174 613d 636f 7079  e(copy_data=copy
-0003f2a0: 5f72 6f69 5f64 6174 6129 290a 0a20 2020  _roi_data))..   
-0003f2b0: 2064 6566 2066 696c 7465 7265 645f 636f   def filtered_co
-0003f2c0: 7079 280a 2020 2020 2020 2020 7365 6c66  py(.        self
-0003f2d0: 2c0a 2020 2020 2020 2020 6e61 6d65 733d  ,.        names=
-0003f2e0: 4e6f 6e65 2c0a 2020 2020 2020 2020 6e61  None,.        na
-0003f2f0: 6d65 3d4e 6f6e 652c 0a20 2020 2020 2020  me=None,.       
-0003f300: 2074 6f5f 6b65 6570 3d4e 6f6e 652c 0a20   to_keep=None,. 
-0003f310: 2020 2020 2020 2074 6f5f 7265 6d6f 7665         to_remove
-0003f320: 3d4e 6f6e 652c 0a20 2020 2020 2020 206b  =None,.        k
-0003f330: 6565 705f 7265 6e61 6d65 645f 6f6e 6c79  eep_renamed_only
-0003f340: 3d46 616c 7365 2c0a 2020 2020 2020 2020  =False,.        
-0003f350: 636f 7079 5f72 6f69 5f64 6174 613d 5472  copy_roi_data=Tr
-0003f360: 7565 0a20 2020 2029 3a0a 2020 2020 2020  ue.    ):.      
-0003f370: 2020 2222 2243 7265 6174 6520 6120 636f    """Create a co
-0003f380: 7079 206f 6620 7468 6973 2073 7472 7563  py of this struc
-0003f390: 7475 7265 2073 6574 2077 6974 6820 524f  ture set with RO
-0003f3a0: 4973 206f 7074 696f 6e61 6c6c 790a 2020  Is optionally.  
-0003f3b0: 2020 2020 2020 7265 6e61 6d65 6420 6f72        renamed or
-0003f3c0: 2066 696c 7465 7265 642e 2052 6574 7572   filtered. Retur
-0003f3d0: 6e73 2061 206e 6577 2053 7472 7563 7475  ns a new Structu
-0003f3e0: 7265 5365 7420 6f62 6a65 6374 2e0a 0a20  reSet object... 
-0003f3f0: 2020 2020 2020 202a 2a50 6172 616d 6574         **Paramet
-0003f400: 6572 733a 2a2a 0a20 2020 2020 2020 200a  ers:**.        .
-0003f410: 2020 2020 2020 2020 6e61 6d65 7320 3a20          names : 
-0003f420: 6469 6374 2c20 6465 6661 756c 743d 4e6f  dict, default=No
-0003f430: 6e65 0a20 2020 2020 2020 2020 2020 2044  ne.            D
-0003f440: 6963 7469 6f6e 6172 7920 6f66 206e 616d  ictionary of nam
-0003f450: 6573 2066 6f72 2072 656e 616d 696e 6720  es for renaming 
-0003f460: 524f 4973 2c20 7768 6572 6520 7468 6520  ROIs, where the 
-0003f470: 6b65 7973 2061 7265 206e 6577 200a 2020  keys are new .  
-0003f480: 2020 2020 2020 2020 2020 6e61 6d65 7320            names 
-0003f490: 616e 6420 7661 6c75 6573 2061 7265 206c  and values are l
-0003f4a0: 6973 7473 206f 6620 706f 7373 6962 6c65  ists of possible
-0003f4b0: 206e 616d 6573 206f 6620 524f 4973 2074   names of ROIs t
-0003f4c0: 6861 7420 7368 6f75 6c64 0a20 2020 2020  hat should.     
-0003f4d0: 2020 2020 2020 2062 6520 6173 7369 676e         be assign
-0003f4e0: 6564 2074 6865 206e 6577 206e 616d 652e  ed the new name.
-0003f4f0: 2054 6865 7365 206e 616d 6573 2063 616e   These names can
-0003f500: 2061 6c73 6f20 636f 6e74 6169 6e20 7769   also contain wi
-0003f510: 6c64 6361 7264 730a 2020 2020 2020 2020  ldcards.        
-0003f520: 2020 2020 7769 7468 2074 6865 2027 2a27      with the '*'
-0003f530: 2073 796d 626f 6c2e 0a0a 2020 2020 2020   symbol...      
-0003f540: 2020 6e61 6d65 203a 2073 7472 2c20 6465    name : str, de
-0003f550: 6661 756c 743d 4e6f 6e65 0a20 2020 2020  fault=None.     
-0003f560: 2020 2020 2020 204e 616d 6520 666f 7220         Name for 
-0003f570: 7468 6520 7265 7475 726e 6564 2053 7472  the returned Str
-0003f580: 7563 7475 7265 5365 742e 0a0a 2020 2020  uctureSet...    
-0003f590: 2020 2020 746f 5f6b 6565 7020 3a20 6c69      to_keep : li
-0003f5a0: 7374 2c20 6465 6661 756c 743d 4e6f 6e65  st, default=None
-0003f5b0: 0a20 2020 2020 2020 2020 2020 204c 6973  .            Lis
-0003f5c0: 7420 6f66 206e 616d 6573 206f 6620 524f  t of names of RO
-0003f5d0: 4973 2074 6f20 6b65 6570 2069 6e20 7468  Is to keep in th
-0003f5e0: 6520 636f 7069 6564 2053 7472 7563 7475  e copied Structu
-0003f5f0: 7265 5365 743b 2061 6c6c 200a 2020 2020  reSet; all .    
-0003f600: 2020 2020 2020 2020 6f74 6865 7273 2077          others w
-0003f610: 696c 6c20 6265 2072 656d 6f76 6564 2e20  ill be removed. 
-0003f620: 5468 6573 6520 6e61 6d65 7320 6361 6e20  These names can 
-0003f630: 616c 736f 2063 6f6e 7461 696e 2077 696c  also contain wil
-0003f640: 6463 6172 6473 0a20 2020 2020 2020 2020  dcards.         
-0003f650: 2020 2077 6974 6820 7468 6520 272a 2720     with the '*' 
-0003f660: 7379 6d62 6f6c 2e20 4170 706c 6965 6420  symbol. Applied 
-0003f670: 6166 7465 7220 7265 6e61 6d69 6e67 2077  after renaming w
-0003f680: 6974 6820 3c6e 616d 6573 3e2e 0a0a 2020  ith <names>...  
-0003f690: 2020 2020 2020 746f 5f72 656d 6f76 6520        to_remove 
-0003f6a0: 3a20 6c69 7374 2c20 6465 6661 756c 743d  : list, default=
-0003f6b0: 4e6f 6e65 0a20 2020 2020 2020 2020 2020  None.           
-0003f6c0: 204c 6973 7420 6f66 206e 616d 6573 206f   List of names o
-0003f6d0: 6620 524f 4973 2074 6f20 7265 6d6f 7665  f ROIs to remove
-0003f6e0: 2066 726f 6d20 7468 6520 636f 7069 6564   from the copied
-0003f6f0: 2053 7472 7563 7475 7265 5365 743b 2061   StructureSet; a
-0003f700: 6c6c 200a 2020 2020 2020 2020 2020 2020  ll .            
-0003f710: 6f74 6865 7273 2077 696c 6c20 6265 2072  others will be r
-0003f720: 656d 6f76 6564 2e20 5468 6573 6520 6e61  emoved. These na
-0003f730: 6d65 7320 6361 6e20 616c 736f 2063 6f6e  mes can also con
-0003f740: 7461 696e 2077 696c 6463 6172 6473 0a20  tain wildcards. 
-0003f750: 2020 2020 2020 2020 2020 2077 6974 6820             with 
-0003f760: 7468 6520 272a 2720 7379 6d62 6f6c 2e20  the '*' symbol. 
-0003f770: 4170 706c 6965 6420 6166 7465 7220 7265  Applied after re
-0003f780: 6e61 6d69 6e67 2077 6974 6820 3c6e 616d  naming with <nam
-0003f790: 6573 3e20 616e 6420 0a20 2020 2020 2020  es> and .       
-0003f7a0: 2020 2020 2066 696c 7465 7269 6e67 2077       filtering w
-0003f7b0: 6974 6820 3c74 6f5f 6b65 6570 3e2e 0a0a  ith <to_keep>...
-0003f7c0: 2020 2020 2020 2020 6b65 6570 5f72 656e          keep_ren
-0003f7d0: 616d 6564 5f6f 6e6c 7920 3a20 626f 6f6c  amed_only : bool
-0003f7e0: 2c20 6465 6661 756c 743d 4661 6c73 650a  , default=False.
-0003f7f0: 2020 2020 2020 2020 2020 2020 4966 2054              If T
-0003f800: 7275 652c 2061 6e79 2052 4f49 7320 7468  rue, any ROIs th
-0003f810: 6174 2064 6f20 6e6f 7420 6765 7420 7265  at do not get re
-0003f820: 6e61 6d65 6420 7769 6c6c 2062 6520 7265  named will be re
-0003f830: 6d6f 7665 6420 6672 6f6d 0a20 2020 2020  moved from.     
-0003f840: 2020 2020 2020 2074 6865 2053 7472 7563         the Struc
-0003f850: 7475 7265 5365 742e 0a0a 2020 2020 2020  tureSet...      
-0003f860: 2020 636f 7079 5f72 6f69 5f64 6174 6120    copy_roi_data 
-0003f870: 3a20 626f 6f6c 2c20 6465 6661 756c 743d  : bool, default=
-0003f880: 5472 7565 0a20 2020 2020 2020 2020 2020  True.           
-0003f890: 2049 6620 5472 7565 2c20 7468 6520 524f   If True, the RO
-0003f8a0: 4973 2069 6e20 7468 6520 7265 7475 726e  Is in the return
-0003f8b0: 6564 2053 7472 7563 7475 7265 5365 7420  ed StructureSet 
-0003f8c0: 7769 6c6c 2063 6f6e 7461 696e 0a20 2020  will contain.   
-0003f8d0: 2020 2020 2020 2020 2063 6f70 6965 7320           copies 
-0003f8e0: 6f66 2074 6865 2064 6174 6120 6672 6f6d  of the data from
-0003f8f0: 2074 6865 206f 7269 6769 6e61 6c20 5374   the original St
-0003f900: 7275 6374 7572 6553 6574 2e20 4f74 6865  ructureSet. Othe
-0003f910: 7277 6973 652c 0a20 2020 2020 2020 2020  rwise,.         
-0003f920: 2020 2074 6865 206e 6577 2052 4f49 7320     the new ROIs 
-0003f930: 7769 6c6c 2063 6f6e 7461 696e 2072 6566  will contain ref
-0003f940: 6572 656e 6365 7320 746f 2074 6865 2073  erences to the s
-0003f950: 616d 6520 6461 7461 2c20 652e 672e 2074  ame data, e.g. t
-0003f960: 6865 200a 2020 2020 2020 2020 2020 2020  he .            
-0003f970: 7361 6d65 206e 756d 7079 206e 6461 7272  same numpy ndarr
-0003f980: 6179 206f 626a 6563 7420 666f 7220 7468  ay object for th
-0003f990: 6520 6d61 736b 2f73 616d 6520 6469 6374  e mask/same dict
-0003f9a0: 2066 6f72 2074 6865 2063 6f6e 746f 7572   for the contour
-0003f9b0: 732e 0a20 2020 2020 2020 2020 2020 204f  s..            O
-0003f9c0: 6e6c 7920 7573 6564 2069 6620 3c63 6f70  nly used if <cop
-0003f9d0: 795f 726f 6973 3e20 6973 2054 7275 650a  y_rois> is True.
-0003f9e0: 2020 2020 2020 2020 2222 220a 0a20 2020          """..   
-0003f9f0: 2020 2020 2073 656c 662e 6c6f 6164 2829       self.load()
-0003fa00: 0a20 2020 2020 2020 2073 7320 3d20 7365  .        ss = se
-0003fa10: 6c66 2e63 6c6f 6e65 2863 6f70 795f 726f  lf.clone(copy_ro
-0003fa20: 695f 6461 7461 3d63 6f70 795f 726f 695f  i_data=copy_roi_
-0003fa30: 6461 7461 290a 2020 2020 2020 2020 6966  data).        if
-0003fa40: 206e 616d 6520 6973 206e 6f74 204e 6f6e   name is not Non
-0003fa50: 653a 0a20 2020 2020 2020 2020 2020 2073  e:.            s
-0003fa60: 732e 6e61 6d65 203d 206e 616d 650a 2020  s.name = name.  
-0003fa70: 2020 2020 2020 7373 2e72 656e 616d 655f        ss.rename_
-0003fa80: 726f 6973 286e 616d 6573 2c20 6b65 6570  rois(names, keep
-0003fa90: 5f72 656e 616d 6564 5f6f 6e6c 793d 6b65  _renamed_only=ke
-0003faa0: 6570 5f72 656e 616d 6564 5f6f 6e6c 7929  ep_renamed_only)
-0003fab0: 0a20 2020 2020 2020 2073 732e 6669 6c74  .        ss.filt
-0003fac0: 6572 5f72 6f69 7328 746f 5f6b 6565 702c  er_rois(to_keep,
-0003fad0: 2074 6f5f 7265 6d6f 7665 290a 2020 2020   to_remove).    
-0003fae0: 2020 2020 7265 7475 726e 2073 730a 0a20      return ss.. 
-0003faf0: 2020 2064 6566 2067 6574 5f72 6f69 7328     def get_rois(
-0003fb00: 7365 6c66 2c20 6e61 6d65 733d 4e6f 6e65  self, names=None
-0003fb10: 2c20 6967 6e6f 7265 5f65 6d70 7479 3d46  , ignore_empty=F
-0003fb20: 616c 7365 293a 0a20 2020 2020 2020 2022  alse):.        "
-0003fb30: 2222 4765 7420 6c69 7374 206f 6620 524f  ""Get list of RO
-0003fb40: 4920 6f62 6a65 6374 7320 4966 203c 6e61  I objects If <na
-0003fb50: 6d65 733e 2069 7320 6769 7665 6e2c 206f  mes> is given, o
-0003fb60: 6e6c 7920 7468 6520 524f 4973 2077 6974  nly the ROIs wit
-0003fb70: 680a 2020 2020 2020 2020 7468 6f73 6520  h.        those 
-0003fb80: 6e61 6d65 7320 7769 6c6c 2062 6520 7265  names will be re
-0003fb90: 7475 726e 6564 2e22 2222 0a0a 2020 2020  turned."""..    
-0003fba0: 2020 2020 7365 6c66 2e6c 6f61 6428 290a      self.load().
-0003fbb0: 2020 2020 2020 2020 6966 206e 616d 6573          if names
-0003fbc0: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
-0003fbd0: 2020 2020 2020 6966 2069 676e 6f72 655f        if ignore_
-0003fbe0: 656d 7074 793a 0a20 2020 2020 2020 2020  empty:.         
-0003fbf0: 2020 2020 2020 2072 6574 7572 6e20 5b72         return [r
-0003fc00: 6f69 2066 6f72 2072 6f69 2069 6e20 7365  oi for roi in se
-0003fc10: 6c66 2e72 6f69 7320 6966 206e 6f74 2072  lf.rois if not r
-0003fc20: 6f69 2e65 6d70 7479 5d0a 2020 2020 2020  oi.empty].      
-0003fc30: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-0003fc40: 662e 726f 6973 0a0a 2020 2020 2020 2020  f.rois..        
-0003fc50: 726f 6973 203d 205b 5d0a 2020 2020 2020  rois = [].      
-0003fc60: 2020 666f 7220 6e61 6d65 2069 6e20 6e61    for name in na
-0003fc70: 6d65 733a 0a20 2020 2020 2020 2020 2020  mes:.           
-0003fc80: 2072 6f69 203d 2073 656c 662e 6765 745f   roi = self.get_
-0003fc90: 726f 6928 6e61 6d65 290a 2020 2020 2020  roi(name).      
-0003fca0: 2020 2020 2020 6966 2072 6f69 2069 7320        if roi is 
-0003fcb0: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
-0003fcc0: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
-0003fcd0: 2069 676e 6f72 655f 656d 7074 7920 6f72   ignore_empty or
-0003fce0: 206e 6f74 2072 6f69 2e65 6d70 7479 3a0a   not roi.empty:.
-0003fcf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003fd00: 2020 2020 726f 6973 2e61 7070 656e 6428      rois.append(
-0003fd10: 726f 6929 0a20 2020 2020 2020 2072 6574  roi).        ret
-0003fd20: 7572 6e20 726f 6973 0a0a 2020 2020 6465  urn rois..    de
-0003fd30: 6620 6765 745f 726f 6973 5f77 696c 6463  f get_rois_wildc
-0003fd40: 6172 6428 7365 6c66 2c20 7769 6c64 6361  ard(self, wildca
-0003fd50: 7264 293a 0a20 2020 2020 2020 2022 2222  rd):.        """
-0003fd60: 5265 7475 726e 206c 6973 7420 6f66 2052  Return list of R
-0003fd70: 4f49 7320 6d61 7463 6869 6e67 2061 2077  OIs matching a w
-0003fd80: 696c 6463 6172 6420 6578 7072 6573 7369  ildcard expressi
-0003fd90: 6f6e 2e22 2222 0a0a 2020 2020 2020 2020  on."""..        
-0003fda0: 726f 6973 203d 205b 5d0a 2020 2020 2020  rois = [].      
-0003fdb0: 2020 666f 7220 726f 6920 696e 2073 656c    for roi in sel
-0003fdc0: 662e 6765 745f 726f 6973 2829 3a0a 2020  f.get_rois():.  
-0003fdd0: 2020 2020 2020 2020 2020 6966 2066 6e6d            if fnm
-0003fde0: 6174 6368 2e66 6e6d 6174 6368 2872 6f69  atch.fnmatch(roi
-0003fdf0: 2e6e 616d 652e 6c6f 7765 7228 292c 2077  .name.lower(), w
-0003fe00: 696c 6463 6172 642e 6c6f 7765 7228 2929  ildcard.lower())
-0003fe10: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0003fe20: 2020 726f 6973 2e61 7070 656e 6428 726f    rois.append(ro
-0003fe30: 6929 0a20 2020 2020 2020 2072 6574 7572  i).        retur
-0003fe40: 6e20 726f 6973 0a0a 2020 2020 6465 6620  n rois..    def 
-0003fe50: 6765 745f 726f 695f 6e61 6d65 7328 7365  get_roi_names(se
-0003fe60: 6c66 2c20 6f72 6967 696e 616c 3d46 616c  lf, original=Fal
-0003fe70: 7365 2c20 6967 6e6f 7265 5f65 6d70 7479  se, ignore_empty
-0003fe80: 3d46 616c 7365 293a 0a20 2020 2020 2020  =False):.       
-0003fe90: 2022 2222 0a20 2020 2020 2020 2047 6574   """.        Get
-0003fea0: 206c 6973 7420 6f66 206e 616d 6573 206f   list of names o
-0003feb0: 6620 524f 4973 2069 6e20 7468 6973 2073  f ROIs in this s
-0003fec0: 7472 7563 7475 7265 2073 6574 2e20 4966  tructure set. If
-0003fed0: 203c 6f72 6967 696e 616c 3e20 6973 2054   <original> is T
-0003fee0: 7275 652c 0a20 2020 2020 2020 2067 6574  rue,.        get
-0003fef0: 2074 6865 206f 7269 6769 6e61 6c20 6e61   the original na
-0003ff00: 6d65 7320 6f66 2074 6865 2052 4f49 732e  mes of the ROIs.
-0003ff10: 2020 4966 203c 6967 6e6f 7265 5f65 6d70    If <ignore_emp
-0003ff20: 7479 3e20 6973 2054 7275 652c 0a20 2020  ty> is True,.   
-0003ff30: 2020 2020 206f 6d69 7420 6e61 6d65 7320       omit names 
-0003ff40: 6f66 2065 6d70 7479 2052 4f49 732e 0a20  of empty ROIs.. 
-0003ff50: 2020 2020 2020 2022 2222 0a0a 2020 2020         """..    
-0003ff60: 2020 2020 7265 7475 726e 205b 732e 6765      return [s.ge
-0003ff70: 745f 6e61 6d65 286f 7269 6769 6e61 6c29  t_name(original)
-0003ff80: 2066 6f72 2073 2069 6e20 7365 6c66 2e67   for s in self.g
-0003ff90: 6574 5f72 6f69 7328 290a 2020 2020 2020  et_rois().      
-0003ffa0: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
-0003ffb0: 2028 6967 6e6f 7265 5f65 6d70 7479 2061   (ignore_empty a
-0003ffc0: 6e64 2073 2e65 6d70 7479 295d 0a0a 0a20  nd s.empty)]... 
-0003ffd0: 2020 2064 6566 2067 6574 5f72 6f69 5f64     def get_roi_d
-0003ffe0: 6963 7428 7365 6c66 293a 0a20 2020 2020  ict(self):.     
-0003fff0: 2020 2022 2222 4765 7420 6469 6374 206f     """Get dict o
-00040000: 6620 524f 4920 6e61 6d65 7320 616e 6420  f ROI names and 
-00040010: 6f62 6a65 6374 732e 2222 220a 0a20 2020  objects."""..   
-00040020: 2020 2020 2072 6574 7572 6e20 7b73 2e6e       return {s.n
-00040030: 616d 653a 2073 2066 6f72 2073 2069 6e20  ame: s for s in 
-00040040: 7365 6c66 2e67 6574 5f72 6f69 7328 297d  self.get_rois()}
-00040050: 0a0a 2020 2020 6465 6620 6765 745f 726f  ..    def get_ro
-00040060: 6928 7365 6c66 2c20 6e61 6d65 293a 0a20  i(self, name):. 
-00040070: 2020 2020 2020 2022 2222 4765 7420 616e         """Get an
-00040080: 2052 4f49 2077 6974 6820 6120 7370 6563   ROI with a spec
-00040090: 6966 6963 206e 616d 652e 2222 220a 0a20  ific name.""".. 
-000400a0: 2020 2020 2020 2072 6f69 7320 3d20 7365         rois = se
-000400b0: 6c66 2e67 6574 5f72 6f69 5f64 6963 7428  lf.get_roi_dict(
-000400c0: 290a 2020 2020 2020 2020 6966 206e 616d  ).        if nam
-000400d0: 6520 6e6f 7420 696e 2072 6f69 733a 0a20  e not in rois:. 
-000400e0: 2020 2020 2020 2020 2020 2070 7269 6e74             print
-000400f0: 2866 2252 4f49 207b 6e61 6d65 7d20 6e6f  (f"ROI {name} no
-00040100: 7420 666f 756e 6421 2229 0a20 2020 2020  t found!").     
-00040110: 2020 2020 2020 2072 6574 7572 6e0a 2020         return.  
-00040120: 2020 2020 2020 7265 7475 726e 2072 6f69        return roi
-00040130: 735b 6e61 6d65 5d0a 0a20 2020 2064 6566  s[name]..    def
-00040140: 2070 7269 6e74 5f72 6f69 7328 7365 6c66   print_rois(self
-00040150: 293a 0a0a 2020 2020 2020 2020 7365 6c66  ):..        self
-00040160: 2e6c 6f61 6428 290a 2020 2020 2020 2020  .load().        
-00040170: 7072 696e 7428 225c 6e22 2e6a 6f69 6e28  print("\n".join(
-00040180: 7365 6c66 2e67 6574 5f72 6f69 5f6e 616d  self.get_roi_nam
-00040190: 6573 2829 2929 0a0a 2020 2020 6465 6620  es()))..    def 
-000401a0: 6765 745f 6e61 6d65 2873 656c 6629 3a0a  get_name(self):.
-000401b0: 2020 2020 2020 2020 2727 270a 2020 2020          '''.    
-000401c0: 2020 2020 4c6f 6164 2073 656c 6620 616e      Load self an
-000401d0: 6420 6765 7420 6e61 6d65 2e0a 2020 2020  d get name..    
-000401e0: 2020 2020 2727 270a 0a20 2020 2020 2020      '''..       
-000401f0: 2073 656c 662e 6c6f 6164 2829 0a20 2020   self.load().   
-00040200: 2020 2020 2072 6574 7572 6e20 2873 656c       return (sel
-00040210: 662e 6e61 6d65 290a 0a20 2020 2064 6566  f.name)..    def
-00040220: 2067 6574 5f74 7261 6e73 6c61 7469 6f6e   get_translation
-00040230: 5f74 6f5f 616c 6967 6e28 0a20 2020 2020  _to_align(.     
-00040240: 2020 2020 2020 2073 656c 662c 206f 7468         self, oth
-00040250: 6572 2c20 7a5f 6672 6163 7469 6f6e 313d  er, z_fraction1=
-00040260: 4e6f 6e65 2c20 7a5f 6672 6163 7469 6f6e  None, z_fraction
-00040270: 323d 4e6f 6e65 293a 0a20 2020 2020 2020  2=None):.       
-00040280: 2022 2222 0a20 2020 2020 2020 2044 6574   """.        Det
-00040290: 6572 6d69 6e65 2074 7261 6e73 6c61 7469  ermine translati
-000402a0: 6f6e 2066 6f72 2061 6c69 676e 696e 6720  on for aligning 
-000402b0: 3c73 656c 663e 2074 6f20 3c6f 7468 6572  <self> to <other
-000402c0: 3e2e 0a0a 2020 2020 2020 2020 2a2a 5061  >...        **Pa
-000402d0: 7261 6d65 7465 7273 3a2a 2a0a 0a20 2020  rameters:**..   
-000402e0: 2020 2020 206f 7468 6572 203a 2052 4f49       other : ROI
-000402f0: 2f53 7472 7563 7475 7265 5365 742f 6c69  /StructureSet/li
-00040300: 7374 0a20 2020 2020 2020 2020 2020 2052  st.            R
-00040310: 4f49 2077 6974 6820 7768 6963 6820 616c  OI with which al
-00040320: 6967 6e6d 656e 7420 6973 2074 6f20 6265  ignment is to be
-00040330: 2070 6572 666f 726d 6564 2e20 2054 6869   performed.  Thi
-00040340: 7320 6361 6e20 6265 0a20 2020 2020 2020  s can be.       
-00040350: 2020 2020 2073 7065 6369 6669 6564 2064       specified d
-00040360: 6972 6563 746c 7920 6173 2061 2073 696e  irectly as a sin
-00040370: 676c 6520 524f 492e 2020 416c 7465 726e  gle ROI.  Altern
-00040380: 6174 6976 656c 792c 2069 7420 6361 6e0a  atively, it can.
-00040390: 2020 2020 2020 2020 2020 2020 6265 2061              be a
-000403a0: 2053 7472 7563 7475 7265 5365 742c 206f   StructureSet, o
-000403b0: 7220 6120 6c69 7374 206f 7220 524f 492f  r a list or ROI/
-000403c0: 5374 7275 6374 7572 6553 6574 206f 626a  StructureSet obj
-000403d0: 6563 7473 2c0a 2020 2020 2020 2020 2020  ects,.          
-000403e0: 2020 696e 2077 6869 6368 2063 6173 6520    in which case 
-000403f0: 7468 6520 696e 6469 7669 6475 616c 2052  the individual R
-00040400: 4f49 7320 7769 6c6c 2062 6520 636f 6d62  OIs will be comb
-00040410: 696e 6564 2e0a 0a20 2020 2020 2020 207a  ined...        z
-00040420: 5f66 7261 6374 696f 6e31 203a 2066 6c6f  _fraction1 : flo
-00040430: 6174 2c20 6465 6661 756c 743d 4e6f 6e65  at, default=None
-00040440: 0a20 2020 2020 2020 2020 2020 2050 6f73  .            Pos
-00040450: 6974 696f 6e20 616c 6f6e 6720 7a20 6178  ition along z ax
-00040460: 6973 206f 6620 736c 6963 6520 7468 726f  is of slice thro
-00040470: 7567 6820 3c73 656c 663e 206f 6e20 7768  ugh <self> on wh
-00040480: 6963 680a 2020 2020 2020 2020 2020 2020  ich.            
-00040490: 746f 2061 6c69 676e 2e20 2049 6620 4e6f  to align.  If No
-000404a0: 6e65 2c20 616c 6967 6e6d 656e 7420 6973  ne, alignment is
-000404b0: 2074 6f20 7468 6520 6365 6e74 726f 6964   to the centroid
-000404c0: 206f 6620 7468 650a 2020 2020 2020 2020   of the.        
-000404d0: 2020 2020 7768 6f6c 6520 524f 4920 766f      whole ROI vo
-000404e0: 6c75 6d65 2e20 204f 7468 6572 7769 7365  lume.  Otherwise
-000404f0: 2c20 616c 6967 6e6d 656e 7420 6973 2074  , alignment is t
-00040500: 6f20 7468 650a 2020 2020 2020 2020 2020  o the.          
-00040510: 2020 6365 6e74 726f 6964 206f 6620 7468    centroid of th
-00040520: 6520 736c 6963 6520 6174 2074 6865 2073  e slice at the s
-00040530: 7065 6369 6669 6564 2064 6973 7461 6e63  pecified distanc
-00040540: 650a 2020 2020 2020 2020 2020 2020 6672  e.            fr
-00040550: 6f6d 2074 6865 2052 4f49 2773 206d 6f73  om the ROI's mos
-00040560: 742d 696e 6665 7269 6f72 2070 6f69 6e74  t-inferior point
-00040570: 3a20 3020 636f 7272 6573 706f 6e64 7320  : 0 corresponds 
-00040580: 746f 0a20 2020 2020 2020 2020 2020 2074  to.            t
-00040590: 6865 206d 6f73 742d 696e 6665 7269 6f72  he most-inferior
-000405a0: 2070 6f69 6e74 2028 6c6f 7765 7374 207a   point (lowest z
-000405b0: 293b 2031 2063 6f72 7265 7370 6f6e 6473  ); 1 corresponds
-000405c0: 2074 6f20 7468 650a 2020 2020 2020 2020   to the.        
-000405d0: 2020 2020 6d6f 7374 2d73 7570 6572 696f      most-superio
-000405e0: 7220 706f 696e 7420 2868 6967 6865 7374  r point (highest
-000405f0: 207a 292e 2020 5661 6c75 6573 2066 6f72   z).  Values for
-00040600: 207a 5f66 7261 6374 696f 6e0a 2020 2020   z_fraction.    
-00040610: 2020 2020 2020 2020 6f75 7473 6964 6520          outside 
-00040620: 7468 6520 696e 7465 7276 616c 205b 302c  the interval [0,
-00040630: 2031 5d20 7265 7375 6c74 2069 6e20 6120   1] result in a 
-00040640: 5275 6e74 696d 6545 7272 6f72 2e0a 0a20  RuntimeError... 
-00040650: 2020 2020 2020 207a 5f66 7261 6374 696f         z_fractio
-00040660: 6e32 203a 2066 6c6f 6174 2c20 6465 6661  n2 : float, defa
-00040670: 756c 743d 4e6f 6e65 0a20 2020 2020 2020  ult=None.       
-00040680: 2020 2020 2050 6f73 6974 696f 6e20 616c       Position al
-00040690: 6f6e 6720 7a20 6178 6973 206f 6620 736c  ong z axis of sl
-000406a0: 6963 6520 7468 726f 7567 6820 3c6f 7468  ice through <oth
-000406b0: 6572 3e20 6f6e 2077 6869 6368 0a20 2020  er> on which.   
-000406c0: 2020 2020 2020 2020 2074 6f20 616c 6967           to alig
-000406d0: 6e2e 2020 4966 204e 6f6e 652c 2061 6c69  n.  If None, ali
-000406e0: 676e 6d65 6e74 2069 7320 746f 2074 6865  gnment is to the
-000406f0: 2063 656e 7472 6f69 6420 6f66 2074 6865   centroid of the
-00040700: 0a20 2020 2020 2020 2020 2020 2077 686f  .            who
-00040710: 6c65 2052 4f49 2076 6f6c 756d 652e 2020  le ROI volume.  
-00040720: 4f74 6865 7277 6973 652c 2061 6c69 676e  Otherwise, align
-00040730: 6d65 6e74 2069 7320 746f 2074 6865 0a20  ment is to the. 
-00040740: 2020 2020 2020 2020 2020 2063 656e 7472             centr
-00040750: 6f69 6420 6f66 2074 6865 2073 6c69 6365  oid of the slice
-00040760: 2061 7420 7468 6520 7370 6563 6966 6965   at the specifie
-00040770: 6420 6469 7374 616e 6365 0a20 2020 2020  d distance.     
-00040780: 2020 2020 2020 2066 726f 6d20 7468 6520         from the 
-00040790: 524f 4927 7320 6d6f 7374 2d69 6e66 6572  ROI's most-infer
-000407a0: 696f 7220 706f 696e 743a 2030 2063 6f72  ior point: 0 cor
-000407b0: 7265 7370 6f6e 6473 2074 6f0a 2020 2020  responds to.    
-000407c0: 2020 2020 2020 2020 7468 6520 6d6f 7374          the most
-000407d0: 2d69 6e66 6572 696f 7220 706f 696e 7420  -inferior point 
-000407e0: 286c 6f77 6573 7420 7a29 3b20 3120 636f  (lowest z); 1 co
-000407f0: 7272 6573 706f 6e64 7320 746f 2074 6865  rresponds to the
-00040800: 0a20 2020 2020 2020 2020 2020 206d 6f73  .            mos
-00040810: 742d 7375 7065 7269 6f72 2070 6f69 6e74  t-superior point
-00040820: 2028 6869 6768 6573 7420 7a29 2e20 2056   (highest z).  V
-00040830: 616c 7565 7320 666f 7220 7a5f 6672 6163  alues for z_frac
-00040840: 7469 6f6e 0a20 2020 2020 2020 2020 2020  tion.           
-00040850: 206f 7574 7369 6465 2074 6865 2069 6e74   outside the int
-00040860: 6572 7661 6c20 5b30 2c20 315d 2072 6573  erval [0, 1] res
-00040870: 756c 7420 696e 2061 2052 756e 7469 6d65  ult in a Runtime
-00040880: 4572 726f 722e 0a20 2020 2020 2020 2020  Error..         
-00040890: 2020 2022 2222 0a20 2020 2020 2020 2072     """.        r
-000408a0: 6574 7572 6e20 6765 745f 7472 616e 736c  eturn get_transl
-000408b0: 6174 696f 6e5f 746f 5f61 6c69 676e 280a  ation_to_align(.
-000408c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000408d0: 7365 6c66 2c20 6f74 6865 722c 207a 5f66  self, other, z_f
-000408e0: 7261 6374 696f 6e31 2c20 7a5f 6672 6163  raction1, z_frac
-000408f0: 7469 6f6e 3229 0a0a 2020 2020 6465 6620  tion2)..    def 
-00040900: 6765 745f 636f 6e66 6f72 6d69 7479 5f69  get_conformity_i
-00040910: 6e64 6578 2873 656c 662c 206e 616d 6573  ndex(self, names
-00040920: 3d4e 6f6e 652c 202a 2a6b 7761 7267 7329  =None, **kwargs)
-00040930: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
-00040940: 2020 2020 2020 4765 7420 636f 6e66 6f72        Get confor
-00040950: 6d69 7479 2069 6e64 6578 2066 6f72 2052  mity index for R
-00040960: 4f49 7320 6f66 2074 6865 2053 7472 7563  OIs of the Struc
-00040970: 7475 7265 5365 742e 0a0a 2020 2020 2020  tureSet...      
-00040980: 2020 2a2a 5061 7261 6d65 7465 7273 3a2a    **Parameters:*
-00040990: 2a0a 0a20 2020 2020 2020 206e 616d 6573  *..        names
-000409a0: 203a 206c 6973 742c 2064 6566 6175 6c74   : list, default
-000409b0: 3d4e 6f6e 650a 2020 2020 2020 2020 2020  =None.          
-000409c0: 2020 4c69 7374 206f 6620 7374 7269 6e67    List of string
-000409d0: 7320 636f 7272 6573 706f 6e64 696e 6720  s corresponding 
-000409e0: 746f 2052 4f49 206e 616d 6573 2e20 2049  to ROI names.  I
-000409f0: 6620 6e6f 6e2d 6e75 6c6c 2c0a 2020 2020  f non-null,.    
-00040a00: 2020 2020 2020 2020 5468 6520 636f 6e66          The conf
-00040a10: 6f72 6d69 7479 2069 6e64 6578 2069 7320  ormity index is 
-00040a20: 6361 6c63 756c 6174 6564 2072 656c 6174  calculated relat
-00040a30: 6976 6520 666f 7220 7468 6520 524f 4973  ive for the ROIs
-00040a40: 0a20 2020 2020 2020 2020 2020 2077 6974  .            wit
-00040a50: 6820 7468 6520 6c69 7374 6564 206e 616d  h the listed nam
-00040a60: 6573 206f 6e6c 792e 2020 4f74 6865 7277  es only.  Otherw
-00040a70: 6973 652c 2074 6865 2063 6f6e 666f 726d  ise, the conform
-00040a80: 6974 790a 2020 2020 2020 2020 2020 2020  ity.            
-00040a90: 696e 6465 7820 6973 2063 616c 6375 6c61  index is calcula
-00040aa0: 7465 6420 7265 6c61 7469 7665 2074 6f20  ted relative to 
-00040ab0: 616c 6c20 524f 4973 2069 6e20 7468 6520  all ROIs in the 
-00040ac0: 7374 7275 6374 7572 650a 2020 2020 2020  structure.      
-00040ad0: 2020 2020 2020 7365 742e 0a0a 2020 2020        set...    
-00040ae0: 2020 2020 6b77 6172 6773 0a20 2020 2020      kwargs.     
-00040af0: 2020 2020 2020 204b 6579 776f 7264 2061         Keyword a
-00040b00: 7267 756d 656e 7473 2061 7265 2070 6173  rguments are pas
-00040b10: 7365 6420 746f 0a20 2020 2020 2020 2020  sed to.         
-00040b20: 2020 2073 6b72 742e 7374 7275 6374 7572     skrt.structur
-00040b30: 6573 2e67 6574 5f63 6f6e 666f 726d 6974  es.get_conformit
-00040b40: 795f 696e 6465 7828 292e 2e67 6574 5f73  y_index()..get_s
-00040b50: 7572 6661 6365 5f64 6973 7461 6e63 6573  urface_distances
-00040b60: 2829 2e0a 2020 2020 2020 2020 2020 2020  ()..            
-00040b70: 5365 6520 646f 6375 6d65 6e74 6174 696f  See documentatio
-00040b80: 6e20 6f66 2074 6869 7320 6675 6e63 7469  n of this functi
-00040b90: 6f6e 2066 6f72 2070 6172 616d 6574 6572  on for parameter
-00040ba0: 2064 6574 6169 6c73 2e0a 2020 2020 2020   details..      
-00040bb0: 2020 2222 220a 2020 2020 2020 2020 7265    """.        re
-00040bc0: 7475 726e 2067 6574 5f63 6f6e 666f 726d  turn get_conform
-00040bd0: 6974 795f 696e 6465 7828 7365 6c66 2e67  ity_index(self.g
-00040be0: 6574 5f72 6f69 7328 6e61 6d65 7329 2c20  et_rois(names), 
-00040bf0: 2a2a 6b77 6172 6773 290a 0a20 2020 2064  **kwargs)..    d
-00040c00: 6566 2067 6574 5f67 656f 6d65 7472 7928  ef get_geometry(
-00040c10: 0a20 2020 2020 2020 2073 656c 662c 200a  .        self, .
-00040c20: 2020 2020 2020 2020 6e61 6d65 5f61 735f          name_as_
-00040c30: 696e 6465 783d 5472 7565 2c20 0a20 2020  index=True, .   
-00040c40: 2020 2020 2068 746d 6c3d 4661 6c73 652c       html=False,
-00040c50: 200a 2020 2020 2020 2020 636f 6c6f 7265   .        colore
-00040c60: 643d 4661 6c73 652c 0a20 2020 2020 2020  d=False,.       
-00040c70: 2067 7265 7965 645f 6f75 743d 4e6f 6e65   greyed_out=None
-00040c80: 2c0a 2020 2020 2020 2020 726f 695f 6b77  ,.        roi_kw
-00040c90: 6172 6773 3d7b 7d2c 0a20 2020 2020 2020  args={},.       
-00040ca0: 202a 2a6b 7761 7267 7329 3a0a 2020 2020   **kwargs):.    
-00040cb0: 2020 2020 2222 2247 6574 2070 616e 6461      """Get panda
-00040cc0: 7320 4461 7461 4672 616d 6520 6f66 2067  s DataFrame of g
-00040cd0: 656f 6d65 7472 6963 2070 726f 7065 7274  eometric propert
-00040ce0: 6965 7320 666f 7220 616c 6c20 524f 4973  ies for all ROIs
-00040cf0: 2e0a 2020 2020 2020 2020 4966 206e 6f20  ..        If no 
-00040d00: 736c 2f69 6478 2f70 6f73 2069 7320 6769  sl/idx/pos is gi
-00040d10: 7665 6e2c 2074 6865 2063 656e 7472 616c  ven, the central
-00040d20: 2073 6c69 6365 206f 6620 6561 6368 2052   slice of each R
-00040d30: 4f49 2077 696c 6c20 6265 2075 7365 642e  OI will be used.
-00040d40: 0a0a 2020 2020 2020 2020 2a2a 5061 7261  ..        **Para
-00040d50: 6d65 7465 7273 2a2a 3a0a 0a20 2020 2020  meters**:..     
-00040d60: 2020 206e 616d 655f 6173 5f69 6e64 6578     name_as_index
-00040d70: 203a 2062 6f6f 6c2c 2064 6566 6175 6c74   : bool, default
-00040d80: 3d54 7275 650a 2020 2020 2020 2020 2020  =True.          
-00040d90: 2020 4966 2054 7275 652c 2074 6865 2052    If True, the R
-00040da0: 4f49 206e 616d 6573 2077 696c 6c20 6265  OI names will be
-00040db0: 2075 7365 6420 6173 2072 6f77 2069 6e64   used as row ind
-00040dc0: 6963 6573 3b20 6f74 6865 7277 6973 652c  ices; otherwise,
-00040dd0: 2074 6865 790a 2020 2020 2020 2020 2020   they.          
-00040de0: 2020 7769 6c6c 2062 6520 6769 7665 6e20    will be given 
-00040df0: 7468 6569 7220 6f77 6e20 636f 6c75 6d6e  their own column
-00040e00: 2e0a 0a20 2020 2020 2020 2068 746d 6c20  ...        html 
-00040e10: 3a20 626f 6f6c 2c20 6465 6661 756c 743d  : bool, default=
-00040e20: 4661 6c73 650a 2020 2020 2020 2020 2020  False.          
-00040e30: 2020 4966 2054 7275 652c 2074 6865 2074    If True, the t
-00040e40: 6162 6c65 2077 696c 6c20 6265 2063 6f6e  able will be con
-00040e50: 7665 7274 6564 2074 6f20 4854 4d4c 2074  verted to HTML t
-00040e60: 6578 7420 636f 6c6f 722d 636f 6465 6420  ext color-coded 
-00040e70: 6261 7365 640a 2020 2020 2020 2020 2020  based.          
-00040e80: 2020 6f6e 2052 4f49 2063 6f6c 6f72 732e    on ROI colors.
-00040e90: 0a20 2020 2020 2020 2022 2222 0a0a 2020  .        """..  
-00040ea0: 2020 2020 2020 6966 2068 746d 6c3a 0a20        if html:. 
-00040eb0: 2020 2020 2020 2020 2020 206e 616d 655f             name_
-00040ec0: 6173 5f69 6e64 6578 203d 2046 616c 7365  as_index = False
-00040ed0: 0a20 2020 2020 2020 2069 6620 6772 6579  .        if grey
-00040ee0: 6564 5f6f 7574 2069 7320 4e6f 6e65 3a0a  ed_out is None:.
-00040ef0: 2020 2020 2020 2020 2020 2020 6772 6579              grey
-00040f00: 6564 5f6f 7574 203d 205b 5d0a 0a20 2020  ed_out = []..   
-00040f10: 2020 2020 2072 6f77 7320 3d20 5b5d 0a20       rows = []. 
-00040f20: 2020 2020 2020 2066 6f72 2072 6f69 2069         for roi i
-00040f30: 6e20 7365 6c66 2e67 6574 5f72 6f69 7328  n self.get_rois(
-00040f40: 6967 6e6f 7265 5f65 6d70 7479 3d54 7275  ignore_empty=Tru
-00040f50: 6529 3a0a 0a20 2020 2020 2020 2020 2020  e):..           
-00040f60: 2023 2047 6574 2044 6174 6146 7261 6d65   # Get DataFrame
-00040f70: 2066 6f72 2074 6869 7320 524f 490a 2020   for this ROI.  
-00040f80: 2020 2020 2020 2020 2020 6466 5f72 6f77            df_row
-00040f90: 203d 2072 6f69 2e67 6574 5f67 656f 6d65   = roi.get_geome
-00040fa0: 7472 7928 6e61 6d65 5f61 735f 696e 6465  try(name_as_inde
-00040fb0: 783d 6e61 6d65 5f61 735f 696e 6465 782c  x=name_as_index,
-00040fc0: 202a 2a6b 7761 7267 7329 0a0a 2020 2020   **kwargs)..    
-00040fd0: 2020 2020 2020 2020 2320 5265 706c 6163          # Replac
-00040fe0: 6520 616c 6c20 7661 6c75 6573 2077 6974  e all values wit
-00040ff0: 6820 222d 2d22 2069 6620 6772 6579 696e  h "--" if greyin
-00041000: 6720 6f75 7420 7468 6973 2052 4f49 0a20  g out this ROI. 
-00041010: 2020 2020 2020 2020 2020 2069 6620 726f             if ro
-00041020: 6920 696e 2067 7265 7965 645f 6f75 743a  i in greyed_out:
-00041030: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00041040: 2066 6f72 2063 6f6c 2069 6e20 6466 5f72   for col in df_r
-00041050: 6f77 2e63 6f6c 756d 6e73 3a0a 2020 2020  ow.columns:.    
-00041060: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00041070: 6966 2063 6f6c 203d 3d20 2252 4f49 223a  if col == "ROI":
-00041080: 200a 2020 2020 2020 2020 2020 2020 2020   .              
-00041090: 2020 2020 2020 2020 2020 636f 6e74 696e            contin
-000410a0: 7565 0a20 2020 2020 2020 2020 2020 2020  ue.             
-000410b0: 2020 2020 2020 2064 665f 726f 775b 636f         df_row[co
-000410c0: 6c5d 203d 2022 2d2d 220a 0a20 2020 2020  l] = "--"..     
-000410d0: 2020 2020 2020 2023 2053 6574 2052 4f49         # Set ROI
-000410e0: 206e 616d 6520 746f 2068 6176 6520 636f   name to have co
-000410f0: 6c6f 7265 6420 6261 636b 6772 6f75 6e64  lored background
-00041100: 2069 6620 7265 7175 6573 7465 640a 2020   if requested.  
-00041110: 2020 2020 2020 2020 2020 6966 2063 6f6c            if col
-00041120: 6f72 6564 3a0a 2020 2020 2020 2020 2020  ored:.          
-00041130: 2020 2020 2020 636f 6c6f 7220 3d20 726f        color = ro
-00041140: 692e 6765 745f 636f 6c6f 725f 6672 6f6d  i.get_color_from
-00041150: 5f6b 7761 7267 7328 726f 695f 6b77 6172  _kwargs(roi_kwar
-00041160: 6773 290a 2020 2020 2020 2020 2020 2020  gs).            
-00041170: 2020 2020 636f 6c5f 7374 7220 3d20 6765      col_str = ge
-00041180: 745f 636f 6c6f 7265 645f 726f 695f 7374  t_colored_roi_st
-00041190: 7269 6e67 280a 2020 2020 2020 2020 2020  ring(.          
-000411a0: 2020 2020 2020 2020 2020 2020 2020 726f                ro
-000411b0: 692c 2067 7265 793d 2872 6f69 2069 6e20  i, grey=(roi in 
-000411c0: 6772 6579 6564 5f6f 7574 292c 2063 6f6c  greyed_out), col
-000411d0: 6f72 3d63 6f6c 6f72 290a 2020 2020 2020  or=color).      
-000411e0: 2020 2020 2020 2020 2020 6966 206e 616d            if nam
-000411f0: 655f 6173 5f69 6e64 6578 3a0a 2020 2020  e_as_index:.    
-00041200: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00041210: 6466 5f72 6f77 2e72 656e 616d 6528 7b64  df_row.rename({d
-00041220: 665f 726f 772e 696e 6465 785b 305d 3a20  f_row.index[0]: 
-00041230: 636f 6c5f 7374 727d 2c20 696e 706c 6163  col_str}, inplac
-00041240: 653d 5472 7565 290a 2020 2020 2020 2020  e=True).        
-00041250: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-00041260: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00041270: 2020 6466 5f72 6f77 2e69 6c6f 635b 302c    df_row.iloc[0,
-00041280: 2030 5d20 3d20 636f 6c5f 7374 720a 0a20   0] = col_str.. 
-00041290: 2020 2020 2020 2020 2020 2072 6f77 732e             rows.
-000412a0: 6170 7065 6e64 2864 665f 726f 7729 0a0a  append(df_row)..
-000412b0: 2020 2020 2020 2020 6466 203d 2070 642e          df = pd.
-000412c0: 636f 6e63 6174 2872 6f77 7329 0a0a 2020  concat(rows)..  
-000412d0: 2020 2020 2020 2320 5265 7365 7420 696e        # Reset in
-000412e0: 6465 7820 6966 206e 6f74 2075 7369 6e67  dex if not using
-000412f0: 2052 4f49 206e 616d 6573 2061 7320 696e   ROI names as in
-00041300: 6465 780a 2020 2020 2020 2020 6966 206e  dex.        if n
-00041310: 6f74 206e 616d 655f 6173 5f69 6e64 6578  ot name_as_index
-00041320: 3a0a 2020 2020 2020 2020 2020 2020 6466  :.            df
-00041330: 203d 2064 662e 7265 7365 745f 696e 6465   = df.reset_inde
-00041340: 7828 6472 6f70 3d54 7275 6529 0a0a 2020  x(drop=True)..  
-00041350: 2020 2020 2020 2320 436f 6e76 6572 7420        # Convert 
-00041360: 746f 2048 544d 4c20 6966 206e 6565 6465  to HTML if neede
-00041370: 640a 2020 2020 2020 2020 6966 2068 746d  d.        if htm
-00041380: 6c3a 0a20 2020 2020 2020 2020 2020 2072  l:.            r
-00041390: 6574 7572 6e20 6466 5f74 6f5f 6874 6d6c  eturn df_to_html
-000413a0: 2864 6629 0a20 2020 2020 2020 2072 6574  (df).        ret
-000413b0: 7572 6e20 6466 0a0a 2020 2020 6465 6620  urn df..    def 
-000413c0: 6765 745f 636f 6d70 6172 6973 6f6e 280a  get_comparison(.
-000413d0: 2020 2020 2020 2020 7365 6c66 2c20 0a20          self, . 
-000413e0: 2020 2020 2020 206f 7468 6572 3d4e 6f6e         other=Non
-000413f0: 652c 200a 2020 2020 2020 2020 636f 6d70  e, .        comp
-00041400: 5f74 7970 653d 2261 7574 6f22 2c20 0a20  _type="auto", . 
-00041410: 2020 2020 2020 2063 6f6e 7365 6e73 7573         consensus
-00041420: 5f74 7970 653d 226d 616a 6f72 6974 7922  _type="majority"
-00041430: 2c20 0a20 2020 2020 2020 202a 2a6b 7761  , .        **kwa
-00041440: 7267 730a 2020 2020 293a 0a20 2020 2020  rgs.    ):.     
-00041450: 2020 2022 2222 4765 7420 7061 6e64 6173     """Get pandas
-00041460: 2044 6174 6146 7261 6d65 206f 6620 636f   DataFrame of co
-00041470: 6d70 6172 6973 6f6e 206d 6574 7269 6373  mparison metrics
-00041480: 2076 7320 6120 7369 6e67 6c65 2052 4f49   vs a single ROI
-00041490: 206f 720a 2020 2020 2020 2020 616e 6f74   or.        anot
-000414a0: 6865 7220 5374 7275 6374 7572 6553 6574  her StructureSet
-000414b0: 2e0a 0a20 2020 2020 2020 202a 2a50 6172  ...        **Par
-000414c0: 616d 6574 6572 732a 2a3a 0a0a 2020 2020  ameters**:..    
-000414d0: 2020 2020 6f74 6865 7220 3a20 524f 492f      other : ROI/
-000414e0: 5374 7275 6374 7572 6553 6574 2c20 6465  StructureSet, de
-000414f0: 6661 756c 743d 4e6f 6e65 0a20 2020 2020  fault=None.     
-00041500: 2020 2020 2020 204f 626a 6563 7420 746f         Object to
-00041510: 2063 6f6d 7061 7265 206f 776e 2052 4f49   compare own ROI
-00041520: 7320 7769 7468 2e20 4361 6e20 6569 7468  s with. Can eith
-00041530: 6572 2062 6520 6120 7369 6e67 6c65 2052  er be a single R
-00041540: 4f49 2c20 7768 6963 680a 2020 2020 2020  OI, which.      
-00041550: 2020 2020 2020 7769 6c6c 2062 6520 636f        will be co
-00041560: 6d70 6172 6564 2074 6f20 6576 6572 7920  mpared to every 
-00041570: 524f 4920 696e 2074 6869 7320 7374 7275  ROI in this stru
-00041580: 6374 7572 6520 7365 742c 206f 7220 616e  cture set, or an
-00041590: 6f74 6865 720a 2020 2020 2020 2020 2020  other.          
-000415a0: 2020 7374 7275 6374 7572 6520 7365 742e    structure set.
-000415b0: 2049 6620 4e6f 6e65 2c20 6120 636f 6d70   If None, a comp
-000415c0: 6172 6973 6f6e 2077 696c 6c20 6265 2070  arison will be p
-000415d0: 6572 666f 726d 6564 2062 6574 7765 656e  erformed between
-000415e0: 2074 6865 200a 2020 2020 2020 2020 2020   the .          
-000415f0: 2020 524f 4973 206f 6620 7468 6973 2073    ROIs of this s
-00041600: 7472 7563 7475 7265 2073 6574 2e0a 0a20  tructure set... 
-00041610: 2020 2020 2020 2063 6f6d 705f 7479 7065         comp_type
-00041620: 203a 2073 7472 2c20 6465 6661 756c 743d   : str, default=
-00041630: 2261 7574 6f22 0a20 2020 2020 2020 2020  "auto".         
-00041640: 2020 204d 6574 686f 6420 666f 7220 7365     Method for se
-00041650: 6c65 6374 696e 6720 7768 6963 6820 524f  lecting which RO
-00041660: 4973 2073 686f 756c 6420 6265 2063 6f6d  Is should be com
-00041670: 7061 7265 6420 6966 206f 7468 6572 3d4e  pared if other=N
-00041680: 6f6e 650a 2020 2020 2020 2020 2020 2020  one.            
-00041690: 6f72 206f 7468 6572 2069 7320 6120 5374  or other is a St
-000416a0: 7275 6374 7572 6553 6574 2e20 4f70 7469  ructureSet. Opti
-000416b0: 6f6e 7320 6172 653a 0a0a 2020 2020 2020  ons are:..      
-000416c0: 2020 2020 2020 2020 2020 2d20 2261 6c6c            - "all
-000416d0: 2220 3a20 636f 6d70 6172 6520 6576 6572  " : compare ever
-000416e0: 7920 524f 4920 696e 206f 6e65 2073 7472  y ROI in one str
-000416f0: 7563 7475 7265 2073 6574 2074 6f20 6576  ucture set to ev
-00041700: 6572 7920 524f 490a 2020 2020 2020 2020  ery ROI.        
-00041710: 2020 2020 2020 2020 696e 2074 6865 206f          in the o
-00041720: 7468 6572 2028 7265 6d6f 7669 6e67 2063  ther (removing c
-00041730: 6f6d 7061 7269 736f 6e73 206f 6620 616e  omparisons of an
-00041740: 2052 4f49 2074 6f20 6974 7365 6c66 292e   ROI to itself).
-00041750: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00041760: 202d 2022 6279 5f6e 616d 6522 203a 2063   - "by_name" : c
-00041770: 6f6d 7061 7265 2065 7665 7279 2052 4f49  ompare every ROI
-00041780: 2069 6e20 6f6e 6520 7374 7275 6374 7572   in one structur
-00041790: 6520 7365 740a 2020 2020 2020 2020 2020  e set.          
-000417a0: 2020 2020 2020 746f 2065 7665 7279 2052        to every R
-000417b0: 4f49 2069 6e20 7468 6520 6f74 6865 7220  OI in the other 
-000417c0: 7769 7468 2074 6865 2073 616d 6520 6e61  with the same na
-000417d0: 6d65 2e20 5573 6566 756c 2077 6865 6e0a  me. Useful when.
-000417e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000417f0: 636f 6d70 6172 696e 6720 7477 6f20 7374  comparing two st
-00041800: 7275 6374 7572 6520 7365 7473 2063 6f6e  ructure sets con
-00041810: 7461 696e 696e 6720 524f 4973 2077 6974  taining ROIs wit
-00041820: 6820 7468 6520 7361 6d65 0a20 2020 2020  h the same.     
-00041830: 2020 2020 2020 2020 2020 206e 616d 6573             names
-00041840: 2e0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00041850: 2020 2d20 2263 6f6e 7365 6e73 7573 2220    - "consensus" 
-00041860: 3a20 6966 206f 7468 6572 3d4e 6f6e 652c  : if other=None,
-00041870: 2063 6f6d 7061 7265 2065 6163 6820 524f   compare each RO
-00041880: 4920 696e 2074 6869 7320 0a20 2020 2020  I in this .     
-00041890: 2020 2020 2020 2020 2020 2073 7472 7563             struc
-000418a0: 7475 7265 2073 6574 2074 6f20 7468 6520  ture set to the 
-000418b0: 636f 6e73 656e 7375 7320 6f66 2061 6c6c  consensus of all
-000418c0: 206f 7468 6572 2052 4f49 733b 206f 7468   other ROIs; oth
-000418d0: 6572 7769 7365 2c0a 2020 2020 2020 2020  erwise,.        
-000418e0: 2020 2020 2020 2020 636f 6d70 6172 6520          compare 
-000418f0: 6561 6368 2052 4f49 2069 6e20 7468 6973  each ROI in this
-00041900: 2073 7472 7563 7475 7265 2073 6574 2074   structure set t
-00041910: 6f20 7468 6520 636f 6e73 656e 7375 7320  o the consensus 
-00041920: 6f66 0a20 2020 2020 2020 2020 2020 2020  of.             
-00041930: 2020 2061 6c6c 2052 4f49 7320 696e 2074     all ROIs in t
-00041940: 6865 206f 7468 6572 2073 7472 7563 7475  he other structu
-00041950: 7265 2073 6574 2e20 436f 6e73 656e 7375  re set. Consensu
-00041960: 7320 7479 7065 2069 7320 7365 7420 7669  s type is set vi
-00041970: 610a 2020 2020 2020 2020 2020 2020 2020  a.              
-00041980: 2020 7468 6520 636f 6e73 656e 7375 735f    the consensus_
-00041990: 7479 7065 2061 7267 756d 656e 742e 0a20  type argument.. 
-000419a0: 2020 2020 2020 2020 2020 2020 2020 202d                 -
-000419b0: 2022 6175 746f 2220 3a20 6966 206f 7468   "auto" : if oth
-000419c0: 6572 3d4e 6f6e 652c 2075 7365 2022 616c  er=None, use "al
-000419d0: 6c22 2063 6f6d 7061 7269 736f 6e2e 204f  l" comparison. O
-000419e0: 7468 6572 7769 7365 2c20 0a20 2020 2020  therwise, .     
-000419f0: 2020 2020 2020 2020 2020 2066 6972 7374             first
-00041a00: 206c 6f6f 6b20 666f 7220 616e 7920 524f   look for any RO
-00041a10: 4973 2077 6974 6820 6d61 7463 6869 6e67  Is with matching
-00041a20: 206e 616d 6573 3b20 6966 2061 7420 6c65   names; if at le
-00041a30: 6173 7420 6f6e 6520 0a20 2020 2020 2020  ast one .       
-00041a40: 2020 2020 2020 2020 206d 6174 6368 696e           matchin
-00041a50: 6720 7061 6972 2069 7320 666f 756e 642c  g pair is found,
-00041a60: 2063 6f6d 7061 7265 2076 6961 2074 6865   compare via the
-00041a70: 2022 6279 5f6e 616d 6522 2063 6f6d 7061   "by_name" compa
-00041a80: 7269 736f 6e20 0a20 2020 2020 2020 2020  rison .         
-00041a90: 2020 2020 2020 2074 7970 652e 2049 6620         type. If 
-00041aa0: 6e6f 206d 6174 6368 6573 2061 7265 2066  no matches are f
-00041ab0: 6f75 6e64 2c20 636f 6d70 6172 6520 7669  ound, compare vi
-00041ac0: 6120 7468 6520 2261 6c6c 2220 636f 6d70  a the "all" comp
-00041ad0: 6172 6973 6f6e 200a 2020 2020 2020 2020  arison .        
-00041ae0: 2020 2020 2020 2020 7479 7065 2e0a 0a20          type... 
-00041af0: 2020 2020 2020 2063 6f6e 7365 6e73 7573         consensus
-00041b00: 5f74 7970 6520 3a20 7374 722c 2064 6566  _type : str, def
-00041b10: 6175 6c74 3d22 6d61 6a6f 7269 7479 2076  ault="majority v
-00041b20: 6f74 6522 0a20 2020 2020 2020 2020 2020  ote".           
-00041b30: 204d 6574 686f 6420 666f 7220 6361 6c63   Method for calc
-00041b40: 756c 6174 696e 6720 636f 6e73 656e 7375  ulating consensu
-00041b50: 7320 6f66 2052 4f49 7320 6966 2075 7369  s of ROIs if usi
-00041b60: 6e67 2074 6865 2022 636f 6e73 656e 7375  ng the "consensu
-00041b70: 7322 0a20 2020 2020 2020 2020 2020 2063  s".            c
-00041b80: 6f6d 7061 7269 736f 6e20 7479 7065 2e20  omparison type. 
-00041b90: 4f70 7469 6f6e 7320 6172 653a 0a0a 2020  Options are:..  
-00041ba0: 2020 2020 2020 2020 2020 2020 2020 2d20                - 
-00041bb0: 226d 616a 6f72 6974 7922 203a 2075 7365  "majority" : use
-00041bc0: 206d 616a 6f72 6974 7920 766f 7465 206f   majority vote o
-00041bd0: 6620 524f 4973 2028 692e 652e 2076 6f78  f ROIs (i.e. vox
-00041be0: 656c 7320 7768 6572 650a 2020 2020 2020  els where.      
-00041bf0: 2020 2020 2020 2020 2020 6174 206c 6561            at lea
-00041c00: 7374 2068 616c 6620 6f66 2074 6865 2052  st half of the R
-00041c10: 4f49 7320 6578 6973 7429 2e0a 2020 2020  OIs exist)..    
-00041c20: 2020 2020 2020 2020 2020 2020 2d20 226f              - "o
-00041c30: 7665 726c 6170 2220 3a20 7573 6520 6f76  verlap" : use ov
-00041c40: 6572 6c61 7020 6f66 2052 4f49 732e 0a20  erlap of ROIs.. 
-00041c50: 2020 2020 2020 2020 2020 2020 2020 202d                 -
-00041c60: 2022 7375 6d22 203a 2075 7365 2073 756d   "sum" : use sum
-00041c70: 206f 6620 524f 4973 2e0a 2020 2020 2020   of ROIs..      
-00041c80: 2020 2020 2020 2020 2020 2d20 2273 7461            - "sta
-00041c90: 706c 6522 203a 2075 7365 2074 6865 2053  ple" : use the S
-00041ca0: 5441 504c 4520 616c 676f 7269 7468 6d20  TAPLE algorithm 
-00041cb0: 746f 2063 616c 6375 6c61 7465 2063 6f6e  to calculate con
-00041cc0: 7365 6e73 7573 2e0a 0a20 2020 2020 2020  sensus...       
-00041cd0: 2068 746d 6c20 3a20 626f 6f6c 2c20 6465   html : bool, de
-00041ce0: 6661 756c 743d 4661 6c73 650a 2020 2020  fault=False.    
-00041cf0: 2020 2020 2020 2020 4966 2054 7275 652c          If True,
-00041d00: 2074 6865 2074 6162 6c65 2077 696c 6c20   the table will 
-00041d10: 6265 2063 6f6e 7665 7274 6564 2074 6f20  be converted to 
-00041d20: 4854 4d4c 2074 6578 7420 636f 6c6f 722d  HTML text color-
-00041d30: 636f 6465 6420 6261 7365 640a 2020 2020  coded based.    
-00041d40: 2020 2020 2020 2020 6f6e 2052 4f49 2063          on ROI c
-00041d50: 6f6c 6f72 732e 0a0a 2020 2020 2020 2020  olors...        
-00041d60: 6772 6579 6564 5f6f 7574 203a 2062 6f6f  greyed_out : boo
-00041d70: 6c2c 2064 6566 6175 6c74 3d4e 6f6e 650a  l, default=None.
-00041d80: 2020 2020 2020 2020 2020 2020 4c69 7374              List
-00041d90: 206f 6620 524f 4973 2074 6861 7420 7368   of ROIs that sh
-00041da0: 6f75 6c64 2062 6520 6772 6579 6564 206f  ould be greyed o
-00041db0: 7574 2028 6769 7665 6e20 6120 6772 6579  ut (given a grey
-00041dc0: 2062 6163 6b67 726f 756e 640a 2020 2020   background.    
-00041dd0: 2020 2020 2020 2020 746f 2074 6865 6972          to their
-00041de0: 2074 6578 7429 2069 6620 7265 7475 726e   text) if return
-00041df0: 696e 6720 616e 2048 544d 4c20 7374 7269  ing an HTML stri
-00041e00: 6e67 2e0a 0a20 2020 2020 2020 2060 2a2a  ng...        `**
-00041e10: 606b 7761 7267 7320 3a20 0a20 2020 2020  `kwargs : .     
-00041e20: 2020 2020 2020 204b 6579 776f 7264 2061         Keyword a
-00041e30: 7267 7320 746f 2070 6173 7320 746f 2052  rgs to pass to R
-00041e40: 4f49 2e67 6574 5f63 6f6d 7061 7269 736f  OI.get_compariso
-00041e50: 6e28 292e 2053 6565 200a 2020 2020 2020  n(). See .      
-00041e60: 2020 2020 2020 524f 492e 6765 745f 636f        ROI.get_co
-00041e70: 6d70 6172 6973 6f6e 2829 2064 6f63 756d  mparison() docum
-00041e80: 656e 7461 7469 6f6e 2066 6f72 2064 6574  entation for det
-00041e90: 6169 6c73 2e0a 2020 2020 2020 2020 2222  ails..        ""
-00041ea0: 220a 0a20 2020 2020 2020 2064 6673 203d  "..        dfs =
-00041eb0: 205b 5d0a 0a20 2020 2020 2020 2069 6620   []..        if 
-00041ec0: 6973 696e 7374 616e 6365 286f 7468 6572  isinstance(other
-00041ed0: 2c20 524f 4929 3a0a 2020 2020 2020 2020  , ROI):.        
-00041ee0: 2020 2020 7061 6972 7320 3d20 5b28 726f      pairs = [(ro
-00041ef0: 692c 206f 7468 6572 2920 666f 7220 726f  i, other) for ro
-00041f00: 6920 696e 2073 656c 662e 6765 745f 726f  i in self.get_ro
-00041f10: 6973 2869 676e 6f72 655f 656d 7074 793d  is(ignore_empty=
-00041f20: 5472 7565 295d 0a20 2020 2020 2020 2065  True)].        e
-00041f30: 6c69 6620 6973 696e 7374 616e 6365 286f  lif isinstance(o
-00041f40: 7468 6572 2c20 5374 7275 6374 7572 6553  ther, StructureS
-00041f50: 6574 2920 6f72 206f 7468 6572 2069 7320  et) or other is 
-00041f60: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-00041f70: 2020 7061 6972 7320 3d20 7365 6c66 2e67    pairs = self.g
-00041f80: 6574 5f63 6f6d 7061 7269 736f 6e5f 7061  et_comparison_pa
-00041f90: 6972 7328 6f74 6865 722c 2063 6f6d 705f  irs(other, comp_
-00041fa0: 7479 7065 2c20 636f 6e73 656e 7375 735f  type, consensus_
-00041fb0: 7479 7065 290a 2020 2020 2020 2020 656c  type).        el
-00041fc0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-00041fd0: 7261 6973 6520 5479 7065 4572 726f 7228  raise TypeError(
-00041fe0: 223c 6f74 6865 723e 206d 7573 7420 6265  "<other> must be
-00041ff0: 2052 4f49 206f 7220 5374 7275 6374 7572   ROI or Structur
-00042000: 6553 6574 2122 290a 0a20 2020 2020 2020  eSet!")..       
-00042010: 2072 6574 7572 6e20 636f 6d70 6172 655f   return compare_
-00042020: 726f 695f 7061 6972 7328 7061 6972 732c  roi_pairs(pairs,
-00042030: 202a 2a6b 7761 7267 7329 0a0a 2020 2020   **kwargs)..    
-00042040: 6465 6620 6765 745f 636f 6d70 6172 6973  def get_comparis
-00042050: 6f6e 5f70 6169 7273 2873 656c 662c 206f  on_pairs(self, o
-00042060: 7468 6572 3d4e 6f6e 652c 2063 6f6d 705f  ther=None, comp_
-00042070: 7479 7065 3d22 6175 746f 222c 200a 2020  type="auto", .  
-00042080: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00042090: 2020 2020 2020 2020 2020 2063 6f6e 7365             conse
-000420a0: 6e73 7573 5f74 7970 653d 226d 616a 6f72  nsus_type="major
-000420b0: 6974 7922 2c20 0a20 2020 2020 2020 2020  ity", .         
-000420c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000420d0: 2020 2020 636f 6e73 656e 7375 735f 636f      consensus_co
-000420e0: 6c6f 723d 2262 6c75 6522 293a 0a20 2020  lor="blue"):.   
-000420f0: 2020 2020 2022 2222 4765 7420 6c69 7374       """Get list
-00042100: 206f 6620 524f 4973 2074 6f20 636f 6d70   of ROIs to comp
-00042110: 6172 6520 7769 7468 206f 6e65 2061 6e6f  are with one ano
-00042120: 7468 6572 2e22 2222 0a0a 2020 2020 2020  ther."""..      
-00042130: 2020 2320 4368 6563 6b20 636f 6d70 5f74    # Check comp_t
-00042140: 7970 6520 6973 2076 616c 6964 0a20 2020  ype is valid.   
-00042150: 2020 2020 2076 616c 6964 5f63 6f6d 705f       valid_comp_
-00042160: 7479 7065 7320 3d20 5b22 616c 6c22 2c20  types = ["all", 
-00042170: 2262 795f 6e61 6d65 222c 2022 636f 6e73  "by_name", "cons
-00042180: 656e 7375 7322 2c20 2261 7574 6f22 5d0a  ensus", "auto"].
-00042190: 2020 2020 2020 2020 6966 2063 6f6d 705f          if comp_
-000421a0: 7479 7065 206e 6f74 2069 6e20 7661 6c69  type not in vali
-000421b0: 645f 636f 6d70 5f74 7970 6573 3a0a 2020  d_comp_types:.  
-000421c0: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-000421d0: 5661 6c75 6545 7272 6f72 2866 2255 6e72  ValueError(f"Unr
-000421e0: 6563 6f67 6e69 7365 6420 636f 6d70 6172  ecognised compar
-000421f0: 6973 6f6e 2074 7970 6520 7b63 6f6d 705f  ison type {comp_
-00042200: 7479 7065 7d22 290a 0a20 2020 2020 2020  type}")..       
-00042210: 2023 2043 6f6e 7365 6e73 7573 2063 6f6d   # Consensus com
-00042220: 7061 7269 736f 6e0a 2020 2020 2020 2020  parison.        
-00042230: 6966 2063 6f6d 705f 7479 7065 203d 3d20  if comp_type == 
-00042240: 2263 6f6e 7365 6e73 7573 223a 0a20 2020  "consensus":.   
-00042250: 2020 2020 2020 2020 200a 2020 2020 2020           .      
-00042260: 2020 2020 2020 2320 4966 2063 6f6d 7061        # If compa
-00042270: 7269 6e67 2074 6f20 616e 6f74 6865 7220  ring to another 
-00042280: 5374 7275 6374 7572 6553 6574 2c20 7461  StructureSet, ta
-00042290: 6b65 2063 6f6e 7365 6e73 7573 206f 6620  ke consensus of 
-000422a0: 7468 6174 200a 2020 2020 2020 2020 2020  that .          
-000422b0: 2020 2320 656e 7469 7265 2053 7472 7563    # entire Struc
-000422c0: 7475 7265 5365 740a 2020 2020 2020 2020  tureSet.        
-000422d0: 2020 2020 6966 206f 7468 6572 2069 7320      if other is 
-000422e0: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
-000422f0: 2020 2020 2020 2020 2020 636f 6e73 656e            consen
-00042300: 7375 7320 3d20 6f74 6865 722e 6765 745f  sus = other.get_
-00042310: 636f 6e73 656e 7375 7328 636f 6e73 656e  consensus(consen
-00042320: 7375 735f 7479 7065 2c20 636f 6c6f 723d  sus_type, color=
-00042330: 636f 6e73 656e 7375 735f 636f 6c6f 7229  consensus_color)
-00042340: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00042350: 2072 6574 7572 6e20 5b28 726f 692c 2063   return [(roi, c
-00042360: 6f6e 7365 6e73 7573 2920 666f 7220 726f  onsensus) for ro
-00042370: 6920 696e 2073 656c 662e 6765 745f 726f  i in self.get_ro
-00042380: 6973 2869 676e 6f72 655f 656d 7074 793d  is(ignore_empty=
-00042390: 5472 7565 295d 0a0a 2020 2020 2020 2020  True)]..        
-000423a0: 2020 2020 2320 4f74 6865 7277 6973 652c      # Otherwise,
-000423b0: 2063 6f6d 7061 7265 2065 6163 6820 524f   compare each RO
-000423c0: 4920 746f 2063 6f6e 7365 6e73 7573 206f  I to consensus o
-000423d0: 6620 6f74 6865 7273 0a20 2020 2020 2020  f others.       
-000423e0: 2020 2020 2070 6169 7273 203d 205b 5d0a       pairs = [].
-000423f0: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-00042400: 726f 6920 696e 2073 656c 662e 6765 745f  roi in self.get_
-00042410: 726f 6973 2869 676e 6f72 655f 656d 7074  rois(ignore_empt
-00042420: 793d 5472 7565 293a 0a20 2020 2020 2020  y=True):.       
-00042430: 2020 2020 2020 2020 2070 6169 7273 2e61           pairs.a
-00042440: 7070 656e 6428 2872 6f69 2c20 7365 6c66  ppend((roi, self
-00042450: 2e67 6574 5f63 6f6e 7365 6e73 7573 2863  .get_consensus(c
-00042460: 6f6e 7365 6e73 7573 5f74 7970 652c 200a  onsensus_type, .
+00039550: 2020 2020 2020 2020 2020 2020 2023 2066               # f
+00039560: 726f 6d20 7768 6963 6820 6974 206f 7269  rom which it ori
+00039570: 6769 6e61 7465 732e 0a20 2020 2020 2020  ginates..       
+00039580: 2020 2020 2020 2020 2069 6620 2872 6f69           if (roi
+00039590: 2e6e 616d 652e 7370 6c69 7428 225f 2229  .name.split("_")
+000395a0: 5b30 5d20 696e 2072 6573 756c 742e 7375  [0] in result.su
+000395b0: 6d6d 6564 5f6e 616d 6573 0a20 2020 2020  mmed_names.     
+000395c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000395d0: 2020 206f 7220 7373 2e6e 616d 6520 6973     or ss.name is
+000395e0: 204e 6f6e 6529 3a0a 2020 2020 2020 2020   None):.        
+000395f0: 2020 2020 2020 2020 2020 2020 726f 695f              roi_
+00039600: 636c 6f6e 652e 6e61 6d65 203d 2072 6f69  clone.name = roi
+00039610: 2e6e 616d 650a 2020 2020 2020 2020 2020  .name.          
+00039620: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+00039630: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00039640: 726f 695f 636c 6f6e 652e 6e61 6d65 203d  roi_clone.name =
+00039650: 2022 5f22 2e6a 6f69 6e28 5b73 732e 6e61   "_".join([ss.na
+00039660: 6d65 2c20 726f 692e 6e61 6d65 5d29 0a20  me, roi.name]). 
+00039670: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+00039680: 2041 6464 2052 4f49 2074 6f20 7468 6520   Add ROI to the 
+00039690: 7265 7375 6c74 2e0a 2020 2020 2020 2020  result..        
+000396a0: 2020 2020 2020 2020 7265 7375 6c74 2e61          result.a
+000396b0: 6464 5f72 6f69 2872 6f69 5f63 6c6f 6e65  dd_roi(roi_clone
+000396c0: 290a 0a20 2020 2020 2020 2023 2041 7320  )..        # As 
+000396d0: 7265 7375 6c74 2069 6d61 6765 2073 6574  result image set
+000396e0: 2074 6865 2069 6d61 6765 206f 6620 7365   the image of se
+000396f0: 6c66 2069 6620 6e6f 6e2d 6e75 6c6c 2c0a  lf if non-null,.
+00039700: 2020 2020 2020 2020 2320 6f72 206f 7468          # or oth
+00039710: 7769 7365 2074 6865 2069 6d61 6765 206f  wise the image o
+00039720: 6620 6f74 6865 722e 0a20 2020 2020 2020  f other..       
+00039730: 2069 6d61 6765 203d 2073 656c 662e 696d   image = self.im
+00039740: 6167 6520 6966 2073 656c 662e 696d 6167  age if self.imag
+00039750: 6520 656c 7365 206f 7468 6572 2e69 6d61  e else other.ima
+00039760: 6765 0a20 2020 2020 2020 2072 6573 756c  ge.        resul
+00039770: 742e 7365 745f 696d 6167 6528 696d 6167  t.set_image(imag
+00039780: 6529 0a0a 2020 2020 2020 2020 2320 5365  e)..        # Se
+00039790: 7420 7468 6520 7265 7375 6c74 206e 616d  t the result nam
+000397a0: 6520 746f 2062 6520 7468 6520 636f 6e63  e to be the conc
+000397b0: 6174 656e 6174 696f 6e20 6f66 2074 6865  atenation of the
+000397c0: 206e 616d 6573 0a20 2020 2020 2020 2023   names.        #
+000397d0: 206f 6620 7468 6520 636f 6e74 7269 6275   of the contribu
+000397e0: 746f 7273 2e0a 2020 2020 2020 2020 6966  tors..        if
+000397f0: 2072 6573 756c 742e 7375 6d6d 6564 5f6e   result.summed_n
+00039800: 616d 6573 3a0a 2020 2020 2020 2020 2020  ames:.          
+00039810: 2020 7265 7375 6c74 2e6e 616d 6520 3d20    result.name = 
+00039820: 225f 222e 6a6f 696e 2872 6573 756c 742e  "_".join(result.
+00039830: 7375 6d6d 6564 5f6e 616d 6573 290a 0a20  summed_names).. 
+00039840: 2020 2020 2020 2072 6574 7572 6e20 7265         return re
+00039850: 7375 6c74 0a0a 2020 2020 6465 6620 5f5f  sult..    def __
+00039860: 6961 6464 5f5f 2873 656c 662c 206f 7468  iadd__(self, oth
+00039870: 6572 293a 0a20 2020 2020 2020 2027 2727  er):.        '''
+00039880: 0a20 2020 2020 2020 2044 6566 696e 6520  .        Define 
+00039890: 696e 2d70 6c61 6365 206f 6620 5374 7275  in-place of Stru
+000398a0: 6374 7572 6553 6574 2069 6e73 7461 6e63  ctureSet instanc
+000398b0: 6573 2e0a 0a20 2020 2020 2020 2054 6865  es...        The
+000398c0: 2072 6573 756c 7420 6f66 2074 6865 2061   result of the a
+000398d0: 6464 6974 696f 6e20 6f66 2073 656c 6620  ddition of self 
+000398e0: 616e 6420 6f74 6865 7220 6973 2061 2053  and other is a S
+000398f0: 7472 7563 7475 7265 5365 740a 2020 2020  tructureSet.    
+00039900: 2020 2020 6f62 6a65 6374 2074 6861 7420      object that 
+00039910: 636f 6e74 6169 6e73 2074 6865 2028 636c  contains the (cl
+00039920: 6f6e 6564 2920 524f 4973 206f 6620 626f  oned) ROIs of bo
+00039930: 7468 2e20 2041 2072 6573 756c 7420 524f  th.  A result RO
+00039940: 490a 2020 2020 2020 2020 7769 6c6c 2062  I.        will b
+00039950: 6520 7072 6566 6978 6564 2062 7920 7468  e prefixed by th
+00039960: 6520 6e61 6d65 206f 6620 7468 6520 5374  e name of the St
+00039970: 7275 6374 7572 6553 6574 2066 726f 6d20  ructureSet from 
+00039980: 7768 6963 6820 6974 0a20 2020 2020 2020  which it.       
+00039990: 206f 7269 6769 6e61 7465 732e 2020 4966   originates.  If
+000399a0: 2074 6865 2052 4f49 206e 616d 6520 6265   the ROI name be
+000399b0: 666f 7265 2074 6865 2061 6464 6974 696f  fore the additio
+000399c0: 6e20 6861 7320 7468 6520 5374 7275 6374  n has the Struct
+000399d0: 7572 6553 6574 0a20 2020 2020 2020 206e  ureSet.        n
+000399e0: 616d 6520 6173 2070 7265 6669 782c 206e  ame as prefix, n
+000399f0: 6f20 6e65 7720 7072 6566 6978 2069 7320  o new prefix is 
+00039a00: 6164 6465 642e 2020 5468 6572 6520 6973  added.  There is
+00039a10: 206e 6f20 7265 7175 6972 656d 656e 740a   no requirement.
+00039a20: 2020 2020 2020 2020 7468 6174 2052 4f49          that ROI
+00039a30: 7320 6f72 2074 6865 6972 206e 616d 6573  s or their names
+00039a40: 2062 6520 756e 6971 7565 2077 6974 6869   be unique withi
+00039a50: 6e20 6120 5374 7275 6374 7572 6553 6574  n a StructureSet
+00039a60: 2e20 2041 6464 696e 670a 2020 2020 2020  .  Adding.      
+00039a70: 2020 6120 5374 7275 6374 7572 6553 6574    a StructureSet
+00039a80: 2074 6f20 6974 7365 6c66 2077 696c 6c20   to itself will 
+00039a90: 6769 7665 2061 2072 6573 756c 7420 696e  give a result in
+00039aa0: 636c 7564 696e 6720 6475 706c 6963 6174  cluding duplicat
+00039ab0: 650a 2020 2020 2020 2020 524f 4973 2077  e.        ROIs w
+00039ac0: 6974 6820 6475 706c 6963 6174 6520 6e61  ith duplicate na
+00039ad0: 6d65 732e 0a20 2020 2020 2020 2027 2727  mes..        '''
+00039ae0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00039af0: 7365 6c66 202b 206f 7468 6572 0a0a 2020  self + other..  
+00039b00: 2020 6465 6620 6c6f 6164 2873 656c 662c    def load(self,
+00039b10: 2073 6f75 7263 6573 3d4e 6f6e 652c 2066   sources=None, f
+00039b20: 6f72 6365 3d46 616c 7365 293a 0a20 2020  orce=False):.   
+00039b30: 2020 2020 2022 2222 4c6f 6164 2073 7472       """Load str
+00039b40: 7563 7475 7265 2073 6574 2066 726f 6d20  ucture set from 
+00039b50: 736f 7572 6365 2873 292e 2049 6620 4e6f  source(s). If No
+00039b60: 6e65 2c20 7769 6c6c 206c 6f61 6420 6672  ne, will load fr
+00039b70: 6f6d 206f 776e 0a20 2020 2020 2020 2073  om own.        s
+00039b80: 656c 662e 736f 7572 6365 732e 2222 220a  elf.sources.""".
+00039b90: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
+00039ba0: 2e6c 6f61 6465 6420 616e 6420 6e6f 7420  .loaded and not 
+00039bb0: 666f 7263 6520 616e 6420 736f 7572 6365  force and source
+00039bc0: 7320 6973 204e 6f6e 653a 0a20 2020 2020  s is None:.     
+00039bd0: 2020 2020 2020 2072 6574 7572 6e0a 0a20         return.. 
+00039be0: 2020 2020 2020 2069 6620 736f 7572 6365         if source
+00039bf0: 7320 6973 204e 6f6e 653a 0a20 2020 2020  s is None:.     
+00039c00: 2020 2020 2020 2073 6f75 7263 6573 203d         sources =
+00039c10: 2073 656c 662e 736f 7572 6365 730a 0a20   self.sources.. 
+00039c20: 2020 2020 2020 2023 204c 616f 6420 6672         # Laod fr
+00039c30: 6f6d 206d 756c 7469 2d6c 6162 656c 2061  om multi-label a
+00039c40: 7272 6179 0a20 2020 2020 2020 2069 6620  rray.        if 
+00039c50: 7365 6c66 2e6d 756c 7469 5f6c 6162 656c  self.multi_label
+00039c60: 3a0a 0a20 2020 2020 2020 2020 2020 2069  :..            i
+00039c70: 6620 6973 696e 7374 616e 6365 2873 6f75  f isinstance(sou
+00039c80: 7263 6573 2c20 6c69 7374 2920 616e 6420  rces, list) and 
+00039c90: 6c65 6e28 736f 7572 6365 7329 203d 3d20  len(sources) == 
+00039ca0: 313a 0a20 2020 2020 2020 2020 2020 2020  1:.             
+00039cb0: 2020 2073 6f75 7263 6573 203d 2073 6f75     sources = sou
+00039cc0: 7263 6573 5b30 5d0a 2020 2020 2020 2020  rces[0].        
+00039cd0: 2020 2020 6966 206e 6f74 2069 7369 6e73      if not isins
+00039ce0: 7461 6e63 6528 736f 7572 6365 732c 2073  tance(sources, s
+00039cf0: 7472 2920 616e 6420 6e6f 7420 6973 696e  tr) and not isin
+00039d00: 7374 616e 6365 2873 6f75 7263 6573 2c20  stance(sources, 
+00039d10: 6e70 2e6e 6461 7272 6179 293a 0a20 2020  np.ndarray):.   
+00039d20: 2020 2020 2020 2020 2020 2020 2072 6169               rai
+00039d30: 7365 2054 7970 6545 7272 6f72 2822 496e  se TypeError("In
+00039d40: 7075 7420 666f 7220 6120 6d75 6c74 692d  put for a multi-
+00039d50: 6c61 6265 6c20 696d 6167 6520 6d75 7374  label image must
+00039d60: 2062 6520 6669 6c65 7061 7468 2022 0a20   be filepath ". 
+00039d70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00039d80: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+00039d90: 226f 7220 6e75 6d70 7920 6172 7261 792e  "or numpy array.
+00039da0: 2054 7970 6520 666f 756e 643a 207b 7479   Type found: {ty
+00039db0: 7065 2873 6f75 7263 6573 297d 2e22 290a  pe(sources)}.").
+00039dc0: 2020 2020 2020 2020 2020 2020 7369 6e67              sing
+00039dd0: 6c65 5f73 6f75 7263 6520 3d20 5472 7565  le_source = True
+00039de0: 0a0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
+00039df0: 4c6f 6164 2069 6e70 7574 2061 7272 6179  Load input array
+00039e00: 2069 6e74 6f20 696d 6167 650a 2020 2020   into image.    
+00039e10: 2020 2020 2020 2020 6172 7261 7920 3d20          array = 
+00039e20: 736b 7274 2e69 6d61 6765 2e49 6d61 6765  skrt.image.Image
+00039e30: 2873 6f75 7263 6573 292e 6765 745f 6461  (sources).get_da
+00039e40: 7461 2873 7461 6e64 6172 6469 7365 3d54  ta(standardise=T
+00039e50: 7275 6529 2e61 7374 7970 6528 696e 7429  rue).astype(int)
+00039e60: 0a20 2020 2020 2020 2020 2020 206e 203d  .            n =
+00039e70: 2061 7272 6179 2e6d 6178 2829 0a0a 2020   array.max()..  
+00039e80: 2020 2020 2020 2020 2020 2320 456e 666f            # Enfo
+00039e90: 7263 6520 4469 636f 6d20 636f 6e76 656e  rce Dicom conven
+00039ea0: 7469 6f6e 2066 6f72 2064 6174 6120 6172  tion for data ar
+00039eb0: 7261 7920 6f66 2069 6d61 6765 206f 626a  ray of image obj
+00039ec0: 6563 742c 0a20 2020 2020 2020 2020 2020  ect,.           
+00039ed0: 2023 2073 6f20 7468 6174 2061 6666 696e   # so that affin
+00039ee0: 6520 6d61 7472 6978 2077 696c 6c20 6265  e matrix will be
+00039ef0: 2063 6f72 7265 6374 6c79 2064 6566 696e   correctly defin
+00039f00: 6564 2066 6f72 206d 6173 6b20 6372 6561  ed for mask crea
+00039f10: 7469 6f6e 2e0a 2020 2020 2020 2020 2020  tion..          
+00039f20: 2020 696d 203d 2073 6b72 742e 696d 6167    im = skrt.imag
+00039f30: 652e 496d 6167 6528 736f 7572 6365 7329  e.Image(sources)
+00039f40: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00039f50: 276e 6966 7469 2720 696e 2069 6d2e 736f  'nifti' in im.so
+00039f60: 7572 6365 5f74 7970 653a 0a20 2020 2020  urce_type:.     
+00039f70: 2020 2020 2020 2020 2020 2069 6d20 3d20             im = 
+00039f80: 696d 2e61 7374 7970 6528 2764 636d 2729  im.astype('dcm')
+00039f90: 0a20 2020 2020 2020 2020 2020 2069 5f6e  .            i_n
+00039fa0: 616d 6520 3d20 300a 2020 2020 2020 2020  ame = 0.        
+00039fb0: 2020 2020 666f 7220 6920 696e 2072 616e      for i in ran
+00039fc0: 6765 2830 2c20 6e29 3a0a 2020 2020 2020  ge(0, n):.      
+00039fd0: 2020 2020 2020 2020 2020 6966 2073 656c            if sel
+00039fe0: 662e 6e61 6d65 7320 6973 206e 6f74 204e  f.names is not N
+00039ff0: 6f6e 6520 616e 6420 695f 6e61 6d65 203c  one and i_name <
+0003a000: 206c 656e 2873 656c 662e 6e61 6d65 7329   len(self.names)
+0003a010: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0003a020: 2020 2020 2020 6e61 6d65 203d 2073 656c        name = sel
+0003a030: 662e 6e61 6d65 735b 695f 6e61 6d65 5d0a  f.names[i_name].
+0003a040: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003a050: 2020 2020 695f 6e61 6d65 202b 3d20 310a      i_name += 1.
+0003a060: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003a070: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+0003a080: 2020 2020 2020 2020 2020 6e61 6d65 203d            name =
+0003a090: 2066 2252 4f49 207b 697d 220a 0a20 2020   f"ROI {i}"..   
+0003a0a0: 2020 2020 2020 2020 2020 2020 2023 696d               #im
+0003a0b0: 322e 6461 7461 203d 2028 696d 312e 6461  2.data = (im1.da
+0003a0c0: 7461 203d 3d20 6920 2b20 3129 0a20 2020  ta == i + 1).   
+0003a0d0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+0003a0e0: 662e 726f 6973 2e61 7070 656e 6428 524f  f.rois.append(RO
+0003a0f0: 4928 0a20 2020 2020 2020 2020 2020 2020  I(.             
+0003a100: 2020 2020 2020 2061 7272 6179 203d 3d20         array == 
+0003a110: 6920 2b20 312c 200a 2020 2020 2020 2020  i + 1, .        
+0003a120: 2020 2020 2020 2020 2020 2020 6166 6669              affi
+0003a130: 6e65 203d 2069 6d2e 6765 745f 6166 6669  ne = im.get_affi
+0003a140: 6e65 2829 2c0a 2020 2020 2020 2020 2020  ne(),.          
+0003a150: 2020 2020 2020 2020 2020 766f 7865 6c5f            voxel_
+0003a160: 7369 7a65 203d 204e 6f6e 652c 0a20 2020  size = None,.   
+0003a170: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003a180: 206f 7269 6769 6e20 3d20 4e6f 6e65 2c0a   origin = None,.
+0003a190: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003a1a0: 2020 2020 696d 6167 653d 7365 6c66 2e69      image=self.i
+0003a1b0: 6d61 6765 2c0a 2020 2020 2020 2020 2020  mage,.          
+0003a1c0: 2020 2020 2020 2020 2020 6e61 6d65 3d6e            name=n
+0003a1d0: 616d 652c 0a20 2020 2020 2020 2020 2020  ame,.           
+0003a1e0: 2020 2020 2020 2020 202a 2a73 656c 662e           **self.
+0003a1f0: 726f 695f 6b77 6172 6773 0a20 2020 2020  roi_kwargs.     
+0003a200: 2020 2020 2020 2020 2020 2029 290a 2020             )).  
+0003a210: 2020 2020 2020 2020 2020 736f 7572 6365            source
+0003a220: 7320 3d20 5b5d 0a0a 2020 2020 2020 2020  s = []..        
+0003a230: 2020 2020 2320 466f 7220 4e49 6654 4920      # For NIfTI 
+0003a240: 736f 7572 6365 2c20 7265 7665 7274 2074  source, revert t
+0003a250: 6f20 4e49 6654 4920 636f 6e76 656e 7469  o NIfTI conventi
+0003a260: 6f6e 2066 6f72 2064 6174 6120 6172 7261  on for data arra
+0003a270: 790a 2020 2020 2020 2020 2020 2020 2320  y.            # 
+0003a280: 6f66 206d 6173 6b2c 2073 6f20 7468 6174  of mask, so that
+0003a290: 2069 7420 6361 6e20 6265 2077 7269 7474   it can be writt
+0003a2a0: 656e 2063 6f72 7265 6374 6c79 2074 6f20  en correctly to 
+0003a2b0: 6669 6c65 2e0a 2020 2020 2020 2020 2020  file..          
+0003a2c0: 2020 6966 2027 6e69 6674 6927 2069 6e20    if 'nifti' in 
+0003a2d0: 696d 2e73 6f75 7263 655f 7479 7065 3a0a  im.source_type:.
+0003a2e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003a2f0: 666f 7220 6964 7820 696e 2072 616e 6765  for idx in range
+0003a300: 286c 656e 2873 656c 662e 726f 6973 2929  (len(self.rois))
+0003a310: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0003a320: 2020 2020 2020 7365 6c66 2e72 6f69 735b        self.rois[
+0003a330: 6964 785d 2e6d 6173 6b20 3d20 7365 6c66  idx].mask = self
+0003a340: 2e72 6f69 735b 6964 785d 2e6d 6173 6b2e  .rois[idx].mask.
+0003a350: 6173 7479 7065 2827 6e69 6927 290a 0a20  astype('nii').. 
+0003a360: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+0003a370: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
+0003a380: 736b 7274 2e63 6f72 652e 6973 5f6c 6973  skrt.core.is_lis
+0003a390: 7428 736f 7572 6365 7329 206f 7220 6973  t(sources) or is
+0003a3a0: 696e 7374 616e 6365 2873 6f75 7263 6573  instance(sources
+0003a3b0: 2c20 6e70 2e6e 6461 7272 6179 293a 0a20  , np.ndarray):. 
+0003a3c0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0003a3d0: 6f75 7263 6573 203d 205b 736f 7572 6365  ources = [source
+0003a3e0: 735d 0a20 2020 2020 2020 2020 2020 2020  s].             
+0003a3f0: 2020 2073 696e 676c 655f 736f 7572 6365     single_source
+0003a400: 203d 2054 7275 650a 2020 2020 2020 2020   = True.        
+0003a410: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+0003a420: 2020 2020 2020 2020 2020 7369 6e67 6c65            single
+0003a430: 5f73 6f75 7263 6520 3d20 4661 6c73 650a  _source = False.
+0003a440: 0a20 2020 2020 2020 2023 2045 7870 616e  .        # Expan
+0003a450: 6420 616e 7920 6469 7265 6374 6f72 6965  d any directorie
+0003a460: 730a 2020 2020 2020 2020 736f 7572 6365  s.        source
+0003a470: 735f 6578 7061 6e64 6564 203d 205b 5d0a  s_expanded = [].
+0003a480: 2020 2020 2020 2020 666f 7220 736f 7572          for sour
+0003a490: 6365 2069 6e20 736f 7572 6365 733a 0a20  ce in sources:. 
+0003a4a0: 2020 2020 2020 2020 2020 2069 6620 6973             if is
+0003a4b0: 696e 7374 616e 6365 2873 6f75 7263 652c  instance(source,
+0003a4c0: 2073 7472 2920 616e 6420 6f73 2e70 6174   str) and os.pat
+0003a4d0: 682e 6973 6469 7228 736f 7572 6365 293a  h.isdir(source):
+0003a4e0: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0003a4f0: 2020 736f 7572 6365 735f 6578 7061 6e64    sources_expand
+0003a500: 6564 2e65 7874 656e 6428 0a20 2020 2020  ed.extend(.     
+0003a510: 2020 2020 2020 2020 2020 2020 2020 205b                 [
+0003a520: 6f73 2e70 6174 682e 6a6f 696e 2873 6f75  os.path.join(sou
+0003a530: 7263 652c 2066 696c 6529 2066 6f72 2066  rce, file) for f
+0003a540: 696c 6520 696e 206f 732e 6c69 7374 6469  ile in os.listdi
+0003a550: 7228 736f 7572 6365 295d 0a20 2020 2020  r(source)].     
+0003a560: 2020 2020 2020 2020 2020 2029 0a0a 2020             )..  
+0003a570: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+0003a580: 4175 746f 2d61 7373 6967 6e20 6e61 6d65  Auto-assign name
+0003a590: 2074 6f20 6469 7265 6374 6f72 7920 6e61   to directory na
+0003a5a0: 6d65 0a20 2020 2020 2020 2020 2020 2020  me.             
+0003a5b0: 2020 2069 6620 7369 6e67 6c65 5f73 6f75     if single_sou
+0003a5c0: 7263 6520 616e 6420 7365 6c66 2e6e 616d  rce and self.nam
+0003a5d0: 6520 6973 204e 6f6e 653a 0a20 2020 2020  e is None:.     
+0003a5e0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0003a5f0: 656c 662e 6e61 6d65 203d 2073 6f75 7263  elf.name = sourc
+0003a600: 650a 0a20 2020 2020 2020 2020 2020 2065  e..            e
+0003a610: 6c69 6620 6e6f 7420 7365 6c66 2e6c 6f61  lif not self.loa
+0003a620: 6465 643a 0a20 2020 2020 2020 2020 2020  ded:.           
+0003a630: 2020 2020 2073 6f75 7263 6573 5f65 7870       sources_exp
+0003a640: 616e 6465 642e 6170 7065 6e64 2873 6f75  anded.append(sou
+0003a650: 7263 6529 0a0a 2020 2020 2020 2020 666f  rce)..        fo
+0003a660: 7220 736f 7572 6365 2069 6e20 736f 7274  r source in sort
+0003a670: 6564 2873 6f75 7263 6573 5f65 7870 616e  ed(sources_expan
+0003a680: 6465 6429 3a0a 0a20 2020 2020 2020 2020  ded):..         
+0003a690: 2020 2069 6620 6973 696e 7374 616e 6365     if isinstance
+0003a6a0: 2873 6f75 7263 652c 2052 4f49 293a 0a20  (source, ROI):. 
+0003a6b0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0003a6c0: 656c 662e 726f 6973 2e61 7070 656e 6428  elf.rois.append(
+0003a6d0: 736f 7572 6365 290a 2020 2020 2020 2020  source).        
+0003a6e0: 2020 2020 2020 2020 636f 6e74 696e 7565          continue
+0003a6f0: 0a0a 2020 2020 2020 2020 2020 2020 6966  ..            if
+0003a700: 2069 7369 6e73 7461 6e63 6528 736f 7572   isinstance(sour
+0003a710: 6365 2c20 7374 7229 3a0a 2020 2020 2020  ce, str):.      
+0003a720: 2020 2020 2020 2020 2020 6966 206f 732e            if os.
+0003a730: 7061 7468 2e62 6173 656e 616d 6528 736f  path.basename(so
+0003a740: 7572 6365 292e 7374 6172 7473 7769 7468  urce).startswith
+0003a750: 2822 2e22 2920 6f72 2073 6f75 7263 652e  (".") or source.
+0003a760: 656e 6473 7769 7468 2822 2e74 7874 2229  endswith(".txt")
+0003a770: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0003a780: 2020 2020 2020 636f 6e74 696e 7565 0a20        continue. 
+0003a790: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0003a7a0: 6620 6f73 2e70 6174 682e 6973 6469 7228  f os.path.isdir(
+0003a7b0: 736f 7572 6365 293a 0a20 2020 2020 2020  source):.       
+0003a7c0: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
+0003a7d0: 7469 6e75 650a 0a20 2020 2020 2020 2020  tinue..         
+0003a7e0: 2020 2023 2041 7474 656d 7074 2074 6f20     # Attempt to 
+0003a7f0: 6c6f 6164 2066 726f 6d20 6469 636f 6d0a  load from dicom.
+0003a800: 2020 2020 2020 2020 2020 2020 726f 6973              rois
+0003a810: 203d 205b 5d0a 2020 2020 2020 2020 2020   = [].          
+0003a820: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
+0003a830: 736f 7572 6365 2c20 7374 7229 3a0a 2020  source, str):.  
+0003a840: 2020 2020 2020 2020 2020 2020 2020 6966                if
+0003a850: 206f 732e 7061 7468 2e73 706c 6974 6578   os.path.splitex
+0003a860: 7428 736f 7572 6365 295b 315d 2021 3d20  t(source)[1] != 
+0003a870: 272e 6e69 6927 3a0a 2020 2020 2020 2020  '.nii':.        
+0003a880: 2020 2020 2020 2020 2020 2020 726f 6973              rois
+0003a890: 2c20 6473 203d 206c 6f61 645f 726f 6973  , ds = load_rois
+0003a8a0: 5f64 6963 6f6d 2873 6f75 7263 6529 0a20  _dicom(source). 
+0003a8b0: 2020 2020 2020 2020 2020 2069 6620 6c65             if le
+0003a8c0: 6e28 726f 6973 293a 0a20 2020 2020 2020  n(rois):.       
+0003a8d0: 2020 2020 2020 2020 2066 6f72 206e 756d           for num
+0003a8e0: 6265 722c 2072 6f69 2069 6e20 726f 6973  ber, roi in rois
+0003a8f0: 2e69 7465 6d73 2829 3a0a 0a20 2020 2020  .items():..     
+0003a900: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+0003a910: 2049 676e 6f72 6520 656e 7472 6965 7320   Ignore entries 
+0003a920: 7769 7468 206e 6f20 636f 6e74 6f75 7273  with no contours
+0003a930: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0003a940: 2020 2020 2069 6620 2263 6f6e 746f 7572       if "contour
+0003a950: 7322 206e 6f74 2069 6e20 726f 693a 0a20  s" not in roi:. 
+0003a960: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003a970: 2020 2020 2020 2063 6f6e 7469 6e75 650a         continue.
+0003a980: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0003a990: 2020 2020 2023 2049 676e 6f72 6520 656e       # Ignore en
+0003a9a0: 7472 6965 7320 636f 6e74 6169 6e69 6e67  tries containing
+0003a9b0: 206f 6e6c 7920 6120 7369 6e67 6c65 2070   only a single p
+0003a9c0: 6f69 6e74 0a20 2020 2020 2020 2020 2020  oint.           
+0003a9d0: 2020 2020 2020 2020 2063 6f6e 746f 7572           contour
+0003a9e0: 7320 3d20 726f 695b 2263 6f6e 746f 7572  s = roi["contour
+0003a9f0: 7322 5d0a 2020 2020 2020 2020 2020 2020  s"].            
+0003aa00: 2020 2020 2020 2020 6966 206c 656e 2863          if len(c
+0003aa10: 6f6e 746f 7572 7329 203d 3d20 313a 0a20  ontours) == 1:. 
+0003aa20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003aa30: 2020 2020 2020 2073 696e 676c 655f 636f         single_co
+0003aa40: 6e74 6f75 7220 3d20 636f 6e74 6f75 7273  ntour = contours
+0003aa50: 5b6c 6973 7428 636f 6e74 6f75 7273 2e6b  [list(contours.k
+0003aa60: 6579 7328 2929 5b30 5d5d 5b30 5d0a 2020  eys())[0]][0].  
+0003aa70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003aa80: 2020 2020 2020 6966 2073 696e 676c 655f        if single_
+0003aa90: 636f 6e74 6f75 722e 7368 6170 655b 305d  contour.shape[0]
+0003aaa0: 203d 3d20 313a 0a20 2020 2020 2020 2020   == 1:.         
+0003aab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003aac0: 2020 2063 6f6e 7469 6e75 650a 0a20 2020     continue..   
+0003aad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003aae0: 2063 6f6c 6f72 203d 2072 6f69 5b22 636f   color = roi["co
+0003aaf0: 6c6f 7222 5d20 6966 206e 6f74 2073 656c  lor"] if not sel
+0003ab00: 662e 6967 6e6f 7265 5f64 6963 6f6d 5f63  f.ignore_dicom_c
+0003ab10: 6f6c 6f72 7320 656c 7365 204e 6f6e 650a  olors else None.
+0003ab20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003ab30: 2020 2020 7365 6c66 2e72 6f69 732e 6170      self.rois.ap
+0003ab40: 7065 6e64 280a 2020 2020 2020 2020 2020  pend(.          
+0003ab50: 2020 2020 2020 2020 2020 2020 2020 524f                RO
+0003ab60: 4928 0a20 2020 2020 2020 2020 2020 2020  I(.             
+0003ab70: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+0003ab80: 6f69 5b22 636f 6e74 6f75 7273 225d 2c0a  oi["contours"],.
+0003ab90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003aba0: 2020 2020 2020 2020 2020 2020 6e61 6d65              name
+0003abb0: 3d72 6f69 5b22 6e61 6d65 225d 2c0a 2020  =roi["name"],.  
+0003abc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003abd0: 2020 2020 2020 2020 2020 636f 6c6f 723d            color=
+0003abe0: 636f 6c6f 722c 0a20 2020 2020 2020 2020  color,.         
+0003abf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003ac00: 2020 2069 6d61 6765 3d73 656c 662e 696d     image=self.im
+0003ac10: 6167 652c 0a20 2020 2020 2020 2020 2020  age,.           
+0003ac20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003ac30: 202a 2a73 656c 662e 726f 695f 6b77 6172   **self.roi_kwar
+0003ac40: 6773 0a20 2020 2020 2020 2020 2020 2020  gs.             
+0003ac50: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
+0003ac60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003ac70: 2029 0a20 2020 2020 2020 2020 2020 2020   ).             
+0003ac80: 2020 2020 2020 2073 656c 662e 726f 6973         self.rois
+0003ac90: 5b2d 315d 2e64 6963 6f6d 5f64 6174 6173  [-1].dicom_datas
+0003aca0: 6574 203d 2064 730a 2020 2020 2020 2020  et = ds.        
+0003acb0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0003acc0: 2e72 6f69 735b 2d31 5d2e 6e75 6d62 6572  .rois[-1].number
+0003acd0: 203d 206e 756d 6265 720a 2020 2020 2020   = number.      
+0003ace0: 2020 2020 2020 2020 2020 7365 6c66 2e64            self.d
+0003acf0: 6963 6f6d 5f64 6174 6173 6574 203d 2064  icom_dataset = d
+0003ad00: 730a 0a20 2020 2020 2020 2020 2020 2020  s..             
+0003ad10: 2020 2023 2041 7574 6f2d 6173 7369 676e     # Auto-assign
+0003ad20: 206e 616d 6520 6672 6f6d 2064 6963 6f6d   name from dicom
+0003ad30: 2066 696c 656e 616d 650a 2020 2020 2020   filename.      
+0003ad40: 2020 2020 2020 2020 2020 6966 2073 696e            if sin
+0003ad50: 676c 655f 736f 7572 6365 2061 6e64 2073  gle_source and s
+0003ad60: 656c 662e 6e61 6d65 2069 7320 4e6f 6e65  elf.name is None
+0003ad70: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0003ad80: 2020 2020 2020 7365 6c66 2e6e 616d 6520        self.name 
+0003ad90: 3d20 6f73 2e70 6174 682e 6261 7365 6e61  = os.path.basena
+0003ada0: 6d65 2873 6f75 7263 6529 2e72 6570 6c61  me(source).repla
+0003adb0: 6365 2822 2e64 636d 222c 2022 2229 0a0a  ce(".dcm", "")..
+0003adc0: 2020 2020 2020 2020 2020 2020 2320 4c6f              # Lo
+0003add0: 6164 2066 726f 6d20 524f 4920 6d61 736b  ad from ROI mask
+0003ade0: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
+0003adf0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+0003ae00: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
+0003ae10: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0003ae20: 2e72 6f69 732e 6170 7065 6e64 2852 4f49  .rois.append(ROI
+0003ae30: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+0003ae40: 2020 2020 2020 2020 2020 736f 7572 6365            source
+0003ae50: 2c20 0a20 2020 2020 2020 2020 2020 2020  , .             
+0003ae60: 2020 2020 2020 2020 2020 2069 6d61 6765             image
+0003ae70: 3d73 656c 662e 696d 6167 652c 0a20 2020  =self.image,.   
+0003ae80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003ae90: 2020 2020 202a 2a73 656c 662e 726f 695f       **self.roi_
+0003aea0: 6b77 6172 6773 0a20 2020 2020 2020 2020  kwargs.         
+0003aeb0: 2020 2020 2020 2020 2020 2029 290a 2020             )).  
+0003aec0: 2020 2020 2020 2020 2020 2020 2020 6578                ex
+0003aed0: 6365 7074 2052 756e 7469 6d65 4572 726f  cept RuntimeErro
+0003aee0: 723a 0a20 2020 2020 2020 2020 2020 2020  r:.             
+0003aef0: 2020 2020 2020 2063 6f6e 7469 6e75 650a         continue.
+0003af00: 0a20 2020 2020 2020 2073 656c 662e 6c6f  .        self.lo
+0003af10: 6164 6564 203d 2054 7275 650a 0a20 2020  aded = True..   
+0003af20: 2020 2020 2073 656c 662e 7265 6e61 6d65       self.rename
+0003af30: 5f72 6f69 7328 6b65 6570 5f72 656e 616d  _rois(keep_renam
+0003af40: 6564 5f6f 6e6c 793d 7365 6c66 2e6b 6565  ed_only=self.kee
+0003af50: 705f 7265 6e61 6d65 645f 6f6e 6c79 290a  p_renamed_only).
+0003af60: 2020 2020 2020 2020 7365 6c66 2e66 696c          self.fil
+0003af70: 7465 725f 726f 6973 2829 0a20 2020 2020  ter_rois().     
+0003af80: 2020 2073 656c 662e 7265 636f 6c6f 725f     self.recolor_
+0003af90: 726f 6973 2873 656c 662e 636f 6c6f 7273  rois(self.colors
+0003afa0: 290a 2020 2020 2020 2020 736c 6963 655f  ).        slice_
+0003afb0: 7468 6963 6b6e 6573 7365 7320 3d20 5b5d  thicknesses = []
+0003afc0: 0a20 2020 2020 2020 2072 6f69 7320 3d20  .        rois = 
+0003afd0: 5b5d 0a20 2020 2020 2020 2066 6f72 2072  [].        for r
+0003afe0: 6f69 2069 6e20 7365 6c66 2e72 6f69 733a  oi in self.rois:
+0003aff0: 0a20 2020 2020 2020 2020 2020 2072 6f69  .            roi
+0003b000: 2e73 7472 7563 7475 7265 5f73 6574 203d  .structure_set =
+0003b010: 2073 656c 660a 2020 2020 2020 2020 2020   self.          
+0003b020: 2020 726f 692e 7365 745f 616c 7068 615f    roi.set_alpha_
+0003b030: 6f76 6572 5f62 6574 6128 7365 6c66 2e61  over_beta(self.a
+0003b040: 6c70 6861 5f62 6574 615f 7261 7469 6f73  lpha_beta_ratios
+0003b050: 2e67 6574 2872 6f69 2e6e 616d 652c 204e  .get(roi.name, N
+0003b060: 6f6e 6529 290a 2020 2020 2020 2020 2020  one)).          
+0003b070: 2020 666f 7220 706c 616e 2069 6e20 7365    for plan in se
+0003b080: 6c66 2e70 6c61 6e73 3a0a 2020 2020 2020  lf.plans:.      
+0003b090: 2020 2020 2020 2020 2020 726f 692e 6164            roi.ad
+0003b0a0: 645f 706c 616e 2870 6c61 6e29 0a0a 2020  d_plan(plan)..  
+0003b0b0: 2020 2020 2020 2020 2020 6966 2072 6f69            if roi
+0003b0c0: 2e73 6f75 7263 655f 7479 7065 203d 3d20  .source_type == 
+0003b0d0: 2263 6f6e 746f 7572 223a 0a20 2020 2020  "contour":.     
+0003b0e0: 2020 2020 2020 2020 2020 2069 6620 726f             if ro
+0003b0f0: 692e 736c 6963 655f 7468 6963 6b6e 6573  i.slice_thicknes
+0003b100: 735f 636f 6e74 6f75 7273 2069 7320 6e6f  s_contours is no
+0003b110: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
+0003b120: 2020 2020 2020 2020 2020 2020 736c 6963              slic
+0003b130: 655f 7468 6963 6b6e 6573 7365 732e 6170  e_thicknesses.ap
+0003b140: 7065 6e64 2872 6f69 2e73 6c69 6365 5f74  pend(roi.slice_t
+0003b150: 6869 636b 6e65 7373 5f63 6f6e 746f 7572  hickness_contour
+0003b160: 7329 0a20 2020 2020 2020 2020 2020 2020  s).             
+0003b170: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+0003b180: 2020 2020 2020 2020 2020 2020 2072 6f69               roi
+0003b190: 732e 6170 7065 6e64 2872 6f69 290a 0a20  s.append(roi).. 
+0003b1a0: 2020 2020 2020 2023 2049 6620 736c 6963         # If slic
+0003b1b0: 6520 7468 6963 6b6e 6573 7320 6973 6e27  e thickness isn'
+0003b1c0: 7420 7365 7420 666f 7220 616e 2052 4f49  t set for an ROI
+0003b1d0: 2066 726f 6d20 636f 6e74 6f75 7273 2c0a   from contours,.
+0003b1e0: 2020 2020 2020 2020 2320 7365 7420 6974          # set it
+0003b1f0: 7320 7468 6963 6b6e 6573 7320 746f 2074  s thickness to t
+0003b200: 6865 206d 696e 696d 756d 2066 6f72 2061  he minimum for a
+0003b210: 6c6c 206f 7468 6572 2052 4f49 730a 2020  ll other ROIs.  
+0003b220: 2020 2020 2020 2320 696e 2074 6865 2073        # in the s
+0003b230: 7472 7563 7475 7265 2073 6574 2e0a 2020  tructure set..  
+0003b240: 2020 2020 2020 6966 2072 6f69 7320 616e        if rois an
+0003b250: 6420 736c 6963 655f 7468 6963 6b6e 6573  d slice_thicknes
+0003b260: 7365 733a 0a20 2020 2020 2020 2020 2020  ses:.           
+0003b270: 2073 6c69 6365 5f74 6869 636b 6e65 7373   slice_thickness
+0003b280: 203d 206d 696e 2873 6c69 6365 5f74 6869   = min(slice_thi
+0003b290: 636b 6e65 7373 6573 290a 2020 2020 2020  cknesses).      
+0003b2a0: 2020 2020 2020 666f 7220 726f 6920 696e        for roi in
+0003b2b0: 2072 6f69 733a 0a20 2020 2020 2020 2020   rois:.         
+0003b2c0: 2020 2020 2020 2072 6f69 2e73 6c69 6365         roi.slice
+0003b2d0: 5f74 6869 636b 6e65 7373 5f63 6f6e 746f  _thickness_conto
+0003b2e0: 7572 7320 3d20 736c 6963 655f 7468 6963  urs = slice_thic
+0003b2f0: 6b6e 6573 730a 0a20 2020 2064 6566 2067  kness..    def g
+0003b300: 6574 5f64 6963 6f6d 5f64 6174 6173 6574  et_dicom_dataset
+0003b310: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
+0003b320: 2222 2252 6574 7572 6e20 7079 6469 636f  """Return pydico
+0003b330: 6d2e 6461 7461 7365 742e 4669 6c65 4461  m.dataset.FileDa
+0003b340: 7461 7365 7420 6f62 6a65 6374 2061 7373  taset object ass
+0003b350: 6f63 6961 7465 6420 7769 7468 2074 6869  ociated with thi
+0003b360: 7320 496d 6167 652c 0a20 2020 2020 2020  s Image,.       
+0003b370: 2069 6620 6c6f 6164 6564 2066 726f 6d20   if loaded from 
+0003b380: 6469 636f 6d3b 206f 7468 6572 7769 7365  dicom; otherwise
+0003b390: 2c20 7265 7475 726e 204e 6f6e 652e 2222  , return None.""
+0003b3a0: 220a 0a20 2020 2020 2020 2073 656c 662e  "..        self.
+0003b3b0: 6c6f 6164 2829 0a20 2020 2020 2020 2072  load().        r
+0003b3c0: 6574 7572 6e20 7365 6c66 2e64 6963 6f6d  eturn self.dicom
+0003b3d0: 5f64 6174 6173 6574 0a0a 2020 2020 6465  _dataset..    de
+0003b3e0: 6620 7265 7365 7428 7365 6c66 293a 0a20  f reset(self):. 
+0003b3f0: 2020 2020 2020 2022 2222 5265 6c6f 6164         """Reload
+0003b400: 2073 7472 7563 7475 7265 2073 6574 2066   structure set f
+0003b410: 726f 6d20 6f72 6967 696e 616c 2073 6f75  rom original sou
+0003b420: 7263 6528 7329 2e22 2222 0a0a 2020 2020  rce(s)."""..    
+0003b430: 2020 2020 7365 6c66 2e72 6f69 7320 3d20      self.rois = 
+0003b440: 5b5d 0a20 2020 2020 2020 2073 656c 662e  [].        self.
+0003b450: 6c6f 6164 6564 203d 2046 616c 7365 0a20  loaded = False. 
+0003b460: 2020 2020 2020 2073 656c 662e 6c6f 6164         self.load
+0003b470: 2866 6f72 6365 3d54 7275 6529 0a0a 2020  (force=True)..  
+0003b480: 2020 6465 6620 7265 7365 745f 636f 6e74    def reset_cont
+0003b490: 6f75 7273 2873 656c 662c 2063 6f6e 746f  ours(self, conto
+0003b4a0: 7572 733d 4e6f 6e65 2c20 6d6f 7374 5f70  urs=None, most_p
+0003b4b0: 6f69 6e74 733d 4661 6c73 6529 3a0a 2020  oints=False):.  
+0003b4c0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+0003b4d0: 2020 5265 7365 7420 782d 7920 636f 6e74    Reset x-y cont
+0003b4e0: 6f75 7273 2066 6f72 2052 4f49 7320 6f66  ours for ROIs of
+0003b4f0: 2073 7472 7563 7475 7265 2073 6574 2e0a   structure set..
+0003b500: 0a20 2020 2020 2020 202a 2a50 6172 616d  .        **Param
+0003b510: 6574 6572 733a 2a2a 0a20 2020 2020 2020  eters:**.       
+0003b520: 200a 2020 2020 2020 2020 636f 6e74 6f75   .        contou
+0003b530: 7273 203a 2064 6963 742c 2064 6566 6175  rs : dict, defau
+0003b540: 6c74 3d4e 6f6e 650a 2020 2020 2020 2020  lt=None.        
+0003b550: 2020 2020 4469 6374 696f 6e61 7279 2077      Dictionary w
+0003b560: 6865 7265 206b 6579 7320 6172 6520 524f  here keys are RO
+0003b570: 4920 6e61 6d65 7320 616e 6420 7661 6c75  I names and valu
+0003b580: 6573 2061 7265 2064 6963 7469 6f6e 6172  es are dictionar
+0003b590: 6965 730a 2020 2020 2020 2020 2020 2020  ies.            
+0003b5a0: 6f66 2073 6c69 6365 2061 6e64 2063 6f6e  of slice and con
+0003b5b0: 746f 7572 206c 6973 7473 2e20 2049 6620  tour lists.  If 
+0003b5c0: 4e6f 6e65 2c20 616e 2065 6d70 7479 2064  None, an empty d
+0003b5d0: 6963 7469 6f6e 6172 7920 6973 0a20 2020  ictionary is.   
+0003b5e0: 2020 2020 2020 2020 2075 7365 642e 2020           used.  
+0003b5f0: 4966 2061 6e20 524f 4920 6861 7320 6120  If an ROI has a 
+0003b600: 6e61 6d65 206e 6f74 2069 6e63 6c75 6465  name not include
+0003b610: 6420 696e 2074 6865 2074 6f70 2d6c 6576  d in the top-lev
+0003b620: 656c 0a20 2020 2020 2020 2020 2020 2064  el.            d
+0003b630: 6963 7469 6f6e 6172 792c 206f 7220 6861  ictionary, or ha
+0003b640: 7320 6120 6e61 6d65 2077 6974 6820 6173  s a name with as
+0003b650: 736f 6369 6174 6564 2076 616c 7565 204e  sociated value N
+0003b660: 6f6e 652c 2074 6865 0a20 2020 2020 2020  one, the.       
+0003b670: 2020 2020 2052 4f49 2063 6f6e 746f 7572       ROI contour
+0003b680: 7320 7769 6c6c 2062 6520 7265 7365 7420  s will be reset 
+0003b690: 7573 696e 6720 7468 6520 524f 4927 7320  using the ROI's 
+0003b6a0: 6f77 6e20 782d 7920 636f 6e74 6f75 7273  own x-y contours
+0003b6b0: 2e0a 0a20 2020 2020 2020 206d 6f73 745f  ...        most_
+0003b6c0: 706f 696e 7473 203a 2062 6f6f 6c2c 2064  points : bool, d
+0003b6d0: 6566 6175 6c74 3d46 616c 7365 0a20 2020  efault=False.   
+0003b6e0: 2020 2020 2020 2020 2049 6620 5472 7565           If True
+0003b6f0: 2c20 6f6e 6c79 2074 6865 2063 6f6e 746f  , only the conto
+0003b700: 7572 2077 6974 6820 6d6f 7374 2070 6f69  ur with most poi
+0003b710: 6e74 7320 666f 7220 6561 6368 2073 6c69  nts for each sli
+0003b720: 6365 0a20 2020 2020 2020 2020 2020 2069  ce.            i
+0003b730: 7320 7265 7461 696e 6564 2061 6674 6572  s retained after
+0003b740: 2072 6573 6574 7469 6e67 2e20 2049 6620   resetting.  If 
+0003b750: 4661 6c73 652c 2061 6c6c 2063 6f6e 746f  False, all conto
+0003b760: 7572 7320 666f 7220 6561 6368 0a20 2020  urs for each.   
+0003b770: 2020 2020 2020 2020 2073 6c69 6365 2061           slice a
+0003b780: 7265 2072 6574 6169 6e65 642e 0a20 2020  re retained..   
+0003b790: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+0003b7a0: 2063 6f6e 746f 7572 7320 3d20 636f 6e74   contours = cont
+0003b7b0: 6f75 7273 206f 7220 7b7d 0a20 2020 2020  ours or {}.     
+0003b7c0: 2020 2066 6f72 2072 6f69 2069 6e20 7365     for roi in se
+0003b7d0: 6c66 2e67 6574 5f72 6f69 7328 293a 0a20  lf.get_rois():. 
+0003b7e0: 2020 2020 2020 2020 2020 2072 6f69 2e72             roi.r
+0003b7f0: 6573 6574 5f63 6f6e 746f 7572 7328 636f  eset_contours(co
+0003b800: 6e74 6f75 7273 2e67 6574 2872 6f69 2e6e  ntours.get(roi.n
+0003b810: 616d 652c 204e 6f6e 6529 2c20 6d6f 7374  ame, None), most
+0003b820: 5f70 6f69 6e74 7329 0a0a 2020 2020 6465  _points)..    de
+0003b830: 6620 7365 745f 696d 6167 655f 746f 5f64  f set_image_to_d
+0003b840: 756d 6d79 2873 656c 662c 202a 2a6b 7761  ummy(self, **kwa
+0003b850: 7267 7329 3a0a 2020 2020 2020 2020 2222  rgs):.        ""
+0003b860: 220a 2020 2020 2020 2020 5365 7420 696d  ".        Set im
+0003b870: 6167 6520 666f 7220 7365 6c66 2061 6e64  age for self and
+0003b880: 2061 6c6c 2052 4f49 7320 746f 2062 6520   all ROIs to be 
+0003b890: 6120 6475 6d6d 7920 696d 6167 6520 636f  a dummy image co
+0003b8a0: 7665 7269 6e67 0a20 2020 2020 2020 2074  vering.        t
+0003b8b0: 6865 2072 6567 696f 6e20 636f 6e74 6169  he region contai
+0003b8c0: 6e69 6e67 2061 6c6c 2052 4f49 7320 696e  ning all ROIs in
+0003b8d0: 2074 6865 2073 7472 7563 7475 7265 2073   the structure s
+0003b8e0: 6574 2e20 2054 6865 206d 6173 6b0a 2020  et.  The mask.  
+0003b8f0: 2020 2020 2020 616e 6420 782d 7a2f 792d        and x-z/y-
+0003b900: 7a20 636f 6e74 6f75 7273 206f 6620 6561  z contours of ea
+0003b910: 6368 2052 4f49 2077 696c 6c20 6265 2063  ch ROI will be c
+0003b920: 6c65 6172 6564 2c20 736f 2074 6861 7420  leared, so that 
+0003b930: 7468 6579 0a20 2020 2020 2020 2077 696c  they.        wil
+0003b940: 6c20 6265 2072 6563 7265 6174 6564 2077  l be recreated w
+0003b950: 6865 6e20 6765 745f 6d61 736b 2829 206f  hen get_mask() o
+0003b960: 7220 6765 745f 636f 6e74 6f75 7273 2829  r get_contours()
+0003b970: 2061 7265 206e 6578 7420 6361 6c6c 6564   are next called
+0003b980: 2e0a 0a20 2020 2020 2020 202a 2a50 6172  ...        **Par
+0003b990: 616d 6574 6572 733a 2a2a 0a20 2020 2020  ameters:**.     
+0003b9a0: 2020 200a 2020 2020 2020 2020 6b77 6172     .        kwar
+0003b9b0: 6773 203a 200a 2020 2020 2020 2020 2020  gs : .          
+0003b9c0: 2020 4b65 7977 6f72 6420 6172 6775 6d65    Keyword argume
+0003b9d0: 6e74 7320 746f 2070 6173 7320 746f 2073  nts to pass to s
+0003b9e0: 656c 662e 6765 745f 6475 6d6d 795f 696d  elf.get_dummy_im
+0003b9f0: 6167 6528 2920 7768 656e 0a20 2020 2020  age() when.     
+0003ba00: 2020 2020 2020 2063 7265 6174 696e 6720         creating 
+0003ba10: 7468 6520 6475 6d6d 7920 696d 6167 652e  the dummy image.
+0003ba20: 2053 6565 2064 6f63 756d 656e 7461 7469   See documentati
+0003ba30: 6f6e 206f 660a 2020 2020 2020 2020 2020  on of.          
+0003ba40: 2020 5374 7275 6374 7572 6553 6574 2e67    StructureSet.g
+0003ba50: 6574 5f64 756d 6d79 5f69 6d61 6765 2829  et_dummy_image()
+0003ba60: 2e0a 2020 2020 2022 2222 0a20 2020 2020  ..     """.     
+0003ba70: 2020 2023 204d 616b 6520 696d 6167 650a     # Make image.
+0003ba80: 2020 2020 2020 2020 696d 203d 2073 656c          im = sel
+0003ba90: 662e 6765 745f 6475 6d6d 795f 696d 6167  f.get_dummy_imag
+0003baa0: 6528 2a2a 6b77 6172 6773 290a 0a20 2020  e(**kwargs)..   
+0003bab0: 2020 2020 2023 2043 6c65 6172 206d 6173       # Clear mas
+0003bac0: 6b20 616e 6420 636f 6e74 6f75 7273 0a20  k and contours. 
+0003bad0: 2020 2020 2020 2066 6f72 2072 6f69 2069         for roi i
+0003bae0: 6e20 7365 6c66 2e72 6f69 733a 0a20 2020  n self.rois:.   
+0003baf0: 2020 2020 2020 2020 2072 6f69 2e69 6e70           roi.inp
+0003bb00: 7574 5f63 6f6e 746f 7572 7320 3d20 726f  ut_contours = ro
+0003bb10: 692e 6765 745f 636f 6e74 6f75 7273 2822  i.get_contours("
+0003bb20: 782d 7922 290a 2020 2020 2020 2020 2020  x-y").          
+0003bb30: 2020 726f 692e 636f 6e74 6f75 7273 203d    roi.contours =
+0003bb40: 207b 2278 2d79 223a 2072 6f69 2e69 6e70   {"x-y": roi.inp
+0003bb50: 7574 5f63 6f6e 746f 7572 737d 0a20 2020  ut_contours}.   
+0003bb60: 2020 2020 2020 2020 2072 6f69 2e6c 6f61           roi.loa
+0003bb70: 6465 645f 6d61 736b 203d 2046 616c 7365  ded_mask = False
+0003bb80: 0a20 2020 2020 2020 2020 2020 2072 6f69  .            roi
+0003bb90: 2e6d 6173 6b20 3d20 4e6f 6e65 0a0a 2020  .mask = None..  
+0003bba0: 2020 2020 2020 2320 4173 7369 676e 2069        # Assign i
+0003bbb0: 6d61 6765 0a20 2020 2020 2020 2073 656c  mage.        sel
+0003bbc0: 662e 7365 745f 696d 6167 6528 696d 290a  f.set_image(im).
+0003bbd0: 0a20 2020 2064 6566 2073 6574 5f69 6d61  .    def set_ima
+0003bbe0: 6765 2873 656c 662c 2069 6d61 6765 2c20  ge(self, image, 
+0003bbf0: 6164 645f 746f 5f69 6d61 6765 3d54 7275  add_to_image=Tru
+0003bc00: 6529 3a0a 2020 2020 2020 2020 2222 2253  e):.        """S
+0003bc10: 6574 2069 6d61 6765 2066 6f72 2073 656c  et image for sel
+0003bc20: 6620 616e 6420 616c 6c20 524f 4973 2e0a  f and all ROIs..
+0003bc30: 2020 2020 2020 2020 4966 2061 6464 5f74          If add_t
+0003bc40: 6f5f 696d 6167 6520 6973 2054 7275 652c  o_image is True,
+0003bc50: 2069 6d61 6765 2e61 6464 5f73 7472 7563   image.add_struc
+0003bc60: 7475 7265 5f73 6574 2873 656c 6629 0a20  ture_set(self). 
+0003bc70: 2020 2020 2020 2077 696c 6c20 616c 736f         will also
+0003bc80: 2062 6520 6361 6c6c 6564 2e22 2222 0a0a   be called."""..
+0003bc90: 2020 2020 2020 2020 2320 436f 6e76 6572          # Conver
+0003bca0: 7420 746f 2049 6d61 6765 206f 626a 6563  t to Image objec
+0003bcb0: 7420 6966 206e 6565 6465 640a 2020 2020  t if needed.    
+0003bcc0: 2020 2020 6966 2069 6d61 6765 2061 6e64      if image and
+0003bcd0: 206e 6f74 2069 7369 6e73 7461 6e63 6528   not isinstance(
+0003bce0: 696d 6167 652c 2073 6b72 742e 696d 6167  image, skrt.imag
+0003bcf0: 652e 496d 6167 6529 3a0a 2020 2020 2020  e.Image):.      
+0003bd00: 2020 2020 2020 696d 6167 6520 3d20 736b        image = sk
+0003bd10: 7274 2e69 6d61 6765 2e49 6d61 6765 2869  rt.image.Image(i
+0003bd20: 6d61 6765 290a 0a20 2020 2020 2020 2023  mage)..        #
+0003bd30: 2041 7373 6967 6e20 746f 2073 656c 6620   Assign to self 
+0003bd40: 616e 6420 616c 6c20 524f 4973 0a20 2020  and all ROIs.   
+0003bd50: 2020 2020 2073 656c 662e 696d 6167 6520       self.image 
+0003bd60: 3d20 696d 6167 650a 2020 2020 2020 2020  = image.        
+0003bd70: 666f 7220 726f 6920 696e 2073 656c 662e  for roi in self.
+0003bd80: 726f 6973 3a0a 2020 2020 2020 2020 2020  rois:.          
+0003bd90: 2020 726f 692e 7365 745f 696d 6167 6528    roi.set_image(
+0003bda0: 696d 6167 6529 0a0a 2020 2020 2020 2020  image)..        
+0003bdb0: 2320 4173 7369 676e 2073 656c 6620 746f  # Assign self to
+0003bdc0: 2074 6865 2069 6d61 6765 0a20 2020 2020   the image.     
+0003bdd0: 2020 2069 6620 696d 6167 6520 6973 206e     if image is n
+0003bde0: 6f74 204e 6f6e 6520 616e 6420 6164 645f  ot None and add_
+0003bdf0: 746f 5f69 6d61 6765 3a0a 2020 2020 2020  to_image:.      
+0003be00: 2020 2020 2020 696d 6167 652e 6164 645f        image.add_
+0003be10: 7374 7275 6374 7572 655f 7365 7428 7365  structure_set(se
+0003be20: 6c66 290a 0a20 2020 2064 6566 2063 6f6e  lf)..    def con
+0003be30: 7461 696e 7328 7365 6c66 2c20 726f 695f  tains(self, roi_
+0003be40: 6e61 6d65 732c 2069 6e5f 696d 6167 653d  names, in_image=
+0003be50: 4661 6c73 6529 3a0a 2020 2020 2020 2020  False):.        
+0003be60: 2222 220a 2020 2020 2020 2020 5265 7475  """.        Retu
+0003be70: 726e 2077 6865 7468 6572 2073 7472 7563  rn whether struc
+0003be80: 7475 7265 2073 6574 2063 6f6e 7461 696e  ture set contain
+0003be90: 7320 6e61 6d65 6420 524f 4973 2c0a 2020  s named ROIs,.  
+0003bea0: 2020 2020 2020 6f70 7469 6f6e 616c 6c79        optionally
+0003beb0: 2074 6573 7469 6e67 2077 6865 7468 6572   testing whether
+0003bec0: 2074 6865 2052 4f49 7320 6265 2066 756c   the ROIs be ful
+0003bed0: 6c79 2063 6f6e 7461 696e 6564 2069 6e20  ly contained in 
+0003bee0: 616e 2069 6d61 6765 2e0a 0a20 2020 2020  an image...     
+0003bef0: 2020 202a 2a50 6172 616d 6574 6572 733a     **Parameters:
+0003bf00: 2a2a 0a0a 2020 2020 2020 2020 726f 695f  **..        roi_
+0003bf10: 6e61 6d65 7320 3a20 6c69 7374 2f73 7472  names : list/str
+0003bf20: 0a20 2020 2020 2020 2020 2020 2053 696e  .            Sin
+0003bf30: 676c 6520 7374 7269 6e67 2c20 6f72 206c  gle string, or l
+0003bf40: 6973 7420 6f66 2073 7472 696e 6773 2c20  ist of strings, 
+0003bf50: 696e 6469 6361 7469 6e67 206e 616d 6528  indicating name(
+0003bf60: 7329 206f 6620 524f 4928 7329 0a20 2020  s) of ROI(s).   
+0003bf70: 2020 2020 2020 2020 2074 6f20 6265 2063           to be c
+0003bf80: 6f6e 7369 6465 7265 642e 0a0a 2020 2020  onsidered...    
+0003bf90: 2020 2020 696e 5f69 6d61 6765 203a 2062      in_image : b
+0003bfa0: 6f6f 6c2f 736b 7274 2e69 6d61 6765 2e49  ool/skrt.image.I
+0003bfb0: 6d61 6765 2c20 6465 6661 756c 743d 4661  mage, default=Fa
+0003bfc0: 6c73 650a 2020 2020 2020 2020 2020 2020  lse.            
+0003bfd0: 5370 6563 6966 6963 6174 696f 6e20 6f66  Specification of
+0003bfe0: 2077 6865 7468 6572 2074 6f20 7465 7374   whether to test
+0003bff0: 2074 6861 7420 524f 4973 2061 7265 2066   that ROIs are f
+0003c000: 756c 6c79 2063 6f6e 7461 696e 6564 0a20  ully contained. 
+0003c010: 2020 2020 2020 2020 2020 2069 6e20 616e             in an
+0003c020: 2069 6d61 6765 2e20 2049 6620 696e 5f69   image.  If in_i
+0003c030: 6d61 6765 2069 7320 696e 2049 6d61 6765  mage is in Image
+0003c040: 206f 626a 6563 742c 2074 6865 2062 6f6f   object, the boo
+0003c050: 6c65 616e 2072 6574 7572 6e65 640a 2020  lean returned.  
+0003c060: 2020 2020 2020 2020 2020 696e 6469 6361            indica
+0003c070: 7465 7320 7768 6574 6865 7220 616c 6c20  tes whether all 
+0003c080: 6e61 6d65 6420 524f 4973 2061 7265 2063  named ROIs are c
+0003c090: 6f6e 7461 696e 6564 2077 6974 6869 6e20  ontained within 
+0003c0a0: 7468 6973 2069 6d61 6765 2e0a 2020 2020  this image..    
+0003c0b0: 2020 2020 2020 2020 4966 2069 6e5f 696d          If in_im
+0003c0c0: 6167 6520 6973 2054 7275 652c 2074 6865  age is True, the
+0003c0d0: 2062 6f6f 6c65 616e 2072 6574 7572 6e65   boolean returne
+0003c0e0: 6420 696e 6469 6361 7465 7320 7768 6574  d indicates whet
+0003c0f0: 6865 720a 2020 2020 2020 2020 2020 2020  her.            
+0003c100: 616c 6c20 6e61 6d65 6420 524f 4973 2061  all named ROIs a
+0003c110: 7265 2063 6f6e 7461 696e 6564 2077 6974  re contained wit
+0003c120: 6869 6e20 7468 6520 696d 6167 6520 6173  hin the image as
+0003c130: 736f 6369 6174 6564 2077 6974 680a 2020  sociated with.  
+0003c140: 2020 2020 2020 2020 2020 7365 6c66 2e0a            self..
+0003c150: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+0003c160: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
+0003c170: 6528 726f 695f 6e61 6d65 732c 2073 7472  e(roi_names, str
+0003c180: 293a 0a20 2020 2020 2020 2020 2020 2072  ):.            r
+0003c190: 6f69 5f6e 616d 6573 203d 205b 726f 695f  oi_names = [roi_
+0003c1a0: 6e61 6d65 735d 0a0a 2020 2020 2020 2020  names]..        
+0003c1b0: 2320 4368 6563 6b20 7768 6574 6865 7220  # Check whether 
+0003c1c0: 7374 7275 6374 7572 6520 7365 7420 636f  structure set co
+0003c1d0: 6e74 6169 6e73 2061 6c6c 206e 616d 6564  ntains all named
+0003c1e0: 2052 4f49 732e 0a20 2020 2020 2020 2073   ROIs..        s
+0003c1f0: 735f 726f 695f 6e61 6d65 7320 3d20 7365  s_roi_names = se
+0003c200: 6c66 2e67 6574 5f72 6f69 5f6e 616d 6573  lf.get_roi_names
+0003c210: 2829 0a20 2020 2020 2020 2066 6f72 2072  ().        for r
+0003c220: 6f69 5f6e 616d 6520 696e 2072 6f69 5f6e  oi_name in roi_n
+0003c230: 616d 6573 3a0a 2020 2020 2020 2020 2020  ames:.          
+0003c240: 2020 6966 2072 6f69 5f6e 616d 6520 6e6f    if roi_name no
+0003c250: 7420 696e 2073 735f 726f 695f 6e61 6d65  t in ss_roi_name
+0003c260: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
+0003c270: 2020 2072 6574 7572 6e20 4661 6c73 650a     return False.
+0003c280: 0a20 2020 2020 2020 2023 2044 6574 6572  .        # Deter
+0003c290: 6d69 6e65 2077 6865 7468 6572 2074 6f20  mine whether to 
+0003c2a0: 6368 6563 6b20 7468 6174 206e 616d 6564  check that named
+0003c2b0: 2052 4f49 7320 6172 6520 636f 6e74 6169   ROIs are contai
+0003c2c0: 6e65 6420 696e 2061 6e20 696d 6167 652e  ned in an image.
+0003c2d0: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
+0003c2e0: 696e 5f69 6d61 6765 3a0a 2020 2020 2020  in_image:.      
+0003c2f0: 2020 2020 2020 7265 7475 726e 2054 7275        return Tru
+0003c300: 650a 0a20 2020 2020 2020 2023 2043 6865  e..        # Che
+0003c310: 636b 2074 6861 7420 696d 6167 6520 6973  ck that image is
+0003c320: 2073 7065 6369 6669 6564 2e0a 2020 2020   specified..    
+0003c330: 2020 2020 2320 4966 2079 6573 2c20 2065      # If yes,  e
+0003c340: 6e73 7572 6520 7468 6174 2052 4f49 206d  nsure that ROI m
+0003c350: 6173 6b73 2068 6176 6520 7468 6520 7361  asks have the sa
+0003c360: 6d65 2076 6f78 656c 2073 697a 6520 6173  me voxel size as
+0003c370: 2074 6869 7320 696d 6167 652e 0a20 2020   this image..   
+0003c380: 2020 2020 2069 6620 6973 696e 7374 616e       if isinstan
+0003c390: 6365 2869 6e5f 696d 6167 652c 2073 6b72  ce(in_image, skr
+0003c3a0: 742e 696d 6167 652e 496d 6167 6529 3a0a  t.image.Image):.
+0003c3b0: 2020 2020 2020 2020 2020 2020 696d 203d              im =
+0003c3c0: 2069 6e5f 696d 6167 650a 2020 2020 2020   in_image.      
+0003c3d0: 2020 2020 2020 7373 203d 2073 656c 662e        ss = self.
+0003c3e0: 636c 6f6e 6528 290a 2020 2020 2020 2020  clone().        
+0003c3f0: 2020 2020 7373 2e73 6574 5f69 6d61 6765      ss.set_image
+0003c400: 2869 6d2c 2061 6464 5f74 6f5f 696d 6167  (im, add_to_imag
+0003c410: 653d 4661 6c73 6529 0a20 2020 2020 2020  e=False).       
+0003c420: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+0003c430: 2020 2069 6d20 3d20 7365 6c66 2e69 6d61     im = self.ima
+0003c440: 6765 0a20 2020 2020 2020 2020 2020 2073  ge.            s
+0003c450: 7320 3d20 7365 6c66 0a20 2020 2020 2020  s = self.       
+0003c460: 2069 6620 6e6f 7420 6973 696e 7374 616e   if not isinstan
+0003c470: 6365 2869 6d2c 2073 6b72 742e 696d 6167  ce(im, skrt.imag
+0003c480: 652e 496d 6167 6529 3a0a 2020 2020 2020  e.Image):.      
+0003c490: 2020 2020 2020 7265 7475 726e 2046 616c        return Fal
+0003c4a0: 7365 0a0a 2020 2020 2020 2020 2320 4368  se..        # Ch
+0003c4b0: 6563 6b20 7768 6574 6865 7220 524f 4973  eck whether ROIs
+0003c4c0: 2061 7265 2063 6f6e 7461 696e 6564 2069   are contained i
+0003c4d0: 6e20 696d 6167 652e 0a20 2020 2020 2020  n image..       
+0003c4e0: 2069 6d5f 6578 7465 6e74 7320 3d20 696d   im_extents = im
+0003c4f0: 2e67 6574 5f65 7874 656e 7473 2829 0a20  .get_extents(). 
+0003c500: 2020 2020 2020 2066 6f72 2072 6f69 5f6e         for roi_n
+0003c510: 616d 6520 696e 2072 6f69 5f6e 616d 6573  ame in roi_names
+0003c520: 3a0a 2020 2020 2020 2020 2020 2020 726f  :.            ro
+0003c530: 695f 6578 7465 6e74 7320 3d20 7373 5b72  i_extents = ss[r
+0003c540: 6f69 5f6e 616d 655d 2e67 6574 5f65 7874  oi_name].get_ext
+0003c550: 656e 7473 2830 2e35 2c20 2276 6f78 656c  ents(0.5, "voxel
+0003c560: 7322 290a 2020 2020 2020 2020 2020 2020  s").            
+0003c570: 666f 7220 6964 7820 696e 2072 616e 6765  for idx in range
+0003c580: 2833 293a 0a20 2020 2020 2020 2020 2020  (3):.           
+0003c590: 2020 2020 2069 6620 726f 695f 6578 7465       if roi_exte
+0003c5a0: 6e74 735b 6964 785d 5b30 5d20 3c20 696d  nts[idx][0] < im
+0003c5b0: 5f65 7874 656e 7473 5b69 6478 5d5b 305d  _extents[idx][0]
+0003c5c0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0003c5d0: 2020 2020 2020 7265 7475 726e 2046 616c        return Fal
+0003c5e0: 7365 0a20 2020 2020 2020 2020 2020 2020  se.             
+0003c5f0: 2020 2069 6620 726f 695f 6578 7465 6e74     if roi_extent
+0003c600: 735b 6964 785d 5b31 5d20 3e20 696d 5f65  s[idx][1] > im_e
+0003c610: 7874 656e 7473 5b69 6478 5d5b 315d 3a0a  xtents[idx][1]:.
+0003c620: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003c630: 2020 2020 7265 7475 726e 2046 616c 7365      return False
+0003c640: 0a0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+0003c650: 2054 7275 650a 0a20 2020 2064 6566 206d   True..    def m
+0003c660: 6973 7369 6e67 2873 656c 662c 2072 6f69  issing(self, roi
+0003c670: 5f6e 616d 6573 2c20 696e 5f69 6d61 6765  _names, in_image
+0003c680: 3d46 616c 7365 293a 0a20 2020 2020 2020  =False):.       
+0003c690: 2022 2222 0a20 2020 2020 2020 2049 6465   """.        Ide
+0003c6a0: 6e74 6966 7920 616d 6f6e 6720 6e61 6d65  ntify among name
+0003c6b0: 6420 524f 4973 2074 686f 7365 2074 6861  d ROIs those tha
+0003c6c0: 7420 6172 6520 6d69 7373 696e 6720 6672  t are missing fr
+0003c6d0: 6f6d 2073 7472 7563 7475 7265 2073 6574  om structure set
+0003c6e0: 2c0a 2020 2020 2020 2020 6f72 2061 7265  ,.        or are
+0003c6f0: 206e 6f74 2066 756c 6c79 2063 6f6e 7461   not fully conta
+0003c700: 696e 6564 2069 6e20 616e 2069 6d61 6765  ined in an image
+0003c710: 2e0a 0a20 2020 2020 2020 202a 2a50 6172  ...        **Par
+0003c720: 616d 6574 6572 733a 2a2a 0a0a 2020 2020  ameters:**..    
+0003c730: 2020 2020 726f 695f 6e61 6d65 7320 3a20      roi_names : 
+0003c740: 6c69 7374 2f73 7472 0a20 2020 2020 2020  list/str.       
+0003c750: 2020 2020 2053 696e 676c 6520 7374 7269       Single stri
+0003c760: 6e67 2c20 6f72 206c 6973 7420 6f66 2073  ng, or list of s
+0003c770: 7472 696e 6773 2c20 696e 6469 6361 7469  trings, indicati
+0003c780: 6e67 206e 616d 6528 7329 206f 6620 524f  ng name(s) of RO
+0003c790: 4928 7329 0a20 2020 2020 2020 2020 2020  I(s).           
+0003c7a0: 2074 6f20 6265 2063 6f6e 7369 6465 7265   to be considere
+0003c7b0: 642e 0a0a 2020 2020 2020 2020 696e 5f69  d...        in_i
+0003c7c0: 6d61 6765 203a 2062 6f6f 6c2f 736b 7274  mage : bool/skrt
+0003c7d0: 2e69 6d61 6765 2e49 6d61 6765 2c20 6465  .image.Image, de
+0003c7e0: 6661 756c 743d 4661 6c73 650a 2020 2020  fault=False.    
+0003c7f0: 2020 2020 2020 2020 5370 6563 6966 6963          Specific
+0003c800: 6174 696f 6e20 6f66 2077 6865 7468 6572  ation of whether
+0003c810: 2074 6f20 7465 7374 2074 6861 7420 524f   to test that RO
+0003c820: 4973 2061 7265 2066 756c 6c79 2063 6f6e  Is are fully con
+0003c830: 7461 696e 6564 0a20 2020 2020 2020 2020  tained.         
+0003c840: 2020 2069 6e20 616e 2069 6d61 6765 2e20     in an image. 
+0003c850: 2049 6620 696e 5f69 6d61 6765 2069 7320   If in_image is 
+0003c860: 696e 2049 6d61 6765 206f 626a 6563 742c  in Image object,
+0003c870: 2061 6e20 524f 4920 6973 0a20 2020 2020   an ROI is.     
+0003c880: 2020 2020 2020 2069 6465 6e74 6966 6965         identifie
+0003c890: 6420 6173 206d 6973 7369 6e67 2069 6620  d as missing if 
+0003c8a0: 6e6f 7420 636f 6e74 6169 6e65 6420 7769  not contained wi
+0003c8b0: 7468 696e 2074 6869 7320 696d 6167 652e  thin this image.
+0003c8c0: 0a20 2020 2020 2020 2020 2020 2049 6620  .            If 
+0003c8d0: 696e 5f69 6d61 6765 2069 7320 5472 7565  in_image is True
+0003c8e0: 2c20 616e 2052 4f49 2069 7320 6964 656e  , an ROI is iden
+0003c8f0: 7469 6669 6564 2061 7320 6d69 7373 696e  tified as missin
+0003c900: 6720 6966 206e 6f74 0a20 2020 2020 2020  g if not.       
+0003c910: 2020 2020 2063 6f6e 7461 696e 6564 2077       contained w
+0003c920: 6974 6869 6e20 7468 6520 696d 6167 6520  ithin the image 
+0003c930: 6173 736f 6369 6174 6564 2077 6974 6820  associated with 
+0003c940: 7365 6c66 2e0a 2020 2020 2020 2020 2222  self..        ""
+0003c950: 220a 2020 2020 2020 2020 6966 2069 7369  ".        if isi
+0003c960: 6e73 7461 6e63 6528 726f 695f 6e61 6d65  nstance(roi_name
+0003c970: 732c 2073 7472 293a 0a20 2020 2020 2020  s, str):.       
+0003c980: 2020 2020 2072 6f69 5f6e 616d 6573 203d       roi_names =
+0003c990: 205b 726f 695f 6e61 6d65 735d 0a20 2020   [roi_names].   
+0003c9a0: 2020 2020 206d 6973 7369 6e67 5f72 6f69       missing_roi
+0003c9b0: 7320 3d20 7365 7428 290a 0a20 2020 2020  s = set()..     
+0003c9c0: 2020 2023 2043 6865 636b 2066 6f72 2052     # Check for R
+0003c9d0: 4f49 7320 6e6f 7420 636f 6e74 6169 6e65  OIs not containe
+0003c9e0: 6420 696e 2073 7472 7563 7475 7265 2073  d in structure s
+0003c9f0: 6574 2e0a 2020 2020 2020 2020 7373 5f72  et..        ss_r
+0003ca00: 6f69 5f6e 616d 6573 203d 2073 656c 662e  oi_names = self.
+0003ca10: 6765 745f 726f 695f 6e61 6d65 7328 290a  get_roi_names().
+0003ca20: 2020 2020 2020 2020 666f 7220 726f 695f          for roi_
+0003ca30: 6e61 6d65 2069 6e20 726f 695f 6e61 6d65  name in roi_name
+0003ca40: 733a 0a20 2020 2020 2020 2020 2020 2069  s:.            i
+0003ca50: 6620 726f 695f 6e61 6d65 206e 6f74 2069  f roi_name not i
+0003ca60: 6e20 7373 5f72 6f69 5f6e 616d 6573 3a0a  n ss_roi_names:.
+0003ca70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003ca80: 6d69 7373 696e 675f 726f 6973 2e61 6464  missing_rois.add
+0003ca90: 2872 6f69 5f6e 616d 6529 0a0a 2020 2020  (roi_name)..    
+0003caa0: 2020 2020 2320 4465 7465 726d 696e 6520      # Determine 
+0003cab0: 7768 6574 6865 7220 746f 2063 6865 636b  whether to check
+0003cac0: 2074 6861 7420 6e61 6d65 6420 524f 4973   that named ROIs
+0003cad0: 2061 7265 2063 6f6e 7461 696e 6564 2069   are contained i
+0003cae0: 6e20 616e 2069 6d61 6765 2e0a 2020 2020  n an image..    
+0003caf0: 2020 2020 6966 206e 6f74 2069 6e5f 696d      if not in_im
+0003cb00: 6167 653a 0a20 2020 2020 2020 2020 2020  age:.           
+0003cb10: 2072 6574 7572 6e20 736f 7274 6564 286c   return sorted(l
+0003cb20: 6973 7428 6d69 7373 696e 675f 726f 6973  ist(missing_rois
+0003cb30: 2929 0a0a 2020 2020 2020 2020 2320 4368  ))..        # Ch
+0003cb40: 6563 6b20 7468 6174 2069 6d61 6765 2069  eck that image i
+0003cb50: 7320 7370 6563 6966 6965 642e 0a20 2020  s specified..   
+0003cb60: 2020 2020 2023 2049 6620 7965 732c 2020       # If yes,  
+0003cb70: 656e 7375 7265 2074 6861 7420 524f 4920  ensure that ROI 
+0003cb80: 6d61 736b 7320 6861 7665 2074 6865 2073  masks have the s
+0003cb90: 616d 6520 766f 7865 6c20 7369 7a65 2061  ame voxel size a
+0003cba0: 7320 7468 6973 2069 6d61 6765 2e0a 2020  s this image..  
+0003cbb0: 2020 2020 2020 6966 2069 7369 6e73 7461        if isinsta
+0003cbc0: 6e63 6528 696e 5f69 6d61 6765 2c20 736b  nce(in_image, sk
+0003cbd0: 7274 2e69 6d61 6765 2e49 6d61 6765 293a  rt.image.Image):
+0003cbe0: 0a20 2020 2020 2020 2020 2020 2069 6d20  .            im 
+0003cbf0: 3d20 696e 5f69 6d61 6765 0a20 2020 2020  = in_image.     
+0003cc00: 2020 2020 2020 2073 7320 3d20 7365 6c66         ss = self
+0003cc10: 2e63 6c6f 6e65 2829 0a20 2020 2020 2020  .clone().       
+0003cc20: 2020 2020 2073 732e 7365 745f 696d 6167       ss.set_imag
+0003cc30: 6528 696d 2c20 6164 645f 746f 5f69 6d61  e(im, add_to_ima
+0003cc40: 6765 3d46 616c 7365 290a 2020 2020 2020  ge=False).      
+0003cc50: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+0003cc60: 2020 2020 696d 203d 2073 656c 662e 696d      im = self.im
+0003cc70: 6167 650a 2020 2020 2020 2020 2020 2020  age.            
+0003cc80: 7373 203d 2073 656c 660a 2020 2020 2020  ss = self.      
+0003cc90: 2020 6966 206e 6f74 2069 7369 6e73 7461    if not isinsta
+0003cca0: 6e63 6528 696d 2c20 736b 7274 2e69 6d61  nce(im, skrt.ima
+0003ccb0: 6765 2e49 6d61 6765 293a 0a20 2020 2020  ge.Image):.     
+0003ccc0: 2020 2020 2020 2072 6169 7365 2052 756e         raise Run
+0003ccd0: 7469 6d65 4572 726f 7228 6622 496e 7661  timeError(f"Inva
+0003cce0: 6c69 6420 696d 6167 6520 7370 6563 6966  lid image specif
+0003ccf0: 6963 6174 696f 6e22 290a 0a20 2020 2020  ication")..     
+0003cd00: 2020 2023 2043 6865 636b 2077 6865 7468     # Check wheth
+0003cd10: 6572 2052 4f49 7320 6172 6520 636f 6e74  er ROIs are cont
+0003cd20: 6169 6e65 6420 696e 2069 6d61 6765 2e0a  ained in image..
+0003cd30: 2020 2020 2020 2020 696d 5f65 7874 656e          im_exten
+0003cd40: 7473 203d 2069 6d2e 6765 745f 6578 7465  ts = im.get_exte
+0003cd50: 6e74 7328 290a 2020 2020 2020 2020 6163  nts().        ac
+0003cd60: 7469 7665 5f72 6f69 7320 3d20 7365 7428  tive_rois = set(
+0003cd70: 726f 695f 6e61 6d65 7329 202d 206d 6973  roi_names) - mis
+0003cd80: 7369 6e67 5f72 6f69 730a 2020 2020 2020  sing_rois.      
+0003cd90: 2020 666f 7220 726f 695f 6e61 6d65 2069    for roi_name i
+0003cda0: 6e20 6163 7469 7665 5f72 6f69 733a 0a20  n active_rois:. 
+0003cdb0: 2020 2020 2020 2020 2020 2072 6f69 5f65             roi_e
+0003cdc0: 7874 656e 7473 203d 2073 735b 726f 695f  xtents = ss[roi_
+0003cdd0: 6e61 6d65 5d2e 6765 745f 6578 7465 6e74  name].get_extent
+0003cde0: 7328 302e 352c 2022 766f 7865 6c73 2229  s(0.5, "voxels")
+0003cdf0: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
+0003ce00: 2069 6478 2069 6e20 7261 6e67 6528 3329   idx in range(3)
+0003ce10: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0003ce20: 2020 6966 2028 726f 695f 6578 7465 6e74    if (roi_extent
+0003ce30: 735b 6964 785d 5b30 5d20 3c20 696d 5f65  s[idx][0] < im_e
+0003ce40: 7874 656e 7473 5b69 6478 5d5b 305d 0a20  xtents[idx][0]. 
+0003ce50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003ce60: 2020 206f 7220 726f 695f 6578 7465 6e74     or roi_extent
+0003ce70: 735b 6964 785d 5b31 5d20 3e20 696d 5f65  s[idx][1] > im_e
+0003ce80: 7874 656e 7473 5b69 6478 5d5b 315d 293a  xtents[idx][1]):
+0003ce90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0003cea0: 2020 2020 206d 6973 7369 6e67 5f72 6f69       missing_roi
+0003ceb0: 732e 6164 6428 726f 695f 6e61 6d65 290a  s.add(roi_name).
+0003cec0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0003ced0: 736f 7274 6564 286c 6973 7428 6d69 7373  sorted(list(miss
+0003cee0: 696e 675f 726f 6973 2929 0a0a 2020 2020  ing_rois))..    
+0003cef0: 6465 6620 6861 735f 726f 6973 2873 656c  def has_rois(sel
+0003cf00: 662c 206e 616d 6573 3d4e 6f6e 652c 2069  f, names=None, i
+0003cf10: 6e63 6c75 6465 5f6b 6579 733d 4661 6c73  nclude_keys=Fals
+0003cf20: 6529 3a0a 2020 2020 2020 2020 2222 220a  e):.        """.
+0003cf30: 2020 2020 2020 2020 4465 7465 726d 696e          Determin
+0003cf40: 6520 7768 6574 6865 7220 7374 7275 6374  e whether struct
+0003cf50: 7572 6520 7365 7420 636f 6e74 6169 6e73  ure set contains
+0003cf60: 2073 7065 6369 6669 6564 2052 4f49 732c   specified ROIs,
+0003cf70: 0a20 2020 2020 2020 2069 6465 6e74 6966  .        identif
+0003cf80: 6965 6420 6279 2061 206e 6f6d 696e 616c  ied by a nominal
+0003cf90: 206e 616d 6520 6f72 2062 7920 616e 2061   name or by an a
+0003cfa0: 6c69 6173 2e0a 0a20 2020 2020 2020 2054  lias...        T
+0003cfb0: 6869 7320 6d65 7468 6f64 2072 6574 7572  his method retur
+0003cfc0: 6e73 2054 7275 6520 6966 2061 6c6c 2073  ns True if all s
+0003cfd0: 7065 6369 6669 6564 2052 4f49 206e 616d  pecified ROI nam
+0003cfe0: 6573 2061 7265 206d 6174 6368 6564 0a20  es are matched. 
+0003cff0: 2020 2020 2020 2077 6974 6820 7468 6520         with the 
+0003d000: 6e61 6d65 206f 6620 616e 2052 4f49 2069  name of an ROI i
+0003d010: 6e20 7468 6520 7374 7275 6374 7572 6520  n the structure 
+0003d020: 7365 742c 2061 6e64 2072 6574 7572 6e73  set, and returns
+0003d030: 2046 616c 7365 0a20 2020 2020 2020 206f   False.        o
+0003d040: 7468 6572 7769 7365 2e20 204d 6174 6368  therwise.  Match
+0003d050: 696e 6720 6973 2063 6173 6520 696e 7365  ing is case inse
+0003d060: 6e73 6974 6976 652e 0a0a 2020 2020 2020  nsitive...      
+0003d070: 2020 6e61 6d65 7320 3a20 7374 722f 6c69    names : str/li
+0003d080: 7374 2f64 6963 740a 2020 2020 2020 2020  st/dict.        
+0003d090: 2020 2020 5370 6563 6966 6963 6174 696f      Specificatio
+0003d0a0: 6e20 6f66 2052 4f49 733a 0a20 2020 2020  n of ROIs:.     
+0003d0b0: 2020 2020 2020 202d 2061 2073 696e 676c         - a singl
+0003d0c0: 6520 524f 4920 6e61 6d65 2c20 6f70 7469  e ROI name, opti
+0003d0d0: 6f6e 616c 6c79 2069 6e63 6c75 6469 6e67  onally including
+0003d0e0: 2077 696c 6463 6172 6473 3b0a 2020 2020   wildcards;.    
+0003d0f0: 2020 2020 2020 2020 2d20 6120 6c69 7374          - a list
+0003d100: 206f 6620 524f 4920 6e61 6d65 732c 2065   of ROI names, e
+0003d110: 6163 6820 6f70 7469 6f6e 616c 6c79 2069  ach optionally i
+0003d120: 6e63 6c75 6469 6e67 2077 696c 6463 6172  ncluding wildcar
+0003d130: 6473 3b0a 2020 2020 2020 2020 2020 2020  ds;.            
+0003d140: 2d20 6120 6469 6374 696f 6e61 7279 2c20  - a dictionary, 
+0003d150: 7768 6572 6520 6b65 7973 2061 7265 206e  where keys are n
+0003d160: 6f6d 696e 616c 2052 4f49 206e 616d 6573  ominal ROI names
+0003d170: 2c0a 2020 2020 2020 2020 2020 2020 616e  ,.            an
+0003d180: 6420 7661 6c75 6573 2061 7265 206c 6973  d values are lis
+0003d190: 7473 206f 6620 706f 7373 6962 6c65 206e  ts of possible n
+0003d1a0: 616d 6573 2c20 6f70 7469 6f6e 616c 6c79  ames, optionally
+0003d1b0: 2069 6e63 6c75 6469 6e67 0a20 2020 2020   including.     
+0003d1c0: 2020 2020 2020 2077 696c 6463 6172 6473         wildcards
+0003d1d0: 2e0a 0a20 2020 2020 2020 2069 6e63 6c75  ...        inclu
+0003d1e0: 6465 5f6b 6579 7320 3a20 626f 6f6c 2c20  de_keys : bool, 
+0003d1f0: 6465 6661 756c 743d 5472 7565 0a20 2020  default=True.   
+0003d200: 2020 2020 2020 2020 2049 6620 5472 7565           If True
+0003d210: 2c20 636f 6e73 6964 6572 2062 6f74 6820  , consider both 
+0003d220: 6b65 7973 2061 6e64 2076 616c 7565 7320  keys and values 
+0003d230: 666f 7220 6d61 7463 6869 6e67 2069 6620  for matching if 
+0003d240: 524f 4920 6e61 6d65 730a 2020 2020 2020  ROI names.      
+0003d250: 2020 2020 2020 6172 6520 7370 6563 6966        are specif
+0003d260: 6965 6420 6173 2061 2064 6963 7469 6f6e  ied as a diction
+0003d270: 6172 792e 2020 4966 2046 616c 7365 2c20  ary.  If False, 
+0003d280: 636f 6e73 6964 6572 2076 616c 7565 7320  consider values 
+0003d290: 6f6e 6c79 2e0a 2020 2020 2020 2020 2222  only..        ""
+0003d2a0: 220a 2020 2020 2020 2020 2320 436f 6e76  ".        # Conv
+0003d2b0: 6572 7420 6e61 6d65 7320 746f 2061 2064  ert names to a d
+0003d2c0: 6963 7469 6f6e 6172 792c 2077 6865 7265  ictionary, where
+0003d2d0: 2065 6163 6820 7661 6c75 6520 6973 2061   each value is a
+0003d2e0: 206c 6973 742e 0a20 2020 2020 2020 2069   list..        i
+0003d2f0: 6620 6973 696e 7374 616e 6365 286e 616d  f isinstance(nam
+0003d300: 6573 2c20 7374 7229 3a0a 2020 2020 2020  es, str):.      
+0003d310: 2020 2020 2020 6e61 6d65 7320 3d20 7b6e        names = {n
+0003d320: 616d 6573 3a20 5b6e 616d 6573 5d7d 0a20  ames: [names]}. 
+0003d330: 2020 2020 2020 2065 6c69 6620 736b 7274         elif skrt
+0003d340: 2e63 6f72 652e 6973 5f6c 6973 7428 6e61  .core.is_list(na
+0003d350: 6d65 7329 3a0a 2020 2020 2020 2020 2020  mes):.          
+0003d360: 2020 6e61 6d65 7320 3d20 7b6e 616d 653a    names = {name:
+0003d370: 205b 6e61 6d65 5d20 666f 7220 6e61 6d65   [name] for name
+0003d380: 2069 6e20 6e61 6d65 737d 0a20 2020 2020   in names}.     
+0003d390: 2020 2065 6c69 6620 6973 696e 7374 616e     elif isinstan
+0003d3a0: 6365 286e 616d 6573 2c20 6469 6374 293a  ce(names, dict):
+0003d3b0: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
+0003d3c0: 206e 616d 6520 696e 206e 616d 6573 3a0a   name in names:.
+0003d3d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003d3e0: 6966 2069 7369 6e73 7461 6e63 6528 6e61  if isinstance(na
+0003d3f0: 6d65 735b 6e61 6d65 5d2c 2073 7472 293a  mes[name], str):
+0003d400: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0003d410: 2020 2020 206e 616d 6573 5b6e 616d 655d       names[name]
+0003d420: 203d 205b 6e61 6d65 735b 6e61 6d65 5d5d   = [names[name]]
+0003d430: 0a0a 2020 2020 2020 2020 2320 4578 6974  ..        # Exit
+0003d440: 2069 7320 6e61 6d65 7320 6973 6e27 7420   is names isn't 
+0003d450: 6120 6469 6374 696f 6e61 7279 2e0a 2020  a dictionary..  
+0003d460: 2020 2020 2020 6966 206e 6f74 2069 7369        if not isi
+0003d470: 6e73 7461 6e63 6528 6e61 6d65 732c 2064  nstance(names, d
+0003d480: 6963 7429 3a0a 2020 2020 2020 2020 2020  ict):.          
+0003d490: 2020 7265 7475 726e 2046 616c 7365 0a0a    return False..
+0003d4a0: 2020 2020 2020 2020 2320 5472 7920 746f          # Try to
+0003d4b0: 206d 6174 6368 2065 6163 6820 524f 4920   match each ROI 
+0003d4c0: 6e61 6d65 2077 6974 6820 6e6f 6d69 6e61  name with nomina
+0003d4d0: 6c20 6e61 6d65 206f 7220 616e 7920 616c  l name or any al
+0003d4e0: 6961 7365 732e 0a20 2020 2020 2020 2066  iases..        f
+0003d4f0: 6f72 206e 616d 652c 2061 6c69 6173 6573  or name, aliases
+0003d500: 2069 6e20 6e61 6d65 732e 6974 656d 7328   in names.items(
+0003d510: 293a 0a20 2020 2020 2020 2020 2020 2069  ):.            i
+0003d520: 6620 696e 636c 7564 655f 6b65 7973 3a0a  f include_keys:.
+0003d530: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003d540: 6e61 6d65 735f 746f 5f6d 6174 6368 203d  names_to_match =
+0003d550: 205b 6e61 6d65 5d20 2b20 616c 6961 7365   [name] + aliase
+0003d560: 730a 2020 2020 2020 2020 2020 2020 656c  s.            el
+0003d570: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+0003d580: 2020 2020 6e61 6d65 735f 746f 5f6d 6174      names_to_mat
+0003d590: 6368 203d 2061 6c69 6173 6573 0a20 2020  ch = aliases.   
+0003d5a0: 2020 2020 2020 2020 2066 6f72 206e 616d           for nam
+0003d5b0: 655f 746f 5f6d 6174 6368 2069 6e20 6e61  e_to_match in na
+0003d5c0: 6d65 735f 746f 5f6d 6174 6368 3a0a 2020  mes_to_match:.  
+0003d5d0: 2020 2020 2020 2020 2020 2020 2020 666f                fo
+0003d5e0: 7220 726f 695f 6e61 6d65 2069 6e20 7365  r roi_name in se
+0003d5f0: 6c66 2e67 6574 5f72 6f69 5f6e 616d 6573  lf.get_roi_names
+0003d600: 2829 3a0a 2020 2020 2020 2020 2020 2020  ():.            
+0003d610: 2020 2020 2020 2020 6d61 7463 6820 3d20          match = 
+0003d620: 666e 6d61 7463 682e 666e 6d61 7463 6828  fnmatch.fnmatch(
+0003d630: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0003d640: 2020 2020 2020 2020 2020 2020 2072 6f69               roi
+0003d650: 5f6e 616d 652e 6c6f 7765 7228 292c 206e  _name.lower(), n
+0003d660: 616d 655f 746f 5f6d 6174 6368 2e6c 6f77  ame_to_match.low
+0003d670: 6572 2829 290a 2020 2020 2020 2020 2020  er()).          
+0003d680: 2020 2020 2020 2020 2020 6966 206d 6174            if mat
+0003d690: 6368 3a0a 2020 2020 2020 2020 2020 2020  ch:.            
+0003d6a0: 2020 2020 2020 2020 2020 2020 6272 6561              brea
+0003d6b0: 6b0a 2020 2020 2020 2020 2020 2020 2020  k.              
+0003d6c0: 2020 6966 206d 6174 6368 3a0a 2020 2020    if match:.    
+0003d6d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003d6e0: 6272 6561 6b0a 2020 2020 2020 2020 2020  break.          
+0003d6f0: 2020 6966 206e 6f74 206d 6174 6368 3a0a    if not match:.
+0003d700: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003d710: 7265 7475 726e 2046 616c 7365 0a0a 2020  return False..  
+0003d720: 2020 2020 2020 7265 7475 726e 2054 7275        return Tru
+0003d730: 650a 0a20 2020 2064 6566 2072 656e 616d  e..    def renam
+0003d740: 655f 726f 6973 280a 2020 2020 2020 2020  e_rois(.        
+0003d750: 7365 6c66 2c20 6e61 6d65 733d 4e6f 6e65  self, names=None
+0003d760: 2c20 6669 7273 745f 6d61 7463 685f 6f6e  , first_match_on
+0003d770: 6c79 3d54 7275 652c 206b 6565 705f 7265  ly=True, keep_re
+0003d780: 6e61 6d65 645f 6f6e 6c79 3d46 616c 7365  named_only=False
+0003d790: 0a20 2020 2029 3a0a 2020 2020 2020 2020  .    ):.        
+0003d7a0: 2222 2252 656e 616d 6520 524f 4973 2069  """Rename ROIs i
+0003d7b0: 6e20 7468 6973 2053 7472 7563 7475 7265  n this Structure
+0003d7c0: 5365 742e 0a20 2020 2020 2020 203c 6669  Set..        <fi
+0003d7d0: 7273 745f 6d61 7463 685f 6f6e 6c79 3e20  rst_match_only> 
+0003d7e0: 6973 2054 7275 652c 206f 6e6c 7920 7468  is True, only th
+0003d7f0: 6520 6669 7273 7420 524f 4920 6d61 7463  e first ROI matc
+0003d800: 6869 6e67 2074 6865 0a20 2020 2020 2020  hing the.       
+0003d810: 2070 6f73 7369 626c 6520 6d61 7463 6865   possible matche
+0003d820: 7320 7769 6c6c 2062 6520 7265 6e61 6d65  s will be rename
+0003d830: 642e 0a0a 2020 2020 2020 2020 2a2a 5061  d...        **Pa
+0003d840: 7261 6d65 7465 7273 3a2a 2a0a 2020 2020  rameters:**.    
+0003d850: 2020 2020 0a20 2020 2020 2020 206e 616d      .        nam
+0003d860: 6573 203a 2064 6963 742c 2064 6566 6175  es : dict, defau
+0003d870: 6c74 3d4e 6f6e 650a 2020 2020 2020 2020  lt=None.        
+0003d880: 2020 2020 4469 6374 696f 6e61 7279 206f      Dictionary o
+0003d890: 6620 6e61 6d65 7320 666f 7220 7265 6e61  f names for rena
+0003d8a0: 6d69 6e67 2052 4f49 732c 2077 6865 7265  ming ROIs, where
+0003d8b0: 2074 6865 206b 6579 7320 6172 6520 6e65   the keys are ne
+0003d8c0: 7720 0a20 2020 2020 2020 2020 2020 206e  w .            n
+0003d8d0: 616d 6573 2061 6e64 2076 616c 7565 7320  ames and values 
+0003d8e0: 6172 6520 6c69 7374 7320 6f66 2070 6f73  are lists of pos
+0003d8f0: 7369 626c 6520 6e61 6d65 7320 6f66 2052  sible names of R
+0003d900: 4f49 7320 7468 6174 2073 686f 756c 640a  OIs that should.
+0003d910: 2020 2020 2020 2020 2020 2020 6265 2061              be a
+0003d920: 7373 6967 6e65 6420 7468 6520 6e65 7720  ssigned the new 
+0003d930: 6e61 6d65 2e20 5468 6573 6520 6e61 6d65  name. These name
+0003d940: 7320 6361 6e20 616c 736f 2063 6f6e 7461  s can also conta
+0003d950: 696e 2077 696c 6463 6172 6473 0a20 2020  in wildcards.   
+0003d960: 2020 2020 2020 2020 2077 6974 6820 7468           with th
+0003d970: 6520 272a 2720 7379 6d62 6f6c 2e0a 0a20  e '*' symbol... 
+0003d980: 2020 2020 2020 2066 6972 7374 5f6d 6174         first_mat
+0003d990: 6368 5f6f 6e6c 7920 3a20 626f 6f6c 2c20  ch_only : bool, 
+0003d9a0: 6465 6661 756c 743d 5472 7565 0a20 2020  default=True.   
+0003d9b0: 2020 2020 2020 2020 2049 6620 5472 7565           If True
+0003d9c0: 2c20 6f6e 6c79 2074 6865 2066 6972 7374  , only the first
+0003d9d0: 2052 4f49 206d 6174 6368 696e 6720 7468   ROI matching th
+0003d9e0: 6520 706f 7373 6962 6c65 206e 616d 6573  e possible names
+0003d9f0: 2069 6e20 7468 6520 0a20 2020 2020 2020   in the .       
+0003da00: 2020 2020 2076 616c 7565 7320 6f66 203c       values of <
+0003da10: 6e61 6d65 733e 2077 696c 6c20 6265 2072  names> will be r
+0003da20: 656e 616d 6564 3b20 7468 6973 2070 7265  enamed; this pre
+0003da30: 7665 6e74 7320 6e61 6d65 2064 7570 6c69  vents name dupli
+0003da40: 6361 7469 6f6e 0a20 2020 2020 2020 2020  cation.         
+0003da50: 2020 2069 6620 6d75 6c74 6970 6c65 2052     if multiple R
+0003da60: 4f49 7320 696e 2074 6865 2053 7472 7563  OIs in the Struc
+0003da70: 7475 7265 5365 7420 6172 6520 6120 6d61  tureSet are a ma
+0003da80: 7463 682e 0a0a 2020 2020 2020 2020 6b65  tch...        ke
+0003da90: 6570 5f72 656e 616d 6564 5f6f 6e6c 7920  ep_renamed_only 
+0003daa0: 3a20 626f 6f6c 2c20 6465 6661 756c 743d  : bool, default=
+0003dab0: 4661 6c73 650a 2020 2020 2020 2020 2020  False.          
+0003dac0: 2020 4966 2054 7275 652c 2061 6e79 2052    If True, any R
+0003dad0: 4f49 7320 7468 6174 2064 6f20 6e6f 7420  OIs that do not 
+0003dae0: 6765 7420 7265 6e61 6d65 6420 7769 6c6c  get renamed will
+0003daf0: 2062 6520 7265 6d6f 7665 6420 6672 6f6d   be removed from
+0003db00: 0a20 2020 2020 2020 2020 2020 2074 6865  .            the
+0003db10: 2053 7472 7563 7475 7265 5365 742e 0a20   StructureSet.. 
+0003db20: 2020 2020 2020 2022 2222 0a0a 2020 2020         """..    
+0003db30: 2020 2020 6966 206e 616d 6573 2069 7320      if names is 
+0003db40: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+0003db50: 2020 6e61 6d65 7320 3d20 7365 6c66 2e6e    names = self.n
+0003db60: 616d 6573 0a20 2020 2020 2020 2069 6620  ames.        if 
+0003db70: 6e6f 7420 6e61 6d65 7320 6f72 206e 6f74  not names or not
+0003db80: 2069 7369 6e73 7461 6e63 6528 6e61 6d65   isinstance(name
+0003db90: 732c 2064 6963 7429 3a0a 2020 2020 2020  s, dict):.      
+0003dba0: 2020 2020 2020 7265 7475 726e 0a0a 2020        return..  
+0003dbb0: 2020 2020 2020 2320 4c6f 6f70 2074 6872        # Loop thr
+0003dbc0: 6f75 6768 2065 6163 6820 6e65 7720 6e61  ough each new na
+0003dbd0: 6d65 0a20 2020 2020 2020 2061 6c72 6561  me.        alrea
+0003dbe0: 6479 5f72 656e 616d 6564 203d 205b 5d0a  dy_renamed = [].
+0003dbf0: 2020 2020 2020 2020 666f 7220 6e61 6d65          for name
+0003dc00: 2c20 6d61 7463 6865 7320 696e 206e 616d  , matches in nam
+0003dc10: 6573 2e69 7465 6d73 2829 3a0a 0a20 2020  es.items():..   
+0003dc20: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
+0003dc30: 736b 7274 2e63 6f72 652e 6973 5f6c 6973  skrt.core.is_lis
+0003dc40: 7428 6d61 7463 6865 7329 3a0a 2020 2020  t(matches):.    
+0003dc50: 2020 2020 2020 2020 2020 2020 6d61 7463              matc
+0003dc60: 6865 7320 3d20 5b6d 6174 6368 6573 5d0a  hes = [matches].
+0003dc70: 0a20 2020 2020 2020 2020 2020 2023 204c  .            # L
+0003dc80: 6f6f 7020 7468 726f 7567 6820 616c 6c20  oop through all 
+0003dc90: 706f 7373 6962 6c65 206f 7269 6769 6e61  possible origina
+0003dca0: 6c20 6e61 6d65 730a 2020 2020 2020 2020  l names.        
+0003dcb0: 2020 2020 6e61 6d65 5f6d 6174 6368 6564      name_matched
+0003dcc0: 203d 2046 616c 7365 0a20 2020 2020 2020   = False.       
+0003dcd0: 2020 2020 2066 6f72 206d 2069 6e20 6d61       for m in ma
+0003dce0: 7463 6865 733a 0a0a 2020 2020 2020 2020  tches:..        
+0003dcf0: 2020 2020 2020 2020 2320 4c6f 6f70 2074          # Loop t
+0003dd00: 6872 6f75 6768 2052 4f49 7320 616e 6420  hrough ROIs and 
+0003dd10: 7365 6520 6966 2074 6865 7265 2773 2061  see if there's a
+0003dd20: 206d 6174 6368 0a20 2020 2020 2020 2020   match.         
+0003dd30: 2020 2020 2020 2066 6f72 2069 2c20 7320         for i, s 
+0003dd40: 696e 2065 6e75 6d65 7261 7465 2873 656c  in enumerate(sel
+0003dd50: 662e 6765 745f 726f 6973 2829 293a 0a0a  f.get_rois()):..
+0003dd60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003dd70: 2020 2020 2320 446f 6e27 7420 7265 6e61      # Don't rena
+0003dd80: 6d65 2061 6e20 524f 4920 6d6f 7265 2074  me an ROI more t
+0003dd90: 6861 6e20 6f6e 6365 0a20 2020 2020 2020  han once.       
+0003dda0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0003ddb0: 6920 696e 2061 6c72 6561 6479 5f72 656e  i in already_ren
+0003ddc0: 616d 6564 3a0a 2020 2020 2020 2020 2020  amed:.          
+0003ddd0: 2020 2020 2020 2020 2020 2020 2020 636f                co
+0003dde0: 6e74 696e 7565 0a0a 2020 2020 2020 2020  ntinue..        
+0003ddf0: 2020 2020 2020 2020 2020 2020 6966 2066              if f
+0003de00: 6e6d 6174 6368 2e66 6e6d 6174 6368 2873  nmatch.fnmatch(s
+0003de10: 2e6e 616d 652e 6c6f 7765 7228 292c 206d  .name.lower(), m
+0003de20: 2e6c 6f77 6572 2829 293a 0a20 2020 2020  .lower()):.     
+0003de30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003de40: 2020 2073 2e6e 616d 6520 3d20 6e61 6d65     s.name = name
+0003de50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0003de60: 2020 2020 2020 2020 206e 616d 655f 6d61           name_ma
+0003de70: 7463 6865 6420 3d20 5472 7565 0a20 2020  tched = True.   
+0003de80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003de90: 2020 2020 2061 6c72 6561 6479 5f72 656e       already_ren
+0003dea0: 616d 6564 2e61 7070 656e 6428 6929 0a20  amed.append(i). 
+0003deb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003dec0: 2020 2020 2020 2069 6620 6669 7273 745f         if first_
+0003ded0: 6d61 7463 685f 6f6e 6c79 3a0a 2020 2020  match_only:.    
+0003dee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003def0: 2020 2020 2020 2020 6272 6561 6b0a 0a20          break.. 
+0003df00: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+0003df10: 2049 6620 6669 7273 745f 6d61 7463 685f   If first_match_
+0003df20: 6f6e 6c79 2c20 646f 6e27 7420 7265 6e61  only, don't rena
+0003df30: 6d65 206d 6f72 6520 7468 616e 206f 6e65  me more than one
+0003df40: 2052 4f49 0a20 2020 2020 2020 2020 2020   ROI.           
+0003df50: 2020 2020 2023 2077 6974 6820 7468 6973       # with this
+0003df60: 206e 6577 206e 616d 650a 2020 2020 2020   new name.      
+0003df70: 2020 2020 2020 2020 2020 6966 206e 616d            if nam
+0003df80: 655f 6d61 7463 6865 6420 616e 6420 6669  e_matched and fi
+0003df90: 7273 745f 6d61 7463 685f 6f6e 6c79 3a0a  rst_match_only:.
+0003dfa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003dfb0: 2020 2020 6272 6561 6b0a 0a20 2020 2020      break..     
+0003dfc0: 2020 2023 204b 6565 7020 6f6e 6c79 2074     # Keep only t
+0003dfd0: 6865 2072 656e 616d 6564 2052 4f49 7320  he renamed ROIs 
+0003dfe0: 6966 2072 6571 7565 7374 6564 0a20 2020  if requested.   
+0003dff0: 2020 2020 2069 6620 6b65 6570 5f72 656e       if keep_ren
+0003e000: 616d 6564 5f6f 6e6c 793a 0a20 2020 2020  amed_only:.     
+0003e010: 2020 2020 2020 2072 656e 616d 6564 5f72         renamed_r
+0003e020: 6f69 7320 3d20 5b73 656c 662e 726f 6973  ois = [self.rois
+0003e030: 5b69 5d20 666f 7220 6920 696e 2061 6c72  [i] for i in alr
+0003e040: 6561 6479 5f72 656e 616d 6564 5d0a 2020  eady_renamed].  
+0003e050: 2020 2020 2020 2020 2020 7365 6c66 2e72            self.r
+0003e060: 6f69 7320 3d20 7265 6e61 6d65 645f 726f  ois = renamed_ro
+0003e070: 6973 0a0a 2020 2020 6465 6620 6669 6c74  is..    def filt
+0003e080: 6572 5f72 6f69 7328 7365 6c66 2c20 746f  er_rois(self, to
+0003e090: 5f6b 6565 703d 4e6f 6e65 2c20 746f 5f72  _keep=None, to_r
+0003e0a0: 656d 6f76 653d 4e6f 6e65 293a 0a20 2020  emove=None):.   
+0003e0b0: 2020 2020 2022 2222 4b65 6570 206f 6e6c       """Keep onl
+0003e0c0: 7920 7468 6520 524f 4973 2069 6e20 7468  y the ROIs in th
+0003e0d0: 6520 746f 5f6b 6565 7020 6c69 7374 2061  e to_keep list a
+0003e0e0: 6e64 2072 656d 6f76 6520 616e 7920 696e  nd remove any in
+0003e0f0: 2074 6865 0a20 2020 2020 2020 2074 6f5f   the.        to_
+0003e100: 7265 6d6f 7665 206c 6973 742e 0a0a 2020  remove list...  
+0003e110: 2020 2020 2020 2a2a 5061 7261 6d65 7465        **Paramete
+0003e120: 7273 3a2a 2a0a 2020 2020 2020 2020 0a0a  rs:**.        ..
+0003e130: 2020 2020 2020 2020 746f 5f6b 6565 7020          to_keep 
+0003e140: 3a20 6c69 7374 2c20 6465 6661 756c 743d  : list, default=
+0003e150: 4e6f 6e65 0a20 2020 2020 2020 2020 2020  None.           
+0003e160: 204c 6973 7420 6f66 206e 616d 6573 206f   List of names o
+0003e170: 6620 524f 4973 2074 6f20 6b65 6570 2069  f ROIs to keep i
+0003e180: 6e20 7468 6520 636f 7069 6564 2053 7472  n the copied Str
+0003e190: 7563 7475 7265 5365 743b 2061 6c6c 200a  uctureSet; all .
+0003e1a0: 2020 2020 2020 2020 2020 2020 6f74 6865              othe
+0003e1b0: 7273 2077 696c 6c20 6265 2072 656d 6f76  rs will be remov
+0003e1c0: 6564 2e20 5468 6573 6520 6e61 6d65 7320  ed. These names 
+0003e1d0: 6361 6e20 616c 736f 2063 6f6e 7461 696e  can also contain
+0003e1e0: 2077 696c 6463 6172 6473 0a20 2020 2020   wildcards.     
+0003e1f0: 2020 2020 2020 2077 6974 6820 7468 6520         with the 
+0003e200: 272a 2720 7379 6d62 6f6c 2e20 0a0a 2020  '*' symbol. ..  
+0003e210: 2020 2020 2020 746f 5f72 656d 6f76 6520        to_remove 
+0003e220: 3a20 6c69 7374 2c20 6465 6661 756c 743d  : list, default=
+0003e230: 4e6f 6e65 0a20 2020 2020 2020 2020 2020  None.           
+0003e240: 204c 6973 7420 6f66 206e 616d 6573 206f   List of names o
+0003e250: 6620 524f 4973 2074 6f20 7265 6d6f 7665  f ROIs to remove
+0003e260: 2066 726f 6d20 7468 6520 636f 7069 6564   from the copied
+0003e270: 2053 7472 7563 7475 7265 5365 743b 2061   StructureSet; a
+0003e280: 6c6c 200a 2020 2020 2020 2020 2020 2020  ll .            
+0003e290: 6f74 6865 7273 2077 696c 6c20 6265 2072  others will be r
+0003e2a0: 656d 6f76 6564 2e20 5468 6573 6520 6e61  emoved. These na
+0003e2b0: 6d65 7320 6361 6e20 616c 736f 2063 6f6e  mes can also con
+0003e2c0: 7461 696e 2077 696c 6463 6172 6473 0a20  tain wildcards. 
+0003e2d0: 2020 2020 2020 2020 2020 2077 6974 6820             with 
+0003e2e0: 7468 6520 272a 2720 7379 6d62 6f6c 2e20  the '*' symbol. 
+0003e2f0: 4170 706c 6965 6420 6166 7465 7220 6669  Applied after fi
+0003e300: 6c74 6572 696e 6720 7769 7468 203c 746f  ltering with <to
+0003e310: 5f6b 6565 703e 2e0a 2020 2020 2020 2020  _keep>..        
+0003e320: 2222 220a 0a20 2020 2020 2020 2023 2045  """..        # E
+0003e330: 6e73 7572 6520 746f 5f6b 6565 7020 616e  nsure to_keep an
+0003e340: 6420 746f 5f72 656d 6f76 6520 6172 6520  d to_remove are 
+0003e350: 6c69 7374 730a 2020 2020 2020 2020 6966  lists.        if
+0003e360: 2074 6f5f 6b65 6570 2069 7320 4e6f 6e65   to_keep is None
+0003e370: 3a0a 2020 2020 2020 2020 2020 2020 746f  :.            to
+0003e380: 5f6b 6565 7020 3d20 7365 6c66 2e74 6f5f  _keep = self.to_
+0003e390: 6b65 6570 0a20 2020 2020 2020 2065 6c69  keep.        eli
+0003e3a0: 6620 6e6f 7420 736b 7274 2e63 6f72 652e  f not skrt.core.
+0003e3b0: 6973 5f6c 6973 7428 746f 5f6b 6565 7029  is_list(to_keep)
+0003e3c0: 3a0a 2020 2020 2020 2020 2020 2020 746f  :.            to
+0003e3d0: 5f6b 6565 7020 3d20 5b74 6f5f 6b65 6570  _keep = [to_keep
+0003e3e0: 5d0a 2020 2020 2020 2020 6966 2074 6f5f  ].        if to_
+0003e3f0: 7265 6d6f 7665 2069 7320 4e6f 6e65 3a0a  remove is None:.
+0003e400: 2020 2020 2020 2020 2020 2020 746f 5f72              to_r
+0003e410: 656d 6f76 6520 3d20 7365 6c66 2e74 6f5f  emove = self.to_
+0003e420: 7265 6d6f 7665 0a20 2020 2020 2020 2065  remove.        e
+0003e430: 6c69 6620 6e6f 7420 736b 7274 2e63 6f72  lif not skrt.cor
+0003e440: 652e 6973 5f6c 6973 7428 746f 5f72 656d  e.is_list(to_rem
+0003e450: 6f76 6529 3a0a 2020 2020 2020 2020 2020  ove):.          
+0003e460: 2020 746f 5f72 656d 6f76 6520 3d20 5b74    to_remove = [t
+0003e470: 6f5f 7265 6d6f 7665 5d0a 0a20 2020 2020  o_remove]..     
+0003e480: 2020 2023 204b 6565 7020 6f6e 6c79 2074     # Keep only t
+0003e490: 6865 2052 4f49 7320 696e 2074 6f5f 6b65  he ROIs in to_ke
+0003e4a0: 6570 0a20 2020 2020 2020 2073 656c 662e  ep.        self.
+0003e4b0: 6c6f 6164 2829 0a20 2020 2020 2020 2069  load().        i
+0003e4c0: 6620 746f 5f6b 6565 7020 6973 206e 6f74  f to_keep is not
+0003e4d0: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+0003e4e0: 2020 206b 6565 7020 3d20 5b5d 0a20 2020     keep = [].   
+0003e4f0: 2020 2020 2020 2020 2066 6f72 2072 6f69           for roi
+0003e500: 2069 6e20 7365 6c66 2e72 6f69 733a 0a20   in self.rois:. 
+0003e510: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0003e520: 6620 616e 7928 5b66 6e6d 6174 6368 2e66  f any([fnmatch.f
+0003e530: 6e6d 6174 6368 2872 6f69 2e6e 616d 652e  nmatch(roi.name.
+0003e540: 6c6f 7765 7228 292c 206b 2e6c 6f77 6572  lower(), k.lower
+0003e550: 2829 2920 0a20 2020 2020 2020 2020 2020  ()) .           
+0003e560: 2020 2020 2020 2020 2020 2020 2066 6f72               for
+0003e570: 206b 2069 6e20 746f 5f6b 6565 705d 293a   k in to_keep]):
+0003e580: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0003e590: 2020 2020 206b 6565 702e 6170 7065 6e64       keep.append
+0003e5a0: 2872 6f69 290a 2020 2020 2020 2020 2020  (roi).          
+0003e5b0: 2020 7365 6c66 2e72 6f69 7320 3d20 6b65    self.rois = ke
+0003e5c0: 6570 0a0a 2020 2020 2020 2020 2320 5265  ep..        # Re
+0003e5d0: 6d6f 7665 2074 6865 2052 4f49 7320 696e  move the ROIs in
+0003e5e0: 2074 6f5f 7265 6d6f 7665 0a20 2020 2020   to_remove.     
+0003e5f0: 2020 2069 6620 746f 5f72 656d 6f76 6520     if to_remove 
+0003e600: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
+0003e610: 2020 2020 2020 2020 206b 6565 7020 3d20           keep = 
+0003e620: 5b5d 0a20 2020 2020 2020 2020 2020 2066  [].            f
+0003e630: 6f72 2072 6f69 2069 6e20 7365 6c66 2e72  or roi in self.r
+0003e640: 6f69 733a 0a20 2020 2020 2020 2020 2020  ois:.           
+0003e650: 2020 2020 2069 6620 6e6f 7420 616e 7928       if not any(
+0003e660: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0003e670: 2020 2020 205b 666e 6d61 7463 682e 666e       [fnmatch.fn
+0003e680: 6d61 7463 6828 726f 692e 6e61 6d65 2e6c  match(roi.name.l
+0003e690: 6f77 6572 2829 2c20 722e 6c6f 7765 7228  ower(), r.lower(
+0003e6a0: 2929 200a 2020 2020 2020 2020 2020 2020  )) .            
+0003e6b0: 2020 2020 2020 2020 2066 6f72 2072 2069           for r i
+0003e6c0: 6e20 746f 5f72 656d 6f76 655d 0a20 2020  n to_remove].   
+0003e6d0: 2020 2020 2020 2020 2020 2020 2029 3a0a               ):.
+0003e6e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003e6f0: 2020 2020 6b65 6570 2e61 7070 656e 6428      keep.append(
+0003e700: 726f 6929 0a20 2020 2020 2020 2020 2020  roi).           
+0003e710: 2073 656c 662e 726f 6973 203d 206b 6565   self.rois = kee
+0003e720: 700a 0a20 2020 2064 6566 2073 6574 5f61  p..    def set_a
+0003e730: 6c70 6861 5f62 6574 615f 7261 7469 6f73  lpha_beta_ratios
+0003e740: 280a 2020 2020 2020 2020 2020 2020 7365  (.            se
+0003e750: 6c66 2c20 616c 7068 615f 6265 7461 5f72  lf, alpha_beta_r
+0003e760: 6174 696f 733d 4e6f 6e65 2c20 7365 745f  atios=None, set_
+0003e770: 6173 5f64 6566 6175 6c74 3d54 7275 6529  as_default=True)
+0003e780: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
+0003e790: 2020 2020 2020 5365 7420 7261 7469 6f73        Set ratios
+0003e7a0: 2066 6f72 2052 4f49 2074 6973 7375 6573   for ROI tissues
+0003e7b0: 206f 6620 636f 6566 6669 6369 656e 7473   of coefficients
+0003e7c0: 206f 6620 6c69 6e65 6172 2d71 7561 6472   of linear-quadr
+0003e7d0: 6174 6963 2065 7175 6174 696f 6e2e 0a0a  atic equation...
+0003e7e0: 2020 2020 2020 2020 4f70 7469 6f6e 616c          Optional
+0003e7f0: 6c79 2069 6e70 7574 2076 616c 7565 7320  ly input values 
+0003e800: 666f 7220 7261 7469 6f73 2061 7320 7374  for ratios as st
+0003e810: 7275 6374 7572 652d 7365 7420 6465 6661  ructure-set defa
+0003e820: 756c 742e 0a0a 2020 2020 2020 2020 2a2a  ult...        **
+0003e830: 5061 7261 6d65 7465 723a 2a2a 0a0a 2020  Parameter:**..  
+0003e840: 2020 2020 2020 616c 7068 615f 6265 7461        alpha_beta
+0003e850: 5f72 6174 696f 7320 3a20 6469 6374 2c20  _ratios : dict, 
+0003e860: 6465 6661 756c 743d 4e6f 6e65 0a20 2020  default=None.   
+0003e870: 2020 2020 2020 2020 2044 6963 7469 6f6e           Diction
+0003e880: 6172 7920 7768 6572 6520 6b65 7973 2061  ary where keys a
+0003e890: 7265 2052 4f49 206e 616d 6573 2061 6e64  re ROI names and
+0003e8a0: 2076 616c 7565 7320 6172 650a 2020 2020   values are.    
+0003e8b0: 2020 2020 2020 2020 7261 7469 6f73 2066          ratios f
+0003e8c0: 6f72 2052 4f49 2074 6973 7375 6573 206f  or ROI tissues o
+0003e8d0: 6620 636f 6566 6669 6369 656e 7473 2c20  f coefficients, 
+0003e8e0: 616c 7068 612c 2062 6574 612c 0a20 2020  alpha, beta,.   
+0003e8f0: 2020 2020 2020 2020 2069 6e20 7468 6520           in the 
+0003e900: 6c69 6e65 6172 2d71 7561 6472 6174 6963  linear-quadratic
+0003e910: 2065 7175 6174 696f 6e2e 2020 5468 6573   equation.  Thes
+0003e920: 6520 7261 7469 6f73 2061 7265 0a20 2020  e ratios are.   
+0003e930: 2020 2020 2020 2020 2075 7365 6420 696e           used in
+0003e940: 2063 616c 6375 6c61 7469 6e67 2062 696f   calculating bio
+0003e950: 6c6f 6769 6361 6c6c 7920 6566 6665 6374  logically effect
+0003e960: 6976 6520 646f 7365 2c20 4245 442c 2066  ive dose, BED, f
+0003e970: 726f 6d0a 2020 2020 2020 2020 2020 2020  rom.            
+0003e980: 7068 7973 6963 616c 2064 6f73 652c 2044  physical dose, D
+0003e990: 2c20 6465 6c69 7665 7265 6420 6f76 6572  , delivered over
+0003e9a0: 206e 2065 7175 616c 2066 7261 6374 696f   n equal fractio
+0003e9b0: 6e73 3a0a 2020 2020 2020 2020 2020 2020  ns:.            
+0003e9c0: 2020 2020 4245 4420 3d20 4420 2a20 2831      BED = D * (1
+0003e9d0: 202b 2028 442f 6e29 202f 2028 616c 7068   + (D/n) / (alph
+0003e9e0: 612f 6265 7461 2929 2e0a 2020 2020 2020  a/beta))..      
+0003e9f0: 2020 2020 2020 5468 6520 6174 7472 6962        The attrib
+0003ea00: 7574 6520 616c 7068 615f 6f76 6572 5f76  ute alpha_over_v
+0003ea10: 616c 7565 2069 7320 7365 7420 746f 2074  alue is set to t
+0003ea20: 6865 2064 6963 7469 6f6e 6172 7920 7661  he dictionary va
+0003ea30: 6c75 650a 2020 2020 2020 2020 2020 2020  lue.            
+0003ea40: 666f 7220 616e 2052 4f49 2069 6465 6e74  for an ROI ident
+0003ea50: 6966 6965 6420 6279 2061 206b 6579 2c20  ified by a key, 
+0003ea60: 6f72 2069 7320 7365 7420 746f 204e 6f6e  or is set to Non
+0003ea70: 6520 666f 7220 616e 790a 2020 2020 2020  e for any.      
+0003ea80: 2020 2020 2020 6f74 6865 7220 524f 4973        other ROIs
+0003ea90: 2e20 2049 6620 7468 6973 2070 6172 616d  .  If this param
+0003eaa0: 6574 6572 2069 7320 7365 7420 746f 204e  eter is set to N
+0003eab0: 6f6e 652c 2076 616c 7565 7320 6172 6520  one, values are 
+0003eac0: 7365 740a 2020 2020 2020 2020 2020 2020  set.            
+0003ead0: 6672 6f6d 2073 656c 662e 616c 7068 615f  from self.alpha_
+0003eae0: 6265 7461 5f72 6174 696f 732e 0a0a 2020  beta_ratios...  
+0003eaf0: 2020 2020 2020 7365 745f 6173 5f64 6566        set_as_def
+0003eb00: 6175 6c74 203a 2062 6f6f 6c2c 2064 6566  ault : bool, def
+0003eb10: 6175 6c74 3d54 7275 650a 2020 2020 2020  ault=True.      
+0003eb20: 2020 2020 2020 4966 2054 7275 652c 2061        If True, a
+0003eb30: 6e64 2061 6c70 6861 5f62 6574 615f 7261  nd alpha_beta_ra
+0003eb40: 7469 6f73 2069 736e 2774 204e 6f6e 652c  tios isn't None,
+0003eb50: 2073 6574 0a20 2020 2020 2020 2020 2020   set.           
+0003eb60: 2073 656c 662e 616c 7068 615f 6265 7461   self.alpha_beta
+0003eb70: 5f72 6174 696f 7320 746f 2074 6865 2076  _ratios to the v
+0003eb80: 616c 7565 206f 6620 616c 7068 615f 6265  alue of alpha_be
+0003eb90: 7461 5f72 6174 696f 732e 0a20 2020 2020  ta_ratios..     
+0003eba0: 2020 2022 2222 0a20 2020 2020 2020 2069     """.        i
+0003ebb0: 6620 616c 7068 615f 6265 7461 5f72 6174  f alpha_beta_rat
+0003ebc0: 696f 7320 6973 204e 6f6e 653a 0a20 2020  ios is None:.   
+0003ebd0: 2020 2020 2020 2020 2061 6c70 6861 5f62           alpha_b
+0003ebe0: 6574 615f 7261 7469 6f73 203d 2073 656c  eta_ratios = sel
+0003ebf0: 662e 616c 7068 615f 6265 7461 5f72 6174  f.alpha_beta_rat
+0003ec00: 696f 730a 2020 2020 2020 2020 656c 6966  ios.        elif
+0003ec10: 2073 6574 5f61 735f 6465 6661 756c 743a   set_as_default:
+0003ec20: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+0003ec30: 662e 616c 7068 615f 6265 7461 5f72 6174  f.alpha_beta_rat
+0003ec40: 696f 7320 3d20 616c 7068 615f 6265 7461  ios = alpha_beta
+0003ec50: 5f72 6174 696f 730a 0a20 2020 2020 2020  _ratios..       
+0003ec60: 2066 6f72 2072 6f69 2069 6e20 7365 6c66   for roi in self
+0003ec70: 2e67 6574 5f72 6f69 7328 293a 0a20 2020  .get_rois():.   
+0003ec80: 2020 2020 2020 2020 2072 6f69 2e73 6574           roi.set
+0003ec90: 5f61 6c70 6861 5f6f 7665 725f 6265 7461  _alpha_over_beta
+0003eca0: 2861 6c70 6861 5f62 6574 615f 7261 7469  (alpha_beta_rati
+0003ecb0: 6f73 2e67 6574 2872 6f69 2e6e 616d 652c  os.get(roi.name,
+0003ecc0: 204e 6f6e 6529 290a 0a20 2020 2064 6566   None))..    def
+0003ecd0: 2067 6574 5f61 6c70 6861 5f62 6574 615f   get_alpha_beta_
+0003ece0: 7261 7469 6f73 2873 656c 6629 3a0a 2020  ratios(self):.  
+0003ecf0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+0003ed00: 2020 4765 7420 6469 6374 696f 6e61 7279    Get dictionary
+0003ed10: 206f 6620 7261 7469 6f20 6f66 2063 6f65   of ratio of coe
+0003ed20: 6666 6963 6965 6e74 7320 6f66 206c 696e  fficients of lin
+0003ed30: 6561 722d 7175 6164 7261 7469 6320 6571  ear-quadratic eq
+0003ed40: 7561 7469 6f6e 2e0a 2020 2020 2020 2020  uation..        
+0003ed50: 2222 220a 2020 2020 2020 2020 7265 7475  """.        retu
+0003ed60: 726e 207b 726f 695f 6e61 6d65 203a 2073  rn {roi_name : s
+0003ed70: 656c 665b 726f 695f 6e61 6d65 5d2e 6765  elf[roi_name].ge
+0003ed80: 745f 616c 7068 615f 6f76 6572 5f62 6574  t_alpha_over_bet
+0003ed90: 6128 290a 2020 2020 2020 2020 2020 2020  a().            
+0003eda0: 2020 2020 666f 7220 726f 695f 6e61 6d65      for roi_name
+0003edb0: 2069 6e20 736f 7274 6564 2873 656c 662e   in sorted(self.
+0003edc0: 6765 745f 726f 695f 6e61 6d65 7328 2929  get_roi_names())
+0003edd0: 7d0a 0a20 2020 2064 6566 2067 6574 5f63  }..    def get_c
+0003ede0: 6f6c 6f72 7328 7365 6c66 293a 0a20 2020  olors(self):.   
+0003edf0: 2020 2020 2022 2222 4765 7420 6469 6374       """Get dict
+0003ee00: 206f 6620 524f 4920 636f 6c6f 7273 2066   of ROI colors f
+0003ee10: 6f72 2065 6163 6820 6e61 6d65 2e22 2222  or each name."""
+0003ee20: 0a0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+0003ee30: 207b 726f 692e 6e61 6d65 3a20 726f 692e   {roi.name: roi.
+0003ee40: 636f 6c6f 7220 666f 7220 726f 6920 696e  color for roi in
+0003ee50: 2073 656c 662e 6765 745f 726f 6973 2829   self.get_rois()
+0003ee60: 7d0a 0a20 2020 2064 6566 2072 6563 6f6c  }..    def recol
+0003ee70: 6f72 5f72 6f69 7328 7365 6c66 2c20 636f  or_rois(self, co
+0003ee80: 6c6f 7273 293a 0a20 2020 2020 2020 2022  lors):.        "
+0003ee90: 2222 5365 7420 636f 6c6f 7273 206f 6620  ""Set colors of 
+0003eea0: 524f 4973 2075 7369 6e67 2061 206c 6973  ROIs using a lis
+0003eeb0: 7420 6f72 2064 6963 7420 6769 7665 6e20  t or dict given 
+0003eec0: 696e 203c 636f 6c6f 7273 3e2e 0a0a 2020  in <colors>...  
+0003eed0: 2020 2020 2020 2a2a 5061 7261 6d65 7465        **Paramete
+0003eee0: 7273 2a2a 3a0a 0a20 2020 2020 2020 2063  rs**:..        c
+0003eef0: 6f6c 6f72 7320 3a20 6c69 7374 2f64 6963  olors : list/dic
+0003ef00: 740a 2020 2020 2020 2020 2020 2020 4c69  t.            Li
+0003ef10: 7374 206f 7220 6469 6374 206f 6620 636f  st or dict of co
+0003ef20: 6c6f 7273 2e20 4966 2061 2064 6963 742c  lors. If a dict,
+0003ef30: 2074 6865 206b 6579 7320 7368 6f75 6c64   the keys should
+0003ef40: 2062 6520 524f 4920 6e61 6d65 7320 6f72   be ROI names or
+0003ef50: 0a20 2020 2020 2020 2020 2020 2077 696c  .            wil
+0003ef60: 6463 6172 6473 206d 6174 6368 696e 6720  dcards matching 
+0003ef70: 524f 4920 6e61 6d65 732c 2061 6e64 2074  ROI names, and t
+0003ef80: 6865 2076 616c 7565 7320 7368 6f75 6c64  he values should
+0003ef90: 2062 6520 6465 7369 7265 6420 0a20 2020   be desired .   
+0003efa0: 2020 2020 2020 2020 2063 6f6c 6f72 7320           colors 
+0003efb0: 666f 7220 524f 4973 206d 6174 6368 696e  for ROIs matchin
+0003efc0: 6720 7468 6174 206e 616d 652e 2049 6620  g that name. If 
+0003efd0: 6120 6c69 7374 2c20 7368 6f75 6c64 2063  a list, should c
+0003efe0: 6f6e 7461 696e 0a20 2020 2020 2020 2020  ontain.         
+0003eff0: 2020 2063 6f6c 6f72 7320 7768 6963 6820     colors which 
+0003f000: 7769 6c6c 2062 6520 6170 706c 6965 6420  will be applied 
+0003f010: 746f 206c 6f61 6465 6420 524f 4973 2069  to loaded ROIs i
+0003f020: 6e20 6f72 6465 722e 0a20 2020 2020 2020  n order..       
+0003f030: 2022 2222 0a0a 2020 2020 2020 2020 6966   """..        if
+0003f040: 2063 6f6c 6f72 7320 6973 204e 6f6e 653a   colors is None:
+0003f050: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+0003f060: 7572 6e0a 0a20 2020 2020 2020 2069 6620  urn..        if 
+0003f070: 6973 696e 7374 616e 6365 2863 6f6c 6f72  isinstance(color
+0003f080: 732c 2064 6963 7429 3a0a 2020 2020 2020  s, dict):.      
+0003f090: 2020 2020 2020 666f 7220 6e61 6d65 2c20        for name, 
+0003f0a0: 636f 6c6f 7220 696e 2063 6f6c 6f72 732e  color in colors.
+0003f0b0: 6974 656d 7328 293a 0a20 2020 2020 2020  items():.       
+0003f0c0: 2020 2020 2020 2020 2066 6f72 2072 6f69           for roi
+0003f0d0: 2069 6e20 7365 6c66 2e72 6f69 733a 0a20   in self.rois:. 
+0003f0e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003f0f0: 2020 2069 6620 666e 6d61 7463 682e 666e     if fnmatch.fn
+0003f100: 6d61 7463 6828 726f 692e 6e61 6d65 2e6c  match(roi.name.l
+0003f110: 6f77 6572 2829 2c20 6e61 6d65 2e6c 6f77  ower(), name.low
+0003f120: 6572 2829 293a 0a20 2020 2020 2020 2020  er()):.         
+0003f130: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+0003f140: 6f69 2e73 6574 5f63 6f6c 6f72 2863 6f6c  oi.set_color(col
+0003f150: 6f72 290a 2020 2020 2020 2020 656c 6966  or).        elif
+0003f160: 2069 7369 6e73 7461 6e63 6528 636f 6c6f   isinstance(colo
+0003f170: 7273 2c20 6c69 7374 293a 0a20 2020 2020  rs, list):.     
+0003f180: 2020 2020 2020 2066 6f72 2069 2c20 636f         for i, co
+0003f190: 6c6f 7220 696e 2065 6e75 6d65 7261 7465  lor in enumerate
+0003f1a0: 2863 6f6c 6f72 7329 3a0a 2020 2020 2020  (colors):.      
+0003f1b0: 2020 2020 2020 2020 2020 6966 2069 203e            if i >
+0003f1c0: 3d20 6c65 6e28 7365 6c66 2e72 6f69 7329  = len(self.rois)
+0003f1d0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0003f1e0: 2020 2020 2020 7265 7475 726e 0a20 2020        return.   
+0003f1f0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+0003f200: 662e 726f 6973 5b69 5d2e 7365 745f 636f  f.rois[i].set_co
+0003f210: 6c6f 7228 636f 6c6f 7229 0a20 2020 2020  lor(color).     
+0003f220: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+0003f230: 2020 2020 2072 6169 7365 2054 7970 6545       raise TypeE
+0003f240: 7272 6f72 2822 3c63 6f6c 6f72 733e 206d  rror("<colors> m
+0003f250: 7573 7420 6265 206c 6973 7420 6f72 2064  ust be list or d
+0003f260: 6963 742e 2229 0a0a 2020 2020 6465 6620  ict.")..    def 
+0003f270: 6164 645f 726f 6973 2873 656c 662c 2073  add_rois(self, s
+0003f280: 6f75 7263 6573 293a 0a20 2020 2020 2020  ources):.       
+0003f290: 2022 2222 4164 6420 6164 6469 7469 6f6e   """Add addition
+0003f2a0: 616c 2052 4f49 7320 6672 6f6d 2073 6f75  al ROIs from sou
+0003f2b0: 7263 6528 7329 2e22 2222 0a0a 2020 2020  rce(s)."""..    
+0003f2c0: 2020 2020 6966 206e 6f74 2073 6b72 742e      if not skrt.
+0003f2d0: 636f 7265 2e69 735f 6c69 7374 2873 6f75  core.is_list(sou
+0003f2e0: 7263 6573 293a 0a20 2020 2020 2020 2020  rces):.         
+0003f2f0: 2020 2073 6f75 7263 6573 203d 205b 736f     sources = [so
+0003f300: 7572 6365 735d 0a20 2020 2020 2020 2073  urces].        s
+0003f310: 656c 662e 736f 7572 6365 732e 6578 7465  elf.sources.exte
+0003f320: 6e64 2873 6f75 7263 6573 290a 2020 2020  nd(sources).    
+0003f330: 2020 2020 7365 6c66 2e6c 6f61 6428 736f      self.load(so
+0003f340: 7572 6365 7329 0a0a 2020 2020 6465 6620  urces)..    def 
+0003f350: 6164 645f 726f 6928 7365 6c66 2c20 736f  add_roi(self, so
+0003f360: 7572 6365 2c20 2a2a 6b77 6172 6773 293a  urce, **kwargs):
+0003f370: 0a20 2020 2020 2020 2022 2222 4164 6420  .        """Add 
+0003f380: 6120 7369 6e67 6c65 2052 4f49 2077 6974  a single ROI wit
+0003f390: 6820 206f 7074 696f 6e61 6c20 6b77 6172  h  optional kwar
+0003f3a0: 6773 2e22 2222 0a0a 2020 2020 2020 2020  gs."""..        
+0003f3b0: 7365 6c66 2e73 6f75 7263 6573 2e61 7070  self.sources.app
+0003f3c0: 656e 6428 736f 7572 6365 290a 2020 2020  end(source).    
+0003f3d0: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
+0003f3e0: 6528 736f 7572 6365 2c20 524f 4929 3a0a  e(source, ROI):.
+0003f3f0: 2020 2020 2020 2020 2020 2020 726f 6920              roi 
+0003f400: 3d20 736f 7572 6365 0a20 2020 2020 2020  = source.       
+0003f410: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+0003f420: 2020 2072 6f69 5f6b 7761 7267 7320 3d20     roi_kwargs = 
+0003f430: 7365 6c66 2e72 6f69 5f6b 7761 7267 732e  self.roi_kwargs.
+0003f440: 636f 7079 2829 0a20 2020 2020 2020 2020  copy().         
+0003f450: 2020 2072 6f69 5f6b 7761 7267 732e 7570     roi_kwargs.up
+0003f460: 6461 7465 286b 7761 7267 7329 0a20 2020  date(kwargs).   
+0003f470: 2020 2020 2020 2020 2072 6f69 203d 2052           roi = R
+0003f480: 4f49 2873 6f75 7263 652c 202a 2a72 6f69  OI(source, **roi
+0003f490: 5f6b 7761 7267 7329 0a20 2020 2020 2020  _kwargs).       
+0003f4a0: 2072 6f69 2e73 7472 7563 7475 7265 5f73   roi.structure_s
+0003f4b0: 6574 203d 2073 656c 660a 2020 2020 2020  et = self.      
+0003f4c0: 2020 7365 6c66 2e72 6f69 732e 6170 7065    self.rois.appe
+0003f4d0: 6e64 2872 6f69 290a 0a20 2020 2064 6566  nd(roi)..    def
+0003f4e0: 2063 6c6f 6e65 5f61 7474 7273 2873 656c   clone_attrs(sel
+0003f4f0: 662c 206f 626a 2c20 636f 7079 5f72 6f69  f, obj, copy_roi
+0003f500: 733d 5472 7565 2c20 636f 7079 5f72 6f69  s=True, copy_roi
+0003f510: 5f64 6174 613d 5472 7565 293a 0a20 2020  _data=True):.   
+0003f520: 2020 2020 2022 2222 4173 7369 676e 2061       """Assign a
+0003f530: 6c6c 2061 7474 7269 6275 7465 7320 6f66  ll attributes of
+0003f540: 203c 7365 6c66 3e20 746f 2061 6e6f 7468   <self> to anoth
+0003f550: 6572 206f 626a 6563 742c 203c 6f62 6a3e  er object, <obj>
+0003f560: 2c20 656e 7375 7269 6e67 0a20 2020 2020  , ensuring.     
+0003f570: 2020 2074 6861 7420 524f 4973 2061 7265     that ROIs are
+0003f580: 2063 6f70 6965 6420 6966 2063 6f70 795f   copied if copy_
+0003f590: 726f 6973 3d54 7275 652e 2222 220a 0a20  rois=True.""".. 
+0003f5a0: 2020 2020 2020 2073 6b72 742e 636f 7265         skrt.core
+0003f5b0: 2e44 6174 612e 636c 6f6e 655f 6174 7472  .Data.clone_attr
+0003f5c0: 7328 7365 6c66 2c20 6f62 6a29 0a20 2020  s(self, obj).   
+0003f5d0: 2020 2020 2069 6620 636f 7079 5f72 6f69       if copy_roi
+0003f5e0: 733a 0a20 2020 2020 2020 2020 2020 206f  s:.            o
+0003f5f0: 626a 2e72 6f69 7320 3d20 5b5d 0a20 2020  bj.rois = [].   
+0003f600: 2020 2020 2020 2020 2066 6f72 2072 6f69           for roi
+0003f610: 2069 6e20 7365 6c66 2e72 6f69 733a 0a20   in self.rois:. 
+0003f620: 2020 2020 2020 2020 2020 2020 2020 206f                 o
+0003f630: 626a 2e72 6f69 732e 6170 7065 6e64 2872  bj.rois.append(r
+0003f640: 6f69 2e63 6c6f 6e65 2863 6f70 795f 6461  oi.clone(copy_da
+0003f650: 7461 3d63 6f70 795f 726f 695f 6461 7461  ta=copy_roi_data
+0003f660: 2929 0a0a 2020 2020 6465 6620 6669 6c74  ))..    def filt
+0003f670: 6572 6564 5f63 6f70 7928 0a20 2020 2020  ered_copy(.     
+0003f680: 2020 2073 656c 662c 0a20 2020 2020 2020     self,.       
+0003f690: 206e 616d 6573 3d4e 6f6e 652c 0a20 2020   names=None,.   
+0003f6a0: 2020 2020 206e 616d 653d 4e6f 6e65 2c0a       name=None,.
+0003f6b0: 2020 2020 2020 2020 746f 5f6b 6565 703d          to_keep=
+0003f6c0: 4e6f 6e65 2c0a 2020 2020 2020 2020 746f  None,.        to
+0003f6d0: 5f72 656d 6f76 653d 4e6f 6e65 2c0a 2020  _remove=None,.  
+0003f6e0: 2020 2020 2020 6b65 6570 5f72 656e 616d        keep_renam
+0003f6f0: 6564 5f6f 6e6c 793d 4661 6c73 652c 0a20  ed_only=False,. 
+0003f700: 2020 2020 2020 2063 6f70 795f 726f 695f         copy_roi_
+0003f710: 6461 7461 3d54 7275 650a 2020 2020 293a  data=True.    ):
+0003f720: 0a20 2020 2020 2020 2022 2222 4372 6561  .        """Crea
+0003f730: 7465 2061 2063 6f70 7920 6f66 2074 6869  te a copy of thi
+0003f740: 7320 7374 7275 6374 7572 6520 7365 7420  s structure set 
+0003f750: 7769 7468 2052 4f49 7320 6f70 7469 6f6e  with ROIs option
+0003f760: 616c 6c79 0a20 2020 2020 2020 2072 656e  ally.        ren
+0003f770: 616d 6564 206f 7220 6669 6c74 6572 6564  amed or filtered
+0003f780: 2e20 5265 7475 726e 7320 6120 6e65 7720  . Returns a new 
+0003f790: 5374 7275 6374 7572 6553 6574 206f 626a  StructureSet obj
+0003f7a0: 6563 742e 0a0a 2020 2020 2020 2020 2a2a  ect...        **
+0003f7b0: 5061 7261 6d65 7465 7273 3a2a 2a0a 2020  Parameters:**.  
+0003f7c0: 2020 2020 2020 0a20 2020 2020 2020 206e        .        n
+0003f7d0: 616d 6573 203a 2064 6963 742c 2064 6566  ames : dict, def
+0003f7e0: 6175 6c74 3d4e 6f6e 650a 2020 2020 2020  ault=None.      
+0003f7f0: 2020 2020 2020 4469 6374 696f 6e61 7279        Dictionary
+0003f800: 206f 6620 6e61 6d65 7320 666f 7220 7265   of names for re
+0003f810: 6e61 6d69 6e67 2052 4f49 732c 2077 6865  naming ROIs, whe
+0003f820: 7265 2074 6865 206b 6579 7320 6172 6520  re the keys are 
+0003f830: 6e65 7720 0a20 2020 2020 2020 2020 2020  new .           
+0003f840: 206e 616d 6573 2061 6e64 2076 616c 7565   names and value
+0003f850: 7320 6172 6520 6c69 7374 7320 6f66 2070  s are lists of p
+0003f860: 6f73 7369 626c 6520 6e61 6d65 7320 6f66  ossible names of
+0003f870: 2052 4f49 7320 7468 6174 2073 686f 756c   ROIs that shoul
+0003f880: 640a 2020 2020 2020 2020 2020 2020 6265  d.            be
+0003f890: 2061 7373 6967 6e65 6420 7468 6520 6e65   assigned the ne
+0003f8a0: 7720 6e61 6d65 2e20 5468 6573 6520 6e61  w name. These na
+0003f8b0: 6d65 7320 6361 6e20 616c 736f 2063 6f6e  mes can also con
+0003f8c0: 7461 696e 2077 696c 6463 6172 6473 0a20  tain wildcards. 
+0003f8d0: 2020 2020 2020 2020 2020 2077 6974 6820             with 
+0003f8e0: 7468 6520 272a 2720 7379 6d62 6f6c 2e0a  the '*' symbol..
+0003f8f0: 0a20 2020 2020 2020 206e 616d 6520 3a20  .        name : 
+0003f900: 7374 722c 2064 6566 6175 6c74 3d4e 6f6e  str, default=Non
+0003f910: 650a 2020 2020 2020 2020 2020 2020 4e61  e.            Na
+0003f920: 6d65 2066 6f72 2074 6865 2072 6574 7572  me for the retur
+0003f930: 6e65 6420 5374 7275 6374 7572 6553 6574  ned StructureSet
+0003f940: 2e0a 0a20 2020 2020 2020 2074 6f5f 6b65  ...        to_ke
+0003f950: 6570 203a 206c 6973 742c 2064 6566 6175  ep : list, defau
+0003f960: 6c74 3d4e 6f6e 650a 2020 2020 2020 2020  lt=None.        
+0003f970: 2020 2020 4c69 7374 206f 6620 6e61 6d65      List of name
+0003f980: 7320 6f66 2052 4f49 7320 746f 206b 6565  s of ROIs to kee
+0003f990: 7020 696e 2074 6865 2063 6f70 6965 6420  p in the copied 
+0003f9a0: 5374 7275 6374 7572 6553 6574 3b20 616c  StructureSet; al
+0003f9b0: 6c20 0a20 2020 2020 2020 2020 2020 206f  l .            o
+0003f9c0: 7468 6572 7320 7769 6c6c 2062 6520 7265  thers will be re
+0003f9d0: 6d6f 7665 642e 2054 6865 7365 206e 616d  moved. These nam
+0003f9e0: 6573 2063 616e 2061 6c73 6f20 636f 6e74  es can also cont
+0003f9f0: 6169 6e20 7769 6c64 6361 7264 730a 2020  ain wildcards.  
+0003fa00: 2020 2020 2020 2020 2020 7769 7468 2074            with t
+0003fa10: 6865 2027 2a27 2073 796d 626f 6c2e 2041  he '*' symbol. A
+0003fa20: 7070 6c69 6564 2061 6674 6572 2072 656e  pplied after ren
+0003fa30: 616d 696e 6720 7769 7468 203c 6e61 6d65  aming with <name
+0003fa40: 733e 2e0a 0a20 2020 2020 2020 2074 6f5f  s>...        to_
+0003fa50: 7265 6d6f 7665 203a 206c 6973 742c 2064  remove : list, d
+0003fa60: 6566 6175 6c74 3d4e 6f6e 650a 2020 2020  efault=None.    
+0003fa70: 2020 2020 2020 2020 4c69 7374 206f 6620          List of 
+0003fa80: 6e61 6d65 7320 6f66 2052 4f49 7320 746f  names of ROIs to
+0003fa90: 2072 656d 6f76 6520 6672 6f6d 2074 6865   remove from the
+0003faa0: 2063 6f70 6965 6420 5374 7275 6374 7572   copied Structur
+0003fab0: 6553 6574 3b20 616c 6c20 0a20 2020 2020  eSet; all .     
+0003fac0: 2020 2020 2020 206f 7468 6572 7320 7769         others wi
+0003fad0: 6c6c 2062 6520 7265 6d6f 7665 642e 2054  ll be removed. T
+0003fae0: 6865 7365 206e 616d 6573 2063 616e 2061  hese names can a
+0003faf0: 6c73 6f20 636f 6e74 6169 6e20 7769 6c64  lso contain wild
+0003fb00: 6361 7264 730a 2020 2020 2020 2020 2020  cards.          
+0003fb10: 2020 7769 7468 2074 6865 2027 2a27 2073    with the '*' s
+0003fb20: 796d 626f 6c2e 2041 7070 6c69 6564 2061  ymbol. Applied a
+0003fb30: 6674 6572 2072 656e 616d 696e 6720 7769  fter renaming wi
+0003fb40: 7468 203c 6e61 6d65 733e 2061 6e64 200a  th <names> and .
+0003fb50: 2020 2020 2020 2020 2020 2020 6669 6c74              filt
+0003fb60: 6572 696e 6720 7769 7468 203c 746f 5f6b  ering with <to_k
+0003fb70: 6565 703e 2e0a 0a20 2020 2020 2020 206b  eep>...        k
+0003fb80: 6565 705f 7265 6e61 6d65 645f 6f6e 6c79  eep_renamed_only
+0003fb90: 203a 2062 6f6f 6c2c 2064 6566 6175 6c74   : bool, default
+0003fba0: 3d46 616c 7365 0a20 2020 2020 2020 2020  =False.         
+0003fbb0: 2020 2049 6620 5472 7565 2c20 616e 7920     If True, any 
+0003fbc0: 524f 4973 2074 6861 7420 646f 206e 6f74  ROIs that do not
+0003fbd0: 2067 6574 2072 656e 616d 6564 2077 696c   get renamed wil
+0003fbe0: 6c20 6265 2072 656d 6f76 6564 2066 726f  l be removed fro
+0003fbf0: 6d0a 2020 2020 2020 2020 2020 2020 7468  m.            th
+0003fc00: 6520 5374 7275 6374 7572 6553 6574 2e0a  e StructureSet..
+0003fc10: 0a20 2020 2020 2020 2063 6f70 795f 726f  .        copy_ro
+0003fc20: 695f 6461 7461 203a 2062 6f6f 6c2c 2064  i_data : bool, d
+0003fc30: 6566 6175 6c74 3d54 7275 650a 2020 2020  efault=True.    
+0003fc40: 2020 2020 2020 2020 4966 2054 7275 652c          If True,
+0003fc50: 2074 6865 2052 4f49 7320 696e 2074 6865   the ROIs in the
+0003fc60: 2072 6574 7572 6e65 6420 5374 7275 6374   returned Struct
+0003fc70: 7572 6553 6574 2077 696c 6c20 636f 6e74  ureSet will cont
+0003fc80: 6169 6e0a 2020 2020 2020 2020 2020 2020  ain.            
+0003fc90: 636f 7069 6573 206f 6620 7468 6520 6461  copies of the da
+0003fca0: 7461 2066 726f 6d20 7468 6520 6f72 6967  ta from the orig
+0003fcb0: 696e 616c 2053 7472 7563 7475 7265 5365  inal StructureSe
+0003fcc0: 742e 204f 7468 6572 7769 7365 2c0a 2020  t. Otherwise,.  
+0003fcd0: 2020 2020 2020 2020 2020 7468 6520 6e65            the ne
+0003fce0: 7720 524f 4973 2077 696c 6c20 636f 6e74  w ROIs will cont
+0003fcf0: 6169 6e20 7265 6665 7265 6e63 6573 2074  ain references t
+0003fd00: 6f20 7468 6520 7361 6d65 2064 6174 612c  o the same data,
+0003fd10: 2065 2e67 2e20 7468 6520 0a20 2020 2020   e.g. the .     
+0003fd20: 2020 2020 2020 2073 616d 6520 6e75 6d70         same nump
+0003fd30: 7920 6e64 6172 7261 7920 6f62 6a65 6374  y ndarray object
+0003fd40: 2066 6f72 2074 6865 206d 6173 6b2f 7361   for the mask/sa
+0003fd50: 6d65 2064 6963 7420 666f 7220 7468 6520  me dict for the 
+0003fd60: 636f 6e74 6f75 7273 2e0a 2020 2020 2020  contours..      
+0003fd70: 2020 2020 2020 4f6e 6c79 2075 7365 6420        Only used 
+0003fd80: 6966 203c 636f 7079 5f72 6f69 733e 2069  if <copy_rois> i
+0003fd90: 7320 5472 7565 0a20 2020 2020 2020 2022  s True.        "
+0003fda0: 2222 0a0a 2020 2020 2020 2020 7365 6c66  ""..        self
+0003fdb0: 2e6c 6f61 6428 290a 2020 2020 2020 2020  .load().        
+0003fdc0: 7373 203d 2073 656c 662e 636c 6f6e 6528  ss = self.clone(
+0003fdd0: 636f 7079 5f72 6f69 5f64 6174 613d 636f  copy_roi_data=co
+0003fde0: 7079 5f72 6f69 5f64 6174 6129 0a20 2020  py_roi_data).   
+0003fdf0: 2020 2020 2069 6620 6e61 6d65 2069 7320       if name is 
+0003fe00: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
+0003fe10: 2020 2020 2020 7373 2e6e 616d 6520 3d20        ss.name = 
+0003fe20: 6e61 6d65 0a20 2020 2020 2020 2073 732e  name.        ss.
+0003fe30: 7265 6e61 6d65 5f72 6f69 7328 6e61 6d65  rename_rois(name
+0003fe40: 732c 206b 6565 705f 7265 6e61 6d65 645f  s, keep_renamed_
+0003fe50: 6f6e 6c79 3d6b 6565 705f 7265 6e61 6d65  only=keep_rename
+0003fe60: 645f 6f6e 6c79 290a 2020 2020 2020 2020  d_only).        
+0003fe70: 7373 2e66 696c 7465 725f 726f 6973 2874  ss.filter_rois(t
+0003fe80: 6f5f 6b65 6570 2c20 746f 5f72 656d 6f76  o_keep, to_remov
+0003fe90: 6529 0a20 2020 2020 2020 2072 6574 7572  e).        retur
+0003fea0: 6e20 7373 0a0a 2020 2020 6465 6620 6765  n ss..    def ge
+0003feb0: 745f 726f 6973 2873 656c 662c 206e 616d  t_rois(self, nam
+0003fec0: 6573 3d4e 6f6e 652c 2069 676e 6f72 655f  es=None, ignore_
+0003fed0: 656d 7074 793d 4661 6c73 6529 3a0a 2020  empty=False):.  
+0003fee0: 2020 2020 2020 2222 2247 6574 206c 6973        """Get lis
+0003fef0: 7420 6f66 2052 4f49 206f 626a 6563 7473  t of ROI objects
+0003ff00: 2049 6620 3c6e 616d 6573 3e20 6973 2067   If <names> is g
+0003ff10: 6976 656e 2c20 6f6e 6c79 2074 6865 2052  iven, only the R
+0003ff20: 4f49 7320 7769 7468 0a20 2020 2020 2020  OIs with.       
+0003ff30: 2074 686f 7365 206e 616d 6573 2077 696c   those names wil
+0003ff40: 6c20 6265 2072 6574 7572 6e65 642e 2222  l be returned.""
+0003ff50: 220a 0a20 2020 2020 2020 2073 656c 662e  "..        self.
+0003ff60: 6c6f 6164 2829 0a20 2020 2020 2020 2069  load().        i
+0003ff70: 6620 6e61 6d65 7320 6973 204e 6f6e 653a  f names is None:
+0003ff80: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+0003ff90: 6967 6e6f 7265 5f65 6d70 7479 3a0a 2020  ignore_empty:.  
+0003ffa0: 2020 2020 2020 2020 2020 2020 2020 7265                re
+0003ffb0: 7475 726e 205b 726f 6920 666f 7220 726f  turn [roi for ro
+0003ffc0: 6920 696e 2073 656c 662e 726f 6973 2069  i in self.rois i
+0003ffd0: 6620 6e6f 7420 726f 692e 656d 7074 795d  f not roi.empty]
+0003ffe0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+0003fff0: 7572 6e20 7365 6c66 2e72 6f69 730a 0a20  urn self.rois.. 
+00040000: 2020 2020 2020 2072 6f69 7320 3d20 5b5d         rois = []
+00040010: 0a20 2020 2020 2020 2066 6f72 206e 616d  .        for nam
+00040020: 6520 696e 206e 616d 6573 3a0a 2020 2020  e in names:.    
+00040030: 2020 2020 2020 2020 726f 6920 3d20 7365          roi = se
+00040040: 6c66 2e67 6574 5f72 6f69 286e 616d 6529  lf.get_roi(name)
+00040050: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00040060: 726f 6920 6973 206e 6f74 204e 6f6e 653a  roi is not None:
+00040070: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00040080: 2069 6620 6e6f 7420 6967 6e6f 7265 5f65   if not ignore_e
+00040090: 6d70 7479 206f 7220 6e6f 7420 726f 692e  mpty or not roi.
+000400a0: 656d 7074 793a 0a20 2020 2020 2020 2020  empty:.         
+000400b0: 2020 2020 2020 2020 2020 2072 6f69 732e             rois.
+000400c0: 6170 7065 6e64 2872 6f69 290a 2020 2020  append(roi).    
+000400d0: 2020 2020 7265 7475 726e 2072 6f69 730a      return rois.
+000400e0: 0a20 2020 2064 6566 2067 6574 5f72 6f69  .    def get_roi
+000400f0: 735f 7769 6c64 6361 7264 2873 656c 662c  s_wildcard(self,
+00040100: 2077 696c 6463 6172 6429 3a0a 2020 2020   wildcard):.    
+00040110: 2020 2020 2222 2252 6574 7572 6e20 6c69      """Return li
+00040120: 7374 206f 6620 524f 4973 206d 6174 6368  st of ROIs match
+00040130: 696e 6720 6120 7769 6c64 6361 7264 2065  ing a wildcard e
+00040140: 7870 7265 7373 696f 6e2e 2222 220a 0a20  xpression.""".. 
+00040150: 2020 2020 2020 2072 6f69 7320 3d20 5b5d         rois = []
+00040160: 0a20 2020 2020 2020 2066 6f72 2072 6f69  .        for roi
+00040170: 2069 6e20 7365 6c66 2e67 6574 5f72 6f69   in self.get_roi
+00040180: 7328 293a 0a20 2020 2020 2020 2020 2020  s():.           
+00040190: 2069 6620 666e 6d61 7463 682e 666e 6d61   if fnmatch.fnma
+000401a0: 7463 6828 726f 692e 6e61 6d65 2e6c 6f77  tch(roi.name.low
+000401b0: 6572 2829 2c20 7769 6c64 6361 7264 2e6c  er(), wildcard.l
+000401c0: 6f77 6572 2829 293a 0a20 2020 2020 2020  ower()):.       
+000401d0: 2020 2020 2020 2020 2072 6f69 732e 6170           rois.ap
+000401e0: 7065 6e64 2872 6f69 290a 2020 2020 2020  pend(roi).      
+000401f0: 2020 7265 7475 726e 2072 6f69 730a 0a20    return rois.. 
+00040200: 2020 2064 6566 2067 6574 5f72 6f69 5f6e     def get_roi_n
+00040210: 616d 6573 2873 656c 662c 206f 7269 6769  ames(self, origi
+00040220: 6e61 6c3d 4661 6c73 652c 2069 676e 6f72  nal=False, ignor
+00040230: 655f 656d 7074 793d 4661 6c73 6529 3a0a  e_empty=False):.
+00040240: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00040250: 2020 2020 4765 7420 6c69 7374 206f 6620      Get list of 
+00040260: 6e61 6d65 7320 6f66 2052 4f49 7320 696e  names of ROIs in
+00040270: 2074 6869 7320 7374 7275 6374 7572 6520   this structure 
+00040280: 7365 742e 2049 6620 3c6f 7269 6769 6e61  set. If <origina
+00040290: 6c3e 2069 7320 5472 7565 2c0a 2020 2020  l> is True,.    
+000402a0: 2020 2020 6765 7420 7468 6520 6f72 6967      get the orig
+000402b0: 696e 616c 206e 616d 6573 206f 6620 7468  inal names of th
+000402c0: 6520 524f 4973 2e20 2049 6620 3c69 676e  e ROIs.  If <ign
+000402d0: 6f72 655f 656d 7074 793e 2069 7320 5472  ore_empty> is Tr
+000402e0: 7565 2c0a 2020 2020 2020 2020 6f6d 6974  ue,.        omit
+000402f0: 206e 616d 6573 206f 6620 656d 7074 7920   names of empty 
+00040300: 524f 4973 2e0a 2020 2020 2020 2020 2222  ROIs..        ""
+00040310: 220a 0a20 2020 2020 2020 2072 6574 7572  "..        retur
+00040320: 6e20 5b73 2e67 6574 5f6e 616d 6528 6f72  n [s.get_name(or
+00040330: 6967 696e 616c 2920 666f 7220 7320 696e  iginal) for s in
+00040340: 2073 656c 662e 6765 745f 726f 6973 2829   self.get_rois()
+00040350: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00040360: 2069 6620 6e6f 7420 2869 676e 6f72 655f   if not (ignore_
+00040370: 656d 7074 7920 616e 6420 732e 656d 7074  empty and s.empt
+00040380: 7929 5d0a 0a0a 2020 2020 6465 6620 6765  y)]...    def ge
+00040390: 745f 726f 695f 6469 6374 2873 656c 6629  t_roi_dict(self)
+000403a0: 3a0a 2020 2020 2020 2020 2222 2247 6574  :.        """Get
+000403b0: 2064 6963 7420 6f66 2052 4f49 206e 616d   dict of ROI nam
+000403c0: 6573 2061 6e64 206f 626a 6563 7473 2e22  es and objects."
+000403d0: 2222 0a0a 2020 2020 2020 2020 7265 7475  ""..        retu
+000403e0: 726e 207b 732e 6e61 6d65 3a20 7320 666f  rn {s.name: s fo
+000403f0: 7220 7320 696e 2073 656c 662e 6765 745f  r s in self.get_
+00040400: 726f 6973 2829 7d0a 0a20 2020 2064 6566  rois()}..    def
+00040410: 2067 6574 5f72 6f69 2873 656c 662c 206e   get_roi(self, n
+00040420: 616d 6529 3a0a 2020 2020 2020 2020 2222  ame):.        ""
+00040430: 2247 6574 2061 6e20 524f 4920 7769 7468  "Get an ROI with
+00040440: 2061 2073 7065 6369 6669 6320 6e61 6d65   a specific name
+00040450: 2e22 2222 0a0a 2020 2020 2020 2020 726f  ."""..        ro
+00040460: 6973 203d 2073 656c 662e 6765 745f 726f  is = self.get_ro
+00040470: 695f 6469 6374 2829 0a20 2020 2020 2020  i_dict().       
+00040480: 2069 6620 6e61 6d65 206e 6f74 2069 6e20   if name not in 
+00040490: 726f 6973 3a0a 2020 2020 2020 2020 2020  rois:.          
+000404a0: 2020 7072 696e 7428 6622 524f 4920 7b6e    print(f"ROI {n
+000404b0: 616d 657d 206e 6f74 2066 6f75 6e64 2122  ame} not found!"
+000404c0: 290a 2020 2020 2020 2020 2020 2020 7265  ).            re
+000404d0: 7475 726e 0a20 2020 2020 2020 2072 6574  turn.        ret
+000404e0: 7572 6e20 726f 6973 5b6e 616d 655d 0a0a  urn rois[name]..
+000404f0: 2020 2020 6465 6620 7072 696e 745f 726f      def print_ro
+00040500: 6973 2873 656c 6629 3a0a 0a20 2020 2020  is(self):..     
+00040510: 2020 2073 656c 662e 6c6f 6164 2829 0a20     self.load(). 
+00040520: 2020 2020 2020 2070 7269 6e74 2822 5c6e         print("\n
+00040530: 222e 6a6f 696e 2873 656c 662e 6765 745f  ".join(self.get_
+00040540: 726f 695f 6e61 6d65 7328 2929 290a 0a20  roi_names())).. 
+00040550: 2020 2064 6566 2067 6574 5f6e 616d 6528     def get_name(
+00040560: 7365 6c66 293a 0a20 2020 2020 2020 2027  self):.        '
+00040570: 2727 0a20 2020 2020 2020 204c 6f61 6420  ''.        Load 
+00040580: 7365 6c66 2061 6e64 2067 6574 206e 616d  self and get nam
+00040590: 652e 0a20 2020 2020 2020 2027 2727 0a0a  e..        '''..
+000405a0: 2020 2020 2020 2020 7365 6c66 2e6c 6f61          self.loa
+000405b0: 6428 290a 2020 2020 2020 2020 7265 7475  d().        retu
+000405c0: 726e 2028 7365 6c66 2e6e 616d 6529 0a0a  rn (self.name)..
+000405d0: 2020 2020 6465 6620 6765 745f 7472 616e      def get_tran
+000405e0: 736c 6174 696f 6e5f 746f 5f61 6c69 676e  slation_to_align
+000405f0: 280a 2020 2020 2020 2020 2020 2020 7365  (.            se
+00040600: 6c66 2c20 6f74 6865 722c 207a 5f66 7261  lf, other, z_fra
+00040610: 6374 696f 6e31 3d4e 6f6e 652c 207a 5f66  ction1=None, z_f
+00040620: 7261 6374 696f 6e32 3d4e 6f6e 6529 3a0a  raction2=None):.
+00040630: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00040640: 2020 2020 4465 7465 726d 696e 6520 7472      Determine tr
+00040650: 616e 736c 6174 696f 6e20 666f 7220 616c  anslation for al
+00040660: 6967 6e69 6e67 203c 7365 6c66 3e20 746f  igning <self> to
+00040670: 203c 6f74 6865 723e 2e0a 0a20 2020 2020   <other>...     
+00040680: 2020 202a 2a50 6172 616d 6574 6572 733a     **Parameters:
+00040690: 2a2a 0a0a 2020 2020 2020 2020 6f74 6865  **..        othe
+000406a0: 7220 3a20 524f 492f 5374 7275 6374 7572  r : ROI/Structur
+000406b0: 6553 6574 2f6c 6973 740a 2020 2020 2020  eSet/list.      
+000406c0: 2020 2020 2020 524f 4920 7769 7468 2077        ROI with w
+000406d0: 6869 6368 2061 6c69 676e 6d65 6e74 2069  hich alignment i
+000406e0: 7320 746f 2062 6520 7065 7266 6f72 6d65  s to be performe
+000406f0: 642e 2020 5468 6973 2063 616e 2062 650a  d.  This can be.
+00040700: 2020 2020 2020 2020 2020 2020 7370 6563              spec
+00040710: 6966 6965 6420 6469 7265 6374 6c79 2061  ified directly a
+00040720: 7320 6120 7369 6e67 6c65 2052 4f49 2e20  s a single ROI. 
+00040730: 2041 6c74 6572 6e61 7469 7665 6c79 2c20   Alternatively, 
+00040740: 6974 2063 616e 0a20 2020 2020 2020 2020  it can.         
+00040750: 2020 2062 6520 6120 5374 7275 6374 7572     be a Structur
+00040760: 6553 6574 2c20 6f72 2061 206c 6973 7420  eSet, or a list 
+00040770: 6f72 2052 4f49 2f53 7472 7563 7475 7265  or ROI/Structure
+00040780: 5365 7420 6f62 6a65 6374 732c 0a20 2020  Set objects,.   
+00040790: 2020 2020 2020 2020 2069 6e20 7768 6963           in whic
+000407a0: 6820 6361 7365 2074 6865 2069 6e64 6976  h case the indiv
+000407b0: 6964 7561 6c20 524f 4973 2077 696c 6c20  idual ROIs will 
+000407c0: 6265 2063 6f6d 6269 6e65 642e 0a0a 2020  be combined...  
+000407d0: 2020 2020 2020 7a5f 6672 6163 7469 6f6e        z_fraction
+000407e0: 3120 3a20 666c 6f61 742c 2064 6566 6175  1 : float, defau
+000407f0: 6c74 3d4e 6f6e 650a 2020 2020 2020 2020  lt=None.        
+00040800: 2020 2020 506f 7369 7469 6f6e 2061 6c6f      Position alo
+00040810: 6e67 207a 2061 7869 7320 6f66 2073 6c69  ng z axis of sli
+00040820: 6365 2074 6872 6f75 6768 203c 7365 6c66  ce through <self
+00040830: 3e20 6f6e 2077 6869 6368 0a20 2020 2020  > on which.     
+00040840: 2020 2020 2020 2074 6f20 616c 6967 6e2e         to align.
+00040850: 2020 4966 204e 6f6e 652c 2061 6c69 676e    If None, align
+00040860: 6d65 6e74 2069 7320 746f 2074 6865 2063  ment is to the c
+00040870: 656e 7472 6f69 6420 6f66 2074 6865 0a20  entroid of the. 
+00040880: 2020 2020 2020 2020 2020 2077 686f 6c65             whole
+00040890: 2052 4f49 2076 6f6c 756d 652e 2020 4f74   ROI volume.  Ot
+000408a0: 6865 7277 6973 652c 2061 6c69 676e 6d65  herwise, alignme
+000408b0: 6e74 2069 7320 746f 2074 6865 0a20 2020  nt is to the.   
+000408c0: 2020 2020 2020 2020 2063 656e 7472 6f69           centroi
+000408d0: 6420 6f66 2074 6865 2073 6c69 6365 2061  d of the slice a
+000408e0: 7420 7468 6520 7370 6563 6966 6965 6420  t the specified 
+000408f0: 6469 7374 616e 6365 0a20 2020 2020 2020  distance.       
+00040900: 2020 2020 2066 726f 6d20 7468 6520 524f       from the RO
+00040910: 4927 7320 6d6f 7374 2d69 6e66 6572 696f  I's most-inferio
+00040920: 7220 706f 696e 743a 2030 2063 6f72 7265  r point: 0 corre
+00040930: 7370 6f6e 6473 2074 6f0a 2020 2020 2020  sponds to.      
+00040940: 2020 2020 2020 7468 6520 6d6f 7374 2d69        the most-i
+00040950: 6e66 6572 696f 7220 706f 696e 7420 286c  nferior point (l
+00040960: 6f77 6573 7420 7a29 3b20 3120 636f 7272  owest z); 1 corr
+00040970: 6573 706f 6e64 7320 746f 2074 6865 0a20  esponds to the. 
+00040980: 2020 2020 2020 2020 2020 206d 6f73 742d             most-
+00040990: 7375 7065 7269 6f72 2070 6f69 6e74 2028  superior point (
+000409a0: 6869 6768 6573 7420 7a29 2e20 2056 616c  highest z).  Val
+000409b0: 7565 7320 666f 7220 7a5f 6672 6163 7469  ues for z_fracti
+000409c0: 6f6e 0a20 2020 2020 2020 2020 2020 206f  on.            o
+000409d0: 7574 7369 6465 2074 6865 2069 6e74 6572  utside the inter
+000409e0: 7661 6c20 5b30 2c20 315d 2072 6573 756c  val [0, 1] resul
+000409f0: 7420 696e 2061 2052 756e 7469 6d65 4572  t in a RuntimeEr
+00040a00: 726f 722e 0a0a 2020 2020 2020 2020 7a5f  ror...        z_
+00040a10: 6672 6163 7469 6f6e 3220 3a20 666c 6f61  fraction2 : floa
+00040a20: 742c 2064 6566 6175 6c74 3d4e 6f6e 650a  t, default=None.
+00040a30: 2020 2020 2020 2020 2020 2020 506f 7369              Posi
+00040a40: 7469 6f6e 2061 6c6f 6e67 207a 2061 7869  tion along z axi
+00040a50: 7320 6f66 2073 6c69 6365 2074 6872 6f75  s of slice throu
+00040a60: 6768 203c 6f74 6865 723e 206f 6e20 7768  gh <other> on wh
+00040a70: 6963 680a 2020 2020 2020 2020 2020 2020  ich.            
+00040a80: 746f 2061 6c69 676e 2e20 2049 6620 4e6f  to align.  If No
+00040a90: 6e65 2c20 616c 6967 6e6d 656e 7420 6973  ne, alignment is
+00040aa0: 2074 6f20 7468 6520 6365 6e74 726f 6964   to the centroid
+00040ab0: 206f 6620 7468 650a 2020 2020 2020 2020   of the.        
+00040ac0: 2020 2020 7768 6f6c 6520 524f 4920 766f      whole ROI vo
+00040ad0: 6c75 6d65 2e20 204f 7468 6572 7769 7365  lume.  Otherwise
+00040ae0: 2c20 616c 6967 6e6d 656e 7420 6973 2074  , alignment is t
+00040af0: 6f20 7468 650a 2020 2020 2020 2020 2020  o the.          
+00040b00: 2020 6365 6e74 726f 6964 206f 6620 7468    centroid of th
+00040b10: 6520 736c 6963 6520 6174 2074 6865 2073  e slice at the s
+00040b20: 7065 6369 6669 6564 2064 6973 7461 6e63  pecified distanc
+00040b30: 650a 2020 2020 2020 2020 2020 2020 6672  e.            fr
+00040b40: 6f6d 2074 6865 2052 4f49 2773 206d 6f73  om the ROI's mos
+00040b50: 742d 696e 6665 7269 6f72 2070 6f69 6e74  t-inferior point
+00040b60: 3a20 3020 636f 7272 6573 706f 6e64 7320  : 0 corresponds 
+00040b70: 746f 0a20 2020 2020 2020 2020 2020 2074  to.            t
+00040b80: 6865 206d 6f73 742d 696e 6665 7269 6f72  he most-inferior
+00040b90: 2070 6f69 6e74 2028 6c6f 7765 7374 207a   point (lowest z
+00040ba0: 293b 2031 2063 6f72 7265 7370 6f6e 6473  ); 1 corresponds
+00040bb0: 2074 6f20 7468 650a 2020 2020 2020 2020   to the.        
+00040bc0: 2020 2020 6d6f 7374 2d73 7570 6572 696f      most-superio
+00040bd0: 7220 706f 696e 7420 2868 6967 6865 7374  r point (highest
+00040be0: 207a 292e 2020 5661 6c75 6573 2066 6f72   z).  Values for
+00040bf0: 207a 5f66 7261 6374 696f 6e0a 2020 2020   z_fraction.    
+00040c00: 2020 2020 2020 2020 6f75 7473 6964 6520          outside 
+00040c10: 7468 6520 696e 7465 7276 616c 205b 302c  the interval [0,
+00040c20: 2031 5d20 7265 7375 6c74 2069 6e20 6120   1] result in a 
+00040c30: 5275 6e74 696d 6545 7272 6f72 2e0a 2020  RuntimeError..  
+00040c40: 2020 2020 2020 2020 2020 2222 220a 2020            """.  
+00040c50: 2020 2020 2020 7265 7475 726e 2067 6574        return get
+00040c60: 5f74 7261 6e73 6c61 7469 6f6e 5f74 6f5f  _translation_to_
+00040c70: 616c 6967 6e28 0a20 2020 2020 2020 2020  align(.         
+00040c80: 2020 2020 2020 2073 656c 662c 206f 7468         self, oth
+00040c90: 6572 2c20 7a5f 6672 6163 7469 6f6e 312c  er, z_fraction1,
+00040ca0: 207a 5f66 7261 6374 696f 6e32 290a 0a20   z_fraction2).. 
+00040cb0: 2020 2064 6566 2067 6574 5f63 6f6e 666f     def get_confo
+00040cc0: 726d 6974 795f 696e 6465 7828 7365 6c66  rmity_index(self
+00040cd0: 2c20 6e61 6d65 733d 4e6f 6e65 2c20 2a2a  , names=None, **
+00040ce0: 6b77 6172 6773 293a 0a20 2020 2020 2020  kwargs):.       
+00040cf0: 2022 2222 0a20 2020 2020 2020 2047 6574   """.        Get
+00040d00: 2063 6f6e 666f 726d 6974 7920 696e 6465   conformity inde
+00040d10: 7820 666f 7220 524f 4973 206f 6620 7468  x for ROIs of th
+00040d20: 6520 5374 7275 6374 7572 6553 6574 2e0a  e StructureSet..
+00040d30: 0a20 2020 2020 2020 202a 2a50 6172 616d  .        **Param
+00040d40: 6574 6572 733a 2a2a 0a0a 2020 2020 2020  eters:**..      
+00040d50: 2020 6e61 6d65 7320 3a20 6c69 7374 2c20    names : list, 
+00040d60: 6465 6661 756c 743d 4e6f 6e65 0a20 2020  default=None.   
+00040d70: 2020 2020 2020 2020 204c 6973 7420 6f66           List of
+00040d80: 2073 7472 696e 6773 2063 6f72 7265 7370   strings corresp
+00040d90: 6f6e 6469 6e67 2074 6f20 524f 4920 6e61  onding to ROI na
+00040da0: 6d65 732e 2020 4966 206e 6f6e 2d6e 756c  mes.  If non-nul
+00040db0: 6c2c 0a20 2020 2020 2020 2020 2020 2054  l,.            T
+00040dc0: 6865 2063 6f6e 666f 726d 6974 7920 696e  he conformity in
+00040dd0: 6465 7820 6973 2063 616c 6375 6c61 7465  dex is calculate
+00040de0: 6420 7265 6c61 7469 7665 2066 6f72 2074  d relative for t
+00040df0: 6865 2052 4f49 730a 2020 2020 2020 2020  he ROIs.        
+00040e00: 2020 2020 7769 7468 2074 6865 206c 6973      with the lis
+00040e10: 7465 6420 6e61 6d65 7320 6f6e 6c79 2e20  ted names only. 
+00040e20: 204f 7468 6572 7769 7365 2c20 7468 6520   Otherwise, the 
+00040e30: 636f 6e66 6f72 6d69 7479 0a20 2020 2020  conformity.     
+00040e40: 2020 2020 2020 2069 6e64 6578 2069 7320         index is 
+00040e50: 6361 6c63 756c 6174 6564 2072 656c 6174  calculated relat
+00040e60: 6976 6520 746f 2061 6c6c 2052 4f49 7320  ive to all ROIs 
+00040e70: 696e 2074 6865 2073 7472 7563 7475 7265  in the structure
+00040e80: 0a20 2020 2020 2020 2020 2020 2073 6574  .            set
+00040e90: 2e0a 0a20 2020 2020 2020 206b 7761 7267  ...        kwarg
+00040ea0: 730a 2020 2020 2020 2020 2020 2020 4b65  s.            Ke
+00040eb0: 7977 6f72 6420 6172 6775 6d65 6e74 7320  yword arguments 
+00040ec0: 6172 6520 7061 7373 6564 2074 6f0a 2020  are passed to.  
+00040ed0: 2020 2020 2020 2020 2020 736b 7274 2e73            skrt.s
+00040ee0: 7472 7563 7475 7265 732e 6765 745f 636f  tructures.get_co
+00040ef0: 6e66 6f72 6d69 7479 5f69 6e64 6578 2829  nformity_index()
+00040f00: 2e2e 6765 745f 7375 7266 6163 655f 6469  ..get_surface_di
+00040f10: 7374 616e 6365 7328 292e 0a20 2020 2020  stances()..     
+00040f20: 2020 2020 2020 2053 6565 2064 6f63 756d         See docum
+00040f30: 656e 7461 7469 6f6e 206f 6620 7468 6973  entation of this
+00040f40: 2066 756e 6374 696f 6e20 666f 7220 7061   function for pa
+00040f50: 7261 6d65 7465 7220 6465 7461 696c 732e  rameter details.
+00040f60: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+00040f70: 2020 2020 2072 6574 7572 6e20 6765 745f       return get_
+00040f80: 636f 6e66 6f72 6d69 7479 5f69 6e64 6578  conformity_index
+00040f90: 2873 656c 662e 6765 745f 726f 6973 286e  (self.get_rois(n
+00040fa0: 616d 6573 292c 202a 2a6b 7761 7267 7329  ames), **kwargs)
+00040fb0: 0a0a 2020 2020 6465 6620 6765 745f 6765  ..    def get_ge
+00040fc0: 6f6d 6574 7279 280a 2020 2020 2020 2020  ometry(.        
+00040fd0: 7365 6c66 2c20 0a20 2020 2020 2020 206e  self, .        n
+00040fe0: 616d 655f 6173 5f69 6e64 6578 3d54 7275  ame_as_index=Tru
+00040ff0: 652c 200a 2020 2020 2020 2020 6874 6d6c  e, .        html
+00041000: 3d46 616c 7365 2c20 0a20 2020 2020 2020  =False, .       
+00041010: 2063 6f6c 6f72 6564 3d46 616c 7365 2c0a   colored=False,.
+00041020: 2020 2020 2020 2020 6772 6579 6564 5f6f          greyed_o
+00041030: 7574 3d4e 6f6e 652c 0a20 2020 2020 2020  ut=None,.       
+00041040: 2072 6f69 5f6b 7761 7267 733d 7b7d 2c0a   roi_kwargs={},.
+00041050: 2020 2020 2020 2020 2a2a 6b77 6172 6773          **kwargs
+00041060: 293a 0a20 2020 2020 2020 2022 2222 4765  ):.        """Ge
+00041070: 7420 7061 6e64 6173 2044 6174 6146 7261  t pandas DataFra
+00041080: 6d65 206f 6620 6765 6f6d 6574 7269 6320  me of geometric 
+00041090: 7072 6f70 6572 7469 6573 2066 6f72 2061  properties for a
+000410a0: 6c6c 2052 4f49 732e 0a20 2020 2020 2020  ll ROIs..       
+000410b0: 2049 6620 6e6f 2073 6c2f 6964 782f 706f   If no sl/idx/po
+000410c0: 7320 6973 2067 6976 656e 2c20 7468 6520  s is given, the 
+000410d0: 6365 6e74 7261 6c20 736c 6963 6520 6f66  central slice of
+000410e0: 2065 6163 6820 524f 4920 7769 6c6c 2062   each ROI will b
+000410f0: 6520 7573 6564 2e0a 0a20 2020 2020 2020  e used...       
+00041100: 202a 2a50 6172 616d 6574 6572 732a 2a3a   **Parameters**:
+00041110: 0a0a 2020 2020 2020 2020 6e61 6d65 5f61  ..        name_a
+00041120: 735f 696e 6465 7820 3a20 626f 6f6c 2c20  s_index : bool, 
+00041130: 6465 6661 756c 743d 5472 7565 0a20 2020  default=True.   
+00041140: 2020 2020 2020 2020 2049 6620 5472 7565           If True
+00041150: 2c20 7468 6520 524f 4920 6e61 6d65 7320  , the ROI names 
+00041160: 7769 6c6c 2062 6520 7573 6564 2061 7320  will be used as 
+00041170: 726f 7720 696e 6469 6365 733b 206f 7468  row indices; oth
+00041180: 6572 7769 7365 2c20 7468 6579 0a20 2020  erwise, they.   
+00041190: 2020 2020 2020 2020 2077 696c 6c20 6265           will be
+000411a0: 2067 6976 656e 2074 6865 6972 206f 776e   given their own
+000411b0: 2063 6f6c 756d 6e2e 0a0a 2020 2020 2020   column...      
+000411c0: 2020 6874 6d6c 203a 2062 6f6f 6c2c 2064    html : bool, d
+000411d0: 6566 6175 6c74 3d46 616c 7365 0a20 2020  efault=False.   
+000411e0: 2020 2020 2020 2020 2049 6620 5472 7565           If True
+000411f0: 2c20 7468 6520 7461 626c 6520 7769 6c6c  , the table will
+00041200: 2062 6520 636f 6e76 6572 7465 6420 746f   be converted to
+00041210: 2048 544d 4c20 7465 7874 2063 6f6c 6f72   HTML text color
+00041220: 2d63 6f64 6564 2062 6173 6564 0a20 2020  -coded based.   
+00041230: 2020 2020 2020 2020 206f 6e20 524f 4920           on ROI 
+00041240: 636f 6c6f 7273 2e0a 2020 2020 2020 2020  colors..        
+00041250: 2222 220a 0a20 2020 2020 2020 2069 6620  """..        if 
+00041260: 6874 6d6c 3a0a 2020 2020 2020 2020 2020  html:.          
+00041270: 2020 6e61 6d65 5f61 735f 696e 6465 7820    name_as_index 
+00041280: 3d20 4661 6c73 650a 2020 2020 2020 2020  = False.        
+00041290: 6966 2067 7265 7965 645f 6f75 7420 6973  if greyed_out is
+000412a0: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+000412b0: 2020 2067 7265 7965 645f 6f75 7420 3d20     greyed_out = 
+000412c0: 5b5d 0a0a 2020 2020 2020 2020 726f 7773  []..        rows
+000412d0: 203d 205b 5d0a 2020 2020 2020 2020 666f   = [].        fo
+000412e0: 7220 726f 6920 696e 2073 656c 662e 6765  r roi in self.ge
+000412f0: 745f 726f 6973 2869 676e 6f72 655f 656d  t_rois(ignore_em
+00041300: 7074 793d 5472 7565 293a 0a0a 2020 2020  pty=True):..    
+00041310: 2020 2020 2020 2020 2320 4765 7420 4461          # Get Da
+00041320: 7461 4672 616d 6520 666f 7220 7468 6973  taFrame for this
+00041330: 2052 4f49 0a20 2020 2020 2020 2020 2020   ROI.           
+00041340: 2064 665f 726f 7720 3d20 726f 692e 6765   df_row = roi.ge
+00041350: 745f 6765 6f6d 6574 7279 286e 616d 655f  t_geometry(name_
+00041360: 6173 5f69 6e64 6578 3d6e 616d 655f 6173  as_index=name_as
+00041370: 5f69 6e64 6578 2c20 2a2a 6b77 6172 6773  _index, **kwargs
+00041380: 290a 0a20 2020 2020 2020 2020 2020 2023  )..            #
+00041390: 2052 6570 6c61 6365 2061 6c6c 2076 616c   Replace all val
+000413a0: 7565 7320 7769 7468 2022 2d2d 2220 6966  ues with "--" if
+000413b0: 2067 7265 7969 6e67 206f 7574 2074 6869   greying out thi
+000413c0: 7320 524f 490a 2020 2020 2020 2020 2020  s ROI.          
+000413d0: 2020 6966 2072 6f69 2069 6e20 6772 6579    if roi in grey
+000413e0: 6564 5f6f 7574 3a0a 2020 2020 2020 2020  ed_out:.        
+000413f0: 2020 2020 2020 2020 666f 7220 636f 6c20          for col 
+00041400: 696e 2064 665f 726f 772e 636f 6c75 6d6e  in df_row.column
+00041410: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
+00041420: 2020 2020 2020 2069 6620 636f 6c20 3d3d         if col ==
+00041430: 2022 524f 4922 3a20 0a20 2020 2020 2020   "ROI": .       
+00041440: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00041450: 2063 6f6e 7469 6e75 650a 2020 2020 2020   continue.      
+00041460: 2020 2020 2020 2020 2020 2020 2020 6466                df
+00041470: 5f72 6f77 5b63 6f6c 5d20 3d20 222d 2d22  _row[col] = "--"
+00041480: 0a0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
+00041490: 5365 7420 524f 4920 6e61 6d65 2074 6f20  Set ROI name to 
+000414a0: 6861 7665 2063 6f6c 6f72 6564 2062 6163  have colored bac
+000414b0: 6b67 726f 756e 6420 6966 2072 6571 7565  kground if reque
+000414c0: 7374 6564 0a20 2020 2020 2020 2020 2020  sted.           
+000414d0: 2069 6620 636f 6c6f 7265 643a 0a20 2020   if colored:.   
+000414e0: 2020 2020 2020 2020 2020 2020 2063 6f6c               col
+000414f0: 6f72 203d 2072 6f69 2e67 6574 5f63 6f6c  or = roi.get_col
+00041500: 6f72 5f66 726f 6d5f 6b77 6172 6773 2872  or_from_kwargs(r
+00041510: 6f69 5f6b 7761 7267 7329 0a20 2020 2020  oi_kwargs).     
+00041520: 2020 2020 2020 2020 2020 2063 6f6c 5f73             col_s
+00041530: 7472 203d 2067 6574 5f63 6f6c 6f72 6564  tr = get_colored
+00041540: 5f72 6f69 5f73 7472 696e 6728 0a20 2020  _roi_string(.   
+00041550: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00041560: 2020 2020 2072 6f69 2c20 6772 6579 3d28       roi, grey=(
+00041570: 726f 6920 696e 2067 7265 7965 645f 6f75  roi in greyed_ou
+00041580: 7429 2c20 636f 6c6f 723d 636f 6c6f 7229  t), color=color)
+00041590: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000415a0: 2069 6620 6e61 6d65 5f61 735f 696e 6465   if name_as_inde
+000415b0: 783a 0a20 2020 2020 2020 2020 2020 2020  x:.             
+000415c0: 2020 2020 2020 2064 665f 726f 772e 7265         df_row.re
+000415d0: 6e61 6d65 287b 6466 5f72 6f77 2e69 6e64  name({df_row.ind
+000415e0: 6578 5b30 5d3a 2063 6f6c 5f73 7472 7d2c  ex[0]: col_str},
+000415f0: 2069 6e70 6c61 6365 3d54 7275 6529 0a20   inplace=True). 
+00041600: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+00041610: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+00041620: 2020 2020 2020 2020 2064 665f 726f 772e           df_row.
+00041630: 696c 6f63 5b30 2c20 305d 203d 2063 6f6c  iloc[0, 0] = col
+00041640: 5f73 7472 0a0a 2020 2020 2020 2020 2020  _str..          
+00041650: 2020 726f 7773 2e61 7070 656e 6428 6466    rows.append(df
+00041660: 5f72 6f77 290a 0a20 2020 2020 2020 2064  _row)..        d
+00041670: 6620 3d20 7064 2e63 6f6e 6361 7428 726f  f = pd.concat(ro
+00041680: 7773 290a 0a20 2020 2020 2020 2023 2052  ws)..        # R
+00041690: 6573 6574 2069 6e64 6578 2069 6620 6e6f  eset index if no
+000416a0: 7420 7573 696e 6720 524f 4920 6e61 6d65  t using ROI name
+000416b0: 7320 6173 2069 6e64 6578 0a20 2020 2020  s as index.     
+000416c0: 2020 2069 6620 6e6f 7420 6e61 6d65 5f61     if not name_a
+000416d0: 735f 696e 6465 783a 0a20 2020 2020 2020  s_index:.       
+000416e0: 2020 2020 2064 6620 3d20 6466 2e72 6573       df = df.res
+000416f0: 6574 5f69 6e64 6578 2864 726f 703d 5472  et_index(drop=Tr
+00041700: 7565 290a 0a20 2020 2020 2020 2023 2043  ue)..        # C
+00041710: 6f6e 7665 7274 2074 6f20 4854 4d4c 2069  onvert to HTML i
+00041720: 6620 6e65 6564 6564 0a20 2020 2020 2020  f needed.       
+00041730: 2069 6620 6874 6d6c 3a0a 2020 2020 2020   if html:.      
+00041740: 2020 2020 2020 7265 7475 726e 2064 665f        return df_
+00041750: 746f 5f68 746d 6c28 6466 290a 2020 2020  to_html(df).    
+00041760: 2020 2020 7265 7475 726e 2064 660a 0a20      return df.. 
+00041770: 2020 2064 6566 2067 6574 5f63 6f6d 7061     def get_compa
+00041780: 7269 736f 6e28 0a20 2020 2020 2020 2073  rison(.        s
+00041790: 656c 662c 200a 2020 2020 2020 2020 6f74  elf, .        ot
+000417a0: 6865 723d 4e6f 6e65 2c20 0a20 2020 2020  her=None, .     
+000417b0: 2020 2063 6f6d 705f 7479 7065 3d22 6175     comp_type="au
+000417c0: 746f 222c 200a 2020 2020 2020 2020 636f  to", .        co
+000417d0: 6e73 656e 7375 735f 7479 7065 3d22 6d61  nsensus_type="ma
+000417e0: 6a6f 7269 7479 222c 200a 2020 2020 2020  jority", .      
+000417f0: 2020 2a2a 6b77 6172 6773 0a20 2020 2029    **kwargs.    )
+00041800: 3a0a 2020 2020 2020 2020 2222 2247 6574  :.        """Get
+00041810: 2070 616e 6461 7320 4461 7461 4672 616d   pandas DataFram
+00041820: 6520 6f66 2063 6f6d 7061 7269 736f 6e20  e of comparison 
+00041830: 6d65 7472 6963 7320 7673 2061 2073 696e  metrics vs a sin
+00041840: 676c 6520 524f 4920 6f72 0a20 2020 2020  gle ROI or.     
+00041850: 2020 2061 6e6f 7468 6572 2053 7472 7563     another Struc
+00041860: 7475 7265 5365 742e 0a0a 2020 2020 2020  tureSet...      
+00041870: 2020 2a2a 5061 7261 6d65 7465 7273 2a2a    **Parameters**
+00041880: 3a0a 0a20 2020 2020 2020 206f 7468 6572  :..        other
+00041890: 203a 2052 4f49 2f53 7472 7563 7475 7265   : ROI/Structure
+000418a0: 5365 742c 2064 6566 6175 6c74 3d4e 6f6e  Set, default=Non
+000418b0: 650a 2020 2020 2020 2020 2020 2020 4f62  e.            Ob
+000418c0: 6a65 6374 2074 6f20 636f 6d70 6172 6520  ject to compare 
+000418d0: 6f77 6e20 524f 4973 2077 6974 682e 2043  own ROIs with. C
+000418e0: 616e 2065 6974 6865 7220 6265 2061 2073  an either be a s
+000418f0: 696e 676c 6520 524f 492c 2077 6869 6368  ingle ROI, which
+00041900: 0a20 2020 2020 2020 2020 2020 2077 696c  .            wil
+00041910: 6c20 6265 2063 6f6d 7061 7265 6420 746f  l be compared to
+00041920: 2065 7665 7279 2052 4f49 2069 6e20 7468   every ROI in th
+00041930: 6973 2073 7472 7563 7475 7265 2073 6574  is structure set
+00041940: 2c20 6f72 2061 6e6f 7468 6572 0a20 2020  , or another.   
+00041950: 2020 2020 2020 2020 2073 7472 7563 7475           structu
+00041960: 7265 2073 6574 2e20 4966 204e 6f6e 652c  re set. If None,
+00041970: 2061 2063 6f6d 7061 7269 736f 6e20 7769   a comparison wi
+00041980: 6c6c 2062 6520 7065 7266 6f72 6d65 6420  ll be performed 
+00041990: 6265 7477 6565 6e20 7468 6520 0a20 2020  between the .   
+000419a0: 2020 2020 2020 2020 2052 4f49 7320 6f66           ROIs of
+000419b0: 2074 6869 7320 7374 7275 6374 7572 6520   this structure 
+000419c0: 7365 742e 0a0a 2020 2020 2020 2020 636f  set...        co
+000419d0: 6d70 5f74 7970 6520 3a20 7374 722c 2064  mp_type : str, d
+000419e0: 6566 6175 6c74 3d22 6175 746f 220a 2020  efault="auto".  
+000419f0: 2020 2020 2020 2020 2020 4d65 7468 6f64            Method
+00041a00: 2066 6f72 2073 656c 6563 7469 6e67 2077   for selecting w
+00041a10: 6869 6368 2052 4f49 7320 7368 6f75 6c64  hich ROIs should
+00041a20: 2062 6520 636f 6d70 6172 6564 2069 6620   be compared if 
+00041a30: 6f74 6865 723d 4e6f 6e65 0a20 2020 2020  other=None.     
+00041a40: 2020 2020 2020 206f 7220 6f74 6865 7220         or other 
+00041a50: 6973 2061 2053 7472 7563 7475 7265 5365  is a StructureSe
+00041a60: 742e 204f 7074 696f 6e73 2061 7265 3a0a  t. Options are:.
+00041a70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00041a80: 202d 2022 616c 6c22 203a 2063 6f6d 7061   - "all" : compa
+00041a90: 7265 2065 7665 7279 2052 4f49 2069 6e20  re every ROI in 
+00041aa0: 6f6e 6520 7374 7275 6374 7572 6520 7365  one structure se
+00041ab0: 7420 746f 2065 7665 7279 2052 4f49 0a20  t to every ROI. 
+00041ac0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00041ad0: 6e20 7468 6520 6f74 6865 7220 2872 656d  n the other (rem
+00041ae0: 6f76 696e 6720 636f 6d70 6172 6973 6f6e  oving comparison
+00041af0: 7320 6f66 2061 6e20 524f 4920 746f 2069  s of an ROI to i
+00041b00: 7473 656c 6629 2e0a 2020 2020 2020 2020  tself)..        
+00041b10: 2020 2020 2020 2020 2d20 2262 795f 6e61          - "by_na
+00041b20: 6d65 2220 3a20 636f 6d70 6172 6520 6576  me" : compare ev
+00041b30: 6572 7920 524f 4920 696e 206f 6e65 2073  ery ROI in one s
+00041b40: 7472 7563 7475 7265 2073 6574 0a20 2020  tructure set.   
+00041b50: 2020 2020 2020 2020 2020 2020 2074 6f20               to 
+00041b60: 6576 6572 7920 524f 4920 696e 2074 6865  every ROI in the
+00041b70: 206f 7468 6572 2077 6974 6820 7468 6520   other with the 
+00041b80: 7361 6d65 206e 616d 652e 2055 7365 6675  same name. Usefu
+00041b90: 6c20 7768 656e 0a20 2020 2020 2020 2020  l when.         
+00041ba0: 2020 2020 2020 2063 6f6d 7061 7269 6e67         comparing
+00041bb0: 2074 776f 2073 7472 7563 7475 7265 2073   two structure s
+00041bc0: 6574 7320 636f 6e74 6169 6e69 6e67 2052  ets containing R
+00041bd0: 4f49 7320 7769 7468 2074 6865 2073 616d  OIs with the sam
+00041be0: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
+00041bf0: 2020 6e61 6d65 732e 0a20 2020 2020 2020    names..       
+00041c00: 2020 2020 2020 2020 202d 2022 636f 6e73           - "cons
+00041c10: 656e 7375 7322 203a 2069 6620 6f74 6865  ensus" : if othe
+00041c20: 723d 4e6f 6e65 2c20 636f 6d70 6172 6520  r=None, compare 
+00041c30: 6561 6368 2052 4f49 2069 6e20 7468 6973  each ROI in this
+00041c40: 200a 2020 2020 2020 2020 2020 2020 2020   .              
+00041c50: 2020 7374 7275 6374 7572 6520 7365 7420    structure set 
+00041c60: 746f 2074 6865 2063 6f6e 7365 6e73 7573  to the consensus
+00041c70: 206f 6620 616c 6c20 6f74 6865 7220 524f   of all other RO
+00041c80: 4973 3b20 6f74 6865 7277 6973 652c 0a20  Is; otherwise,. 
+00041c90: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+00041ca0: 6f6d 7061 7265 2065 6163 6820 524f 4920  ompare each ROI 
+00041cb0: 696e 2074 6869 7320 7374 7275 6374 7572  in this structur
+00041cc0: 6520 7365 7420 746f 2074 6865 2063 6f6e  e set to the con
+00041cd0: 7365 6e73 7573 206f 660a 2020 2020 2020  sensus of.      
+00041ce0: 2020 2020 2020 2020 2020 616c 6c20 524f            all RO
+00041cf0: 4973 2069 6e20 7468 6520 6f74 6865 7220  Is in the other 
+00041d00: 7374 7275 6374 7572 6520 7365 742e 2043  structure set. C
+00041d10: 6f6e 7365 6e73 7573 2074 7970 6520 6973  onsensus type is
+00041d20: 2073 6574 2076 6961 0a20 2020 2020 2020   set via.       
+00041d30: 2020 2020 2020 2020 2074 6865 2063 6f6e           the con
+00041d40: 7365 6e73 7573 5f74 7970 6520 6172 6775  sensus_type argu
+00041d50: 6d65 6e74 2e0a 2020 2020 2020 2020 2020  ment..          
+00041d60: 2020 2020 2020 2d20 2261 7574 6f22 203a        - "auto" :
+00041d70: 2069 6620 6f74 6865 723d 4e6f 6e65 2c20   if other=None, 
+00041d80: 7573 6520 2261 6c6c 2220 636f 6d70 6172  use "all" compar
+00041d90: 6973 6f6e 2e20 4f74 6865 7277 6973 652c  ison. Otherwise,
+00041da0: 200a 2020 2020 2020 2020 2020 2020 2020   .              
+00041db0: 2020 6669 7273 7420 6c6f 6f6b 2066 6f72    first look for
+00041dc0: 2061 6e79 2052 4f49 7320 7769 7468 206d   any ROIs with m
+00041dd0: 6174 6368 696e 6720 6e61 6d65 733b 2069  atching names; i
+00041de0: 6620 6174 206c 6561 7374 206f 6e65 200a  f at least one .
+00041df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00041e00: 6d61 7463 6869 6e67 2070 6169 7220 6973  matching pair is
+00041e10: 2066 6f75 6e64 2c20 636f 6d70 6172 6520   found, compare 
+00041e20: 7669 6120 7468 6520 2262 795f 6e61 6d65  via the "by_name
+00041e30: 2220 636f 6d70 6172 6973 6f6e 200a 2020  " comparison .  
+00041e40: 2020 2020 2020 2020 2020 2020 2020 7479                ty
+00041e50: 7065 2e20 4966 206e 6f20 6d61 7463 6865  pe. If no matche
+00041e60: 7320 6172 6520 666f 756e 642c 2063 6f6d  s are found, com
+00041e70: 7061 7265 2076 6961 2074 6865 2022 616c  pare via the "al
+00041e80: 6c22 2063 6f6d 7061 7269 736f 6e20 0a20  l" comparison . 
+00041e90: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+00041ea0: 7970 652e 0a0a 2020 2020 2020 2020 636f  ype...        co
+00041eb0: 6e73 656e 7375 735f 7479 7065 203a 2073  nsensus_type : s
+00041ec0: 7472 2c20 6465 6661 756c 743d 226d 616a  tr, default="maj
+00041ed0: 6f72 6974 7920 766f 7465 220a 2020 2020  ority vote".    
+00041ee0: 2020 2020 2020 2020 4d65 7468 6f64 2066          Method f
+00041ef0: 6f72 2063 616c 6375 6c61 7469 6e67 2063  or calculating c
+00041f00: 6f6e 7365 6e73 7573 206f 6620 524f 4973  onsensus of ROIs
+00041f10: 2069 6620 7573 696e 6720 7468 6520 2263   if using the "c
+00041f20: 6f6e 7365 6e73 7573 220a 2020 2020 2020  onsensus".      
+00041f30: 2020 2020 2020 636f 6d70 6172 6973 6f6e        comparison
+00041f40: 2074 7970 652e 204f 7074 696f 6e73 2061   type. Options a
+00041f50: 7265 3a0a 0a20 2020 2020 2020 2020 2020  re:..           
+00041f60: 2020 2020 202d 2022 6d61 6a6f 7269 7479       - "majority
+00041f70: 2220 3a20 7573 6520 6d61 6a6f 7269 7479  " : use majority
+00041f80: 2076 6f74 6520 6f66 2052 4f49 7320 2869   vote of ROIs (i
+00041f90: 2e65 2e20 766f 7865 6c73 2077 6865 7265  .e. voxels where
+00041fa0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00041fb0: 2061 7420 6c65 6173 7420 6861 6c66 206f   at least half o
+00041fc0: 6620 7468 6520 524f 4973 2065 7869 7374  f the ROIs exist
+00041fd0: 292e 0a20 2020 2020 2020 2020 2020 2020  )..             
+00041fe0: 2020 202d 2022 6f76 6572 6c61 7022 203a     - "overlap" :
+00041ff0: 2075 7365 206f 7665 726c 6170 206f 6620   use overlap of 
+00042000: 524f 4973 2e0a 2020 2020 2020 2020 2020  ROIs..          
+00042010: 2020 2020 2020 2d20 2273 756d 2220 3a20        - "sum" : 
+00042020: 7573 6520 7375 6d20 6f66 2052 4f49 732e  use sum of ROIs.
+00042030: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00042040: 202d 2022 7374 6170 6c65 2220 3a20 7573   - "staple" : us
+00042050: 6520 7468 6520 5354 4150 4c45 2061 6c67  e the STAPLE alg
+00042060: 6f72 6974 686d 2074 6f20 6361 6c63 756c  orithm to calcul
+00042070: 6174 6520 636f 6e73 656e 7375 732e 0a0a  ate consensus...
+00042080: 2020 2020 2020 2020 6874 6d6c 203a 2062          html : b
+00042090: 6f6f 6c2c 2064 6566 6175 6c74 3d46 616c  ool, default=Fal
+000420a0: 7365 0a20 2020 2020 2020 2020 2020 2049  se.            I
+000420b0: 6620 5472 7565 2c20 7468 6520 7461 626c  f True, the tabl
+000420c0: 6520 7769 6c6c 2062 6520 636f 6e76 6572  e will be conver
+000420d0: 7465 6420 746f 2048 544d 4c20 7465 7874  ted to HTML text
+000420e0: 2063 6f6c 6f72 2d63 6f64 6564 2062 6173   color-coded bas
+000420f0: 6564 0a20 2020 2020 2020 2020 2020 206f  ed.            o
+00042100: 6e20 524f 4920 636f 6c6f 7273 2e0a 0a20  n ROI colors... 
+00042110: 2020 2020 2020 2067 7265 7965 645f 6f75         greyed_ou
+00042120: 7420 3a20 626f 6f6c 2c20 6465 6661 756c  t : bool, defaul
+00042130: 743d 4e6f 6e65 0a20 2020 2020 2020 2020  t=None.         
+00042140: 2020 204c 6973 7420 6f66 2052 4f49 7320     List of ROIs 
+00042150: 7468 6174 2073 686f 756c 6420 6265 2067  that should be g
+00042160: 7265 7965 6420 6f75 7420 2867 6976 656e  reyed out (given
+00042170: 2061 2067 7265 7920 6261 636b 6772 6f75   a grey backgrou
+00042180: 6e64 0a20 2020 2020 2020 2020 2020 2074  nd.            t
+00042190: 6f20 7468 6569 7220 7465 7874 2920 6966  o their text) if
+000421a0: 2072 6574 7572 6e69 6e67 2061 6e20 4854   returning an HT
+000421b0: 4d4c 2073 7472 696e 672e 0a0a 2020 2020  ML string...    
+000421c0: 2020 2020 602a 2a60 6b77 6172 6773 203a      `**`kwargs :
+000421d0: 200a 2020 2020 2020 2020 2020 2020 4b65   .            Ke
+000421e0: 7977 6f72 6420 6172 6773 2074 6f20 7061  yword args to pa
+000421f0: 7373 2074 6f20 524f 492e 6765 745f 636f  ss to ROI.get_co
+00042200: 6d70 6172 6973 6f6e 2829 2e20 5365 6520  mparison(). See 
+00042210: 0a20 2020 2020 2020 2020 2020 2052 4f49  .            ROI
+00042220: 2e67 6574 5f63 6f6d 7061 7269 736f 6e28  .get_comparison(
+00042230: 2920 646f 6375 6d65 6e74 6174 696f 6e20  ) documentation 
+00042240: 666f 7220 6465 7461 696c 732e 0a20 2020  for details..   
+00042250: 2020 2020 2022 2222 0a0a 2020 2020 2020       """..      
+00042260: 2020 6466 7320 3d20 5b5d 0a0a 2020 2020    dfs = []..    
+00042270: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
+00042280: 6528 6f74 6865 722c 2052 4f49 293a 0a20  e(other, ROI):. 
+00042290: 2020 2020 2020 2020 2020 2070 6169 7273             pairs
+000422a0: 203d 205b 2872 6f69 2c20 6f74 6865 7229   = [(roi, other)
+000422b0: 2066 6f72 2072 6f69 2069 6e20 7365 6c66   for roi in self
+000422c0: 2e67 6574 5f72 6f69 7328 6967 6e6f 7265  .get_rois(ignore
+000422d0: 5f65 6d70 7479 3d54 7275 6529 5d0a 2020  _empty=True)].  
+000422e0: 2020 2020 2020 656c 6966 2069 7369 6e73        elif isins
+000422f0: 7461 6e63 6528 6f74 6865 722c 2053 7472  tance(other, Str
+00042300: 7563 7475 7265 5365 7429 206f 7220 6f74  uctureSet) or ot
+00042310: 6865 7220 6973 204e 6f6e 653a 0a20 2020  her is None:.   
+00042320: 2020 2020 2020 2020 2070 6169 7273 203d           pairs =
+00042330: 2073 656c 662e 6765 745f 636f 6d70 6172   self.get_compar
+00042340: 6973 6f6e 5f70 6169 7273 286f 7468 6572  ison_pairs(other
+00042350: 2c20 636f 6d70 5f74 7970 652c 2063 6f6e  , comp_type, con
+00042360: 7365 6e73 7573 5f74 7970 6529 0a20 2020  sensus_type).   
+00042370: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+00042380: 2020 2020 2020 2072 6169 7365 2054 7970         raise Typ
+00042390: 6545 7272 6f72 2822 3c6f 7468 6572 3e20  eError("<other> 
+000423a0: 6d75 7374 2062 6520 524f 4920 6f72 2053  must be ROI or S
+000423b0: 7472 7563 7475 7265 5365 7421 2229 0a0a  tructureSet!")..
+000423c0: 2020 2020 2020 2020 7265 7475 726e 2063          return c
+000423d0: 6f6d 7061 7265 5f72 6f69 5f70 6169 7273  ompare_roi_pairs
+000423e0: 2870 6169 7273 2c20 2a2a 6b77 6172 6773  (pairs, **kwargs
+000423f0: 290a 0a20 2020 2064 6566 2067 6574 5f63  )..    def get_c
+00042400: 6f6d 7061 7269 736f 6e5f 7061 6972 7328  omparison_pairs(
+00042410: 7365 6c66 2c20 6f74 6865 723d 4e6f 6e65  self, other=None
+00042420: 2c20 636f 6d70 5f74 7970 653d 2261 7574  , comp_type="aut
+00042430: 6f22 2c20 0a20 2020 2020 2020 2020 2020  o", .           
+00042440: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00042450: 2020 636f 6e73 656e 7375 735f 7479 7065    consensus_type
+00042460: 3d22 6d61 6a6f 7269 7479 222c 200a 2020  ="majority", .  
 00042470: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00042480: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00042490: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000424a0: 2020 2020 2020 636f 6c6f 723d 636f 6e73        color=cons
-000424b0: 656e 7375 735f 636f 6c6f 722c 0a20 2020  ensus_color,.   
-000424c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000424d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000424e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000424f0: 2020 2065 7863 6c75 6465 3d72 6f69 2e6e     exclude=roi.n
-00042500: 616d 6529 2929 0a20 2020 2020 2020 2020  ame))).         
-00042510: 2020 2072 6574 7572 6e20 7061 6972 730a     return pairs.
-00042520: 0a20 2020 2020 2020 2023 2053 6574 2064  .        # Set d
-00042530: 6566 6175 6c74 2062 6568 6176 696f 7572  efault behaviour
-00042540: 2074 6f20 2261 6c6c 2220 6966 206f 7468   to "all" if oth
-00042550: 6572 2069 7320 4e6f 6e65 0a20 2020 2020  er is None.     
-00042560: 2020 2069 6620 6f74 6865 7220 6973 204e     if other is N
-00042570: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-00042580: 206f 7468 6572 203d 2073 656c 660a 2020   other = self.  
-00042590: 2020 2020 2020 2020 2020 6966 2063 6f6d            if com
-000425a0: 705f 7479 7065 203d 3d20 2261 7574 6f22  p_type == "auto"
-000425b0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000425c0: 2020 636f 6d70 5f74 7970 6520 3d20 2261    comp_type = "a
-000425d0: 6c6c 220a 0a20 2020 2020 2020 2023 2043  ll"..        # C
-000425e0: 6865 636b 2066 6f72 2052 4f49 7320 7769  heck for ROIs wi
-000425f0: 7468 206d 6174 6368 696e 6720 6e61 6d65  th matching name
-00042600: 7320 6966 2075 7369 6e67 2022 6175 746f  s if using "auto
-00042610: 2220 6f72 2022 6279 5f6e 616d 6522 0a20  " or "by_name". 
-00042620: 2020 2020 2020 206d 6174 6368 6573 203d         matches =
-00042630: 205b 5d0a 2020 2020 2020 2020 6966 2063   [].        if c
-00042640: 6f6d 705f 7479 7065 2069 6e20 5b22 6175  omp_type in ["au
-00042650: 746f 222c 2022 6279 5f6e 616d 6522 5d3a  to", "by_name"]:
-00042660: 0a20 2020 2020 2020 2020 2020 206d 6174  .            mat
-00042670: 6368 6573 203d 205b 0a20 2020 2020 2020  ches = [.       
-00042680: 2020 2020 2020 2020 2073 2066 6f72 2073           s for s
-00042690: 2069 6e20 7365 6c66 2e67 6574 5f72 6f69   in self.get_roi
-000426a0: 5f6e 616d 6573 2869 676e 6f72 655f 656d  _names(ignore_em
-000426b0: 7074 793d 5472 7565 290a 2020 2020 2020  pty=True).      
-000426c0: 2020 2020 2020 2020 2020 6966 2073 2069            if s i
-000426d0: 6e20 6f74 6865 722e 6765 745f 726f 695f  n other.get_roi_
-000426e0: 6e61 6d65 7328 6967 6e6f 7265 5f65 6d70  names(ignore_emp
-000426f0: 7479 3d54 7275 6529 0a20 2020 2020 2020  ty=True).       
-00042700: 2020 2020 2020 2020 205d 0a20 2020 2020           ].     
-00042710: 2020 2020 2020 2069 6620 6c65 6e28 6d61         if len(ma
-00042720: 7463 6865 7329 206f 7220 636f 6d70 5f74  tches) or comp_t
-00042730: 7970 6520 3d3d 2022 6279 5f6e 616d 6522  ype == "by_name"
-00042740: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00042750: 2020 7265 7475 726e 205b 0a20 2020 2020    return [.     
-00042760: 2020 2020 2020 2020 2020 2020 2020 2028                 (
-00042770: 7365 6c66 2e67 6574 5f72 6f69 286e 616d  self.get_roi(nam
-00042780: 6529 2c20 6f74 6865 722e 6765 745f 726f  e), other.get_ro
-00042790: 6928 6e61 6d65 2929 2066 6f72 206e 616d  i(name)) for nam
-000427a0: 6520 696e 206d 6174 6368 6573 0a20 2020  e in matches.   
-000427b0: 2020 2020 2020 2020 2020 2020 205d 0a0a               ]..
-000427c0: 2020 2020 2020 2020 2320 4f74 6865 7277          # Otherw
-000427d0: 6973 652c 2070 6169 7220 6561 6368 2052  ise, pair each R
-000427e0: 4f49 2077 6974 6820 6576 6572 7920 6f74  OI with every ot
-000427f0: 6865 7220 2865 786c 6375 6469 6e67 2070  her (exlcuding p
-00042800: 6169 7273 206f 6620 7468 6520 7361 6d65  airs of the same
-00042810: 0a20 2020 2020 2020 2023 2052 4f49 290a  .        # ROI).
-00042820: 2020 2020 2020 2020 7061 6972 7320 3d20          pairs = 
-00042830: 5b5d 0a20 2020 2020 2020 2066 6f72 2072  [].        for r
-00042840: 6f69 3120 696e 2073 656c 662e 6765 745f  oi1 in self.get_
-00042850: 726f 6973 2869 676e 6f72 655f 656d 7074  rois(ignore_empt
-00042860: 793d 5472 7565 293a 0a20 2020 2020 2020  y=True):.       
-00042870: 2020 2020 2066 6f72 2072 6f69 3220 696e       for roi2 in
-00042880: 206f 7468 6572 2e67 6574 5f72 6f69 7328   other.get_rois(
-00042890: 6967 6e6f 7265 5f65 6d70 7479 3d54 7275  ignore_empty=Tru
-000428a0: 6529 3a0a 2020 2020 2020 2020 2020 2020  e):.            
-000428b0: 2020 2020 6966 2072 6f69 3120 6973 206e      if roi1 is n
-000428c0: 6f74 2072 6f69 3220 616e 6420 2872 6f69  ot roi2 and (roi
-000428d0: 322c 2072 6f69 3129 206e 6f74 2069 6e20  2, roi1) not in 
-000428e0: 7061 6972 733a 0a20 2020 2020 2020 2020  pairs:.         
-000428f0: 2020 2020 2020 2020 2020 2070 6169 7273             pairs
-00042900: 2e61 7070 656e 6428 2872 6f69 312c 2072  .append((roi1, r
-00042910: 6f69 3229 290a 0a20 2020 2020 2020 2072  oi2))..        r
-00042920: 6574 7572 6e20 7061 6972 730a 0a20 2020  eturn pairs..   
-00042930: 2064 6566 2067 6574 5f6d 6964 5f69 6478   def get_mid_idx
-00042940: 2873 656c 662c 2076 6965 773d 2278 2d79  (self, view="x-y
-00042950: 2229 3a0a 2020 2020 2020 2020 2222 2252  "):.        """R
-00042960: 6574 7572 6e20 7468 6520 6172 7261 7920  eturn the array 
-00042970: 696e 6465 7820 6f66 2074 6865 2073 6c69  index of the sli
-00042980: 6365 2074 6861 7420 636f 6e74 6169 6e73  ce that contains
-00042990: 2074 6865 206d 6f73 7420 524f 4973 2e22   the most ROIs."
-000429a0: 2222 0a0a 2020 2020 2020 2020 696e 6469  ""..        indi
-000429b0: 6365 7320 3d20 5b5d 0a20 2020 2020 2020  ces = [].       
-000429c0: 2066 6f72 2072 6f69 2069 6e20 7365 6c66   for roi in self
-000429d0: 2e67 6574 5f72 6f69 7328 6967 6e6f 7265  .get_rois(ignore
-000429e0: 5f65 6d70 7479 3d54 7275 6529 3a0a 2020  _empty=True):.  
-000429f0: 2020 2020 2020 2020 2020 696e 6469 6365            indice
-00042a00: 732e 6578 7465 6e64 2872 6f69 2e67 6574  s.extend(roi.get
-00042a10: 5f69 6e64 6963 6573 2876 6965 7729 290a  _indices(view)).
-00042a20: 2020 2020 2020 2020 7265 7475 726e 206e          return n
-00042a30: 702e 6269 6e63 6f75 6e74 2869 6e64 6963  p.bincount(indic
-00042a40: 6573 292e 6172 676d 6178 2829 0a0a 2020  es).argmax()..  
-00042a50: 2020 6465 6620 706c 6f74 5f63 6f6d 7061    def plot_compa
-00042a60: 7269 736f 6e73 280a 2020 2020 2020 2020  risons(.        
-00042a70: 7365 6c66 2c20 6f74 6865 723d 4e6f 6e65  self, other=None
-00042a80: 2c20 636f 6d70 5f74 7970 653d 2261 7574  , comp_type="aut
-00042a90: 6f22 2c20 6f75 7464 6972 3d4e 6f6e 652c  o", outdir=None,
-00042aa0: 206c 6567 656e 643d 5472 7565 2c20 0a20   legend=True, . 
-00042ab0: 2020 2020 2020 206e 616d 6573 3d4e 6f6e         names=Non
-00042ac0: 652c 206c 6567 656e 645f 6262 6f78 5f74  e, legend_bbox_t
-00042ad0: 6f5f 616e 6368 6f72 3d4e 6f6e 652c 206c  o_anchor=None, l
-00042ae0: 6567 656e 645f 6c6f 633d 226c 6f77 6572  egend_loc="lower
-00042af0: 206c 6566 7422 2c0a 2020 2020 2020 2020   left",.        
-00042b00: 2a2a 6b77 6172 6773 0a20 2020 2029 3a0a  **kwargs.    ):.
-00042b10: 2020 2020 2020 2020 2222 2250 6c6f 7420          """Plot 
-00042b20: 636f 6d70 6172 6973 6f6e 2070 6169 7273  comparison pairs
-00042b30: 2e22 2222 0a0a 2020 2020 2020 2020 6966  ."""..        if
-00042b40: 206f 7574 6469 7220 616e 6420 6e6f 7420   outdir and not 
-00042b50: 6f73 2e70 6174 682e 6578 6973 7473 286f  os.path.exists(o
-00042b60: 7574 6469 7229 3a0a 2020 2020 2020 2020  utdir):.        
-00042b70: 2020 2020 6f73 2e6d 616b 6564 6972 7328      os.makedirs(
-00042b80: 6f75 7464 6972 290a 0a20 2020 2020 2020  outdir)..       
-00042b90: 2066 6f72 2072 6f69 312c 2072 6f69 3220   for roi1, roi2 
-00042ba0: 696e 2073 656c 662e 6765 745f 636f 6d70  in self.get_comp
-00042bb0: 6172 6973 6f6e 5f70 6169 7273 286f 7468  arison_pairs(oth
-00042bc0: 6572 2c20 636f 6d70 5f74 7970 6529 3a0a  er, comp_type):.
-00042bd0: 0a20 2020 2020 2020 2020 2020 206f 7574  .            out
-00042be0: 6e61 6d65 203d 204e 6f6e 650a 2020 2020  name = None.    
-00042bf0: 2020 2020 2020 2020 6966 206f 7574 6469          if outdi
-00042c00: 723a 0a20 2020 2020 2020 2020 2020 2020  r:.             
-00042c10: 2020 2063 6f6d 705f 6e61 6d65 203d 2072     comp_name = r
-00042c20: 6f69 312e 6765 745f 636f 6d70 6172 6973  oi1.get_comparis
-00042c30: 6f6e 5f6e 616d 6528 726f 6932 2c20 5472  on_name(roi2, Tr
-00042c40: 7565 290a 2020 2020 2020 2020 2020 2020  ue).            
-00042c50: 2020 2020 6f75 746e 616d 6520 3d20 6f73      outname = os
-00042c60: 2e70 6174 682e 6a6f 696e 286f 7574 6469  .path.join(outdi
-00042c70: 722c 2066 227b 636f 6d70 5f6e 616d 657d  r, f"{comp_name}
-00042c80: 2e70 6e67 2229 0a0a 2020 2020 2020 2020  .png")..        
-00042c90: 2020 2020 6966 206e 616d 6573 2069 7320      if names is 
-00042ca0: 4e6f 6e65 2061 6e64 2072 6f69 312e 6e61  None and roi1.na
-00042cb0: 6d65 203d 3d20 726f 6932 2e6e 616d 653a  me == roi2.name:
-00042cc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00042cd0: 206e 616d 6573 203d 205b 7365 6c66 2e6e   names = [self.n
-00042ce0: 616d 652c 206f 7468 6572 2e6e 616d 655d  ame, other.name]
-00042cf0: 0a0a 2020 2020 2020 2020 2020 2020 726f  ..            ro
-00042d00: 6931 2e70 6c6f 745f 636f 6d70 6172 6973  i1.plot_comparis
-00042d10: 6f6e 280a 2020 2020 2020 2020 2020 2020  on(.            
-00042d20: 2020 2020 726f 6932 2c20 6c65 6765 6e64      roi2, legend
-00042d30: 3d6c 6567 656e 642c 2073 6176 655f 6173  =legend, save_as
-00042d40: 3d6f 7574 6e61 6d65 2c20 6e61 6d65 733d  =outname, names=
-00042d50: 6e61 6d65 732c 0a20 2020 2020 2020 2020  names,.         
-00042d60: 2020 2020 2020 206c 6567 656e 645f 6262         legend_bb
-00042d70: 6f78 5f74 6f5f 616e 6368 6f72 3d6c 6567  ox_to_anchor=leg
-00042d80: 656e 645f 6262 6f78 5f74 6f5f 616e 6368  end_bbox_to_anch
-00042d90: 6f72 2c0a 2020 2020 2020 2020 2020 2020  or,.            
-00042da0: 2020 2020 6c65 6765 6e64 5f6c 6f63 3d6c      legend_loc=l
-00042db0: 6567 656e 645f 6c6f 632c 202a 2a6b 7761  egend_loc, **kwa
-00042dc0: 7267 730a 2020 2020 2020 2020 2020 2020  rgs.            
-00042dd0: 290a 0a20 2020 2064 6566 2070 6c6f 745f  )..    def plot_
-00042de0: 7375 7266 6163 655f 6469 7374 616e 6365  surface_distance
-00042df0: 7328 0a20 2020 2020 2020 2073 656c 662c  s(.        self,
-00042e00: 206f 7468 6572 2c20 6f75 7464 6972 3d4e   other, outdir=N
-00042e10: 6f6e 652c 2073 6967 6e65 643d 4661 6c73  one, signed=Fals
-00042e20: 652c 2063 6f6d 705f 7479 7065 3d22 6175  e, comp_type="au
-00042e30: 746f 222c 202a 2a6b 7761 7267 730a 2020  to", **kwargs.  
-00042e40: 2020 293a 0a20 2020 2020 2020 2022 2222    ):.        """
-00042e50: 506c 6f74 2073 7572 6661 6365 2064 6973  Plot surface dis
-00042e60: 7461 6e63 6573 2066 6f72 2061 6c6c 2052  tances for all R
-00042e70: 4f49 2070 6169 7273 2e22 2222 0a0a 2020  OI pairs."""..  
-00042e80: 2020 2020 2020 6966 206e 6f74 206f 732e        if not os.
-00042e90: 7061 7468 2e65 7869 7374 7328 6f75 7464  path.exists(outd
-00042ea0: 6972 293a 0a20 2020 2020 2020 2020 2020  ir):.           
-00042eb0: 206f 732e 6d61 6b65 6469 7273 286f 7574   os.makedirs(out
-00042ec0: 6469 7229 0a0a 2020 2020 2020 2020 666f  dir)..        fo
-00042ed0: 7220 726f 6931 2c20 726f 6932 2069 6e20  r roi1, roi2 in 
-00042ee0: 7365 6c66 2e67 6574 5f63 6f6d 7061 7269  self.get_compari
-00042ef0: 736f 6e5f 7061 6972 7328 6f74 6865 722c  son_pairs(other,
-00042f00: 2063 6f6d 705f 7479 7065 293a 0a20 2020   comp_type):.   
-00042f10: 2020 2020 2020 2020 2063 6f6d 705f 6e61           comp_na
-00042f20: 6d65 203d 2072 6f69 312e 6765 745f 636f  me = roi1.get_co
-00042f30: 6d70 6172 6973 6f6e 5f6e 616d 6528 726f  mparison_name(ro
-00042f40: 6932 2c20 5472 7565 290a 2020 2020 2020  i2, True).      
-00042f50: 2020 2020 2020 6966 206f 7574 6469 723a        if outdir:
-00042f60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00042f70: 206f 7574 6e61 6d65 203d 206f 732e 7061   outname = os.pa
-00042f80: 7468 2e6a 6f69 6e28 6f75 7464 6972 2c20  th.join(outdir, 
-00042f90: 6622 7b63 6f6d 705f 6e61 6d65 7d2e 706e  f"{comp_name}.pn
-00042fa0: 6722 290a 2020 2020 2020 2020 2020 2020  g").            
-00042fb0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-00042fc0: 2020 2020 2020 6f75 746e 616d 6520 3d20        outname = 
-00042fd0: 4e6f 6e65 0a20 2020 2020 2020 2020 2020  None.           
-00042fe0: 2072 6f69 312e 706c 6f74 5f73 7572 6661   roi1.plot_surfa
-00042ff0: 6365 5f64 6973 7461 6e63 6573 2872 6f69  ce_distances(roi
-00043000: 322c 2073 6967 6e65 643d 7369 676e 6564  2, signed=signed
-00043010: 2c20 7361 7665 5f61 733d 6f75 746e 616d  , save_as=outnam
-00043020: 652c 202a 2a6b 7761 7267 7329 0a0a 2020  e, **kwargs)..  
-00043030: 2020 6465 6620 7772 6974 6528 7365 6c66    def write(self
-00043040: 2c20 6f75 746e 616d 653d 4e6f 6e65 2c20  , outname=None, 
-00043050: 6f75 7464 6972 3d22 2e22 2c20 6578 743d  outdir=".", ext=
-00043060: 4e6f 6e65 2c20 6f76 6572 7772 6974 653d  None, overwrite=
-00043070: 4661 6c73 652c 0a20 2020 2020 2020 2020  False,.         
-00043080: 2020 2068 6561 6465 725f 736f 7572 6365     header_source
-00043090: 3d4e 6f6e 652c 2070 6174 6965 6e74 5f69  =None, patient_i
-000430a0: 643d 4e6f 6e65 2c20 6d6f 6461 6c69 7479  d=None, modality
-000430b0: 3d4e 6f6e 652c 0a20 2020 2020 2020 2020  =None,.         
-000430c0: 2020 2072 6f6f 745f 7569 643d 4e6f 6e65     root_uid=None
-000430d0: 2c20 7665 7262 6f73 653d 5472 7565 2c20  , verbose=True, 
-000430e0: 6865 6164 6572 5f65 7874 7261 733d 7b7d  header_extras={}
-000430f0: 2c20 2a2a 6b77 6172 6773 293a 0a20 2020  , **kwargs):.   
-00043100: 2020 2020 2022 2222 5772 6974 6520 746f       """Write to
-00043110: 2061 2064 6963 6f6d 2053 7472 7563 7475   a dicom Structu
-00043120: 7265 5365 7420 6669 6c65 206f 7220 6469  reSet file or di
-00043130: 7265 6374 6f72 7920 6f66 206e 6966 7469  rectory of nifti
-00043140: 2066 696c 6573 2e22 2222 0a0a 2020 2020   files."""..    
-00043150: 2020 2020 6966 2065 7874 2069 7320 6e6f      if ext is no
-00043160: 7420 4e6f 6e65 2061 6e64 206e 6f74 2065  t None and not e
-00043170: 7874 2e73 7461 7274 7377 6974 6828 222e  xt.startswith(".
-00043180: 2229 3a0a 2020 2020 2020 2020 2020 2020  "):.            
-00043190: 6578 7420 3d20 6622 2e7b 6578 747d 220a  ext = f".{ext}".
-000431a0: 0a20 2020 2020 2020 2023 2043 6865 636b  .        # Check
-000431b0: 2077 6865 7468 6572 2074 6f20 7772 6974   whether to writ
-000431c0: 6520 746f 2064 6963 6f6d 2066 696c 650a  e to dicom file.
-000431d0: 2020 2020 2020 2020 6966 2069 7369 6e73          if isins
-000431e0: 7461 6e63 6528 6f75 746e 616d 652c 2073  tance(outname, s
-000431f0: 7472 2920 616e 6420 6f75 746e 616d 652e  tr) and outname.
-00043200: 656e 6473 7769 7468 2822 2e64 636d 2229  endswith(".dcm")
-00043210: 3a0a 2020 2020 2020 2020 2020 2020 6578  :.            ex
-00043220: 7420 3d20 222e 6463 6d22 0a0a 2020 2020  t = ".dcm"..    
-00043230: 2020 2020 6966 2065 7874 203d 3d20 222e      if ext == ".
-00043240: 6463 6d22 3a0a 2020 2020 2020 2020 2020  dcm":.          
-00043250: 2020 6469 636f 6d5f 7772 6974 6572 203d    dicom_writer =
-00043260: 2044 6963 6f6d 5772 6974 6572 280a 2020   DicomWriter(.  
-00043270: 2020 2020 2020 2020 2020 2020 2020 6f75                ou
-00043280: 7464 6972 3d6f 7574 6469 722c 0a20 2020  tdir=outdir,.   
-00043290: 2020 2020 2020 2020 2020 2020 2064 6174               dat
-000432a0: 613d 7365 6c66 2c0a 2020 2020 2020 2020  a=self,.        
-000432b0: 2020 2020 2020 2020 6166 6669 6e65 3d4e          affine=N
-000432c0: 6f6e 652c 0a20 2020 2020 2020 2020 2020  one,.           
-000432d0: 2020 2020 206f 7665 7277 7269 7465 3d6f       overwrite=o
-000432e0: 7665 7277 7269 7465 2c0a 2020 2020 2020  verwrite,.      
-000432f0: 2020 2020 2020 2020 2020 6865 6164 6572            header
-00043300: 5f73 6f75 7263 653d 6865 6164 6572 5f73  _source=header_s
-00043310: 6f75 7263 652c 0a20 2020 2020 2020 2020  ource,.         
-00043320: 2020 2020 2020 206f 7269 656e 7461 7469         orientati
-00043330: 6f6e 3d4e 6f6e 652c 0a20 2020 2020 2020  on=None,.       
-00043340: 2020 2020 2020 2020 2070 6174 6965 6e74           patient
-00043350: 5f69 643d 7061 7469 656e 745f 6964 2c0a  _id=patient_id,.
-00043360: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00043370: 6d6f 6461 6c69 7479 3d27 5254 5354 5255  modality='RTSTRU
-00043380: 4354 272c 0a20 2020 2020 2020 2020 2020  CT',.           
-00043390: 2020 2020 2072 6f6f 745f 7569 643d 726f       root_uid=ro
-000433a0: 6f74 5f75 6964 2c0a 2020 2020 2020 2020  ot_uid,.        
-000433b0: 2020 2020 2020 2020 6865 6164 6572 5f65          header_e
-000433c0: 7874 7261 733d 6865 6164 6572 5f65 7874  xtras=header_ext
-000433d0: 7261 732c 0a20 2020 2020 2020 2020 2020  ras,.           
-000433e0: 2020 2020 2073 6f75 7263 655f 7479 7065       source_type
-000433f0: 3d74 7970 6528 7365 6c66 292e 5f5f 6e61  =type(self).__na
-00043400: 6d65 5f5f 2c0a 2020 2020 2020 2020 2020  me__,.          
-00043410: 2020 2020 2020 6f75 746e 616d 6520 3d20        outname = 
-00043420: 6f75 746e 616d 652c 0a20 2020 2020 2020  outname,.       
-00043430: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
-00043440: 2020 2073 656c 662e 6469 636f 6d5f 6461     self.dicom_da
-00043450: 7461 7365 7420 3d20 6469 636f 6d5f 7772  taset = dicom_wr
-00043460: 6974 6572 2e77 7269 7465 2829 0a0a 2020  iter.write()..  
-00043470: 2020 2020 2020 2020 2020 6966 2076 6572            if ver
-00043480: 626f 7365 3a0a 2020 2020 2020 2020 2020  bose:.          
-00043490: 2020 2020 2020 7072 696e 7428 2257 726f        print("Wro
-000434a0: 7465 2064 6963 6f6d 2066 696c 6520 746f  te dicom file to
-000434b0: 2064 6972 6563 746f 7279 3a22 2c20 6f75   directory:", ou
-000434c0: 7464 6972 290a 2020 2020 2020 2020 2020  tdir).          
-000434d0: 2020 7265 7475 726e 0a0a 2020 2020 2020    return..      
-000434e0: 2020 2320 4f74 6865 7277 6973 652c 2077    # Otherwise, w
-000434f0: 7269 7465 2074 6f20 696e 6469 7669 6475  rite to individu
-00043500: 616c 2052 4f49 2066 696c 6573 0a20 2020  al ROI files.   
-00043510: 2020 2020 2069 6620 6e6f 7420 6f73 2e70       if not os.p
-00043520: 6174 682e 6578 6973 7473 286f 7574 6469  ath.exists(outdi
-00043530: 7229 3a0a 2020 2020 2020 2020 2020 2020  r):.            
-00043540: 6f73 2e6d 616b 6564 6972 7328 6f75 7464  os.makedirs(outd
-00043550: 6972 290a 2020 2020 2020 2020 656c 6966  ir).        elif
-00043560: 206f 7665 7277 7269 7465 3a0a 2020 2020   overwrite:.    
-00043570: 2020 2020 2020 2020 7368 7574 696c 2e72          shutil.r
-00043580: 6d74 7265 6528 6f75 7464 6972 290a 2020  mtree(outdir).  
-00043590: 2020 2020 2020 2020 2020 6f73 2e6d 6b64            os.mkd
-000435a0: 6972 286f 7574 6469 7229 0a20 2020 2020  ir(outdir).     
-000435b0: 2020 2066 6f72 2073 2069 6e20 7365 6c66     for s in self
-000435c0: 2e67 6574 5f72 6f69 7328 293a 0a20 2020  .get_rois():.   
-000435d0: 2020 2020 2020 2020 2073 2e77 7269 7465           s.write
-000435e0: 286f 7574 6469 723d 6f75 7464 6972 2c20  (outdir=outdir, 
-000435f0: 6578 743d 6578 742c 2076 6572 626f 7365  ext=ext, verbose
-00043600: 3d76 6572 626f 7365 2c20 2a2a 6b77 6172  =verbose, **kwar
-00043610: 6773 290a 2020 2020 2020 2020 2020 2020  gs).            
-00043620: 0a20 2020 2064 6566 2070 6c6f 7428 0a20  .    def plot(. 
-00043630: 2020 2020 2020 2073 656c 662c 0a20 2020         self,.   
-00043640: 2020 2020 2076 6965 773d 2278 2d79 222c       view="x-y",
-00043650: 0a20 2020 2020 2020 2070 6c6f 745f 7479  .        plot_ty
-00043660: 7065 3d4e 6f6e 652c 0a20 2020 2020 2020  pe=None,.       
-00043670: 2073 6c3d 4e6f 6e65 2c0a 2020 2020 2020   sl=None,.      
-00043680: 2020 6964 783d 4e6f 6e65 2c0a 2020 2020    idx=None,.    
-00043690: 2020 2020 706f 733d 4e6f 6e65 2c0a 2020      pos=None,.  
-000436a0: 2020 2020 2020 6178 3d4e 6f6e 652c 0a20        ax=None,. 
-000436b0: 2020 2020 2020 206f 7061 6369 7479 3d4e         opacity=N
-000436c0: 6f6e 652c 0a20 2020 2020 2020 206c 696e  one,.        lin
-000436d0: 6577 6964 7468 3d4e 6f6e 652c 0a20 2020  ewidth=None,.   
-000436e0: 2020 2020 2069 6e63 6c75 6465 5f69 6d61       include_ima
-000436f0: 6765 3d54 7275 652c 0a20 2020 2020 2020  ge=True,.       
-00043700: 2063 656e 7472 655f 6f6e 5f72 6f69 3d4e   centre_on_roi=N
-00043710: 6f6e 652c 0a20 2020 2020 2020 2073 686f  one,.        sho
-00043720: 773d 5472 7565 2c0a 2020 2020 2020 2020  w=True,.        
-00043730: 7361 7665 5f61 733d 4e6f 6e65 2c0a 2020  save_as=None,.  
-00043740: 2020 2020 2020 6c65 6765 6e64 3d46 616c        legend=Fal
-00043750: 7365 2c0a 2020 2020 2020 2020 6c65 6765  se,.        lege
-00043760: 6e64 5f62 626f 785f 746f 5f61 6e63 686f  nd_bbox_to_ancho
-00043770: 723d 4e6f 6e65 2c0a 2020 2020 2020 2020  r=None,.        
-00043780: 6c65 6765 6e64 5f6c 6f63 3d22 6c6f 7765  legend_loc="lowe
-00043790: 7220 6c65 6674 222c 0a20 2020 2020 2020  r left",.       
-000437a0: 2063 6f6e 7365 6e73 7573 5f74 7970 653d   consensus_type=
-000437b0: 4e6f 6e65 2c0a 2020 2020 2020 2020 6578  None,.        ex
-000437c0: 636c 7564 655f 6672 6f6d 5f63 6f6e 7365  clude_from_conse
-000437d0: 6e73 7573 3d4e 6f6e 652c 0a20 2020 2020  nsus=None,.     
-000437e0: 2020 2063 6f6e 7365 6e73 7573 5f63 6f6c     consensus_col
-000437f0: 6f72 3d22 626c 7565 222c 0a20 2020 2020  or="blue",.     
-00043800: 2020 2063 6f6e 7365 6e73 7573 5f6c 696e     consensus_lin
-00043810: 6577 6964 7468 3d4e 6f6e 652c 0a20 2020  ewidth=None,.   
-00043820: 2020 2020 202a 2a6b 7761 7267 732c 0a20       **kwargs,. 
-00043830: 2020 2029 3a0a 2020 2020 2020 2020 2222     ):.        ""
-00043840: 2250 6c6f 7420 7468 6520 524f 4973 2069  "Plot the ROIs i
-00043850: 6e20 7468 6973 2073 7472 7563 7475 7265  n this structure
-00043860: 2073 6574 2e0a 2020 2020 2020 200a 2020   set..       .  
-00043870: 2020 2020 2020 4966 2063 6f6e 7365 6e73        If consens
-00043880: 7573 5f74 7970 6520 6973 2073 6574 2074  us_type is set t
-00043890: 6f20 616e 7920 6f66 2027 6d61 6a6f 7269  o any of 'majori
-000438a0: 7479 272c 2027 7375 6d27 2c20 276f 7665  ty', 'sum', 'ove
-000438b0: 726c 6170 272c 206f 7220 2773 7461 706c  rlap', or 'stapl
-000438c0: 6527 2c0a 2020 2020 2020 2020 7468 6520  e',.        the 
-000438d0: 636f 6e65 6e73 7573 2063 6f6e 746f 7572  conensus contour
-000438e0: 2077 696c 6c20 6265 2070 6c6f 7474 6564   will be plotted
-000438f0: 2072 6174 6865 7220 7468 616e 2069 6e64   rather than ind
-00043900: 6976 6964 7561 6c20 524f 4973 2e20 4966  ividual ROIs. If
-00043910: 0a20 2020 2020 2020 2027 6578 636c 7564  .        'exclud
-00043920: 655f 6672 6f6d 5f63 6f6e 7365 6e73 7573  e_from_consensus
-00043930: 2720 6973 2073 6574 2074 6f20 7468 6520  ' is set to the 
-00043940: 6e61 6d65 206f 6620 616e 2052 4f49 2c20  name of an ROI, 
-00043950: 7468 6174 2052 4f49 2077 696c 6c0a 2020  that ROI will.  
-00043960: 2020 2020 2020 6265 2065 7863 6c75 6465        be exclude
-00043970: 6420 6672 6f6d 2074 6865 2063 6f6e 7365  d from the conse
-00043980: 6e73 7573 2063 616c 6375 6c61 7469 6f6e  nsus calculation
-00043990: 2061 6e64 2070 6c6f 7474 6564 2069 6e64   and plotted ind
-000439a0: 6976 6964 7561 6c6c 792e 0a20 2020 2020  ividually..     
-000439b0: 2020 2022 2222 0a0a 2020 2020 2020 2020     """..        
-000439c0: 2320 4966 206e 6f20 736c 2f69 6478 2f70  # If no sl/idx/p
-000439d0: 6f73 2067 6976 656e 2c20 7573 6520 7468  os given, use th
-000439e0: 6520 736c 6963 6520 7769 7468 2074 6865  e slice with the
-000439f0: 206d 6f73 7420 524f 4973 0a20 2020 2020   most ROIs.     
-00043a00: 2020 2069 6620 736c 2069 7320 4e6f 6e65     if sl is None
-00043a10: 2061 6e64 2069 6478 2069 7320 4e6f 6e65   and idx is None
-00043a20: 2061 6e64 2070 6f73 2069 7320 4e6f 6e65   and pos is None
-00043a30: 3a0a 2020 2020 2020 2020 2020 2020 6964  :.            id
-00043a40: 7820 3d20 7365 6c66 2e67 6574 5f6d 6964  x = self.get_mid
-00043a50: 5f69 6478 2876 6965 7729 0a0a 2020 2020  _idx(view)..    
-00043a60: 2020 2020 2320 456e 7375 7265 2074 6861      # Ensure tha
-00043a70: 7420 6c69 6e65 7769 6474 6820 616e 6420  t linewidth and 
-00043a80: 6f70 6163 6974 7920 666f 7220 524f 4920  opacity for ROI 
-00043a90: 706c 6f74 7469 6e67 2061 7265 2064 6566  plotting are def
-00043aa0: 696e 6564 2e0a 2020 2020 2020 2020 726f  ined..        ro
-00043ab0: 695f 6b77 6172 6773 203d 207b 7d0a 2020  i_kwargs = {}.  
-00043ac0: 2020 2020 2020 706c 6f74 5f74 7970 6520        plot_type 
-00043ad0: 3d20 706c 6f74 5f74 7970 6520 6f72 206b  = plot_type or k
-00043ae0: 7761 7267 732e 6765 7428 2272 6f69 5f70  wargs.get("roi_p
-00043af0: 6c6f 745f 7479 7065 222c 2022 636f 6e74  lot_type", "cont
-00043b00: 6f75 7222 290a 2020 2020 2020 2020 726f  our").        ro
-00043b10: 695f 6b77 6172 6773 5b22 726f 695f 706c  i_kwargs["roi_pl
-00043b20: 6f74 5f74 7970 6522 5d20 3d20 706c 6f74  ot_type"] = plot
-00043b30: 5f74 7970 650a 2020 2020 2020 2020 6966  _type.        if
-00043b40: 206f 7061 6369 7479 2069 7320 4e6f 6e65   opacity is None
-00043b50: 3a0a 2020 2020 2020 2020 2020 2020 6f70  :.            op
-00043b60: 6163 6974 7920 3d20 302e 3320 6966 2022  acity = 0.3 if "
-00043b70: 6669 6c6c 6564 2220 696e 2070 6c6f 745f  filled" in plot_
-00043b80: 7479 7065 2065 6c73 6520 310a 2020 2020  type else 1.    
-00043b90: 2020 2020 726f 695f 6b77 6172 6773 5b22      roi_kwargs["
-00043ba0: 6f70 6163 6974 7922 5d20 3d20 6f70 6163  opacity"] = opac
-00043bb0: 6974 790a 2020 2020 2020 2020 6966 206c  ity.        if l
-00043bc0: 696e 6577 6964 7468 2069 7320 4e6f 6e65  inewidth is None
-00043bd0: 3a0a 2020 2020 2020 2020 2020 2020 6c69  :.            li
-00043be0: 6e65 7769 6474 6820 3d20 6465 6661 756c  newidth = defaul
-00043bf0: 7450 6172 616d 735b 226c 696e 6573 2e6c  tParams["lines.l
-00043c00: 696e 6577 6964 7468 225d 5b30 5d0a 2020  inewidth"][0].  
-00043c10: 2020 2020 2020 726f 695f 6b77 6172 6773        roi_kwargs
-00043c20: 5b22 6c69 6e65 7769 6474 6822 5d20 3d20  ["linewidth"] = 
-00043c30: 6c69 6e65 7769 6474 680a 0a20 2020 2020  linewidth..     
-00043c40: 2020 2023 2050 6c6f 7420 7769 7468 2069     # Plot with i
-00043c50: 6d61 6765 0a20 2020 2020 2020 2069 6620  mage.        if 
-00043c60: 696e 636c 7564 655f 696d 6167 6520 616e  include_image an
-00043c70: 6420 7365 6c66 2e69 6d61 6765 2069 7320  d self.image is 
-00043c80: 6e6f 7420 4e6f 6e65 3a0a 0a20 2020 2020  not None:..     
-00043c90: 2020 2020 2020 2073 656c 662e 696d 6167         self.imag
-00043ca0: 652e 706c 6f74 280a 2020 2020 2020 2020  e.plot(.        
-00043cb0: 2020 2020 2020 2020 7669 6577 2c0a 2020          view,.  
-00043cc0: 2020 2020 2020 2020 2020 2020 2020 736c                sl
-00043cd0: 3d73 6c2c 200a 2020 2020 2020 2020 2020  =sl, .          
-00043ce0: 2020 2020 2020 6964 783d 6964 782c 0a20        idx=idx,. 
-00043cf0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-00043d00: 6f73 3d70 6f73 2c0a 2020 2020 2020 2020  os=pos,.        
-00043d10: 2020 2020 2020 2020 726f 6973 3d73 656c          rois=sel
-00043d20: 662c 0a20 2020 2020 2020 2020 2020 2020  f,.             
-00043d30: 2020 2072 6f69 5f6b 7761 7267 733d 726f     roi_kwargs=ro
-00043d40: 695f 6b77 6172 6773 2c0a 2020 2020 2020  i_kwargs,.      
-00043d50: 2020 2020 2020 2020 2020 6365 6e74 7265            centre
-00043d60: 5f6f 6e5f 726f 693d 6365 6e74 7265 5f6f  _on_roi=centre_o
-00043d70: 6e5f 726f 692c 0a20 2020 2020 2020 2020  n_roi,.         
-00043d80: 2020 2020 2020 2073 686f 773d 7368 6f77         show=show
-00043d90: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00043da0: 2020 7361 7665 5f61 733d 7361 7665 5f61    save_as=save_a
-00043db0: 732c 0a20 2020 2020 2020 2020 2020 2020  s,.             
-00043dc0: 2020 206c 6567 656e 643d 6c65 6765 6e64     legend=legend
-00043dd0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00043de0: 2020 6c65 6765 6e64 5f62 626f 785f 746f    legend_bbox_to
-00043df0: 5f61 6e63 686f 723d 6c65 6765 6e64 5f62  _anchor=legend_b
-00043e00: 626f 785f 746f 5f61 6e63 686f 722c 0a20  box_to_anchor,. 
-00043e10: 2020 2020 2020 2020 2020 2020 2020 206c                 l
-00043e20: 6567 656e 645f 6c6f 633d 6c65 6765 6e64  egend_loc=legend
-00043e30: 5f6c 6f63 2c0a 2020 2020 2020 2020 2020  _loc,.          
-00043e40: 2020 2020 2020 636f 6e73 656e 7375 735f        consensus_
-00043e50: 7479 7065 3d63 6f6e 7365 6e73 7573 5f74  type=consensus_t
-00043e60: 7970 652c 0a20 2020 2020 2020 2020 2020  ype,.           
-00043e70: 2020 2020 2065 7863 6c75 6465 5f66 726f       exclude_fro
-00043e80: 6d5f 636f 6e73 656e 7375 733d 6578 636c  m_consensus=excl
-00043e90: 7564 655f 6672 6f6d 5f63 6f6e 7365 6e73  ude_from_consens
-00043ea0: 7573 2c0a 2020 2020 2020 2020 2020 2020  us,.            
-00043eb0: 2020 2020 6178 3d61 782c 0a20 2020 2020      ax=ax,.     
-00043ec0: 2020 2020 2020 2020 2020 202a 2a6b 7761             **kwa
-00043ed0: 7267 730a 2020 2020 2020 2020 2020 2020  rgs.            
-00043ee0: 290a 2020 2020 2020 2020 2020 2020 7265  ).            re
-00043ef0: 7475 726e 0a0a 2020 2020 2020 2020 2320  turn..        # 
-00043f00: 506c 6f74 2063 6f6e 7365 6e73 7573 0a20  Plot consensus. 
-00043f10: 2020 2020 2020 2072 6f69 5f68 616e 646c         roi_handl
-00043f20: 6573 203d 205b 5d0a 2020 2020 2020 2020  es = [].        
-00043f30: 6966 2063 6f6e 7365 6e73 7573 5f74 7970  if consensus_typ
-00043f40: 6520 6973 206e 6f74 204e 6f6e 653a 0a0a  e is not None:..
-00043f50: 2020 2020 2020 2020 2020 2020 2320 506c              # Pl
-00043f60: 6f74 2063 6f6e 7365 6e73 7573 2063 6f6e  ot consensus con
-00043f70: 746f 7572 0a20 2020 2020 2020 2020 2020  tour.           
-00043f80: 2063 6f6e 7365 6e73 7573 203d 2073 656c   consensus = sel
-00043f90: 662e 6765 745f 636f 6e73 656e 7375 7328  f.get_consensus(
-00043fa0: 636f 6e73 656e 7375 735f 7479 7065 2c20  consensus_type, 
-00043fb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00043fc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00043fd0: 2020 2020 2020 2020 2020 2020 636f 6c6f              colo
-00043fe0: 723d 636f 6e73 656e 7375 735f 636f 6c6f  r=consensus_colo
-00043ff0: 722c 0a20 2020 2020 2020 2020 2020 2020  r,.             
-00044000: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00044010: 2020 2020 2020 2020 2020 2020 2020 6578                ex
-00044020: 636c 7564 653d 6578 636c 7564 655f 6672  clude=exclude_fr
-00044030: 6f6d 5f63 6f6e 7365 6e73 7573 290a 2020  om_consensus).  
-00044040: 2020 2020 2020 2020 2020 636f 6e73 656e            consen
-00044050: 7375 735f 6b77 6172 6773 203d 207b 7d20  sus_kwargs = {} 
-00044060: 6966 2065 7863 6c75 6465 5f66 726f 6d5f  if exclude_from_
-00044070: 636f 6e73 656e 7375 7320 6973 206e 6f74  consensus is not
-00044080: 204e 6f6e 6520 5c0a 2020 2020 2020 2020   None \.        
-00044090: 2020 2020 2020 2020 2020 2020 656c 7365              else
-000440a0: 206b 7761 7267 730a 2020 2020 2020 2020   kwargs.        
-000440b0: 2020 2020 6966 2063 6f6e 7365 6e73 7573      if consensus
-000440c0: 5f6c 696e 6577 6964 7468 2069 7320 4e6f  _linewidth is No
-000440d0: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-000440e0: 2020 2020 636f 6e73 656e 7375 735f 6c69      consensus_li
-000440f0: 6e65 7769 6474 6820 3d20 6465 6661 756c  newidth = defaul
-00044100: 7450 6172 616d 735b 226c 696e 6573 2e6c  tParams["lines.l
-00044110: 696e 6577 6964 7468 225d 5b30 5d20 2b20  inewidth"][0] + 
-00044120: 310a 0a20 2020 2020 2020 2020 2020 2063  1..            c
-00044130: 6f6e 7365 6e73 7573 2e70 6c6f 7428 0a20  onsensus.plot(. 
-00044140: 2020 2020 2020 2020 2020 2020 2020 2076                 v
-00044150: 6965 772c 2073 6c3d 736c 2c20 6964 783d  iew, sl=sl, idx=
-00044160: 6964 782c 2070 6f73 3d70 6f73 2c20 706c  idx, pos=pos, pl
-00044170: 6f74 5f74 7970 653d 706c 6f74 5f74 7970  ot_type=plot_typ
-00044180: 652c 200a 2020 2020 2020 2020 2020 2020  e, .            
-00044190: 2020 2020 636f 6c6f 723d 636f 6e73 656e      color=consen
-000441a0: 7375 735f 636f 6c6f 722c 206c 696e 6577  sus_color, linew
-000441b0: 6964 7468 3d63 6f6e 7365 6e73 7573 5f6c  idth=consensus_l
-000441c0: 696e 6577 6964 7468 2c20 0a20 2020 2020  inewidth, .     
-000441d0: 2020 2020 2020 2020 2020 206f 7061 6369             opaci
-000441e0: 7479 3d6f 7061 6369 7479 2c20 7368 6f77  ty=opacity, show
-000441f0: 3d46 616c 7365 2c20 6178 3d61 782c 202a  =False, ax=ax, *
-00044200: 2a63 6f6e 7365 6e73 7573 5f6b 7761 7267  *consensus_kwarg
-00044210: 7329 0a0a 2020 2020 2020 2020 2020 2020  s)..            
-00044220: 7365 6c66 2e61 7820 3d20 636f 6e73 656e  self.ax = consen
-00044230: 7375 732e 6178 0a20 2020 2020 2020 2020  sus.ax.         
-00044240: 2020 2073 656c 662e 6669 6720 3d20 636f     self.fig = co
-00044250: 6e73 656e 7375 732e 6669 670a 0a20 2020  nsensus.fig..   
-00044260: 2020 2020 2020 2020 2069 6620 6c65 6765           if lege
-00044270: 6e64 3a0a 2020 2020 2020 2020 2020 2020  nd:.            
-00044280: 2020 2020 726f 695f 6861 6e64 6c65 732e      roi_handles.
-00044290: 6170 7065 6e64 280a 2020 2020 2020 2020  append(.        
-000442a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000442b0: 636f 6e73 656e 7375 732e 6765 745f 7061  consensus.get_pa
-000442c0: 7463 6828 706c 6f74 5f74 7970 652c 2063  tch(plot_type, c
-000442d0: 6f6e 7365 6e73 7573 5f63 6f6c 6f72 2c20  onsensus_color, 
-000442e0: 6f70 6163 6974 792c 0a20 2020 2020 2020  opacity,.       
-000442f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00044300: 2020 2020 206c 696e 6577 6964 7468 2c20       linewidth, 
-00044310: 636f 6e73 656e 7375 732e 6e61 6d65 2929  consensus.name))
-00044320: 0a0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
-00044330: 506c 6f74 2065 7863 6c75 6465 6420 524f  Plot excluded RO
-00044340: 4920 6f6e 2074 6f70 0a20 2020 2020 2020  I on top.       
-00044350: 2020 2020 2069 6620 6578 636c 7564 655f       if exclude_
-00044360: 6672 6f6d 5f63 6f6e 7365 6e73 7573 2069  from_consensus i
-00044370: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
-00044380: 2020 2020 2020 2020 2020 2020 6b77 6172              kwar
-00044390: 6773 5b22 696e 636c 7564 655f 696d 6167  gs["include_imag
-000443a0: 6522 5d20 3d20 4661 6c73 650a 2020 2020  e"] = False.    
-000443b0: 2020 2020 2020 2020 2020 2020 6578 636c              excl
-000443c0: 7564 6564 203d 2073 656c 662e 6765 745f  uded = self.get_
-000443d0: 726f 6928 6578 636c 7564 655f 6672 6f6d  roi(exclude_from
-000443e0: 5f63 6f6e 7365 6e73 7573 290a 2020 2020  _consensus).    
-000443f0: 2020 2020 2020 2020 2020 2020 6578 636c              excl
-00044400: 7564 6564 2e70 6c6f 7428 7669 6577 2c20  uded.plot(view, 
-00044410: 736c 3d73 6c2c 2069 6478 3d69 6478 2c20  sl=sl, idx=idx, 
-00044420: 706f 733d 706f 732c 2070 6c6f 745f 7479  pos=pos, plot_ty
-00044430: 7065 3d70 6c6f 745f 7479 7065 2c0a 2020  pe=plot_type,.  
+00042480: 2020 2020 2020 2020 2020 2063 6f6e 7365             conse
+00042490: 6e73 7573 5f63 6f6c 6f72 3d22 626c 7565  nsus_color="blue
+000424a0: 2229 3a0a 2020 2020 2020 2020 2222 2247  "):.        """G
+000424b0: 6574 206c 6973 7420 6f66 2052 4f49 7320  et list of ROIs 
+000424c0: 746f 2063 6f6d 7061 7265 2077 6974 6820  to compare with 
+000424d0: 6f6e 6520 616e 6f74 6865 722e 2222 220a  one another.""".
+000424e0: 0a20 2020 2020 2020 2023 2043 6865 636b  .        # Check
+000424f0: 2063 6f6d 705f 7479 7065 2069 7320 7661   comp_type is va
+00042500: 6c69 640a 2020 2020 2020 2020 7661 6c69  lid.        vali
+00042510: 645f 636f 6d70 5f74 7970 6573 203d 205b  d_comp_types = [
+00042520: 2261 6c6c 222c 2022 6279 5f6e 616d 6522  "all", "by_name"
+00042530: 2c20 2263 6f6e 7365 6e73 7573 222c 2022  , "consensus", "
+00042540: 6175 746f 225d 0a20 2020 2020 2020 2069  auto"].        i
+00042550: 6620 636f 6d70 5f74 7970 6520 6e6f 7420  f comp_type not 
+00042560: 696e 2076 616c 6964 5f63 6f6d 705f 7479  in valid_comp_ty
+00042570: 7065 733a 0a20 2020 2020 2020 2020 2020  pes:.           
+00042580: 2072 6169 7365 2056 616c 7565 4572 726f   raise ValueErro
+00042590: 7228 6622 556e 7265 636f 676e 6973 6564  r(f"Unrecognised
+000425a0: 2063 6f6d 7061 7269 736f 6e20 7479 7065   comparison type
+000425b0: 207b 636f 6d70 5f74 7970 657d 2229 0a0a   {comp_type}")..
+000425c0: 2020 2020 2020 2020 2320 436f 6e73 656e          # Consen
+000425d0: 7375 7320 636f 6d70 6172 6973 6f6e 0a20  sus comparison. 
+000425e0: 2020 2020 2020 2069 6620 636f 6d70 5f74         if comp_t
+000425f0: 7970 6520 3d3d 2022 636f 6e73 656e 7375  ype == "consensu
+00042600: 7322 3a0a 2020 2020 2020 2020 2020 2020  s":.            
+00042610: 0a20 2020 2020 2020 2020 2020 2023 2049  .            # I
+00042620: 6620 636f 6d70 6172 696e 6720 746f 2061  f comparing to a
+00042630: 6e6f 7468 6572 2053 7472 7563 7475 7265  nother Structure
+00042640: 5365 742c 2074 616b 6520 636f 6e73 656e  Set, take consen
+00042650: 7375 7320 6f66 2074 6861 7420 0a20 2020  sus of that .   
+00042660: 2020 2020 2020 2020 2023 2065 6e74 6972           # entir
+00042670: 6520 5374 7275 6374 7572 6553 6574 0a20  e StructureSet. 
+00042680: 2020 2020 2020 2020 2020 2069 6620 6f74             if ot
+00042690: 6865 7220 6973 206e 6f74 204e 6f6e 653a  her is not None:
+000426a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000426b0: 2063 6f6e 7365 6e73 7573 203d 206f 7468   consensus = oth
+000426c0: 6572 2e67 6574 5f63 6f6e 7365 6e73 7573  er.get_consensus
+000426d0: 2863 6f6e 7365 6e73 7573 5f74 7970 652c  (consensus_type,
+000426e0: 2063 6f6c 6f72 3d63 6f6e 7365 6e73 7573   color=consensus
+000426f0: 5f63 6f6c 6f72 290a 2020 2020 2020 2020  _color).        
+00042700: 2020 2020 2020 2020 7265 7475 726e 205b          return [
+00042710: 2872 6f69 2c20 636f 6e73 656e 7375 7329  (roi, consensus)
+00042720: 2066 6f72 2072 6f69 2069 6e20 7365 6c66   for roi in self
+00042730: 2e67 6574 5f72 6f69 7328 6967 6e6f 7265  .get_rois(ignore
+00042740: 5f65 6d70 7479 3d54 7275 6529 5d0a 0a20  _empty=True)].. 
+00042750: 2020 2020 2020 2020 2020 2023 204f 7468             # Oth
+00042760: 6572 7769 7365 2c20 636f 6d70 6172 6520  erwise, compare 
+00042770: 6561 6368 2052 4f49 2074 6f20 636f 6e73  each ROI to cons
+00042780: 656e 7375 7320 6f66 206f 7468 6572 730a  ensus of others.
+00042790: 2020 2020 2020 2020 2020 2020 7061 6972              pair
+000427a0: 7320 3d20 5b5d 0a20 2020 2020 2020 2020  s = [].         
+000427b0: 2020 2066 6f72 2072 6f69 2069 6e20 7365     for roi in se
+000427c0: 6c66 2e67 6574 5f72 6f69 7328 6967 6e6f  lf.get_rois(igno
+000427d0: 7265 5f65 6d70 7479 3d54 7275 6529 3a0a  re_empty=True):.
+000427e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000427f0: 7061 6972 732e 6170 7065 6e64 2828 726f  pairs.append((ro
+00042800: 692c 2073 656c 662e 6765 745f 636f 6e73  i, self.get_cons
+00042810: 656e 7375 7328 636f 6e73 656e 7375 735f  ensus(consensus_
+00042820: 7479 7065 2c20 0a20 2020 2020 2020 2020  type, .         
+00042830: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00042840: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00042850: 2020 2020 2020 2020 2020 2020 2063 6f6c               col
+00042860: 6f72 3d63 6f6e 7365 6e73 7573 5f63 6f6c  or=consensus_col
+00042870: 6f72 2c0a 2020 2020 2020 2020 2020 2020  or,.            
+00042880: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00042890: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000428a0: 2020 2020 2020 2020 2020 6578 636c 7564            exclud
+000428b0: 653d 726f 692e 6e61 6d65 2929 290a 2020  e=roi.name))).  
+000428c0: 2020 2020 2020 2020 2020 7265 7475 726e            return
+000428d0: 2070 6169 7273 0a0a 2020 2020 2020 2020   pairs..        
+000428e0: 2320 5365 7420 6465 6661 756c 7420 6265  # Set default be
+000428f0: 6861 7669 6f75 7220 746f 2022 616c 6c22  haviour to "all"
+00042900: 2069 6620 6f74 6865 7220 6973 204e 6f6e   if other is Non
+00042910: 650a 2020 2020 2020 2020 6966 206f 7468  e.        if oth
+00042920: 6572 2069 7320 4e6f 6e65 3a0a 2020 2020  er is None:.    
+00042930: 2020 2020 2020 2020 6f74 6865 7220 3d20          other = 
+00042940: 7365 6c66 0a20 2020 2020 2020 2020 2020  self.           
+00042950: 2069 6620 636f 6d70 5f74 7970 6520 3d3d   if comp_type ==
+00042960: 2022 6175 746f 223a 0a20 2020 2020 2020   "auto":.       
+00042970: 2020 2020 2020 2020 2063 6f6d 705f 7479           comp_ty
+00042980: 7065 203d 2022 616c 6c22 0a0a 2020 2020  pe = "all"..    
+00042990: 2020 2020 2320 4368 6563 6b20 666f 7220      # Check for 
+000429a0: 524f 4973 2077 6974 6820 6d61 7463 6869  ROIs with matchi
+000429b0: 6e67 206e 616d 6573 2069 6620 7573 696e  ng names if usin
+000429c0: 6720 2261 7574 6f22 206f 7220 2262 795f  g "auto" or "by_
+000429d0: 6e61 6d65 220a 2020 2020 2020 2020 6d61  name".        ma
+000429e0: 7463 6865 7320 3d20 5b5d 0a20 2020 2020  tches = [].     
+000429f0: 2020 2069 6620 636f 6d70 5f74 7970 6520     if comp_type 
+00042a00: 696e 205b 2261 7574 6f22 2c20 2262 795f  in ["auto", "by_
+00042a10: 6e61 6d65 225d 3a0a 2020 2020 2020 2020  name"]:.        
+00042a20: 2020 2020 6d61 7463 6865 7320 3d20 5b0a      matches = [.
+00042a30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00042a40: 7320 666f 7220 7320 696e 2073 656c 662e  s for s in self.
+00042a50: 6765 745f 726f 695f 6e61 6d65 7328 6967  get_roi_names(ig
+00042a60: 6e6f 7265 5f65 6d70 7479 3d54 7275 6529  nore_empty=True)
+00042a70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00042a80: 2069 6620 7320 696e 206f 7468 6572 2e67   if s in other.g
+00042a90: 6574 5f72 6f69 5f6e 616d 6573 2869 676e  et_roi_names(ign
+00042aa0: 6f72 655f 656d 7074 793d 5472 7565 290a  ore_empty=True).
+00042ab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00042ac0: 5d0a 2020 2020 2020 2020 2020 2020 6966  ].            if
+00042ad0: 206c 656e 286d 6174 6368 6573 2920 6f72   len(matches) or
+00042ae0: 2063 6f6d 705f 7479 7065 203d 3d20 2262   comp_type == "b
+00042af0: 795f 6e61 6d65 223a 0a20 2020 2020 2020  y_name":.       
+00042b00: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00042b10: 5b0a 2020 2020 2020 2020 2020 2020 2020  [.              
+00042b20: 2020 2020 2020 2873 656c 662e 6765 745f        (self.get_
+00042b30: 726f 6928 6e61 6d65 292c 206f 7468 6572  roi(name), other
+00042b40: 2e67 6574 5f72 6f69 286e 616d 6529 2920  .get_roi(name)) 
+00042b50: 666f 7220 6e61 6d65 2069 6e20 6d61 7463  for name in matc
+00042b60: 6865 730a 2020 2020 2020 2020 2020 2020  hes.            
+00042b70: 2020 2020 5d0a 0a20 2020 2020 2020 2023      ]..        #
+00042b80: 204f 7468 6572 7769 7365 2c20 7061 6972   Otherwise, pair
+00042b90: 2065 6163 6820 524f 4920 7769 7468 2065   each ROI with e
+00042ba0: 7665 7279 206f 7468 6572 2028 6578 6c63  very other (exlc
+00042bb0: 7564 696e 6720 7061 6972 7320 6f66 2074  uding pairs of t
+00042bc0: 6865 2073 616d 650a 2020 2020 2020 2020  he same.        
+00042bd0: 2320 524f 4929 0a20 2020 2020 2020 2070  # ROI).        p
+00042be0: 6169 7273 203d 205b 5d0a 2020 2020 2020  airs = [].      
+00042bf0: 2020 666f 7220 726f 6931 2069 6e20 7365    for roi1 in se
+00042c00: 6c66 2e67 6574 5f72 6f69 7328 6967 6e6f  lf.get_rois(igno
+00042c10: 7265 5f65 6d70 7479 3d54 7275 6529 3a0a  re_empty=True):.
+00042c20: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+00042c30: 726f 6932 2069 6e20 6f74 6865 722e 6765  roi2 in other.ge
+00042c40: 745f 726f 6973 2869 676e 6f72 655f 656d  t_rois(ignore_em
+00042c50: 7074 793d 5472 7565 293a 0a20 2020 2020  pty=True):.     
+00042c60: 2020 2020 2020 2020 2020 2069 6620 726f             if ro
+00042c70: 6931 2069 7320 6e6f 7420 726f 6932 2061  i1 is not roi2 a
+00042c80: 6e64 2028 726f 6932 2c20 726f 6931 2920  nd (roi2, roi1) 
+00042c90: 6e6f 7420 696e 2070 6169 7273 3a0a 2020  not in pairs:.  
+00042ca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00042cb0: 2020 7061 6972 732e 6170 7065 6e64 2828    pairs.append((
+00042cc0: 726f 6931 2c20 726f 6932 2929 0a0a 2020  roi1, roi2))..  
+00042cd0: 2020 2020 2020 7265 7475 726e 2070 6169        return pai
+00042ce0: 7273 0a0a 2020 2020 6465 6620 6765 745f  rs..    def get_
+00042cf0: 6d69 645f 6964 7828 7365 6c66 2c20 7669  mid_idx(self, vi
+00042d00: 6577 3d22 782d 7922 293a 0a20 2020 2020  ew="x-y"):.     
+00042d10: 2020 2022 2222 5265 7475 726e 2074 6865     """Return the
+00042d20: 2061 7272 6179 2069 6e64 6578 206f 6620   array index of 
+00042d30: 7468 6520 736c 6963 6520 7468 6174 2063  the slice that c
+00042d40: 6f6e 7461 696e 7320 7468 6520 6d6f 7374  ontains the most
+00042d50: 2052 4f49 732e 2222 220a 0a20 2020 2020   ROIs."""..     
+00042d60: 2020 2069 6e64 6963 6573 203d 205b 5d0a     indices = [].
+00042d70: 2020 2020 2020 2020 666f 7220 726f 6920          for roi 
+00042d80: 696e 2073 656c 662e 6765 745f 726f 6973  in self.get_rois
+00042d90: 2869 676e 6f72 655f 656d 7074 793d 5472  (ignore_empty=Tr
+00042da0: 7565 293a 0a20 2020 2020 2020 2020 2020  ue):.           
+00042db0: 2069 6e64 6963 6573 2e65 7874 656e 6428   indices.extend(
+00042dc0: 726f 692e 6765 745f 696e 6469 6365 7328  roi.get_indices(
+00042dd0: 7669 6577 2929 0a20 2020 2020 2020 2072  view)).        r
+00042de0: 6574 7572 6e20 6e70 2e62 696e 636f 756e  eturn np.bincoun
+00042df0: 7428 696e 6469 6365 7329 2e61 7267 6d61  t(indices).argma
+00042e00: 7828 290a 0a20 2020 2064 6566 2070 6c6f  x()..    def plo
+00042e10: 745f 636f 6d70 6172 6973 6f6e 7328 0a20  t_comparisons(. 
+00042e20: 2020 2020 2020 2073 656c 662c 206f 7468         self, oth
+00042e30: 6572 3d4e 6f6e 652c 2063 6f6d 705f 7479  er=None, comp_ty
+00042e40: 7065 3d22 6175 746f 222c 206f 7574 6469  pe="auto", outdi
+00042e50: 723d 4e6f 6e65 2c20 6c65 6765 6e64 3d54  r=None, legend=T
+00042e60: 7275 652c 200a 2020 2020 2020 2020 6e61  rue, .        na
+00042e70: 6d65 733d 4e6f 6e65 2c20 6c65 6765 6e64  mes=None, legend
+00042e80: 5f62 626f 785f 746f 5f61 6e63 686f 723d  _bbox_to_anchor=
+00042e90: 4e6f 6e65 2c20 6c65 6765 6e64 5f6c 6f63  None, legend_loc
+00042ea0: 3d22 6c6f 7765 7220 6c65 6674 222c 0a20  ="lower left",. 
+00042eb0: 2020 2020 2020 202a 2a6b 7761 7267 730a         **kwargs.
+00042ec0: 2020 2020 293a 0a20 2020 2020 2020 2022      ):.        "
+00042ed0: 2222 506c 6f74 2063 6f6d 7061 7269 736f  ""Plot compariso
+00042ee0: 6e20 7061 6972 732e 2222 220a 0a20 2020  n pairs."""..   
+00042ef0: 2020 2020 2069 6620 6f75 7464 6972 2061       if outdir a
+00042f00: 6e64 206e 6f74 206f 732e 7061 7468 2e65  nd not os.path.e
+00042f10: 7869 7374 7328 6f75 7464 6972 293a 0a20  xists(outdir):. 
+00042f20: 2020 2020 2020 2020 2020 206f 732e 6d61             os.ma
+00042f30: 6b65 6469 7273 286f 7574 6469 7229 0a0a  kedirs(outdir)..
+00042f40: 2020 2020 2020 2020 666f 7220 726f 6931          for roi1
+00042f50: 2c20 726f 6932 2069 6e20 7365 6c66 2e67  , roi2 in self.g
+00042f60: 6574 5f63 6f6d 7061 7269 736f 6e5f 7061  et_comparison_pa
+00042f70: 6972 7328 6f74 6865 722c 2063 6f6d 705f  irs(other, comp_
+00042f80: 7479 7065 293a 0a0a 2020 2020 2020 2020  type):..        
+00042f90: 2020 2020 6f75 746e 616d 6520 3d20 4e6f      outname = No
+00042fa0: 6e65 0a20 2020 2020 2020 2020 2020 2069  ne.            i
+00042fb0: 6620 6f75 7464 6972 3a0a 2020 2020 2020  f outdir:.      
+00042fc0: 2020 2020 2020 2020 2020 636f 6d70 5f6e            comp_n
+00042fd0: 616d 6520 3d20 726f 6931 2e67 6574 5f63  ame = roi1.get_c
+00042fe0: 6f6d 7061 7269 736f 6e5f 6e61 6d65 2872  omparison_name(r
+00042ff0: 6f69 322c 2054 7275 6529 0a20 2020 2020  oi2, True).     
+00043000: 2020 2020 2020 2020 2020 206f 7574 6e61             outna
+00043010: 6d65 203d 206f 732e 7061 7468 2e6a 6f69  me = os.path.joi
+00043020: 6e28 6f75 7464 6972 2c20 6622 7b63 6f6d  n(outdir, f"{com
+00043030: 705f 6e61 6d65 7d2e 706e 6722 290a 0a20  p_name}.png").. 
+00043040: 2020 2020 2020 2020 2020 2069 6620 6e61             if na
+00043050: 6d65 7320 6973 204e 6f6e 6520 616e 6420  mes is None and 
+00043060: 726f 6931 2e6e 616d 6520 3d3d 2072 6f69  roi1.name == roi
+00043070: 322e 6e61 6d65 3a0a 2020 2020 2020 2020  2.name:.        
+00043080: 2020 2020 2020 2020 6e61 6d65 7320 3d20          names = 
+00043090: 5b73 656c 662e 6e61 6d65 2c20 6f74 6865  [self.name, othe
+000430a0: 722e 6e61 6d65 5d0a 0a20 2020 2020 2020  r.name]..       
+000430b0: 2020 2020 2072 6f69 312e 706c 6f74 5f63       roi1.plot_c
+000430c0: 6f6d 7061 7269 736f 6e28 0a20 2020 2020  omparison(.     
+000430d0: 2020 2020 2020 2020 2020 2072 6f69 322c             roi2,
+000430e0: 206c 6567 656e 643d 6c65 6765 6e64 2c20   legend=legend, 
+000430f0: 7361 7665 5f61 733d 6f75 746e 616d 652c  save_as=outname,
+00043100: 206e 616d 6573 3d6e 616d 6573 2c0a 2020   names=names,.  
+00043110: 2020 2020 2020 2020 2020 2020 2020 6c65                le
+00043120: 6765 6e64 5f62 626f 785f 746f 5f61 6e63  gend_bbox_to_anc
+00043130: 686f 723d 6c65 6765 6e64 5f62 626f 785f  hor=legend_bbox_
+00043140: 746f 5f61 6e63 686f 722c 0a20 2020 2020  to_anchor,.     
+00043150: 2020 2020 2020 2020 2020 206c 6567 656e             legen
+00043160: 645f 6c6f 633d 6c65 6765 6e64 5f6c 6f63  d_loc=legend_loc
+00043170: 2c20 2a2a 6b77 6172 6773 0a20 2020 2020  , **kwargs.     
+00043180: 2020 2020 2020 2029 0a0a 2020 2020 6465         )..    de
+00043190: 6620 706c 6f74 5f73 7572 6661 6365 5f64  f plot_surface_d
+000431a0: 6973 7461 6e63 6573 280a 2020 2020 2020  istances(.      
+000431b0: 2020 7365 6c66 2c20 6f74 6865 722c 206f    self, other, o
+000431c0: 7574 6469 723d 4e6f 6e65 2c20 7369 676e  utdir=None, sign
+000431d0: 6564 3d46 616c 7365 2c20 636f 6d70 5f74  ed=False, comp_t
+000431e0: 7970 653d 2261 7574 6f22 2c20 2a2a 6b77  ype="auto", **kw
+000431f0: 6172 6773 0a20 2020 2029 3a0a 2020 2020  args.    ):.    
+00043200: 2020 2020 2222 2250 6c6f 7420 7375 7266      """Plot surf
+00043210: 6163 6520 6469 7374 616e 6365 7320 666f  ace distances fo
+00043220: 7220 616c 6c20 524f 4920 7061 6972 732e  r all ROI pairs.
+00043230: 2222 220a 0a20 2020 2020 2020 2069 6620  """..        if 
+00043240: 6e6f 7420 6f73 2e70 6174 682e 6578 6973  not os.path.exis
+00043250: 7473 286f 7574 6469 7229 3a0a 2020 2020  ts(outdir):.    
+00043260: 2020 2020 2020 2020 6f73 2e6d 616b 6564          os.maked
+00043270: 6972 7328 6f75 7464 6972 290a 0a20 2020  irs(outdir)..   
+00043280: 2020 2020 2066 6f72 2072 6f69 312c 2072       for roi1, r
+00043290: 6f69 3220 696e 2073 656c 662e 6765 745f  oi2 in self.get_
+000432a0: 636f 6d70 6172 6973 6f6e 5f70 6169 7273  comparison_pairs
+000432b0: 286f 7468 6572 2c20 636f 6d70 5f74 7970  (other, comp_typ
+000432c0: 6529 3a0a 2020 2020 2020 2020 2020 2020  e):.            
+000432d0: 636f 6d70 5f6e 616d 6520 3d20 726f 6931  comp_name = roi1
+000432e0: 2e67 6574 5f63 6f6d 7061 7269 736f 6e5f  .get_comparison_
+000432f0: 6e61 6d65 2872 6f69 322c 2054 7275 6529  name(roi2, True)
+00043300: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00043310: 6f75 7464 6972 3a0a 2020 2020 2020 2020  outdir:.        
+00043320: 2020 2020 2020 2020 6f75 746e 616d 6520          outname 
+00043330: 3d20 6f73 2e70 6174 682e 6a6f 696e 286f  = os.path.join(o
+00043340: 7574 6469 722c 2066 227b 636f 6d70 5f6e  utdir, f"{comp_n
+00043350: 616d 657d 2e70 6e67 2229 0a20 2020 2020  ame}.png").     
+00043360: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+00043370: 2020 2020 2020 2020 2020 2020 206f 7574               out
+00043380: 6e61 6d65 203d 204e 6f6e 650a 2020 2020  name = None.    
+00043390: 2020 2020 2020 2020 726f 6931 2e70 6c6f          roi1.plo
+000433a0: 745f 7375 7266 6163 655f 6469 7374 616e  t_surface_distan
+000433b0: 6365 7328 726f 6932 2c20 7369 676e 6564  ces(roi2, signed
+000433c0: 3d73 6967 6e65 642c 2073 6176 655f 6173  =signed, save_as
+000433d0: 3d6f 7574 6e61 6d65 2c20 2a2a 6b77 6172  =outname, **kwar
+000433e0: 6773 290a 0a20 2020 2064 6566 2077 7269  gs)..    def wri
+000433f0: 7465 2873 656c 662c 206f 7574 6e61 6d65  te(self, outname
+00043400: 3d4e 6f6e 652c 206f 7574 6469 723d 222e  =None, outdir=".
+00043410: 222c 2065 7874 3d4e 6f6e 652c 206f 7665  ", ext=None, ove
+00043420: 7277 7269 7465 3d46 616c 7365 2c0a 2020  rwrite=False,.  
+00043430: 2020 2020 2020 2020 2020 6865 6164 6572            header
+00043440: 5f73 6f75 7263 653d 4e6f 6e65 2c20 7061  _source=None, pa
+00043450: 7469 656e 745f 6964 3d4e 6f6e 652c 206d  tient_id=None, m
+00043460: 6f64 616c 6974 793d 4e6f 6e65 2c0a 2020  odality=None,.  
+00043470: 2020 2020 2020 2020 2020 726f 6f74 5f75            root_u
+00043480: 6964 3d4e 6f6e 652c 2076 6572 626f 7365  id=None, verbose
+00043490: 3d54 7275 652c 2068 6561 6465 725f 6578  =True, header_ex
+000434a0: 7472 6173 3d7b 7d2c 202a 2a6b 7761 7267  tras={}, **kwarg
+000434b0: 7329 3a0a 2020 2020 2020 2020 2222 2257  s):.        """W
+000434c0: 7269 7465 2074 6f20 6120 6469 636f 6d20  rite to a dicom 
+000434d0: 5374 7275 6374 7572 6553 6574 2066 696c  StructureSet fil
+000434e0: 6520 6f72 2064 6972 6563 746f 7279 206f  e or directory o
+000434f0: 6620 6e69 6674 6920 6669 6c65 732e 2222  f nifti files.""
+00043500: 220a 0a20 2020 2020 2020 2069 6620 6578  "..        if ex
+00043510: 7420 6973 206e 6f74 204e 6f6e 6520 616e  t is not None an
+00043520: 6420 6e6f 7420 6578 742e 7374 6172 7473  d not ext.starts
+00043530: 7769 7468 2822 2e22 293a 0a20 2020 2020  with("."):.     
+00043540: 2020 2020 2020 2065 7874 203d 2066 222e         ext = f".
+00043550: 7b65 7874 7d22 0a0a 2020 2020 2020 2020  {ext}"..        
+00043560: 2320 4368 6563 6b20 7768 6574 6865 7220  # Check whether 
+00043570: 746f 2077 7269 7465 2074 6f20 6469 636f  to write to dico
+00043580: 6d20 6669 6c65 0a20 2020 2020 2020 2069  m file.        i
+00043590: 6620 6973 696e 7374 616e 6365 286f 7574  f isinstance(out
+000435a0: 6e61 6d65 2c20 7374 7229 2061 6e64 206f  name, str) and o
+000435b0: 7574 6e61 6d65 2e65 6e64 7377 6974 6828  utname.endswith(
+000435c0: 222e 6463 6d22 293a 0a20 2020 2020 2020  ".dcm"):.       
+000435d0: 2020 2020 2065 7874 203d 2022 2e64 636d       ext = ".dcm
+000435e0: 220a 0a20 2020 2020 2020 2069 6620 6578  "..        if ex
+000435f0: 7420 3d3d 2022 2e64 636d 223a 0a20 2020  t == ".dcm":.   
+00043600: 2020 2020 2020 2020 2064 6963 6f6d 5f77           dicom_w
+00043610: 7269 7465 7220 3d20 4469 636f 6d57 7269  riter = DicomWri
+00043620: 7465 7228 0a20 2020 2020 2020 2020 2020  ter(.           
+00043630: 2020 2020 206f 7574 6469 723d 6f75 7464       outdir=outd
+00043640: 6972 2c0a 2020 2020 2020 2020 2020 2020  ir,.            
+00043650: 2020 2020 6461 7461 3d73 656c 662c 0a20      data=self,. 
+00043660: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+00043670: 6666 696e 653d 4e6f 6e65 2c0a 2020 2020  ffine=None,.    
+00043680: 2020 2020 2020 2020 2020 2020 6f76 6572              over
+00043690: 7772 6974 653d 6f76 6572 7772 6974 652c  write=overwrite,
+000436a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000436b0: 2068 6561 6465 725f 736f 7572 6365 3d68   header_source=h
+000436c0: 6561 6465 725f 736f 7572 6365 2c0a 2020  eader_source,.  
+000436d0: 2020 2020 2020 2020 2020 2020 2020 6f72                or
+000436e0: 6965 6e74 6174 696f 6e3d 4e6f 6e65 2c0a  ientation=None,.
+000436f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00043700: 7061 7469 656e 745f 6964 3d70 6174 6965  patient_id=patie
+00043710: 6e74 5f69 642c 0a20 2020 2020 2020 2020  nt_id,.         
+00043720: 2020 2020 2020 206d 6f64 616c 6974 793d         modality=
+00043730: 2752 5453 5452 5543 5427 2c0a 2020 2020  'RTSTRUCT',.    
+00043740: 2020 2020 2020 2020 2020 2020 726f 6f74              root
+00043750: 5f75 6964 3d72 6f6f 745f 7569 642c 0a20  _uid=root_uid,. 
+00043760: 2020 2020 2020 2020 2020 2020 2020 2068                 h
+00043770: 6561 6465 725f 6578 7472 6173 3d68 6561  eader_extras=hea
+00043780: 6465 725f 6578 7472 6173 2c0a 2020 2020  der_extras,.    
+00043790: 2020 2020 2020 2020 2020 2020 736f 7572              sour
+000437a0: 6365 5f74 7970 653d 7479 7065 2873 656c  ce_type=type(sel
+000437b0: 6629 2e5f 5f6e 616d 655f 5f2c 0a20 2020  f).__name__,.   
+000437c0: 2020 2020 2020 2020 2020 2020 206f 7574               out
+000437d0: 6e61 6d65 203d 206f 7574 6e61 6d65 2c0a  name = outname,.
+000437e0: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+000437f0: 2020 2020 2020 2020 2020 7365 6c66 2e64            self.d
+00043800: 6963 6f6d 5f64 6174 6173 6574 203d 2064  icom_dataset = d
+00043810: 6963 6f6d 5f77 7269 7465 722e 7772 6974  icom_writer.writ
+00043820: 6528 290a 0a20 2020 2020 2020 2020 2020  e()..           
+00043830: 2069 6620 7665 7262 6f73 653a 0a20 2020   if verbose:.   
+00043840: 2020 2020 2020 2020 2020 2020 2070 7269               pri
+00043850: 6e74 2822 5772 6f74 6520 6469 636f 6d20  nt("Wrote dicom 
+00043860: 6669 6c65 2074 6f20 6469 7265 6374 6f72  file to director
+00043870: 793a 222c 206f 7574 6469 7229 0a20 2020  y:", outdir).   
+00043880: 2020 2020 2020 2020 2072 6574 7572 6e0a           return.
+00043890: 0a20 2020 2020 2020 2023 204f 7468 6572  .        # Other
+000438a0: 7769 7365 2c20 7772 6974 6520 746f 2069  wise, write to i
+000438b0: 6e64 6976 6964 7561 6c20 524f 4920 6669  ndividual ROI fi
+000438c0: 6c65 730a 2020 2020 2020 2020 6966 206e  les.        if n
+000438d0: 6f74 206f 732e 7061 7468 2e65 7869 7374  ot os.path.exist
+000438e0: 7328 6f75 7464 6972 293a 0a20 2020 2020  s(outdir):.     
+000438f0: 2020 2020 2020 206f 732e 6d61 6b65 6469         os.makedi
+00043900: 7273 286f 7574 6469 7229 0a20 2020 2020  rs(outdir).     
+00043910: 2020 2065 6c69 6620 6f76 6572 7772 6974     elif overwrit
+00043920: 653a 0a20 2020 2020 2020 2020 2020 2073  e:.            s
+00043930: 6875 7469 6c2e 726d 7472 6565 286f 7574  hutil.rmtree(out
+00043940: 6469 7229 0a20 2020 2020 2020 2020 2020  dir).           
+00043950: 206f 732e 6d6b 6469 7228 6f75 7464 6972   os.mkdir(outdir
+00043960: 290a 2020 2020 2020 2020 666f 7220 7320  ).        for s 
+00043970: 696e 2073 656c 662e 6765 745f 726f 6973  in self.get_rois
+00043980: 2829 3a0a 2020 2020 2020 2020 2020 2020  ():.            
+00043990: 732e 7772 6974 6528 6f75 7464 6972 3d6f  s.write(outdir=o
+000439a0: 7574 6469 722c 2065 7874 3d65 7874 2c20  utdir, ext=ext, 
+000439b0: 7665 7262 6f73 653d 7665 7262 6f73 652c  verbose=verbose,
+000439c0: 202a 2a6b 7761 7267 7329 0a20 2020 2020   **kwargs).     
+000439d0: 2020 2020 2020 200a 2020 2020 6465 6620         .    def 
+000439e0: 706c 6f74 280a 2020 2020 2020 2020 7365  plot(.        se
+000439f0: 6c66 2c0a 2020 2020 2020 2020 7669 6577  lf,.        view
+00043a00: 3d22 782d 7922 2c0a 2020 2020 2020 2020  ="x-y",.        
+00043a10: 706c 6f74 5f74 7970 653d 2263 6f6e 746f  plot_type="conto
+00043a20: 7572 222c 0a20 2020 2020 2020 2073 6c3d  ur",.        sl=
+00043a30: 4e6f 6e65 2c0a 2020 2020 2020 2020 6964  None,.        id
+00043a40: 783d 4e6f 6e65 2c0a 2020 2020 2020 2020  x=None,.        
+00043a50: 706f 733d 4e6f 6e65 2c0a 2020 2020 2020  pos=None,.      
+00043a60: 2020 6178 3d4e 6f6e 652c 0a20 2020 2020    ax=None,.     
+00043a70: 2020 206f 7061 6369 7479 3d4e 6f6e 652c     opacity=None,
+00043a80: 0a20 2020 2020 2020 206c 696e 6577 6964  .        linewid
+00043a90: 7468 3d4e 6f6e 652c 0a20 2020 2020 2020  th=None,.       
+00043aa0: 2069 6e63 6c75 6465 5f69 6d61 6765 3d54   include_image=T
+00043ab0: 7275 652c 0a20 2020 2020 2020 2063 656e  rue,.        cen
+00043ac0: 7472 655f 6f6e 5f72 6f69 3d4e 6f6e 652c  tre_on_roi=None,
+00043ad0: 0a20 2020 2020 2020 2073 686f 773d 5472  .        show=Tr
+00043ae0: 7565 2c0a 2020 2020 2020 2020 7361 7665  ue,.        save
+00043af0: 5f61 733d 4e6f 6e65 2c0a 2020 2020 2020  _as=None,.      
+00043b00: 2020 6c65 6765 6e64 3d46 616c 7365 2c0a    legend=False,.
+00043b10: 2020 2020 2020 2020 6c65 6765 6e64 5f62          legend_b
+00043b20: 626f 785f 746f 5f61 6e63 686f 723d 4e6f  box_to_anchor=No
+00043b30: 6e65 2c0a 2020 2020 2020 2020 6c65 6765  ne,.        lege
+00043b40: 6e64 5f6c 6f63 3d22 6c6f 7765 7220 6c65  nd_loc="lower le
+00043b50: 6674 222c 0a20 2020 2020 2020 2063 6f6e  ft",.        con
+00043b60: 7365 6e73 7573 5f74 7970 653d 4e6f 6e65  sensus_type=None
+00043b70: 2c0a 2020 2020 2020 2020 6578 636c 7564  ,.        exclud
+00043b80: 655f 6672 6f6d 5f63 6f6e 7365 6e73 7573  e_from_consensus
+00043b90: 3d4e 6f6e 652c 0a20 2020 2020 2020 2063  =None,.        c
+00043ba0: 6f6e 7365 6e73 7573 5f63 6f6c 6f72 3d22  onsensus_color="
+00043bb0: 626c 7565 222c 0a20 2020 2020 2020 2063  blue",.        c
+00043bc0: 6f6e 7365 6e73 7573 5f6c 696e 6577 6964  onsensus_linewid
+00043bd0: 7468 3d4e 6f6e 652c 0a20 2020 2020 2020  th=None,.       
+00043be0: 202a 2a6b 7761 7267 732c 0a20 2020 2029   **kwargs,.    )
+00043bf0: 3a0a 2020 2020 2020 2020 2222 2250 6c6f  :.        """Plo
+00043c00: 7420 7468 6520 524f 4973 2069 6e20 7468  t the ROIs in th
+00043c10: 6973 2073 7472 7563 7475 7265 2073 6574  is structure set
+00043c20: 2e0a 2020 2020 2020 200a 2020 2020 2020  ..       .      
+00043c30: 2020 4966 2063 6f6e 7365 6e73 7573 5f74    If consensus_t
+00043c40: 7970 6520 6973 2073 6574 2074 6f20 616e  ype is set to an
+00043c50: 7920 6f66 2027 6d61 6a6f 7269 7479 272c  y of 'majority',
+00043c60: 2027 7375 6d27 2c20 276f 7665 726c 6170   'sum', 'overlap
+00043c70: 272c 206f 7220 2773 7461 706c 6527 2c0a  ', or 'staple',.
+00043c80: 2020 2020 2020 2020 7468 6520 636f 6e65          the cone
+00043c90: 6e73 7573 2063 6f6e 746f 7572 2077 696c  nsus contour wil
+00043ca0: 6c20 6265 2070 6c6f 7474 6564 2072 6174  l be plotted rat
+00043cb0: 6865 7220 7468 616e 2069 6e64 6976 6964  her than individ
+00043cc0: 7561 6c20 524f 4973 2e20 4966 0a20 2020  ual ROIs. If.   
+00043cd0: 2020 2020 2027 6578 636c 7564 655f 6672       'exclude_fr
+00043ce0: 6f6d 5f63 6f6e 7365 6e73 7573 2720 6973  om_consensus' is
+00043cf0: 2073 6574 2074 6f20 7468 6520 6e61 6d65   set to the name
+00043d00: 206f 6620 616e 2052 4f49 2c20 7468 6174   of an ROI, that
+00043d10: 2052 4f49 2077 696c 6c0a 2020 2020 2020   ROI will.      
+00043d20: 2020 6265 2065 7863 6c75 6465 6420 6672    be excluded fr
+00043d30: 6f6d 2074 6865 2063 6f6e 7365 6e73 7573  om the consensus
+00043d40: 2063 616c 6375 6c61 7469 6f6e 2061 6e64   calculation and
+00043d50: 2070 6c6f 7474 6564 2069 6e64 6976 6964   plotted individ
+00043d60: 7561 6c6c 792e 0a20 2020 2020 2020 2022  ually..        "
+00043d70: 2222 0a0a 2020 2020 2020 2020 2320 4966  ""..        # If
+00043d80: 206e 6f20 736c 2f69 6478 2f70 6f73 2067   no sl/idx/pos g
+00043d90: 6976 656e 2c20 7573 6520 7468 6520 736c  iven, use the sl
+00043da0: 6963 6520 7769 7468 2074 6865 206d 6f73  ice with the mos
+00043db0: 7420 524f 4973 0a20 2020 2020 2020 2069  t ROIs.        i
+00043dc0: 6620 736c 2069 7320 4e6f 6e65 2061 6e64  f sl is None and
+00043dd0: 2069 6478 2069 7320 4e6f 6e65 2061 6e64   idx is None and
+00043de0: 2070 6f73 2069 7320 4e6f 6e65 3a0a 2020   pos is None:.  
+00043df0: 2020 2020 2020 2020 2020 6964 7820 3d20            idx = 
+00043e00: 7365 6c66 2e67 6574 5f6d 6964 5f69 6478  self.get_mid_idx
+00043e10: 2876 6965 7729 0a0a 2020 2020 2020 2020  (view)..        
+00043e20: 6966 2070 6c6f 745f 7479 7065 2069 7320  if plot_type is 
+00043e30: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+00043e40: 2020 706c 6f74 5f74 7970 6520 3d20 6b77    plot_type = kw
+00043e50: 6172 6773 2e67 6574 2822 726f 695f 706c  args.get("roi_pl
+00043e60: 6f74 5f74 7970 6522 2c20 7365 6c66 2e64  ot_type", self.d
+00043e70: 6566 6175 6c74 5f67 656f 6d5f 6d65 7468  efault_geom_meth
+00043e80: 6f64 290a 2020 2020 2020 2020 6b77 6172  od).        kwar
+00043e90: 6773 5b22 726f 695f 706c 6f74 5f74 7970  gs["roi_plot_typ
+00043ea0: 6522 5d20 3d20 706c 6f74 5f74 7970 650a  e"] = plot_type.
+00043eb0: 0a20 2020 2020 2020 2023 2045 6e73 7572  .        # Ensur
+00043ec0: 6520 7468 6174 206c 696e 6577 6964 7468  e that linewidth
+00043ed0: 2061 6e64 206f 7061 6369 7479 2066 6f72   and opacity for
+00043ee0: 2052 4f49 2070 6c6f 7474 696e 6720 6172   ROI plotting ar
+00043ef0: 6520 6465 6669 6e65 642e 0a20 2020 2020  e defined..     
+00043f00: 2020 2072 6f69 5f6b 7761 7267 7320 3d20     roi_kwargs = 
+00043f10: 7b7d 0a20 2020 2020 2020 2069 6620 6f70  {}.        if op
+00043f20: 6163 6974 7920 6973 204e 6f6e 653a 0a20  acity is None:. 
+00043f30: 2020 2020 2020 2020 2020 206f 7061 6369             opaci
+00043f40: 7479 203d 2030 2e33 2069 6620 2266 696c  ty = 0.3 if "fil
+00043f50: 6c65 6422 2069 6e20 706c 6f74 5f74 7970  led" in plot_typ
+00043f60: 6520 656c 7365 2031 0a20 2020 2020 2020  e else 1.       
+00043f70: 2072 6f69 5f6b 7761 7267 735b 226f 7061   roi_kwargs["opa
+00043f80: 6369 7479 225d 203d 206f 7061 6369 7479  city"] = opacity
+00043f90: 0a20 2020 2020 2020 2069 6620 6c69 6e65  .        if line
+00043fa0: 7769 6474 6820 6973 204e 6f6e 653a 0a20  width is None:. 
+00043fb0: 2020 2020 2020 2020 2020 206c 696e 6577             linew
+00043fc0: 6964 7468 203d 2064 6566 6175 6c74 5061  idth = defaultPa
+00043fd0: 7261 6d73 5b22 6c69 6e65 732e 6c69 6e65  rams["lines.line
+00043fe0: 7769 6474 6822 5d5b 305d 0a20 2020 2020  width"][0].     
+00043ff0: 2020 2072 6f69 5f6b 7761 7267 735b 226c     roi_kwargs["l
+00044000: 696e 6577 6964 7468 225d 203d 206c 696e  inewidth"] = lin
+00044010: 6577 6964 7468 0a0a 2020 2020 2020 2020  ewidth..        
+00044020: 2320 506c 6f74 2077 6974 6820 696d 6167  # Plot with imag
+00044030: 650a 2020 2020 2020 2020 6966 2069 6e63  e.        if inc
+00044040: 6c75 6465 5f69 6d61 6765 2061 6e64 2073  lude_image and s
+00044050: 656c 662e 696d 6167 6520 6973 206e 6f74  elf.image is not
+00044060: 204e 6f6e 653a 0a0a 2020 2020 2020 2020   None:..        
+00044070: 2020 2020 7365 6c66 2e69 6d61 6765 2e70      self.image.p
+00044080: 6c6f 7428 0a20 2020 2020 2020 2020 2020  lot(.           
+00044090: 2020 2020 2076 6965 772c 0a20 2020 2020       view,.     
+000440a0: 2020 2020 2020 2020 2020 2073 6c3d 736c             sl=sl
+000440b0: 2c20 0a20 2020 2020 2020 2020 2020 2020  , .             
+000440c0: 2020 2069 6478 3d69 6478 2c0a 2020 2020     idx=idx,.    
+000440d0: 2020 2020 2020 2020 2020 2020 706f 733d              pos=
+000440e0: 706f 732c 0a20 2020 2020 2020 2020 2020  pos,.           
+000440f0: 2020 2020 2072 6f69 733d 7365 6c66 2c0a       rois=self,.
+00044100: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00044110: 726f 695f 6b77 6172 6773 3d72 6f69 5f6b  roi_kwargs=roi_k
+00044120: 7761 7267 732c 0a20 2020 2020 2020 2020  wargs,.         
+00044130: 2020 2020 2020 2063 656e 7472 655f 6f6e         centre_on
+00044140: 5f72 6f69 3d63 656e 7472 655f 6f6e 5f72  _roi=centre_on_r
+00044150: 6f69 2c0a 2020 2020 2020 2020 2020 2020  oi,.            
+00044160: 2020 2020 7368 6f77 3d73 686f 772c 0a20      show=show,. 
+00044170: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00044180: 6176 655f 6173 3d73 6176 655f 6173 2c0a  ave_as=save_as,.
+00044190: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000441a0: 6c65 6765 6e64 3d6c 6567 656e 642c 0a20  legend=legend,. 
+000441b0: 2020 2020 2020 2020 2020 2020 2020 206c                 l
+000441c0: 6567 656e 645f 6262 6f78 5f74 6f5f 616e  egend_bbox_to_an
+000441d0: 6368 6f72 3d6c 6567 656e 645f 6262 6f78  chor=legend_bbox
+000441e0: 5f74 6f5f 616e 6368 6f72 2c0a 2020 2020  _to_anchor,.    
+000441f0: 2020 2020 2020 2020 2020 2020 6c65 6765              lege
+00044200: 6e64 5f6c 6f63 3d6c 6567 656e 645f 6c6f  nd_loc=legend_lo
+00044210: 632c 0a20 2020 2020 2020 2020 2020 2020  c,.             
+00044220: 2020 2063 6f6e 7365 6e73 7573 5f74 7970     consensus_typ
+00044230: 653d 636f 6e73 656e 7375 735f 7479 7065  e=consensus_type
+00044240: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00044250: 2020 6578 636c 7564 655f 6672 6f6d 5f63    exclude_from_c
+00044260: 6f6e 7365 6e73 7573 3d65 7863 6c75 6465  onsensus=exclude
+00044270: 5f66 726f 6d5f 636f 6e73 656e 7375 732c  _from_consensus,
+00044280: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00044290: 2061 783d 6178 2c0a 2020 2020 2020 2020   ax=ax,.        
+000442a0: 2020 2020 2020 2020 2a2a 6b77 6172 6773          **kwargs
+000442b0: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
+000442c0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+000442d0: 6e0a 0a20 2020 2020 2020 2069 6620 6b77  n..        if kw
+000442e0: 6172 6773 2e67 6574 2822 7469 746c 6522  args.get("title"
+000442f0: 2c20 4e6f 6e65 2920 6973 204e 6f6e 653a  , None) is None:
+00044300: 0a20 2020 2020 2020 2020 2020 206b 7761  .            kwa
+00044310: 7267 735b 2274 6974 6c65 225d 203d 2073  rgs["title"] = s
+00044320: 656c 662e 6e61 6d65 0a0a 2020 2020 2020  elf.name..      
+00044330: 2020 2320 506c 6f74 2063 6f6e 7365 6e73    # Plot consens
+00044340: 7573 0a20 2020 2020 2020 2072 6f69 5f68  us.        roi_h
+00044350: 616e 646c 6573 203d 205b 5d0a 2020 2020  andles = [].    
+00044360: 2020 2020 6966 2063 6f6e 7365 6e73 7573      if consensus
+00044370: 5f74 7970 6520 6973 206e 6f74 204e 6f6e  _type is not Non
+00044380: 653a 0a0a 2020 2020 2020 2020 2020 2020  e:..            
+00044390: 2320 506c 6f74 2063 6f6e 7365 6e73 7573  # Plot consensus
+000443a0: 2063 6f6e 746f 7572 0a20 2020 2020 2020   contour.       
+000443b0: 2020 2020 2063 6f6e 7365 6e73 7573 203d       consensus =
+000443c0: 2073 656c 662e 6765 745f 636f 6e73 656e   self.get_consen
+000443d0: 7375 7328 636f 6e73 656e 7375 735f 7479  sus(consensus_ty
+000443e0: 7065 2c20 0a20 2020 2020 2020 2020 2020  pe, .           
+000443f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00044400: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00044410: 636f 6c6f 723d 636f 6e73 656e 7375 735f  color=consensus_
+00044420: 636f 6c6f 722c 0a20 2020 2020 2020 2020  color,.         
+00044430: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00044440: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00044450: 2020 2020 2020 2020 2020 2020 6f70 6163              opac
-00044460: 6974 793d 6f70 6163 6974 792c 206c 696e  ity=opacity, lin
-00044470: 6577 6964 7468 3d6c 696e 6577 6964 7468  ewidth=linewidth
-00044480: 2c20 7368 6f77 3d46 616c 7365 2c0a 2020  , show=False,.  
-00044490: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000444a0: 2020 2020 2020 2020 2020 2020 6178 3d73              ax=s
-000444b0: 656c 662e 6178 2c20 2a2a 6b77 6172 6773  elf.ax, **kwargs
-000444c0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-000444d0: 2020 6966 206c 6567 656e 643a 0a20 2020    if legend:.   
-000444e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000444f0: 2072 6f69 5f68 616e 646c 6573 2e61 7070   roi_handles.app
-00044500: 656e 6428 0a20 2020 2020 2020 2020 2020  end(.           
-00044510: 2020 2020 2020 2020 2020 2020 2065 7863               exc
-00044520: 6c75 6465 642e 6765 745f 7061 7463 6828  luded.get_patch(
-00044530: 706c 6f74 5f74 7970 652c 2065 7863 6c75  plot_type, exclu
-00044540: 6465 642e 636f 6c6f 722c 206f 7061 6369  ded.color, opaci
-00044550: 7479 2c0a 2020 2020 2020 2020 2020 2020  ty,.            
-00044560: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00044570: 6c69 6e65 7769 6474 682c 2065 7863 6c75  linewidth, exclu
-00044580: 6465 642e 6e61 6d65 2929 0a0a 2020 2020  ded.name))..    
-00044590: 2020 2020 2320 4f74 6865 7277 6973 652c      # Otherwise,
-000445a0: 2070 6c6f 7420 6669 7273 7420 524f 4920   plot first ROI 
-000445b0: 616e 6420 6765 7420 6178 6573 0a20 2020  and get axes.   
-000445c0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-000445d0: 2020 2020 2020 2069 6620 6365 6e74 7265         if centre
-000445e0: 5f6f 6e5f 726f 6920 6973 206e 6f74 204e  _on_roi is not N
-000445f0: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-00044600: 2020 2020 2063 656e 7472 616c 203d 2073       central = s
-00044610: 656c 662e 6765 745f 726f 6928 6365 6e74  elf.get_roi(cent
-00044620: 7265 5f6f 6e5f 726f 6929 0a20 2020 2020  re_on_roi).     
-00044630: 2020 2020 2020 2020 2020 2069 6478 203d             idx =
-00044640: 2063 656e 7472 616c 2e67 6574 5f6d 6964   central.get_mid
-00044650: 5f69 6478 2876 6965 7729 0a20 2020 2020  _idx(view).     
-00044660: 2020 2020 2020 2020 2020 2073 6c20 3d20             sl = 
-00044670: 4e6f 6e65 0a20 2020 2020 2020 2020 2020  None.           
-00044680: 2020 2020 2070 6f73 203d 204e 6f6e 650a       pos = None.
-00044690: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000446a0: 6669 7273 745f 726f 6920 3d20 6365 6e74  first_roi = cent
-000446b0: 7261 6c0a 2020 2020 2020 2020 2020 2020  ral.            
-000446c0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-000446d0: 2020 2020 2020 6365 6e74 7261 6c20 3d20        central = 
-000446e0: 7365 6c66 2e67 6574 5f72 6f69 7328 6967  self.get_rois(ig
-000446f0: 6e6f 7265 5f65 6d70 7479 3d54 7275 6529  nore_empty=True)
-00044700: 5b30 5d0a 0a20 2020 2020 2020 2020 2020  [0]..           
-00044710: 2063 656e 7472 616c 2e70 6c6f 7428 7669   central.plot(vi
-00044720: 6577 2c20 736c 3d73 6c2c 2069 6478 3d69  ew, sl=sl, idx=i
-00044730: 6478 2c20 706f 733d 706f 732c 2070 6c6f  dx, pos=pos, plo
-00044740: 745f 7479 7065 3d70 6c6f 745f 7479 7065  t_type=plot_type
-00044750: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00044760: 2020 2020 2020 2020 2020 206f 7061 6369             opaci
-00044770: 7479 3d6f 7061 6369 7479 2c20 6c69 6e65  ty=opacity, line
-00044780: 7769 6474 683d 6c69 6e65 7769 6474 682c  width=linewidth,
-00044790: 2073 686f 773d 4661 6c73 652c 0a20 2020   show=False,.   
-000447a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000447b0: 2020 2020 2020 6178 3d61 7829 0a0a 2020        ax=ax)..  
-000447c0: 2020 2020 2020 2020 2020 7365 6c66 2e66            self.f
-000447d0: 6967 203d 2063 656e 7472 616c 2e66 6967  ig = central.fig
-000447e0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-000447f0: 662e 6178 203d 2063 656e 7472 616c 2e61  f.ax = central.a
-00044800: 780a 0a20 2020 2020 2020 2020 2020 2069  x..            i
-00044810: 6620 6c65 6765 6e64 3a0a 2020 2020 2020  f legend:.      
-00044820: 2020 2020 2020 2020 2020 726f 695f 6861            roi_ha
-00044830: 6e64 6c65 732e 6170 7065 6e64 280a 2020  ndles.append(.  
-00044840: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00044850: 2020 2020 2020 6365 6e74 7261 6c2e 6765        central.ge
-00044860: 745f 7061 7463 6828 706c 6f74 5f74 7970  t_patch(plot_typ
-00044870: 652c 2063 656e 7472 616c 2e63 6f6c 6f72  e, central.color
-00044880: 2c20 6f70 6163 6974 792c 0a20 2020 2020  , opacity,.     
-00044890: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000448a0: 2020 2020 2020 206c 696e 6577 6964 7468         linewidth
-000448b0: 2c20 6365 6e74 7261 6c2e 6e61 6d65 2929  , central.name))
-000448c0: 0a0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
-000448d0: 506c 6f74 206f 7468 6572 2052 4f49 730a  Plot other ROIs.
-000448e0: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-000448f0: 692c 2072 6f69 2069 6e20 656e 756d 6572  i, roi in enumer
-00044900: 6174 6528 7365 6c66 2e67 6574 5f72 6f69  ate(self.get_roi
-00044910: 7328 6967 6e6f 7265 5f65 6d70 7479 3d54  s(ignore_empty=T
-00044920: 7275 6529 293a 0a0a 2020 2020 2020 2020  rue)):..        
-00044930: 2020 2020 2020 2020 6966 2072 6f69 2069          if roi i
-00044940: 7320 6365 6e74 7261 6c3a 0a20 2020 2020  s central:.     
-00044950: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-00044960: 6f6e 7469 6e75 650a 0a20 2020 2020 2020  ontinue..       
-00044970: 2020 2020 2020 2020 2070 6c6f 745f 6b77           plot_kw
-00044980: 6172 6773 203d 207b 7d20 6966 2069 203c  args = {} if i <
-00044990: 206c 656e 2873 656c 662e 726f 6973 2920   len(self.rois) 
-000449a0: 2d20 3120 656c 7365 206b 7761 7267 730a  - 1 else kwargs.
-000449b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000449c0: 726f 692e 706c 6f74 2876 6965 772c 2073  roi.plot(view, s
-000449d0: 6c3d 736c 2c20 6964 783d 6964 782c 2070  l=sl, idx=idx, p
-000449e0: 6f73 3d70 6f73 2c20 706c 6f74 5f74 7970  os=pos, plot_typ
-000449f0: 653d 706c 6f74 5f74 7970 652c 0a20 2020  e=plot_type,.   
-00044a00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00044a10: 2020 2020 2020 6f70 6163 6974 793d 6f70        opacity=op
-00044a20: 6163 6974 792c 206c 696e 6577 6964 7468  acity, linewidth
-00044a30: 3d6c 696e 6577 6964 7468 2c20 7368 6f77  =linewidth, show
-00044a40: 3d46 616c 7365 2c0a 2020 2020 2020 2020  =False,.        
-00044a50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00044a60: 2061 783d 7365 6c66 2e61 782c 202a 2a6b   ax=self.ax, **k
-00044a70: 7761 7267 7329 0a0a 2020 2020 2020 2020  wargs)..        
-00044a80: 2020 2020 2020 2020 6966 206c 6567 656e          if legen
-00044a90: 643a 0a20 2020 2020 2020 2020 2020 2020  d:.             
-00044aa0: 2020 2020 2020 2069 6620 2869 6478 2069         if (idx i
-00044ab0: 7320 4e6f 6e65 2061 6e64 2070 6f73 2069  s None and pos i
-00044ac0: 7320 4e6f 6e65 2061 6e64 2073 6c20 6973  s None and sl is
-00044ad0: 204e 6f6e 6529 206f 7220 5c0a 2020 2020   None) or \.    
-00044ae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00044af0: 2020 2072 6f69 2e6f 6e5f 736c 6963 6528     roi.on_slice(
-00044b00: 7669 6577 2c20 736c 3d73 6c2c 2069 6478  view, sl=sl, idx
-00044b10: 3d69 6478 2c20 706f 733d 706f 7329 3a0a  =idx, pos=pos):.
-00044b20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00044b30: 2020 2020 2020 2020 726f 695f 6861 6e64          roi_hand
-00044b40: 6c65 732e 6170 7065 6e64 2872 6f69 2e67  les.append(roi.g
-00044b50: 6574 5f70 6174 6368 2870 6c6f 745f 7479  et_patch(plot_ty
-00044b60: 7065 2c20 726f 692e 636f 6c6f 722c 0a20  pe, roi.color,. 
-00044b70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00044b80: 2020 2020 2020 2020 2020 206f 7061 6369             opaci
-00044b90: 7479 2c20 6c69 6e65 7769 6474 682c 2072  ty, linewidth, r
-00044ba0: 6f69 2e6e 616d 6529 290a 0a20 2020 2020  oi.name))..     
-00044bb0: 2020 2023 2044 7261 7720 6c65 6765 6e64     # Draw legend
-00044bc0: 0a20 2020 2020 2020 2069 6620 6c65 6765  .        if lege
-00044bd0: 6e64 2061 6e64 206c 656e 2872 6f69 5f68  nd and len(roi_h
-00044be0: 616e 646c 6573 293a 0a20 2020 2020 2020  andles):.       
-00044bf0: 2020 2020 2073 656c 662e 6178 2e6c 6567       self.ax.leg
-00044c00: 656e 6428 6861 6e64 6c65 733d 726f 695f  end(handles=roi_
-00044c10: 6861 6e64 6c65 732c 0a20 2020 2020 2020  handles,.       
-00044c20: 2020 2020 2020 2020 2020 2020 2062 626f               bbo
-00044c30: 785f 746f 5f61 6e63 686f 723d 6c65 6765  x_to_anchor=lege
-00044c40: 6e64 5f62 626f 785f 746f 5f61 6e63 686f  nd_bbox_to_ancho
-00044c50: 722c 206c 6f63 3d6c 6567 656e 645f 6c6f  r, loc=legend_lo
-00044c60: 632c 0a20 2020 2020 2020 2020 2020 2020  c,.             
-00044c70: 2020 2020 2020 2066 6163 6563 6f6c 6f72         facecolor
-00044c80: 3d22 7768 6974 6522 2c20 6672 616d 6561  ="white", framea
-00044c90: 6c70 6861 3d31 0a20 2020 2020 2020 2020  lpha=1.         
-00044ca0: 2020 2029 0a0a 2020 2020 2020 2020 2320     )..        # 
-00044cb0: 4469 7370 6c61 7920 696d 6167 650a 2020  Display image.  
-00044cc0: 2020 2020 2020 706c 742e 7469 6768 745f        plt.tight_
-00044cd0: 6c61 796f 7574 2829 0a20 2020 2020 2020  layout().       
-00044ce0: 2069 6620 7368 6f77 3a0a 2020 2020 2020   if show:.      
-00044cf0: 2020 2020 2020 706c 742e 7368 6f77 2829        plt.show()
-00044d00: 0a0a 2020 2020 2020 2020 2320 5361 7665  ..        # Save
-00044d10: 2074 6f20 6669 6c65 0a20 2020 2020 2020   to file.       
-00044d20: 2069 6620 7361 7665 5f61 733a 0a20 2020   if save_as:.   
-00044d30: 2020 2020 2020 2020 2073 656c 662e 6669           self.fi
-00044d40: 672e 7361 7665 6669 6728 7361 7665 5f61  g.savefig(save_a
-00044d50: 7329 0a20 2020 2020 2020 2020 2020 2070  s).            p
-00044d60: 6c74 2e63 6c6f 7365 2829 0a0a 2020 2020  lt.close()..    
-00044d70: 6465 6620 706c 6f74 5f63 6f6e 7365 6e73  def plot_consens
-00044d80: 7573 2873 656c 662c 2063 6f6e 7365 6e73  us(self, consens
-00044d90: 7573 5f74 7970 652c 2076 6965 773d 2278  us_type, view="x
-00044da0: 2d79 222c 2073 6c3d 4e6f 6e65 2c20 6964  -y", sl=None, id
-00044db0: 783d 4e6f 6e65 2c0a 2020 2020 2020 2020  x=None,.        
-00044dc0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-00044dd0: 6f73 3d4e 6f6e 652c 2072 6f69 735f 696e  os=None, rois_in
-00044de0: 5f62 6163 6b67 726f 756e 643d 4661 6c73  _background=Fals
-00044df0: 652c 2063 6f6c 6f72 3d4e 6f6e 652c 200a  e, color=None, .
-00044e00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00044e10: 2020 2020 2020 2073 686f 773d 5472 7565         show=True
-00044e20: 2c20 2a2a 6b77 6172 6773 293a 0a20 2020  , **kwargs):.   
-00044e30: 2020 2020 2022 2222 506c 6f74 2074 6865       """Plot the
-00044e40: 2063 6f6e 7365 6e73 7573 2063 6f6e 746f   consensus conto
-00044e50: 7572 2c20 7769 7468 2061 6c6c 2052 4f49  ur, with all ROI
-00044e60: 7320 696e 2067 7265 7920 6265 6869 6e64  s in grey behind
-00044e70: 2069 7420 6966 0a20 2020 2020 2020 2072   it if.        r
-00044e80: 6f69 735f 696e 5f62 6163 6b67 726f 756e  ois_in_backgroun
-00044e90: 643d 5472 7565 2e22 2222 0a0a 2020 2020  d=True."""..    
-00044ea0: 2020 2020 636f 6e73 656e 7375 7320 3d20      consensus = 
-00044eb0: 7365 6c66 2e67 6574 5f63 6f6e 7365 6e73  self.get_consens
-00044ec0: 7573 2863 6f6e 7365 6e73 7573 5f74 7970  us(consensus_typ
-00044ed0: 6529 0a0a 2020 2020 2020 2020 6966 2069  e)..        if i
-00044ee0: 6478 2069 7320 4e6f 6e65 2061 6e64 2073  dx is None and s
-00044ef0: 6c20 6973 204e 6f6e 6520 616e 6420 706f  l is None and po
-00044f00: 7320 6973 204e 6f6e 653a 0a20 2020 2020  s is None:.     
-00044f10: 2020 2020 2020 2069 6478 203d 2073 656c         idx = sel
-00044f20: 662e 6765 745f 6d69 645f 6964 7828 7669  f.get_mid_idx(vi
-00044f30: 6577 290a 2020 2020 2020 2020 656c 7365  ew).        else
-00044f40: 3a0a 2020 2020 2020 2020 2020 2020 6964  :.            id
-00044f50: 7820 3d20 636f 6e73 656e 7375 732e 6765  x = consensus.ge
-00044f60: 745f 6964 7828 7669 6577 2c20 736c 2c20  t_idx(view, sl, 
-00044f70: 6964 782c 2070 6f73 290a 2020 2020 2020  idx, pos).      
-00044f80: 2020 6178 203d 2073 6b72 742e 696d 6167    ax = skrt.imag
-00044f90: 652e 5f73 6c69 6365 5f61 7865 735b 7669  e._slice_axes[vi
-00044fa0: 6577 5d0a 2020 2020 2020 2020 706f 7320  ew].        pos 
-00044fb0: 3d20 636f 6e73 656e 7375 732e 6964 785f  = consensus.idx_
-00044fc0: 746f 5f70 6f73 2869 6478 2c20 6178 290a  to_pos(idx, ax).
-00044fd0: 0a20 2020 2020 2020 2069 6620 636f 6e73  .        if cons
-00044fe0: 656e 7375 732e 656d 7074 793a 0a20 2020  ensus.empty:.   
-00044ff0: 2020 2020 2020 2020 2070 7269 6e74 2866           print(f
-00045000: 227b 636f 6e73 656e 7375 735f 7479 7065  "{consensus_type
-00045010: 7d20 636f 6e74 6f75 7220 6973 2065 6d70  } contour is emp
-00045020: 7479 2229 0a20 2020 2020 2020 2020 2020  ty").           
-00045030: 2072 6574 7572 6e0a 2020 2020 2020 2020   return.        
-00045040: 636f 6e73 656e 7375 732e 706c 6f74 2863  consensus.plot(c
-00045050: 6f6c 6f72 3d63 6f6c 6f72 2c20 706f 733d  olor=color, pos=
-00045060: 706f 732c 2076 6965 773d 7669 6577 2c20  pos, view=view, 
-00045070: 7368 6f77 3d46 616c 7365 2c20 2a2a 6b77  show=False, **kw
-00045080: 6172 6773 290a 0a20 2020 2020 2020 2069  args)..        i
-00045090: 6620 726f 6973 5f69 6e5f 6261 636b 6772  f rois_in_backgr
-000450a0: 6f75 6e64 3a0a 2020 2020 2020 2020 2020  ound:.          
-000450b0: 2020 6b77 6172 6773 5b22 6178 225d 203d    kwargs["ax"] =
-000450c0: 2063 6f6e 7365 6e73 7573 2e61 780a 2020   consensus.ax.  
-000450d0: 2020 2020 2020 2020 2020 666f 7220 726f            for ro
-000450e0: 6920 696e 2073 656c 662e 6765 745f 726f  i in self.get_ro
-000450f0: 6973 2869 676e 6f72 655f 656d 7074 793d  is(ignore_empty=
-00045100: 5472 7565 293a 0a20 2020 2020 2020 2020  True):.         
-00045110: 2020 2020 2020 2072 6f69 2e70 6c6f 7428         roi.plot(
-00045120: 636f 6c6f 723d 226c 6967 6874 6772 6579  color="lightgrey
-00045130: 222c 2076 6965 773d 7669 6577 2c20 706f  ", view=view, po
-00045140: 733d 706f 732c 2073 686f 773d 4661 6c73  s=pos, show=Fals
-00045150: 652c 202a 2a6b 7761 7267 7329 0a20 2020  e, **kwargs).   
-00045160: 2020 2020 2020 2020 2063 6f6e 7365 6e73           consens
-00045170: 7573 2e70 6c6f 7428 636f 6c6f 723d 636f  us.plot(color=co
-00045180: 6c6f 722c 2076 6965 773d 7669 6577 2c20  lor, view=view, 
-00045190: 706f 733d 706f 732c 2073 686f 773d 4661  pos=pos, show=Fa
-000451a0: 6c73 652c 202a 2a6b 7761 7267 7329 0a0a  lse, **kwargs)..
-000451b0: 2020 2020 2020 2020 636f 6e73 656e 7375          consensu
-000451c0: 732e 6178 2e73 6574 5f61 7370 6563 7428  s.ax.set_aspect(
-000451d0: 2265 7175 616c 2229 0a0a 2020 2020 2020  "equal")..      
-000451e0: 2020 6966 2073 686f 773a 0a20 2020 2020    if show:.     
-000451f0: 2020 2020 2020 2070 6c74 2e73 686f 7728         plt.show(
-00045200: 290a 0a20 2020 2064 6566 2067 6574 5f6c  )..    def get_l
-00045210: 656e 6774 6828 7365 6c66 2c20 6178 293a  ength(self, ax):
-00045220: 0a20 2020 2020 2020 2022 2222 4765 7420  .        """Get 
-00045230: 6c65 6e67 7468 2063 6f76 6572 6564 2062  length covered b
-00045240: 7920 524f 4973 2061 6c6f 6e67 2061 6e20  y ROIs along an 
-00045250: 6178 6973 2e22 2222 0a0a 2020 2020 2020  axis."""..      
-00045260: 2020 6578 7465 6e74 203d 2073 656c 662e    extent = self.
-00045270: 6765 745f 6578 7465 6e74 2861 783d 6178  get_extent(ax=ax
-00045280: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
-00045290: 2061 6273 2865 7874 656e 745b 315d 202d   abs(extent[1] -
-000452a0: 2065 7874 656e 745b 305d 290a 0a20 2020   extent[0])..   
-000452b0: 2064 6566 2067 6574 5f63 656e 7472 6528   def get_centre(
-000452c0: 7365 6c66 2c20 2a2a 6b77 6172 6773 293a  self, **kwargs):
-000452d0: 0a20 2020 2020 2020 2022 2222 4765 7420  .        """Get 
-000452e0: 3344 2063 656e 7472 6520 6f66 2074 6865  3D centre of the
-000452f0: 2061 7265 6120 636f 7665 7265 6420 6279   area covered by
-00045300: 2052 4f49 732e 2222 220a 0a20 2020 2020   ROIs."""..     
-00045310: 2020 206b 7761 7267 732e 706f 7028 2261     kwargs.pop("a
-00045320: 7822 2c20 4e6f 6e65 290a 2020 2020 2020  x", None).      
-00045330: 2020 6578 7465 6e74 7320 3d20 5b73 656c    extents = [sel
-00045340: 662e 6765 745f 6578 7465 6e74 2861 783d  f.get_extent(ax=
-00045350: 6178 2c20 2a2a 6b77 6172 6773 2920 666f  ax, **kwargs) fo
-00045360: 7220 6178 2069 6e20 736b 7274 2e69 6d61  r ax in skrt.ima
-00045370: 6765 2e5f 6178 6573 5d0a 2020 2020 2020  ge._axes].      
-00045380: 2020 7265 7475 726e 205b 6e70 2e6d 6561    return [np.mea
-00045390: 6e28 6578 2920 666f 7220 6578 2069 6e20  n(ex) for ex in 
-000453a0: 6578 7465 6e74 735d 0a0a 2020 2020 6465  extents]..    de
-000453b0: 6620 6669 6e64 5f6d 6f73 745f 706f 7075  f find_most_popu
-000453c0: 6c61 7465 645f 736c 6963 6528 7365 6c66  lated_slice(self
-000453d0: 2c20 7669 6577 3d22 782d 7922 293a 0a20  , view="x-y"):. 
-000453e0: 2020 2020 2020 2022 2222 4669 6e64 2074         """Find t
-000453f0: 6865 2069 6e64 6578 206f 6620 7468 6520  he index of the 
-00045400: 736c 6963 6520 7769 7468 2074 6865 206d  slice with the m
-00045410: 6f73 7420 524f 4973 206f 6e20 6974 2e22  ost ROIs on it."
-00045420: 2222 0a0a 2020 2020 2020 2020 696e 6469  ""..        indi
-00045430: 6365 7320 3d20 5b5d 0a20 2020 2020 2020  ces = [].       
-00045440: 2066 6f72 2072 6f69 2069 6e20 7365 6c66   for roi in self
-00045450: 2e67 6574 5f72 6f69 7328 6967 6e6f 7265  .get_rois(ignore
-00045460: 5f65 6d70 7479 3d54 7275 6529 3a0a 2020  _empty=True):.  
-00045470: 2020 2020 2020 2020 2020 696e 6469 6365            indice
-00045480: 732e 6578 7465 6e64 2872 6f69 2e67 6574  s.extend(roi.get
-00045490: 5f69 6e64 6963 6573 2876 6965 7729 290a  _indices(view)).
-000454a0: 2020 2020 2020 2020 7661 6c73 2c20 636f          vals, co
-000454b0: 756e 7473 203d 206e 702e 756e 6971 7565  unts = np.unique
-000454c0: 2869 6e64 6963 6573 2c20 7265 7475 726e  (indices, return
-000454d0: 5f63 6f75 6e74 733d 5472 7565 290a 2020  _counts=True).  
-000454e0: 2020 2020 2020 7265 7475 726e 2076 616c        return val
-000454f0: 735b 6e70 2e61 7267 6d61 7828 636f 756e  s[np.argmax(coun
-00045500: 7473 295d 0a0a 2020 2020 6465 6620 7669  ts)]..    def vi
-00045510: 6577 2873 656c 662c 2069 6e63 6c75 6465  ew(self, include
-00045520: 5f69 6d61 6765 3d54 7275 652c 2072 6f69  _image=True, roi
-00045530: 733d 4e6f 6e65 2c20 766f 7865 6c5f 7369  s=None, voxel_si
-00045540: 7a65 3d5b 312c 2031 5d2c 2062 7566 6665  ze=[1, 1], buffe
-00045550: 723d 352c 202a 2a6b 7761 7267 7329 3a0a  r=5, **kwargs):.
-00045560: 2020 2020 2020 2020 2222 2256 6965 7720          """View 
-00045570: 7468 6520 5374 7275 6374 7572 6553 6574  the StructureSet
-00045580: 2e0a 0a20 2020 2020 2020 202a 2a50 6172  ...        **Par
-00045590: 616d 6574 6572 733a 2a2a 0a20 2020 2020  ameters:**.     
-000455a0: 2020 200a 2020 2020 2020 2020 696e 636c     .        incl
-000455b0: 7564 655f 696d 6167 6520 3a20 626f 6f6c  ude_image : bool
-000455c0: 2c20 6465 6661 756c 743d 5472 7565 0a20  , default=True. 
-000455d0: 2020 2020 2020 2020 2020 2049 6620 5472             If Tr
-000455e0: 7565 2061 6e64 2074 6869 7320 5374 7275  ue and this Stru
-000455f0: 6374 7572 6553 6574 2068 6173 2061 6e20  ctureSet has an 
-00045600: 6173 736f 6369 6174 6564 2069 6d61 6765  associated image
-00045610: 200a 2020 2020 2020 2020 2020 2020 2869   .            (i
-00045620: 6e20 7365 6c66 2e69 6d61 6765 292c 2074  n self.image), t
-00045630: 6865 2069 6d61 6765 2077 696c 6c20 6265  he image will be
-00045640: 2064 6973 706c 6179 6564 2062 6568 696e   displayed behin
-00045650: 6420 7468 6520 524f 4973 2e0a 0a20 2020  d the ROIs...   
-00045660: 2020 2020 2072 6f69 7320 3a20 5374 7275       rois : Stru
-00045670: 6374 7572 6553 6574 2f6c 6973 742c 2064  ctureSet/list, d
-00045680: 6566 6175 6c74 3d4e 6f6e 650a 2020 2020  efault=None.    
-00045690: 2020 2020 2020 2020 416e 7920 6f74 6865          Any othe
-000456a0: 7220 524f 4973 206f 7220 5374 7275 6374  r ROIs or Struct
-000456b0: 7572 6553 6574 7320 746f 2069 6e63 6c75  ureSets to inclu
-000456c0: 6465 2069 6e20 7468 6520 706c 6f74 2e0a  de in the plot..
-000456d0: 0a20 2020 2020 2020 2076 6f78 656c 5f73  .        voxel_s
-000456e0: 697a 6520 3a20 6c69 7374 2c20 6465 6661  ize : list, defa
-000456f0: 756c 743d 5b31 2c20 315d 0a20 2020 2020  ult=[1, 1].     
-00045700: 2020 2020 2020 2049 6620 7468 6520 5374         If the St
-00045710: 7275 6374 7572 6553 6574 2064 6f65 7320  ructureSet does 
-00045720: 6e6f 7420 6861 7665 2061 6e20 6173 736f  not have an asso
-00045730: 6369 6174 6564 2069 6d61 6765 2061 6e64  ciated image and
-00045740: 2068 6173 2052 4f49 7320 0a20 2020 2020   has ROIs .     
-00045750: 2020 2020 2020 2064 6573 6372 6962 6564         described
-00045760: 206f 6e6c 7920 6279 2063 6f6e 746f 7572   only by contour
-00045770: 732c 2074 6869 7320 7769 6c6c 2062 6520  s, this will be 
-00045780: 7468 6520 766f 7865 6c20 7369 7a65 7320  the voxel sizes 
-00045790: 7573 6564 2069 6e20 0a20 2020 2020 2020  used in .       
-000457a0: 2020 2020 2074 6865 2078 2d79 2064 6972       the x-y dir
-000457b0: 6563 7469 6f6e 2077 6865 6e20 636f 6e76  ection when conv
-000457c0: 6572 7469 6e67 2052 4f49 7320 746f 206d  erting ROIs to m
-000457d0: 6173 6b73 2069 6620 6120 6d61 736b 2070  asks if a mask p
-000457e0: 6c6f 7420 0a20 2020 2020 2020 2020 2020  lot .           
-000457f0: 2074 7970 6520 6973 2073 656c 6563 7465   type is selecte
-00045800: 642e 0a0a 2020 2020 2020 2020 6275 6666  d...        buff
-00045810: 6572 203a 2069 6e74 2c20 6465 6661 756c  er : int, defaul
-00045820: 743d 350a 2020 2020 2020 2020 2020 2020  t=5.            
-00045830: 4966 2074 6865 2053 7472 7563 7475 7265  If the Structure
-00045840: 5365 7420 646f 6573 206e 6f74 2068 6176  Set does not hav
-00045850: 6520 616e 2061 7373 6f63 6961 7465 6420  e an associated 
-00045860: 696d 6167 6520 616e 6420 6861 7320 524f  image and has RO
-00045870: 4973 0a20 2020 2020 2020 2020 2020 2064  Is.            d
-00045880: 6573 6372 6962 6564 206f 6e6c 7920 6279  escribed only by
-00045890: 2063 6f6e 746f 7572 732c 2074 6869 7320   contours, this 
-000458a0: 7769 6c6c 2062 6520 7468 6520 6e75 6d62  will be the numb
-000458b0: 6572 206f 6620 6275 6666 6572 2076 6f78  er of buffer vox
-000458c0: 656c 7320 0a20 2020 2020 2020 2020 2020  els .           
-000458d0: 2028 692e 652e 2077 6869 7465 7370 6163   (i.e. whitespac
-000458e0: 6529 2064 6973 706c 6179 6564 2061 726f  e) displayed aro
-000458f0: 756e 6420 7468 6520 6578 7465 6e74 206f  und the extent o
-00045900: 6620 7468 6520 524f 4973 2e0a 2020 2020  f the ROIs..    
-00045910: 2020 2020 2222 220a 0a20 2020 2020 2020      """..       
-00045920: 2066 726f 6d20 736b 7274 2e62 6574 7465   from skrt.bette
-00045930: 725f 7669 6577 6572 2069 6d70 6f72 7420  r_viewer import 
-00045940: 4265 7474 6572 5669 6577 6572 0a20 2020  BetterViewer.   
-00045950: 2020 2020 2073 656c 662e 6c6f 6164 2829       self.load()
-00045960: 0a0a 2020 2020 2020 2020 2320 5365 7420  ..        # Set 
-00045970: 696e 6974 6961 6c20 7a6f 6f6d 2061 6d6f  initial zoom amo
-00045980: 756e 7420 616e 6420 6365 6e74 7265 0a20  unt and centre. 
-00045990: 2020 2020 2020 2073 656c 662e 726f 6973         self.rois
-000459a0: 5b30 5d2e 6c6f 6164 2829 0a20 2020 2020  [0].load().     
-000459b0: 2020 2069 6620 7365 6c66 2e69 6d61 6765     if self.image
-000459c0: 2069 7320 6e6f 7420 4e6f 6e65 2061 6e64   is not None and
-000459d0: 206e 6f74 2073 656c 662e 6765 745f 726f   not self.get_ro
-000459e0: 6973 2869 676e 6f72 655f 656d 7074 793d  is(ignore_empty=
-000459f0: 5472 7565 295b 305d 2e63 6f6e 746f 7572  True)[0].contour
-00045a00: 735f 6f6e 6c79 3a0a 2020 2020 2020 2020  s_only:.        
-00045a10: 2020 2020 7669 6577 203d 206b 7761 7267      view = kwarg
-00045a20: 732e 6765 7428 2269 6e69 745f 7669 6577  s.get("init_view
-00045a30: 222c 2022 782d 7922 290a 2020 2020 2020  ", "x-y").      
-00045a40: 2020 2020 2020 6178 6573 203d 2073 6b72        axes = skr
-00045a50: 742e 696d 6167 652e 5f70 6c6f 745f 6178  t.image._plot_ax
-00045a60: 6573 5b76 6965 775d 0a20 2020 2020 2020  es[view].       
-00045a70: 2020 2020 2065 7874 656e 7473 203d 205b       extents = [
-00045a80: 7365 6c66 2e67 6574 5f6c 656e 6774 6828  self.get_length(
-00045a90: 6178 3d61 7829 2066 6f72 2061 7820 696e  ax=ax) for ax in
-00045aa0: 2061 7865 735d 0a20 2020 2020 2020 2020   axes].         
-00045ab0: 2020 2069 6d5f 6c69 6d73 203d 205b 7365     im_lims = [se
-00045ac0: 6c66 2e69 6d61 6765 2e67 6574 5f6c 656e  lf.image.get_len
-00045ad0: 6774 6828 6178 3d61 7829 2066 6f72 2061  gth(ax=ax) for a
-00045ae0: 7820 696e 2061 7865 735d 0a20 2020 2020  x in axes].     
-00045af0: 2020 2020 2020 207a 6f6f 6d20 3d20 6d69         zoom = mi
-00045b00: 6e28 5b69 6d5f 6c69 6d73 5b69 5d20 2f20  n([im_lims[i] / 
-00045b10: 6578 7465 6e74 735b 695d 2066 6f72 2069  extents[i] for i
-00045b20: 2069 6e20 7261 6e67 6528 3229 5d29 202a   in range(2)]) *
-00045b30: 2030 2e38 0a20 2020 2020 2020 2020 2020   0.8.           
-00045b40: 207a 6f6f 6d5f 6365 6e74 7265 203d 2073   zoom_centre = s
-00045b50: 656c 662e 6765 745f 6365 6e74 7265 2829  elf.get_centre()
-00045b60: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00045b70: 7a6f 6f6d 203e 2031 3a0a 2020 2020 2020  zoom > 1:.      
-00045b80: 2020 2020 2020 2020 2020 6b77 6172 6773            kwargs
-00045b90: 2e73 6574 6465 6661 756c 7428 227a 6f6f  .setdefault("zoo
-00045ba0: 6d22 2c20 7a6f 6f6d 290a 2020 2020 2020  m", zoom).      
-00045bb0: 2020 2020 2020 2020 2020 6b77 6172 6773            kwargs
-00045bc0: 2e73 6574 6465 6661 756c 7428 227a 6f6f  .setdefault("zoo
-00045bd0: 6d5f 6365 6e74 7265 222c 207a 6f6f 6d5f  m_centre", zoom_
-00045be0: 6365 6e74 7265 290a 0a20 2020 2020 2020  centre)..       
-00045bf0: 2020 2020 2023 2053 6574 2069 6e69 7469       # Set initi
-00045c00: 616c 2073 6c69 6365 0a20 2020 2020 2020  al slice.       
-00045c10: 2020 2020 206b 7761 7267 732e 7365 7464       kwargs.setd
-00045c20: 6566 6175 6c74 280a 2020 2020 2020 2020  efault(.        
-00045c30: 2020 2020 2020 2020 2269 6e69 745f 736c          "init_sl
-00045c40: 6963 6522 2c20 0a20 2020 2020 2020 2020  ice", .         
-00045c50: 2020 2020 2020 2073 656c 662e 696d 6167         self.imag
-00045c60: 652e 6964 785f 746f 5f73 6c69 6365 2873  e.idx_to_slice(s
-00045c70: 656c 662e 6669 6e64 5f6d 6f73 745f 706f  elf.find_most_po
-00045c80: 7075 6c61 7465 645f 736c 6963 6528 7669  pulated_slice(vi
-00045c90: 6577 292c 0a20 2020 2020 2020 2020 2020  ew),.           
-00045ca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00045cb0: 2020 2020 2020 2020 2020 2020 2073 6b72               skr
-00045cc0: 742e 696d 6167 652e 5f73 6c69 6365 5f61  t.image._slice_a
-00045cd0: 7865 735b 7669 6577 5d29 290a 0a20 2020  xes[view]))..   
-00045ce0: 2020 2020 2023 2056 6965 7720 7769 7468       # View with
-00045cf0: 2069 6d61 6765 0a20 2020 2020 2020 2069   image.        i
-00045d00: 6620 696e 636c 7564 655f 696d 6167 6520  f include_image 
-00045d10: 616e 6420 7365 6c66 2e69 6d61 6765 2069  and self.image i
-00045d20: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
-00045d30: 2020 2020 2020 2020 6966 2072 6f69 7320          if rois 
-00045d40: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
-00045d50: 2020 2020 2020 2020 2072 6f69 7320 3d20           rois = 
-00045d60: 7365 6c66 0a20 2020 2020 2020 2020 2020  self.           
-00045d70: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-00045d80: 2020 2020 2020 2069 6620 736b 7274 2e63         if skrt.c
-00045d90: 6f72 652e 6973 5f6c 6973 7428 726f 6973  ore.is_list(rois
-00045da0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-00045db0: 2020 2020 2020 2072 6f69 7320 3d20 5b73         rois = [s
-00045dc0: 656c 665d 202b 2072 6f69 730a 2020 2020  elf] + rois.    
-00045dd0: 2020 2020 2020 2020 2020 2020 656c 7365              else
-00045de0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00045df0: 2020 2020 2020 726f 6973 203d 205b 7365        rois = [se
-00045e00: 6c66 2c20 726f 6973 5d0a 2020 2020 2020  lf, rois].      
-00045e10: 2020 2020 2020 6276 203d 2042 6574 7465        bv = Bette
-00045e20: 7256 6965 7765 7228 7365 6c66 2e69 6d61  rViewer(self.ima
-00045e30: 6765 2c20 726f 6973 3d72 6f69 732c 202a  ge, rois=rois, *
-00045e40: 2a6b 7761 7267 7329 0a0a 2020 2020 2020  *kwargs)..      
-00045e50: 2020 2320 5669 6577 2077 6974 686f 7574    # View without
-00045e60: 2069 6d61 6765 0a20 2020 2020 2020 2065   image.        e
-00045e70: 6c73 653a 0a0a 2020 2020 2020 2020 2020  lse:..          
-00045e80: 2020 7374 7275 6374 7572 655f 7365 745f    structure_set_
-00045e90: 746d 7020 3d20 7365 6c66 0a0a 2020 2020  tmp = self..    
-00045ea0: 2020 2020 2020 2020 2320 4d61 6b65 2064          # Make d
-00045eb0: 756d 6d79 2069 6d61 6765 0a20 2020 2020  ummy image.     
-00045ec0: 2020 2020 2020 2069 6620 7365 6c66 2e72         if self.r
-00045ed0: 6f69 735b 305d 2e63 6f6e 746f 7572 735f  ois[0].contours_
-00045ee0: 6f6e 6c79 3a0a 2020 2020 2020 2020 2020  only:.          
-00045ef0: 2020 2020 2020 696d 203d 2073 656c 662e        im = self.
-00045f00: 6765 745f 6475 6d6d 795f 696d 6167 6528  get_dummy_image(
-00045f10: 6275 6666 6572 3d62 7566 6665 722c 200a  buffer=buffer, .
-00045f20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00045f30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00045f40: 2020 2020 2020 2020 2020 766f 7865 6c5f            voxel_
-00045f50: 7369 7a65 3d76 6f78 656c 5f73 697a 6529  size=voxel_size)
-00045f60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00045f70: 2073 7472 7563 7475 7265 5f73 6574 5f74   structure_set_t
-00045f80: 6d70 203d 2073 656c 662e 636c 6f6e 6528  mp = self.clone(
-00045f90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00045fa0: 2020 2020 2063 6f70 795f 726f 6973 3d54       copy_rois=T
-00045fb0: 7275 652c 200a 2020 2020 2020 2020 2020  rue, .          
-00045fc0: 2020 2020 2020 2020 2020 636f 7079 5f72            copy_r
-00045fd0: 6f69 5f64 6174 613d 4661 6c73 650a 2020  oi_data=False.  
-00045fe0: 2020 2020 2020 2020 2020 2020 2020 290a                ).
-00045ff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00046000: 666f 7220 726f 6920 696e 2073 7472 7563  for roi in struc
-00046010: 7475 7265 5f73 6574 5f74 6d70 2e72 6f69  ture_set_tmp.roi
-00046020: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
-00046030: 2020 2020 2020 2069 6620 726f 692e 636f         if roi.co
-00046040: 6e74 6f75 7273 5f6f 6e6c 793a 0a20 2020  ntours_only:.   
-00046050: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00046060: 2020 2020 2072 6f69 2e73 6574 5f69 6d61       roi.set_ima
-00046070: 6765 2869 6d29 0a20 2020 2020 2020 2020  ge(im).         
-00046080: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00046090: 2020 2020 2020 2020 2069 6d20 3d20 736b           im = sk
-000460a0: 7274 2e69 6d61 6765 2e49 6d61 6765 280a  rt.image.Image(.
-000460b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000460c0: 2020 2020 6e70 2e6f 6e65 7328 7365 6c66      np.ones(self
-000460d0: 2e72 6f69 735b 305d 2e73 6861 7065 2920  .rois[0].shape) 
-000460e0: 2a20 3165 342c 0a20 2020 2020 2020 2020  * 1e4,.         
-000460f0: 2020 2020 2020 2020 2020 2061 6666 696e             affin
-00046100: 653d 7365 6c66 2e72 6f69 735b 305d 2e61  e=self.rois[0].a
-00046110: 6666 696e 652c 0a20 2020 2020 2020 2020  ffine,.         
-00046120: 2020 2020 2020 2029 0a0a 2020 2020 2020         )..      
-00046130: 2020 2020 2020 6966 2072 6f69 7320 6973        if rois is
-00046140: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-00046150: 2020 2020 2020 2072 6f69 7320 3d20 7374         rois = st
-00046160: 7275 6374 7572 655f 7365 745f 746d 700a  ructure_set_tmp.
-00046170: 2020 2020 2020 2020 2020 2020 656c 7365              else
-00046180: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00046190: 2020 6966 2073 6b72 742e 636f 7265 2e69    if skrt.core.i
-000461a0: 735f 6c69 7374 2872 6f69 7329 3a0a 2020  s_list(rois):.  
-000461b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000461c0: 2020 726f 6973 203d 205b 7374 7275 6374    rois = [struct
-000461d0: 7572 655f 7365 745f 746d 705d 202b 2072  ure_set_tmp] + r
-000461e0: 6f69 730a 2020 2020 2020 2020 2020 2020  ois.            
-000461f0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-00046200: 2020 2020 2020 2020 2020 2020 2020 726f                ro
-00046210: 6973 203d 205b 7374 7275 6374 7572 655f  is = [structure_
-00046220: 7365 745f 746d 702c 2072 6f69 735d 0a20  set_tmp, rois]. 
-00046230: 2020 2020 2020 2020 2020 206b 7761 7267             kwarg
-00046240: 735b 2273 686f 7722 5d20 3d20 4661 6c73  s["show"] = Fals
-00046250: 650a 2020 2020 2020 2020 2020 2020 6276  e.            bv
-00046260: 203d 2042 6574 7465 7256 6965 7765 7228   = BetterViewer(
-00046270: 696d 2c20 726f 6973 3d72 6f69 732c 202a  im, rois=rois, *
-00046280: 2a6b 7761 7267 7329 0a20 2020 2020 2020  *kwargs).       
-00046290: 2020 2020 2062 762e 6d61 6b65 5f75 6928       bv.make_ui(
-000462a0: 6e6f 5f69 6e74 656e 7369 7479 3d54 7275  no_intensity=Tru
-000462b0: 6529 0a20 2020 2020 2020 2020 2020 2062  e).            b
-000462c0: 762e 7368 6f77 2829 0a0a 2020 2020 2020  v.show()..      
-000462d0: 2020 7265 7475 726e 2062 760a 0a20 2020    return bv..   
-000462e0: 2064 6566 2067 6574 5f65 7874 656e 7428   def get_extent(
-000462f0: 7365 6c66 2c20 2a2a 6b77 6172 6773 293a  self, **kwargs):
-00046300: 0a20 2020 2020 2020 2022 2222 4765 7420  .        """Get 
-00046310: 6d69 6e20 616e 6420 6d61 7820 6578 7465  min and max exte
-00046320: 6e74 206f 6620 616c 6c20 524f 4973 2069  nt of all ROIs i
-00046330: 6e20 7468 6520 5374 7275 6374 7572 6553  n the StructureS
-00046340: 6574 2e22 2222 0a0a 2020 2020 2020 2020  et."""..        
-00046350: 616c 6c5f 6578 7465 6e74 7320 3d20 5b5d  all_extents = []
-00046360: 0a20 2020 2020 2020 2066 6f72 2072 6f69  .        for roi
-00046370: 2069 6e20 7365 6c66 2e67 6574 5f72 6f69   in self.get_roi
-00046380: 7328 6967 6e6f 7265 5f65 6d70 7479 3d54  s(ignore_empty=T
-00046390: 7275 6529 3a0a 2020 2020 2020 2020 2020  rue):.          
-000463a0: 2020 616c 6c5f 6578 7465 6e74 732e 6578    all_extents.ex
-000463b0: 7465 6e64 2872 6f69 2e67 6574 5f65 7874  tend(roi.get_ext
-000463c0: 656e 7428 2a2a 6b77 6172 6773 2929 0a20  ent(**kwargs)). 
-000463d0: 2020 2020 2020 2072 6574 7572 6e20 6d69         return mi
-000463e0: 6e28 616c 6c5f 6578 7465 6e74 7329 2c20  n(all_extents), 
-000463f0: 6d61 7828 616c 6c5f 6578 7465 6e74 7329  max(all_extents)
-00046400: 0a0a 2020 2020 6465 6620 6765 745f 6578  ..    def get_ex
-00046410: 7465 6e74 7328 7365 6c66 2c20 726f 695f  tents(self, roi_
-00046420: 6e61 6d65 733d 4e6f 6e65 2c20 6275 6666  names=None, buff
-00046430: 6572 3d4e 6f6e 652c 2062 7566 6665 725f  er=None, buffer_
-00046440: 756e 6974 733d 226d 6d22 2c0a 2020 2020  units="mm",.    
-00046450: 2020 2020 2020 2020 6d65 7468 6f64 3d4e          method=N
-00046460: 6f6e 652c 206f 7269 6769 6e3d 4e6f 6e65  one, origin=None
-00046470: 293a 0a20 2020 2020 2020 2022 2222 0a20  ):.        """. 
-00046480: 2020 2020 2020 2047 6574 206d 696e 696d         Get minim
-00046490: 756d 2061 6e64 206d 6178 696d 756d 2065  um and maximum e
-000464a0: 7874 656e 7420 6f66 2053 7472 7563 7475  xtent of Structu
-000464b0: 7265 5365 7420 524f 4973 2c0a 2020 2020  reSet ROIs,.    
-000464c0: 2020 2020 696e 206d 6d20 616c 6f6e 6720      in mm along 
-000464d0: 616c 6c20 7468 7265 6520 6178 6573 2c20  all three axes, 
-000464e0: 7265 7475 726e 6564 2069 6e20 6f72 6465  returned in orde
-000464f0: 7220 5b78 2c20 792c 207a 5d2e 0a20 2020  r [x, y, z]..   
-00046500: 2020 2020 204f 7074 696f 6e61 6c6c 7920       Optionally 
-00046510: 6170 706c 7920 6120 6275 6666 6572 2074  apply a buffer t
-00046520: 6f20 7468 6520 6578 7465 6e74 7320 7375  o the extents su
-00046530: 6368 2074 6861 7420 7468 6579 2063 6f76  ch that they cov
-00046540: 6572 0a20 2020 2020 2020 206d 6f72 6520  er.        more 
-00046550: 7468 616e 2074 6865 2072 6567 696f 6e20  than the region 
-00046560: 6f66 2074 6865 2052 4f49 732e 0a0a 2020  of the ROIs...  
-00046570: 2020 2020 2020 2a2a 5061 7261 6d65 7465        **Paramete
-00046580: 7273 3a2a 2a0a 0a20 2020 2020 2020 2072  rs:**..        r
-00046590: 6f69 5f6e 616d 6573 203a 206c 6973 742c  oi_names : list,
-000465a0: 2064 6566 6175 6c74 3d4e 6f6e 650a 2020   default=None.  
-000465b0: 2020 2020 2020 2020 2020 4c69 7374 206f            List o
-000465c0: 6620 6e61 6d65 7320 6f66 2052 4f49 7320  f names of ROIs 
-000465d0: 746f 2062 6520 636f 6e73 6964 6572 6564  to be considered
-000465e0: 2e20 2049 6620 4e6f 6e65 2c20 616c 6c20  .  If None, all 
-000465f0: 6f66 2074 6865 0a20 2020 2020 2020 2020  of the.         
-00046600: 2020 2073 7472 7563 7475 7265 2073 6574     structure set
-00046610: 2773 2052 4f49 7320 6172 6520 636f 6e73  's ROIs are cons
-00046620: 6964 6572 6564 2e0a 0a20 2020 2020 2020  idered...       
-00046630: 2062 7566 6665 7220 3a20 666c 6f61 742c   buffer : float,
-00046640: 2064 6566 6175 6c74 3d4e 6f6e 650a 2020   default=None.  
-00046650: 2020 2020 2020 2020 2020 4f70 7469 6f6e            Option
-00046660: 616c 2062 7566 6665 7220 746f 2061 6464  al buffer to add
-00046670: 2074 6f20 7468 6520 6578 7465 6e74 732e   to the extents.
-00046680: 2055 6e69 7473 2073 6574 2062 7920 6062   Units set by `b
-00046690: 7566 6665 725f 756e 6974 7360 2e0a 0a20  uffer_units`... 
-000466a0: 2020 2020 2020 2062 7566 6665 725f 756e         buffer_un
-000466b0: 6974 7320 3a20 7374 722c 2064 6566 6175  its : str, defau
-000466c0: 6c74 3d22 6d6d 220a 2020 2020 2020 2020  lt="mm".        
-000466d0: 2020 2020 556e 6974 7320 666f 7220 6275      Units for bu
-000466e0: 6666 6572 2c20 6966 2075 7369 6e67 2e20  ffer, if using. 
-000466f0: 4361 6e20 6265 2022 6d6d 222c 2022 766f  Can be "mm", "vo
-00046700: 7865 6c73 222c 206f 7220 2266 7261 6322  xels", or "frac"
-00046710: 2028 7768 6963 680a 2020 2020 2020 2020   (which.        
-00046720: 2020 2020 6170 706c 6965 7320 6275 6666      applies buff
-00046730: 6572 2061 7320 6120 6672 6163 7469 6f6e  er as a fraction
-00046740: 206f 6620 746f 7461 6c20 6c65 6e67 7468   of total length
-00046750: 2069 6e20 6561 6368 2064 696d 656e 7369   in each dimensi
-00046760: 6f6e 292e 0a0a 2020 2020 2020 2020 6d65  on)...        me
-00046770: 7468 6f64 203a 2073 7472 2c20 6465 6661  thod : str, defa
-00046780: 756c 743d 4e6f 6e65 0a20 2020 2020 2020  ult=None.       
-00046790: 2020 2020 204d 6574 686f 6420 746f 2075       Method to u
-000467a0: 7365 2066 6f72 2065 7874 656e 7420 6361  se for extent ca
-000467b0: 6c63 756c 6174 696f 6e2e 2043 616e 2062  lculation. Can b
-000467c0: 653a 200a 0a20 2020 2020 2020 2020 2020  e: ..           
-000467d0: 2020 2020 202a 2022 636f 6e74 6f75 7222       * "contour"
-000467e0: 3a20 6765 7420 6578 7465 6e74 2066 726f  : get extent fro
-000467f0: 6d20 6d69 6e2f 6d61 7820 706f 7369 7469  m min/max positi
-00046800: 6f6e 7320 6f66 2063 6f6e 746f 7572 2873  ons of contour(s
-00046810: 292e 0a20 2020 2020 2020 2020 2020 2020  )..             
-00046820: 2020 202a 2022 6d61 736b 223a 2067 6574     * "mask": get
-00046830: 2065 7874 656e 7420 6672 6f6d 206d 696e   extent from min
-00046840: 2f6d 6178 2070 6f73 6974 696f 6e73 206f  /max positions o
-00046850: 6620 766f 7865 6c73 2069 6e20 7468 6520  f voxels in the 
-00046860: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00046870: 2020 2062 696e 6172 7920 6d61 736b 2e0a     binary mask..
-00046880: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00046890: 2a20 4e6f 6e65 3a20 7573 6520 7468 6520  * None: use the 
-000468a0: 6d65 7468 6f64 2073 6574 2069 6e20 7365  method set in se
-000468b0: 6c66 2e64 6566 6175 6c74 5f67 656f 6d5f  lf.default_geom_
-000468c0: 6d65 7468 6f64 2e0a 0a20 2020 2020 2020  method...       
-000468d0: 206f 7269 6769 6e20 3a20 7475 706c 652c   origin : tuple,
-000468e0: 2064 6566 6175 6c74 3d4e 6f6e 650a 2020   default=None.  
-000468f0: 2020 2020 2020 2020 2020 5475 706c 6520            Tuple 
-00046900: 7370 6563 6966 7969 6e67 2074 6865 2028  specifying the (
-00046910: 782c 2079 2c20 7a29 2063 6f6f 7264 696e  x, y, z) coordin
-00046920: 6174 6573 206f 6620 7468 6520 706f 696e  ates of the poin
-00046930: 740a 2020 2020 2020 2020 2020 2020 7769  t.            wi
-00046940: 7468 2072 6573 7065 6374 2074 6f20 7768  th respect to wh
-00046950: 6963 6820 6578 7465 6e74 7320 6172 6520  ich extents are 
-00046960: 746f 2062 6520 6465 7465 726d 696e 6564  to be determined
-00046970: 2e0a 2020 2020 2020 2020 2020 2020 4966  ..            If
-00046980: 204e 6f6e 652c 2074 6865 6e20 2830 2c20   None, then (0, 
-00046990: 302c 2030 2920 6973 2075 7365 642e 0a20  0, 0) is used.. 
-000469a0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-000469b0: 2020 2072 6574 7572 6e20 7365 6c66 2e63     return self.c
-000469c0: 6f6d 6269 6e65 5f72 6f69 7328 726f 695f  ombine_rois(roi_
-000469d0: 6e61 6d65 7329 2e67 6574 5f65 7874 656e  names).get_exten
-000469e0: 7473 280a 2020 2020 2020 2020 2020 2020  ts(.            
-000469f0: 2020 2020 6275 6666 6572 2c20 6275 6666      buffer, buff
-00046a00: 6572 5f75 6e69 7473 2c20 6d65 7468 6f64  er_units, method
-00046a10: 2c20 6f72 6967 696e 290a 0a20 2020 2064  , origin)..    d
-00046a20: 6566 2067 6574 5f63 726f 705f 6c69 6d69  ef get_crop_limi
-00046a30: 7473 2873 656c 662c 2072 6f69 5f6e 616d  ts(self, roi_nam
-00046a40: 6573 3d4e 6f6e 652c 2063 726f 705f 6d61  es=None, crop_ma
-00046a50: 7267 696e 733d 4e6f 6e65 2c20 6d65 7468  rgins=None, meth
-00046a60: 6f64 3d4e 6f6e 6529 3a0a 2020 2020 2020  od=None):.      
-00046a70: 2020 2222 220a 2020 2020 2020 2020 4765    """.        Ge
-00046a80: 7420 6372 6f70 206c 696d 6974 7320 636f  t crop limits co
-00046a90: 7272 6573 706f 6e64 696e 6720 746f 2053  rresponding to S
-00046aa0: 7472 7563 7475 7265 5365 7420 524f 4920  tructureSet ROI 
-00046ab0: 6578 7465 6e74 7320 706c 7573 206d 6172  extents plus mar
-00046ac0: 6769 6e73 2e0a 0a20 2020 2020 2020 2054  gins...        T
-00046ad0: 6865 2074 7570 6c65 7320 6f66 206c 696d  he tuples of lim
-00046ae0: 6974 7320 7265 7475 726e 6564 2c20 696e  its returned, in
-00046af0: 2074 6865 206f 7264 6572 2028 782c 2079   the order (x, y
-00046b00: 2c20 7a29 2063 616e 0a20 2020 2020 2020  , z) can.       
-00046b10: 2062 6520 7573 6564 2c20 666f 7220 6578   be used, for ex
-00046b20: 616d 706c 652c 2061 7320 696e 7075 7473  ample, as inputs
-00046b30: 2074 6f20 736b 7274 2e69 6d61 6765 2e49   to skrt.image.I
-00046b40: 6d61 6765 2e63 726f 7028 292e 0a0a 2020  mage.crop()...  
-00046b50: 2020 2020 2020 5468 6973 206d 6574 686f        This metho
-00046b60: 6420 6973 2073 696d 696c 6172 2074 6f20  d is similar to 
-00046b70: 7468 6520 6d65 7468 6f64 2067 6574 5f65  the method get_e
-00046b80: 7874 656e 7473 2829 2c20 6275 7420 616c  xtents(), but al
-00046b90: 6c6f 7773 0a20 2020 2020 2020 2064 6966  lows.        dif
-00046ba0: 6665 7265 6e74 206d 6172 6769 6e73 206f  ferent margins o
-00046bb0: 6e20 6561 6368 2073 6964 6520 6f66 2074  n each side of t
-00046bc0: 6865 2053 7472 7563 7475 7265 5365 742e  he StructureSet.
-00046bd0: 0a0a 2020 2020 2020 2020 2a2a 5061 7261  ..        **Para
-00046be0: 6d65 7465 7273 3a2a 2a0a 0a20 2020 2020  meters:**..     
-00046bf0: 2020 2072 6f69 5f6e 616d 6573 203a 206c     roi_names : l
-00046c00: 6973 742c 2064 6566 6175 6c74 3d4e 6f6e  ist, default=Non
-00046c10: 650a 2020 2020 2020 2020 2020 2020 4c69  e.            Li
-00046c20: 7374 206f 6620 6e61 6d65 7320 6f66 2052  st of names of R
-00046c30: 4f49 7320 746f 2062 6520 636f 6e73 6964  OIs to be consid
-00046c40: 6572 6564 2e20 2049 6620 4e6f 6e65 2c20  ered.  If None, 
-00046c50: 616c 6c20 6f66 2074 6865 0a20 2020 2020  all of the.     
-00046c60: 2020 2020 2020 2073 7472 7563 7475 7265         structure
-00046c70: 2073 6574 2773 2052 4f49 7320 6172 6520   set's ROIs are 
-00046c80: 636f 6e73 6964 6572 6564 2e0a 0a20 2020  considered...   
-00046c90: 2020 2020 2063 726f 705f 6d61 7267 696e       crop_margin
-00046ca0: 7320 3a20 666c 6f61 742f 7475 706c 652c  s : float/tuple,
-00046cb0: 2064 6566 6175 6c74 3d4e 6f6e 650a 2020   default=None.  
-00046cc0: 2020 2020 2020 2020 2020 466c 6f61 7420            Float 
-00046cd0: 6f72 2074 6872 6565 2d65 6c65 6d65 6e74  or three-element
-00046ce0: 2074 7570 6c65 2073 7065 6369 6679 696e   tuple specifyin
-00046cf0: 6720 7468 6520 6d61 7267 696e 732c 2069  g the margins, i
-00046d00: 6e20 6d6d 2c0a 2020 2020 2020 2020 2020  n mm,.          
-00046d10: 2020 746f 2062 6520 6164 6465 6420 746f    to be added to
-00046d20: 2053 7472 7563 7475 7265 5365 7420 6578   StructureSet ex
-00046d30: 7465 6e74 732e 2020 4966 2061 2066 6c6f  tents.  If a flo
-00046d40: 6174 2c20 6d69 6e75 7320 616e 6420 706c  at, minus and pl
-00046d50: 7573 2074 6865 0a20 2020 2020 2020 2020  us the.         
-00046d60: 2020 2076 616c 7565 2073 7065 6369 6669     value specifi
-00046d70: 6564 2061 7265 2061 6464 6564 2074 6f20  ed are added to 
-00046d80: 6c6f 7765 7220 616e 6420 7570 7065 7220  lower and upper 
-00046d90: 6578 7465 6e74 7320 7265 7370 6563 7469  extents respecti
-00046da0: 7665 6c79 0a20 2020 2020 2020 2020 2020  vely.           
-00046db0: 2061 6c6f 6e67 2065 6163 6820 6178 6973   along each axis
-00046dc0: 2e20 2049 6620 6120 7468 7265 652d 656c  .  If a three-el
-00046dd0: 656d 656e 7420 7475 706c 652c 2065 6c65  ement tuple, ele
-00046de0: 6d65 6e74 7320 6172 650a 2020 2020 2020  ments are.      
-00046df0: 2020 2020 2020 7461 6b65 6e20 746f 2073        taken to s
-00046e00: 7065 6369 6679 206d 6172 6769 6e73 2069  pecify margins i
-00046e10: 6e20 7468 6520 6f72 6465 7220 2878 2c20  n the order (x, 
-00046e20: 792c 207a 292e 2020 456c 656d 656e 7473  y, z).  Elements
-00046e30: 0a20 2020 2020 2020 2020 2020 2063 616e  .            can
-00046e40: 2062 6520 6569 7468 6572 2066 6c6f 6174   be either float
-00046e50: 7320 286d 696e 7573 2061 6e64 2070 6c75  s (minus and plu
-00046e60: 7320 7468 6520 7661 6c75 6520 6164 6465  s the value adde
-00046e70: 6420 7265 7370 6563 7469 7665 6c79 0a20  d respectively. 
-00046e80: 2020 2020 2020 2020 2020 2074 6f20 6c6f             to lo
-00046e90: 7765 7220 616e 6420 7570 7065 7220 6578  wer and upper ex
-00046ea0: 7465 6e74 7329 206f 7220 7477 6f2d 656c  tents) or two-el
-00046eb0: 656d 656e 7420 7475 706c 6573 2028 656c  ement tuples (el
-00046ec0: 656d 656e 7473 2030 2061 6e64 2031 0a20  ements 0 and 1. 
-00046ed0: 2020 2020 2020 2020 2020 2061 6464 6564             added
-00046ee0: 2072 6573 7065 6374 6976 656c 7920 746f   respectively to
-00046ef0: 206c 6f77 6572 2061 6e64 2075 7070 6572   lower and upper
-00046f00: 2065 7874 656e 7473 292e 0a0a 2020 2020   extents)...    
-00046f10: 2020 2020 6d65 7468 6f64 203a 2073 7472      method : str
-00046f20: 2c20 6465 6661 756c 743d 4e6f 6e65 0a20  , default=None. 
-00046f30: 2020 2020 2020 2020 2020 204d 6574 686f             Metho
-00046f40: 6420 746f 2075 7365 2066 6f72 2065 7874  d to use for ext
-00046f50: 656e 7420 6361 6c63 756c 6174 696f 6e2e  ent calculation.
-00046f60: 2043 616e 2062 653a 0a0a 2020 2020 2020   Can be:..      
-00046f70: 2020 2020 2020 2020 2020 2a20 2263 6f6e            * "con
-00046f80: 746f 7572 223a 2067 6574 2065 7874 656e  tour": get exten
-00046f90: 7420 6672 6f6d 206d 696e 2f6d 6178 2070  t from min/max p
-00046fa0: 6f73 6974 696f 6e73 206f 6620 636f 6e74  ositions of cont
-00046fb0: 6f75 7228 7329 2e0a 2020 2020 2020 2020  our(s)..        
-00046fc0: 2020 2020 2020 2020 2a20 226d 6173 6b22          * "mask"
-00046fd0: 3a20 6765 7420 6578 7465 6e74 2066 726f  : get extent fro
-00046fe0: 6d20 6d69 6e2f 6d61 7820 706f 7369 7469  m min/max positi
-00046ff0: 6f6e 7320 6f66 2076 6f78 656c 7320 696e  ons of voxels in
-00047000: 2074 6865 0a20 2020 2020 2020 2020 2020   the.           
-00047010: 2020 2020 2020 2062 696e 6172 7920 6d61         binary ma
-00047020: 736b 2e0a 2020 2020 2020 2020 2020 2020  sk..            
-00047030: 2020 2020 2a20 4e6f 6e65 3a20 7573 6520      * None: use 
-00047040: 7468 6520 6d65 7468 6f64 2073 6574 2069  the method set i
-00047050: 6e20 7365 6c66 2e64 6566 6175 6c74 5f67  n self.default_g
-00047060: 656f 6d5f 6d65 7468 6f64 2e0a 2020 2020  eom_method..    
-00047070: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-00047080: 7265 7475 726e 2073 656c 662e 636f 6d62  return self.comb
-00047090: 696e 655f 726f 6973 2872 6f69 5f6e 616d  ine_rois(roi_nam
-000470a0: 6573 292e 6765 745f 6372 6f70 5f6c 696d  es).get_crop_lim
-000470b0: 6974 7328 0a20 2020 2020 2020 2020 2020  its(.           
-000470c0: 2020 2020 2063 726f 705f 6d61 7267 696e       crop_margin
-000470d0: 732c 206d 6574 686f 6429 0a0a 2020 2020  s, method)..    
-000470e0: 6465 6620 6765 745f 6262 6f78 5f63 656e  def get_bbox_cen
-000470f0: 7472 655f 616e 645f 7769 6474 6873 2873  tre_and_widths(s
-00047100: 656c 662c 0a20 2020 2020 2020 2020 2020  elf,.           
-00047110: 2072 6f69 5f6e 616d 6573 3d4e 6f6e 652c   roi_names=None,
-00047120: 2062 7566 6665 723d 4e6f 6e65 2c20 6275   buffer=None, bu
-00047130: 6666 6572 5f75 6e69 7473 3d22 6d6d 222c  ffer_units="mm",
-00047140: 206d 6574 686f 643d 4e6f 6e65 293a 0a20   method=None):. 
-00047150: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-00047160: 2020 2047 6574 2063 656e 7472 6520 616e     Get centre an
-00047170: 6420 7769 6474 6873 2069 6e20 6d6d 2061  d widths in mm a
-00047180: 6c6f 6e67 2061 6c6c 2074 6872 6565 2061  long all three a
-00047190: 7865 7320 6f66 2061 2062 6f75 6e64 696e  xes of a boundin
-000471a0: 6720 626f 780a 2020 2020 2020 2020 656e  g box.        en
-000471b0: 636c 6f73 696e 6720 5374 7275 6374 7572  closing Structur
-000471c0: 6553 6574 2052 4f49 7320 616e 6420 6f70  eSet ROIs and op
-000471d0: 7469 6f6e 616c 2062 7566 6665 722e 2020  tional buffer.  
-000471e0: 4365 6e74 7265 0a20 2020 2020 2020 2061  Centre.        a
-000471f0: 6e64 2077 6964 7468 7320 6172 6520 7265  nd widths are re
-00047200: 7475 726e 6564 2061 7320 6120 7475 706c  turned as a tupl
-00047210: 6520 285b 782c 2079 2c20 7a5d 2c20 5b64  e ([x, y, z], [d
-00047220: 782c 2064 792c 2064 7a5d 292e 0a0a 2020  x, dy, dz])...  
-00047230: 2020 2020 2020 4d65 7468 6f64 2070 6172        Method par
-00047240: 616d 6574 6572 7320 6172 6520 7061 7373  ameters are pass
-00047250: 6564 2074 6f0a 2020 2020 2020 2020 736b  ed to.        sk
-00047260: 7274 2e73 7472 7563 7475 7265 732e 5374  rt.structures.St
-00047270: 7275 6374 7572 6553 6574 2e67 6574 5f65  ructureSet.get_e
-00047280: 7874 656e 7473 2829 2074 6f20 6f62 7461  xtents() to obta
-00047290: 696e 2053 7472 7563 7475 7265 5365 740a  in StructureSet.
-000472a0: 2020 2020 2020 2020 6578 7465 6e74 732e          extents.
-000472b0: 2020 466f 7220 7061 7261 6d65 7465 7220    For parameter 
-000472c0: 6578 706c 616e 6174 696f 6e73 2c20 7365  explanations, se
-000472d0: 650a 2020 2020 2020 2020 736b 7274 2e73  e.        skrt.s
-000472e0: 7472 7563 7475 7265 732e 5374 7275 6374  tructures.Struct
-000472f0: 7572 6553 6574 2e67 6574 5f65 7874 656e  ureSet.get_exten
-00047300: 7473 2829 2064 6f63 756d 656e 7461 7469  ts() documentati
-00047310: 6f6e 2e0a 2020 2020 2020 2020 2222 220a  on..        """.
-00047320: 2020 2020 2020 2020 6578 7465 6e74 7320          extents 
-00047330: 3d20 7365 6c66 2e67 6574 5f65 7874 656e  = self.get_exten
-00047340: 7473 2872 6f69 5f6e 616d 6573 2c20 6275  ts(roi_names, bu
-00047350: 6666 6572 2c20 6275 6666 6572 5f75 6e69  ffer, buffer_uni
-00047360: 7473 2c20 6d65 7468 6f64 2920 0a20 2020  ts, method) .   
-00047370: 2020 2020 2063 656e 7472 6520 3d20 5b30       centre = [0
-00047380: 2e35 202a 2028 6578 7465 6e74 5b30 5d20  .5 * (extent[0] 
-00047390: 2b20 6578 7465 6e74 5b31 5d29 2066 6f72  + extent[1]) for
-000473a0: 2065 7874 656e 7420 696e 2065 7874 656e   extent in exten
-000473b0: 7473 5d0a 2020 2020 2020 2020 7769 6474  ts].        widt
-000473c0: 6873 203d 205b 2865 7874 656e 745b 315d  hs = [(extent[1]
-000473d0: 202d 2065 7874 656e 745b 305d 2920 666f   - extent[0]) fo
-000473e0: 7220 6578 7465 6e74 2069 6e20 6578 7465  r extent in exte
-000473f0: 6e74 735d 0a20 2020 2020 2020 2072 6574  nts].        ret
-00047400: 7572 6e20 2863 656e 7472 652c 2077 6964  urn (centre, wid
-00047410: 7468 7329 0a0a 2020 2020 6465 6620 6765  ths)..    def ge
-00047420: 745f 6475 6d6d 795f 696d 6167 6528 7365  t_dummy_image(se
-00047430: 6c66 2c20 2a2a 6b77 6172 6773 293a 0a20  lf, **kwargs):. 
-00047440: 2020 2020 2020 2022 2222 4d61 6b65 2061         """Make a
-00047450: 2064 756d 6d79 2069 6d61 6765 2074 6861   dummy image tha
-00047460: 7420 636f 7665 7273 2074 6865 2061 7265  t covers the are
-00047470: 6120 7370 616e 6e65 6420 6279 2061 6c6c  a spanned by all
-00047480: 2052 4f49 7320 696e 2074 6869 730a 2020   ROIs in this.  
-00047490: 2020 2020 2020 5374 7275 6374 7572 6553        StructureS
-000474a0: 6574 2e20 5265 7475 726e 7320 616e 2049  et. Returns an I
-000474b0: 6d61 6765 206f 626a 6563 742e 0a0a 2020  mage object...  
-000474c0: 2020 2020 2020 2a2a 5061 7261 6d65 7465        **Paramete
-000474d0: 7273 3a2a 2a0a 2020 2020 2020 2020 0a20  rs:**.        . 
-000474e0: 2020 2020 2020 2076 6f78 656c 5f73 697a         voxel_siz
-000474f0: 6520 3a20 6c69 7374 2c20 6465 6661 756c  e : list, defaul
-00047500: 743d 4e6f 6e65 0a20 2020 2020 2020 2020  t=None.         
-00047510: 2020 2056 6f78 656c 2073 697a 6520 696e     Voxel size in
-00047520: 206d 6d20 696e 2074 6865 2064 756d 6d79   mm in the dummy
-00047530: 2069 6d61 6765 2069 6e20 7468 6520 782d   image in the x-
-00047540: 7920 706c 616e 652c 2067 6976 656e 2061  y plane, given a
-00047550: 7320 0a20 2020 2020 2020 2020 2020 205b  s .            [
-00047560: 7678 2c20 7679 5d2e 2049 6620 3c73 6861  vx, vy]. If <sha
-00047570: 7065 3e20 616e 6420 3c76 6f78 656c 5f73  pe> and <voxel_s
-00047580: 697a 653e 2061 7265 2062 6f74 6820 4e6f  ize> are both No
-00047590: 6e65 2c20 766f 7865 6c20 7369 7a65 7320  ne, voxel sizes 
-000475a0: 6f66 0a20 2020 2020 2020 2020 2020 205b  of.            [
-000475b0: 312c 2031 5d20 7769 6c6c 2062 6520 7573  1, 1] will be us
-000475c0: 6564 2062 7920 6465 6661 756c 742e 2054  ed by default. T
-000475d0: 6865 2076 6f78 656c 2073 697a 6520 696e  he voxel size in
-000475e0: 2074 6865 207a 2064 6972 6563 7469 6f6e   the z direction
-000475f0: 200a 2020 2020 2020 2020 2020 2020 6973   .            is
-00047600: 2064 6566 696e 6564 2062 7920 3c73 6c69   defined by <sli
-00047610: 6365 5f74 6869 636b 6e65 7373 3e2e 0a0a  ce_thickness>...
-00047620: 2020 2020 2020 2020 7368 6170 6520 3a20          shape : 
-00047630: 6c69 7374 2c20 6465 6661 756c 743d 4e6f  list, default=No
-00047640: 6e65 0a20 2020 2020 2020 2020 2020 204e  ne.            N
-00047650: 756d 6265 7220 6f66 2076 6f78 656c 7320  umber of voxels 
-00047660: 696e 2074 6865 2064 756d 6d79 2069 6d61  in the dummy ima
-00047670: 6765 2069 6e20 7468 6520 782d 7920 706c  ge in the x-y pl
-00047680: 616e 652c 2067 6976 656e 2061 730a 2020  ane, given as.  
-00047690: 2020 2020 2020 2020 2020 5b6e 782c 206e            [nx, n
-000476a0: 795d 2e20 4f6e 6c79 2075 7365 6420 6966  y]. Only used if
-000476b0: 203c 766f 7865 6c5f 7369 7a65 3e20 6973   <voxel_size> is
-000476c0: 204e 6f6e 652e 200a 2020 2020 2020 2020   None. .        
-000476d0: 2020 2020 5468 6520 6e75 6d62 6572 206f      The number o
-000476e0: 6620 766f 7865 6c73 2069 6e20 7468 6520  f voxels in the 
-000476f0: 7a20 6469 7265 6374 696f 6e20 7769 6c6c  z direction will
-00047700: 2062 6520 7461 6b65 6e20 6672 6f6d 2074   be taken from t
-00047710: 6865 200a 2020 2020 2020 2020 2020 2020  he .            
-00047720: 6e75 6d62 6572 206f 6620 736c 6963 6573  number of slices
-00047730: 2069 6e20 7468 6520 782d 7920 636f 6e74   in the x-y cont
-00047740: 6f75 7273 2064 6963 7469 6f6e 6172 792e  ours dictionary.
-00047750: 0a0a 2020 2020 2020 2020 6669 6c6c 5f76  ..        fill_v
-00047760: 616c 203a 2069 6e74 2f66 6c6f 6174 2c20  al : int/float, 
-00047770: 6465 6661 756c 743d 3165 340a 2020 2020  default=1e4.    
-00047780: 2020 2020 2020 2020 5661 6c75 6520 7769          Value wi
-00047790: 7468 2077 6869 6368 2074 6865 2076 6f78  th which the vox
-000477a0: 656c 7320 696e 2074 6865 2064 756d 6d79  els in the dummy
-000477b0: 2069 6d61 6765 2073 686f 756c 6420 6265   image should be
-000477c0: 2066 696c 6c65 642e 200a 0a20 2020 2020   filled. ..     
-000477d0: 2020 2062 7566 6665 7220 3a20 696e 742c     buffer : int,
-000477e0: 2064 6566 6175 6c74 3d31 0a20 2020 2020   default=1.     
-000477f0: 2020 2020 2020 204e 756d 6265 7220 6f66         Number of
-00047800: 2065 6d70 7479 2062 7566 6665 7220 766f   empty buffer vo
-00047810: 7865 6c73 2074 6f20 6164 6420 6f75 7473  xels to add outs
-00047820: 6964 6520 7468 6520 524f 4920 696e 2065  ide the ROI in e
-00047830: 6163 680a 2020 2020 2020 2020 2020 2020  ach.            
-00047840: 6469 7265 6374 696f 6e2e 0a0a 2020 2020  direction...    
-00047850: 2020 2020 736c 6963 655f 7468 6963 6b6e      slice_thickn
-00047860: 6573 7320 3a20 666c 6f61 742c 2064 6566  ess : float, def
-00047870: 6175 6c74 3d4e 6f6e 650a 2020 2020 2020  ault=None.      
-00047880: 2020 2020 2020 566f 7865 6c20 7369 7a65        Voxel size
-00047890: 2069 6e20 6d6d 2069 6e20 7468 6520 6475   in mm in the du
-000478a0: 6d6d 7920 696d 6167 6520 696e 2074 6865  mmy image in the
-000478b0: 207a 2064 6972 6563 7469 6f6e 2e20 2049   z direction.  I
-000478c0: 6620 4e6f 6e65 2c0a 2020 2020 2020 2020  f None,.        
-000478d0: 2020 2020 7468 6520 7661 6c75 6520 7573      the value us
-000478e0: 6564 2069 7320 7468 6520 6d69 6e69 6d75  ed is the minimu
-000478f0: 6d20 6469 7374 616e 6365 2062 6574 7765  m distance betwe
-00047900: 656e 2073 6c69 6365 2070 6f73 6974 696f  en slice positio
-00047910: 6e73 0a20 2020 2020 2020 2020 2020 2069  ns.            i
-00047920: 6e20 7468 6520 782d 7920 636f 6e74 6f75  n the x-y contou
-00047930: 7273 2064 6963 7469 6f6e 6172 792e 0a20  rs dictionary.. 
-00047940: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-00047950: 2020 2065 7874 656e 7473 203d 205b 7365     extents = [se
-00047960: 6c66 2e67 6574 5f65 7874 656e 7428 6178  lf.get_extent(ax
-00047970: 3d61 7829 2066 6f72 2061 7820 696e 2073  =ax) for ax in s
-00047980: 6b72 742e 696d 6167 652e 5f61 7865 735d  krt.image._axes]
-00047990: 0a20 2020 2020 2020 2073 6c69 6365 5f74  .        slice_t
-000479a0: 6869 636b 6e65 7373 203d 206b 7761 7267  hickness = kwarg
-000479b0: 732e 706f 7028 2273 6c69 6365 5f74 6869  s.pop("slice_thi
-000479c0: 636b 6e65 7373 222c 204e 6f6e 6529 0a20  ckness", None). 
-000479d0: 2020 2020 2020 2073 6c69 6365 5f74 6869         slice_thi
-000479e0: 636b 6e65 7373 203d 2028 736c 6963 655f  ckness = (slice_
-000479f0: 7468 6963 6b6e 6573 7320 6f72 0a20 2020  thickness or.   
-00047a00: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-00047a10: 662e 6765 745f 726f 6973 2869 676e 6f72  f.get_rois(ignor
-00047a20: 655f 656d 7074 793d 5472 7565 295b 305d  e_empty=True)[0]
-00047a30: 5c0a 2020 2020 2020 2020 2020 2020 2020  \.              
-00047a40: 2020 2020 2020 2020 2020 2e67 6574 5f73            .get_s
-00047a50: 6c69 6365 5f74 6869 636b 6e65 7373 5f63  lice_thickness_c
-00047a60: 6f6e 746f 7572 7328 2929 0a20 2020 2020  ontours()).     
-00047a70: 2020 2072 6574 7572 6e20 6372 6561 7465     return create
-00047a80: 5f64 756d 6d79 5f69 6d61 6765 2865 7874  _dummy_image(ext
-00047a90: 656e 7473 2c20 736c 6963 655f 7468 6963  ents, slice_thic
-00047aa0: 6b6e 6573 732c 202a 2a6b 7761 7267 7329  kness, **kwargs)
-00047ab0: 0a0a 2020 2020 6465 6620 5f67 6574 5f63  ..    def _get_c
-00047ac0: 6f6d 6269 6e61 7469 6f6e 2873 656c 662c  ombination(self,
-00047ad0: 206e 616d 652c 2066 6f72 6365 2c20 6578   name, force, ex
-00047ae0: 636c 7564 652c 2063 6f6d 626f 5f6d 616b  clude, combo_mak
-00047af0: 6572 2c20 2a2a 6b77 6172 6773 293a 0a20  er, **kwargs):. 
-00047b00: 2020 2020 2020 2022 2222 4569 7468 6572         """Either
-00047b10: 2067 6574 2061 6e20 616c 7265 6164 7920   get an already 
-00047b20: 6361 6c63 756c 6174 6564 2063 6f6d 6269  calculated combi
-00047b30: 6e61 7469 6f6e 2066 726f 6d20 7468 6520  nation from the 
-00047b40: 6361 6368 650a 2020 2020 2020 2020 6f72  cache.        or
-00047b50: 2063 7265 6174 6520 6974 2c20 6361 6368   create it, cach
-00047b60: 6520 6974 2c20 616e 6420 7265 7475 726e  e it, and return
-00047b70: 2069 742e 2222 220a 0a20 2020 2020 2020   it."""..       
-00047b80: 2023 2052 6574 7572 6e20 6361 6368 6564   # Return cached
-00047b90: 2072 6573 756c 7420 6966 2069 7420 6578   result if it ex
-00047ba0: 6973 7473 2061 6e64 206e 6f74 2066 6f72  ists and not for
-00047bb0: 6369 6e67 0a20 2020 2020 2020 2061 7474  cing.        att
-00047bc0: 7220 3d20 6622 5f7b 6e61 6d65 7d22 0a20  r = f"_{name}". 
-00047bd0: 2020 2020 2020 2069 6620 6578 636c 7564         if exclud
-00047be0: 653a 0a20 2020 2020 2020 2020 2020 2061  e:.            a
-00047bf0: 7474 7220 2b3d 2066 225f 6578 636c 7564  ttr += f"_exclud
-00047c00: 6564 220a 2020 2020 2020 2020 6966 206e  ed".        if n
-00047c10: 6f74 2066 6f72 6365 3a0a 2020 2020 2020  ot force:.      
-00047c20: 2020 2020 2020 6966 2065 7863 6c75 6465        if exclude
-00047c30: 2069 7320 4e6f 6e65 2061 6e64 2068 6173   is None and has
-00047c40: 6174 7472 2873 656c 662c 2061 7474 7229  attr(self, attr)
-00047c50: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00047c60: 2020 7265 7475 726e 2067 6574 6174 7472    return getattr
-00047c70: 2873 656c 662c 2061 7474 7229 0a20 2020  (self, attr).   
-00047c80: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
-00047c90: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00047ca0: 6620 6861 7361 7474 7228 7365 6c66 2c20  f hasattr(self, 
-00047cb0: 6174 7472 2920 616e 6420 6578 636c 7564  attr) and exclud
-00047cc0: 6520 696e 2067 6574 6174 7472 2873 656c  e in getattr(sel
-00047cd0: 662c 2061 7474 7229 3a0a 2020 2020 2020  f, attr):.      
-00047ce0: 2020 2020 2020 2020 2020 2020 2020 7265                re
-00047cf0: 7475 726e 2067 6574 6174 7472 2873 656c  turn getattr(sel
-00047d00: 662c 2061 7474 7229 5b65 7863 6c75 6465  f, attr)[exclude
-00047d10: 5d0a 0a20 2020 2020 2020 2023 2047 6574  ]..        # Get
-00047d20: 206c 6973 7420 6f66 2052 4f49 7320 746f   list of ROIs to
-00047d30: 2069 6e63 6c75 6465 2069 6e20 7468 6973   include in this
-00047d40: 2063 6f6d 6269 6e61 7469 6f6e 2052 4f49   combination ROI
-00047d50: 0a20 2020 2020 2020 2069 6620 6578 636c  .        if excl
-00047d60: 7564 6520 6973 206e 6f74 204e 6f6e 653a  ude is not None:
-00047d70: 0a0a 2020 2020 2020 2020 2020 2020 6966  ..            if
-00047d80: 2065 7863 6c75 6465 206e 6f74 2069 6e20   exclude not in 
-00047d90: 7365 6c66 2e67 6574 5f72 6f69 5f6e 616d  self.get_roi_nam
-00047da0: 6573 2829 3a0a 2020 2020 2020 2020 2020  es():.          
-00047db0: 2020 2020 2020 7072 696e 7428 6622 524f        print(f"RO
-00047dc0: 4920 746f 2065 7863 6c75 6465 207b 6578  I to exclude {ex
-00047dd0: 636c 7564 657d 206e 6f74 2066 6f75 6e64  clude} not found
-00047de0: 2e22 290a 2020 2020 2020 2020 2020 2020  .").            
-00047df0: 2020 2020 7265 7475 726e 0a0a 2020 2020      return..    
-00047e00: 2020 2020 2020 2020 726f 6973 5f74 6f5f          rois_to_
-00047e10: 696e 636c 7564 6520 3d20 5b72 6f69 2066  include = [roi f
-00047e20: 6f72 2072 6f69 2069 6e20 7365 6c66 2e72  or roi in self.r
-00047e30: 6f69 7320 6966 2072 6f69 2e6e 616d 6520  ois if roi.name 
-00047e40: 213d 2065 7863 6c75 6465 5d0a 0a20 2020  != exclude]..   
-00047e50: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
-00047e60: 6861 7361 7474 7228 7365 6c66 2c20 6174  hasattr(self, at
-00047e70: 7472 293a 0a20 2020 2020 2020 2020 2020  tr):.           
-00047e80: 2020 2020 2073 6574 6174 7472 2873 656c       setattr(sel
-00047e90: 662c 2061 7474 722c 207b 7d29 0a20 2020  f, attr, {}).   
-00047ea0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-00047eb0: 2020 2020 2020 2072 6f69 735f 746f 5f69         rois_to_i
-00047ec0: 6e63 6c75 6465 203d 2073 656c 662e 726f  nclude = self.ro
-00047ed0: 6973 0a0a 2020 2020 2020 2020 2320 4d61  is..        # Ma
-00047ee0: 6b65 206b 7761 7267 7320 666f 7220 524f  ke kwargs for RO
-00047ef0: 4920 6372 6561 7469 6f6e 0a20 2020 2020  I creation.     
-00047f00: 2020 2072 6f69 5f6b 7761 7267 7320 3d20     roi_kwargs = 
-00047f10: 7365 6c66 2e72 6f69 5f6b 7761 7267 732e  self.roi_kwargs.
-00047f20: 636f 7079 2829 0a20 2020 2020 2020 2072  copy().        r
-00047f30: 6f69 5f6b 7761 7267 732e 7570 6461 7465  oi_kwargs.update
-00047f40: 286b 7761 7267 7329 0a20 2020 2020 2020  (kwargs).       
-00047f50: 2072 6f69 5f6b 7761 7267 735b 226e 616d   roi_kwargs["nam
-00047f60: 6522 5d20 3d20 6e61 6d65 0a20 2020 2020  e"] = name.     
-00047f70: 2020 2072 6f69 5f6b 7761 7267 735b 2269     roi_kwargs["i
-00047f80: 6d61 6765 225d 203d 2073 656c 662e 696d  mage"] = self.im
-00047f90: 6167 650a 2020 2020 2020 2020 726f 695f  age.        roi_
-00047fa0: 6b77 6172 6773 5b22 6166 6669 6e65 225d  kwargs["affine"]
-00047fb0: 203d 2072 6f69 735f 746f 5f69 6e63 6c75   = rois_to_inclu
-00047fc0: 6465 5b30 5d2e 6765 745f 6166 6669 6e65  de[0].get_affine
-00047fd0: 2873 7461 6e64 6172 6469 7365 3d54 7275  (standardise=Tru
-00047fe0: 6529 0a0a 2020 2020 2020 2020 2320 4372  e)..        # Cr
-00047ff0: 6561 7465 2074 6865 2052 4f49 0a20 2020  eate the ROI.   
-00048000: 2020 2020 2072 6f69 203d 2063 6f6d 626f       roi = combo
-00048010: 5f6d 616b 6572 2872 6f69 735f 746f 5f69  _maker(rois_to_i
-00048020: 6e63 6c75 6465 2c20 2a2a 726f 695f 6b77  nclude, **roi_kw
-00048030: 6172 6773 290a 0a20 2020 2020 2020 2023  args)..        #
-00048040: 2041 6464 2069 7420 746f 2074 6865 2063   Add it to the c
-00048050: 6163 6865 2061 6e64 2072 6574 7572 6e0a  ache and return.
-00048060: 2020 2020 2020 2020 6966 2065 7863 6c75          if exclu
-00048070: 6465 2069 7320 4e6f 6e65 3a0a 2020 2020  de is None:.    
-00048080: 2020 2020 2020 2020 7365 7461 7474 7228          setattr(
-00048090: 7365 6c66 2c20 6174 7472 2c20 726f 6929  self, attr, roi)
-000480a0: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
-000480b0: 2020 2020 2020 2020 2020 2067 6574 6174             getat
-000480c0: 7472 2873 656c 662c 2061 7474 7229 5b65  tr(self, attr)[e
-000480d0: 7863 6c75 6465 5d20 3d20 726f 690a 2020  xclude] = roi.  
-000480e0: 2020 2020 2020 7265 7475 726e 2072 6f69        return roi
-000480f0: 0a0a 2020 2020 6465 6620 6765 745f 636f  ..    def get_co
-00048100: 6e73 656e 7375 7328 7365 6c66 2c20 636f  nsensus(self, co
-00048110: 6e73 656e 7375 735f 7479 7065 2c20 636f  nsensus_type, co
-00048120: 6c6f 723d 2262 6c75 6522 2c20 2a2a 6b77  lor="blue", **kw
-00048130: 6172 6773 293a 0a0a 2020 2020 2020 2020  args):..        
-00048140: 2320 4765 7420 636f 6e73 656e 7375 7320  # Get consensus 
-00048150: 6361 6c63 756c 6174 696f 6e20 6675 6e63  calculation func
-00048160: 7469 6f6e 0a20 2020 2020 2020 2069 6620  tion.        if 
-00048170: 636f 6e73 656e 7375 735f 7479 7065 203d  consensus_type =
-00048180: 3d20 226d 616a 6f72 6974 7922 3a0a 2020  = "majority":.  
-00048190: 2020 2020 2020 2020 2020 636f 6e73 656e            consen
-000481a0: 7375 735f 6675 6e63 203d 2053 7472 7563  sus_func = Struc
-000481b0: 7475 7265 5365 742e 6765 745f 6d61 6a6f  tureSet.get_majo
-000481c0: 7269 7479 5f76 6f74 650a 2020 2020 2020  rity_vote.      
-000481d0: 2020 656c 6966 2063 6f6e 7365 6e73 7573    elif consensus
-000481e0: 5f74 7970 6520 3d3d 2022 7375 6d22 3a0a  _type == "sum":.
-000481f0: 2020 2020 2020 2020 2020 2020 636f 6e73              cons
-00048200: 656e 7375 735f 6675 6e63 203d 2053 7472  ensus_func = Str
-00048210: 7563 7475 7265 5365 742e 6765 745f 7375  uctureSet.get_su
-00048220: 6d0a 2020 2020 2020 2020 656c 6966 2063  m.        elif c
-00048230: 6f6e 7365 6e73 7573 5f74 7970 6520 3d3d  onsensus_type ==
-00048240: 2022 6f76 6572 6c61 7022 3a0a 2020 2020   "overlap":.    
-00048250: 2020 2020 2020 2020 636f 6e73 656e 7375          consensu
-00048260: 735f 6675 6e63 203d 2053 7472 7563 7475  s_func = Structu
-00048270: 7265 5365 742e 6765 745f 6f76 6572 6c61  reSet.get_overla
-00048280: 700a 2020 2020 2020 2020 656c 6966 2063  p.        elif c
-00048290: 6f6e 7365 6e73 7573 5f74 7970 6520 3d3d  onsensus_type ==
-000482a0: 2022 7374 6170 6c65 223a 0a20 2020 2020   "staple":.     
-000482b0: 2020 2020 2020 2063 6f6e 7365 6e73 7573         consensus
-000482c0: 5f66 756e 6320 3d20 5374 7275 6374 7572  _func = Structur
-000482d0: 6553 6574 2e67 6574 5f73 7461 706c 650a  eSet.get_staple.
-000482e0: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-000482f0: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-00048300: 5661 6c75 6545 7272 6f72 2866 2255 6e72  ValueError(f"Unr
-00048310: 6563 6f67 6e69 7365 6420 636f 6e73 656e  ecognised consen
-00048320: 7375 7320 7479 7065 3a20 7b63 6f6e 7365  sus type: {conse
-00048330: 6e73 7573 5f74 7970 657d 2229 0a0a 2020  nsus_type}")..  
-00048340: 2020 2020 2020 7265 7475 726e 2063 6f6e        return con
-00048350: 7365 6e73 7573 5f66 756e 6328 7365 6c66  sensus_func(self
-00048360: 2c20 636f 6c6f 723d 636f 6c6f 722c 202a  , color=color, *
-00048370: 2a6b 7761 7267 7329 0a0a 2020 2020 6465  *kwargs)..    de
-00048380: 6620 6765 745f 7374 6170 6c65 2873 656c  f get_staple(sel
-00048390: 662c 2066 6f72 6365 3d46 616c 7365 2c20  f, force=False, 
-000483a0: 6578 636c 7564 653d 4e6f 6e65 2c20 2a2a  exclude=None, **
-000483b0: 6b77 6172 6773 293a 0a20 2020 2020 2020  kwargs):.       
-000483c0: 2022 2222 4765 7420 524f 4920 6f62 6a65   """Get ROI obje
-000483d0: 6374 2072 6570 7265 7365 6e74 696e 6720  ct representing 
-000483e0: 7468 6520 5354 4150 4c45 2063 6f6d 6269  the STAPLE combi
-000483f0: 6e61 7469 6f6e 206f 6620 524f 4973 2069  nation of ROIs i
-00048400: 6e20 7468 6973 200a 2020 2020 2020 2020  n this .        
-00048410: 7374 7275 6374 7572 6520 7365 742e 2049  structure set. I
-00048420: 6620 3c65 7863 6c75 6465 3e20 6973 2073  f <exclude> is s
-00048430: 6574 2074 6f20 6120 7374 7269 6e67 2c20  et to a string, 
-00048440: 7468 6520 524f 4920 7769 7468 2074 6861  the ROI with tha
-00048450: 7420 6e61 6d65 200a 2020 2020 2020 2020  t name .        
-00048460: 7769 6c6c 2062 6520 6578 636c 7564 6564  will be excluded
-00048470: 2066 726f 6d20 7468 6520 6361 6c63 756c   from the calcul
-00048480: 6174 696f 6e2e 0a0a 2020 2020 2020 2020  ation...        
-00048490: 2a2a 5061 7261 6d65 7465 7273 3a2a 2a0a  **Parameters:**.
-000484a0: 0a20 2020 2020 2020 2066 6f72 6365 203a  .        force :
-000484b0: 2062 6f6f 6c2c 2064 6566 6175 6c74 3d46   bool, default=F
-000484c0: 616c 7365 0a20 2020 2020 2020 2020 2020  alse.           
-000484d0: 2049 6620 4661 6c73 6520 616e 6420 5354   If False and ST
-000484e0: 4150 4c45 2052 4f49 2068 6173 2061 6c72  APLE ROI has alr
-000484f0: 6561 6479 2062 6565 6e20 6372 6561 7465  eady been create
-00048500: 642c 2074 6865 200a 2020 2020 2020 2020  d, the .        
-00048510: 2020 2020 7072 6576 696f 7573 6c79 2063      previously c
-00048520: 6f6d 7075 7465 6420 524f 4920 7769 6c6c  omputed ROI will
-00048530: 2062 6520 7265 7475 726e 6564 2e20 4966   be returned. If
-00048540: 2046 6f72 6365 3d54 7275 652c 2074 6865   Force=True, the
-00048550: 200a 2020 2020 2020 2020 2020 2020 5354   .            ST
-00048560: 4150 4c45 2052 4f49 2077 696c 6c20 6265  APLE ROI will be
-00048570: 2072 6563 7265 6174 6564 2e0a 0a20 2020   recreated...   
-00048580: 2020 2020 2065 7863 6c75 6465 203a 2073       exclude : s
-00048590: 7472 2c20 6465 6661 756c 743d 4e6f 6e65  tr, default=None
-000485a0: 0a20 2020 2020 2020 2020 2020 2049 6620  .            If 
-000485b0: 7365 7420 746f 2061 2073 7472 696e 672c  set to a string,
-000485c0: 2074 6865 2066 6972 7374 2052 4f49 2069   the first ROI i
-000485d0: 6e20 7365 6c66 2e72 6f69 7320 7769 7468  n self.rois with
-000485e0: 2074 6861 7420 6e61 6d65 2077 696c 6c20   that name will 
-000485f0: 0a20 2020 2020 2020 2020 2020 2062 6520  .            be 
-00048600: 6578 636c 7564 6564 2066 726f 6d20 7468  excluded from th
-00048610: 6520 636f 6d62 696e 6174 696f 6e2e 2054  e combination. T
-00048620: 6869 7320 6d61 7920 6265 2075 7365 6675  his may be usefu
-00048630: 6c20 6966 2063 6f6d 7061 7269 736f 6e20  l if comparison 
-00048640: 0a20 2020 2020 2020 2020 2020 206f 6620  .            of 
-00048650: 6120 7369 6e67 6c65 2052 4f49 2077 6974  a single ROI wit
-00048660: 6820 7468 6520 636f 6e73 656e 7375 7320  h the consensus 
-00048670: 6f66 2061 6c6c 206f 7468 6572 7320 6973  of all others is
-00048680: 2064 6573 6972 6564 2e0a 0a20 2020 2020   desired...     
-00048690: 2020 2060 2a2a 606b 7761 7267 7320 3a0a     `**`kwargs :.
-000486a0: 2020 2020 2020 2020 2020 2020 4578 7472              Extr
-000486b0: 6120 6b65 7977 6f72 6420 6172 6775 6d65  a keyword argume
-000486c0: 6e74 7320 746f 2070 6173 7320 746f 2074  nts to pass to t
-000486d0: 6865 2063 7265 6174 696f 6e20 6f66 2074  he creation of t
-000486e0: 6865 2052 4f49 206f 626a 6563 740a 2020  he ROI object.  
-000486f0: 2020 2020 2020 2020 2020 7265 7072 6573            repres
-00048700: 656e 7469 6e67 2074 6865 2063 6f6d 6269  enting the combi
-00048710: 6e61 7469 6f6e 2e0a 2020 2020 2020 2020  nation..        
-00048720: 2222 220a 0a20 2020 2020 2020 2072 6574  """..        ret
-00048730: 7572 6e20 7365 6c66 2e5f 6765 745f 636f  urn self._get_co
-00048740: 6d62 696e 6174 696f 6e28 2273 7461 706c  mbination("stapl
-00048750: 6522 2c20 666f 7263 652c 2065 7863 6c75  e", force, exclu
-00048760: 6465 2c20 6372 6561 7465 5f73 7461 706c  de, create_stapl
-00048770: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
-00048780: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00048790: 2020 2020 2020 2020 2a2a 6b77 6172 6773          **kwargs
-000487a0: 290a 0a20 2020 2064 6566 2067 6574 5f6d  )..    def get_m
-000487b0: 616a 6f72 6974 795f 766f 7465 2873 656c  ajority_vote(sel
-000487c0: 662c 2066 6f72 6365 3d46 616c 7365 2c20  f, force=False, 
-000487d0: 6578 636c 7564 653d 4e6f 6e65 2c20 2a2a  exclude=None, **
-000487e0: 6b77 6172 6773 293a 0a20 2020 2020 2020  kwargs):.       
-000487f0: 2022 2222 4765 7420 524f 4920 6f62 6a65   """Get ROI obje
-00048800: 6374 2072 6570 7265 7365 6e74 696e 6720  ct representing 
-00048810: 7468 6520 6d61 6a6f 7269 7479 2076 6f74  the majority vot
-00048820: 6520 636f 6d62 696e 6174 696f 6e20 6f66  e combination of
-00048830: 2052 4f49 7320 696e 200a 2020 2020 2020   ROIs in .      
-00048840: 2020 7468 6973 2073 7472 7563 7475 7265    this structure
-00048850: 2073 6574 2e20 4966 203c 6578 636c 7564   set. If <exclud
-00048860: 653e 2069 7320 7365 7420 746f 2061 2073  e> is set to a s
-00048870: 7472 696e 672c 2074 6865 2052 4f49 2077  tring, the ROI w
-00048880: 6974 6820 7468 6174 200a 2020 2020 2020  ith that .      
-00048890: 2020 6e61 6d65 2077 696c 6c20 6265 2065    name will be e
-000488a0: 7863 6c75 6465 6420 6672 6f6d 2074 6865  xcluded from the
-000488b0: 2063 616c 6375 6c61 7469 6f6e 2e0a 0a20   calculation... 
-000488c0: 2020 2020 2020 202a 2a50 6172 616d 6574         **Paramet
-000488d0: 6572 733a 2a2a 0a0a 2020 2020 2020 2020  ers:**..        
-000488e0: 666f 7263 6520 3a20 626f 6f6c 2c20 6465  force : bool, de
-000488f0: 6661 756c 743d 4661 6c73 650a 2020 2020  fault=False.    
-00048900: 2020 2020 2020 2020 4966 2046 616c 7365          If False
-00048910: 2061 6e64 206d 616a 6f72 6974 7920 766f   and majority vo
-00048920: 7465 2052 4f49 2068 6173 2061 6c72 6561  te ROI has alrea
-00048930: 6479 2062 6565 6e20 6372 6561 7465 642c  dy been created,
-00048940: 2074 6865 200a 2020 2020 2020 2020 2020   the .          
-00048950: 2020 7072 6576 696f 7573 6c79 2063 6f6d    previously com
-00048960: 7075 7465 6420 524f 4920 7769 6c6c 2062  puted ROI will b
-00048970: 6520 7265 7475 726e 6564 2e20 4966 2046  e returned. If F
-00048980: 6f72 6365 3d54 7275 652c 2074 6865 200a  orce=True, the .
-00048990: 2020 2020 2020 2020 2020 2020 6d61 6a6f              majo
-000489a0: 7269 7479 2076 6f74 6520 524f 4920 7769  rity vote ROI wi
-000489b0: 6c6c 2062 6520 7265 6372 6561 7465 642e  ll be recreated.
-000489c0: 0a0a 2020 2020 2020 2020 6578 636c 7564  ..        exclud
-000489d0: 6520 3a20 7374 722c 2064 6566 6175 6c74  e : str, default
-000489e0: 3d4e 6f6e 650a 2020 2020 2020 2020 2020  =None.          
-000489f0: 2020 4966 2073 6574 2074 6f20 6120 7374    If set to a st
-00048a00: 7269 6e67 2c20 7468 6520 6669 7273 7420  ring, the first 
-00048a10: 524f 4920 696e 2073 656c 662e 726f 6973  ROI in self.rois
-00048a20: 2077 6974 6820 7468 6174 206e 616d 6520   with that name 
-00048a30: 7769 6c6c 200a 2020 2020 2020 2020 2020  will .          
-00048a40: 2020 6265 2065 7863 6c75 6465 6420 6672    be excluded fr
-00048a50: 6f6d 2074 6865 2063 6f6d 6269 6e61 7469  om the combinati
-00048a60: 6f6e 2e20 5468 6973 206d 6179 2062 6520  on. This may be 
-00048a70: 7573 6566 756c 2069 6620 636f 6d70 6172  useful if compar
-00048a80: 6973 6f6e 200a 2020 2020 2020 2020 2020  ison .          
-00048a90: 2020 6f66 2061 2073 696e 676c 6520 524f    of a single RO
-00048aa0: 4920 7769 7468 2074 6865 2063 6f6e 7365  I with the conse
-00048ab0: 6e73 7573 206f 6620 616c 6c20 6f74 6865  nsus of all othe
-00048ac0: 7273 2069 7320 6465 7369 7265 642e 0a0a  rs is desired...
-00048ad0: 2020 2020 2020 2020 602a 2a60 6b77 6172          `**`kwar
-00048ae0: 6773 203a 0a20 2020 2020 2020 2020 2020  gs :.           
-00048af0: 2045 7874 7261 206b 6579 776f 7264 2061   Extra keyword a
-00048b00: 7267 756d 656e 7473 2074 6f20 7061 7373  rguments to pass
-00048b10: 2074 6f20 7468 6520 6372 6561 7469 6f6e   to the creation
-00048b20: 206f 6620 7468 6520 524f 4920 6f62 6a65   of the ROI obje
-00048b30: 6374 0a20 2020 2020 2020 2020 2020 2072  ct.            r
-00048b40: 6570 7265 7365 6e74 696e 6720 7468 6520  epresenting the 
-00048b50: 636f 6d62 696e 6174 696f 6e2e 0a20 2020  combination..   
-00048b60: 2020 2020 2022 2222 0a0a 2020 2020 2020       """..      
-00048b70: 2020 7265 7475 726e 2073 656c 662e 5f67    return self._g
-00048b80: 6574 5f63 6f6d 6269 6e61 7469 6f6e 2822  et_combination("
-00048b90: 6d61 6a6f 7269 7479 5f76 6f74 6522 2c20  majority_vote", 
-00048ba0: 666f 7263 652c 2065 7863 6c75 6465 2c20  force, exclude, 
-00048bb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00048bc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00048bd0: 2020 2020 2020 6372 6561 7465 5f6d 616a        create_maj
-00048be0: 6f72 6974 795f 766f 7465 2c20 2a2a 6b77  ority_vote, **kw
-00048bf0: 6172 6773 290a 0a20 2020 2064 6566 2067  args)..    def g
-00048c00: 6574 5f73 756d 2873 656c 662c 2066 6f72  et_sum(self, for
-00048c10: 6365 3d46 616c 7365 2c20 6578 636c 7564  ce=False, exclud
-00048c20: 653d 4e6f 6e65 2c20 2a2a 6b77 6172 6773  e=None, **kwargs
-00048c30: 293a 0a20 2020 2020 2020 2022 2222 4765  ):.        """Ge
-00048c40: 7420 524f 4920 6f62 6a65 6374 2072 6570  t ROI object rep
-00048c50: 7265 7365 6e74 696e 6720 7468 6520 7375  resenting the su
-00048c60: 6d20 6f66 2052 4f49 7320 696e 2074 6869  m of ROIs in thi
-00048c70: 7320 7374 7275 6374 7572 6520 7365 742e  s structure set.
-00048c80: 200a 2020 2020 2020 2020 4966 203c 6578   .        If <ex
-00048c90: 636c 7564 653e 2069 7320 7365 7420 746f  clude> is set to
-00048ca0: 2061 2073 7472 696e 672c 2074 6865 2052   a string, the R
-00048cb0: 4f49 2077 6974 6820 7468 6174 206e 616d  OI with that nam
-00048cc0: 6520 7769 6c6c 2062 6520 0a20 2020 2020  e will be .     
-00048cd0: 2020 2065 7863 6c75 6465 6420 6672 6f6d     excluded from
-00048ce0: 2074 6865 2063 616c 6375 6c61 7469 6f6e   the calculation
-00048cf0: 2e0a 0a20 2020 2020 2020 202a 2a50 6172  ...        **Par
-00048d00: 616d 6574 6572 733a 2a2a 0a0a 2020 2020  ameters:**..    
-00048d10: 2020 2020 666f 7263 6520 3a20 626f 6f6c      force : bool
-00048d20: 2c20 6465 6661 756c 743d 4661 6c73 650a  , default=False.
-00048d30: 2020 2020 2020 2020 2020 2020 4966 2046              If F
-00048d40: 616c 7365 2061 6e64 2073 756d 2052 4f49  alse and sum ROI
-00048d50: 2068 6173 2061 6c72 6561 6479 2062 6565   has already bee
-00048d60: 6e20 6372 6561 7465 642c 2074 6865 200a  n created, the .
-00048d70: 2020 2020 2020 2020 2020 2020 7072 6576              prev
-00048d80: 696f 7573 6c79 2063 6f6d 7075 7465 6420  iously computed 
-00048d90: 524f 4920 7769 6c6c 2062 6520 7265 7475  ROI will be retu
-00048da0: 726e 6564 2e20 4966 2046 6f72 6365 3d54  rned. If Force=T
-00048db0: 7275 652c 2074 6865 200a 2020 2020 2020  rue, the .      
-00048dc0: 2020 2020 2020 7375 6d20 524f 4920 7769        sum ROI wi
-00048dd0: 6c6c 2062 6520 7265 6372 6561 7465 642e  ll be recreated.
-00048de0: 0a0a 2020 2020 2020 2020 6578 636c 7564  ..        exclud
-00048df0: 6520 3a20 7374 722c 2064 6566 6175 6c74  e : str, default
-00048e00: 3d4e 6f6e 650a 2020 2020 2020 2020 2020  =None.          
-00048e10: 2020 4966 2073 6574 2074 6f20 6120 7374    If set to a st
-00048e20: 7269 6e67 2c20 7468 6520 6669 7273 7420  ring, the first 
-00048e30: 524f 4920 696e 2073 656c 662e 726f 6973  ROI in self.rois
-00048e40: 2077 6974 6820 7468 6174 206e 616d 6520   with that name 
-00048e50: 7769 6c6c 200a 2020 2020 2020 2020 2020  will .          
-00048e60: 2020 6265 2065 7863 6c75 6465 6420 6672    be excluded fr
-00048e70: 6f6d 2074 6865 2063 6f6d 6269 6e61 7469  om the combinati
-00048e80: 6f6e 2e20 5468 6973 206d 6179 2062 6520  on. This may be 
-00048e90: 7573 6566 756c 2069 6620 636f 6d70 6172  useful if compar
-00048ea0: 6973 6f6e 200a 2020 2020 2020 2020 2020  ison .          
-00048eb0: 2020 6f66 2061 2073 696e 676c 6520 524f    of a single RO
-00048ec0: 4920 7769 7468 2074 6865 2063 6f6e 7365  I with the conse
-00048ed0: 6e73 7573 206f 6620 616c 6c20 6f74 6865  nsus of all othe
-00048ee0: 7273 2069 7320 6465 7369 7265 642e 0a0a  rs is desired...
-00048ef0: 2020 2020 2020 2020 602a 2a60 6b77 6172          `**`kwar
-00048f00: 6773 203a 0a20 2020 2020 2020 2020 2020  gs :.           
-00048f10: 2045 7874 7261 206b 6579 776f 7264 2061   Extra keyword a
-00048f20: 7267 756d 656e 7473 2074 6f20 7061 7373  rguments to pass
-00048f30: 2074 6f20 7468 6520 6372 6561 7469 6f6e   to the creation
-00048f40: 206f 6620 7468 6520 524f 4920 6f62 6a65   of the ROI obje
-00048f50: 6374 0a20 2020 2020 2020 2020 2020 2072  ct.            r
-00048f60: 6570 7265 7365 6e74 696e 6720 7468 6520  epresenting the 
-00048f70: 636f 6d62 696e 6174 696f 6e2e 0a20 2020  combination..   
-00048f80: 2020 2020 2022 2222 0a0a 2020 2020 2020       """..      
-00048f90: 2020 7265 7475 726e 2073 656c 662e 5f67    return self._g
-00048fa0: 6574 5f63 6f6d 6269 6e61 7469 6f6e 2822  et_combination("
-00048fb0: 7375 6d22 2c20 666f 7263 652c 2065 7863  sum", force, exc
-00048fc0: 6c75 6465 2c20 0a20 2020 2020 2020 2020  lude, .         
-00048fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00048fe0: 2020 2020 2020 2020 2020 2020 6372 6561              crea
-00048ff0: 7465 5f72 6f69 5f73 756d 2c20 2a2a 6b77  te_roi_sum, **kw
-00049000: 6172 6773 290a 0a20 2020 2064 6566 2067  args)..    def g
-00049010: 6574 5f6f 7665 726c 6170 2873 656c 662c  et_overlap(self,
-00049020: 2066 6f72 6365 3d46 616c 7365 2c20 6578   force=False, ex
-00049030: 636c 7564 653d 4e6f 6e65 2c20 2a2a 6b77  clude=None, **kw
-00049040: 6172 6773 293a 0a20 2020 2020 2020 2022  args):.        "
-00049050: 2222 4765 7420 524f 4920 6f62 6a65 6374  ""Get ROI object
-00049060: 2072 6570 7265 7365 6e74 696e 6720 7468   representing th
-00049070: 6520 6f76 6572 6c61 7020 6f66 2052 4f49  e overlap of ROI
-00049080: 7320 696e 2074 6869 7320 0a20 2020 2020  s in this .     
-00049090: 2020 2073 7472 7563 7475 7265 2073 6574     structure set
-000490a0: 2e20 4966 203c 6578 636c 7564 653e 2069  . If <exclude> i
-000490b0: 7320 7365 7420 746f 2061 2073 7472 696e  s set to a strin
-000490c0: 672c 2074 6865 2052 4f49 2077 6974 6820  g, the ROI with 
-000490d0: 7468 6174 206e 616d 6520 0a20 2020 2020  that name .     
-000490e0: 2020 2077 696c 6c20 6265 2065 7863 6c75     will be exclu
-000490f0: 6465 6420 6672 6f6d 2074 6865 2063 616c  ded from the cal
-00049100: 6375 6c61 7469 6f6e 2e0a 0a20 2020 2020  culation...     
-00049110: 2020 202a 2a50 6172 616d 6574 6572 733a     **Parameters:
-00049120: 2a2a 0a0a 2020 2020 2020 2020 666f 7263  **..        forc
-00049130: 6520 3a20 626f 6f6c 2c20 6465 6661 756c  e : bool, defaul
-00049140: 743d 4661 6c73 650a 2020 2020 2020 2020  t=False.        
-00049150: 2020 2020 4966 2046 616c 7365 2061 6e64      If False and
-00049160: 206f 7665 726c 6170 2052 4f49 2068 6173   overlap ROI has
-00049170: 2061 6c72 6561 6479 2062 6565 6e20 6372   already been cr
-00049180: 6561 7465 642c 2074 6865 200a 2020 2020  eated, the .    
-00049190: 2020 2020 2020 2020 7072 6576 696f 7573          previous
-000491a0: 6c79 2063 6f6d 7075 7465 6420 524f 4920  ly computed ROI 
-000491b0: 7769 6c6c 2062 6520 7265 7475 726e 6564  will be returned
-000491c0: 2e20 4966 2046 6f72 6365 3d54 7275 652c  . If Force=True,
-000491d0: 2074 6865 200a 2020 2020 2020 2020 2020   the .          
-000491e0: 2020 6f76 6572 6c61 7020 524f 4920 7769    overlap ROI wi
-000491f0: 6c6c 2062 6520 7265 6372 6561 7465 642e  ll be recreated.
-00049200: 0a0a 2020 2020 2020 2020 6578 636c 7564  ..        exclud
-00049210: 6520 3a20 7374 722c 2064 6566 6175 6c74  e : str, default
-00049220: 3d4e 6f6e 650a 2020 2020 2020 2020 2020  =None.          
-00049230: 2020 4966 2073 6574 2074 6f20 6120 7374    If set to a st
-00049240: 7269 6e67 2c20 7468 6520 6669 7273 7420  ring, the first 
-00049250: 524f 4920 696e 2073 656c 662e 726f 6973  ROI in self.rois
-00049260: 2077 6974 6820 7468 6174 206e 616d 6520   with that name 
-00049270: 7769 6c6c 200a 2020 2020 2020 2020 2020  will .          
-00049280: 2020 6265 2065 7863 6c75 6465 6420 6672    be excluded fr
-00049290: 6f6d 2074 6865 2063 6f6d 6269 6e61 7469  om the combinati
-000492a0: 6f6e 2e20 5468 6973 206d 6179 2062 6520  on. This may be 
-000492b0: 7573 6566 756c 2069 6620 636f 6d70 6172  useful if compar
-000492c0: 6973 6f6e 200a 2020 2020 2020 2020 2020  ison .          
-000492d0: 2020 6f66 2061 2073 696e 676c 6520 524f    of a single RO
-000492e0: 4920 7769 7468 2074 6865 2063 6f6e 7365  I with the conse
-000492f0: 6e73 7573 206f 6620 616c 6c20 6f74 6865  nsus of all othe
-00049300: 7273 2069 7320 6465 7369 7265 642e 0a0a  rs is desired...
-00049310: 2020 2020 2020 2020 602a 2a60 6b77 6172          `**`kwar
-00049320: 6773 203a 0a20 2020 2020 2020 2020 2020  gs :.           
-00049330: 2045 7874 7261 206b 6579 776f 7264 2061   Extra keyword a
-00049340: 7267 756d 656e 7473 2074 6f20 7061 7373  rguments to pass
-00049350: 2074 6f20 7468 6520 6372 6561 7469 6f6e   to the creation
-00049360: 206f 6620 7468 6520 524f 4920 6f62 6a65   of the ROI obje
-00049370: 6374 0a20 2020 2020 2020 2020 2020 2072  ct.            r
-00049380: 6570 7265 7365 6e74 696e 6720 7468 6520  epresenting the 
-00049390: 636f 6d62 696e 6174 696f 6e2e 0a20 2020  combination..   
-000493a0: 2020 2020 2022 2222 0a0a 2020 2020 2020       """..      
-000493b0: 2020 7265 7475 726e 2073 656c 662e 5f67    return self._g
-000493c0: 6574 5f63 6f6d 6269 6e61 7469 6f6e 2822  et_combination("
-000493d0: 6f76 6572 6c61 7022 2c20 666f 7263 652c  overlap", force,
-000493e0: 2065 7863 6c75 6465 2c20 0a20 2020 2020   exclude, .     
-000493f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00049400: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00049410: 6372 6561 7465 5f72 6f69 5f6f 7665 726c  create_roi_overl
-00049420: 6170 2c20 2a2a 6b77 6172 6773 290a 0a20  ap, **kwargs).. 
-00049430: 2020 2064 6566 2074 7261 6e73 666f 726d     def transform
-00049440: 2873 656c 662c 2073 6361 6c65 3d31 2c20  (self, scale=1, 
-00049450: 7472 616e 736c 6174 696f 6e3d 5b30 2c20  translation=[0, 
-00049460: 302c 2030 5d2c 2072 6f74 6174 696f 6e3d  0, 0], rotation=
-00049470: 5b30 2c20 302c 2030 5d2c 0a20 2020 2020  [0, 0, 0],.     
-00049480: 2020 2020 2020 2063 656e 7472 653d 5b30         centre=[0
-00049490: 2c20 302c 2030 5d2c 2072 6573 616d 706c  , 0, 0], resampl
-000494a0: 653d 2266 696e 6522 2c20 7265 7374 6f72  e="fine", restor
-000494b0: 653d 5472 7565 2c20 0a20 2020 2020 2020  e=True, .       
-000494c0: 2020 2020 2066 696c 6c5f 7661 6c75 653d       fill_value=
-000494d0: 4e6f 6e65 2c20 666f 7263 655f 636f 6e74  None, force_cont
-000494e0: 6f75 7273 3d46 616c 7365 2c20 6e61 6d65  ours=False, name
-000494f0: 733d 4e6f 6e65 293a 0a20 2020 2020 2020  s=None):.       
-00049500: 2022 2222 0a20 2020 2020 2020 2041 7070   """.        App
-00049510: 6c79 2074 6872 6565 2d64 696d 656e 7369  ly three-dimensi
-00049520: 6f6e 616c 2073 696d 696c 6172 6974 7920  onal similarity 
-00049530: 7472 616e 7366 6f72 6d20 746f 2073 7472  transform to str
-00049540: 7563 7475 7265 2d73 6574 2052 4f49 732e  ucture-set ROIs.
-00049550: 0a0a 2020 2020 2020 2020 4966 2074 6865  ..        If the
-00049560: 2074 7261 6e73 666f 726d 2063 6f72 7265   transform corre
-00049570: 7370 6f6e 6473 2074 6f20 6120 7472 616e  sponds to a tran
-00049580: 736c 6174 696f 6e20 616e 642f 6f72 2072  slation and/or r
-00049590: 6f74 6174 696f 6e0a 2020 2020 2020 2020  otation.        
-000495a0: 6162 6f75 7420 7468 6520 7a2d 6178 6973  about the z-axis
-000495b0: 2c20 616e 6420 6569 7468 6572 2074 6865  , and either the
-000495c0: 2072 6f69 2073 6f75 7263 6520 7479 7065   roi source type
-000495d0: 2069 7320 2264 6963 6f6d 220a 2020 2020   is "dicom".    
-000495e0: 2020 2020 6f72 2066 6f72 6365 2d63 6f6e      or force-con
-000495f0: 746f 7572 7320 6973 2054 7275 652c 2074  tours is True, t
-00049600: 6865 2074 7261 6e73 666f 726d 2069 7320  he transform is 
-00049610: 6170 706c 6965 6420 746f 2063 6f6e 746f  applied to conto
-00049620: 7572 0a20 2020 2020 2020 2070 6f69 6e74  ur.        point
-00049630: 7320 616e 6420 7468 6520 726f 6920 6d61  s and the roi ma
-00049640: 736b 2069 7320 7365 7420 6173 2075 6e6c  sk is set as unl
-00049650: 6f61 6465 642e 2020 4f74 6865 7277 6973  oaded.  Otherwis
-00049660: 6520 7468 6520 7472 616e 7366 6f72 6d0a  e the transform.
-00049670: 2020 2020 2020 2020 6973 2061 7070 6c69          is appli
-00049680: 6564 2074 6f20 7468 6520 6d61 736b 2061  ed to the mask a
-00049690: 6e64 2063 6f6e 746f 7572 7320 6172 6520  nd contours are 
-000496a0: 7365 7420 6173 2075 6e6c 6f61 6465 642e  set as unloaded.
-000496b0: 0a0a 2020 2020 2020 2020 5468 6520 7472  ..        The tr
-000496c0: 616e 7366 6f72 6d20 6973 2061 7070 6c69  ansform is appli
-000496d0: 6564 2069 6e20 7468 6520 6f72 6465 723a  ed in the order:
-000496e0: 2074 7261 6e73 6c61 7469 6f6e 2c20 7363   translation, sc
-000496f0: 616c 696e 672c 0a20 2020 2020 2020 2072  aling,.        r
-00049700: 6f74 6174 696f 6e2e 2020 5468 6520 6c61  otation.  The la
-00049710: 7474 6572 2074 776f 2061 7265 2061 626f  tter two are abo
-00049720: 7574 2074 6865 2063 656e 7472 6520 636f  ut the centre co
-00049730: 6f72 6469 6e61 7465 732e 0a0a 2020 2020  ordinates...    
-00049740: 2020 2020 2a2a 5061 7261 6d65 7465 7273      **Parameters
-00049750: 3a2a 2a0a 2020 2020 2020 2020 0a20 2020  :**.        .   
-00049760: 2020 2020 2066 6f72 6365 5f63 6f6e 746f       force_conto
-00049770: 7572 7320 3a20 626f 6f6c 2c20 6465 6661  urs : bool, defa
-00049780: 756c 743d 4661 6c73 650a 2020 2020 2020  ult=False.      
-00049790: 2020 2020 2020 4966 2054 7275 652c 2061        If True, a
-000497a0: 6e64 2074 6865 2074 7261 6e73 666f 726d  nd the transform
-000497b0: 2063 6f72 7265 7370 6f6e 6473 2074 6f20   corresponds to 
-000497c0: 6120 7472 616e 736c 6174 696f 6e0a 2020  a translation.  
-000497d0: 2020 2020 2020 2020 2020 616e 642f 6f72            and/or
-000497e0: 2072 6f74 6174 696f 6e20 6162 6f75 7420   rotation about 
-000497f0: 7468 6520 7a2d 6178 6973 2c20 6170 706c  the z-axis, appl
-00049800: 7920 7472 616e 7366 6f72 6d20 746f 2063  y transform to c
-00049810: 6f6e 746f 7572 0a20 2020 2020 2020 2020  ontour.         
-00049820: 2020 2070 6f69 6e74 7320 696e 6465 7065     points indepe
-00049830: 6e64 656e 746c 7920 6f66 2074 6865 206f  ndently of the o
-00049840: 7269 6769 6e61 6c20 6461 7461 2073 6f75  riginal data sou
-00049850: 7263 652e 0a0a 2020 2020 2020 2020 6e61  rce...        na
-00049860: 6d65 7320 3a20 6c69 7374 2f4e 6f6e 652c  mes : list/None,
-00049870: 2064 6566 6175 6c74 3d46 616c 7365 0a20   default=False. 
-00049880: 2020 2020 2020 2020 2020 204c 6973 7420             List 
-00049890: 6f66 2052 4f49 7320 746f 2077 6869 6368  of ROIs to which
-000498a0: 2074 7261 6e73 666f 726d 2069 7320 746f   transform is to
-000498b0: 2062 6520 6170 706c 6965 642e 2020 4966   be applied.  If
-000498c0: 204e 6f6e 652c 0a20 2020 2020 2020 2020   None,.         
-000498d0: 2020 2074 7261 6e73 666f 726d 2069 7320     transform is 
-000498e0: 6170 706c 6965 6420 746f 2061 6c6c 2052  applied to all R
-000498f0: 4f49 732e 0a0a 2020 2020 2020 2020 466f  OIs...        Fo
-00049900: 7220 6f74 6865 7220 7061 7261 6d65 7465  r other paramete
-00049910: 7273 2c20 7365 6520 646f 6375 6d65 6e74  rs, see document
-00049920: 6174 696f 6e20 666f 720a 2020 2020 2020  ation for.      
-00049930: 2020 736b 7274 2e69 6d61 6765 2e49 6d61    skrt.image.Ima
-00049940: 6765 2e74 7261 6e73 666f 726d 2829 2e20  ge.transform(). 
-00049950: 204e 6f74 6520 7468 6174 2074 6865 2060   Note that the `
-00049960: 606f 7264 6572 6060 0a20 2020 2020 2020  `order``.       
-00049970: 2070 6172 616d 6574 6572 2069 736e 2774   parameter isn't
-00049980: 2061 7661 696c 6162 6c65 2066 6f72 2073   available for s
-00049990: 7472 7563 7475 7265 2d73 6574 2074 7261  tructure-set tra
-000499a0: 6e73 666f 726d 7320 2d20 6120 7661 6c75  nsforms - a valu
-000499b0: 6520 6f66 2030 0a20 2020 2020 2020 2069  e of 0.        i
-000499c0: 7320 7573 6564 2061 6c77 6179 732e 0a20  s used always.. 
-000499d0: 2020 2020 2020 2022 2222 0a0a 2020 2020         """..    
-000499e0: 2020 2020 666f 7220 726f 6920 696e 2073      for roi in s
-000499f0: 656c 662e 6765 745f 726f 6973 286e 616d  elf.get_rois(nam
-00049a00: 6573 293a 0a20 2020 2020 2020 2020 2020  es):.           
-00049a10: 2072 6f69 2e74 7261 6e73 666f 726d 2873   roi.transform(s
-00049a20: 6361 6c65 2c20 7472 616e 736c 6174 696f  cale, translatio
-00049a30: 6e2c 2072 6f74 6174 696f 6e2c 2063 656e  n, rotation, cen
-00049a40: 7472 652c 2072 6573 616d 706c 652c 0a20  tre, resample,. 
-00049a50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00049a60: 2020 2072 6573 746f 7265 2c20 6669 6c6c     restore, fill
-00049a70: 5f76 616c 7565 2c20 666f 7263 655f 636f  _value, force_co
-00049a80: 6e74 6f75 7273 290a 0a20 2020 2020 2020  ntours)..       
-00049a90: 2072 6574 7572 6e20 4e6f 6e65 0a0a 2020   return None..  
-00049aa0: 2020 6465 6620 6164 645f 706c 616e 2873    def add_plan(s
-00049ab0: 656c 662c 2070 6c61 6e29 3a0a 2020 2020  elf, plan):.    
-00049ac0: 2020 2020 2222 2241 6464 2061 2050 6c61      """Add a Pla
-00049ad0: 6e20 6f62 6a65 6374 2074 6f20 6265 2061  n object to be a
-00049ae0: 7373 6f63 6961 7465 6420 7769 7468 2074  ssociated with t
-00049af0: 6869 7320 7374 7275 6374 7572 6520 7365  his structure se
-00049b00: 7420 616e 640a 2020 2020 2020 2020 6974  t and.        it
-00049b10: 7320 524f 4973 2e20 5468 6973 2064 6f65  s ROIs. This doe
-00049b20: 7320 6e6f 7420 6166 6665 6374 2074 6865  s not affect the
-00049b30: 2073 7472 7563 7475 7265 2073 6574 2061   structure set a
-00049b40: 7373 6f63 6961 7465 6420 7769 7468 0a20  ssociated with. 
-00049b50: 2020 2020 2020 2074 6865 2050 6c61 6e20         the Plan 
-00049b60: 6f62 6a65 6374 2e0a 0a20 2020 2020 2020  object...       
-00049b70: 202a 2a50 6172 616d 6574 6572 733a 2a2a   **Parameters:**
-00049b80: 0a0a 2020 2020 2020 2020 706c 616e 203a  ..        plan :
-00049b90: 2073 6b72 742e 646f 7365 2e50 6c61 6e0a   skrt.dose.Plan.
-00049ba0: 2020 2020 2020 2020 2020 2020 4120 506c              A Pl
-00049bb0: 616e 206f 626a 6563 7420 746f 2061 7373  an object to ass
-00049bc0: 6967 6e20 746f 2074 6869 7320 7374 7275  ign to this stru
-00049bd0: 6374 7572 6520 7365 742e 0a20 2020 2020  cture set..     
-00049be0: 2020 2022 2222 0a0a 2020 2020 2020 2020     """..        
-00049bf0: 6966 206e 6f74 2070 6c61 6e20 696e 2073  if not plan in s
-00049c00: 656c 662e 706c 616e 733a 0a20 2020 2020  elf.plans:.     
-00049c10: 2020 2020 2020 2073 656c 662e 706c 616e         self.plan
-00049c20: 732e 6170 7065 6e64 2870 6c61 6e29 0a20  s.append(plan). 
-00049c30: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00049c40: 706c 616e 732e 736f 7274 2829 0a0a 2020  plans.sort()..  
-00049c50: 2020 2020 2020 2020 2020 666f 7220 726f            for ro
-00049c60: 6920 696e 2073 656c 662e 726f 6973 3a0a  i in self.rois:.
-00049c70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00049c80: 726f 692e 6164 645f 706c 616e 2870 6c61  roi.add_plan(pla
-00049c90: 6e29 0a0a 2020 2020 6465 6620 636c 6561  n)..    def clea
-00049ca0: 725f 706c 616e 7328 7365 6c66 293a 0a20  r_plans(self):. 
-00049cb0: 2020 2020 2020 2022 2222 436c 6561 7220         """Clear 
-00049cc0: 616c 6c20 706c 616e 206d 6170 7320 6173  all plan maps as
-00049cd0: 736f 6369 6174 6564 2077 6974 6820 7468  sociated with th
-00049ce0: 6973 2073 7472 7563 7475 7265 2073 6574  is structure set
-00049cf0: 2e22 2222 0a0a 2020 2020 2020 2020 7365  ."""..        se
-00049d00: 6c66 2e70 6c61 6e73 203d 205b 5d0a 0a20  lf.plans = [].. 
-00049d10: 2020 2064 6566 2067 6574 5f70 6c61 6e73     def get_plans
-00049d20: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
-00049d30: 2222 2252 6574 7572 6e20 6c69 7374 206f  """Return list o
-00049d40: 6620 506c 616e 206f 626a 6563 7473 2061  f Plan objects a
-00049d50: 7373 6f63 6961 7465 6420 7769 7468 2074  ssociated with t
-00049d60: 6869 7320 7374 7275 6374 7572 6520 7365  his structure se
-00049d70: 742e 2222 220a 0a20 2020 2020 2020 2072  t."""..        r
-00049d80: 6574 7572 6e20 7365 6c66 2e70 6c61 6e73  eturn self.plans
-00049d90: 0a0a 2020 2020 6465 6620 696e 7465 7270  ..    def interp
-00049da0: 6f6c 6174 655f 706f 696e 7473 2873 656c  olate_points(sel
-00049db0: 662c 206e 5f70 6f69 6e74 3d4e 6f6e 652c  f, n_point=None,
-00049dc0: 2064 7879 3d4e 6f6e 652c 0a20 2020 2020   dxy=None,.     
-00049dd0: 2020 2073 6d6f 6f74 686e 6573 735f 7065     smoothness_pe
-00049de0: 725f 706f 696e 743d 3029 3a0a 2020 2020  r_point=0):.    
-00049df0: 2020 2020 2727 270a 2020 2020 2020 2020      '''.        
-00049e00: 5265 7475 726e 206e 6577 2053 7472 7563  Return new Struc
-00049e10: 7475 7265 5365 7420 6f62 6a65 6374 2c20  tureSet object, 
-00049e20: 7769 7468 2069 6e74 6572 706f 6c61 7465  with interpolate
-00049e30: 6420 636f 6e74 6f75 7220 706f 696e 7473  d contour points
-00049e40: 2e0a 0a20 2020 2020 2020 2050 6f69 6e74  ...        Point
-00049e50: 7320 6172 6520 696e 7465 7270 6f6c 6174  s are interpolat
-00049e60: 6564 2066 6f72 2065 6163 6820 636f 6e74  ed for each cont
-00049e70: 6f75 7220 6f66 2065 6163 6820 524f 492e  our of each ROI.
-00049e80: 0a0a 2020 2020 2020 2020 2a2a 5061 7261  ..        **Para
-00049e90: 6d65 7465 7273 3a2a 2a0a 0a20 2020 2020  meters:**..     
-00049ea0: 2020 206e 5f70 6f69 6e74 203a 2069 6e74     n_point : int
-00049eb0: 2c20 6465 6661 756c 743d 4e6f 6e65 0a20  , default=None. 
-00049ec0: 2020 2020 2020 2020 2020 204e 756d 6265             Numbe
-00049ed0: 7220 6f66 2070 6f69 6e74 7320 7065 7220  r of points per 
-00049ee0: 636f 6e74 6f75 722c 2061 6674 6572 2069  contour, after i
-00049ef0: 6e74 6572 706f 6c61 7469 6f6e 2e20 2054  nterpolation.  T
-00049f00: 6869 7320 6d75 7374 0a20 2020 2020 2020  his must.       
-00049f10: 2020 2020 2062 6520 7365 7420 746f 204e       be set to N
-00049f20: 6f6e 6520 666f 7220 6478 7920 746f 2062  one for dxy to b
-00049f30: 6520 636f 6e73 6964 6572 6564 2e0a 0a20  e considered... 
-00049f40: 2020 2020 2020 2064 7879 203a 2066 6c6f         dxy : flo
-00049f50: 6174 2c20 6465 6661 756c 743d 4e6f 6e65  at, default=None
-00049f60: 0a20 2020 2020 2020 2020 2020 2041 7070  .            App
-00049f70: 726f 7869 6d61 7465 2064 6973 7461 6e63  roximate distanc
-00049f80: 6520 7265 7175 6972 6564 2062 6574 7765  e required betwe
-00049f90: 656e 2063 6f6e 746f 7572 2070 6f69 6e74  en contour point
-00049fa0: 732e 2020 5468 6973 2069 7320 7461 6b65  s.  This is take
-00049fb0: 6e0a 2020 2020 2020 2020 2020 2020 696e  n.            in
-00049fc0: 746f 2061 6363 6f75 6e74 206f 6e6c 7920  to account only 
-00049fd0: 6966 206e 5f70 6f69 6e74 2069 7320 7365  if n_point is se
-00049fe0: 7420 746f 204e 6f6e 652e 2020 466f 7220  t to None.  For 
-00049ff0: 6120 636f 6e74 6f75 7220 6f66 0a20 2020  a contour of.   
-0004a000: 2020 2020 2020 2020 206c 656e 6774 6820           length 
-0004a010: 636f 6e74 6f75 725f 6c65 6e67 7468 2c20  contour_length, 
-0004a020: 7468 6520 6e75 6d62 6572 206f 6620 636f  the number of co
-0004a030: 6e74 6f75 7220 706f 696e 7473 2069 7320  ntour points is 
-0004a040: 7468 656e 2074 616b 656e 0a20 2020 2020  then taken.     
-0004a050: 2020 2020 2020 2074 6f20 6265 206d 6178         to be max
-0004a060: 2869 6e74 2863 6f6e 746f 7572 5f6c 656e  (int(contour_len
-0004a070: 6774 6820 2f20 6478 7929 2c20 3329 2e20  gth / dxy), 3). 
-0004a080: 200a 0a20 2020 2020 2020 2073 6d6f 6f74   ..        smoot
-0004a090: 686e 6573 735f 7065 725f 706f 696e 7420  hness_per_point 
-0004a0a0: 3a20 666c 6f61 742c 2064 6566 6175 6c74  : float, default
-0004a0b0: 3d30 0a20 2020 2020 2020 2020 2020 2050  =0.            P
-0004a0c0: 6172 616d 6574 6572 2064 6574 6572 6d69  arameter determi
-0004a0d0: 6e69 6e67 2074 6865 2073 6d6f 6f74 686e  ning the smoothn
-0004a0e0: 6573 7320 6f66 2074 6865 2042 2d73 706c  ess of the B-spl
-0004a0f0: 696e 6520 6375 7276 6520 7573 6564 0a20  ine curve used. 
-0004a100: 2020 2020 2020 2020 2020 2069 6e20 636f             in co
-0004a110: 6e74 6f75 7220 6170 7072 6f78 696d 6174  ntour approximat
-0004a120: 696f 6e20 666f 7220 696e 7465 7270 6f6c  ion for interpol
-0004a130: 6174 696f 6e2e 2020 5468 6520 7072 6f64  ation.  The prod
-0004a140: 7563 7420 6f66 0a20 2020 2020 2020 2020  uct of.         
-0004a150: 2020 2073 6d6f 6f74 686e 6573 735f 7065     smoothness_pe
-0004a160: 725f 706f 696e 7420 616e 6420 7468 6520  r_point and the 
-0004a170: 6e75 6d62 6572 206f 6620 636f 6e74 6f75  number of contou
-0004a180: 7220 706f 696e 7473 2028 7370 6563 6966  r points (specif
-0004a190: 6965 640a 2020 2020 2020 2020 2020 2020  ied.            
-0004a1a0: 6469 7265 6374 6c79 2076 6961 206e 5f70  directly via n_p
-0004a1b0: 6f69 6e74 2c20 6f72 2069 6e64 6972 6563  oint, or indirec
-0004a1c0: 746c 7920 7669 6120 6478 7929 2063 6f72  tly via dxy) cor
-0004a1d0: 7265 7370 6f6e 6473 2074 6f20 7468 650a  responds to the.
-0004a1e0: 2020 2020 2020 2020 2020 2020 7061 7261              para
-0004a1f0: 6d65 7465 7220 7320 6f66 2073 6369 7079  meter s of scipy
-0004a200: 2e69 6e74 6572 706f 6c61 7465 2e73 706c  .interpolate.spl
-0004a210: 7072 6570 202d 2073 6565 2064 6f63 756d  prep - see docum
-0004a220: 656e 7461 7469 6f6e 2061 743a 0a20 2020  entation at:.   
-0004a230: 2020 2020 200a 2020 2020 2020 2020 2020       .          
-0004a240: 2020 6874 7470 733a 2f2f 7363 6970 792e    https://scipy.
-0004a250: 6769 7468 7562 2e69 6f2f 6465 7664 6f63  github.io/devdoc
-0004a260: 732f 7265 6665 7265 6e63 652f 6765 6e65  s/reference/gene
-0004a270: 7261 7465 642f 7363 6970 792e 696e 7465  rated/scipy.inte
-0004a280: 7270 6f6c 6174 652e 7370 6c70 7265 702e  rpolate.splprep.
-0004a290: 6874 6d6c 2373 6369 7079 2e69 6e74 6572  html#scipy.inter
-0004a2a0: 706f 6c61 7465 2e73 706c 7072 6570 0a0a  polate.splprep..
-0004a2b0: 2020 2020 2020 2020 2020 2020 4120 736d              A sm
-0004a2c0: 6f6f 7468 6e65 7373 5f70 6572 5f70 6f69  oothness_per_poi
-0004a2d0: 6e74 206f 6620 3020 666f 7263 6573 2074  nt of 0 forces t
-0004a2e0: 6865 2042 2d73 706c 696e 6520 746f 2070  he B-spline to p
-0004a2f0: 6173 7320 7468 726f 7567 680a 2020 2020  ass through.    
-0004a300: 2020 2020 2020 2020 616c 6c20 6f66 2074          all of t
-0004a310: 6865 2070 7265 2d69 6e74 6572 706f 6c61  he pre-interpola
-0004a320: 7469 6f6e 2063 6f6e 746f 7572 2070 6f69  tion contour poi
-0004a330: 6e74 732e 0a20 2020 2020 2020 2027 2727  nts..        '''
-0004a340: 0a0a 2020 2020 2020 2020 2320 496e 7465  ..        # Inte
-0004a350: 7270 6f6c 6174 6520 706f 696e 7473 2066  rpolate points f
-0004a360: 6f72 2074 6865 2072 6f69 730a 2020 2020  or the rois.    
-0004a370: 2020 2020 726f 6973 203d 205b 5d0a 2020      rois = [].  
-0004a380: 2020 2020 2020 666f 7220 726f 6920 696e        for roi in
-0004a390: 2073 656c 662e 6765 745f 726f 6973 2829   self.get_rois()
-0004a3a0: 3a0a 2020 2020 2020 2020 2020 2020 726f  :.            ro
-0004a3b0: 6973 2e61 7070 656e 6428 726f 692e 696e  is.append(roi.in
-0004a3c0: 7465 7270 6f6c 6174 655f 706f 696e 7473  terpolate_points
-0004a3d0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-0004a3e0: 2020 6e5f 706f 696e 742c 2064 7879 2c20    n_point, dxy, 
-0004a3f0: 736d 6f6f 7468 6e65 7373 5f70 6572 5f70  smoothness_per_p
-0004a400: 6f69 6e74 2929 0a0a 2020 2020 2020 2020  oint))..        
-0004a410: 2320 436c 6f6e 6520 7365 6c66 2c20 7468  # Clone self, th
-0004a420: 656e 2072 6573 6574 2073 6f75 7263 6520  en reset source 
-0004a430: 616e 6420 726f 6973 0a20 2020 2020 2020  and rois.       
-0004a440: 2073 7320 3d20 5374 7275 6374 7572 6553   ss = StructureS
-0004a450: 6574 2873 656c 6629 0a20 2020 2020 2020  et(self).       
-0004a460: 2073 732e 736f 7572 6365 7320 3d20 726f   ss.sources = ro
-0004a470: 6973 0a20 2020 2020 2020 2073 732e 726f  is.        ss.ro
-0004a480: 6973 203d 2072 6f69 730a 0a20 2020 2020  is = rois..     
-0004a490: 2020 2072 6574 7572 6e20 7373 0a0a 2020     return ss..  
-0004a4a0: 2020 6465 6620 6f72 6465 725f 726f 6973    def order_rois
-0004a4b0: 2873 656c 662c 206f 7264 6572 3d27 782b  (self, order='x+
-0004a4c0: 2729 3a0a 2020 2020 2020 2020 2727 270a  '):.        '''.
-0004a4d0: 2020 2020 2020 2020 4f72 6465 7220 524f          Order RO
-0004a4e0: 4973 2062 7920 6f6e 6520 6f66 2074 6865  Is by one of the
-0004a4f0: 6972 2063 656e 7472 6f69 6420 636f 6f72  ir centroid coor
-0004a500: 6469 6e61 7465 732e 0a0a 2020 2020 2020  dinates...      
-0004a510: 2020 2a2a 5061 7261 6d65 7465 723a 2a2a    **Parameter:**
-0004a520: 0a0a 2020 2020 2020 2020 6f72 6465 7220  ..        order 
-0004a530: 3a20 7374 722c 2064 6566 6175 6c74 3d27  : str, default='
-0004a540: 782b 270a 2020 2020 2020 2020 2020 2020  x+'.            
-0004a550: 5370 6563 6966 6963 6174 696f 6e20 6f66  Specification of
-0004a560: 2077 6179 2069 7420 7768 6963 6820 524f   way it which RO
-0004a570: 4973 2061 7265 2074 6f20 6265 206f 7264  Is are to be ord
-0004a580: 6572 643a 0a20 2020 2020 2020 2020 2020  erd:.           
-0004a590: 202d 2027 782b 2720 3a20 696e 206f 7264   - 'x+' : in ord
-0004a5a0: 6572 206f 6620 696e 6372 6561 7369 6e67  er of increasing
-0004a5b0: 2078 2076 616c 7565 2e0a 2020 2020 2020   x value..      
-0004a5c0: 2020 2020 2020 2d20 2778 2d27 203a 2069        - 'x-' : i
-0004a5d0: 6e20 6f72 6465 7220 6f66 2064 6563 7265  n order of decre
-0004a5e0: 6173 696e 6720 7820 7661 6c75 652e 0a20  asing x value.. 
-0004a5f0: 2020 2020 2020 2020 2020 202d 2027 792b             - 'y+
-0004a600: 2720 3a20 696e 206f 7264 6572 206f 6620  ' : in order of 
-0004a610: 696e 6372 6561 7369 6e67 2079 2076 616c  increasing y val
-0004a620: 7565 2e0a 2020 2020 2020 2020 2020 2020  ue..            
-0004a630: 2d20 2779 2d27 203a 2069 6e20 6f72 6465  - 'y-' : in orde
-0004a640: 7220 6f66 2064 6563 7265 6173 696e 6720  r of decreasing 
-0004a650: 7920 7661 6c75 652e 0a20 2020 2020 2020  y value..       
-0004a660: 2020 2020 202d 2027 7a2b 2720 3a20 696e       - 'z+' : in
-0004a670: 206f 7264 6572 206f 6620 696e 6372 6561   order of increa
-0004a680: 7369 6e67 207a 2076 616c 7565 2e0a 2020  sing z value..  
-0004a690: 2020 2020 2020 2020 2020 2d20 277a 2d27            - 'z-'
-0004a6a0: 203a 2069 6e20 6f72 6465 7220 6f66 2064   : in order of d
-0004a6b0: 6563 7265 6173 696e 6720 7a20 7661 6c75  ecreasing z valu
-0004a6c0: 652e 0a20 2020 2020 2020 2027 2727 0a0a  e..        '''..
-0004a6d0: 2020 2020 2020 2020 6966 206f 7264 6572          if order
-0004a6e0: 206e 6f74 2069 6e20 5b27 782b 272c 2027   not in ['x+', '
-0004a6f0: 782d 272c 2027 792b 272c 2027 792d 272c  x-', 'y+', 'y-',
-0004a700: 2027 7a2b 272c 2027 7a2d 275d 3a0a 2020   'z+', 'z-']:.  
-0004a710: 2020 2020 2020 2020 2020 7265 7475 726e            return
-0004a720: 0a0a 2020 2020 2020 2020 2320 4465 7465  ..        # Dete
-0004a730: 726d 696e 6520 6178 6973 2066 6f72 206f  rmine axis for o
-0004a740: 7264 6572 696e 672c 2061 6e64 2064 6972  rdering, and dir
-0004a750: 6563 7469 6f6e 2e0a 2020 2020 2020 2020  ection..        
-0004a760: 6178 6973 203d 2027 7879 7a27 2e66 696e  axis = 'xyz'.fin
-0004a770: 6428 6f72 6465 725b 305d 290a 2020 2020  d(order[0]).    
-0004a780: 2020 2020 7265 7665 7273 6520 3d20 2827      reverse = ('
-0004a790: 2d27 2069 6e20 6f72 6465 7229 0a0a 2020  -' in order)..  
-0004a7a0: 2020 2020 2020 2320 4372 6561 7465 2064        # Create d
-0004a7b0: 6963 7469 6f6e 6172 7920 7768 6572 6520  ictionary where 
-0004a7c0: 6b65 7973 2061 7265 2063 656e 7472 6f69  keys are centroi
-0004a7d0: 6420 636f 6f72 6469 6e61 7465 730a 2020  d coordinates.  
-0004a7e0: 2020 2020 2020 2320 616e 6420 7661 6c75        # and valu
-0004a7f0: 6573 2061 7265 206c 6973 7473 206f 6620  es are lists of 
-0004a800: 524f 4920 696e 6469 6369 6573 2061 7420  ROI indicies at 
-0004a810: 7468 6573 6520 636f 6f72 6469 6e61 7465  these coordinate
-0004a820: 732e 0a20 2020 2020 2020 2063 656e 7472  s..        centr
-0004a830: 6f69 6473 203d 207b 7d0a 2020 2020 2020  oids = {}.      
-0004a840: 2020 666f 7220 6920 696e 2072 616e 6765    for i in range
-0004a850: 286c 656e 2873 656c 662e 726f 6973 2929  (len(self.rois))
-0004a860: 3a0a 2020 2020 2020 2020 2020 2020 7879  :.            xy
-0004a870: 7a20 3d20 7365 6c66 2e72 6f69 735b 695d  z = self.rois[i]
-0004a880: 2e67 6574 5f63 656e 7472 6f69 6428 295b  .get_centroid()[
-0004a890: 6178 6973 5d0a 2020 2020 2020 2020 2020  axis].          
-0004a8a0: 2020 6966 2078 797a 206e 6f74 2069 6e20    if xyz not in 
-0004a8b0: 6365 6e74 726f 6964 733a 0a20 2020 2020  centroids:.     
-0004a8c0: 2020 2020 2020 2020 2020 2063 656e 7472             centr
-0004a8d0: 6f69 6473 5b78 797a 5d20 3d20 5b5d 0a20  oids[xyz] = []. 
-0004a8e0: 2020 2020 2020 2020 2020 2063 656e 7472             centr
-0004a8f0: 6f69 6473 5b78 797a 5d2e 6170 7065 6e64  oids[xyz].append
-0004a900: 2869 290a 0a20 2020 2020 2020 2023 2043  (i)..        # C
-0004a910: 7265 6174 6520 6c69 7374 206f 6620 524f  reate list of RO
-0004a920: 4973 206f 7264 6572 6564 2062 7920 6365  Is ordered by ce
-0004a930: 6e74 726f 6964 2063 6f6f 7264 696e 6174  ntroid coordinat
-0004a940: 652e 0a20 2020 2020 2020 2072 6f69 7320  e..        rois 
-0004a950: 3d20 5b5d 0a20 2020 2020 2020 2066 6f72  = [].        for
-0004a960: 2063 656e 7472 6f69 6420 696e 2073 6f72   centroid in sor
-0004a970: 7465 6428 6365 6e74 726f 6964 732c 2072  ted(centroids, r
-0004a980: 6576 6572 7365 3d72 6576 6572 7365 293a  everse=reverse):
-0004a990: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
-0004a9a0: 2069 2069 6e20 6365 6e74 726f 6964 735b   i in centroids[
-0004a9b0: 6365 6e74 726f 6964 5d3a 0a20 2020 2020  centroid]:.     
-0004a9c0: 2020 2020 2020 2020 2020 2072 6f69 732e             rois.
-0004a9d0: 6170 7065 6e64 2873 656c 662e 726f 6973  append(self.rois
-0004a9e0: 5b69 5d29 0a0a 2020 2020 2020 2020 2320  [i])..        # 
-0004a9f0: 5374 6f72 6520 7468 6520 6e65 7720 6f72  Store the new or
-0004aa00: 6465 7220 6f66 2052 4f49 732e 0a20 2020  der of ROIs..   
-0004aa10: 2020 2020 2073 656c 662e 726f 6973 203d       self.rois =
-0004aa20: 2072 6f69 730a 0a20 2020 2064 6566 2063   rois..    def c
-0004aa30: 6f6d 6269 6e65 5f72 6f69 7328 7365 6c66  ombine_rois(self
-0004aa40: 2c20 6e61 6d65 3d4e 6f6e 652c 2072 6f69  , name=None, roi
-0004aa50: 5f6e 616d 6573 3d4e 6f6e 652c 2069 6d61  _names=None, ima
-0004aa60: 6765 3d4e 6f6e 652c 206d 6574 686f 643d  ge=None, method=
-0004aa70: 4e6f 6e65 293a 0a20 2020 2020 2020 2027  None):.        '
-0004aa80: 2727 0a20 2020 2020 2020 2043 6f6d 6269  ''.        Combi
-0004aa90: 6e65 2074 776f 206f 7220 6d6f 7265 2052  ne two or more R
-0004aaa0: 4f49 7320 6173 2061 2073 696e 676c 6520  OIs as a single 
-0004aab0: 524f 492e 0a0a 2020 2020 2020 2020 2a2a  ROI...        **
-0004aac0: 5061 7261 6d65 7465 7273 3a2a 2a0a 0a20  Parameters:**.. 
-0004aad0: 2020 2020 2020 206e 616d 6520 3a20 7374         name : st
-0004aae0: 722c 2064 6566 6175 6c74 3d4e 6f6e 650a  r, default=None.
-0004aaf0: 2020 2020 2020 2020 2020 2020 4e61 6d65              Name
-0004ab00: 2074 6f20 6265 2067 6976 656e 2074 6f20   to be given to 
-0004ab10: 7468 6520 636f 6d70 6f73 6974 6520 524f  the composite RO
-0004ab20: 492e 2020 4966 204e 6f6e 652c 2074 6865  I.  If None, the
-0004ab30: 0a20 2020 2020 2020 2020 2020 206e 616d  .            nam
-0004ab40: 6520 6173 7369 676e 6564 2069 7320 666f  e assigned is fo
-0004ab50: 726d 6564 2062 7920 6a6f 696e 696e 6720  rmed by joining 
-0004ab60: 746f 6765 7468 6572 2074 6865 206e 616d  together the nam
-0004ab70: 6573 0a20 2020 2020 2020 2020 2020 206f  es.            o
-0004ab80: 6620 7468 6520 6f72 6967 696e 616c 2052  f the original R
-0004ab90: 4f49 732e 0a0a 2020 2020 2020 2020 726f  OIs...        ro
-0004aba0: 695f 6e61 6d65 7320 3a20 6c69 7374 2c20  i_names : list, 
-0004abb0: 6465 6661 756c 743d 4e6f 6e65 0a20 2020  default=None.   
-0004abc0: 2020 2020 2020 2020 204c 6973 7420 6f66           List of
-0004abd0: 206e 616d 6573 206f 6620 524f 4973 2074   names of ROIs t
-0004abe0: 6f20 6265 2063 6f6d 6269 6e65 642e 2020  o be combined.  
-0004abf0: 4966 204e 6f6e 652c 2061 6c6c 206f 6620  If None, all of 
-0004ac00: 7468 650a 2020 2020 2020 2020 2020 2020  the.            
-0004ac10: 7374 7275 6374 7572 6520 7365 7427 7320  structure set's 
-0004ac20: 524f 4973 2061 7265 2063 6f6d 6269 6e65  ROIs are combine
-0004ac30: 642e 0a0a 2020 2020 2020 2020 696d 6167  d...        imag
-0004ac40: 6520 3a20 736b 7274 2e69 6d61 6765 2e49  e : skrt.image.I
-0004ac50: 6d61 6765 2c20 6465 6661 756c 743d 4e6f  mage, default=No
-0004ac60: 6e65 0a20 2020 2020 2020 2020 2020 2049  ne.            I
-0004ac70: 6d61 6765 2074 6f20 7365 7420 666f 7220  mage to set for 
-0004ac80: 7468 6520 636f 6d70 6f73 6974 6520 524f  the composite RO
-0004ac90: 492e 2020 4966 204e 6f6e 652c 2075 7365  I.  If None, use
-0004aca0: 2074 6865 2069 6d61 6765 0a20 2020 2020   the image.     
-0004acb0: 2020 2020 2020 206f 6620 7468 6520 524f         of the RO
-0004acc0: 4920 7769 7468 2074 6865 2066 6972 7374  I with the first
-0004acd0: 2069 6e20 3c72 6f69 5f6e 616d 6573 3e2e   in <roi_names>.
-0004ace0: 0a0a 2020 2020 2020 2020 6d65 7468 6f64  ..        method
-0004acf0: 203a 2073 7472 2c20 6465 6661 756c 743d   : str, default=
-0004ad00: 4e6f 6e65 0a20 2020 2020 2020 2020 2020  None.           
-0004ad10: 204d 6574 686f 6420 746f 2075 7365 2066   Method to use f
-0004ad20: 6f72 2063 6f6d 6269 6e69 6e67 2052 4f49  or combining ROI
-0004ad30: 732e 2020 4361 6e20 6265 3a20 0a0a 2020  s.  Can be: ..  
-0004ad40: 2020 2020 2020 2020 2020 2020 2020 2d20                - 
-0004ad50: 2263 6f6e 746f 7572 223a 2074 616b 6520  "contour": take 
-0004ad60: 756e 6172 7920 756e 696f 6e20 6f66 2073  unary union of s
-0004ad70: 6861 7065 6c79 2070 6f6c 7967 6f6e 732e  hapely polygons.
-0004ad80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0004ad90: 202d 2022 6d61 736b 223a 2073 756d 2062   - "mask": sum b
-0004ada0: 696e 6172 7920 6d61 736b 732e 0a20 2020  inary masks..   
-0004adb0: 2020 2020 2020 2020 2020 2020 202d 2022               - "
-0004adc0: 6175 746f 223a 2075 7365 2074 6865 2064  auto": use the d
-0004add0: 6566 6175 6c74 5f67 656f 6d5f 6d65 7468  efault_geom_meth
-0004ade0: 6f64 206f 6620 7468 6520 524f 4920 7769  od of the ROI wi
-0004adf0: 7468 2074 6865 0a20 2020 2020 2020 2020  th the.         
-0004ae00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004ae10: 2066 6972 7374 206e 616d 6520 696e 203c   first name in <
-0004ae20: 726f 695f 6e61 6d65 733e 2e0a 0a20 2020  roi_names>...   
-0004ae30: 2020 2020 2020 2020 2049 6620 4e6f 6e65           If None
-0004ae40: 2c20 2261 7574 6f22 2069 7320 7573 6564  , "auto" is used
-0004ae50: 2e0a 2020 2020 2020 2020 2727 270a 0a20  ..        '''.. 
-0004ae60: 2020 2020 2020 2023 2049 6620 4e6f 6e65         # If None
-0004ae70: 2076 616c 7565 7320 7061 7373 6564 2c20   values passed, 
-0004ae80: 7365 7420 6465 6661 756c 7420 6265 6861  set default beha
-0004ae90: 7669 6f75 722e 0a20 2020 2020 2020 2069  viour..        i
-0004aea0: 6620 726f 695f 6e61 6d65 7320 6973 204e  f roi_names is N
-0004aeb0: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-0004aec0: 2072 6f69 5f6e 616d 6573 203d 2073 656c   roi_names = sel
-0004aed0: 662e 6765 745f 726f 695f 6e61 6d65 7328  f.get_roi_names(
-0004aee0: 290a 2020 2020 2020 2020 6966 206e 616d  ).        if nam
-0004aef0: 6520 6973 204e 6f6e 653a 0a20 2020 2020  e is None:.     
-0004af00: 2020 2020 2020 206e 616d 6520 3d20 272b         name = '+
-0004af10: 272e 6a6f 696e 2872 6f69 5f6e 616d 6573  '.join(roi_names
-0004af20: 290a 2020 2020 2020 2020 6966 206d 6574  ).        if met
-0004af30: 686f 6420 696e 205b 4e6f 6e65 2c20 2261  hod in [None, "a
-0004af40: 7574 6f22 5d3a 0a20 2020 2020 2020 2020  uto"]:.         
-0004af50: 2020 206d 6574 686f 6420 3d20 7365 6c66     method = self
-0004af60: 5b72 6f69 5f6e 616d 6573 5b30 5d5d 2e64  [roi_names[0]].d
-0004af70: 6566 6175 6c74 5f67 656f 6d5f 6d65 7468  efault_geom_meth
-0004af80: 6f64 0a20 2020 2020 2020 2069 6620 696d  od.        if im
-0004af90: 6167 6520 6973 204e 6f6e 653a 0a20 2020  age is None:.   
-0004afa0: 2020 2020 2020 2020 2069 6d61 6765 203d           image =
-0004afb0: 2073 656c 665b 726f 695f 6e61 6d65 735b   self[roi_names[
-0004afc0: 305d 5d2e 696d 6167 650a 0a20 2020 2020  0]].image..     
-0004afd0: 2020 2069 6620 2263 6f6e 746f 7572 2220     if "contour" 
-0004afe0: 3d3d 206d 6574 686f 643a 0a20 2020 2020  == method:.     
-0004aff0: 2020 2020 2020 2023 2043 7265 6174 6520         # Create 
-0004b000: 6120 6469 6374 696f 6e61 7279 2063 6f6e  a dictionary con
-0004b010: 7461 696e 696e 6720 706f 6c79 676f 6e73  taining polygons
-0004b020: 2066 6f72 2061 6c6c 2052 4f49 732e 0a20   for all ROIs.. 
-0004b030: 2020 2020 2020 2020 2020 2061 6c6c 5f70             all_p
-0004b040: 6f6c 7967 6f6e 7320 3d20 7b7d 0a20 2020  olygons = {}.   
-0004b050: 2020 2020 2020 2020 2066 6f72 2072 6f69           for roi
-0004b060: 2069 6e20 7365 6c66 2e67 6574 5f72 6f69   in self.get_roi
-0004b070: 7328 726f 695f 6e61 6d65 7329 3a0a 2020  s(roi_names):.  
-0004b080: 2020 2020 2020 2020 2020 2020 2020 666f                fo
-0004b090: 7220 6b65 792c 2070 6f6c 7967 6f6e 7320  r key, polygons 
-0004b0a0: 696e 2072 6f69 2e67 6574 5f70 6f6c 7967  in roi.get_polyg
-0004b0b0: 6f6e 7328 292e 6974 656d 7328 293a 0a20  ons().items():. 
-0004b0c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004b0d0: 2020 2069 6620 6e6f 7420 6b65 7920 696e     if not key in
-0004b0e0: 2061 6c6c 5f70 6f6c 7967 6f6e 733a 0a20   all_polygons:. 
-0004b0f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004b100: 2020 2020 2020 2061 6c6c 5f70 6f6c 7967         all_polyg
-0004b110: 6f6e 735b 6b65 795d 203d 205b 5d0a 2020  ons[key] = [].  
-0004b120: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004b130: 2020 616c 6c5f 706f 6c79 676f 6e73 5b6b    all_polygons[k
-0004b140: 6579 5d2e 6578 7465 6e64 2870 6f6c 7967  ey].extend(polyg
-0004b150: 6f6e 7329 0a0a 2020 2020 2020 2020 2020  ons)..          
-0004b160: 2020 2320 4576 616c 7561 7465 2074 6865    # Evaluate the
-0004b170: 2075 6e61 7279 2075 6e69 6f6e 206f 6620   unary union of 
-0004b180: 706f 6c79 676f 6e73 2066 6f72 2065 6163  polygons for eac
-0004b190: 6820 736c 6963 652e 0a20 2020 2020 2020  h slice..       
-0004b1a0: 2020 2020 2061 6c6c 5f70 6f6c 7967 6f6e       all_polygon
-0004b1b0: 7320 3d20 7b6b 6579 3a20 5b6f 7073 2e75  s = {key: [ops.u
-0004b1c0: 6e61 7279 5f75 6e69 6f6e 2861 6c6c 5f70  nary_union(all_p
-0004b1d0: 6f6c 7967 6f6e 735b 6b65 795d 295d 0a20  olygons[key])]. 
-0004b1e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004b1f0: 2020 2020 666f 7220 6b65 7920 696e 2061      for key in a
-0004b200: 6c6c 5f70 6f6c 7967 6f6e 737d 0a0a 2020  ll_polygons}..  
-0004b210: 2020 2020 2020 2020 2020 2320 4372 6561            # Crea
-0004b220: 7465 2074 6865 2063 6f6d 706f 7369 7465  te the composite
-0004b230: 2052 4f49 2e0a 2020 2020 2020 2020 2020   ROI..          
-0004b240: 2020 726f 695f 6e65 7720 3d20 524f 4928    roi_new = ROI(
-0004b250: 736f 7572 6365 3d61 6c6c 5f70 6f6c 7967  source=all_polyg
-0004b260: 6f6e 732c 2069 6d61 6765 3d69 6d61 6765  ons, image=image
-0004b270: 2c20 6e61 6d65 3d6e 616d 6529 0a0a 2020  , name=name)..  
-0004b280: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-0004b290: 2020 2020 2020 2020 2320 5573 6520 6461          # Use da
-0004b2a0: 7461 2066 726f 6d20 6f6e 6520 6f66 2074  ta from one of t
-0004b2b0: 6865 2052 4f49 7320 6173 2061 2073 7461  he ROIs as a sta
-0004b2c0: 7274 696e 6720 706f 696e 742e 0a20 2020  rting point..   
-0004b2d0: 2020 2020 2020 2020 2072 6f69 3020 3d20           roi0 = 
-0004b2e0: 7365 6c66 2e67 6574 5f72 6f69 2872 6f69  self.get_roi(roi
-0004b2f0: 5f6e 616d 6573 5b30 5d29 0a20 2020 2020  _names[0]).     
-0004b300: 2020 2020 2020 2072 6f69 5f6e 6577 203d         roi_new =
-0004b310: 2052 4f49 2873 6f75 7263 653d 726f 6930   ROI(source=roi0
-0004b320: 2e67 6574 5f6d 6173 6b28 292c 2061 6666  .get_mask(), aff
-0004b330: 696e 653d 726f 6930 2e61 6666 696e 652c  ine=roi0.affine,
-0004b340: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0004b350: 2020 2020 206e 616d 653d 6e61 6d65 2c20       name=name, 
-0004b360: 696d 6167 653d 696d 6167 6529 0a0a 2020  image=image)..  
-0004b370: 2020 2020 2020 2020 2020 2320 436f 6d62            # Comb
-0004b380: 696e 6520 7769 7468 2064 6174 6120 6672  ine with data fr
-0004b390: 6f6d 2074 6865 206f 7468 6572 2052 4f49  om the other ROI
-0004b3a0: 732e 0a20 2020 2020 2020 2020 2020 2066  s..            f
-0004b3b0: 6f72 2069 2069 6e20 7261 6e67 6528 312c  or i in range(1,
-0004b3c0: 206c 656e 2872 6f69 5f6e 616d 6573 2929   len(roi_names))
-0004b3d0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0004b3e0: 2020 726f 695f 6e65 772e 6d61 736b 2e64    roi_new.mask.d
-0004b3f0: 6174 6120 2b3d 2073 656c 662e 6765 745f  ata += self.get_
-0004b400: 726f 6928 726f 695f 6e61 6d65 735b 695d  roi(roi_names[i]
-0004b410: 292e 6765 745f 6d61 736b 2829 0a0a 2020  ).get_mask()..  
-0004b420: 2020 2020 2020 7265 7475 726e 2072 6f69        return roi
-0004b430: 5f6e 6577 0a0a 2020 2020 6465 6620 6765  _new..    def ge
-0004b440: 745f 6d61 736b 5f69 6d61 6765 2873 656c  t_mask_image(sel
-0004b450: 662c 206e 616d 653d 4e6f 6e65 293a 0a20  f, name=None):. 
-0004b460: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-0004b470: 2020 2047 6574 2069 6d61 6765 206f 626a     Get image obj
-0004b480: 6563 7420 7265 7072 6573 656e 7469 6e67  ect representing
-0004b490: 206d 6173 6b20 666f 7220 616c 6c20 524f   mask for all RO
-0004b4a0: 4973 206f 6620 7374 7275 6374 7572 6520  Is of structure 
-0004b4b0: 7365 742e 0a0a 2020 2020 2020 2020 2a2a  set...        **
-0004b4c0: 5061 7261 6d65 7465 7273 3a2a 2a0a 0a20  Parameters:**.. 
-0004b4d0: 2020 2020 2020 206e 616d 6520 3a20 7374         name : st
-0004b4e0: 722c 2064 6566 6175 6c74 3d4e 6f6e 650a  r, default=None.
-0004b4f0: 2020 2020 2020 2020 2020 2020 4e61 6d65              Name
-0004b500: 2074 6f20 6265 2067 6976 656e 2074 6f20   to be given to 
-0004b510: 7468 6520 6d61 736b 2069 6d61 6765 2e20  the mask image. 
-0004b520: 2049 6620 4e6f 6e65 2c20 7468 650a 2020   If None, the.  
-0004b530: 2020 2020 2020 2020 2020 6e61 6d65 2061            name a
-0004b540: 7373 6967 6e65 6420 6973 2074 6865 206e  ssigned is the n
-0004b550: 616d 6520 6f66 2074 6865 2073 7472 7563  ame of the struc
-0004b560: 7475 7265 2073 6574 2c20 7769 7468 2073  ture set, with s
-0004b570: 7566 6669 780a 2020 2020 2020 2020 2020  uffix.          
-0004b580: 2020 225f 6d61 736b 2220 6170 7065 6e64    "_mask" append
-0004b590: 6564 2e0a 2020 2020 2020 2020 2222 220a  ed..        """.
-0004b5a0: 2020 2020 2020 2020 6e61 6d65 203d 206e          name = n
-0004b5b0: 616d 6520 6f72 2066 227b 7365 6c66 2e6e  ame or f"{self.n
-0004b5c0: 616d 657d 5f6d 6173 6b22 0a20 2020 2020  ame}_mask".     
-0004b5d0: 2020 2072 6f69 5f63 6f6d 6269 6e65 6420     roi_combined 
-0004b5e0: 3d20 7365 6c66 2e63 6f6d 6269 6e65 5f72  = self.combine_r
-0004b5f0: 6f69 7328 6e61 6d65 3d6e 616d 6529 0a20  ois(name=name). 
-0004b600: 2020 2020 2020 206d 6173 6b5f 696d 6167         mask_imag
-0004b610: 6520 3d20 726f 695f 636f 6d62 696e 6564  e = roi_combined
-0004b620: 2e67 6574 5f6d 6173 6b5f 696d 6167 6528  .get_mask_image(
-0004b630: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
-0004b640: 206d 6173 6b5f 696d 6167 650a 0a20 2020   mask_image..   
-0004b650: 2064 6566 2063 726f 7028 7365 6c66 2c20   def crop(self, 
-0004b660: 786c 696d 3d4e 6f6e 652c 2079 6c69 6d3d  xlim=None, ylim=
-0004b670: 4e6f 6e65 2c20 7a6c 696d 3d4e 6f6e 6529  None, zlim=None)
-0004b680: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
-0004b690: 2020 2020 2020 4372 6f70 2061 6c6c 2052        Crop all R
-0004b6a0: 4f49 7320 6f66 2053 7472 7563 7475 7265  OIs of Structure
-0004b6b0: 5365 7420 746f 2073 7065 6369 6669 6564  Set to specified
-0004b6c0: 2072 616e 6765 2069 6e20 782c 2079 2c20   range in x, y, 
-0004b6d0: 7a2e 0a0a 2020 2020 2020 2020 5468 6520  z...        The 
-0004b6e0: 7061 7261 6d65 7465 7273 2078 6c69 6d2c  parameters xlim,
-0004b6f0: 2079 6c69 6d2c 207a 6c69 6d20 6172 6520   ylim, zlim are 
-0004b700: 7061 7373 6564 2074 6f20 6561 6368 2052  passed to each R
-0004b710: 4f49 2773 2063 726f 7028 2920 6d65 7468  OI's crop() meth
-0004b720: 6f64 2e0a 2020 2020 2020 2020 466f 7220  od..        For 
-0004b730: 6578 706c 616e 6174 696f 6e20 6f66 2074  explanation of t
-0004b740: 6865 7365 2070 6172 616d 6574 6572 732c  hese parameters,
-0004b750: 2073 6565 2064 6f63 756d 656e 7461 7469   see documentati
-0004b760: 6f6e 2066 6f72 0a20 2020 2020 2020 2073  on for.        s
-0004b770: 6b72 742e 7374 7275 6374 7572 6573 2e52  krt.structures.R
-0004b780: 4f49 2e63 726f 7028 292e 0a20 2020 2020  OI.crop()..     
-0004b790: 2020 2022 2222 0a20 2020 2020 2020 2066     """.        f
-0004b7a0: 6f72 2072 6f69 2069 6e20 7365 6c66 2e67  or roi in self.g
-0004b7b0: 6574 5f72 6f69 7328 293a 0a20 2020 2020  et_rois():.     
-0004b7c0: 2020 2020 2020 2072 6f69 2e63 726f 7028         roi.crop(
-0004b7d0: 786c 696d 2c20 796c 696d 2c20 7a6c 696d  xlim, ylim, zlim
-0004b7e0: 290a 0a63 6c61 7373 2053 7472 7563 7475  )..class Structu
-0004b7f0: 7265 5365 7449 7465 7261 746f 723a 0a0a  reSetIterator:..
-0004b800: 2020 2020 6465 6620 5f5f 696e 6974 5f5f      def __init__
-0004b810: 2873 656c 662c 2073 7472 7563 7475 7265  (self, structure
-0004b820: 5f73 6574 293a 0a20 2020 2020 2020 2073  _set):.        s
-0004b830: 656c 662e 6964 7820 3d20 2d31 0a20 2020  elf.idx = -1.   
-0004b840: 2020 2020 2073 656c 662e 7374 7275 6374       self.struct
-0004b850: 7572 655f 7365 7420 3d20 7374 7275 6374  ure_set = struct
-0004b860: 7572 655f 7365 740a 0a20 2020 2064 6566  ure_set..    def
-0004b870: 205f 5f6e 6578 745f 5f28 7365 6c66 293a   __next__(self):
-0004b880: 0a20 2020 2020 2020 2073 656c 662e 6964  .        self.id
-0004b890: 7820 2b3d 2031 0a20 2020 2020 2020 2069  x += 1.        i
-0004b8a0: 6620 7365 6c66 2e69 6478 203c 206c 656e  f self.idx < len
-0004b8b0: 2873 656c 662e 7374 7275 6374 7572 655f  (self.structure_
-0004b8c0: 7365 742e 6765 745f 726f 6973 2829 293a  set.get_rois()):
-0004b8d0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-0004b8e0: 7572 6e20 7365 6c66 2e73 7472 7563 7475  urn self.structu
-0004b8f0: 7265 5f73 6574 2e67 6574 5f72 6f69 7328  re_set.get_rois(
-0004b900: 295b 7365 6c66 2e69 6478 5d0a 2020 2020  )[self.idx].    
-0004b910: 2020 2020 7261 6973 6520 5374 6f70 4974      raise StopIt
-0004b920: 6572 6174 696f 6e0a 0a0a 6465 6620 6c6f  eration...def lo
-0004b930: 6164 5f72 6f69 735f 6469 636f 6d28 7061  ad_rois_dicom(pa
-0004b940: 7468 2c20 6e61 6d65 733d 4e6f 6e65 293a  th, names=None):
-0004b950: 0a20 2020 2022 2222 4c6f 6164 2052 4f49  .    """Load ROI
-0004b960: 2873 2920 6672 6f6d 2061 2064 6963 6f6d  (s) from a dicom
-0004b970: 2073 7472 7563 7475 7265 2073 6574 2066   structure set f
-0004b980: 696c 652e 203c 6e61 6d65 3e20 6361 6e20  ile. <name> can 
-0004b990: 6265 2061 2073 696e 676c 650a 2020 2020  be a single.    
-0004b9a0: 6e61 6d65 206f 7220 6c69 7374 206f 6620  name or list of 
-0004b9b0: 6e61 6d65 7320 6f66 2052 4f49 7320 746f  names of ROIs to
-0004b9c0: 206c 6f61 642e 2222 220a 0a20 2020 2023   load."""..    #
-0004b9d0: 204c 6f61 6420 6469 636f 6d20 6f62 6a65   Load dicom obje
-0004b9e0: 6374 0a20 2020 2074 7279 3a0a 2020 2020  ct.    try:.    
-0004b9f0: 2020 2020 6473 203d 2070 7964 6963 6f6d      ds = pydicom
-0004ba00: 2e64 636d 7265 6164 2870 6174 682c 2066  .dcmread(path, f
-0004ba10: 6f72 6365 3d54 7275 6529 0a20 2020 2065  orce=True).    e
-0004ba20: 7863 6570 7420 7079 6469 636f 6d2e 6572  xcept pydicom.er
-0004ba30: 726f 7273 2e49 6e76 616c 6964 4469 636f  rors.InvalidDico
-0004ba40: 6d45 7272 6f72 3a0a 2020 2020 2020 2020  mError:.        
-0004ba50: 7265 7475 726e 205b 5d2c 204e 6f6e 650a  return [], None.
-0004ba60: 2020 2020 6966 206e 6f74 2068 6173 6174      if not hasat
-0004ba70: 7472 2864 732c 2022 534f 5043 6c61 7373  tr(ds, "SOPClass
-0004ba80: 5549 4422 293a 0a20 2020 2020 2020 2072  UID"):.        r
-0004ba90: 6574 7572 6e20 5b5d 2c20 4e6f 6e65 0a20  eturn [], None. 
-0004baa0: 2020 2069 6620 6e6f 7420 2864 732e 534f     if not (ds.SO
-0004bab0: 5043 6c61 7373 5549 4420 3d3d 2022 312e  PClassUID == "1.
-0004bac0: 322e 3834 302e 3130 3030 382e 352e 312e  2.840.10008.5.1.
-0004bad0: 342e 312e 312e 3438 312e 3322 293a 0a20  4.1.1.481.3"):. 
-0004bae0: 2020 2020 2020 2070 7269 6e74 2866 2257         print(f"W
-0004baf0: 6172 6e69 6e67 3a20 7b70 6174 687d 2069  arning: {path} i
-0004bb00: 7320 6e6f 7420 6120 4449 434f 4d20 7374  s not a DICOM st
-0004bb10: 7275 6374 7572 6520 7365 7420 6669 6c65  ructure set file
-0004bb20: 2122 290a 2020 2020 2020 2020 7265 7475  !").        retu
-0004bb30: 726e 205b 5d2c 204e 6f6e 650a 0a20 2020  rn [], None..   
-0004bb40: 2023 2047 6574 2052 4f49 206e 616d 6573   # Get ROI names
-0004bb50: 0a20 2020 2073 6571 203d 2067 6574 5f64  .    seq = get_d
-0004bb60: 6963 6f6d 5f73 6571 7565 6e63 6528 6473  icom_sequence(ds
-0004bb70: 2c20 2253 7472 7563 7475 7265 5365 7452  , "StructureSetR
-0004bb80: 4f49 2229 0a20 2020 2072 6f69 7320 3d20  OI").    rois = 
-0004bb90: 7b7d 0a20 2020 2066 6f72 2072 6f69 2069  {}.    for roi i
-0004bba0: 6e20 7365 713a 0a20 2020 2020 2020 2072  n seq:.        r
-0004bbb0: 6f69 735b 696e 7428 726f 692e 524f 494e  ois[int(roi.ROIN
-0004bbc0: 756d 6265 7229 5d20 3d20 7b22 6e61 6d65  umber)] = {"name
-0004bbd0: 223a 2072 6f69 2e52 4f49 4e61 6d65 7d0a  ": roi.ROIName}.
-0004bbe0: 0a20 2020 2023 2046 696e 6420 524f 4973  .    # Find ROIs
-0004bbf0: 206d 6174 6368 696e 6720 7265 7175 6573   matching reques
-0004bc00: 7465 6420 6e61 6d65 730a 2020 2020 6e61  ted names.    na
-0004bc10: 6d65 735f 746f 5f6c 6f61 6420 3d20 4e6f  mes_to_load = No
-0004bc20: 6e65 0a20 2020 2069 6620 6973 696e 7374  ne.    if isinst
-0004bc30: 616e 6365 286e 616d 6573 2c20 7374 7229  ance(names, str)
-0004bc40: 3a0a 2020 2020 2020 2020 6e61 6d65 735f  :.        names_
-0004bc50: 746f 5f6c 6f61 6420 3d20 5b6e 616d 6573  to_load = [names
-0004bc60: 5d0a 2020 2020 656c 6966 2073 6b72 742e  ].    elif skrt.
-0004bc70: 636f 7265 2e69 735f 6c69 7374 286e 616d  core.is_list(nam
-0004bc80: 6573 293a 0a20 2020 2020 2020 206e 616d  es):.        nam
-0004bc90: 6573 5f74 6f5f 6c6f 6164 203d 206e 616d  es_to_load = nam
-0004bca0: 6573 0a20 2020 2069 6620 6e61 6d65 735f  es.    if names_
-0004bcb0: 746f 5f6c 6f61 643a 0a20 2020 2020 2020  to_load:.       
-0004bcc0: 2072 6f69 7320 3d20 7b0a 2020 2020 2020   rois = {.      
-0004bcd0: 2020 2020 2020 693a 2073 0a20 2020 2020        i: s.     
-0004bce0: 2020 2020 2020 2066 6f72 2069 2c20 7320         for i, s 
-0004bcf0: 696e 2072 6f69 732e 6974 656d 7328 290a  in rois.items().
-0004bd00: 2020 2020 2020 2020 2020 2020 6966 2061              if a
-0004bd10: 6e79 280a 2020 2020 2020 2020 2020 2020  ny(.            
-0004bd20: 2020 2020 5b66 6e6d 6174 6368 2e66 6e6d      [fnmatch.fnm
-0004bd30: 6174 6368 2873 5b22 6e61 6d65 225d 2e6c  atch(s["name"].l
-0004bd40: 6f77 6572 2829 2c20 6e2e 6c6f 7765 7228  ower(), n.lower(
-0004bd50: 2929 2066 6f72 206e 2069 6e20 6e61 6d65  )) for n in name
-0004bd60: 735f 746f 5f6c 6f61 645d 0a20 2020 2020  s_to_load].     
-0004bd70: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-0004bd80: 207d 0a20 2020 2020 2020 2069 6620 6e6f   }.        if no
-0004bd90: 7420 6c65 6e28 726f 6973 293a 0a20 2020  t len(rois):.   
-0004bda0: 2020 2020 2020 2020 2070 7269 6e74 2866           print(f
-0004bdb0: 2257 6172 6e69 6e67 3a20 6e6f 2052 4f49  "Warning: no ROI
-0004bdc0: 7320 666f 756e 6420 6d61 7463 6869 6e67  s found matching
-0004bdd0: 206e 616d 6528 7329 3a20 7b6e 616d 6573   name(s): {names
-0004bde0: 7d22 290a 2020 2020 2020 2020 2020 2020  }").            
-0004bdf0: 7265 7475 726e 205b 5d2c 204e 6f6e 650a  return [], None.
-0004be00: 0a20 2020 2023 2047 6574 2052 4f49 2064  .    # Get ROI d
-0004be10: 6574 6169 6c73 0a20 2020 2072 6f69 5f73  etails.    roi_s
-0004be20: 6571 203d 2067 6574 5f64 6963 6f6d 5f73  eq = get_dicom_s
-0004be30: 6571 7565 6e63 6528 6473 2c20 2252 4f49  equence(ds, "ROI
-0004be40: 436f 6e74 6f75 7222 290a 2020 2020 666f  Contour").    fo
-0004be50: 7220 726f 6920 696e 2072 6f69 5f73 6571  r roi in roi_seq
-0004be60: 3a0a 0a20 2020 2020 2020 206e 756d 6265  :..        numbe
-0004be70: 7220 3d20 726f 692e 5265 6665 7265 6e63  r = roi.Referenc
-0004be80: 6564 524f 494e 756d 6265 720a 2020 2020  edROINumber.    
-0004be90: 2020 2020 6966 206e 756d 6265 7220 6e6f      if number no
-0004bea0: 7420 696e 2072 6f69 733a 0a20 2020 2020  t in rois:.     
-0004beb0: 2020 2020 2020 2063 6f6e 7469 6e75 650a         continue.
-0004bec0: 2020 2020 2020 2020 6461 7461 203d 207b          data = {
-0004bed0: 2263 6f6e 746f 7572 7322 3a20 7b7d 7d0a  "contours": {}}.
-0004bee0: 0a20 2020 2020 2020 2023 2047 6574 2052  .        # Get R
-0004bef0: 4f49 2063 6f6c 6f75 720a 2020 2020 2020  OI colour.      
-0004bf00: 2020 6966 2022 524f 4944 6973 706c 6179    if "ROIDisplay
-0004bf10: 436f 6c6f 7222 2069 6e20 726f 693a 0a20  Color" in roi:. 
-0004bf20: 2020 2020 2020 2020 2020 2064 6174 615b             data[
-0004bf30: 2263 6f6c 6f72 225d 203d 205b 696e 7428  "color"] = [int(
-0004bf40: 6329 202f 2032 3535 2066 6f72 2063 2069  c) / 255 for c i
-0004bf50: 6e20 6c69 7374 2872 6f69 2e52 4f49 4469  n list(roi.ROIDi
-0004bf60: 7370 6c61 7943 6f6c 6f72 295d 0a20 2020  splayColor)].   
-0004bf70: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-0004bf80: 2020 2020 2020 2064 6174 615b 2263 6f6c         data["col
-0004bf90: 6f72 225d 203d 204e 6f6e 650a 0a20 2020  or"] = None..   
-0004bfa0: 2020 2020 2023 2047 6574 2063 6f6e 746f       # Get conto
-0004bfb0: 7572 730a 2020 2020 2020 2020 636f 6e74  urs.        cont
-0004bfc0: 6f75 725f 7365 7120 3d20 6765 745f 6469  our_seq = get_di
-0004bfd0: 636f 6d5f 7365 7175 656e 6365 2872 6f69  com_sequence(roi
-0004bfe0: 2c20 2243 6f6e 746f 7572 2229 0a20 2020  , "Contour").   
-0004bff0: 2020 2020 2069 6620 636f 6e74 6f75 725f       if contour_
-0004c000: 7365 713a 0a20 2020 2020 2020 2020 2020  seq:.           
-0004c010: 2066 6f72 2063 2069 6e20 636f 6e74 6f75   for c in contou
-0004c020: 725f 7365 713a 0a20 2020 2020 2020 2020  r_seq:.         
-0004c030: 2020 2020 2020 2070 6c61 6e65 5f64 6174         plane_dat
-0004c040: 6120 3d20 5b0a 2020 2020 2020 2020 2020  a = [.          
-0004c050: 2020 2020 2020 2020 2020 5b66 6c6f 6174            [float
-0004c060: 2870 2920 666f 7220 7020 696e 2063 2e43  (p) for p in c.C
-0004c070: 6f6e 746f 7572 4461 7461 5b69 202a 2033  ontourData[i * 3
-0004c080: 203a 2069 202a 2033 202b 2033 5d5d 0a20   : i * 3 + 3]]. 
-0004c090: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004c0a0: 2020 2066 6f72 2069 2069 6e20 7261 6e67     for i in rang
-0004c0b0: 6528 632e 4e75 6d62 6572 4f66 436f 6e74  e(c.NumberOfCont
-0004c0c0: 6f75 7250 6f69 6e74 7329 0a20 2020 2020  ourPoints).     
-0004c0d0: 2020 2020 2020 2020 2020 205d 0a20 2020             ].   
-0004c0e0: 2020 2020 2020 2020 2020 2020 207a 203d               z =
-0004c0f0: 2066 6c6f 6174 2863 2e43 6f6e 746f 7572   float(c.Contour
-0004c100: 4461 7461 5b32 5d29 0a20 2020 2020 2020  Data[2]).       
-0004c110: 2020 2020 2020 2020 2069 6620 7a20 6e6f           if z no
-0004c120: 7420 696e 2064 6174 615b 2263 6f6e 746f  t in data["conto
-0004c130: 7572 7322 5d3a 0a20 2020 2020 2020 2020  urs"]:.         
-0004c140: 2020 2020 2020 2020 2020 2064 6174 615b             data[
-0004c150: 2263 6f6e 746f 7572 7322 5d5b 7a5d 203d  "contours"][z] =
-0004c160: 205b 5d0a 2020 2020 2020 2020 2020 2020   [].            
-0004c170: 2020 2020 6461 7461 5b22 636f 6e74 6f75      data["contou
-0004c180: 7273 225d 5b7a 5d2e 6170 7065 6e64 286e  rs"][z].append(n
-0004c190: 702e 6172 7261 7928 706c 616e 655f 6461  p.array(plane_da
-0004c1a0: 7461 2929 0a0a 2020 2020 2020 2020 726f  ta))..        ro
-0004c1b0: 6973 5b6e 756d 6265 725d 2e75 7064 6174  is[number].updat
-0004c1c0: 6528 6461 7461 290a 0a20 2020 2072 6574  e(data)..    ret
-0004c1d0: 7572 6e20 726f 6973 2c20 6473 0a0a 0a64  urn rois, ds...d
-0004c1e0: 6566 2067 6574 5f64 6963 6f6d 5f73 6571  ef get_dicom_seq
-0004c1f0: 7565 6e63 6528 6473 3d4e 6f6e 652c 2062  uence(ds=None, b
-0004c200: 6173 656e 616d 653d 2222 293a 0a0a 2020  asename=""):..  
-0004c210: 2020 7365 7175 656e 6365 203d 205b 5d0a    sequence = [].
-0004c220: 2020 2020 666f 7220 7375 6666 6978 2069      for suffix i
-0004c230: 6e20 5b22 5365 7175 656e 6365 222c 2022  n ["Sequence", "
-0004c240: 7322 5d3a 0a20 2020 2020 2020 2061 7474  s"]:.        att
-0004c250: 7269 6275 7465 203d 2066 227b 6261 7365  ribute = f"{base
-0004c260: 6e61 6d65 7d7b 7375 6666 6978 7d22 0a20  name}{suffix}". 
-0004c270: 2020 2020 2020 2069 6620 6861 7361 7474         if hasatt
-0004c280: 7228 6473 2c20 6174 7472 6962 7574 6529  r(ds, attribute)
-0004c290: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
-0004c2a0: 7175 656e 6365 203d 2067 6574 6174 7472  quence = getattr
-0004c2b0: 2864 732c 2061 7474 7269 6275 7465 290a  (ds, attribute).
-0004c2c0: 2020 2020 2020 2020 2020 2020 6272 6561              brea
-0004c2d0: 6b0a 2020 2020 7265 7475 726e 2073 6571  k.    return seq
-0004c2e0: 7565 6e63 650a 0a64 6566 2063 6f6e 746f  uence..def conto
-0004c2f0: 7572 5f74 6f5f 706f 6c79 676f 6e28 636f  ur_to_polygon(co
-0004c300: 6e74 6f75 7229 3a0a 2020 2020 2222 2243  ntour):.    """C
-0004c310: 6f6e 7665 7274 2061 206c 6973 7420 6f66  onvert a list of
-0004c320: 2063 6f6e 746f 7572 2070 6f69 6e74 7320   contour points 
-0004c330: 746f 2061 2053 6861 7065 6c79 2070 6f6c  to a Shapely pol
-0004c340: 7967 6f6e 2c20 656e 7375 7269 6e67 2074  ygon, ensuring t
-0004c350: 6861 7420 0a20 2020 2074 6865 2070 6f6c  hat .    the pol
-0004c360: 7967 6f6e 2069 7320 7661 6c69 642e 2222  ygon is valid.""
-0004c370: 220a 0a20 2020 2070 6f6c 7967 6f6e 203d  "..    polygon =
-0004c380: 2067 656f 6d65 7472 792e 506f 6c79 676f   geometry.Polygo
-0004c390: 6e28 636f 6e74 6f75 7229 0a0a 2020 2020  n(contour)..    
-0004c3a0: 6465 6c74 6120 3d20 302e 3030 350a 2020  delta = 0.005.  
-0004c3b0: 2020 6966 206e 6f74 2070 6f6c 7967 6f6e    if not polygon
-0004c3c0: 2e69 735f 7661 6c69 643a 0a20 2020 2020  .is_valid:.     
-0004c3d0: 2020 2074 6d70 203d 2067 656f 6d65 7472     tmp = geometr
-0004c3e0: 792e 506f 6c79 676f 6e28 706f 6c79 676f  y.Polygon(polygo
-0004c3f0: 6e29 0a20 2020 2020 2020 2062 7566 6665  n).        buffe
-0004c400: 7220 3d20 302e 0a20 2020 2020 2020 2023  r = 0..        #
-0004c410: 2054 6865 2069 6465 6120 6865 7265 2069   The idea here i
-0004c420: 7320 746f 2069 6e63 7265 6173 6520 7468  s to increase th
-0004c430: 6520 6275 6666 6572 2064 6973 7461 6e63  e buffer distanc
-0004c440: 6520 756e 7469 6c0a 2020 2020 2020 2020  e until.        
-0004c450: 2320 6120 7661 6c69 6420 706f 6c79 676f  # a valid polygo
-0004c460: 6e20 6973 206f 6274 6169 6e65 642e 2020  n is obtained.  
-0004c470: 5468 6973 2067 656e 6572 616c 6c79 2073  This generally s
-0004c480: 6565 6d73 2074 6f20 776f 726b 2e2e 2e0a  eems to work....
-0004c490: 2020 2020 2020 2020 7768 696c 6520 2869          while (i
-0004c4a0: 7369 6e73 7461 6e63 6528 706f 6c79 676f  sinstance(polygo
-0004c4b0: 6e2c 2067 656f 6d65 7472 792e 4d75 6c74  n, geometry.Mult
-0004c4c0: 6950 6f6c 7967 6f6e 290a 2020 2020 2020  iPolygon).      
-0004c4d0: 2020 2020 2020 2020 2020 6f72 206e 6f74            or not
-0004c4e0: 2070 6f6c 7967 6f6e 2e69 735f 7661 6c69   polygon.is_vali
-0004c4f0: 6429 3a0a 2020 2020 2020 2020 2020 2020  d):.            
-0004c500: 6275 6666 6572 202b 3d20 6465 6c74 610a  buffer += delta.
-0004c510: 2020 2020 2020 2020 2020 2020 706f 6c79              poly
-0004c520: 676f 6e20 3d20 746d 702e 6275 6666 6572  gon = tmp.buffer
-0004c530: 2862 7566 6665 7229 0a20 2020 2020 2020  (buffer).       
-0004c540: 2070 6f69 6e74 7320 3d20 5b5d 0a20 2020   points = [].   
-0004c550: 2020 2020 2066 6f72 2078 2c20 7920 696e       for x, y in
-0004c560: 2070 6f6c 7967 6f6e 2e65 7874 6572 696f   polygon.exterio
-0004c570: 722e 636f 6f72 6473 3a0a 2020 2020 2020  r.coords:.      
-0004c580: 2020 2020 2020 706f 696e 7473 2e61 7070        points.app
-0004c590: 656e 6428 2878 2c20 7929 290a 2020 2020  end((x, y)).    
-0004c5a0: 2020 2020 706f 6c79 676f 6e20 3d20 6765      polygon = ge
-0004c5b0: 6f6d 6574 7279 2e50 6f6c 7967 6f6e 2870  ometry.Polygon(p
-0004c5c0: 6f69 6e74 7329 0a0a 2020 2020 7265 7475  oints)..    retu
-0004c5d0: 726e 2070 6f6c 7967 6f6e 0a0a 6465 6620  rn polygon..def 
-0004c5e0: 706f 6c79 676f 6e5f 746f 5f63 6f6e 746f  polygon_to_conto
-0004c5f0: 7572 2870 6f6c 7967 6f6e 293a 0a20 2020  ur(polygon):.   
-0004c600: 2027 2727 0a20 2020 2043 6f6e 7665 7274   '''.    Convert
-0004c610: 2061 2053 6861 7065 6c79 2070 6f6c 7967   a Shapely polyg
-0004c620: 6f6e 2074 6f20 6120 6c69 7374 206f 6620  on to a list of 
-0004c630: 636f 6e74 6f75 7220 706f 696e 7473 2e0a  contour points..
-0004c640: 0a20 2020 202a 2a50 6172 616d 6574 6572  .    **Parameter
-0004c650: 3a2a 2a0a 0a20 2020 2070 6f6c 7967 6f6e  :**..    polygon
-0004c660: 3a20 7368 6170 656c 792e 6765 6f6d 6574  : shapely.geomet
-0004c670: 7279 2e70 6f6c 7967 6f6e 0a20 2020 2020  ry.polygon.     
-0004c680: 2020 2053 6861 7065 6c79 2070 6f6c 7967     Shapely polyg
-0004c690: 6f6e 2e0a 0a20 2020 207a 5f70 6f6c 7967  on...    z_polyg
-0004c6a0: 6f6e 3a20 7a20 636f 6f72 6469 6e61 7465  on: z coordinate
-0004c6b0: 2061 7420 7768 6963 6820 706f 6c79 676f   at which polygo
-0004c6c0: 6e20 6973 2064 6566 696e 6564 2e0a 2020  n is defined..  
-0004c6d0: 2020 2727 270a 2020 2020 636f 6e74 6f75    '''.    contou
-0004c6e0: 725f 706f 696e 7473 203d 205b 5d0a 2020  r_points = [].  
-0004c6f0: 2020 666f 7220 782c 2079 2069 6e20 6c69    for x, y in li
-0004c700: 7374 2870 6f6c 7967 6f6e 2e65 7874 6572  st(polygon.exter
-0004c710: 696f 722e 636f 6f72 6473 293a 0a20 2020  ior.coords):.   
-0004c720: 2020 2020 2063 6f6e 746f 7572 5f70 6f69       contour_poi
-0004c730: 6e74 732e 6170 7065 6e64 285b 782c 2079  nts.append([x, y
-0004c740: 5d29 0a20 2020 2063 6f6e 746f 7572 203d  ]).    contour =
-0004c750: 206e 702e 6172 7261 7928 636f 6e74 6f75   np.array(contou
-0004c760: 725f 706f 696e 7473 290a 0a20 2020 2072  r_points)..    r
-0004c770: 6574 7572 6e20 636f 6e74 6f75 720a 0a64  eturn contour..d
-0004c780: 6566 2069 6e74 6572 706f 6c61 7465 5f70  ef interpolate_p
-0004c790: 6f69 6e74 735f 7369 6e67 6c65 5f63 6f6e  oints_single_con
-0004c7a0: 746f 7572 2873 6f75 7263 653d 4e6f 6e65  tour(source=None
-0004c7b0: 2c20 6e5f 706f 696e 743d 4e6f 6e65 2c20  , n_point=None, 
-0004c7c0: 6478 793d 4e6f 6e65 2c0a 2020 2020 2020  dxy=None,.      
-0004c7d0: 2020 736d 6f6f 7468 6e65 7373 5f70 6572    smoothness_per
-0004c7e0: 5f70 6f69 6e74 3d30 293a 0a20 2020 2027  _point=0):.    '
-0004c7f0: 2727 0a20 2020 2049 6e74 6572 706f 6c61  ''.    Interpola
-0004c800: 7465 2070 6f69 6e74 7320 666f 7220 6120  te points for a 
-0004c810: 7369 6e67 6c65 2063 6f6e 746f 7572 2e0a  single contour..
-0004c820: 0a20 2020 202a 2a50 6172 616d 6574 6572  .    **Parameter
-0004c830: 733a 2a2a 0a0a 2020 2020 736f 7572 6365  s:**..    source
-0004c840: 203a 2073 6861 7065 6c79 2e70 6f6c 7967   : shapely.polyg
-0004c850: 6f6e 2e50 6f6c 7967 6f6e 2f6e 702e 6e64  on.Polygon/np.nd
-0004c860: 6172 7261 792f 6c69 7374 2c20 6465 6661  array/list, defa
-0004c870: 756c 743d 4e6f 6e65 0a20 2020 2020 2020  ult=None.       
-0004c880: 2043 6f6e 746f 7572 2072 6570 7265 7365   Contour represe
-0004c890: 6e74 6174 696f 6e20 6173 2065 6974 6865  ntation as eithe
-0004c8a0: 7220 6120 7368 6170 656c 7920 506f 6c79  r a shapely Poly
-0004c8b0: 676f 6e2c 2061 206e 756d 7079 0a20 2020  gon, a numpy.   
-0004c8c0: 2020 2020 2061 7272 6179 206f 6620 5b78       array of [x
-0004c8d0: 2c20 795d 2070 6169 7273 206f 7220 6120  , y] pairs or a 
-0004c8e0: 6c69 7374 206f 6620 5b78 2c20 795d 2070  list of [x, y] p
-0004c8f0: 6169 7273 2e20 2054 6865 0a20 2020 2020  airs.  The.     
-0004c900: 2020 2072 6574 7572 6e65 6420 636f 6e74     returned cont
-0004c910: 6f75 7220 6861 7320 7468 6520 7361 6d65  our has the same
-0004c920: 2072 6570 7265 7365 6e74 6174 696f 6e2e   representation.
-0004c930: 0a0a 2020 2020 6e5f 706f 696e 7420 3a20  ..    n_point : 
-0004c940: 696e 742c 2064 6566 6175 6c74 3d4e 6f6e  int, default=Non
-0004c950: 650a 2020 2020 2020 2020 4e75 6d62 6572  e.        Number
-0004c960: 206f 6620 706f 696e 7473 2074 6f20 6465   of points to de
-0004c970: 6669 6e65 2063 6f6e 746f 7572 2c20 6166  fine contour, af
-0004c980: 7465 7220 696e 7465 7270 6f6c 6174 696f  ter interpolatio
-0004c990: 6e2e 2020 5468 6973 206d 7573 740a 2020  n.  This must.  
-0004c9a0: 2020 2020 2020 6265 2073 6574 2074 6f20        be set to 
-0004c9b0: 4e6f 6e65 2066 6f72 2064 7879 2074 6f20  None for dxy to 
-0004c9c0: 6265 2063 6f6e 7369 6465 7265 642e 0a0a  be considered...
-0004c9d0: 2020 2020 6478 7920 3a20 666c 6f61 742c      dxy : float,
-0004c9e0: 2064 6566 6175 6c74 3d4e 6f6e 650a 2020   default=None.  
-0004c9f0: 2020 2020 2020 4170 7072 6f78 696d 6174        Approximat
-0004ca00: 6520 6469 7374 616e 6365 2072 6571 7569  e distance requi
-0004ca10: 7265 6420 6265 7477 6565 6e20 636f 6e74  red between cont
-0004ca20: 6f75 7220 706f 696e 7473 2e20 2054 6869  our points.  Thi
-0004ca30: 7320 6973 2074 616b 656e 0a20 2020 2020  s is taken.     
-0004ca40: 2020 2069 6e74 6f20 6163 636f 756e 7420     into account 
-0004ca50: 6f6e 6c79 2069 6620 6e5f 706f 696e 7420  only if n_point 
-0004ca60: 6973 2073 6574 2074 6f20 4e6f 6e65 2e20  is set to None. 
-0004ca70: 2046 6f72 2061 2063 6f6e 746f 7572 206f   For a contour o
-0004ca80: 660a 2020 2020 2020 2020 6c65 6e67 7468  f.        length
-0004ca90: 2063 6f6e 746f 7572 5f6c 656e 6774 682c   contour_length,
-0004caa0: 2074 6865 206e 756d 6265 7220 6f66 2063   the number of c
-0004cab0: 6f6e 746f 7572 2070 6f69 6e74 7320 6973  ontour points is
-0004cac0: 2074 6865 6e20 7461 6b65 6e0a 2020 2020   then taken.    
-0004cad0: 2020 2020 746f 2062 6520 6d61 7828 696e      to be max(in
-0004cae0: 7428 636f 6e74 6f75 725f 6c65 6e67 7468  t(contour_length
-0004caf0: 202f 2064 7879 292c 2033 292e 2020 0a0a   / dxy), 3).  ..
-0004cb00: 2020 2020 736d 6f6f 7468 6e65 7373 5f70      smoothness_p
-0004cb10: 6572 5f70 6f69 6e74 203a 2066 6c6f 6174  er_point : float
-0004cb20: 2c20 6465 6661 756c 743d 300a 2020 2020  , default=0.    
-0004cb30: 2020 2020 5061 7261 6d65 7465 7220 6465      Parameter de
-0004cb40: 7465 726d 696e 696e 6720 7468 6520 736d  termining the sm
-0004cb50: 6f6f 7468 6e65 7373 206f 6620 7468 6520  oothness of the 
-0004cb60: 422d 7370 6c69 6e65 2063 7572 7665 2075  B-spline curve u
-0004cb70: 7365 640a 2020 2020 2020 2020 696e 2063  sed.        in c
-0004cb80: 6f6e 746f 7572 2061 7070 726f 7869 6d61  ontour approxima
-0004cb90: 7469 6f6e 2066 6f72 2069 6e74 6572 706f  tion for interpo
-0004cba0: 6c61 7469 6f6e 2e20 2054 6865 2070 726f  lation.  The pro
-0004cbb0: 6475 6374 206f 660a 2020 2020 2020 2020  duct of.        
-0004cbc0: 736d 6f6f 7468 6e65 7373 5f70 6572 5f70  smoothness_per_p
-0004cbd0: 6f69 6e74 2061 6e64 2074 6865 206e 756d  oint and the num
-0004cbe0: 6265 7220 6f66 2063 6f6e 746f 7572 2070  ber of contour p
-0004cbf0: 6f69 6e74 7320 2873 7065 6369 6669 6564  oints (specified
-0004cc00: 0a20 2020 2020 2020 2064 6972 6563 746c  .        directl
-0004cc10: 7920 7669 6120 6e5f 706f 696e 742c 206f  y via n_point, o
-0004cc20: 7220 696e 6469 7265 6374 6c79 2076 6961  r indirectly via
-0004cc30: 2064 7879 2920 636f 7272 6573 706f 6e64   dxy) correspond
-0004cc40: 7320 746f 2074 6865 0a20 2020 2020 2020  s to the.       
-0004cc50: 2070 6172 616d 6574 6572 2073 206f 6620   parameter s of 
-0004cc60: 7363 6970 792e 696e 7465 7270 6f6c 6174  scipy.interpolat
-0004cc70: 652e 7370 6c70 7265 7020 2d20 7365 6520  e.splprep - see 
-0004cc80: 646f 6375 6d65 6e74 6174 696f 6e20 6174  documentation at
-0004cc90: 3a0a 2020 2020 2020 2020 0a20 2020 2020  :.        .     
-0004cca0: 2020 2068 7474 7073 3a2f 2f73 6369 7079     https://scipy
-0004ccb0: 2e67 6974 6875 622e 696f 2f64 6576 646f  .github.io/devdo
-0004ccc0: 6373 2f72 6566 6572 656e 6365 2f67 656e  cs/reference/gen
-0004ccd0: 6572 6174 6564 2f73 6369 7079 2e69 6e74  erated/scipy.int
-0004cce0: 6572 706f 6c61 7465 2e73 706c 7072 6570  erpolate.splprep
-0004ccf0: 2e68 746d 6c23 7363 6970 792e 696e 7465  .html#scipy.inte
-0004cd00: 7270 6f6c 6174 652e 7370 6c70 7265 700a  rpolate.splprep.
-0004cd10: 0a20 2020 2020 2020 2041 2073 6d6f 6f74  .        A smoot
-0004cd20: 686e 6573 735f 7065 725f 706f 696e 7420  hness_per_point 
-0004cd30: 6f66 2030 2066 6f72 6365 7320 7468 6520  of 0 forces the 
-0004cd40: 422d 7370 6c69 6e65 2074 6f20 7061 7373  B-spline to pass
-0004cd50: 2074 6872 6f75 6768 0a20 2020 2020 2020   through.       
-0004cd60: 2061 6c6c 206f 6620 7468 6520 7072 652d   all of the pre-
-0004cd70: 696e 7465 7270 6f6c 6174 696f 6e20 636f  interpolation co
-0004cd80: 6e74 6f75 7220 706f 696e 7473 2e0a 2020  ntour points..  
-0004cd90: 2020 2727 270a 0a20 2020 2023 2045 7874    '''..    # Ext
-0004cda0: 7261 6374 206c 6973 7420 6f66 2063 6f6e  ract list of con
-0004cdb0: 746f 7572 2070 6f69 6e74 7320 6672 6f6d  tour points from
-0004cdc0: 2073 6f75 7263 652e 0a20 2020 2063 6f6e   source..    con
-0004cdd0: 746f 7572 5f6c 656e 6774 6820 3d20 4e6f  tour_length = No
-0004cde0: 6e65 0a20 2020 2069 6620 6973 696e 7374  ne.    if isinst
-0004cdf0: 616e 6365 2873 6f75 7263 652c 2067 656f  ance(source, geo
-0004ce00: 6d65 7472 792e 706f 6c79 676f 6e2e 506f  metry.polygon.Po
-0004ce10: 6c79 676f 6e29 3a0a 2020 2020 2020 2020  lygon):.        
-0004ce20: 706f 696e 7473 203d 206c 6973 7428 706f  points = list(po
-0004ce30: 6c79 676f 6e5f 746f 5f63 6f6e 746f 7572  lygon_to_contour
-0004ce40: 2873 6f75 7263 6529 290a 2020 2020 2020  (source)).      
-0004ce50: 2020 636f 6e74 6f75 725f 6c65 6e67 7468    contour_length
-0004ce60: 203d 2073 6f75 7263 652e 6c65 6e67 7468   = source.length
-0004ce70: 0a20 2020 2065 6c69 6620 6973 696e 7374  .    elif isinst
-0004ce80: 616e 6365 2873 6f75 7263 652c 206e 702e  ance(source, np.
-0004ce90: 6e64 6172 7261 7929 206f 7220 6973 696e  ndarray) or isin
-0004cea0: 7374 616e 6365 2873 6f75 7263 652c 206c  stance(source, l
-0004ceb0: 6973 7429 3a0a 2020 2020 2020 2020 706f  ist):.        po
-0004cec0: 696e 7473 203d 206c 6973 7428 736f 7572  ints = list(sour
-0004ced0: 6365 290a 2020 2020 656c 7365 3a0a 2020  ce).    else:.  
-0004cee0: 2020 2020 2020 706f 696e 7473 203d 204e        points = N
-0004cef0: 6f6e 650a 0a20 2020 2069 6620 706f 696e  one..    if poin
-0004cf00: 7473 2069 7320 4e6f 6e65 3a0a 2020 2020  ts is None:.    
-0004cf10: 2020 2020 7072 696e 7428 2755 6e72 6563      print('Unrec
-0004cf20: 6f67 6e69 7365 6420 736f 7572 6365 2070  ognised source p
-0004cf30: 6173 7365 6420 746f 2027 0a20 2020 2020  assed to '.     
-0004cf40: 2020 2020 2020 2020 2020 2027 5c27 696e             '\'in
-0004cf50: 7465 7270 6f6c 6174 655f 706f 696e 7473  terpolate_points
-0004cf60: 5f73 696e 676c 655f 636f 6e74 6f75 7228  _single_contour(
-0004cf70: 295c 2727 290a 2020 2020 2020 2020 7072  )\'').        pr
-0004cf80: 696e 7428 2753 6f75 7263 6520 6d75 7374  int('Source must
-0004cf90: 2062 6520 7368 6170 656c 7920 506f 6c79   be shapely Poly
-0004cfa0: 676f 6e20 6f72 2063 6f6e 746f 7572 2729  gon or contour')
-0004cfb0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-0004cfc0: 4e6f 6e65 0a0a 2020 2020 2320 4966 206e  None..    # If n
-0004cfd0: 756d 6265 7220 6f66 2063 6f6e 746f 7572  umber of contour
-0004cfe0: 2070 6f69 6e74 7320 6e6f 7420 7061 7373   points not pass
-0004cff0: 6564 2064 6972 6563 746c 792c 0a20 2020  ed directly,.   
-0004d000: 2023 2074 7279 2074 6f20 6465 7465 726d   # try to determ
-0004d010: 696e 6520 6974 7320 7661 6c75 6520 6672  ine its value fr
-0004d020: 6f6d 2074 6865 2064 6973 7461 6e63 6520  om the distance 
-0004d030: 6265 7477 6565 6e20 636f 6e74 6f75 7220  between contour 
-0004d040: 706f 696e 7473 2e0a 2020 2020 6966 206e  points..    if n
-0004d050: 5f70 6f69 6e74 2069 7320 4e6f 6e65 2061  _point is None a
-0004d060: 6e64 2064 7879 3a0a 2020 2020 2020 2020  nd dxy:.        
-0004d070: 6966 2063 6f6e 746f 7572 5f6c 656e 6774  if contour_lengt
-0004d080: 6820 6973 204e 6f6e 653a 0a20 2020 2020  h is None:.     
-0004d090: 2020 2020 2020 2063 6f6e 746f 7572 5f6c         contour_l
-0004d0a0: 656e 6774 6820 3d20 636f 6e74 6f75 725f  ength = contour_
-0004d0b0: 746f 5f70 6f6c 7967 6f6e 2873 6f75 7263  to_polygon(sourc
-0004d0c0: 6529 2e6c 656e 6774 680a 2020 2020 2020  e).length.      
-0004d0d0: 2020 6e5f 706f 696e 7420 3d20 6d61 7828    n_point = max(
-0004d0e0: 696e 7428 636f 6e74 6f75 725f 6c65 6e67  int(contour_leng
-0004d0f0: 7468 202f 2064 7879 292c 2033 290a 2020  th / dxy), 3).  
-0004d100: 2020 6966 206e 5f70 6f69 6e74 2069 7320    if n_point is 
-0004d110: 4e6f 6e65 3a0a 2020 2020 2020 2020 7072  None:.        pr
-0004d120: 696e 7428 274e 6f20 696e 7465 7270 6f6c  int('No interpol
-0004d130: 6174 696f 6e20 7065 7266 6f72 6d65 6427  ation performed'
-0004d140: 290a 2020 2020 2020 2020 7072 696e 7428  ).        print(
-0004d150: 274e 756d 6265 7220 6f66 2063 6f6e 746f  'Number of conto
-0004d160: 7572 2070 6f69 6e74 7320 286e 5f70 6f69  ur points (n_poi
-0004d170: 6e74 2920 6f72 2064 6973 7461 6e63 6520  nt) or distance 
-0004d180: 6265 7477 6565 6e20 706f 696e 7473 270a  between points'.
-0004d190: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004d1a0: 276d 7573 7420 6265 2073 7065 6369 6669  'must be specifi
-0004d1b0: 6564 2e27 290a 2020 2020 2020 2020 7265  ed.').        re
-0004d1c0: 7475 726e 204e 6f6e 650a 0a20 2020 2023  turn None..    #
-0004d1d0: 204d 616b 6520 6c61 7374 2070 6f69 6e74   Make last point
-0004d1e0: 2074 6865 2073 616d 6520 6173 2074 6865   the same as the
-0004d1f0: 2066 6972 7374 2c20 746f 2065 6e73 7572   first, to ensur
-0004d200: 6520 636c 6f73 6564 2063 7572 7665 2e0a  e closed curve..
-0004d210: 2020 2020 706f 696e 7473 2e61 7070 656e      points.appen
-0004d220: 6428 706f 696e 7473 5b30 5d29 0a0a 2020  d(points[0])..  
-0004d230: 2020 2320 4469 7363 6172 6420 706f 696e    # Discard poin
-0004d240: 7473 2074 6861 7420 6172 656e 2774 2073  ts that aren't s
-0004d250: 6570 6172 6174 6564 2066 726f 6d20 7468  eparated from th
-0004d260: 6520 7072 6563 6565 6469 6e67 2070 6f69  e preceeding poi
-0004d270: 6e74 0a20 2020 2023 2062 7920 6174 206c  nt.    # by at l
-0004d280: 6561 7374 2073 6f6d 6520 6d69 6e69 6d75  east some minimu
-0004d290: 6d20 6469 7374 616e 6365 2e0a 2020 2020  m distance..    
-0004d2a0: 6478 795f 6d69 6e20 3d20 302e 3030 310a  dxy_min = 0.001.
-0004d2b0: 2020 2020 785f 6c61 7374 2c20 795f 6c61      x_last, y_la
-0004d2c0: 7374 203d 2070 6f69 6e74 735b 305d 0a20  st = points[0]. 
-0004d2d0: 2020 2078 5f76 616c 7565 732c 2079 5f76     x_values, y_v
-0004d2e0: 616c 7565 7320 3d20 285b 785f 6c61 7374  alues = ([x_last
-0004d2f0: 5d2c 205b 795f 6c61 7374 5d29 0a20 2020  ], [y_last]).   
-0004d300: 2066 6f72 2069 2069 6e20 7261 6e67 6528   for i in range(
-0004d310: 312c 206c 656e 2870 6f69 6e74 7329 293a  1, len(points)):
-0004d320: 0a20 2020 2020 2020 2078 2c20 7920 3d20  .        x, y = 
-0004d330: 706f 696e 7473 5b69 5d0a 2020 2020 2020  points[i].      
-0004d340: 2020 6966 2028 6162 7328 7820 2d20 785f    if (abs(x - x_
-0004d350: 6c61 7374 2920 3e20 6478 795f 6d69 6e29  last) > dxy_min)
-0004d360: 206f 7220 2861 6273 2879 202d 2079 5f6c   or (abs(y - y_l
-0004d370: 6173 7429 203e 2064 7879 5f6d 696e 293a  ast) > dxy_min):
-0004d380: 0a20 2020 2020 2020 2020 2020 2078 5f76  .            x_v
-0004d390: 616c 7565 732e 6170 7065 6e64 2870 6f69  alues.append(poi
-0004d3a0: 6e74 735b 695d 5b30 5d29 0a20 2020 2020  nts[i][0]).     
-0004d3b0: 2020 2020 2020 2079 5f76 616c 7565 732e         y_values.
-0004d3c0: 6170 7065 6e64 2870 6f69 6e74 735b 695d  append(points[i]
-0004d3d0: 5b31 5d29 0a20 2020 2020 2020 2078 5f6c  [1]).        x_l
-0004d3e0: 6173 742c 2079 5f6c 6173 7420 3d20 706f  ast, y_last = po
-0004d3f0: 696e 7473 5b69 5d0a 0a20 2020 2078 5f76  ints[i]..    x_v
-0004d400: 616c 7565 7320 3d20 6e70 2e61 7272 6179  alues = np.array
-0004d410: 2878 5f76 616c 7565 7329 0a20 2020 2079  (x_values).    y
-0004d420: 5f76 616c 7565 7320 3d20 6e70 2e61 7272  _values = np.arr
-0004d430: 6179 2879 5f76 616c 7565 7329 0a0a 2020  ay(y_values)..  
-0004d440: 2020 2320 496e 7465 7270 6f6c 6174 6520    # Interpolate 
-0004d450: 636f 6e74 6f75 7220 706f 696e 7473 2e0a  contour points..
-0004d460: 2020 2020 736d 6f6f 7468 6e65 7373 203d      smoothness =
-0004d470: 2073 6d6f 6f74 686e 6573 735f 7065 725f   smoothness_per_
-0004d480: 706f 696e 7420 2a20 6c65 6e28 785f 7661  point * len(x_va
-0004d490: 6c75 6573 290a 2020 2020 7472 793a 0a23  lues).    try:.#
-0004d4a0: 2020 2020 2020 2020 7769 7468 2077 6172          with war
-0004d4b0: 6e69 6e67 732e 6361 7463 685f 7761 726e  nings.catch_warn
-0004d4c0: 696e 6773 2829 3a0a 2320 2020 2020 2020  ings():.#       
-0004d4d0: 2020 2020 2077 6172 6e69 6e67 732e 6669       warnings.fi
-0004d4e0: 6c74 6572 7761 726e 696e 6773 2822 6967  lterwarnings("ig
-0004d4f0: 6e6f 7265 222c 206d 6573 7361 6765 3d22  nore", message="
-0004d500: 5365 7474 696e 6720 7822 290a 2020 2020  Setting x").    
-0004d510: 2020 2020 2020 2020 7463 6b2c 2075 203d          tck, u =
-0004d520: 2069 6e74 6572 706f 6c61 7465 2e73 706c   interpolate.spl
-0004d530: 7072 6570 280a 2020 2020 2020 2020 2020  prep(.          
-0004d540: 2020 2020 2020 2020 2020 5b78 5f76 616c            [x_val
-0004d550: 7565 732c 2079 5f76 616c 7565 735d 2c20  ues, y_values], 
-0004d560: 733d 736d 6f6f 7468 6e65 7373 2c20 7065  s=smoothness, pe
-0004d570: 723d 5472 7565 290a 2020 2020 6578 6365  r=True).    exce
-0004d580: 7074 2054 7970 6545 7272 6f72 2061 7320  pt TypeError as 
-0004d590: 7072 6f62 6c65 6d3a 0a20 2020 2020 2020  problem:.       
-0004d5a0: 2070 7269 6e74 2822 5741 524e 494e 473a   print("WARNING:
-0004d5b0: 2050 726f 626c 656d 2069 6e20 696e 7465   Problem in inte
-0004d5c0: 7270 6f6c 6174 655f 636f 6e74 6f75 725f  rpolate_contour_
-0004d5d0: 706f 696e 7473 2829 3a22 2c20 7072 6f62  points():", prob
-0004d5e0: 6c65 6d29 0a20 2020 2020 2020 2072 6574  lem).        ret
-0004d5f0: 7572 6e20 4e6f 6e65 0a0a 2020 2020 7869  urn None..    xi
-0004d600: 5f76 616c 7565 732c 2079 695f 7661 6c75  _values, yi_valu
-0004d610: 6573 203d 2069 6e74 6572 706f 6c61 7465  es = interpolate
-0004d620: 2e73 706c 6576 280a 2020 2020 2020 2020  .splev(.        
-0004d630: 6e70 2e6c 696e 7370 6163 6528 302e 2c20  np.linspace(0., 
-0004d640: 312e 2c20 6e5f 706f 696e 7420 2b20 3129  1., n_point + 1)
-0004d650: 2c20 7463 6b29 0a0a 2020 2020 2320 5374  , tck)..    # St
-0004d660: 6f72 6520 706f 696e 7473 2069 6e20 6120  ore points in a 
-0004d670: 666f 726d 2074 6861 7420 6d61 7920 6265  form that may be
-0004d680: 2063 6f6e 7665 7274 6564 2074 6f20 6120   converted to a 
-0004d690: 6e75 6d70 7920 6172 7261 792e 0a20 2020  numpy array..   
-0004d6a0: 2070 6f69 6e74 735f 696e 7465 7270 6f6c   points_interpol
-0004d6b0: 6174 6564 203d 206c 6973 7428 7a69 7028  ated = list(zip(
-0004d6c0: 7869 5f76 616c 7565 732c 2079 695f 7661  xi_values, yi_va
-0004d6d0: 6c75 6573 2929 0a20 2020 2070 6f69 6e74  lues)).    point
-0004d6e0: 735f 696e 7465 7270 6f6c 6174 6564 203d  s_interpolated =
-0004d6f0: 205b 7879 2066 6f72 2078 7920 696e 2070   [xy for xy in p
-0004d700: 6f69 6e74 735f 696e 7465 7270 6f6c 6174  oints_interpolat
-0004d710: 6564 5d0a 0a20 2020 2023 2052 6574 7572  ed]..    # Retur
-0004d720: 6e20 696e 7465 7270 6f6c 6174 6564 2063  n interpolated c
-0004d730: 6f6e 746f 7572 2069 6e20 7468 6520 7361  ontour in the sa
-0004d740: 6d65 2072 6570 7265 7365 6e74 6174 696f  me representatio
-0004d750: 6e20 6173 2074 6865 2073 6f75 7263 652e  n as the source.
-0004d760: 0a20 2020 2069 6620 6973 696e 7374 616e  .    if isinstan
-0004d770: 6365 2873 6f75 7263 652c 2067 656f 6d65  ce(source, geome
-0004d780: 7472 792e 706f 6c79 676f 6e2e 506f 6c79  try.polygon.Poly
-0004d790: 676f 6e29 3a0a 2020 2020 2020 2020 6f75  gon):.        ou
-0004d7a0: 745f 6f62 6a65 6374 203d 2067 656f 6d65  t_object = geome
-0004d7b0: 7472 792e 706f 6c79 676f 6e2e 506f 6c79  try.polygon.Poly
-0004d7c0: 676f 6e28 706f 696e 7473 5f69 6e74 6572  gon(points_inter
-0004d7d0: 706f 6c61 7465 6429 0a20 2020 2065 6c69  polated).    eli
-0004d7e0: 6620 6973 696e 7374 616e 6365 2873 6f75  f isinstance(sou
-0004d7f0: 7263 652c 206e 702e 6e64 6172 7261 7929  rce, np.ndarray)
-0004d800: 3a0a 2020 2020 2020 2020 6f75 745f 6f62  :.        out_ob
-0004d810: 6a65 6374 203d 206e 702e 6172 7261 7928  ject = np.array(
-0004d820: 706f 696e 7473 5f69 6e74 6572 706f 6c61  points_interpola
-0004d830: 7465 6429 0a20 2020 2065 6c73 653a 0a20  ted).    else:. 
-0004d840: 2020 2020 2020 206f 7574 5f6f 626a 6563         out_objec
-0004d850: 7420 3d20 706f 696e 7473 5f69 6e74 6572  t = points_inter
-0004d860: 706f 6c61 7465 640a 0a20 2020 2072 6574  polated..    ret
-0004d870: 7572 6e20 6f75 745f 6f62 6a65 6374 0a0a  urn out_object..
-0004d880: 6465 6620 7772 6974 655f 7374 7275 6374  def write_struct
-0004d890: 7572 655f 7365 745f 6469 636f 6d28 0a20  ure_set_dicom(. 
-0004d8a0: 2020 206f 7574 6e61 6d65 2c20 0a20 2020     outname, .   
-0004d8b0: 2072 6f69 732c 200a 2020 2020 696d 6167   rois, .    imag
-0004d8c0: 653d 4e6f 6e65 2c20 0a20 2020 2061 6666  e=None, .    aff
-0004d8d0: 696e 653d 4e6f 6e65 2c20 0a20 2020 2073  ine=None, .    s
-0004d8e0: 6861 7065 3d4e 6f6e 652c 0a20 2020 206f  hape=None,.    o
-0004d8f0: 7269 656e 7461 7469 6f6e 3d4e 6f6e 652c  rientation=None,
-0004d900: 200a 2020 2020 6865 6164 6572 5f73 6f75   .    header_sou
-0004d910: 7263 653d 4e6f 6e65 2c20 0a20 2020 2070  rce=None, .    p
-0004d920: 6174 6965 6e74 5f69 643d 4e6f 6e65 2c0a  atient_id=None,.
-0004d930: 2020 2020 6d6f 6461 6c69 7479 3d4e 6f6e      modality=Non
-0004d940: 652c 200a 2020 2020 726f 6f74 5f75 6964  e, .    root_uid
-0004d950: 3d4e 6f6e 650a 293a 0a0a 2020 2020 2320  =None.):..    # 
-0004d960: 4368 6563 6b20 7765 2068 6176 6520 7468  Check we have th
-0004d970: 6520 7265 6c65 7661 6e74 2069 6e66 6f0a  e relevant info.
-0004d980: 2020 2020 6966 206e 6f74 2069 6d61 6765      if not image
-0004d990: 2061 6e64 2028 6e6f 7420 6166 6669 6e65   and (not affine
-0004d9a0: 206f 7220 6e6f 7420 7368 6170 6529 3a0a   or not shape):.
-0004d9b0: 2020 2020 2020 2020 7261 6973 6520 5275          raise Ru
-0004d9c0: 6e74 696d 6545 7272 6f72 2822 4d75 7374  ntimeError("Must
-0004d9d0: 2070 726f 7669 6465 2065 6974 6865 7220   provide either 
-0004d9e0: 616e 2069 6d61 6765 206f 7220 616e 2061  an image or an a
-0004d9f0: 6666 696e 6520 6d61 7472 6978 2022 0a20  ffine matrix ". 
-0004da00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004da10: 2020 2020 2020 2020 2020 2261 6e64 2073            "and s
-0004da20: 6861 7065 2122 290a 0a20 2020 2023 2054  hape!")..    # T
-0004da30: 7279 2067 6574 7469 6e67 2064 6963 6f6d  ry getting dicom
-0004da40: 2064 6174 6173 6574 2066 726f 6d20 696d   dataset from im
-0004da50: 6167 650a 2020 2020 6473 203d 204e 6f6e  age.    ds = Non
-0004da60: 650a 2020 2020 6966 2069 6d61 6765 3a0a  e.    if image:.
-0004da70: 2020 2020 2020 2020 6966 2068 6173 6174          if hasat
-0004da80: 7472 2869 6d61 6765 2c20 2264 6963 6f6d  tr(image, "dicom
-0004da90: 5f64 6174 6173 6574 2229 3a0a 2020 2020  _dataset"):.    
-0004daa0: 2020 2020 2020 2020 6473 203d 2069 6d61          ds = ima
-0004dab0: 6765 2e64 6963 6f6d 5f64 6174 6173 6574  ge.dicom_dataset
-0004dac0: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
-0004dad0: 2020 2020 2020 2020 2020 2064 7320 3d20             ds = 
-0004dae0: 736b 7274 2e69 6d61 6765 2e63 7265 6174  skrt.image.creat
-0004daf0: 655f 6469 636f 6d28 290a 2020 2020 2020  e_dicom().      
-0004db00: 2020 2020 2020 6473 2e73 6574 5f67 656f        ds.set_geo
-0004db10: 6d65 7472 7928 0a20 2020 2020 2020 2020  metry(.         
-0004db20: 2020 2020 2020 2069 6d61 6765 2e67 6574         image.get
-0004db30: 5f61 6666 696e 6528 292c 2069 6d61 6765  _affine(), image
-0004db40: 2e67 6574 5f64 6174 6128 292e 7368 6170  .get_data().shap
-0004db50: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
-0004db60: 2020 2069 6d61 6765 2e67 6574 5f6f 7269     image.get_ori
-0004db70: 656e 7461 7469 6f6e 5f76 6563 746f 7228  entation_vector(
-0004db80: 696d 6167 652e 6765 745f 6166 6669 6e65  image.get_affine
-0004db90: 2c20 2264 6963 6f6d 2229 0a20 2020 2020  , "dicom").     
-0004dba0: 2020 2020 2020 2029 0a0a 2020 2020 2320         )..    # 
-0004dbb0: 4f74 6865 7277 6973 652c 2063 7265 6174  Otherwise, creat
-0004dbc0: 6520 6672 6573 6820 6469 636f 6d20 6461  e fresh dicom da
-0004dbd0: 7461 7365 740a 2020 2020 656c 7365 3a0a  taset.    else:.
-0004dbe0: 2020 2020 2020 2020 6473 203d 2073 6b72          ds = skr
-0004dbf0: 742e 696d 6167 652e 6372 6561 7465 5f64  t.image.create_d
-0004dc00: 6963 6f6d 2870 6174 6965 6e74 5f69 642c  icom(patient_id,
-0004dc10: 206d 6f64 616c 6974 792c 2072 6f6f 745f   modality, root_
-0004dc20: 7569 6429 0a20 2020 2020 2020 2064 732e  uid).        ds.
-0004dc30: 7365 745f 6765 6f6d 6574 7279 2861 6666  set_geometry(aff
-0004dc40: 696e 652c 2073 6861 7065 2c20 6f72 6965  ine, shape, orie
-0004dc50: 6e74 6174 696f 6e29 0a0a 2020 2020 2320  ntation)..    # 
-0004dc60: 4164 6a75 7374 2064 6174 6173 6574 2074  Adjust dataset t
-0004dc70: 6f20 6265 2066 6f72 2053 7472 7563 7475  o be for Structu
-0004dc80: 7265 5365 7420 696e 7374 6561 6420 6f66  reSet instead of
-0004dc90: 2069 6d61 6765 0a0a 0a64 6566 2064 6963   image...def dic
-0004dca0: 6f6d 5f64 6174 6173 6574 5f74 6f5f 7374  om_dataset_to_st
-0004dcb0: 7275 6374 7572 655f 7365 7428 6473 293a  ructure_set(ds):
-0004dcc0: 0a20 2020 2027 2727 436f 6e76 6572 7420  .    '''Convert 
-0004dcd0: 616e 2065 7869 7374 696e 6720 696d 6167  an existing imag
-0004dce0: 6520 6469 636f 6d20 6461 7461 7365 7420  e dicom dataset 
-0004dcf0: 746f 2061 2053 7472 7563 7475 7265 5365  to a StructureSe
-0004dd00: 7420 6461 7461 7365 742e 2727 270a 0a20  t dataset.'''.. 
-0004dd10: 2020 2023 2041 646a 7573 7420 636c 6173     # Adjust clas
-0004dd20: 7320 5549 4473 0a20 2020 2064 732e 6669  s UIDs.    ds.fi
-0004dd30: 6c65 5f6d 6574 612e 496d 706c 656d 656e  le_meta.Implemen
-0004dd40: 7461 7469 6f6e 436c 6173 7355 4944 203d  tationClassUID =
-0004dd50: 2022 392e 392e 392e 3130 302e 302e 302e   "9.9.9.100.0.0.
-0004dd60: 312e 302e 392e 362e 302e 302e 3122 0a20  1.0.9.6.0.0.1". 
-0004dd70: 2020 2064 732e 6669 6c65 5f6d 6574 612e     ds.file_meta.
-0004dd80: 4d65 6469 6153 746f 7261 6765 534f 5043  MediaStorageSOPC
-0004dd90: 6c61 7373 5549 4420 3d20 2231 2e32 2e38  lassUID = "1.2.8
-0004dda0: 3430 2e31 3030 3038 2e35 2e31 2e34 2e31  40.10008.5.1.4.1
-0004ddb0: 2e31 2e34 3831 2e33 220a 0a20 2020 2023  .1.481.3"..    #
-0004ddc0: 2041 7373 6967 6e20 656d 7074 7920 7365   Assign empty se
-0004ddd0: 7175 656e 6365 730a 2020 2020 6473 2e52  quences.    ds.R
-0004dde0: 6566 6572 656e 6365 6446 7261 6d65 6f66  eferencedFrameof
-0004ddf0: 5265 6665 7265 6e63 6553 6571 7565 6e63  ReferenceSequenc
-0004de00: 6520 3d20 5365 7175 656e 6365 2829 0a20  e = Sequence(). 
-0004de10: 2020 2064 732e 5374 7275 6374 7572 6553     ds.StructureS
-0004de20: 6574 524f 4953 6571 7565 6e63 6520 3d20  etROISequence = 
-0004de30: 5365 7175 656e 6365 2829 0a20 2020 2064  Sequence().    d
-0004de40: 732e 5254 524f 494f 6273 6572 7661 7469  s.RTROIObservati
-0004de50: 6f6e 7353 6571 7565 6e63 6520 3d20 5365  onsSequence = Se
-0004de60: 7175 656e 6365 2829 0a20 2020 2064 732e  quence().    ds.
-0004de70: 524f 4943 6f6e 746f 7572 5365 7175 656e  ROIContourSequen
-0004de80: 6365 203d 2053 6571 7565 6e63 6528 290a  ce = Sequence().
-0004de90: 0a20 2020 2023 2041 7373 6967 6e20 7374  .    # Assign st
-0004dea0: 7275 6374 7572 6520 7365 7420 7072 6f70  ructure set prop
-0004deb0: 6572 7469 6573 0a20 2020 2064 732e 5374  erties.    ds.St
-0004dec0: 7275 6374 7572 6553 6574 4c61 6265 6c20  ructureSetLabel 
-0004ded0: 3d20 2222 0a20 2020 2064 732e 5374 7275  = "".    ds.Stru
-0004dee0: 6374 7572 6553 6574 4461 7465 203d 2064  ctureSetDate = d
-0004def0: 732e 496e 7374 616e 6365 4372 6561 7469  s.InstanceCreati
-0004df00: 6f6e 4461 7465 0a20 2020 2064 732e 5374  onDate.    ds.St
-0004df10: 7275 6374 7572 6553 6574 5469 6d65 203d  ructureSetTime =
-0004df20: 2064 732e 496e 7374 616e 6365 4372 6561   ds.InstanceCrea
-0004df30: 7469 6f6e 5469 6d65 0a0a 2020 2020 2320  tionTime..    # 
-0004df40: 4173 7369 676e 2066 7261 6d65 206f 6620  Assign frame of 
-0004df50: 7265 6665 7265 6e63 650a 0a0a 6465 6620  reference...def 
-0004df60: 6372 6561 7465 5f64 756d 6d79 5f69 6d61  create_dummy_ima
-0004df70: 6765 280a 2020 2020 6578 7465 6e74 732c  ge(.    extents,
-0004df80: 200a 2020 2020 736c 6963 655f 7468 6963   .    slice_thic
-0004df90: 6b6e 6573 732c 0a20 2020 2073 6861 7065  kness,.    shape
-0004dfa0: 3d4e 6f6e 652c 200a 2020 2020 766f 7865  =None, .    voxe
-0004dfb0: 6c5f 7369 7a65 3d4e 6f6e 652c 0a20 2020  l_size=None,.   
-0004dfc0: 2066 696c 6c5f 7661 6c3d 3165 342c 0a20   fill_val=1e4,. 
-0004dfd0: 2020 2062 7566 6665 723d 320a 293a 0a20     buffer=2.):. 
-0004dfe0: 2020 2022 2222 4d61 6b65 2061 2064 756d     """Make a dum
-0004dff0: 6d79 2069 6d61 6765 2074 6861 7420 636f  my image that co
-0004e000: 7665 7273 2074 6865 2061 7265 6120 7370  vers the area sp
-0004e010: 616e 6e65 6420 6279 203c 6578 7465 6e74  anned by <extent
-0004e020: 733e 2070 6c75 7320 6120 0a20 2020 2062  s> plus a .    b
-0004e030: 7566 6665 722e 0a0a 2020 2020 2a2a 5061  uffer...    **Pa
-0004e040: 7261 6d65 7465 7273 3a2a 2a0a 2020 2020  rameters:**.    
-0004e050: 0a20 2020 2065 7874 656e 7473 203a 206c  .    extents : l
-0004e060: 6973 740a 2020 2020 2020 2020 4c69 7374  ist.        List
-0004e070: 206f 6620 5b6d 696e 2c20 6d61 785d 2065   of [min, max] e
-0004e080: 7874 656e 7473 2069 6e20 6d6d 2061 6c6f  xtents in mm alo
-0004e090: 6e67 2065 6163 6820 6f66 2074 6865 2074  ng each of the t
-0004e0a0: 6872 6565 2061 7865 7320 696e 200a 2020  hree axes in .  
-0004e0b0: 2020 2020 2020 6f72 6465 7220 5b78 2c20        order [x, 
-0004e0c0: 792c 207a 5d2e 0a0a 2020 2020 736c 6963  y, z]...    slic
-0004e0d0: 655f 7468 6963 6b6e 6573 7320 3a20 666c  e_thickness : fl
-0004e0e0: 6f61 740a 2020 2020 2020 2020 536c 6963  oat.        Slic
-0004e0f0: 6520 7468 6963 6b6e 6573 7320 696e 206d  e thickness in m
-0004e100: 6d2e 0a0a 2020 2020 766f 7865 6c5f 7369  m...    voxel_si
-0004e110: 7a65 203a 206c 6973 742c 2064 6566 6175  ze : list, defau
-0004e120: 6c74 3d4e 6f6e 650a 2020 2020 2020 2020  lt=None.        
-0004e130: 566f 7865 6c20 7369 7a65 2069 6e20 6d6d  Voxel size in mm
-0004e140: 2069 6e20 7468 6520 6475 6d6d 7920 696d   in the dummy im
-0004e150: 6167 6520 696e 2074 6865 2078 2d79 2070  age in the x-y p
-0004e160: 6c61 6e65 2c20 6769 7665 6e20 6173 200a  lane, given as .
-0004e170: 2020 2020 2020 2020 5b76 782c 2076 795d          [vx, vy]
-0004e180: 2e20 4966 203c 7368 6170 653e 2061 6e64  . If <shape> and
-0004e190: 203c 766f 7865 6c5f 7369 7a65 3e20 6172   <voxel_size> ar
-0004e1a0: 6520 626f 7468 204e 6f6e 652c 2076 6f78  e both None, vox
-0004e1b0: 656c 2073 697a 6573 206f 660a 2020 2020  el sizes of.    
-0004e1c0: 2020 2020 5b31 2c20 315d 2077 696c 6c20      [1, 1] will 
-0004e1d0: 6265 2075 7365 6420 6279 2064 6566 6175  be used by defau
-0004e1e0: 6c74 2e20 5468 6520 766f 7865 6c20 7369  lt. The voxel si
-0004e1f0: 7a65 2069 6e20 7468 6520 7a20 6469 7265  ze in the z dire
-0004e200: 6374 696f 6e20 0a20 2020 2020 2020 2077  ction .        w
-0004e210: 696c 6c20 6265 2074 616b 656e 2066 726f  ill be taken fro
-0004e220: 6d20 7468 6520 6d69 6e69 6d75 6d20 6469  m the minimum di
-0004e230: 7374 616e 6365 2062 6574 7765 656e 2073  stance between s
-0004e240: 6c69 6365 2070 6f73 6974 696f 6e73 2069  lice positions i
-0004e250: 6e20 0a20 2020 2020 2020 2074 6865 2078  n .        the x
-0004e260: 2d79 2063 6f6e 746f 7572 7320 6469 6374  -y contours dict
-0004e270: 696f 6e61 7279 2e0a 0a20 2020 2073 6861  ionary...    sha
-0004e280: 7065 203a 206c 6973 742c 2064 6566 6175  pe : list, defau
-0004e290: 6c74 3d4e 6f6e 650a 2020 2020 2020 2020  lt=None.        
-0004e2a0: 4e75 6d62 6572 206f 6620 766f 7865 6c73  Number of voxels
-0004e2b0: 2069 6e20 7468 6520 6475 6d6d 7920 696d   in the dummy im
-0004e2c0: 6167 6520 696e 2074 6865 2078 2d79 2070  age in the x-y p
-0004e2d0: 6c61 6e65 2c20 6769 7665 6e20 6173 0a20  lane, given as. 
-0004e2e0: 2020 2020 2020 205b 6e78 2c20 6e79 5d2e         [nx, ny].
-0004e2f0: 204f 6e6c 7920 7573 6564 2069 6620 3c76   Only used if <v
-0004e300: 6f78 656c 5f73 697a 653e 2069 7320 4e6f  oxel_size> is No
-0004e310: 6e65 2e20 0a20 2020 2020 2020 2054 6865  ne. .        The
-0004e320: 206e 756d 6265 7220 6f66 2076 6f78 656c   number of voxel
-0004e330: 7320 696e 2074 6865 207a 2064 6972 6563  s in the z direc
-0004e340: 7469 6f6e 2077 696c 6c20 6265 2074 616b  tion will be tak
-0004e350: 656e 2066 726f 6d20 7468 6520 0a20 2020  en from the .   
-0004e360: 2020 2020 206e 756d 6265 7220 6f66 2073       number of s
-0004e370: 6c69 6365 7320 696e 2074 6865 2078 2d79  lices in the x-y
-0004e380: 2063 6f6e 746f 7572 7320 6469 6374 696f   contours dictio
-0004e390: 6e61 7279 2e0a 0a20 2020 2066 696c 6c5f  nary...    fill_
-0004e3a0: 7661 6c20 3a20 696e 742f 666c 6f61 742c  val : int/float,
-0004e3b0: 2064 6566 6175 6c74 3d31 6534 0a20 2020   default=1e4.   
-0004e3c0: 2020 2020 2056 616c 7565 2077 6974 6820       Value with 
-0004e3d0: 7768 6963 6820 7468 6520 766f 7865 6c73  which the voxels
-0004e3e0: 2069 6e20 7468 6520 6475 6d6d 7920 696d   in the dummy im
-0004e3f0: 6167 6520 7368 6f75 6c64 2062 6520 6669  age should be fi
-0004e400: 6c6c 6564 2e20 0a0a 2020 2020 6275 6666  lled. ..    buff
-0004e410: 6572 203a 2066 6c6f 6174 2c20 6465 6661  er : float, defa
-0004e420: 756c 743d 320a 2020 2020 2020 2020 4275  ult=2.        Bu
-0004e430: 6666 6572 2061 6d6f 756e 7420 6f66 2077  ffer amount of w
-0004e440: 6869 7465 7370 6163 6520 696e 206d 6d20  hitespace in mm 
-0004e450: 746f 2061 6464 206f 7574 7369 6465 2074  to add outside t
-0004e460: 6865 2052 4f49 2069 6e20 6561 6368 200a  he ROI in each .
-0004e470: 2020 2020 2020 2020 6469 7265 6374 696f          directio
-0004e480: 6e2e 0a20 2020 2022 2222 0a0a 2020 2020  n..    """..    
-0004e490: 2320 4173 7369 676e 2064 6566 6175 6c74  # Assign default
-0004e4a0: 2076 6f78 656c 2073 697a 650a 2020 2020   voxel size.    
-0004e4b0: 6966 2073 6861 7065 2069 7320 4e6f 6e65  if shape is None
-0004e4c0: 2061 6e64 2076 6f78 656c 5f73 697a 6520   and voxel_size 
-0004e4d0: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
-0004e4e0: 2076 6f78 656c 5f73 697a 6520 3d20 5b31   voxel_size = [1
-0004e4f0: 2c20 315d 0a20 2020 2069 6620 6e6f 7420  , 1].    if not 
-0004e500: 736b 7274 2e63 6f72 652e 6973 5f6c 6973  skrt.core.is_lis
-0004e510: 7428 766f 7865 6c5f 7369 7a65 293a 0a20  t(voxel_size):. 
-0004e520: 2020 2020 2020 2076 6f78 656c 5f73 697a         voxel_siz
-0004e530: 6520 3d20 5b76 6f78 656c 5f73 697a 655d  e = [voxel_size]
-0004e540: 202a 2032 0a0a 2020 2020 2320 4361 6c63   * 2..    # Calc
-0004e550: 756c 6174 6520 766f 7865 6c20 7369 7a65  ulate voxel size
-0004e560: 7320 6672 6f6d 2073 6861 7065 0a20 2020  s from shape.   
-0004e570: 2069 6620 7368 6170 6520 6973 206e 6f74   if shape is not
-0004e580: 204e 6f6e 653a 0a20 2020 2020 2020 2073   None:.        s
-0004e590: 6861 7065 203d 206c 6973 7428 7368 6170  hape = list(shap
-0004e5a0: 6529 0a20 2020 2020 2020 2069 6620 6c65  e).        if le
-0004e5b0: 6e28 7368 6170 6529 2021 3d20 323a 0a20  n(shape) != 2:. 
-0004e5c0: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-0004e5d0: 2054 7970 6545 7272 6f72 2822 5368 6170   TypeError("Shap
-0004e5e0: 6520 7368 6f75 6c64 2062 6520 6120 6c69  e should be a li
-0004e5f0: 7374 206f 6620 7477 6f20 7661 6c75 6573  st of two values
-0004e600: 2022 0a20 2020 2020 2020 2020 2020 2020   ".             
-0004e610: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-0004e620: 7370 6563 6966 7969 6e67 2064 756d 6d79  specifying dummy
-0004e630: 2069 6d61 6765 2073 6861 7065 2069 6e20   image shape in 
-0004e640: 7468 6520 5b78 2c20 795d 2022 0a20 2020  the [x, y] ".   
-0004e650: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004e660: 2020 2020 2020 2020 2022 6469 7265 6374           "direct
-0004e670: 696f 6e73 2e22 290a 0a20 2020 2020 2020  ions.")..       
-0004e680: 2023 2043 616c 6375 6c61 7465 2076 6f78   # Calculate vox
-0004e690: 656c 2073 697a 6520 6966 2052 4f49 2065  el size if ROI e
-0004e6a0: 7874 656e 7420 706c 7573 2062 7566 6665  xtent plus buffe
-0004e6b0: 7220 6973 2064 6976 6964 6564 2062 7920  r is divided by 
-0004e6c0: 7368 6170 650a 2020 2020 2020 2020 766f  shape.        vo
-0004e6d0: 7865 6c5f 7369 7a65 203d 205b 286d 6178  xel_size = [(max
-0004e6e0: 2865 7829 202d 206d 696e 2865 7829 202b  (ex) - min(ex) +
-0004e6f0: 2032 202a 2062 7566 6665 7229 202f 2073   2 * buffer) / s
-0004e700: 6861 7065 5b69 5d0a 2020 2020 2020 2020  hape[i].        
-0004e710: 2020 2020 2020 2020 2020 2020 2020 666f                fo
-0004e720: 7220 692c 2065 7820 696e 2065 6e75 6d65  r i, ex in enume
-0004e730: 7261 7465 2865 7874 656e 7473 5b3a 325d  rate(extents[:2]
-0004e740: 295d 0a0a 2020 2020 2320 4f74 6865 7277  )]..    # Otherw
-0004e750: 6973 652c 2063 616c 6375 6c61 7465 2073  ise, calculate s
-0004e760: 6861 7065 2066 726f 6d20 766f 7865 6c20  hape from voxel 
-0004e770: 7369 7a65 730a 2020 2020 656c 7365 3a0a  sizes.    else:.
-0004e780: 2020 2020 2020 2020 766f 7865 6c5f 7369          voxel_si
-0004e790: 7a65 203d 206c 6973 7428 766f 7865 6c5f  ze = list(voxel_
-0004e7a0: 7369 7a65 290a 2020 2020 2020 2020 0a20  size).        . 
-0004e7b0: 2020 2020 2020 2023 2043 616c 6375 6c61         # Calcula
-0004e7c0: 7465 206e 756d 6265 7220 6f66 2076 6f78  te number of vox
-0004e7d0: 656c 7320 6e65 6564 6564 2074 6f20 636f  els needed to co
-0004e7e0: 7665 7220 524f 4920 706c 7573 2062 7566  ver ROI plus buf
-0004e7f0: 6665 7220 6561 6368 2073 6964 650a 2020  fer each side.  
-0004e800: 2020 2020 2020 7368 6170 6520 3d20 5b28        shape = [(
-0004e810: 6e70 2e63 6569 6c28 286d 6178 2865 7829  np.ceil((max(ex)
-0004e820: 202d 206d 696e 2865 7829 2920 2b20 3220   - min(ex)) + 2 
-0004e830: 2a20 6275 6666 6572 2920 2f20 766f 7865  * buffer) / voxe
-0004e840: 6c5f 7369 7a65 5b69 5d29 200a 2020 2020  l_size[i]) .    
-0004e850: 2020 2020 2020 2020 2020 2020 2066 6f72               for
-0004e860: 2069 2c20 6578 2069 6e20 656e 756d 6572   i, ex in enumer
-0004e870: 6174 6528 6578 7465 6e74 735b 3a32 5d29  ate(extents[:2])
-0004e880: 5d0a 0a20 2020 2023 2047 6574 207a 2076  ]..    # Get z v
-0004e890: 6f78 656c 2073 697a 6520 616e 6420 7368  oxel size and sh
-0004e8a0: 6170 650a 2020 2020 766f 7865 6c5f 7369  ape.    voxel_si
-0004e8b0: 7a65 2e61 7070 656e 6428 736c 6963 655f  ze.append(slice_
-0004e8c0: 7468 6963 6b6e 6573 7329 0a20 2020 2073  thickness).    s
-0004e8d0: 6861 7065 5f7a 203d 2028 6d61 7828 6578  hape_z = (max(ex
-0004e8e0: 7465 6e74 735b 325d 2920 2d20 6d69 6e28  tents[2]) - min(
-0004e8f0: 6578 7465 6e74 735b 325d 2929 202f 2073  extents[2])) / s
-0004e900: 6c69 6365 5f74 6869 636b 6e65 7373 0a0a  lice_thickness..
-0004e910: 2020 2020 2320 4164 6420 6e65 6172 6573      # Add neares
-0004e920: 7420 696e 7465 6765 7220 6e75 6d62 6572  t integer number
-0004e930: 206f 6620 6275 6666 6572 2076 6f78 656c   of buffer voxel
-0004e940: 730a 2020 2020 6e5f 6275 6666 5f7a 203d  s.    n_buff_z =
-0004e950: 206e 702e 6365 696c 2862 7566 6665 7220   np.ceil(buffer 
-0004e960: 2f20 736c 6963 655f 7468 6963 6b6e 6573  / slice_thicknes
-0004e970: 7329 0a20 2020 2073 6861 7065 2e61 7070  s).    shape.app
-0004e980: 656e 6428 7368 6170 655f 7a20 2b20 3220  end(shape_z + 2 
-0004e990: 2a20 6e5f 6275 6666 5f7a 290a 2020 2020  * n_buff_z).    
-0004e9a0: 7368 6170 6520 3d20 5b69 6e74 2873 2920  shape = [int(s) 
-0004e9b0: 666f 7220 7320 696e 2073 6861 7065 5d0a  for s in shape].
-0004e9c0: 0a20 2020 2023 2047 6574 206f 7269 6769  .    # Get origi
-0004e9d0: 6e20 706f 7369 7469 6f6e 3b20 656e 7375  n position; ensu
-0004e9e0: 7265 2074 6861 7420 6f72 6967 696e 2070  re that origin p
-0004e9f0: 6f69 6e74 7320 746f 2063 656e 7472 6520  oints to centre 
-0004ea00: 6f66 2062 7566 6665 7220 766f 7865 6c20  of buffer voxel 
-0004ea10: 0a20 2020 2023 206f 7574 7369 6465 2052  .    # outside R
-0004ea20: 4f49 0a20 2020 206f 7269 6769 6e20 3d20  OI.    origin = 
-0004ea30: 5b6d 696e 2865 7829 202b 2061 6273 2876  [min(ex) + abs(v
-0004ea40: 6f78 656c 5f73 697a 655b 695d 2920 2a20  oxel_size[i]) * 
-0004ea50: 302e 3520 2d20 6275 6666 6572 0a20 2020  0.5 - buffer.   
-0004ea60: 2020 2020 2020 2020 2020 2066 6f72 2069             for i
-0004ea70: 2c20 6578 2069 6e20 656e 756d 6572 6174  , ex in enumerat
-0004ea80: 6528 6578 7465 6e74 735b 3a32 5d29 5d0a  e(extents[:2])].
-0004ea90: 2020 2020 6f72 6967 696e 2e61 7070 656e      origin.appen
-0004eaa0: 6428 6d69 6e28 6578 7465 6e74 735b 325d  d(min(extents[2]
-0004eab0: 2920 2d20 6162 7328 736c 6963 655f 7468  ) - abs(slice_th
-0004eac0: 6963 6b6e 6573 7329 202a 2028 6e5f 6275  ickness) * (n_bu
-0004ead0: 6666 5f7a 202d 2030 2e35 2929 0a0a 2020  ff_z - 0.5))..  
-0004eae0: 2020 2320 4372 6561 7465 2069 6d61 6765    # Create image
-0004eaf0: 0a20 2020 2072 6574 7572 6e20 736b 7274  .    return skrt
-0004eb00: 2e69 6d61 6765 2e49 6d61 6765 280a 2020  .image.Image(.  
-0004eb10: 2020 2020 2020 6e70 2e6f 6e65 7328 2873        np.ones((s
-0004eb20: 6861 7065 5b31 5d2c 2073 6861 7065 5b30  hape[1], shape[0
-0004eb30: 5d2c 2073 6861 7065 5b32 5d29 2920 2a20  ], shape[2])) * 
-0004eb40: 6669 6c6c 5f76 616c 2c0a 2020 2020 2020  fill_val,.      
-0004eb50: 2020 766f 7865 6c5f 7369 7a65 3d76 6f78    voxel_size=vox
-0004eb60: 656c 5f73 697a 652c 0a20 2020 2020 2020  el_size,.       
-0004eb70: 206f 7269 6769 6e3d 6f72 6967 696e 0a20   origin=origin. 
-0004eb80: 2020 2029 0a0a 0a64 6566 2063 7265 6174     )...def creat
-0004eb90: 655f 7374 6170 6c65 2872 6f69 732c 202a  e_staple(rois, *
-0004eba0: 2a6b 7761 7267 7329 3a0a 2020 2020 2222  *kwargs):.    ""
-0004ebb0: 2243 7265 6174 6520 5354 4150 4c45 2052  "Create STAPLE R
-0004ebc0: 4f49 2066 726f 6d20 6c69 7374 206f 6620  OI from list of 
-0004ebd0: 524f 4973 2e22 2222 0a0a 2020 2020 2320  ROIs."""..    # 
-0004ebe0: 5472 7920 696d 706f 7274 2053 696d 706c  Try import Simpl
-0004ebf0: 6549 544b 0a20 2020 2074 7279 3a0a 2020  eITK.    try:.  
-0004ec00: 2020 2020 2020 696d 706f 7274 2053 696d        import Sim
-0004ec10: 706c 6549 544b 2061 7320 7369 746b 0a20  pleITK as sitk. 
-0004ec20: 2020 2065 7863 6570 7420 4d6f 6475 6c65     except Module
-0004ec30: 4e6f 7446 6f75 6e64 4572 726f 723a 0a20  NotFoundError:. 
-0004ec40: 2020 2020 2020 2072 6169 7365 204d 6f64         raise Mod
-0004ec50: 756c 654e 6f74 466f 756e 6445 7272 6f72  uleNotFoundError
-0004ec60: 2822 5369 6d70 6c65 4954 4b20 6973 2072  ("SimpleITK is r
-0004ec70: 6571 7569 7265 6420 746f 2063 616c 6375  equired to calcu
-0004ec80: 6c61 7465 2053 5441 504c 4520 636f 6e74  late STAPLE cont
-0004ec90: 6f75 722e 2022 0a20 2020 2020 2020 2020  our. ".         
-0004eca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004ecb0: 2020 2020 2020 2020 2022 5472 7920 696e           "Try in
-0004ecc0: 7374 616c 6c69 6e67 2076 6961 3a20 7069  stalling via: pi
-0004ecd0: 7020 696e 7374 616c 6c20 7369 6d70 6c65  p install simple
-0004ece0: 6974 6b22 290a 0a20 2020 2023 2047 6574  itk")..    # Get
-0004ecf0: 2053 5441 504c 4520 6d61 736b 0a20 2020   STAPLE mask.   
-0004ed00: 2072 6f69 5f61 7272 6179 7320 3d20 5b5d   roi_arrays = []
-0004ed10: 0a20 2020 2066 6f72 2072 6f69 2069 6e20  .    for roi in 
-0004ed20: 726f 6973 3a0a 2020 2020 2020 2020 726f  rois:.        ro
-0004ed30: 695f 6172 7261 7973 2e61 7070 656e 6428  i_arrays.append(
-0004ed40: 7369 746b 2e47 6574 496d 6167 6546 726f  sitk.GetImageFro
-0004ed50: 6d41 7272 6179 2872 6f69 2e67 6574 5f6d  mArray(roi.get_m
-0004ed60: 6173 6b28 0a20 2020 2020 2020 2020 2020  ask(.           
-0004ed70: 2073 7461 6e64 6172 6469 7365 3d54 7275   standardise=Tru
-0004ed80: 6529 2e61 7374 7970 6528 696e 7429 2929  e).astype(int)))
-0004ed90: 0a20 2020 2070 726f 6273 203d 2073 6974  .    probs = sit
-0004eda0: 6b2e 4765 7441 7272 6179 4672 6f6d 496d  k.GetArrayFromIm
-0004edb0: 6167 6528 7369 746b 2e53 5441 504c 4528  age(sitk.STAPLE(
-0004edc0: 726f 695f 6172 7261 7973 2c20 3129 290a  roi_arrays, 1)).
-0004edd0: 2020 2020 6d61 736b 203d 2070 726f 6273      mask = probs
-0004ede0: 203e 2030 2e39 350a 0a20 2020 2023 2043   > 0.95..    # C
-0004edf0: 7265 6174 6520 5354 4150 4c45 2052 4f49  reate STAPLE ROI
-0004ee00: 206f 626a 6563 740a 2020 2020 7265 7475   object.    retu
-0004ee10: 726e 2052 4f49 286d 6173 6b2c 202a 2a6b  rn ROI(mask, **k
-0004ee20: 7761 7267 7329 0a0a 0a64 6566 2063 7265  wargs)...def cre
-0004ee30: 6174 655f 6d61 6a6f 7269 7479 5f76 6f74  ate_majority_vot
-0004ee40: 6528 726f 6973 2c20 2a2a 6b77 6172 6773  e(rois, **kwargs
-0004ee50: 293a 0a20 2020 2022 2222 4372 6561 7465  ):.    """Create
-0004ee60: 206d 616a 6f72 6974 7920 766f 7465 2052   majority vote R
-0004ee70: 4f49 2066 726f 6d20 6c69 7374 206f 6620  OI from list of 
-0004ee80: 524f 4973 2e22 2222 0a0a 2020 2020 6d61  ROIs."""..    ma
-0004ee90: 736b 203d 2072 6f69 735b 305d 2e67 6574  sk = rois[0].get
-0004eea0: 5f6d 6173 6b28 7374 616e 6461 7264 6973  _mask(standardis
-0004eeb0: 653d 5472 7565 292e 6173 7479 7065 2869  e=True).astype(i
-0004eec0: 6e74 290a 2020 2020 666f 7220 726f 6920  nt).    for roi 
-0004eed0: 696e 2072 6f69 735b 313a 5d3a 0a20 2020  in rois[1:]:.   
-0004eee0: 2020 2020 206d 6173 6b20 2b3d 2072 6f69       mask += roi
-0004eef0: 2e67 6574 5f6d 6173 6b28 7374 616e 6461  .get_mask(standa
-0004ef00: 7264 6973 653d 5472 7565 292e 6173 7479  rdise=True).asty
-0004ef10: 7065 2869 6e74 290a 2020 2020 6d61 736b  pe(int).    mask
-0004ef20: 203d 206d 6173 6b20 3e3d 206c 656e 2872   = mask >= len(r
-0004ef30: 6f69 7329 202f 2032 0a20 2020 2072 6574  ois) / 2.    ret
-0004ef40: 7572 6e20 524f 4928 6d61 736b 2c20 2a2a  urn ROI(mask, **
-0004ef50: 6b77 6172 6773 290a 0a0a 6465 6620 6372  kwargs)...def cr
-0004ef60: 6561 7465 5f72 6f69 5f73 756d 2872 6f69  eate_roi_sum(roi
-0004ef70: 732c 202a 2a6b 7761 7267 7329 3a0a 2020  s, **kwargs):.  
-0004ef80: 2020 2222 2243 7265 6174 6520 524f 4920    """Create ROI 
-0004ef90: 6672 6f6d 2073 756d 206f 6620 6c69 7374  from sum of list
-0004efa0: 206f 6620 524f 4973 2e22 2222 0a0a 2020   of ROIs."""..  
-0004efb0: 2020 6d61 736b 203d 2072 6f69 735b 305d    mask = rois[0]
-0004efc0: 2e67 6574 5f6d 6173 6b28 7374 616e 6461  .get_mask(standa
-0004efd0: 7264 6973 653d 5472 7565 292e 636f 7079  rdise=True).copy
-0004efe0: 2829 0a20 2020 2066 6f72 2072 6f69 2069  ().    for roi i
-0004eff0: 6e20 726f 6973 5b31 3a5d 3a0a 2020 2020  n rois[1:]:.    
-0004f000: 2020 2020 6d61 736b 202b 3d20 726f 692e      mask += roi.
-0004f010: 6765 745f 6d61 736b 2873 7461 6e64 6172  get_mask(standar
-0004f020: 6469 7365 3d54 7275 6529 0a20 2020 2072  dise=True).    r
-0004f030: 6574 7572 6e20 524f 4928 6d61 736b 2c20  eturn ROI(mask, 
-0004f040: 2a2a 6b77 6172 6773 290a 0a0a 6465 6620  **kwargs)...def 
-0004f050: 6372 6561 7465 5f72 6f69 5f6f 7665 726c  create_roi_overl
-0004f060: 6170 2872 6f69 732c 202a 2a6b 7761 7267  ap(rois, **kwarg
-0004f070: 7329 3a0a 2020 2020 2222 2243 7265 6174  s):.    """Creat
-0004f080: 6520 524f 4920 6672 6f6d 206f 7665 726c  e ROI from overl
-0004f090: 6170 206f 6620 6c69 7374 206f 6620 524f  ap of list of RO
-0004f0a0: 4973 2e22 2222 0a0a 2020 2020 6d61 736b  Is."""..    mask
-0004f0b0: 203d 2072 6f69 735b 305d 2e67 6574 5f6d   = rois[0].get_m
-0004f0c0: 6173 6b28 7374 616e 6461 7264 6973 653d  ask(standardise=
-0004f0d0: 5472 7565 292e 636f 7079 2829 0a20 2020  True).copy().   
-0004f0e0: 2066 6f72 2072 6f69 2069 6e20 726f 6973   for roi in rois
-0004f0f0: 5b31 3a5d 3a0a 2020 2020 2020 2020 6d61  [1:]:.        ma
-0004f100: 736b 202a 3d20 726f 692e 6765 745f 6d61  sk *= roi.get_ma
-0004f110: 736b 2873 7461 6e64 6172 6469 7365 3d54  sk(standardise=T
-0004f120: 7275 6529 0a20 2020 2072 6574 7572 6e20  rue).    return 
-0004f130: 524f 4928 6d61 736b 2c20 2a2a 6b77 6172  ROI(mask, **kwar
-0004f140: 6773 290a 0a0a 6465 6620 6466 5f74 6f5f  gs)...def df_to_
-0004f150: 6874 6d6c 2864 6629 3a0a 2020 2020 2222  html(df):.    ""
-0004f160: 2243 6f6e 7665 7274 2061 2070 616e 6461  "Convert a panda
-0004f170: 7320 4461 7461 4672 616d 6520 746f 2068  s DataFrame to h
-0004f180: 746d 6c2e 2222 220a 0a20 2020 2023 2043  tml."""..    # C
-0004f190: 6f6e 7665 7274 2064 6174 6166 7261 6d65  onvert dataframe
-0004f1a0: 2074 6f20 4854 4d4c 0a20 2020 2068 746d   to HTML.    htm
-0004f1b0: 6c20 3d20 6466 2e66 696c 6c6e 6128 27e2  l = df.fillna('.
-0004f1c0: 8094 2729 2e74 6f5f 6874 6d6c 2869 6e64  ..').to_html(ind
-0004f1d0: 6578 3d46 616c 7365 290a 2020 2020 6874  ex=False).    ht
-0004f1e0: 6d6c 203d 2068 746d 6c2e 7265 706c 6163  ml = html.replac
-0004f1f0: 6528 225e 3322 2c20 223c 7375 703e 333c  e("^3", "<sup>3<
-0004f200: 2f73 7570 3e22 292e 7265 706c 6163 6528  /sup>").replace(
-0004f210: 225e 3222 2c20 223c 7375 703e 323c 2f73  "^2", "<sup>2</s
-0004f220: 7570 3e22 290a 0a20 2020 2023 2041 6464  up>")..    # Add
-0004f230: 2068 6561 6465 7220 7769 7468 2073 7479   header with sty
-0004f240: 6c65 2064 6574 6169 6c73 0a20 2020 2068  le details.    h
-0004f250: 6561 6465 7220 3d20 2222 220a 2020 2020  eader = """.    
-0004f260: 2020 2020 3c68 6561 643e 0a20 2020 2020      <head>.     
-0004f270: 2020 2020 2020 203c 7374 796c 653e 0a20         <style>. 
-0004f280: 2020 2020 2020 2020 2020 2020 2020 2074                 t
-0004f290: 682c 2074 6420 7b0a 2020 2020 2020 2020  h, td {.        
-0004f2a0: 2020 2020 2020 2020 2020 2020 7061 6464              padd
-0004f2b0: 696e 673a 2032 7078 2032 7078 3b0a 2020  ing: 2px 2px;.  
-0004f2c0: 2020 2020 2020 2020 2020 2020 2020 7d0a                }.
-0004f2d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004f2e0: 7468 207b 0a20 2020 2020 2020 2020 2020  th {.           
-0004f2f0: 2020 2020 2020 2020 2062 6163 6b67 726f           backgro
-0004f300: 756e 642d 636f 6c6f 723a 2074 7261 6e73  und-color: trans
-0004f310: 7061 7265 6e74 3b0a 2020 2020 2020 2020  parent;.        
-0004f320: 2020 2020 2020 2020 2020 2020 7465 7874              text
-0004f330: 2d61 6c69 676e 3a20 6365 6e74 6572 3b0a  -align: center;.
-0004f340: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004f350: 7d0a 2020 2020 2020 2020 2020 2020 3c2f  }.            </
-0004f360: 7374 796c 653e 0a20 2020 2020 2020 203c  style>.        <
-0004f370: 2f68 6561 643e 0a20 2020 2022 2222 0a20  /head>.    """. 
-0004f380: 2020 2074 6162 6c65 5f68 746d 6c20 3d20     table_html = 
-0004f390: 280a 2020 2020 2020 2020 2868 6561 6465  (.        (heade
-0004f3a0: 7220 2b20 6874 6d6c 290a 2020 2020 2020  r + html).      
-0004f3b0: 2020 2e72 6570 6c61 6365 2822 2667 743b    .replace("&gt;
-0004f3c0: 222c 2022 3e22 290a 2020 2020 2020 2020  ", ">").        
-0004f3d0: 2e72 6570 6c61 6365 2822 266c 743b 222c  .replace("&lt;",
-0004f3e0: 2022 3c22 290a 2020 2020 2020 2020 2e72   "<").        .r
-0004f3f0: 6570 6c61 6365 2822 2661 6d70 3b22 2c20  eplace("&amp;", 
-0004f400: 2226 2229 0a20 2020 2029 0a20 2020 2072  "&").    ).    r
-0004f410: 6574 7572 6e20 7461 626c 655f 6874 6d6c  eturn table_html
-0004f420: 0a0a 0a64 6566 2062 6573 745f 7465 7874  ...def best_text
-0004f430: 5f63 6f6c 6f72 2872 6564 2c20 6772 6565  _color(red, gree
-0004f440: 6e2c 2062 6c75 6529 3a0a 2020 2020 6966  n, blue):.    if
-0004f450: 2028 7265 6420 2a20 302e 3239 3920 2b20   (red * 0.299 + 
-0004f460: 6772 6565 6e20 2a20 302e 3538 3720 2b20  green * 0.587 + 
-0004f470: 626c 7565 202a 2030 2e31 3134 2920 3e20  blue * 0.114) > 
-0004f480: 3138 363a 0a20 2020 2020 2020 2072 6574  186:.        ret
-0004f490: 7572 6e20 2262 6c61 636b 220a 2020 2020  urn "black".    
-0004f4a0: 7265 7475 726e 2022 7768 6974 6522 0a0a  return "white"..
-0004f4b0: 0a64 6566 2067 6574 5f63 6f6c 6f72 6564  .def get_colored
-0004f4c0: 5f72 6f69 5f73 7472 696e 6728 726f 692c  _roi_string(roi,
-0004f4d0: 2067 7265 793d 4661 6c73 652c 2063 6f6c   grey=False, col
-0004f4e0: 6f72 3d4e 6f6e 6529 3a0a 2020 2020 2222  or=None):.    ""
-0004f4f0: 2247 6574 2052 4f49 206e 616d 6520 696e  "Get ROI name in
-0004f500: 2048 544d 4c20 7769 7468 2062 6163 6b67   HTML with backg
-0004f510: 726f 756e 6420 636f 6c6f 7220 6672 6f6d  round color from
-0004f520: 2072 6f69 2e63 6f6c 6f72 2e20 4966 2067   roi.color. If g
-0004f530: 7265 793d 5472 7565 2c0a 2020 2020 7468  rey=True,.    th
-0004f540: 6520 6261 636b 6772 6f75 6e64 2063 6f6c  e background col
-0004f550: 6f72 2077 696c 6c20 6265 2067 7265 792e  or will be grey.
-0004f560: 2222 220a 0a20 2020 2069 6620 636f 6c6f  """..    if colo
-0004f570: 7220 6973 204e 6f6e 653a 0a20 2020 2020  r is None:.     
-0004f580: 2020 2063 6f6c 6f72 203d 2072 6f69 2e63     color = roi.c
-0004f590: 6f6c 6f72 0a20 2020 2069 6620 6772 6579  olor.    if grey
-0004f5a0: 3a0a 2020 2020 2020 2020 7265 642c 2067  :.        red, g
-0004f5b0: 7265 656e 2c20 626c 7565 203d 2032 3535  reen, blue = 255
-0004f5c0: 2c20 3235 352c 2032 3535 0a20 2020 2020  , 255, 255.     
-0004f5d0: 2020 2072 6564 2c20 6772 6565 6e2c 2062     red, green, b
-0004f5e0: 6c75 6520 3d20 3132 382c 2031 3238 2c20  lue = 128, 128, 
-0004f5f0: 3132 380a 2020 2020 2020 2020 7465 7874  128.        text
-0004f600: 5f63 6f6c 203d 2032 3030 2c20 3230 302c  _col = 200, 200,
-0004f610: 2032 3030 0a20 2020 2020 2020 2023 2041   200.        # A
-0004f620: 766f 6964 2073 6574 7469 6e67 2063 6f6c  void setting col
-0004f630: 6f75 7220 666f 7220 6772 6579 6564 206f  our for greyed o
-0004f640: 7574 2052 4f49 732e 0a20 2020 2020 2020  ut ROIs..       
-0004f650: 2023 2054 6869 7320 6769 7665 7320 676f   # This gives go
-0004f660: 6f64 2072 6561 6461 6269 6c69 7479 2066  od readability f
-0004f670: 6f72 2062 6f74 6820 6461 726b 2061 6e64  or both dark and
-0004f680: 206c 6967 6874 2074 6865 6d65 732e 0a20   light themes.. 
-0004f690: 2020 2020 2020 2072 6574 7572 6e20 2827         return ('
-0004f6a0: 3c70 3e26 6e62 7370 3b7b 7d26 6e62 7370  <p>&nbsp;{}&nbsp
-0004f6b0: 3b3c 2f70 3e27 292e 666f 726d 6174 2872  ;</p>').format(r
-0004f6c0: 6f69 2e6e 616d 6529 0a20 2020 2065 6c73  oi.name).    els
-0004f6d0: 653a 0a20 2020 2020 2020 2072 6564 2c20  e:.        red, 
-0004f6e0: 6772 6565 6e2c 2062 6c75 6520 3d20 5b63  green, blue = [c
-0004f6f0: 202a 2032 3535 2066 6f72 2063 2069 6e20   * 255 for c in 
-0004f700: 636f 6c6f 725b 3a33 5d5d 0a20 2020 2020  color[:3]].     
-0004f710: 2020 2074 6578 745f 636f 6c20 3d20 6265     text_col = be
-0004f720: 7374 5f74 6578 745f 636f 6c6f 7228 7265  st_text_color(re
-0004f730: 642c 2067 7265 656e 2c20 626c 7565 290a  d, green, blue).
-0004f740: 2020 2020 7265 7475 726e 2028 0a20 2020      return (.   
-0004f750: 2020 2020 2027 3c70 2073 7479 6c65 3d22       '<p style="
-0004f760: 6261 636b 6772 6f75 6e64 2d63 6f6c 6f72  background-color
-0004f770: 3a20 7267 6228 7b7d 2c20 7b7d 2c20 7b7d  : rgb({}, {}, {}
-0004f780: 293b 2027 0a20 2020 2020 2020 2027 636f  ); '.        'co
-0004f790: 6c6f 723a 207b 7d3b 223e 266e 6273 703b  lor: {};">&nbsp;
-0004f7a0: 7b7d 266e 6273 703b 3c2f 703e 270a 2020  {}&nbsp;</p>'.  
-0004f7b0: 2020 292e 666f 726d 6174 2872 6564 2c20    ).format(red, 
-0004f7c0: 6772 6565 6e2c 2062 6c75 652c 2074 6578  green, blue, tex
-0004f7d0: 745f 636f 6c2c 2072 6f69 2e6e 616d 6529  t_col, roi.name)
-0004f7e0: 0a0a 6465 6620 636f 6d70 6172 655f 726f  ..def compare_ro
-0004f7f0: 695f 7061 6972 7328 0a20 2020 2070 6169  i_pairs(.    pai
-0004f800: 7273 2c20 0a20 2020 2068 746d 6c3d 4661  rs, .    html=Fa
-0004f810: 6c73 652c 0a20 2020 206e 616d 655f 6173  lse,.    name_as
-0004f820: 5f69 6e64 6578 3d54 7275 652c 0a20 2020  _index=True,.   
-0004f830: 2067 7265 7965 645f 6f75 743d 4e6f 6e65   greyed_out=None
-0004f840: 2c0a 2020 2020 636f 6c6f 7265 643d 4661  ,.    colored=Fa
-0004f850: 6c73 652c 0a20 2020 2072 6f69 5f6b 7761  lse,.    roi_kwa
-0004f860: 7267 733d 7b7d 2c0a 2020 2020 2a2a 6b77  rgs={},.    **kw
-0004f870: 6172 6773 0a29 3a0a 2020 2020 6966 2068  args.):.    if h
-0004f880: 746d 6c3a 0a20 2020 2020 2020 206e 616d  tml:.        nam
-0004f890: 655f 6173 5f69 6e64 6578 203d 2046 616c  e_as_index = Fal
-0004f8a0: 7365 0a20 2020 2069 6620 6772 6579 6564  se.    if greyed
-0004f8b0: 5f6f 7574 2069 7320 4e6f 6e65 3a0a 2020  _out is None:.  
-0004f8c0: 2020 2020 2020 6772 6579 6564 5f6f 7574        greyed_out
-0004f8d0: 203d 205b 5d0a 2020 2020 6466 7320 3d20   = [].    dfs = 
-0004f8e0: 5b5d 0a20 2020 2066 6f72 2072 6f69 312c  [].    for roi1,
-0004f8f0: 2072 6f69 3220 696e 2070 6169 7273 3a0a   roi2 in pairs:.
-0004f900: 0a20 2020 2020 2020 2023 2047 6574 2044  .        # Get D
-0004f910: 6174 6146 7261 6d65 2066 6f72 2074 6869  ataFrame for thi
-0004f920: 7320 7061 6972 0a20 2020 2020 2020 2064  s pair.        d
-0004f930: 665f 726f 7720 3d20 726f 6931 2e67 6574  f_row = roi1.get
-0004f940: 5f63 6f6d 7061 7269 736f 6e28 726f 6932  _comparison(roi2
-0004f950: 2c20 6e61 6d65 5f61 735f 696e 6465 783d  , name_as_index=
-0004f960: 6e61 6d65 5f61 735f 696e 6465 782c 0a20  name_as_index,. 
-0004f970: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004f980: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004f990: 2020 2020 2a2a 6b77 6172 6773 290a 0a20      **kwargs).. 
-0004f9a0: 2020 2020 2020 2023 2052 6570 6c61 6365         # Replace
-0004f9b0: 2076 616c 7565 7320 7769 7468 2022 2d2d   values with "--
-0004f9c0: 2220 6966 2065 6974 6865 7220 524f 4920  " if either ROI 
-0004f9d0: 6973 2067 7265 7965 6420 6f75 740a 2020  is greyed out.  
-0004f9e0: 2020 2020 2020 6772 6579 203d 2072 6f69        grey = roi
-0004f9f0: 3120 696e 2067 7265 7965 645f 6f75 7420  1 in greyed_out 
-0004fa00: 6f72 2072 6f69 3220 696e 2067 7265 7965  or roi2 in greye
-0004fa10: 645f 6f75 740a 2020 2020 2020 2020 6966  d_out.        if
-0004fa20: 2067 7265 793a 0a20 2020 2020 2020 2020   grey:.         
-0004fa30: 2020 2066 6f72 2063 6f6c 2069 6e20 6466     for col in df
-0004fa40: 5f72 6f77 2e63 6f6c 756d 6e73 3a0a 2020  _row.columns:.  
-0004fa50: 2020 2020 2020 2020 2020 2020 2020 6966                if
-0004fa60: 2063 6f6c 203d 3d20 2252 4f49 223a 200a   col == "ROI": .
-0004fa70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004fa80: 2020 2020 636f 6e74 696e 7565 0a20 2020      continue.   
-0004fa90: 2020 2020 2020 2020 2020 2020 2064 665f               df_
-0004faa0: 726f 775b 636f 6c5d 203d 2022 2d2d 220a  row[col] = "--".
-0004fab0: 0a20 2020 2020 2020 2023 2041 646a 7573  .        # Adjus
-0004fac0: 7420 636f 6d70 6172 6973 6f6e 206e 616d  t comparison nam
-0004fad0: 650a 2020 2020 2020 2020 636f 6d70 5f6e  e.        comp_n
-0004fae0: 616d 6520 3d20 726f 6931 2e67 6574 5f63  ame = roi1.get_c
-0004faf0: 6f6d 7061 7269 736f 6e5f 6e61 6d65 2872  omparison_name(r
-0004fb00: 6f69 322c 2063 6f6c 6f72 6564 3d63 6f6c  oi2, colored=col
-0004fb10: 6f72 6564 2c20 6772 6579 3d67 7265 792c  ored, grey=grey,
-0004fb20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0004fb30: 2072 6f69 5f6b 7761 7267 733d 726f 695f   roi_kwargs=roi_
-0004fb40: 6b77 6172 6773 290a 2020 2020 2020 2020  kwargs).        
-0004fb50: 6966 206e 616d 655f 6173 5f69 6e64 6578  if name_as_index
-0004fb60: 3a0a 2020 2020 2020 2020 2020 2020 6466  :.            df
-0004fb70: 5f72 6f77 2e72 656e 616d 6528 7b64 665f  _row.rename({df_
-0004fb80: 726f 772e 696e 6465 785b 305d 3a20 636f  row.index[0]: co
-0004fb90: 6d70 5f6e 616d 657d 2c20 696e 706c 6163  mp_name}, inplac
-0004fba0: 653d 5472 7565 290a 2020 2020 2020 2020  e=True).        
-0004fbb0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-0004fbc0: 2020 6466 5f72 6f77 2e69 6c6f 635b 302c    df_row.iloc[0,
-0004fbd0: 2030 5d20 3d20 636f 6d70 5f6e 616d 650a   0] = comp_name.
-0004fbe0: 0a20 2020 2020 2020 2064 6673 2e61 7070  .        dfs.app
-0004fbf0: 656e 6428 6466 5f72 6f77 290a 0a20 2020  end(df_row)..   
-0004fc00: 2069 676e 6f72 655f 696e 6465 7820 3d20   ignore_index = 
-0004fc10: 4661 6c73 6520 6966 206e 616d 655f 6173  False if name_as
-0004fc20: 5f69 6e64 6578 2065 6c73 6520 5472 7565  _index else True
-0004fc30: 0a20 2020 2064 6620 3d20 7064 2e63 6f6e  .    df = pd.con
-0004fc40: 6361 7428 6466 732c 2069 676e 6f72 655f  cat(dfs, ignore_
-0004fc50: 696e 6465 783d 6967 6e6f 7265 5f69 6e64  index=ignore_ind
-0004fc60: 6578 2920 6966 2064 6673 2065 6c73 6520  ex) if dfs else 
-0004fc70: 4e6f 6e65 0a20 2020 2069 6620 6874 6d6c  None.    if html
-0004fc80: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
-0004fc90: 2064 665f 746f 5f68 746d 6c28 6466 290a   df_to_html(df).
-0004fca0: 2020 2020 7265 7475 726e 2064 660a 0a64      return df..d
-0004fcb0: 6566 2067 6574 5f63 6f6e 666f 726d 6974  ef get_conformit
-0004fcc0: 795f 696e 6465 7828 0a20 2020 2072 6f69  y_index(.    roi
-0004fcd0: 732c 0a20 2020 2063 695f 7479 7065 3d22  s,.    ci_type="
-0004fce0: 6765 6e22 2c0a 2020 2020 7369 6e67 6c65  gen",.    single
-0004fcf0: 5f73 6c69 6365 3d46 616c 7365 2c0a 2020  _slice=False,.  
-0004fd00: 2020 7669 6577 3d22 782d 7922 2c20 0a20    view="x-y", . 
-0004fd10: 2020 2073 6c3d 4e6f 6e65 2c20 0a20 2020     sl=None, .   
-0004fd20: 2069 6478 3d4e 6f6e 652c 200a 2020 2020   idx=None, .    
-0004fd30: 706f 733d 4e6f 6e65 2c20 0a20 2020 206d  pos=None, .    m
-0004fd40: 6574 686f 643d 4e6f 6e65 2c0a 2020 2020  ethod=None,.    
-0004fd50: 666c 6174 7465 6e3d 4661 6c73 652c 0a20  flatten=False,. 
-0004fd60: 2020 2029 3a0a 2020 2020 2222 220a 2020     ):.    """.  
-0004fd70: 2020 4765 7420 636f 6e66 6f72 6d69 7479    Get conformity
-0004fd80: 2069 6e64 6578 2066 6f72 2074 776f 206f   index for two o
-0004fd90: 7220 6d6f 7265 2052 4f49 732e 0a0a 2020  r more ROIs...  
-0004fda0: 2020 5468 6520 636f 6e66 6f72 6d69 7479    The conformity
-0004fdb0: 2069 6e64 6578 206d 6179 2062 6520 6361   index may be ca
-0004fdc0: 6c63 756c 6174 6564 2067 6c6f 6261 6c6c  lculated globall
-0004fdd0: 7920 6f72 2066 6f72 2061 2073 696e 676c  y or for a singl
-0004fde0: 6520 736c 6963 652e 0a0a 2020 2020 5468  e slice...    Th
-0004fdf0: 6973 2066 756e 6374 696f 6e20 7265 7475  is function retu
-0004fe00: 726e 7320 6569 7468 6572 2074 6865 2076  rns either the v
-0004fe10: 616c 7565 206f 6620 6f6e 6520 6f66 2074  alue of one of t
-0004fe20: 6865 2074 6872 6565 2074 7970 6573 0a20  he three types. 
-0004fe30: 2020 206f 6620 636f 6e66 6f72 6d69 7479     of conformity
-0004fe40: 2069 6e64 6578 2028 2267 656e 2220 2866   index ("gen" (f
-0004fe50: 6f72 2067 656e 6572 616c 6973 6564 292c  or generalised),
-0004fe60: 2022 7061 6972 7322 2c20 2263 6f6d 6d6f   "pairs", "commo
-0004fe70: 6e22 290a 2020 2020 7265 6665 7272 6564  n").    referred
-0004fe80: 2074 6f20 696e 3a0a 2020 2020 6874 7470   to in:.    http
-0004fe90: 733a 2f2f 646f 692e 6f72 672f 3130 2e31  s://doi.org/10.1
-0004fea0: 3038 382f 3030 3331 2d39 3135 352f 3534  088/0031-9155/54
-0004feb0: 2f39 2f30 3138 0a20 2020 206f 7220 6120  /9/018.    or a 
-0004fec0: 736b 7274 2e63 6f72 652e 4461 7461 206f  skrt.core.Data o
-0004fed0: 626a 6563 7420 7769 7468 2074 6865 2076  bject with the v
-0004fee0: 616c 7565 7320 6f66 2061 6c6c 2074 6872  alues of all thr
-0004fef0: 6565 2e0a 2020 2020 466f 7220 7468 6520  ee..    For the 
-0004ff00: 6361 7365 206f 6620 7477 6f20 524f 4973  case of two ROIs
-0004ff10: 2c20 7468 6520 7468 7265 6520 6d65 7472  , the three metr
-0004ff20: 6963 7320 6172 6520 616c 6c20 6571 7569  ics are all equi
-0004ff30: 7661 6c65 6e74 0a20 2020 2074 6f20 7468  valent.    to th
-0004ff40: 6520 4a61 6363 6172 6420 636f 6e66 6f72  e Jaccard confor
-0004ff50: 6d69 7479 2069 6e64 6578 2e0a 0a20 2020  mity index...   
-0004ff60: 202a 2a50 6172 616d 6574 6572 733a 2a2a   **Parameters:**
-0004ff70: 0a20 2020 2020 2020 200a 2020 2020 726f  .        .    ro
-0004ff80: 6973 203a 206c 6973 740a 2020 2020 2020  is : list.      
-0004ff90: 2020 4c69 7374 206f 6620 7477 6f20 6f72    List of two or
-0004ffa0: 206d 6f72 6520 736b 7274 2e73 7472 7563   more skrt.struc
-0004ffb0: 7475 7265 732e 524f 4920 6f62 6a65 6374  tures.ROI object
-0004ffc0: 7320 666f 7220 7768 6963 6820 636f 6e66  s for which conf
-0004ffd0: 6f72 6d69 7479 0a20 2020 2020 2020 2069  ormity.        i
-0004ffe0: 6e64 6578 2069 7320 746f 2062 6520 6361  ndex is to be ca
-0004fff0: 6c63 756c 6174 6564 2e0a 0a20 2020 2063  lculated...    c
-00050000: 695f 7479 7065 3a20 7374 722c 2064 6566  i_type: str, def
-00050010: 6175 6c74 3d22 6765 6e22 0a20 2020 2020  ault="gen".     
-00050020: 2020 2054 7970 6520 6f66 2063 6f6e 666f     Type of confo
-00050030: 726d 6974 7920 696e 6465 7820 746f 2062  rmity index to b
-00050040: 6520 7265 7475 726e 6564 2c20 6672 6f6d  e returned, from
-00050050: 2022 6765 6e22 2028 666f 7220 6765 6e65   "gen" (for gene
-00050060: 7261 6c69 7365 6429 2c0a 2020 2020 2020  ralised),.      
-00050070: 2020 2270 6169 7273 222c 2022 636f 6d6d    "pairs", "comm
-00050080: 6f6e 222e 2020 4966 2073 6574 2074 6f20  on".  If set to 
-00050090: 2261 6c6c 222c 2061 2073 6b72 742e 636f  "all", a skrt.co
-000500a0: 7265 2e44 6174 6120 6f62 6a65 6374 2077  re.Data object w
-000500b0: 6974 680a 2020 2020 2020 2020 7661 6c75  ith.        valu
-000500c0: 6573 2066 6f72 2074 6865 2074 6872 6565  es for the three
-000500d0: 2074 7970 6573 206f 6620 636f 6e66 6f72   types of confor
-000500e0: 6d69 7479 2069 6e64 6578 2069 7320 7265  mity index is re
-000500f0: 7475 726e 6564 2e0a 0a20 2020 2073 696e  turned...    sin
-00050100: 676c 655f 736c 6963 6520 3a20 626f 6f6c  gle_slice : bool
-00050110: 2c20 6465 6661 756c 743d 4661 6c73 650a  , default=False.
-00050120: 2020 2020 2020 2020 4966 2046 616c 7365          If False
-00050130: 2c20 7468 6520 676c 6f62 616c 2033 4420  , the global 3D 
-00050140: 4469 6365 2073 636f 7265 206f 6620 7468  Dice score of th
-00050150: 6520 6675 6c6c 2052 4f49 7320 7769 6c6c  e full ROIs will
-00050160: 2062 6520 7265 7475 726e 6564 3b0a 2020   be returned;.  
-00050170: 2020 2020 2020 6f74 6865 7277 6973 652c        otherwise,
-00050180: 2074 6865 2032 4420 4469 6365 2073 636f   the 2D Dice sco
-00050190: 7265 206f 6e20 6120 7369 6e67 6c65 2073  re on a single s
-000501a0: 6c69 6365 2077 696c 6c20 6265 2072 6574  lice will be ret
-000501b0: 7572 6e65 642e 0a0a 2020 2020 7669 6577  urned...    view
-000501c0: 203a 2073 7472 2c20 6465 6661 756c 743d   : str, default=
-000501d0: 2278 2d79 220a 2020 2020 2020 2020 4f72  "x-y".        Or
-000501e0: 6965 6e74 6174 696f 6e20 6f66 2073 6c69  ientation of sli
-000501f0: 6365 206f 6e20 7768 6963 6820 746f 2067  ce on which to g
-00050200: 6574 2044 6963 6520 7363 6f72 652e 204f  et Dice score. O
-00050210: 6e6c 7920 7573 6564 2069 6620 0a20 2020  nly used if .   
-00050220: 2020 2020 2073 696e 676c 655f 736c 6963       single_slic
-00050230: 653d 5472 7565 2e20 4966 2075 7369 6e67  e=True. If using
-00050240: 2c20 3c61 783e 206d 7573 7420 6265 2061  , <ax> must be a
-00050250: 6e20 6178 6973 2074 6861 7420 6c69 6573  n axis that lies
-00050260: 2061 6c6f 6e67 0a20 2020 2020 2020 2074   along.        t
-00050270: 6865 2073 6c69 6365 2069 6e20 7468 6973  he slice in this
-00050280: 206f 7269 656e 7461 7469 6f6e 2e0a 0a20   orientation... 
-00050290: 2020 2073 6c20 3a20 696e 742c 2064 6566     sl : int, def
-000502a0: 6175 6c74 3d4e 6f6e 650a 2020 2020 2020  ault=None.      
-000502b0: 2020 536c 6963 6520 6e75 6d62 6572 2e20    Slice number. 
-000502c0: 4966 206e 6f6e 6520 6f66 203c 736c 3e2c  If none of <sl>,
-000502d0: 203c 6964 783e 206f 7220 3c70 6f73 3e20   <idx> or <pos> 
-000502e0: 6172 6520 7375 7070 6c69 6564 2062 7574  are supplied but
-000502f0: 0a20 2020 2020 2020 203c 7369 6e67 6c65  .        <single
-00050300: 5f73 6c69 6365 3e20 6973 2054 7275 652c  _slice> is True,
-00050310: 2074 6865 2063 656e 7472 616c 2073 6c69   the central sli
-00050320: 6365 206f 6620 7468 6973 2052 4f49 2077  ce of this ROI w
-00050330: 696c 6c20 6265 2075 7365 642e 0a0a 2020  ill be used...  
-00050340: 2020 6964 7820 3a20 696e 742c 2064 6566    idx : int, def
-00050350: 6175 6c74 3d4e 6f6e 650a 2020 2020 2020  ault=None.      
-00050360: 2020 4172 7261 7920 696e 6465 7820 6f66    Array index of
-00050370: 2073 6c69 6365 2e20 4966 206e 6f6e 6520   slice. If none 
-00050380: 6f66 203c 736c 3e2c 203c 6964 783e 206f  of <sl>, <idx> o
-00050390: 7220 3c70 6f73 3e20 6172 6520 7375 7070  r <pos> are supp
-000503a0: 6c69 6564 2062 7574 0a20 2020 2020 2020  lied but.       
-000503b0: 203c 7369 6e67 6c65 5f73 6c69 6365 3e20   <single_slice> 
-000503c0: 6973 2054 7275 652c 2074 6865 2063 656e  is True, the cen
-000503d0: 7472 616c 2073 6c69 6365 206f 6620 7468  tral slice of th
-000503e0: 6973 2052 4f49 2077 696c 6c20 6265 2075  is ROI will be u
-000503f0: 7365 642e 0a0a 2020 2020 706f 7320 3a20  sed...    pos : 
-00050400: 666c 6f61 742c 2064 6566 6175 6c74 3d4e  float, default=N
-00050410: 6f6e 650a 2020 2020 2020 2020 536c 6963  one.        Slic
-00050420: 6520 706f 7369 7469 6f6e 2069 6e20 6d6d  e position in mm
-00050430: 2e20 4966 206e 6f6e 6520 6f66 203c 736c  . If none of <sl
-00050440: 3e2c 203c 6964 783e 206f 7220 3c70 6f73  >, <idx> or <pos
-00050450: 3e20 6172 6520 7375 7070 6c69 6564 2062  > are supplied b
-00050460: 7574 0a20 2020 2020 2020 203c 7369 6e67  ut.        <sing
-00050470: 6c65 5f73 6c69 6365 3e20 6973 2054 7275  le_slice> is Tru
-00050480: 652c 2074 6865 2063 656e 7472 616c 2073  e, the central s
-00050490: 6c69 6365 206f 6620 7468 6973 2052 4f49  lice of this ROI
-000504a0: 2077 696c 6c20 6265 2075 7365 642e 0a0a   will be used...
-000504b0: 2020 2020 6d65 7468 6f64 203a 2073 7472      method : str
-000504c0: 2c20 6465 6661 756c 743d 4e6f 6e65 0a20  , default=None. 
-000504d0: 2020 2020 2020 204d 6574 686f 6420 746f         Method to
-000504e0: 2075 7365 2066 6f72 2044 6963 6520 7363   use for Dice sc
-000504f0: 6f72 6520 6361 6c63 756c 6174 696f 6e2e  ore calculation.
-00050500: 2043 616e 2062 653a 200a 2020 2020 2020   Can be: .      
-00050510: 2020 2d20 2263 6f6e 746f 7572 223a 2067    - "contour": g
-00050520: 6574 2069 6e74 6572 7365 6374 696f 6e73  et intersections
-00050530: 2061 6e64 2061 7265 6173 206f 6620 7368   and areas of sh
-00050540: 6170 656c 7920 636f 6e74 6f75 7273 2e0a  apely contours..
-00050550: 2020 2020 2020 2020 2d20 226d 6173 6b22          - "mask"
-00050560: 3a20 636f 756e 7420 696e 7465 7273 6563  : count intersec
-00050570: 7469 6e67 2076 6f78 656c 7320 696e 2062  ting voxels in b
-00050580: 696e 6172 7920 6d61 736b 732e 0a20 2020  inary masks..   
-00050590: 2020 2020 202d 204e 6f6e 653a 2075 7365       - None: use
-000505a0: 2074 6865 206d 6574 686f 6420 7365 7420   the method set 
-000505b0: 696e 2073 656c 662e 6465 6661 756c 745f  in self.default_
-000505c0: 6765 6f6d 5f6d 6574 686f 642e 0a20 2020  geom_method..   
-000505d0: 2020 2020 2046 6f72 206d 6f72 6520 7468       For more th
-000505e0: 616e 2074 776f 2052 4f49 7320 616e 6420  an two ROIs and 
-000505f0: 3c63 695f 7479 7065 3e20 2263 6f6d 6d6f  <ci_type> "commo
-00050600: 6e22 2c20 6f6e 6c79 2074 6865 2022 6d61  n", only the "ma
-00050610: 736b 220a 2020 2020 2020 2020 6d65 7468  sk".        meth
-00050620: 6f64 2069 7320 696d 706c 656d 656e 7465  od is implemente
-00050630: 642e 0a0a 2020 2020 666c 6174 7465 6e20  d...    flatten 
-00050640: 3a20 626f 6f6c 2c20 6465 6661 756c 743d  : bool, default=
-00050650: 4661 6c73 650a 2020 2020 2020 2020 4966  False.        If
-00050660: 2054 7275 652c 2061 6c6c 2073 6c69 6365   True, all slice
-00050670: 7320 7769 6c6c 2062 6520 666c 6174 7465  s will be flatte
-00050680: 6e65 6420 696e 2074 6865 2067 6976 656e  ned in the given
-00050690: 206f 7269 656e 7461 7469 6f6e 2061 6e64   orientation and
-000506a0: 0a20 2020 2020 2020 2074 6865 2044 6963  .        the Dic
-000506b0: 6520 7363 6f72 6520 6f66 2074 6865 2066  e score of the f
-000506c0: 6c61 7474 656e 6564 2073 6c69 6365 7320  lattened slices 
-000506d0: 7769 6c6c 2062 6520 7265 7475 726e 6564  will be returned
-000506e0: 2e20 4f6e 6c79 200a 2020 2020 2020 2020  . Only .        
-000506f0: 6176 6169 6c61 626c 6520 6966 206d 6574  available if met
-00050700: 686f 643d 226d 6173 6b22 2e0a 2020 2020  hod="mask"..    
-00050710: 2222 220a 0a20 2020 2023 2052 6571 7569  """..    # Requi
-00050720: 7265 2076 616c 6964 2069 6e70 7574 732e  re valid inputs.
-00050730: 0a20 2020 2069 6620 6c65 6e28 726f 6973  .    if len(rois
-00050740: 2920 3c20 3220 6f72 2063 695f 7479 7065  ) < 2 or ci_type
-00050750: 206e 6f74 2069 6e20 5b22 636f 6d6d 6f6e   not in ["common
-00050760: 222c 2022 6765 6e22 2c20 2270 6169 7273  ", "gen", "pairs
-00050770: 222c 2022 616c 6c22 5d3a 0a20 2020 2020  ", "all"]:.     
-00050780: 2020 2072 6574 7572 6e0a 0a20 2020 2023     return..    #
-00050790: 2049 6e69 7469 616c 6973 6520 4461 7461   Initialise Data
-000507a0: 206f 626a 6563 7420 666f 7220 636f 6e66   object for conf
-000507b0: 6f72 6d69 7479 2069 6e64 6963 6573 2e0a  ormity indices..
-000507c0: 2020 2020 6369 203d 2073 6b72 742e 636f      ci = skrt.co
-000507d0: 7265 2e44 6174 6128 7b22 636f 6d6d 6f6e  re.Data({"common
-000507e0: 223a 2030 2c20 2267 656e 223a 302c 2022  ": 0, "gen":0, "
-000507f0: 7061 6972 7322 3a30 7d29 0a0a 2020 2020  pairs":0})..    
-00050800: 2320 4465 616c 2077 6974 6820 6361 7365  # Deal with case
-00050810: 7320 2267 656e 2220 616e 6420 2270 6169  s "gen" and "pai
-00050820: 7273 222e 0a20 2020 2023 0a20 2020 2023  rs"..    #.    #
-00050830: 2046 6f72 2022 6765 6e22 2c20 7468 6520   For "gen", the 
-00050840: 636f 6e66 6f72 6d69 7479 2069 6e64 6578  conformity index
-00050850: 2069 7320 6361 6c63 756c 6174 6564 2061   is calculated a
-00050860: 7320 7468 6520 7261 7469 6f20 6f66 0a20  s the ratio of. 
-00050870: 2020 2023 2028 3129 2074 6865 2073 756d     # (1) the sum
-00050880: 206f 6620 7468 6520 696e 7465 7273 6563   of the intersec
-00050890: 7469 6f6e 7320 666f 7220 616c 6c20 7061  tions for all pa
-000508a0: 6972 7320 746f 2028 3229 2074 6865 2073  irs to (2) the s
-000508b0: 756d 206f 660a 2020 2020 2320 7468 6520  um of.    # the 
-000508c0: 756e 696f 6e73 2066 6f72 2061 6c6c 2070  unions for all p
-000508d0: 6169 7273 2e0a 2020 2020 230a 2020 2020  airs..    #.    
-000508e0: 2320 466f 7220 2270 6169 7273 2c20 7468  # For "pairs, th
-000508f0: 6520 636f 6e66 6f72 6d69 7479 2069 6e64  e conformity ind
-00050900: 6578 2069 7320 6361 6c63 7561 6c74 6564  ex is calcualted
-00050910: 2061 7320 7468 6520 6d65 616e 206f 6620   as the mean of 
-00050920: 7468 650a 2020 2020 2320 4a61 6363 6172  the.    # Jaccar
-00050930: 6420 636f 6e66 6f72 6d69 7479 2069 6e64  d conformity ind
-00050940: 6963 6573 2066 6f72 2061 6c6c 2070 6169  ices for all pai
-00050950: 7273 2e0a 0a20 2020 206e 756d 6572 6174  rs...    numerat
-00050960: 6f72 203d 2030 0a20 2020 2064 656e 6f6d  or = 0.    denom
-00050970: 696e 6174 6f72 203d 2030 0a20 2020 206e  inator = 0.    n
-00050980: 5f70 6169 7220 3d20 300a 2020 2020 666f  _pair = 0.    fo
-00050990: 7220 6964 7831 2069 6e20 7261 6e67 6528  r idx1 in range(
-000509a0: 6c65 6e28 726f 6973 2920 2d20 3129 3a0a  len(rois) - 1):.
-000509b0: 2020 2020 2020 2020 666f 7220 6964 7832          for idx2
-000509c0: 2069 6e20 7261 6e67 6528 6964 7831 202b   in range(idx1 +
-000509d0: 2031 2c20 6c65 6e28 726f 6973 2929 3a0a   1, len(rois)):.
-000509e0: 2020 2020 2020 2020 2020 2020 726f 6931              roi1
-000509f0: 203d 2072 6f69 735b 6964 7831 5d0a 2020   = rois[idx1].  
-00050a00: 2020 2020 2020 2020 2020 726f 6932 203d            roi2 =
-00050a10: 2072 6f69 735b 6964 7832 5d0a 2020 2020   rois[idx2].    
-00050a20: 2020 2020 2020 2020 696e 7465 7273 6563          intersec
-00050a30: 7469 6f6e 2c20 756e 696f 6e2c 206d 6561  tion, union, mea
-00050a40: 6e5f 7369 7a65 203d 2028 0a20 2020 2020  n_size = (.     
-00050a50: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00050a60: 6f69 312e 6765 745f 696e 7465 7273 6563  oi1.get_intersec
-00050a70: 7469 6f6e 5f75 6e69 6f6e 5f73 697a 6528  tion_union_size(
-00050a80: 726f 6932 2c20 7369 6e67 6c65 5f73 6c69  roi2, single_sli
-00050a90: 6365 2c0a 2020 2020 2020 2020 2020 2020  ce,.            
-00050aa0: 2020 2020 2020 2020 2020 2020 7669 6577              view
-00050ab0: 2c20 736c 2c20 6964 782c 2070 6f73 2c20  , sl, idx, pos, 
-00050ac0: 6d65 7468 6f64 2c20 666c 6174 7465 6e29  method, flatten)
-00050ad0: 290a 2020 2020 2020 2020 2020 2020 6e75  ).            nu
-00050ae0: 6d65 7261 746f 7220 2b3d 2069 6e74 6572  merator += inter
-00050af0: 7365 6374 696f 6e0a 2020 2020 2020 2020  section.        
-00050b00: 2020 2020 6465 6e6f 6d69 6e61 746f 7220      denominator 
-00050b10: 2b3d 2075 6e69 6f6e 0a20 2020 2020 2020  += union.       
-00050b20: 2020 2020 2063 692e 7061 6972 7320 2b3d       ci.pairs +=
-00050b30: 2069 6e74 6572 7365 6374 696f 6e20 2f20   intersection / 
-00050b40: 756e 696f 6e0a 2020 2020 2020 2020 2020  union.          
-00050b50: 2020 6e5f 7061 6972 202b 3d20 310a 0a20    n_pair += 1.. 
-00050b60: 2020 2063 692e 6765 6e20 3d20 6e75 6d65     ci.gen = nume
-00050b70: 7261 746f 7220 2f20 6465 6e6f 6d69 6e61  rator / denomina
-00050b80: 746f 720a 2020 2020 6369 2e70 6169 7273  tor.    ci.pairs
-00050b90: 202f 3d20 6e5f 7061 6972 0a0a 2020 2020   /= n_pair..    
-00050ba0: 2320 4465 616c 2077 6974 6820 6361 7365  # Deal with case
-00050bb0: 2022 636f 6d6d 6f6e 222e 0a20 2020 2023   "common"..    #
-00050bc0: 0a20 2020 2023 2054 6865 2063 6f6e 666f  .    # The confo
-00050bd0: 726d 6974 7920 696e 6465 7820 6973 2063  rmity index is c
-00050be0: 616c 6375 6c61 7465 6420 6173 2074 6865  alculated as the
-00050bf0: 2072 6174 696f 206f 660a 2020 2020 2320   ratio of.    # 
-00050c00: 2831 2920 7468 6520 636f 6d6d 6f6e 2069  (1) the common i
-00050c10: 6e74 6572 7365 6374 696f 6e20 6f66 2061  ntersection of a
-00050c20: 6c6c 2052 4f49 7320 746f 2028 3229 2074  ll ROIs to (2) t
-00050c30: 6865 2063 6f6d 6269 6e65 6420 756e 696f  he combined unio
-00050c40: 6e0a 2020 2020 2320 6f66 2061 6c6c 2052  n.    # of all R
-00050c50: 4f49 732e 0a20 2020 2069 6620 3220 3d3d  OIs..    if 2 ==
-00050c60: 206c 656e 2872 6f69 7329 3a0a 2020 2020   len(rois):.    
-00050c70: 2020 2020 696e 7465 7273 6563 7469 6f6e      intersection
-00050c80: 2c20 756e 696f 6e2c 206d 6561 6e5f 7369  , union, mean_si
-00050c90: 7a65 203d 2028 0a20 2020 2020 2020 2020  ze = (.         
-00050ca0: 2020 2020 2020 2072 6f69 735b 305d 2e67         rois[0].g
-00050cb0: 6574 5f69 6e74 6572 7365 6374 696f 6e5f  et_intersection_
-00050cc0: 756e 696f 6e5f 7369 7a65 2872 6f69 735b  union_size(rois[
-00050cd0: 315d 2c20 7369 6e67 6c65 5f73 6c69 6365  1], single_slice
-00050ce0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00050cf0: 2020 2020 2020 2020 2020 7669 6577 2c20            view, 
-00050d00: 736c 2c20 6964 782c 2070 6f73 2c20 6d65  sl, idx, pos, me
-00050d10: 7468 6f64 2c20 666c 6174 7465 6e29 290a  thod, flatten)).
-00050d20: 2020 2020 2020 2020 6369 2e63 6f6d 6d6f          ci.commo
-00050d30: 6e20 3d20 696e 7465 7273 6563 7469 6f6e  n = intersection
-00050d40: 202f 2075 6e69 6f6e 0a20 2020 2065 6c73   / union.    els
-00050d50: 653a 0a20 2020 2020 2020 2069 6620 6e6f  e:.        if no
-00050d60: 7420 7369 6e67 6c65 5f73 6c69 6365 3a0a  t single_slice:.
-00050d70: 2020 2020 2020 2020 2020 2020 6d61 736b              mask
-00050d80: 5f69 6e74 6572 7365 6374 696f 6e20 3d20  _intersection = 
-00050d90: 726f 6973 5b30 5d2e 636c 6f6e 6528 292e  rois[0].clone().
-00050da0: 6765 745f 6d61 736b 280a 2020 2020 2020  get_mask(.      
-00050db0: 2020 2020 2020 2020 2020 2020 2020 7669                vi
-00050dc0: 6577 2c20 666c 6174 7465 6e2c 2073 7461  ew, flatten, sta
-00050dd0: 6e64 6172 6469 7365 3d54 7275 6529 0a20  ndardise=True). 
-00050de0: 2020 2020 2020 2020 2020 206d 6173 6b5f             mask_
-00050df0: 756e 696f 6e20 3d20 726f 6973 5b30 5d2e  union = rois[0].
-00050e00: 636c 6f6e 6528 292e 6765 745f 6d61 736b  clone().get_mask
-00050e10: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-00050e20: 2020 2020 2020 7669 6577 2c20 666c 6174        view, flat
-00050e30: 7465 6e2c 2073 7461 6e64 6172 6469 7365  ten, standardise
-00050e40: 3d54 7275 6529 0a20 2020 2020 2020 2065  =True).        e
-00050e50: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-00050e60: 206d 6173 6b5f 696e 7465 7273 6563 7469   mask_intersecti
-00050e70: 6f6e 203d 2072 6f69 735b 305d 2e63 6c6f  on = rois[0].clo
-00050e80: 6e65 2829 2e67 6574 5f73 6c69 6365 280a  ne().get_slice(.
-00050e90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00050ea0: 2020 2020 7669 6577 2c20 736c 2c20 6964      view, sl, id
-00050eb0: 782c 2070 6f73 290a 2020 2020 2020 2020  x, pos).        
-00050ec0: 2020 2020 6d61 736b 5f75 6e69 6f6e 203d      mask_union =
-00050ed0: 2072 6f69 735b 305d 2e63 6c6f 6e65 2829   rois[0].clone()
-00050ee0: 2e67 6574 5f73 6c69 6365 2876 6965 772c  .get_slice(view,
-00050ef0: 2073 6c2c 2069 6478 2c20 706f 7329 0a0a   sl, idx, pos)..
-00050f00: 2020 2020 2020 2020 666f 7220 726f 6920          for roi 
-00050f10: 696e 2072 6f69 735b 313a 5d3a 0a20 2020  in rois[1:]:.   
-00050f20: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
-00050f30: 7369 6e67 6c65 5f73 6c69 6365 3a0a 2020  single_slice:.  
-00050f40: 2020 2020 2020 2020 2020 2020 2020 6d61                ma
-00050f50: 736b 203d 2072 6f69 2e67 6574 5f6d 6173  sk = roi.get_mas
-00050f60: 6b28 7669 6577 2c20 666c 6174 7465 6e2c  k(view, flatten,
-00050f70: 2073 7461 6e64 6172 6469 7365 3d54 7275   standardise=Tru
-00050f80: 6529 0a20 2020 2020 2020 2020 2020 2065  e).            e
-00050f90: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-00050fa0: 2020 2020 206d 6173 6b20 3d20 726f 692e       mask = roi.
-00050fb0: 6765 745f 736c 6963 6528 7669 6577 2c20  get_slice(view, 
-00050fc0: 736c 2c20 6964 782c 2070 6f73 290a 0a20  sl, idx, pos).. 
-00050fd0: 2020 2020 2020 2020 2020 206d 6173 6b5f             mask_
-00050fe0: 696e 7465 7273 6563 7469 6f6e 203d 2028  intersection = (
-00050ff0: 6d61 736b 5f69 6e74 6572 7365 6374 696f  mask_intersectio
-00051000: 6e20 2620 6d61 736b 290a 2020 2020 2020  n & mask).      
-00051010: 2020 2020 2020 6d61 736b 5f75 6e69 6f6e        mask_union
-00051020: 203d 2028 6d61 736b 5f75 6e69 6f6e 207c   = (mask_union |
-00051030: 206d 6173 6b29 0a0a 2020 2020 2020 2020   mask)..        
-00051040: 6369 2e63 6f6d 6d6f 6e20 3d20 6d61 736b  ci.common = mask
-00051050: 5f69 6e74 6572 7365 6374 696f 6e2e 7375  _intersection.su
-00051060: 6d28 2920 2f20 6d61 736b 5f75 6e69 6f6e  m() / mask_union
-00051070: 2e73 756d 2829 0a0a 2020 2020 7265 7475  .sum()..    retu
-00051080: 726e 2067 6574 6174 7472 2863 692c 2063  rn getattr(ci, c
-00051090: 695f 7479 7065 2c20 6369 290a 0a64 6566  i_type, ci)..def
-000510a0: 2067 6574 5f72 6f69 5f73 6c69 6365 2872   get_roi_slice(r
-000510b0: 6f69 2c20 7a5f 6672 6163 7469 6f6e 3d31  oi, z_fraction=1
-000510c0: 2c20 7375 6666 6978 3d4e 6f6e 6529 3a0a  , suffix=None):.
-000510d0: 2020 2020 2222 220a 2020 2020 4765 7420      """.    Get 
-000510e0: 524f 4920 6f62 6a65 6374 2063 6f72 7265  ROI object corre
-000510f0: 7370 6f6e 6469 6e67 2074 6f20 782d 7920  sponding to x-y 
-00051100: 736c 6963 6520 7468 726f 7567 6820 696e  slice through in
-00051110: 7075 7420 524f 492e 0a0a 2020 2020 2a2a  put ROI...    **
-00051120: 5061 7261 6d65 7465 7273 3a2a 2a0a 0a20  Parameters:**.. 
-00051130: 2020 2072 6f69 203a 2073 6b72 742e 7374     roi : skrt.st
-00051140: 7275 6374 7572 6573 2e52 4f49 0a20 2020  ructures.ROI.   
-00051150: 2020 2020 2052 4f49 206f 626a 6563 7420       ROI object 
-00051160: 666f 7220 7768 6963 6820 736c 6963 6520  for which slice 
-00051170: 6973 2074 6f20 6265 206f 6274 6169 6e65  is to be obtaine
-00051180: 642e 0a0a 2020 2020 7a5f 6672 6163 7469  d...    z_fracti
-00051190: 6f6e 203a 2066 6c6f 6174 2c20 6465 6661  on : float, defa
-000511a0: 756c 743d 310a 2020 2020 2020 2020 506f  ult=1.        Po
-000511b0: 7369 7469 6f6e 2061 6c6f 6e67 207a 2061  sition along z a
-000511c0: 7869 7320 6174 2077 6869 6368 2074 6f20  xis at which to 
-000511d0: 7461 6b65 2073 6c69 6365 2074 6872 6f75  take slice throu
-000511e0: 6768 2052 4f49 2e0a 2020 2020 2020 2020  gh ROI..        
-000511f0: 5468 6520 706f 7369 7469 6f6e 2069 7320  The position is 
-00051200: 7370 6563 6966 6965 6420 6173 2074 6865  specified as the
-00051210: 2066 7261 6374 696f 6e61 6c20 6469 7374   fractional dist
-00051220: 616e 6365 0a20 2020 2020 2020 2066 726f  ance.        fro
-00051230: 6d20 7468 6520 524f 4927 7320 6d6f 7374  m the ROI's most
-00051240: 2d69 6e66 6572 696f 7220 706f 696e 743a  -inferior point:
-00051250: 2030 2063 6f72 7265 7370 6f6e 6473 2074   0 corresponds t
-00051260: 6f0a 2020 2020 2020 2020 7468 6520 6d6f  o.        the mo
-00051270: 7374 2d69 6e66 6572 696f 7220 706f 696e  st-inferior poin
-00051280: 7420 286c 6f77 6573 7420 7a29 3b20 3120  t (lowest z); 1 
-00051290: 636f 7272 6573 706f 6e64 7320 746f 2074  corresponds to t
-000512a0: 6865 0a20 2020 2020 2020 206d 6f73 742d  he.        most-
-000512b0: 7375 7065 7269 6f72 2070 6f69 6e74 2028  superior point (
-000512c0: 6869 6768 6573 7420 7a29 2e20 2056 616c  highest z).  Val
-000512d0: 7565 7320 666f 7220 7a5f 6672 6163 7469  ues for z_fracti
-000512e0: 6f6e 0a20 2020 2020 2020 206f 7574 7369  on.        outsi
-000512f0: 6465 2074 6865 2069 6e74 6572 7661 6c20  de the interval 
-00051300: 5b30 2c20 315d 2072 6573 756c 7420 696e  [0, 1] result in
-00051310: 2061 2052 756e 7469 6d65 4572 726f 722e   a RuntimeError.
-00051320: 0a0a 2020 2020 7375 6666 6978 203a 2073  ..    suffix : s
-00051330: 7472 2c20 6465 6661 756c 743d 4e6f 6e65  tr, default=None
-00051340: 0a20 2020 2020 2020 2053 7566 6669 7820  .        Suffix 
-00051350: 746f 2061 7070 656e 6420 746f 206e 616d  to append to nam
-00051360: 6520 6f66 2069 6e70 7574 2052 4f49 2c20  e of input ROI, 
-00051370: 746f 2066 6f72 6d20 6e61 6d65 0a20 2020  to form name.   
-00051380: 2020 2020 206f 6620 6f75 7470 7574 2052       of output R
-00051390: 4f49 2e20 2049 6620 4e6f 6e65 2c20 6170  OI.  If None, ap
-000513a0: 7065 6e64 207a 5f66 7261 6374 696f 6e2c  pend z_fraction,
-000513b0: 2077 6974 6820 7661 6c75 650a 2020 2020   with value.    
-000513c0: 2020 2020 6769 7665 6e20 746f 2074 776f      given to two
-000513d0: 2064 6563 696d 616c 2070 6c61 6365 732e   decimal places.
-000513e0: 0a20 2020 2022 2222 0a20 2020 2023 2043  .    """.    # C
-000513f0: 6865 636b 2074 6861 7420 7a5f 6672 6163  heck that z_frac
-00051400: 7469 6f6e 2069 7320 696e 2061 6c6c 6f77  tion is in allow
-00051410: 6564 2069 6e74 6572 7661 6c2e 0a20 2020  ed interval..   
-00051420: 2069 6620 7a5f 6672 6163 7469 6f6e 203c   if z_fraction <
-00051430: 2030 206f 7220 7a5f 6672 6163 7469 6f6e   0 or z_fraction
-00051440: 203e 2031 3a0a 2020 2020 2020 2020 7261   > 1:.        ra
-00051450: 6973 6520 5275 6e74 696d 6545 7272 6f72  ise RuntimeError
-00051460: 2866 227a 5f66 7261 6374 696f 6e3d 7b7a  (f"z_fraction={z
-00051470: 5f66 7261 6374 696f 6e7d 220a 2020 2020  _fraction}".    
-00051480: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00051490: 2020 2020 2020 2020 2220 6f75 7473 6964          " outsid
-000514a0: 6520 616c 6c6f 7765 6420 696e 7465 7276  e allowed interv
-000514b0: 616c 205b 302c 2031 5d22 290a 0a20 2020  al [0, 1]")..   
-000514c0: 2023 2044 6574 6572 6d69 6e65 2074 6865   # Determine the
-000514d0: 2069 6e64 6578 206f 6620 7468 6520 696d   index of the im
-000514e0: 6167 6520 736c 6963 6520 6174 2077 6869  age slice at whi
-000514f0: 6368 2074 6f20 7461 6b65 2052 4f49 2073  ch to take ROI s
-00051500: 6c69 6365 2e0a 2020 2020 706f 7331 2c20  lice..    pos1, 
-00051510: 706f 7332 203d 2072 6f69 2e67 6574 5f65  pos2 = roi.get_e
-00051520: 7874 656e 7428 290a 2020 2020 706f 7320  xtent().    pos 
-00051530: 3d20 706f 7331 202b 207a 5f66 7261 6374  = pos1 + z_fract
-00051540: 696f 6e20 2a20 2870 6f73 3220 2d20 706f  ion * (pos2 - po
-00051550: 7331 290a 2020 2020 6964 7820 3d20 726f  s1).    idx = ro
-00051560: 692e 706f 735f 746f 5f69 6478 2870 6f73  i.pos_to_idx(pos
-00051570: 2c20 227a 2229 0a0a 2020 2020 2320 4f62  , "z")..    # Ob
-00051580: 7461 696e 2063 6f6e 746f 7572 7320 666f  tain contours fo
-00051590: 7220 7265 7175 6972 6564 2073 6c69 6365  r required slice
-000515a0: 2c20 616e 6420 636f 6e76 6572 7420 746f  , and convert to
-000515b0: 2052 4f49 206f 626a 6563 742e 0a20 2020   ROI object..   
-000515c0: 2063 6f6e 746f 7572 7320 3d20 726f 692e   contours = roi.
-000515d0: 6765 745f 636f 6e74 6f75 7273 2869 6478  get_contours(idx
-000515e0: 5f61 735f 6b65 793d 5472 7565 295b 6964  _as_key=True)[id
-000515f0: 785d 0a20 2020 2072 6f69 5f73 6c69 6365  x].    roi_slice
-00051600: 203d 2052 4f49 287b 726f 692e 6964 785f   = ROI({roi.idx_
-00051610: 746f 5f70 6f73 2869 6478 2c20 227a 2229  to_pos(idx, "z")
-00051620: 3a20 636f 6e74 6f75 7273 7d29 0a0a 2020  : contours})..  
-00051630: 2020 7375 6666 6978 203d 2066 227b 7a5f    suffix = f"{z_
-00051640: 6672 6163 7469 6f6e 3a2e 3266 7d22 2069  fraction:.2f}" i
-00051650: 6620 7375 6666 6978 2069 7320 4e6f 6e65  f suffix is None
-00051660: 2065 6c73 6520 7375 6666 6978 0a20 2020   else suffix.   
-00051670: 2069 6620 7375 6666 6978 3a0a 2020 2020   if suffix:.    
-00051680: 2020 2020 726f 695f 736c 6963 652e 6e61      roi_slice.na
-00051690: 6d65 203d 2066 227b 726f 692e 6e61 6d65  me = f"{roi.name
-000516a0: 7d5f 7b73 7566 6669 787d 220a 2020 2020  }_{suffix}".    
-000516b0: 656c 7365 3a0a 2020 2020 2020 2020 726f  else:.        ro
-000516c0: 695f 736c 6963 652e 6e61 6d65 203d 2073  i_slice.name = s
-000516d0: 7472 2872 6f69 2e6e 616d 6529 0a0a 2020  tr(roi.name)..  
-000516e0: 2020 7265 7475 726e 2072 6f69 5f73 6c69    return roi_sli
-000516f0: 6365 0a0a 6465 6620 6765 745f 6d65 7472  ce..def get_metr
-00051700: 6963 5f6d 6574 686f 6428 6d65 7472 6963  ic_method(metric
-00051710: 293a 0a20 2020 2022 2222 0a20 2020 204d  ):.    """.    M
-00051720: 6170 2062 6574 7765 656e 206d 6574 7269  ap between metri
-00051730: 6320 6964 656e 7469 6669 6572 2061 7320  c identifier as 
-00051740: 6c69 7374 6564 2069 6e20 6765 745f 636f  listed in get_co
-00051750: 6d70 6172 6973 6f6e 5f6d 6574 7269 6373  mparison_metrics
-00051760: 2829 0a20 2020 2061 6e64 206e 616d 6520  ().    and name 
-00051770: 6f66 2052 4f49 206d 6574 686f 6420 666f  of ROI method fo
-00051780: 7220 6361 6c63 756c 6174 696e 6720 7468  r calculating th
-00051790: 6520 6d65 7472 6963 2e0a 2020 2020 0a20  e metric..    . 
-000517a0: 2020 2054 6869 7320 6675 6e63 7469 6f6e     This function
-000517b0: 2069 7320 7573 6564 2069 6e20 524f 492e   is used in ROI.
-000517c0: 6765 745f 6d65 7472 6963 5f62 795f 736c  get_metric_by_sl
-000517d0: 6963 6528 2920 746f 2064 6574 6572 6d69  ice() to determi
-000517e0: 6e65 0a20 2020 2074 6865 206d 6574 686f  ne.    the metho
-000517f0: 6420 746f 2062 6520 6361 6c6c 6564 2066  d to be called f
-00051800: 6f72 2065 6163 6820 6d65 7472 6963 2e0a  or each metric..
-00051810: 2020 2020 2222 220a 2020 2020 2320 4b65      """.    # Ke
-00051820: 7973 2061 7265 206d 6574 7269 6320 6964  ys are metric id
-00051830: 656e 7469 6669 6572 733b 2076 616c 7565  entifiers; value
-00051840: 7320 6172 6520 6e61 6d65 7320 6f66 2052  s are names of R
-00051850: 4f49 206d 6574 686f 6473 0a20 2020 2023  OI methods.    #
-00051860: 2066 6f72 206d 6574 7269 6320 6361 6c63   for metric calc
-00051870: 756c 6174 696f 6e2e 0a20 2020 2023 204d  ulation..    # M
-00051880: 6574 7269 6373 2061 7265 2069 6e63 6c75  etrics are inclu
-00051890: 6465 6420 696e 2074 6865 2064 6963 7469  ded in the dicti
-000518a0: 6f6e 6172 7920 6f6e 6c79 2069 6620 6964  onary only if id
-000518b0: 656e 7469 6669 6572 2061 6e64 206d 6574  entifier and met
-000518c0: 686f 640a 2020 2020 2320 6e61 6d65 2061  hod.    # name a
-000518d0: 7265 2064 6966 6665 7265 6e74 2e0a 2020  re different..  
-000518e0: 2020 6d61 7070 696e 6773 203d 207b 0a20    mappings = {. 
-000518f0: 2020 2020 2020 2020 2020 2022 6162 735f             "abs_
-00051900: 6365 6e74 726f 6964 223a 2022 6162 735f  centroid": "abs_
-00051910: 6365 6e74 726f 6964 5f64 6973 7461 6e63  centroid_distanc
-00051920: 6522 2c0a 2020 2020 2020 2020 2020 2020  e",.            
-00051930: 2263 656e 7472 6f69 6422 3a20 2263 656e  "centroid": "cen
-00051940: 7472 6f69 645f 6469 7374 616e 6365 222c  troid_distance",
-00051950: 0a20 2020 2020 2020 2020 2020 2022 7265  .            "re
-00051960: 6c5f 6172 6561 5f64 6966 6622 3a20 2272  l_area_diff": "r
-00051970: 656c 6174 6976 655f 6172 6561 5f64 6966  elative_area_dif
-00051980: 6622 2c0a 2020 2020 2020 2020 2020 2020  f",.            
-00051990: 7d0a 2020 2020 7265 7475 726e 206d 6170  }.    return map
-000519a0: 7069 6e67 732e 6765 7428 6d65 7472 6963  pings.get(metric
-000519b0: 2c20 6d65 7472 6963 290a 0a64 6566 2067  , metric)..def g
-000519c0: 6574 5f63 6f6d 7061 7269 736f 6e5f 6d65  et_comparison_me
-000519d0: 7472 6963 7328 6365 6e74 726f 6964 5f63  trics(centroid_c
-000519e0: 6f6d 706f 6e65 6e74 733d 4661 6c73 652c  omponents=False,
-000519f0: 2073 6c69 6365 5f73 7461 7473 3d4e 6f6e   slice_stats=Non
-00051a00: 652c 0a20 2020 2020 2020 2064 6566 6175  e,.        defau
-00051a10: 6c74 5f62 795f 736c 6963 653d 4e6f 6e65  lt_by_slice=None
-00051a20: 2c20 7669 6577 3d22 782d 7922 293a 0a20  , view="x-y"):. 
-00051a30: 2020 2022 2222 0a20 2020 2047 6574 206c     """.    Get l
-00051a40: 6973 7420 6f66 2063 6f6d 7061 7269 736f  ist of compariso
-00051a50: 6e20 6d65 7472 6963 732e 0a0a 2020 2020  n metrics...    
-00051a60: 416c 6c20 6d65 7472 6963 7320 6c69 7374  All metrics list
-00051a70: 6564 2068 6572 6520 7368 6f75 6c64 2062  ed here should b
-00051a80: 6520 7265 636f 676e 6973 6564 2062 7920  e recognised by 
-00051a90: 524f 492e 6765 745f 636f 6d70 6172 6973  ROI.get_comparis
-00051aa0: 6f6e 2829 2c0a 2020 2020 616e 6420 616c  on(),.    and al
-00051ab0: 6c20 6d65 7472 6963 7320 7265 636f 676e  l metrics recogn
-00051ac0: 6973 6564 2062 7920 524f 492e 6765 745f  ised by ROI.get_
-00051ad0: 636f 6d70 6172 6973 6f6e 2829 2073 686f  comparison() sho
-00051ae0: 756c 6420 6265 206c 6973 7465 6420 6865  uld be listed he
-00051af0: 7265 2e0a 0a20 2020 202a 2a50 6172 616d  re...    **Param
-00051b00: 6574 6572 733a 2a2a 0a0a 2020 2020 6365  eters:**..    ce
-00051b10: 6e74 726f 6964 5f63 6f6d 706f 6e65 6e74  ntroid_component
-00051b20: 7320 3a20 626f 6f6c 2c20 6465 6661 756c  s : bool, defaul
-00051b30: 743d 4661 6c73 650a 2020 2020 2020 2020  t=False.        
-00051b40: 4966 2054 7275 652c 2072 6570 6c61 6365  If True, replace
-00051b50: 206d 6574 7269 6373 2022 6365 6e74 726f   metrics "centro
-00051b60: 6964 2220 616e 6420 2263 656e 7472 6f69  id" and "centroi
-00051b70: 645f 736c 6963 6522 2062 7920 7468 650a  d_slice" by the.
-00051b80: 2020 2020 2020 2020 6d65 7472 6963 7320          metrics 
-00051b90: 666f 7220 7468 6569 7220 636f 6d70 6f6e  for their compon
-00051ba0: 656e 7473 2e0a 0a20 2020 2073 6c69 6365  ents...    slice
-00051bb0: 5f73 7461 7473 203a 2073 7472 2f6c 6973  _stats : str/lis
-00051bc0: 742f 6469 6374 2c20 6465 6661 756c 743d  t/dict, default=
-00051bd0: 4e6f 6e65 0a20 2020 2020 2020 2053 7065  None.        Spe
-00051be0: 6369 6669 6361 7469 6f6e 206f 6620 7374  cification of st
-00051bf0: 6174 6973 7469 6373 2074 6f20 6265 2063  atistics to be c
-00051c00: 616c 6375 6c61 7465 6420 7265 6c61 7469  alculated relati
-00051c10: 7665 0a20 2020 2020 2020 2074 6f20 736c  ve.        to sl
-00051c20: 6963 652d 6279 2d73 6c69 6365 206d 6574  ice-by-slice met
-00051c30: 7269 6320 7661 6c75 6573 2e0a 0a20 2020  ric values...   
-00051c40: 2020 2020 2041 2073 7461 7469 7374 6963       A statistic
-00051c50: 2069 7320 7370 6563 6966 6965 6420 6279   is specified by
-00051c60: 2074 6865 206e 616d 6520 6f66 2074 6865   the name of the
-00051c70: 2066 756e 6374 696f 6e20 666f 720a 2020   function for.  
-00051c80: 2020 2020 2020 6974 7320 6361 6c63 756c        its calcul
-00051c90: 6174 696f 6e20 696e 2074 6865 2050 7974  ation in the Pyt
-00051ca0: 686f 6e20 7374 6174 6973 7469 6373 206d  hon statistics m
-00051cb0: 6f64 756c 653a 0a0a 2020 2020 2020 2020  odule:..        
-00051cc0: 6874 7470 733a 2f2f 646f 6373 2e70 7974  https://docs.pyt
-00051cd0: 686f 6e2e 6f72 672f 332f 6c69 6272 6172  hon.org/3/librar
-00051ce0: 792f 7374 6174 6973 7469 6373 2e68 746d  y/statistics.htm
-00051cf0: 6c0a 0a20 2020 2020 2020 2046 6f72 2069  l..        For i
-00051d00: 7473 2075 7365 2068 6572 652c 2074 6865  ts use here, the
-00051d10: 2072 656c 6576 616e 7420 6675 6e63 7469   relevant functi
-00051d20: 6f6e 206d 7573 7420 7265 7175 6972 650a  on must require.
-00051d30: 2020 2020 2020 2020 6120 7369 6e67 6c65          a single
-00051d40: 2d76 6172 6961 626c 6520 696e 7075 742c  -variable input,
-00051d50: 206d 7573 7420 6e6f 7420 7265 7175 6972   must not requir
-00051d60: 6520 616e 7920 6b65 7977 6f72 640a 2020  e any keyword.  
-00051d70: 2020 2020 2020 6172 6775 6d65 6e74 732c        arguments,
-00051d80: 2061 6e64 206d 7573 7420 7265 7475 726e   and must return
-00051d90: 2061 2073 696e 676c 6520 6e75 6d62 6572   a single number
-00051da0: 2e0a 0a20 2020 2020 2020 2041 7661 696c  ...        Avail
-00051db0: 6162 6c65 206f 7074 696f 6e73 2069 6e63  able options inc
-00051dc0: 6c75 6465 3a20 226d 6561 6e22 2c20 226d  lude: "mean", "m
-00051dd0: 6564 6961 6e22 2c20 226d 6f64 6522 2c0a  edian", "mode",.
-00051de0: 2020 2020 2020 2020 2273 7464 6576 222e          "stdev".
-00051df0: 0a0a 2020 2020 2020 2053 7461 7469 7374  ..       Statist
-00051e00: 6963 7320 746f 2062 6520 6361 6c63 756c  ics to be calcul
-00051e10: 6174 6564 2063 616e 2062 6520 7370 6563  ated can be spec
-00051e20: 6966 6965 6420 7573 696e 6720 616e 7920  ified using any 
-00051e30: 6f66 0a20 2020 2020 2020 7468 6520 666f  of.       the fo
-00051e40: 6c6c 6f77 696e 673a 0a0a 2020 2020 2020  llowing:..      
-00051e50: 202d 2053 7472 696e 6720 7370 6563 6966   - String specif
-00051e60: 7969 6e67 2073 696e 676c 6520 7374 6174  ying single stat
-00051e70: 6973 7469 6320 746f 2062 6520 6361 6c63  istic to be calc
-00051e80: 756c 6174 6564 2c0a 2020 2020 2020 2020  ulated,.        
-00051e90: 2077 6974 6820 736c 6963 6573 2063 6f6e   with slices con
-00051ea0: 7369 6465 7265 6420 6173 2067 6976 656e  sidered as given
-00051eb0: 2062 7920 3c64 6566 6175 6c74 5f62 795f   by <default_by_
-00051ec0: 736c 6963 653e 2c0a 2020 2020 2020 2020  slice>,.        
-00051ed0: 2066 6f72 2065 7861 6d70 6c65 3a20 226d   for example: "m
-00051ee0: 6561 6e22 3b0a 2020 2020 2020 202d 204c  ean";.       - L
-00051ef0: 6973 7420 7370 6563 6966 7969 6e67 206d  ist specifying m
-00051f00: 756c 7469 706c 6520 7374 6174 6973 7469  ultiple statisti
-00051f10: 6373 2074 6f20 6265 2063 616c 6375 6c61  cs to be calcula
-00051f20: 7465 642c 0a20 2020 2020 2020 2020 7769  ted,.         wi
-00051f30: 7468 2073 6c69 6365 7320 636f 6e73 6964  th slices consid
-00051f40: 6572 6564 2061 7320 6769 7665 6e20 6279  ered as given by
-00051f50: 203c 6465 6661 756c 745f 6279 5f73 6c69   <default_by_sli
-00051f60: 6365 3e2c 0a20 2020 2020 2020 2020 666f  ce>,.         fo
-00051f70: 7220 6578 616d 706c 653a 205b 226d 6561  r example: ["mea
-00051f80: 6e22 2c20 2273 7464 6576 225d 3b0a 2020  n", "stdev"];.  
-00051f90: 2020 2020 202d 2044 6963 7469 6f6e 6172       - Dictionar
-00051fa0: 7920 7768 6572 6520 6b65 7973 2073 7065  y where keys spe
-00051fb0: 6369 6679 2073 6c69 6365 7320 746f 2062  cify slices to b
-00051fc0: 6520 636f 6e73 6964 6572 6564 2c0a 2020  e considered,.  
-00051fd0: 2020 2020 2020 2061 6e64 2076 616c 7565         and value
-00051fe0: 7320 7370 6563 6966 7920 7374 6174 6973  s specify statis
-00051ff0: 7469 6373 2028 7374 7269 6e67 206f 7220  tics (string or 
-00052000: 6c69 7374 292c 2066 6f72 0a20 2020 2020  list), for.     
-00052010: 2020 2020 6578 616d 706c 653a 207b 2275      example: {"u
-00052020: 6e69 6f6e 223a 205b 226d 6561 6e22 2c20  nion": ["mean", 
-00052030: 2273 7464 6576 225d 7d2e 2020 5661 6c69  "stdev"]}.  Vali
-00052040: 6420 736c 6963 650a 2020 2020 2020 2020  d slice.        
-00052050: 2073 7065 6369 6669 6361 7469 6f6e 7320   specifications 
-00052060: 6172 6520 6173 206c 6973 7465 6420 666f  are as listed fo
-00052070: 7220 3c64 6566 6175 6c74 5f62 795f 736c  r <default_by_sl
-00052080: 6963 653e 2e0a 0a20 2020 2064 6566 6175  ice>...    defau
-00052090: 6c74 5f62 795f 736c 6963 653a 2073 7472  lt_by_slice: str
-000520a0: 2c20 6465 6661 756c 743d 4e6f 6e65 0a20  , default=None. 
-000520b0: 2020 2020 2020 2044 6566 6175 6c74 2073         Default s
-000520c0: 7065 6369 6669 6361 7469 6f6e 206f 6620  pecification of 
-000520d0: 736c 6963 6573 2074 6f20 6265 2063 6f6e  slices to be con
-000520e0: 7369 6465 7265 6420 7768 656e 0a20 2020  sidered when.   
-000520f0: 2020 2020 2063 616c 6375 6c61 7469 6e67       calculating
-00052100: 2073 6c69 6365 2d62 792d 736c 6963 6520   slice-by-slice 
-00052110: 7374 6174 6973 7469 6373 2066 6f72 2061  statistics for a
-00052120: 206d 6574 7269 6320 636f 6d70 6172 696e   metric comparin
-00052130: 670a 2020 2020 2020 2020 7477 6f20 524f  g.        two RO
-00052140: 4973 2c20 726f 6931 2061 6e64 2072 6f69  Is, roi1 and roi
-00052150: 322e 2020 5468 6520 7661 6c69 6420 7370  2.  The valid sp
-00052160: 6563 6966 6963 6174 696f 6e73 2061 7265  ecifications are
-00052170: 3a0a 0a20 2020 2020 2020 202d 2022 6c65  :..        - "le
-00052180: 6674 223a 2063 6f6e 7369 6465 7220 6f6e  ft": consider on
-00052190: 6c79 2073 6c69 6365 7320 636f 6e74 6169  ly slices contai
-000521a0: 6e69 6e67 2072 6f69 313b 0a20 2020 2020  ning roi1;.     
-000521b0: 2020 202d 2022 7269 6768 7422 3a20 636f     - "right": co
-000521c0: 6e73 6964 6572 206f 6e6c 7920 736c 6963  nsider only slic
-000521d0: 6573 2063 6f6e 7461 696e 696e 6720 726f  es containing ro
-000521e0: 6932 3b0a 2020 2020 2020 2020 2d20 2275  i2;.        - "u
-000521f0: 6e69 6f6e 223a 2063 6f6e 7369 6465 7220  nion": consider 
-00052200: 736c 6963 6573 2063 6f6e 7461 696e 696e  slices containin
-00052210: 6720 6569 7468 6572 206f 6620 726f 6931  g either of roi1
-00052220: 2061 6e64 2072 6f69 323b 0a20 2020 2020   and roi2;.     
-00052230: 2020 202d 2022 696e 7465 7273 6563 7469     - "intersecti
-00052240: 6f6e 223a 2063 6f6e 7369 6465 7220 736c  on": consider sl
-00052250: 6963 6573 2063 6f6e 7461 696e 696e 6720  ices containing 
-00052260: 626f 7468 2072 6f69 3120 616e 6420 726f  both roi1 and ro
-00052270: 6932 2e0a 0a20 2020 2020 2020 2049 6620  i2...        If 
-00052280: 4e6f 6e65 2c20 7573 6520 736b 7274 2e63  None, use skrt.c
-00052290: 6f72 652e 4465 6661 756c 7473 2829 2e62  ore.Defaults().b
-000522a0: 795f 736c 6963 650a 0a20 2020 2020 2020  y_slice..       
-000522b0: 2076 6965 7720 3a20 7374 722c 2064 6566   view : str, def
-000522c0: 6175 6c74 3d22 782d 7922 0a20 2020 2020  ault="x-y".     
-000522d0: 2020 2020 2020 204f 7269 656e 7461 7469         Orientati
-000522e0: 6f6e 2074 6f20 636f 6e73 6964 6572 2077  on to consider w
-000522f0: 6865 6e20 7461 6b69 6e67 2063 656e 7472  hen taking centr
-00052300: 6f69 6420 636f 6d70 6f6e 656e 7473 2072  oid components r
-00052310: 656c 6174 6976 650a 2020 2020 2020 2020  elative.        
-00052320: 2020 2020 746f 2061 2073 6c69 6365 2e20      to a slice. 
-00052330: 2043 616e 2062 6520 2278 2d79 222c 2022   Can be "x-y", "
-00052340: 792d 7a22 2c20 6f72 2022 782d 7a22 2e0a  y-z", or "x-z"..
-00052350: 2020 2020 2222 220a 2020 2020 6d65 7472      """.    metr
-00052360: 6963 7320 3d20 5b0a 2020 2020 2020 2020  ics = [.        
-00052370: 2020 2020 2261 6273 5f63 656e 7472 6f69      "abs_centroi
-00052380: 6422 2c0a 2020 2020 2020 2020 2020 2020  d",.            
-00052390: 2261 6273 5f63 656e 7472 6f69 645f 666c  "abs_centroid_fl
-000523a0: 6174 222c 0a20 2020 2020 2020 2020 2020  at",.           
-000523b0: 2022 6162 735f 6365 6e74 726f 6964 5f73   "abs_centroid_s
-000523c0: 6c69 6365 222c 0a20 2020 2020 2020 2020  lice",.         
-000523d0: 2020 2022 6162 735f 6365 6e74 726f 6964     "abs_centroid
-000523e0: 5f73 6c69 6365 5f73 7461 7473 222c 0a20  _slice_stats",. 
-000523f0: 2020 2020 2020 2020 2020 2022 6172 6561             "area
-00052400: 5f64 6966 6622 2c0a 2020 2020 2020 2020  _diff",.        
-00052410: 2020 2020 2261 7265 615f 6469 6666 5f66      "area_diff_f
-00052420: 6c61 7422 2c0a 2020 2020 2020 2020 2020  lat",.          
-00052430: 2020 2261 7265 615f 6469 6666 5f73 6c69    "area_diff_sli
-00052440: 6365 5f73 7461 7473 222c 0a20 2020 2020  ce_stats",.     
-00052450: 2020 2020 2020 2022 6172 6561 5f72 6174         "area_rat
-00052460: 696f 222c 0a20 2020 2020 2020 2020 2020  io",.           
-00052470: 2022 6172 6561 5f72 6174 696f 5f66 6c61   "area_ratio_fla
-00052480: 7422 2c0a 2020 2020 2020 2020 2020 2020  t",.            
-00052490: 2261 7265 615f 7261 7469 6f5f 736c 6963  "area_ratio_slic
-000524a0: 655f 7374 6174 7322 2c0a 2020 2020 2020  e_stats",.      
-000524b0: 2020 2020 2020 2263 656e 7472 6f69 6422        "centroid"
-000524c0: 2c0a 2020 2020 2020 2020 2020 2020 2263  ,.            "c
-000524d0: 656e 7472 6f69 645f 736c 6963 6522 2c0a  entroid_slice",.
-000524e0: 2020 2020 2020 2020 2020 2020 2263 656e              "cen
-000524f0: 7472 6f69 645f 736c 6963 655f 7374 6174  troid_slice_stat
-00052500: 7322 2c0a 2020 2020 2020 2020 2020 2020  s",.            
-00052510: 2264 6963 6522 2c0a 2020 2020 2020 2020  "dice",.        
-00052520: 2020 2020 2264 6963 655f 666c 6174 222c      "dice_flat",
-00052530: 0a20 2020 2020 2020 2020 2020 2022 6469  .            "di
-00052540: 6365 5f73 6c69 6365 222c 0a20 2020 2020  ce_slice",.     
-00052550: 2020 2020 2020 2022 6469 6365 5f73 6c69         "dice_sli
-00052560: 6365 5f73 7461 7473 222c 0a20 2020 2020  ce_stats",.     
-00052570: 2020 2020 2020 2022 6861 7573 646f 7266         "hausdorf
-00052580: 665f 6469 7374 616e 6365 222c 0a20 2020  f_distance",.   
-00052590: 2020 2020 2020 2020 2022 6861 7573 646f           "hausdo
-000525a0: 7266 665f 6469 7374 616e 6365 5f66 6c61  rff_distance_fla
-000525b0: 7422 2c0a 2020 2020 2020 2020 2020 2020  t",.            
-000525c0: 226a 6163 6361 7264 222c 0a20 2020 2020  "jaccard",.     
-000525d0: 2020 2020 2020 2022 6a61 6363 6172 645f         "jaccard_
-000525e0: 666c 6174 222c 0a20 2020 2020 2020 2020  flat",.         
-000525f0: 2020 2022 6a61 6363 6172 645f 736c 6963     "jaccard_slic
-00052600: 6522 2c0a 2020 2020 2020 2020 2020 2020  e",.            
-00052610: 226a 6163 6361 7264 5f73 6c69 6365 5f73  "jaccard_slice_s
-00052620: 7461 7473 222c 0a20 2020 2020 2020 2020  tats",.         
-00052630: 2020 2022 6d65 616e 5f64 6973 7461 6e63     "mean_distanc
-00052640: 655f 746f 5f63 6f6e 666f 726d 6974 7922  e_to_conformity"
-00052650: 2c0a 2020 2020 2020 2020 2020 2020 226d  ,.            "m
-00052660: 6561 6e5f 6469 7374 616e 6365 5f74 6f5f  ean_distance_to_
-00052670: 636f 6e66 6f72 6d69 7479 5f66 6c61 7422  conformity_flat"
-00052680: 2c0a 2020 2020 2020 2020 2020 2020 226d  ,.            "m
-00052690: 6561 6e5f 7369 676e 6564 5f73 7572 6661  ean_signed_surfa
-000526a0: 6365 5f64 6973 7461 6e63 6522 2c0a 2020  ce_distance",.  
-000526b0: 2020 2020 2020 2020 2020 226d 6561 6e5f            "mean_
-000526c0: 7369 676e 6564 5f73 7572 6661 6365 5f64  signed_surface_d
-000526d0: 6973 7461 6e63 655f 666c 6174 222c 0a20  istance_flat",. 
-000526e0: 2020 2020 2020 2020 2020 2022 6d65 616e             "mean
-000526f0: 5f73 7572 6661 6365 5f64 6973 7461 6e63  _surface_distanc
-00052700: 6522 2c0a 2020 2020 2020 2020 2020 2020  e",.            
-00052710: 226d 6561 6e5f 7375 7266 6163 655f 6469  "mean_surface_di
-00052720: 7374 616e 6365 5f66 6c61 7422 2c0a 2020  stance_flat",.  
-00052730: 2020 2020 2020 2020 2020 226d 6561 6e5f            "mean_
-00052740: 6f76 6572 5f63 6f6e 746f 7572 696e 6722  over_contouring"
-00052750: 2c0a 2020 2020 2020 2020 2020 2020 226d  ,.            "m
-00052760: 6561 6e5f 6f76 6572 5f63 6f6e 746f 7572  ean_over_contour
-00052770: 696e 675f 666c 6174 222c 0a20 2020 2020  ing_flat",.     
-00052780: 2020 2020 2020 2022 6d65 616e 5f75 6e64         "mean_und
-00052790: 6572 5f63 6f6e 746f 7572 696e 6722 2c0a  er_contouring",.
-000527a0: 2020 2020 2020 2020 2020 2020 226d 6561              "mea
-000527b0: 6e5f 756e 6465 725f 636f 6e74 6f75 7269  n_under_contouri
-000527c0: 6e67 5f66 6c61 7422 2c0a 2020 2020 2020  ng_flat",.      
-000527d0: 2020 2020 2020 2272 656c 5f61 7265 615f        "rel_area_
-000527e0: 6469 6666 222c 0a20 2020 2020 2020 2020  diff",.         
-000527f0: 2020 2022 7265 6c5f 6172 6561 5f64 6966     "rel_area_dif
-00052800: 665f 666c 6174 222c 0a20 2020 2020 2020  f_flat",.       
-00052810: 2020 2020 2022 7265 6c5f 6172 6561 5f64       "rel_area_d
-00052820: 6966 665f 736c 6963 655f 7374 6174 7322  iff_slice_stats"
-00052830: 2c0a 2020 2020 2020 2020 2020 2020 2272  ,.            "r
-00052840: 656c 5f76 6f6c 756d 655f 6469 6666 222c  el_volume_diff",
-00052850: 0a20 2020 2020 2020 2020 2020 2022 726d  .            "rm
-00052860: 735f 7369 676e 6564 5f73 7572 6661 6365  s_signed_surface
-00052870: 5f64 6973 7461 6e63 6522 2c0a 2020 2020  _distance",.    
-00052880: 2020 2020 2020 2020 2272 6d73 5f73 6967          "rms_sig
-00052890: 6e65 645f 7375 7266 6163 655f 6469 7374  ned_surface_dist
-000528a0: 616e 6365 5f66 6c61 7422 2c0a 2020 2020  ance_flat",.    
-000528b0: 2020 2020 2020 2020 2272 6d73 5f73 7572          "rms_sur
-000528c0: 6661 6365 5f64 6973 7461 6e63 6522 2c0a  face_distance",.
-000528d0: 2020 2020 2020 2020 2020 2020 2272 6d73              "rms
-000528e0: 5f73 7572 6661 6365 5f64 6973 7461 6e63  _surface_distanc
-000528f0: 655f 666c 6174 222c 0a20 2020 2020 2020  e_flat",.       
-00052900: 2020 2020 2022 766f 6c75 6d65 5f64 6966       "volume_dif
-00052910: 6622 2c0a 2020 2020 2020 2020 2020 2020  f",.            
-00052920: 2276 6f6c 756d 655f 7261 7469 6f22 2c0a  "volume_ratio",.
-00052930: 2020 2020 2020 2020 2020 2020 5d0a 0a20              ].. 
-00052940: 2020 2023 2052 6570 6c61 6365 2063 656e     # Replace cen
-00052950: 7472 6f69 6420 7665 6374 6f72 7320 6279  troid vectors by
-00052960: 2063 6f6d 706f 6e65 6e74 732e 0a20 2020   components..   
-00052970: 2069 6620 6365 6e74 726f 6964 5f63 6f6d   if centroid_com
-00052980: 706f 6e65 6e74 733a 0a20 2020 2020 2020  ponents:.       
-00052990: 2063 656e 7472 6f69 6473 203d 207b 0a20   centroids = {. 
-000529a0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-000529b0: 6365 6e74 726f 6964 223a 205b 2263 656e  centroid": ["cen
-000529c0: 7472 6f69 645f 7822 2c20 2263 656e 7472  troid_x", "centr
-000529d0: 6f69 645f 7922 2c20 2263 656e 7472 6f69  oid_y", "centroi
-000529e0: 645f 7a22 5d2c 0a20 2020 2020 2020 2020  d_z"],.         
-000529f0: 2020 2020 2020 2022 6365 6e74 726f 6964         "centroid
-00052a00: 5f73 6c69 6365 223a 205b 5d0a 2020 2020  _slice": [].    
-00052a10: 2020 2020 2020 2020 2020 2020 7d0a 2020              }.  
-00052a20: 2020 2020 2020 6966 2073 6c69 6365 5f73        if slice_s
-00052a30: 7461 7473 2069 7320 6e6f 7420 4e6f 6e65  tats is not None
-00052a40: 3a0a 2020 2020 2020 2020 2020 2020 6365  :.            ce
-00052a50: 6e74 726f 6964 735b 2263 656e 7472 6f69  ntroids["centroi
-00052a60: 645f 736c 6963 655f 7374 6174 7322 5d20  d_slice_stats"] 
-00052a70: 3d20 5b5d 0a0a 2020 2020 2020 2020 666f  = []..        fo
-00052a80: 7220 695f 6178 2069 6e20 736b 7274 2e69  r i_ax in skrt.i
-00052a90: 6d61 6765 2e5f 706c 6f74 5f61 7865 735b  mage._plot_axes[
-00052aa0: 7669 6577 5d3a 0a20 2020 2020 2020 2020  view]:.         
-00052ab0: 2020 2061 7820 3d20 736b 7274 2e69 6d61     ax = skrt.ima
-00052ac0: 6765 2e5f 6178 6573 5b69 5f61 785d 0a20  ge._axes[i_ax]. 
-00052ad0: 2020 2020 2020 2020 2020 2063 656e 7472             centr
-00052ae0: 6f69 6473 5b22 6365 6e74 726f 6964 5f73  oids["centroid_s
-00052af0: 6c69 6365 225d 2e61 7070 656e 6428 6622  lice"].append(f"
-00052b00: 6365 6e74 726f 6964 5f73 6c69 6365 5f7b  centroid_slice_{
-00052b10: 6178 7d22 290a 0a20 2020 2020 2020 2020  ax}")..         
-00052b20: 2020 2069 6620 736c 6963 655f 7374 6174     if slice_stat
-00052b30: 7320 6973 206e 6f74 204e 6f6e 653a 0a20  s is not None:. 
-00052b40: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-00052b50: 656e 7472 6f69 6473 5b22 6365 6e74 726f  entroids["centro
-00052b60: 6964 5f73 6c69 6365 5f73 7461 7473 225d  id_slice_stats"]
-00052b70: 2e61 7070 656e 6428 0a20 2020 2020 2020  .append(.       
-00052b80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00052b90: 2066 2263 656e 7472 6f69 645f 7b61 787d   f"centroid_{ax}
-00052ba0: 5f73 6c69 6365 5f73 7461 7473 2229 0a0a  _slice_stats")..
-00052bb0: 2020 2020 2020 2020 666f 7220 7665 6374          for vect
-00052bc0: 6f72 2c20 636f 6d70 6f6e 656e 7473 2069  or, components i
-00052bd0: 6e20 6365 6e74 726f 6964 732e 6974 656d  n centroids.item
-00052be0: 7328 293a 0a20 2020 2020 2020 2020 2020  s():.           
-00052bf0: 2069 6478 203d 206d 6574 7269 6373 2e69   idx = metrics.i
-00052c00: 6e64 6578 2876 6563 746f 7229 0a20 2020  ndex(vector).   
-00052c10: 2020 2020 2020 2020 206d 6574 7269 6373           metrics
-00052c20: 5b69 6478 203a 2069 6478 202b 2031 5d20  [idx : idx + 1] 
-00052c30: 3d20 636f 6d70 6f6e 656e 7473 0a0a 2020  = components..  
-00052c40: 2020 2320 5265 6d6f 7665 206d 6574 7269    # Remove metri
-00052c50: 6373 2077 6974 6820 7375 6666 6978 2022  cs with suffix "
-00052c60: 736c 6963 655f 7374 6174 7322 2c0a 2020  slice_stats",.  
-00052c70: 2020 2320 616e 6420 7265 706c 6163 6520    # and replace 
-00052c80: 7769 7468 2073 7065 6369 6669 6320 6d65  with specific me
-00052c90: 7472 6963 7320 7265 6c61 7469 6e67 2074  trics relating t
-00052ca0: 6f20 736c 6963 652d 6279 2d73 6c69 6365  o slice-by-slice
-00052cb0: 2073 7461 7469 7374 6963 732e 0a20 2020   statistics..   
-00052cc0: 2069 6620 736c 6963 655f 7374 6174 7320   if slice_stats 
-00052cd0: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
-00052ce0: 2020 2020 2073 6c69 6365 5f73 7461 7473       slice_stats
-00052cf0: 5f6d 6574 7269 6373 203d 205b 5d0a 2020  _metrics = [].  
-00052d00: 2020 2020 2020 6d65 7472 6963 7332 203d        metrics2 =
-00052d10: 205b 5d0a 2020 2020 2020 2020 666f 7220   [].        for 
-00052d20: 6d65 7472 6963 2069 6e20 6d65 7472 6963  metric in metric
-00052d30: 733a 0a20 2020 2020 2020 2020 2020 2069  s:.            i
-00052d40: 6620 2273 6c69 6365 5f73 7461 7473 2220  f "slice_stats" 
-00052d50: 696e 206d 6574 7269 633a 0a20 2020 2020  in metric:.     
-00052d60: 2020 2020 2020 2020 2020 2073 6c69 6365             slice
-00052d70: 5f73 7461 7473 5f6d 6574 7269 6373 2e61  _stats_metrics.a
-00052d80: 7070 656e 6428 6d65 7472 6963 2e73 706c  ppend(metric.spl
-00052d90: 6974 2822 5f73 6c69 6365 5f73 7461 7473  it("_slice_stats
-00052da0: 2229 5b30 5d29 0a20 2020 2020 2020 2020  ")[0]).         
-00052db0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00052dc0: 2020 2020 2020 2020 206d 6574 7269 6373           metrics
-00052dd0: 322e 6170 7065 6e64 286d 6574 7269 6329  2.append(metric)
-00052de0: 0a0a 2020 2020 2020 2020 666f 7220 6279  ..        for by
-00052df0: 5f73 6c69 6365 2c20 7374 6174 7320 696e  _slice, stats in
-00052e00: 2028 0a20 2020 2020 2020 2020 2020 2020   (.             
-00052e10: 2020 2065 7870 616e 645f 736c 6963 655f     expand_slice_
-00052e20: 7374 6174 7328 736c 6963 655f 7374 6174  stats(slice_stat
-00052e30: 732c 2064 6566 6175 6c74 5f62 795f 736c  s, default_by_sl
-00052e40: 6963 6529 2e69 7465 6d73 2829 293a 0a20  ice).items()):. 
-00052e50: 2020 2020 2020 2020 2020 2066 6f72 206d             for m
-00052e60: 6574 7269 6320 696e 2073 6c69 6365 5f73  etric in slice_s
-00052e70: 7461 7473 5f6d 6574 7269 6373 3a0a 2020  tats_metrics:.  
-00052e80: 2020 2020 2020 2020 2020 2020 2020 666f                fo
-00052e90: 7220 7374 6174 2069 6e20 7374 6174 733a  r stat in stats:
-00052ea0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00052eb0: 2020 2020 206d 6574 7269 6373 322e 6170       metrics2.ap
-00052ec0: 7065 6e64 2866 227b 6d65 7472 6963 7d5f  pend(f"{metric}_
-00052ed0: 736c 6963 655f 7b62 795f 736c 6963 657d  slice_{by_slice}
-00052ee0: 5f7b 7374 6174 7d22 290a 2020 2020 2020  _{stat}").      
-00052ef0: 2020 6d65 7472 6963 7320 3d20 6d65 7472    metrics = metr
-00052f00: 6963 7332 0a0a 2020 2020 7265 7475 726e  ics2..    return
-00052f10: 2073 6f72 7465 6428 6d65 7472 6963 7329   sorted(metrics)
-00052f20: 0a0a 6465 6620 6765 745f 636f 6e73 656e  ..def get_consen
-00052f30: 7375 735f 7479 7065 7328 293a 0a20 2020  sus_types():.   
-00052f40: 2022 2222 0a20 2020 2047 6574 206c 6973   """.    Get lis
-00052f50: 7420 6f66 2063 6f6e 7365 6e73 7573 2074  t of consensus t
-00052f60: 7970 6573 2e0a 0a20 2020 2041 6c6c 2063  ypes...    All c
-00052f70: 6f6e 7365 6e73 7573 2074 7970 6573 206c  onsensus types l
-00052f80: 6973 7465 6420 6865 7265 2073 686f 756c  isted here shoul
-00052f90: 6420 6265 2072 6563 6f67 6e69 7365 6420  d be recognised 
-00052fa0: 6279 0a20 2020 2053 7472 7563 7475 7265  by.    Structure
-00052fb0: 5365 742e 6765 745f 636f 6e73 656e 7375  Set.get_consensu
-00052fc0: 7328 292c 2061 6e64 2061 6c6c 2063 6f6e  s(), and all con
-00052fd0: 7365 6e73 7573 2074 7970 6573 2072 6563  sensus types rec
-00052fe0: 6f67 6e69 7365 640a 2020 2020 6279 2053  ognised.    by S
-00052ff0: 7472 7563 7475 7265 5365 742e 6765 745f  tructureSet.get_
-00053000: 636f 6e73 656e 7375 7320 7368 6f75 6c64  consensus should
-00053010: 2062 6520 6c69 7374 6564 2068 6572 652e   be listed here.
-00053020: 0a20 2020 2022 2222 0a20 2020 2072 6574  .    """.    ret
-00053030: 7572 6e20 5b0a 2020 2020 2020 2020 2020  urn [.          
-00053040: 2020 226d 616a 6f72 6974 7922 2c0a 2020    "majority",.  
-00053050: 2020 2020 2020 2020 2020 226f 7665 726c            "overl
-00053060: 6170 222c 0a20 2020 2020 2020 2020 2020  ap",.           
-00053070: 2022 7374 6170 6c65 222c 0a20 2020 2020   "staple",.     
-00053080: 2020 2020 2020 2022 7375 6d22 2c0a 2020         "sum",.  
-00053090: 2020 2020 2020 2020 2020 5d0a 0a64 6566            ]..def
-000530a0: 2067 6574 5f62 795f 736c 6963 655f 6d65   get_by_slice_me
-000530b0: 7468 6f64 7328 293a 0a20 2020 2022 2222  thods():.    """
-000530c0: 0a20 2020 2047 6574 206c 6973 7420 6f66  .    Get list of
-000530d0: 206d 6574 686f 6473 2066 6f72 2064 6566   methods for def
-000530e0: 696e 696e 6720 736c 6963 6573 2074 6f20  ining slices to 
-000530f0: 6265 2063 6f6e 7369 6465 7265 640a 2020  be considered.  
-00053100: 2020 666f 7220 736c 6963 652d 6279 2d73    for slice-by-s
-00053110: 6c69 6365 2052 4f49 2063 6f6d 7061 7269  lice ROI compari
-00053120: 736f 6e73 2e0a 2020 2020 2222 220a 2020  sons..    """.  
-00053130: 2020 7265 7475 726e 205b 226c 6566 7422    return ["left"
-00053140: 2c20 2272 6967 6874 222c 2022 756e 696f  , "right", "unio
-00053150: 6e22 2c20 2269 6e74 6572 7365 6374 696f  n", "intersectio
-00053160: 6e22 5d0a 0a64 6566 2067 6574 5f61 6c6c  n"]..def get_all
-00053170: 5f72 6f69 7328 6f62 6a73 3d4e 6f6e 6529  _rois(objs=None)
-00053180: 3a0a 2020 2020 2222 220a 2020 2020 4372  :.    """.    Cr
-00053190: 6561 7465 206c 6973 7420 6f66 2052 4f49  eate list of ROI
-000531a0: 7320 6672 6f6d 2061 7262 6974 7261 7279  s from arbitrary
-000531b0: 2063 6f6d 6269 6e61 7469 6f6e 206f 6620   combination of 
-000531c0: 524f 4973 2061 6e64 2053 7472 7563 7475  ROIs and Structu
-000531d0: 7265 5365 7473 2e0a 0a20 2020 202a 2a50  reSets...    **P
-000531e0: 6172 616d 6574 6572 733a 2a2a 0a0a 2020  arameters:**..  
-000531f0: 2020 6f62 6a73 203a 2052 4f49 2f53 7472    objs : ROI/Str
-00053200: 7563 7475 7265 5365 742f 6c69 7374 2c20  uctureSet/list, 
-00053210: 6465 6661 756c 743d 4e6f 6e65 0a20 2020  default=None.   
-00053220: 2020 2020 204f 626a 6563 7428 7329 2066       Object(s) f
-00053230: 726f 6d20 7768 6963 6820 6120 6c69 7374  rom which a list
-00053240: 206f 6620 524f 4973 2069 7320 746f 2062   of ROIs is to b
-00053250: 6520 6372 6561 7465 642e 2020 5468 650a  e created.  The.
-00053260: 2020 2020 2020 2020 6f62 6a65 6374 2873          object(s
-00053270: 2920 6361 6e20 6265 2061 2073 696e 676c  ) can be a singl
-00053280: 6520 736b 7274 2e73 7472 7563 7475 7265  e skrt.structure
-00053290: 732e 524f 4920 6f62 6a65 6374 2c20 6120  s.ROI object, a 
-000532a0: 7369 6e67 6c65 0a20 2020 2020 2020 2073  single.        s
-000532b0: 6b72 742e 7374 7275 6374 7572 6573 2e53  krt.structures.S
-000532c0: 7472 7563 7475 7265 5365 7420 6f62 6a65  tructureSet obje
-000532d0: 6374 2c20 6f72 2061 206c 6973 7420 636f  ct, or a list co
-000532e0: 6e74 6169 6e69 6e67 2061 6e79 0a20 2020  ntaining any.   
-000532f0: 2020 2020 2063 6f6d 6269 6e61 7469 6f6e       combination
-00053300: 206f 6620 524f 4920 616e 6420 5374 7275   of ROI and Stru
-00053310: 6374 7572 6553 6574 206f 626a 6563 7473  ctureSet objects
-00053320: 2e0a 2020 2020 2222 220a 2020 2020 2320  ..    """.    # 
-00053330: 456e 7375 7265 2074 6861 7420 6f62 6a73  Ensure that objs
-00053340: 2069 7320 6120 6c69 7374 0a20 2020 2069   is a list.    i
-00053350: 6620 6973 7375 6263 6c61 7373 2874 7970  f issubclass(typ
-00053360: 6528 6f62 6a73 292c 2028 524f 492c 2053  e(objs), (ROI, S
-00053370: 7472 7563 7475 7265 5365 7429 293a 0a20  tructureSet)):. 
-00053380: 2020 2020 2020 206f 626a 7320 3d20 5b6f         objs = [o
-00053390: 626a 735d 0a20 2020 2065 6c69 6620 6f62  bjs].    elif ob
-000533a0: 6a73 2069 7320 4e6f 6e65 3a0a 2020 2020  js is None:.    
-000533b0: 2020 2020 6f62 6a73 203d 205b 5d0a 0a20      objs = [].. 
-000533c0: 2020 2023 2043 7265 6174 6520 6120 6c69     # Create a li
-000533d0: 7374 2063 6f6e 7461 696e 696e 6720 616c  st containing al
-000533e0: 6c20 756e 6971 7565 2072 6f69 732e 0a20  l unique rois.. 
-000533f0: 2020 2061 6c6c 5f72 6f69 7320 3d20 5b5d     all_rois = []
-00053400: 0a20 2020 2066 6f72 2069 7465 6d20 696e  .    for item in
-00053410: 206f 626a 733a 0a20 2020 2020 2020 2069   objs:.        i
-00053420: 6620 6973 7375 6263 6c61 7373 2874 7970  f issubclass(typ
-00053430: 6528 6974 656d 292c 2052 4f49 293a 0a20  e(item), ROI):. 
-00053440: 2020 2020 2020 2020 2020 2063 616e 6469             candi
-00053450: 6461 7465 5f72 6f69 7320 3d20 5b69 7465  date_rois = [ite
-00053460: 6d5d 0a20 2020 2020 2020 2065 6c69 6620  m].        elif 
-00053470: 6973 7375 6263 6c61 7373 2874 7970 6528  issubclass(type(
-00053480: 6974 656d 292c 2053 7472 7563 7475 7265  item), Structure
-00053490: 5365 7429 3a0a 2020 2020 2020 2020 2020  Set):.          
-000534a0: 2020 6361 6e64 6964 6174 655f 726f 6973    candidate_rois
-000534b0: 203d 2069 7465 6d2e 6765 745f 726f 6973   = item.get_rois
-000534c0: 2829 0a20 2020 2020 2020 2066 6f72 2072  ().        for r
-000534d0: 6f69 2069 6e20 6361 6e64 6964 6174 655f  oi in candidate_
-000534e0: 726f 6973 3a0a 2020 2020 2020 2020 2020  rois:.          
-000534f0: 2020 6966 206e 6f74 2072 6f69 2069 6e20    if not roi in 
-00053500: 616c 6c5f 726f 6973 3a0a 2020 2020 2020  all_rois:.      
-00053510: 2020 2020 2020 2020 2020 616c 6c5f 726f            all_ro
-00053520: 6973 2e61 7070 656e 6428 726f 6929 0a0a  is.append(roi)..
-00053530: 2020 2020 7265 7475 726e 2061 6c6c 5f72      return all_r
-00053540: 6f69 730a 0a64 6566 2067 6574 5f74 7261  ois..def get_tra
-00053550: 6e73 6c61 7469 6f6e 5f74 6f5f 616c 6967  nslation_to_alig
-00053560: 6e28 726f 6931 2c20 726f 6932 2c20 7a5f  n(roi1, roi2, z_
-00053570: 6672 6163 7469 6f6e 313d 4e6f 6e65 2c20  fraction1=None, 
-00053580: 7a5f 6672 6163 7469 6f6e 323d 4e6f 6e65  z_fraction2=None
-00053590: 293a 0a20 2020 2022 2222 0a20 2020 2044  ):.    """.    D
-000535a0: 6574 6572 6d69 6e65 2074 7261 6e73 6c61  etermine transla
-000535b0: 7469 6f6e 2066 6f72 2061 6c69 676e 696e  tion for alignin
-000535c0: 6720 3c72 6f69 313e 2074 6f20 3c72 6f69  g <roi1> to <roi
-000535d0: 323e 2e0a 0a20 2020 202a 2a50 6172 616d  2>...    **Param
-000535e0: 6574 6572 733a 2a2a 0a0a 2020 2020 726f  eters:**..    ro
-000535f0: 6931 203a 2052 4f49 2f53 7472 7563 7475  i1 : ROI/Structu
-00053600: 7265 5365 742f 6c69 7374 0a20 2020 2020  reSet/list.     
-00053610: 2020 2052 4f49 2074 6861 7420 6973 2074     ROI that is t
-00053620: 6f20 6265 2074 7261 6e73 6c61 7469 6f6e  o be translation
-00053630: 2074 6f20 6163 6869 6576 6520 7468 6520   to achieve the 
-00053640: 616c 6967 6e6d 656e 742e 2020 5468 6973  alignment.  This
-00053650: 0a20 2020 2020 2020 2063 616e 2062 6520  .        can be 
-00053660: 7370 6563 6966 6965 6420 6469 7265 6374  specified direct
-00053670: 6c79 2061 7320 6120 7369 6e67 6c65 2052  ly as a single R
-00053680: 4f49 2e20 2041 6c74 6572 6e61 7469 7665  OI.  Alternative
-00053690: 6c79 2c0a 2020 2020 2020 2020 6974 2063  ly,.        it c
-000536a0: 616e 2062 6520 6120 5374 7275 6374 7572  an be a Structur
-000536b0: 6553 6574 2c20 6f72 2061 206c 6973 7420  eSet, or a list 
-000536c0: 6f72 2052 4f49 2f53 7472 7563 7475 7265  or ROI/Structure
-000536d0: 5365 7420 6f62 6a65 6374 732c 0a20 2020  Set objects,.   
-000536e0: 2020 2020 2069 6e20 7768 6963 6820 6361       in which ca
-000536f0: 7365 2074 6865 2069 6e64 6976 6964 7561  se the individua
-00053700: 6c20 524f 4973 2077 696c 6c20 6265 2063  l ROIs will be c
-00053710: 6f6d 6269 6e65 642e 0a0a 2020 2020 726f  ombined...    ro
-00053720: 6932 203a 2052 4f49 2f53 7472 7563 7475  i2 : ROI/Structu
-00053730: 7265 5365 742f 6c69 7374 0a20 2020 2020  reSet/list.     
-00053740: 2020 2052 4f49 2077 6974 6820 7768 6963     ROI with whic
-00053750: 6820 616c 6967 6e6d 656e 7420 6973 2074  h alignment is t
-00053760: 6f20 6265 2070 6572 666f 726d 6564 2e20  o be performed. 
-00053770: 2054 6869 7320 6361 6e20 6265 0a20 2020   This can be.   
-00053780: 2020 2020 2073 7065 6369 6669 6564 2064       specified d
-00053790: 6972 6563 746c 7920 6173 2061 2073 696e  irectly as a sin
-000537a0: 676c 6520 524f 492e 2020 416c 7465 726e  gle ROI.  Altern
-000537b0: 6174 6976 656c 792c 2069 7420 6361 6e0a  atively, it can.
-000537c0: 2020 2020 2020 2020 6265 2061 2053 7472          be a Str
-000537d0: 7563 7475 7265 5365 742c 206f 7220 6120  uctureSet, or a 
-000537e0: 6c69 7374 206f 7220 524f 492f 5374 7275  list or ROI/Stru
-000537f0: 6374 7572 6553 6574 206f 626a 6563 7473  ctureSet objects
-00053800: 2c0a 2020 2020 2020 2020 696e 2077 6869  ,.        in whi
-00053810: 6368 2063 6173 6520 7468 6520 696e 6469  ch case the indi
-00053820: 7669 6475 616c 2052 4f49 7320 7769 6c6c  vidual ROIs will
-00053830: 2062 6520 636f 6d62 696e 6564 2e0a 0a20   be combined... 
-00053840: 2020 207a 5f66 7261 6374 696f 6e31 203a     z_fraction1 :
-00053850: 2066 6c6f 6174 2c20 6465 6661 756c 743d   float, default=
-00053860: 4e6f 6e65 0a20 2020 2020 2020 2050 6f73  None.        Pos
-00053870: 6974 696f 6e20 616c 6f6e 6720 7a20 6178  ition along z ax
-00053880: 6973 206f 6620 736c 6963 6520 7468 726f  is of slice thro
-00053890: 7567 6820 3c72 6f69 313e 206f 6e20 7768  ugh <roi1> on wh
-000538a0: 6963 680a 2020 2020 2020 2020 746f 2061  ich.        to a
-000538b0: 6c69 676e 2e20 2049 6620 4e6f 6e65 2c20  lign.  If None, 
-000538c0: 616c 6967 6e6d 656e 7420 6973 2074 6f20  alignment is to 
-000538d0: 7468 6520 6365 6e74 726f 6964 206f 6620  the centroid of 
-000538e0: 7468 650a 2020 2020 2020 2020 7768 6f6c  the.        whol
-000538f0: 6520 524f 4920 766f 6c75 6d65 2e20 204f  e ROI volume.  O
-00053900: 7468 6572 7769 7365 2c20 616c 6967 6e6d  therwise, alignm
-00053910: 656e 7420 6973 2074 6f20 7468 650a 2020  ent is to the.  
-00053920: 2020 2020 2020 6365 6e74 726f 6964 206f        centroid o
-00053930: 6620 7468 6520 736c 6963 6520 6174 2074  f the slice at t
-00053940: 6865 2073 7065 6369 6669 6564 2064 6973  he specified dis
-00053950: 7461 6e63 650a 2020 2020 2020 2020 6672  tance.        fr
-00053960: 6f6d 2074 6865 2052 4f49 2773 206d 6f73  om the ROI's mos
-00053970: 742d 696e 6665 7269 6f72 2070 6f69 6e74  t-inferior point
-00053980: 3a20 3020 636f 7272 6573 706f 6e64 7320  : 0 corresponds 
-00053990: 746f 0a20 2020 2020 2020 2074 6865 206d  to.        the m
-000539a0: 6f73 742d 696e 6665 7269 6f72 2070 6f69  ost-inferior poi
-000539b0: 6e74 2028 6c6f 7765 7374 207a 293b 2031  nt (lowest z); 1
-000539c0: 2063 6f72 7265 7370 6f6e 6473 2074 6f20   corresponds to 
-000539d0: 7468 650a 2020 2020 2020 2020 6d6f 7374  the.        most
-000539e0: 2d73 7570 6572 696f 7220 706f 696e 7420  -superior point 
-000539f0: 2868 6967 6865 7374 207a 292e 2020 5661  (highest z).  Va
-00053a00: 6c75 6573 2066 6f72 207a 5f66 7261 6374  lues for z_fract
-00053a10: 696f 6e0a 2020 2020 2020 2020 6f75 7473  ion.        outs
-00053a20: 6964 6520 7468 6520 696e 7465 7276 616c  ide the interval
-00053a30: 205b 302c 2031 5d20 7265 7375 6c74 2069   [0, 1] result i
-00053a40: 6e20 6120 5275 6e74 696d 6545 7272 6f72  n a RuntimeError
-00053a50: 2e0a 0a20 2020 207a 5f66 7261 6374 696f  ...    z_fractio
-00053a60: 6e32 203a 2066 6c6f 6174 2c20 6465 6661  n2 : float, defa
-00053a70: 756c 743d 4e6f 6e65 0a20 2020 2020 2020  ult=None.       
-00053a80: 2050 6f73 6974 696f 6e20 616c 6f6e 6720   Position along 
-00053a90: 7a20 6178 6973 206f 6620 736c 6963 6520  z axis of slice 
-00053aa0: 7468 726f 7567 6820 3c72 6f69 323e 206f  through <roi2> o
-00053ab0: 6e20 7768 6963 680a 2020 2020 2020 2020  n which.        
-00053ac0: 746f 2061 6c69 676e 2e20 2049 6620 4e6f  to align.  If No
-00053ad0: 6e65 2c20 616c 6967 6e6d 656e 7420 6973  ne, alignment is
-00053ae0: 2074 6f20 7468 6520 6365 6e74 726f 6964   to the centroid
-00053af0: 206f 6620 7468 650a 2020 2020 2020 2020   of the.        
-00053b00: 7768 6f6c 6520 524f 4920 766f 6c75 6d65  whole ROI volume
-00053b10: 2e20 204f 7468 6572 7769 7365 2c20 616c  .  Otherwise, al
-00053b20: 6967 6e6d 656e 7420 6973 2074 6f20 7468  ignment is to th
-00053b30: 650a 2020 2020 2020 2020 6365 6e74 726f  e.        centro
-00053b40: 6964 206f 6620 7468 6520 736c 6963 6520  id of the slice 
-00053b50: 6174 2074 6865 2073 7065 6369 6669 6564  at the specified
-00053b60: 2064 6973 7461 6e63 650a 2020 2020 2020   distance.      
-00053b70: 2020 6672 6f6d 2074 6865 2052 4f49 2773    from the ROI's
-00053b80: 206d 6f73 742d 696e 6665 7269 6f72 2070   most-inferior p
-00053b90: 6f69 6e74 3a20 3020 636f 7272 6573 706f  oint: 0 correspo
-00053ba0: 6e64 7320 746f 0a20 2020 2020 2020 2074  nds to.        t
-00053bb0: 6865 206d 6f73 742d 696e 6665 7269 6f72  he most-inferior
-00053bc0: 2070 6f69 6e74 2028 6c6f 7765 7374 207a   point (lowest z
-00053bd0: 293b 2031 2063 6f72 7265 7370 6f6e 6473  ); 1 corresponds
-00053be0: 2074 6f20 7468 650a 2020 2020 2020 2020   to the.        
-00053bf0: 6d6f 7374 2d73 7570 6572 696f 7220 706f  most-superior po
-00053c00: 696e 7420 2868 6967 6865 7374 207a 292e  int (highest z).
-00053c10: 2020 5661 6c75 6573 2066 6f72 207a 5f66    Values for z_f
-00053c20: 7261 6374 696f 6e0a 2020 2020 2020 2020  raction.        
-00053c30: 6f75 7473 6964 6520 7468 6520 696e 7465  outside the inte
-00053c40: 7276 616c 205b 302c 2031 5d20 7265 7375  rval [0, 1] resu
-00053c50: 6c74 2069 6e20 6120 5275 6e74 696d 6545  lt in a RuntimeE
-00053c60: 7272 6f72 2e0a 2020 2020 2020 2020 2222  rror..        ""
-00053c70: 220a 2020 2020 2320 4372 6561 7465 206c  ".    # Create l
-00053c80: 6973 7420 6f66 2074 776f 2073 696e 676c  ist of two singl
-00053c90: 6520 524f 4973 2e0a 2020 2020 726f 6973  e ROIs..    rois
-00053ca0: 203d 205b 5d0a 2020 2020 666f 7220 726f   = [].    for ro
-00053cb0: 6920 696e 205b 726f 6931 2c20 726f 6932  i in [roi1, roi2
-00053cc0: 5d3a 0a20 2020 2020 2020 2069 6620 6973  ]:.        if is
-00053cd0: 696e 7374 616e 6365 2872 6f69 2c20 524f  instance(roi, RO
-00053ce0: 4929 3a0a 2020 2020 2020 2020 2020 2020  I):.            
-00053cf0: 2320 5374 6f72 6520 7369 6e67 6c65 2052  # Store single R
-00053d00: 4f49 2064 6972 6563 746c 792e 0a20 2020  OI directly..   
-00053d10: 2020 2020 2020 2020 2072 6f69 732e 6170           rois.ap
-00053d20: 7065 6e64 2872 6f69 290a 2020 2020 2020  pend(roi).      
-00053d30: 2020 656c 6966 2069 7369 6e73 7461 6e63    elif isinstanc
-00053d40: 6528 726f 692c 2053 7472 7563 7475 7265  e(roi, Structure
-00053d50: 5365 7429 3a0a 2020 2020 2020 2020 2020  Set):.          
-00053d60: 2020 2320 436f 6d62 696e 6520 524f 4973    # Combine ROIs
-00053d70: 206f 6620 5374 7275 6374 7572 6553 6574   of StructureSet
-00053d80: 2e0a 2020 2020 2020 2020 2020 2020 726f  ..            ro
-00053d90: 6973 2e61 7070 656e 6428 726f 692e 636f  is.append(roi.co
-00053da0: 6d62 696e 655f 726f 6973 2829 290a 2020  mbine_rois()).  
-00053db0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-00053dc0: 2020 2020 2020 2020 2320 436f 6d62 696e          # Combin
-00053dd0: 6520 524f 4973 2066 726f 6d20 6c69 7374  e ROIs from list
-00053de0: 2e0a 2020 2020 2020 2020 2020 2020 726f  ..            ro
-00053df0: 6973 2e61 7070 656e 6428 5374 7275 6374  is.append(Struct
-00053e00: 7572 6553 6574 2867 6574 5f61 6c6c 5f72  ureSet(get_all_r
-00053e10: 6f69 7328 726f 6929 292e 636f 6d62 696e  ois(roi)).combin
-00053e20: 655f 726f 6973 2829 290a 0a20 2020 2023  e_rois())..    #
-00053e30: 2043 616c 6375 6c61 7465 2061 6c69 676e   Calculate align
-00053e40: 6d65 6e74 2070 6f69 6e74 732e 0a20 2020  ment points..   
-00053e50: 2063 656e 7472 6f69 6473 203d 205b 5d0a   centroids = [].
-00053e60: 2020 2020 666f 7220 726f 692c 207a 5f66      for roi, z_f
-00053e70: 7261 6374 696f 6e20 696e 207a 6970 2872  raction in zip(r
-00053e80: 6f69 732c 205b 7a5f 6672 6163 7469 6f6e  ois, [z_fraction
-00053e90: 312c 207a 5f66 7261 6374 696f 6e32 5d29  1, z_fraction2])
-00053ea0: 3a0a 2020 2020 2020 2020 2320 4361 6c63  :.        # Calc
-00053eb0: 756c 6174 6520 6365 6e74 726f 6964 2066  ulate centroid f
-00053ec0: 6f72 2074 6865 2077 686f 6c65 2052 4f49  or the whole ROI
-00053ed0: 2076 6f6c 756d 652e 0a20 2020 2020 2020   volume..       
-00053ee0: 2069 6620 7a5f 6672 6163 7469 6f6e 2069   if z_fraction i
-00053ef0: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
-00053f00: 2020 2020 6365 6e74 726f 6964 732e 6170      centroids.ap
-00053f10: 7065 6e64 2872 6f69 2e67 6574 5f63 656e  pend(roi.get_cen
-00053f20: 7472 6f69 6428 2929 0a20 2020 2020 2020  troid()).       
-00053f30: 2023 2043 616c 6375 6c61 7465 2063 656e   # Calculate cen
-00053f40: 7472 6f69 6420 666f 7220 736c 6963 6520  troid for slice 
-00053f50: 6174 2073 7065 6369 6669 6564 2070 6f73  at specified pos
-00053f60: 6974 696f 6e2e 0a20 2020 2020 2020 2065  ition..        e
-00053f70: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-00053f80: 2063 656e 7472 6f69 6473 2e61 7070 656e   centroids.appen
-00053f90: 6428 726f 692e 6765 745f 726f 695f 736c  d(roi.get_roi_sl
-00053fa0: 6963 6528 7a5f 6672 6163 7469 6f6e 292e  ice(z_fraction).
-00053fb0: 6765 745f 6365 6e74 726f 6964 2829 290a  get_centroid()).
-00053fc0: 0a20 2020 2072 6574 7572 6e20 7475 706c  .    return tupl
-00053fd0: 6528 6365 6e74 726f 6964 735b 315d 202d  e(centroids[1] -
-00053fe0: 2063 656e 7472 6f69 6473 5b30 5d29 0a0a   centroids[0])..
-00053ff0: 6465 6620 6765 745f 736c 6963 655f 706f  def get_slice_po
-00054000: 7369 7469 6f6e 7328 726f 6931 2c20 726f  sitions(roi1, ro
-00054010: 6932 3d4e 6f6e 652c 2076 6965 773d 2278  i2=None, view="x
-00054020: 2d79 222c 2070 6f73 6974 696f 6e5f 6173  -y", position_as
-00054030: 5f69 6478 3d46 616c 7365 2c0a 2020 2020  _idx=False,.    
-00054040: 2020 2020 6d65 7468 6f64 3d4e 6f6e 6529      method=None)
-00054050: 3a0a 2020 2020 2222 220a 2020 2020 4765  :.    """.    Ge
-00054060: 7420 6f72 6465 7265 6420 6c69 7374 206f  t ordered list o
-00054070: 6620 736c 6963 6520 706f 7369 7469 6f6e  f slice position
-00054080: 7320 666f 7220 6569 7468 6572 206f 7220  s for either or 
-00054090: 626f 7468 206f 6620 6120 7061 6972 206f  both of a pair o
-000540a0: 6620 524f 4973 2e0a 0a20 2020 202a 2a50  f ROIs...    **P
-000540b0: 6172 616d 6574 6572 733a 2a2a 0a0a 2020  arameters:**..  
-000540c0: 2020 726f 6931 203a 2073 6b72 742e 7374    roi1 : skrt.st
-000540d0: 7275 6374 7572 6573 2e52 4f49 0a20 2020  ructures.ROI.   
-000540e0: 2020 2020 2052 4f49 2c20 6f72 206f 6e65       ROI, or one
-000540f0: 206f 6620 6120 7061 6972 206f 6620 524f   of a pair of RO
-00054100: 4973 2c20 666f 7220 7768 6963 6820 736c  Is, for which sl
-00054110: 6963 6520 696e 666f 726d 6174 696f 6e20  ice information 
-00054120: 6973 2074 6f0a 2020 2020 2020 2020 6265  is to.        be
-00054130: 206f 6274 6169 6e65 642e 0a0a 2020 2020   obtained...    
-00054140: 726f 6932 203a 2073 6b72 742e 7374 7275  roi2 : skrt.stru
-00054150: 6374 7572 6573 2e52 4f49 2c20 6465 6661  ctures.ROI, defa
-00054160: 756c 743d 4e6f 6e65 0a20 2020 2020 2020  ult=None.       
-00054170: 2049 6620 6e6f 7420 4e6f 6e65 2c20 7365   If not None, se
-00054180: 636f 6e64 2069 6e20 6120 7061 6972 206f  cond in a pair o
-00054190: 6620 524f 4973 2066 6f72 2077 6869 6368  f ROIs for which
-000541a0: 2073 6c69 6365 2069 6e66 6f72 6d61 7469   slice informati
-000541b0: 6f6e 0a20 2020 2020 2020 2069 7320 746f  on.        is to
-000541c0: 2062 6520 6f62 7461 696e 6564 2e0a 0a20   be obtained... 
-000541d0: 2020 2076 6965 7720 3a20 7374 722c 2064     view : str, d
-000541e0: 6566 6175 6c74 3d22 782d 7922 0a20 2020  efault="x-y".   
-000541f0: 2020 2020 2056 6965 7720 696e 2077 6869       View in whi
-00054200: 6368 2074 6f20 6f62 7461 696e 2073 6c69  ch to obtain sli
-00054210: 6365 732e 0a0a 2020 2020 706f 7369 7469  ces...    positi
-00054220: 6f6e 5f61 735f 6964 7820 3a20 626f 6f6c  on_as_idx : bool
-00054230: 2c20 6465 6661 756c 743d 4661 6c73 650a  , default=False.
-00054240: 2020 2020 2020 2020 4966 2054 7275 652c          If True,
-00054250: 2072 6574 7572 6e20 706f 7369 7469 6f6e   return position
-00054260: 7320 6173 2073 6c69 6365 2069 6e64 6963  s as slice indic
-00054270: 6573 3b20 6966 2046 616c 7365 2c0a 2020  es; if False,.  
-00054280: 2020 2020 2020 7265 7475 726e 2070 6f73        return pos
-00054290: 6974 696f 6e73 2061 7320 736c 6963 6520  itions as slice 
-000542a0: 7a2d 636f 6f72 6469 6e61 7465 7320 286d  z-coordinates (m
-000542b0: 6d29 2e0a 0a20 2020 206d 6574 686f 643a  m)...    method:
-000542c0: 2073 7472 2c20 6465 6661 756c 743d 4e6f   str, default=No
-000542d0: 6e65 0a20 2020 2020 2020 2053 7472 696e  ne.        Strin
-000542e0: 6720 7370 6563 6966 7969 6e67 2073 6c69  g specifying sli
-000542f0: 6365 7320 666f 7220 7768 6963 6820 706f  ces for which po
-00054300: 7369 7469 6f6e 7320 6172 6520 746f 2062  sitions are to b
-00054310: 6520 6f62 7461 696e 6564 2c0a 2020 2020  e obtained,.    
-00054320: 2020 2020 666f 7220 524f 4973 2072 6f69      for ROIs roi
-00054330: 312c 2072 6f69 323a 0a0a 2020 2020 2020  1, roi2:..      
-00054340: 2020 2d20 226c 6566 7422 2028 6f72 2072    - "left" (or r
-00054350: 6f69 3220 6973 204e 6f6e 6529 3a20 7265  oi2 is None): re
-00054360: 7475 726e 2070 6f73 6974 696f 6e73 206f  turn positions o
-00054370: 6620 736c 6963 6573 2063 6f6e 7461 696e  f slices contain
-00054380: 696e 6720 726f 6931 3b0a 2020 2020 2020  ing roi1;.      
-00054390: 2020 2d20 2272 6967 6874 223a 2072 6574    - "right": ret
-000543a0: 7572 6e20 706f 7369 7469 6f6e 7320 6f66  urn positions of
-000543b0: 2073 6c69 6365 7320 636f 6e74 6169 6e69   slices containi
-000543c0: 6e67 2072 6f69 323b 0a20 2020 2020 2020  ng roi2;.       
-000543d0: 202d 2022 756e 696f 6e22 3a20 7265 7475   - "union": retu
-000543e0: 726e 2070 6f73 6974 696f 6e73 206f 6620  rn positions of 
-000543f0: 736c 6963 6573 2063 6f6e 7461 696e 696e  slices containin
-00054400: 6720 6569 7468 6572 2072 6f69 3120 6f72  g either roi1 or
-00054410: 2072 6f69 323b 0a20 2020 2020 2020 202d   roi2;.        -
-00054420: 2022 696e 7465 7273 6563 7469 6f6e 223a   "intersection":
-00054430: 2072 6574 7572 6e20 706f 7369 7469 6f6e   return position
-00054440: 7320 6f66 2073 6c69 6365 7320 636f 6e74  s of slices cont
-00054450: 6169 6e69 6e67 2062 6f74 680a 2020 2020  aining both.    
-00054460: 2020 2020 2020 726f 6931 2061 6e64 2072        roi1 and r
-00054470: 6f69 322e 0a0a 2020 2020 2020 2020 4966  oi2...        If
-00054480: 204e 6f6e 652c 2076 616c 7565 206f 6620   None, value of 
-00054490: 736b 7274 2e63 6f72 652e 4465 6661 756c  skrt.core.Defaul
-000544a0: 7473 2829 2e62 795f 736c 6963 6520 6973  ts().by_slice is
-000544b0: 2075 7365 642e 0a20 2020 2022 2222 0a20   used..    """. 
-000544c0: 2020 206d 6574 686f 6420 3d20 6d65 7468     method = meth
-000544d0: 6f64 206f 7220 736b 7274 2e63 6f72 652e  od or skrt.core.
-000544e0: 4465 6661 756c 7473 2829 2e62 795f 736c  Defaults().by_sl
-000544f0: 6963 650a 2020 2020 6966 206d 6574 686f  ice.    if metho
-00054500: 6420 6e6f 7420 696e 2067 6574 5f62 795f  d not in get_by_
-00054510: 736c 6963 655f 6d65 7468 6f64 7328 293a  slice_methods():
-00054520: 0a20 2020 2020 2020 2072 6169 7365 2052  .        raise R
-00054530: 756e 7469 6d65 4572 726f 7228 6622 4d65  untimeError(f"Me
-00054540: 7468 6f64 206d 7573 7420 6265 206f 6e65  thod must be one
-00054550: 206f 6620 7b67 6574 5f62 795f 736c 6963   of {get_by_slic
-00054560: 655f 6d65 7468 6f64 7328 297d 220a 2020  e_methods()}".  
-00054570: 2020 2020 2020 2220 2d20 6e6f 7420 277b        " - not '{
-00054580: 6d65 7468 6f64 7d27 2229 0a0a 2020 2020  method}'")..    
-00054590: 696e 6469 6365 7320 3d20 4e6f 6e65 0a0a  indices = None..
-000545a0: 2020 2020 696e 6469 6365 7331 203d 2072      indices1 = r
-000545b0: 6f69 312e 6765 745f 696e 6469 6365 7328  oi1.get_indices(
-000545c0: 7669 6577 3d76 6965 772c 206d 6574 686f  view=view, metho
-000545d0: 643d 226d 6173 6b22 290a 2020 2020 6966  d="mask").    if
-000545e0: 206e 6f74 2069 7373 7562 636c 6173 7328   not issubclass(
-000545f0: 7479 7065 2872 6f69 3229 2c20 524f 4929  type(roi2), ROI)
-00054600: 206f 7220 226c 6566 7422 203d 3d20 6d65   or "left" == me
-00054610: 7468 6f64 3a0a 2020 2020 2020 2020 696e  thod:.        in
-00054620: 6469 6365 7320 3d20 696e 6469 6365 7331  dices = indices1
-00054630: 0a0a 2020 2020 6966 2069 6e64 6963 6573  ..    if indices
-00054640: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
-00054650: 2020 696e 6469 6365 7332 203d 2072 6f69    indices2 = roi
-00054660: 322e 6765 745f 696e 6469 6365 7328 7669  2.get_indices(vi
-00054670: 6577 3d76 6965 772c 206d 6574 686f 643d  ew=view, method=
-00054680: 226d 6173 6b22 290a 2020 2020 2020 2020  "mask").        
-00054690: 6966 2022 7269 6768 7422 203d 3d20 6d65  if "right" == me
-000546a0: 7468 6f64 3a0a 2020 2020 2020 2020 2020  thod:.          
-000546b0: 2020 696e 6469 6365 7320 3d20 696e 6469    indices = indi
-000546c0: 6365 7332 0a20 2020 2020 2020 200a 2020  ces2.        .  
-000546d0: 2020 6966 2069 6e64 6963 6573 2069 7320    if indices is 
-000546e0: 4e6f 6e65 3a0a 2020 2020 2020 2020 6966  None:.        if
-000546f0: 2022 756e 696f 6e22 203d 3d20 6d65 7468   "union" == meth
-00054700: 6f64 3a0a 2020 2020 2020 2020 2020 2020  od:.            
-00054710: 696e 6469 6365 7320 3d20 6c69 7374 2873  indices = list(s
-00054720: 6574 2869 6e64 6963 6573 3129 2e75 6e69  et(indices1).uni
-00054730: 6f6e 2873 6574 2869 6e64 6963 6573 3229  on(set(indices2)
-00054740: 2929 0a0a 2020 2020 6966 2069 6e64 6963  ))..    if indic
-00054750: 6573 2069 7320 4e6f 6e65 3a0a 2020 2020  es is None:.    
-00054760: 2020 2020 6966 2022 696e 7465 7273 6563      if "intersec
-00054770: 7469 6f6e 2220 3d3d 206d 6574 686f 643a  tion" == method:
-00054780: 0a20 2020 2020 2020 2020 2020 2069 6e64  .            ind
-00054790: 6963 6573 203d 206c 6973 7428 7365 7428  ices = list(set(
-000547a0: 696e 6469 6365 7331 292e 696e 7465 7273  indices1).inters
-000547b0: 6563 7469 6f6e 2873 6574 2869 6e64 6963  ection(set(indic
-000547c0: 6573 3229 2929 0a0a 2020 2020 6966 2069  es2)))..    if i
-000547d0: 6e64 6963 6573 2069 7320 6e6f 7420 4e6f  ndices is not No
-000547e0: 6e65 3a0a 2020 2020 2020 2020 6966 2070  ne:.        if p
-000547f0: 6f73 6974 696f 6e5f 6173 5f69 6478 3a0a  osition_as_idx:.
-00054800: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-00054810: 726e 2073 6f72 7465 6428 696e 6469 6365  rn sorted(indice
-00054820: 7329 0a20 2020 2020 2020 2065 6c73 653a  s).        else:
-00054830: 0a20 2020 2020 2020 2020 2020 2061 7820  .            ax 
-00054840: 3d20 736b 7274 2e69 6d61 6765 2e5f 736c  = skrt.image._sl
-00054850: 6963 655f 6178 6573 5b76 6965 775d 0a20  ice_axes[view]. 
-00054860: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00054870: 6e20 736f 7274 6564 285b 726f 6931 2e69  n sorted([roi1.i
-00054880: 6478 5f74 6f5f 706f 7328 6964 782c 2061  dx_to_pos(idx, a
-00054890: 7829 2066 6f72 2069 6478 2069 6e20 696e  x) for idx in in
-000548a0: 6469 6365 735d 290a 0a64 6566 2065 7870  dices])..def exp
-000548b0: 616e 645f 736c 6963 655f 7374 6174 7328  and_slice_stats(
-000548c0: 736c 6963 655f 7374 6174 733d 4e6f 6e65  slice_stats=None
-000548d0: 2c20 6465 6661 756c 745f 6279 5f73 6c69  , default_by_sli
-000548e0: 6365 3d4e 6f6e 6529 3a0a 2020 2020 2222  ce=None):.    ""
-000548f0: 220a 2020 2020 4578 7061 6e64 2073 7065  ".    Expand spe
-00054900: 6369 6669 6361 7469 6f6e 206f 6620 7374  cification of st
-00054910: 6174 6973 7469 6373 2074 6f20 6361 6c63  atistics to calc
-00054920: 756c 6174 6520 666f 7220 524f 4920 636f  ulate for ROI co
-00054930: 6d70 6172 6973 6f6e 0a20 2020 206d 6574  mparison.    met
-00054940: 7269 6373 2065 7661 6c75 6174 6564 2073  rics evaluated s
-00054950: 6c69 6365 2062 7920 736c 6963 652e 0a0a  lice by slice...
-00054960: 2020 2020 4120 6469 6374 696f 6e61 7279      A dictionary
-00054970: 2069 7320 7265 7475 726e 6564 2c20 7768   is returned, wh
-00054980: 6572 6520 6b65 7973 2067 6976 6520 7468  ere keys give th
-00054990: 6520 736c 6963 6573 2074 6f20 6265 2063  e slices to be c
-000549a0: 6f6e 7369 6465 7265 640a 2020 2020 666f  onsidered.    fo
-000549b0: 7220 6361 6c63 756c 6174 696e 6720 7374  r calculating st
-000549c0: 6174 6973 7469 6373 2c20 616e 6420 7661  atistics, and va
-000549d0: 6c75 6573 2061 7265 206c 6973 7473 206f  lues are lists o
-000549e0: 6620 6d65 7472 6963 732e 0a0a 2020 2020  f metrics...    
-000549f0: 2a2a 5061 7261 6d65 7465 7273 3a2a 2a0a  **Parameters:**.
-00054a00: 0a20 2020 2073 6c69 6365 5f73 7461 7473  .    slice_stats
-00054a10: 203a 2073 7472 2f6c 6973 742f 6469 6374   : str/list/dict
-00054a20: 2c20 6465 6661 756c 743d 4e6f 6e65 0a20  , default=None. 
-00054a30: 2020 2020 2020 2053 7065 6369 6669 6361         Specifica
-00054a40: 7469 6f6e 206f 6620 7374 6174 6973 7469  tion of statisti
-00054a50: 6373 2074 6f20 6265 2063 616c 6375 6c61  cs to be calcula
-00054a60: 7465 6420 7265 6c61 7469 7665 0a20 2020  ted relative.   
-00054a70: 2020 2020 2074 6f20 736c 6963 652d 6279       to slice-by
-00054a80: 2d73 6c69 6365 206d 6574 7269 6320 7661  -slice metric va
-00054a90: 6c75 6573 2e0a 0a20 2020 2020 2020 2041  lues...        A
-00054aa0: 2073 7461 7469 7374 6963 2069 7320 7370   statistic is sp
-00054ab0: 6563 6966 6965 6420 6279 2074 6865 206e  ecified by the n
-00054ac0: 616d 6520 6f66 2074 6865 2066 756e 6374  ame of the funct
-00054ad0: 696f 6e20 666f 720a 2020 2020 2020 2020  ion for.        
-00054ae0: 6974 7320 6361 6c63 756c 6174 696f 6e20  its calculation 
-00054af0: 696e 2074 6865 2050 7974 686f 6e20 7374  in the Python st
-00054b00: 6174 6973 7469 6373 206d 6f64 756c 653a  atistics module:
-00054b10: 0a0a 2020 2020 2020 2020 6874 7470 733a  ..        https:
-00054b20: 2f2f 646f 6373 2e70 7974 686f 6e2e 6f72  //docs.python.or
-00054b30: 672f 332f 6c69 6272 6172 792f 7374 6174  g/3/library/stat
-00054b40: 6973 7469 6373 2e68 746d 6c0a 0a20 2020  istics.html..   
-00054b50: 2020 2020 2046 6f72 2069 7473 2075 7365       For its use
-00054b60: 2068 6572 652c 2074 6865 2072 656c 6576   here, the relev
-00054b70: 616e 7420 6675 6e63 7469 6f6e 206d 7573  ant function mus
-00054b80: 7420 7265 7175 6972 650a 2020 2020 2020  t require.      
-00054b90: 2020 6120 7369 6e67 6c65 2d76 6172 6961    a single-varia
-00054ba0: 626c 6520 696e 7075 742c 206d 7573 7420  ble input, must 
-00054bb0: 6e6f 7420 7265 7175 6972 6520 616e 7920  not require any 
-00054bc0: 6b65 7977 6f72 640a 2020 2020 2020 2020  keyword.        
-00054bd0: 6172 6775 6d65 6e74 732c 2061 6e64 206d  arguments, and m
-00054be0: 7573 7420 7265 7475 726e 2061 2073 696e  ust return a sin
-00054bf0: 676c 6520 6e75 6d62 6572 2e0a 0a20 2020  gle number...   
-00054c00: 2020 2020 2041 7661 696c 6162 6c65 206f       Available o
-00054c10: 7074 696f 6e73 2069 6e63 6c75 6465 3a20  ptions include: 
-00054c20: 226d 6561 6e22 2c20 226d 6564 6961 6e22  "mean", "median"
-00054c30: 2c20 226d 6f64 6522 2c0a 2020 2020 2020  , "mode",.      
-00054c40: 2020 2273 7464 6576 222e 0a0a 2020 2020    "stdev"...    
-00054c50: 2020 2053 7461 7469 7374 6963 7320 746f     Statistics to
-00054c60: 2062 6520 6361 6c63 756c 6174 6564 2063   be calculated c
-00054c70: 616e 2062 6520 7370 6563 6966 6965 6420  an be specified 
-00054c80: 7573 696e 6720 616e 7920 6f66 0a20 2020  using any of.   
-00054c90: 2020 2020 7468 6520 666f 6c6c 6f77 696e      the followin
-00054ca0: 673a 0a0a 2020 2020 2020 202d 2053 7472  g:..       - Str
-00054cb0: 696e 6720 7370 6563 6966 7969 6e67 2073  ing specifying s
-00054cc0: 696e 676c 6520 7374 6174 6973 7469 6320  ingle statistic 
-00054cd0: 746f 2062 6520 6361 6c63 756c 6174 6564  to be calculated
-00054ce0: 2c0a 2020 2020 2020 2020 2077 6974 6820  ,.         with 
-00054cf0: 736c 6963 6573 2063 6f6e 7369 6465 7265  slices considere
-00054d00: 6420 6173 2067 6976 656e 2062 7920 3c64  d as given by <d
-00054d10: 6566 6175 6c74 5f62 795f 736c 6963 653e  efault_by_slice>
-00054d20: 2c0a 2020 2020 2020 2020 2066 6f72 2065  ,.         for e
-00054d30: 7861 6d70 6c65 3a20 226d 6561 6e22 3b0a  xample: "mean";.
-00054d40: 2020 2020 2020 202d 204c 6973 7420 7370         - List sp
-00054d50: 6563 6966 7969 6e67 206d 756c 7469 706c  ecifying multipl
-00054d60: 6520 7374 6174 6973 7469 6373 2074 6f20  e statistics to 
-00054d70: 6265 2063 616c 6375 6c61 7465 642c 0a20  be calculated,. 
-00054d80: 2020 2020 2020 2020 7769 7468 2073 6c69          with sli
-00054d90: 6365 7320 636f 6e73 6964 6572 6564 2061  ces considered a
-00054da0: 7320 6769 7665 6e20 6279 203c 6465 6661  s given by <defa
-00054db0: 756c 745f 6279 5f73 6c69 6365 3e2c 0a20  ult_by_slice>,. 
-00054dc0: 2020 2020 2020 2020 666f 7220 6578 616d          for exam
-00054dd0: 706c 653a 205b 226d 6561 6e22 2c20 2273  ple: ["mean", "s
-00054de0: 7464 6576 225d 3b0a 2020 2020 2020 202d  tdev"];.       -
-00054df0: 2044 6963 7469 6f6e 6172 7920 7768 6572   Dictionary wher
-00054e00: 6520 6b65 7973 2073 7065 6369 6679 2073  e keys specify s
-00054e10: 6c69 6365 7320 746f 2062 6520 636f 6e73  lices to be cons
-00054e20: 6964 6572 6564 2c0a 2020 2020 2020 2020  idered,.        
-00054e30: 2061 6e64 2076 616c 7565 7320 7370 6563   and values spec
-00054e40: 6966 7920 7374 6174 6973 7469 6373 2028  ify statistics (
-00054e50: 7374 7269 6e67 206f 7220 6c69 7374 292c  string or list),
-00054e60: 2066 6f72 0a20 2020 2020 2020 2020 6578   for.         ex
-00054e70: 616d 706c 653a 207b 2275 6e69 6f6e 223a  ample: {"union":
-00054e80: 205b 226d 6561 6e22 2c20 2273 7464 6576   ["mean", "stdev
-00054e90: 225d 7d2e 2020 5661 6c69 6420 736c 6963  "]}.  Valid slic
-00054ea0: 650a 2020 2020 2020 2020 2073 7065 6369  e.         speci
-00054eb0: 6669 6361 7469 6f6e 7320 6172 6520 6173  fications are as
-00054ec0: 206c 6973 7465 6420 666f 7220 3c64 6566   listed for <def
-00054ed0: 6175 6c74 5f62 795f 736c 6963 653e 2e0a  ault_by_slice>..
-00054ee0: 0a20 2020 2064 6566 6175 6c74 5f62 795f  .    default_by_
-00054ef0: 736c 6963 653a 2073 7472 2c20 6465 6661  slice: str, defa
-00054f00: 756c 743d 4e6f 6e65 0a20 2020 2020 2020  ult=None.       
-00054f10: 2044 6566 6175 6c74 2073 7065 6369 6669   Default specifi
-00054f20: 6361 7469 6f6e 206f 6620 736c 6963 6573  cation of slices
-00054f30: 2074 6f20 6265 2063 6f6e 7369 6465 7265   to be considere
-00054f40: 6420 7768 656e 0a20 2020 2020 2020 2063  d when.        c
-00054f50: 616c 6375 6c61 7469 6e67 2073 6c69 6365  alculating slice
-00054f60: 2d62 792d 736c 6963 6520 7374 6174 6973  -by-slice statis
-00054f70: 7469 6373 2066 6f72 2061 206d 6574 7269  tics for a metri
-00054f80: 6320 636f 6d70 6172 696e 670a 2020 2020  c comparing.    
-00054f90: 2020 2020 7477 6f20 524f 4973 2c20 726f      two ROIs, ro
-00054fa0: 6931 2061 6e64 2072 6f69 322e 2020 5468  i1 and roi2.  Th
-00054fb0: 6520 7661 6c69 6420 7370 6563 6966 6963  e valid specific
-00054fc0: 6174 696f 6e73 2061 7265 3a0a 0a20 2020  ations are:..   
-00054fd0: 2020 2020 202d 2022 6c65 6674 223a 2063       - "left": c
-00054fe0: 6f6e 7369 6465 7220 6f6e 6c79 2073 6c69  onsider only sli
-00054ff0: 6365 7320 636f 6e74 6169 6e69 6e67 2072  ces containing r
-00055000: 6f69 313b 0a20 2020 2020 2020 202d 2022  oi1;.        - "
-00055010: 7269 6768 7422 3a20 636f 6e73 6964 6572  right": consider
-00055020: 206f 6e6c 7920 736c 6963 6573 2063 6f6e   only slices con
-00055030: 7461 696e 696e 6720 726f 6932 3b0a 2020  taining roi2;.  
-00055040: 2020 2020 2020 2d20 2275 6e69 6f6e 223a        - "union":
-00055050: 2063 6f6e 7369 6465 7220 736c 6963 6573   consider slices
-00055060: 2063 6f6e 7461 696e 696e 6720 6569 7468   containing eith
-00055070: 6572 206f 6620 726f 6931 2061 6e64 2072  er of roi1 and r
-00055080: 6f69 323b 0a20 2020 2020 2020 202d 2022  oi2;.        - "
-00055090: 696e 7465 7273 6563 7469 6f6e 223a 2063  intersection": c
-000550a0: 6f6e 7369 6465 7220 736c 6963 6573 2063  onsider slices c
-000550b0: 6f6e 7461 696e 696e 6720 626f 7468 2072  ontaining both r
-000550c0: 6f69 3120 616e 6420 726f 6932 2e0a 0a20  oi1 and roi2... 
-000550d0: 2020 2020 2020 2049 6620 4e6f 6e65 2c20         If None, 
-000550e0: 7573 6520 736b 7274 2e63 6f72 652e 4465  use skrt.core.De
-000550f0: 6661 756c 7473 2829 2e62 795f 736c 6963  faults().by_slic
-00055100: 650a 2020 2020 2222 220a 2020 2020 6966  e.    """.    if
-00055110: 206e 6f74 2073 6c69 6365 5f73 7461 7473   not slice_stats
-00055120: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
-00055130: 207b 7d0a 0a20 2020 2023 2053 6574 2064   {}..    # Set d
-00055140: 6566 6175 6c74 206d 6574 686f 6420 666f  efault method fo
-00055150: 7220 736c 6963 6520 7365 6c65 6374 696f  r slice selectio
-00055160: 6e2e 0a20 2020 2064 6566 6175 6c74 5f62  n..    default_b
-00055170: 795f 736c 6963 6520 3d20 6465 6661 756c  y_slice = defaul
-00055180: 745f 6279 5f73 6c69 6365 206f 7220 736b  t_by_slice or sk
-00055190: 7274 2e63 6f72 652e 4465 6661 756c 7473  rt.core.Defaults
-000551a0: 2829 2e62 795f 736c 6963 650a 0a20 2020  ().by_slice..   
-000551b0: 2023 2045 6e73 7572 6520 7468 6174 2073   # Ensure that s
-000551c0: 6c69 6365 5f73 7461 7473 2069 7320 6120  lice_stats is a 
-000551d0: 6469 6374 696f 6e61 7279 2e0a 2020 2020  dictionary..    
-000551e0: 6966 2069 7369 6e73 7461 6e63 6528 736c  if isinstance(sl
-000551f0: 6963 655f 7374 6174 732c 2073 7472 293a  ice_stats, str):
-00055200: 0a20 2020 2020 2020 2073 6c69 6365 5f73  .        slice_s
-00055210: 7461 7473 203d 207b 6465 6661 756c 745f  tats = {default_
-00055220: 6279 5f73 6c69 6365 3a20 5b73 6c69 6365  by_slice: [slice
-00055230: 5f73 7461 7473 5d7d 0a0a 2020 2020 656c  _stats]}..    el
-00055240: 6966 2073 6b72 742e 636f 7265 2e69 735f  if skrt.core.is_
-00055250: 6c69 7374 2873 6c69 6365 5f73 7461 7473  list(slice_stats
-00055260: 293a 0a20 2020 2020 2020 2073 6c69 6365  ):.        slice
-00055270: 5f73 7461 7473 203d 207b 6465 6661 756c  _stats = {defaul
-00055280: 745f 6279 5f73 6c69 6365 3a20 736c 6963  t_by_slice: slic
-00055290: 655f 7374 6174 737d 0a0a 2020 2020 656c  e_stats}..    el
-000552a0: 6966 2069 7369 6e73 7461 6e63 6528 736c  if isinstance(sl
-000552b0: 6963 655f 7374 6174 732c 2064 6963 7429  ice_stats, dict)
-000552c0: 3a0a 2020 2020 2020 2020 6368 6563 6b65  :.        checke
-000552d0: 645f 736c 6963 655f 7374 6174 7320 3d20  d_slice_stats = 
-000552e0: 7b7d 0a20 2020 2020 2020 2066 6f72 2062  {}.        for b
-000552f0: 795f 736c 6963 652c 2073 7461 7473 2069  y_slice, stats i
-00055300: 6e20 736c 6963 655f 7374 6174 732e 6974  n slice_stats.it
-00055310: 656d 7328 293a 0a20 2020 2020 2020 2020  ems():.         
-00055320: 2020 2069 6620 6973 696e 7374 616e 6365     if isinstance
-00055330: 2873 7461 7473 2c20 7374 7229 3a0a 2020  (stats, str):.  
-00055340: 2020 2020 2020 2020 2020 2020 2020 6368                ch
-00055350: 6563 6b65 645f 736c 6963 655f 7374 6174  ecked_slice_stat
-00055360: 735b 6279 5f73 6c69 6365 5d20 3d20 5b73  s[by_slice] = [s
-00055370: 7461 7473 5d0a 2020 2020 2020 2020 2020  tats].          
-00055380: 2020 656c 6966 2073 6b72 742e 636f 7265    elif skrt.core
-00055390: 2e69 735f 6c69 7374 2873 7461 7473 293a  .is_list(stats):
-000553a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000553b0: 2063 6865 636b 6564 5f73 6c69 6365 5f73   checked_slice_s
-000553c0: 7461 7473 5b62 795f 736c 6963 655d 203d  tats[by_slice] =
-000553d0: 206c 6973 7428 7374 6174 7329 0a20 2020   list(stats).   
-000553e0: 2020 2020 2073 6c69 6365 5f73 7461 7473       slice_stats
-000553f0: 203d 2063 6865 636b 6564 5f73 6c69 6365   = checked_slice
-00055400: 5f73 7461 7473 0a0a 2020 2020 6966 2069  _stats..    if i
-00055410: 7369 6e73 7461 6e63 6528 736c 6963 655f  sinstance(slice_
-00055420: 7374 6174 732c 2064 6963 7429 3a0a 2020  stats, dict):.  
-00055430: 2020 2020 2020 7265 7475 726e 2073 6c69        return sli
-00055440: 6365 5f73 7461 7473 0a0a 2020 2020 7265  ce_stats..    re
-00055450: 7475 726e 207b 7d0a                      turn {}.
+00044450: 2020 6578 636c 7564 653d 6578 636c 7564    exclude=exclud
+00044460: 655f 6672 6f6d 5f63 6f6e 7365 6e73 7573  e_from_consensus
+00044470: 290a 2020 2020 2020 2020 2020 2020 636f  ).            co
+00044480: 6e73 656e 7375 735f 6b77 6172 6773 203d  nsensus_kwargs =
+00044490: 207b 7d20 6966 2065 7863 6c75 6465 5f66   {} if exclude_f
+000444a0: 726f 6d5f 636f 6e73 656e 7375 7320 6973  rom_consensus is
+000444b0: 206e 6f74 204e 6f6e 6520 5c0a 2020 2020   not None \.    
+000444c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000444d0: 656c 7365 206b 7761 7267 730a 2020 2020  else kwargs.    
+000444e0: 2020 2020 2020 2020 6966 2063 6f6e 7365          if conse
+000444f0: 6e73 7573 5f6c 696e 6577 6964 7468 2069  nsus_linewidth i
+00044500: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
+00044510: 2020 2020 2020 2020 636f 6e73 656e 7375          consensu
+00044520: 735f 6c69 6e65 7769 6474 6820 3d20 6465  s_linewidth = de
+00044530: 6661 756c 7450 6172 616d 735b 226c 696e  faultParams["lin
+00044540: 6573 2e6c 696e 6577 6964 7468 225d 5b30  es.linewidth"][0
+00044550: 5d20 2b20 310a 0a20 2020 2020 2020 2020  ] + 1..         
+00044560: 2020 2063 6f6e 7365 6e73 7573 2e70 6c6f     consensus.plo
+00044570: 7428 0a20 2020 2020 2020 2020 2020 2020  t(.             
+00044580: 2020 2076 6965 772c 2073 6c3d 736c 2c20     view, sl=sl, 
+00044590: 6964 783d 6964 782c 2070 6f73 3d70 6f73  idx=idx, pos=pos
+000445a0: 2c20 706c 6f74 5f74 7970 653d 706c 6f74  , plot_type=plot
+000445b0: 5f74 7970 652c 200a 2020 2020 2020 2020  _type, .        
+000445c0: 2020 2020 2020 2020 636f 6c6f 723d 636f          color=co
+000445d0: 6e73 656e 7375 735f 636f 6c6f 722c 206c  nsensus_color, l
+000445e0: 696e 6577 6964 7468 3d63 6f6e 7365 6e73  inewidth=consens
+000445f0: 7573 5f6c 696e 6577 6964 7468 2c20 0a20  us_linewidth, . 
+00044600: 2020 2020 2020 2020 2020 2020 2020 206f                 o
+00044610: 7061 6369 7479 3d6f 7061 6369 7479 2c20  pacity=opacity, 
+00044620: 7368 6f77 3d46 616c 7365 2c20 6178 3d61  show=False, ax=a
+00044630: 782c 202a 2a63 6f6e 7365 6e73 7573 5f6b  x, **consensus_k
+00044640: 7761 7267 7329 0a0a 2020 2020 2020 2020  wargs)..        
+00044650: 2020 2020 7365 6c66 2e61 7820 3d20 636f      self.ax = co
+00044660: 6e73 656e 7375 732e 6178 0a20 2020 2020  nsensus.ax.     
+00044670: 2020 2020 2020 2073 656c 662e 6669 6720         self.fig 
+00044680: 3d20 636f 6e73 656e 7375 732e 6669 670a  = consensus.fig.
+00044690: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+000446a0: 6c65 6765 6e64 3a0a 2020 2020 2020 2020  legend:.        
+000446b0: 2020 2020 2020 2020 726f 695f 6861 6e64          roi_hand
+000446c0: 6c65 732e 6170 7065 6e64 280a 2020 2020  les.append(.    
+000446d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000446e0: 2020 2020 636f 6e73 656e 7375 732e 6765      consensus.ge
+000446f0: 745f 7061 7463 6828 706c 6f74 5f74 7970  t_patch(plot_typ
+00044700: 652c 2063 6f6e 7365 6e73 7573 5f63 6f6c  e, consensus_col
+00044710: 6f72 2c20 6f70 6163 6974 792c 0a20 2020  or, opacity,.   
+00044720: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00044730: 2020 2020 2020 2020 206c 696e 6577 6964           linewid
+00044740: 7468 2c20 636f 6e73 656e 7375 732e 6e61  th, consensus.na
+00044750: 6d65 2929 0a0a 2020 2020 2020 2020 2020  me))..          
+00044760: 2020 2320 506c 6f74 2065 7863 6c75 6465    # Plot exclude
+00044770: 6420 524f 4920 6f6e 2074 6f70 0a20 2020  d ROI on top.   
+00044780: 2020 2020 2020 2020 2069 6620 6578 636c           if excl
+00044790: 7564 655f 6672 6f6d 5f63 6f6e 7365 6e73  ude_from_consens
+000447a0: 7573 2069 7320 6e6f 7420 4e6f 6e65 3a0a  us is not None:.
+000447b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000447c0: 6b77 6172 6773 5b22 696e 636c 7564 655f  kwargs["include_
+000447d0: 696d 6167 6522 5d20 3d20 4661 6c73 650a  image"] = False.
+000447e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000447f0: 6578 636c 7564 6564 203d 2073 656c 662e  excluded = self.
+00044800: 6765 745f 726f 6928 6578 636c 7564 655f  get_roi(exclude_
+00044810: 6672 6f6d 5f63 6f6e 7365 6e73 7573 290a  from_consensus).
+00044820: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00044830: 6578 636c 7564 6564 2e70 6c6f 7428 7669  excluded.plot(vi
+00044840: 6577 2c20 736c 3d73 6c2c 2069 6478 3d69  ew, sl=sl, idx=i
+00044850: 6478 2c20 706f 733d 706f 732c 2070 6c6f  dx, pos=pos, plo
+00044860: 745f 7479 7065 3d70 6c6f 745f 7479 7065  t_type=plot_type
+00044870: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00044880: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00044890: 6f70 6163 6974 793d 6f70 6163 6974 792c  opacity=opacity,
+000448a0: 206c 696e 6577 6964 7468 3d6c 696e 6577   linewidth=linew
+000448b0: 6964 7468 2c20 7368 6f77 3d46 616c 7365  idth, show=False
+000448c0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+000448d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000448e0: 6178 3d73 656c 662e 6178 2c20 2a2a 6b77  ax=self.ax, **kw
+000448f0: 6172 6773 290a 2020 2020 2020 2020 2020  args).          
+00044900: 2020 2020 2020 6966 206c 6567 656e 643a        if legend:
+00044910: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00044920: 2020 2020 2072 6f69 5f68 616e 646c 6573       roi_handles
+00044930: 2e61 7070 656e 6428 0a20 2020 2020 2020  .append(.       
+00044940: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00044950: 2065 7863 6c75 6465 642e 6765 745f 7061   excluded.get_pa
+00044960: 7463 6828 706c 6f74 5f74 7970 652c 2065  tch(plot_type, e
+00044970: 7863 6c75 6465 642e 636f 6c6f 722c 206f  xcluded.color, o
+00044980: 7061 6369 7479 2c0a 2020 2020 2020 2020  pacity,.        
+00044990: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000449a0: 2020 2020 6c69 6e65 7769 6474 682c 2065      linewidth, e
+000449b0: 7863 6c75 6465 642e 6e61 6d65 2929 0a0a  xcluded.name))..
+000449c0: 2020 2020 2020 2020 2320 4f74 6865 7277          # Otherw
+000449d0: 6973 652c 2070 6c6f 7420 6669 7273 7420  ise, plot first 
+000449e0: 524f 4920 616e 6420 6765 7420 6178 6573  ROI and get axes
+000449f0: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
+00044a00: 2020 2020 2020 2020 2020 2069 6620 6365             if ce
+00044a10: 6e74 7265 5f6f 6e5f 726f 6920 6973 206e  ntre_on_roi is n
+00044a20: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
+00044a30: 2020 2020 2020 2020 2063 656e 7472 616c           central
+00044a40: 203d 2073 656c 662e 6765 745f 726f 6928   = self.get_roi(
+00044a50: 6365 6e74 7265 5f6f 6e5f 726f 6929 0a20  centre_on_roi). 
+00044a60: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00044a70: 6478 203d 2063 656e 7472 616c 2e67 6574  dx = central.get
+00044a80: 5f6d 6964 5f69 6478 2876 6965 7729 0a20  _mid_idx(view). 
+00044a90: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00044aa0: 6c20 3d20 4e6f 6e65 0a20 2020 2020 2020  l = None.       
+00044ab0: 2020 2020 2020 2020 2070 6f73 203d 204e           pos = N
+00044ac0: 6f6e 650a 2020 2020 2020 2020 2020 2020  one.            
+00044ad0: 2020 2020 6669 7273 745f 726f 6920 3d20      first_roi = 
+00044ae0: 6365 6e74 7261 6c0a 2020 2020 2020 2020  central.        
+00044af0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00044b00: 2020 2020 2020 2020 2020 6365 6e74 7261            centra
+00044b10: 6c20 3d20 7365 6c66 2e67 6574 5f72 6f69  l = self.get_roi
+00044b20: 7328 6967 6e6f 7265 5f65 6d70 7479 3d54  s(ignore_empty=T
+00044b30: 7275 6529 5b30 5d0a 0a20 2020 2020 2020  rue)[0]..       
+00044b40: 2020 2020 2063 656e 7472 616c 2e70 6c6f       central.plo
+00044b50: 7428 7669 6577 2c20 736c 3d73 6c2c 2069  t(view, sl=sl, i
+00044b60: 6478 3d69 6478 2c20 706f 733d 706f 732c  dx=idx, pos=pos,
+00044b70: 2070 6c6f 745f 7479 7065 3d70 6c6f 745f   plot_type=plot_
+00044b80: 7479 7065 2c0a 2020 2020 2020 2020 2020  type,.          
+00044b90: 2020 2020 2020 2020 2020 2020 2020 206f                 o
+00044ba0: 7061 6369 7479 3d6f 7061 6369 7479 2c20  pacity=opacity, 
+00044bb0: 6c69 6e65 7769 6474 683d 6c69 6e65 7769  linewidth=linewi
+00044bc0: 6474 682c 2073 686f 773d 4661 6c73 652c  dth, show=False,
+00044bd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00044be0: 2020 2020 2020 2020 2020 6178 3d61 7829            ax=ax)
+00044bf0: 0a0a 2020 2020 2020 2020 2020 2020 7365  ..            se
+00044c00: 6c66 2e66 6967 203d 2063 656e 7472 616c  lf.fig = central
+00044c10: 2e66 6967 0a20 2020 2020 2020 2020 2020  .fig.           
+00044c20: 2073 656c 662e 6178 203d 2063 656e 7472   self.ax = centr
+00044c30: 616c 2e61 780a 0a20 2020 2020 2020 2020  al.ax..         
+00044c40: 2020 2069 6620 6c65 6765 6e64 3a0a 2020     if legend:.  
+00044c50: 2020 2020 2020 2020 2020 2020 2020 726f                ro
+00044c60: 695f 6861 6e64 6c65 732e 6170 7065 6e64  i_handles.append
+00044c70: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+00044c80: 2020 2020 2020 2020 2020 6365 6e74 7261            centra
+00044c90: 6c2e 6765 745f 7061 7463 6828 706c 6f74  l.get_patch(plot
+00044ca0: 5f74 7970 652c 2063 656e 7472 616c 2e63  _type, central.c
+00044cb0: 6f6c 6f72 2c20 6f70 6163 6974 792c 0a20  olor, opacity,. 
+00044cc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00044cd0: 2020 2020 2020 2020 2020 206c 696e 6577             linew
+00044ce0: 6964 7468 2c20 6365 6e74 7261 6c2e 6e61  idth, central.na
+00044cf0: 6d65 2929 0a0a 2020 2020 2020 2020 2020  me))..          
+00044d00: 2020 2320 506c 6f74 206f 7468 6572 2052    # Plot other R
+00044d10: 4f49 730a 2020 2020 2020 2020 2020 2020  OIs.            
+00044d20: 666f 7220 692c 2072 6f69 2069 6e20 656e  for i, roi in en
+00044d30: 756d 6572 6174 6528 7365 6c66 2e67 6574  umerate(self.get
+00044d40: 5f72 6f69 7328 6967 6e6f 7265 5f65 6d70  _rois(ignore_emp
+00044d50: 7479 3d54 7275 6529 293a 0a0a 2020 2020  ty=True)):..    
+00044d60: 2020 2020 2020 2020 2020 2020 6966 2072              if r
+00044d70: 6f69 2069 7320 6365 6e74 7261 6c3a 0a20  oi is central:. 
+00044d80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00044d90: 2020 2063 6f6e 7469 6e75 650a 0a20 2020     continue..   
+00044da0: 2020 2020 2020 2020 2020 2020 2070 6c6f               plo
+00044db0: 745f 6b77 6172 6773 203d 207b 7d20 6966  t_kwargs = {} if
+00044dc0: 2069 203c 206c 656e 2873 656c 662e 726f   i < len(self.ro
+00044dd0: 6973 2920 2d20 3120 656c 7365 206b 7761  is) - 1 else kwa
+00044de0: 7267 730a 2020 2020 2020 2020 2020 2020  rgs.            
+00044df0: 2020 2020 726f 692e 706c 6f74 2876 6965      roi.plot(vie
+00044e00: 772c 2073 6c3d 736c 2c20 6964 783d 6964  w, sl=sl, idx=id
+00044e10: 782c 2070 6f73 3d70 6f73 2c20 706c 6f74  x, pos=pos, plot
+00044e20: 5f74 7970 653d 706c 6f74 5f74 7970 652c  _type=plot_type,
+00044e30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00044e40: 2020 2020 2020 2020 2020 6f70 6163 6974            opacit
+00044e50: 793d 6f70 6163 6974 792c 206c 696e 6577  y=opacity, linew
+00044e60: 6964 7468 3d6c 696e 6577 6964 7468 2c20  idth=linewidth, 
+00044e70: 7368 6f77 3d46 616c 7365 2c0a 2020 2020  show=False,.    
+00044e80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00044e90: 2020 2020 2061 783d 7365 6c66 2e61 782c       ax=self.ax,
+00044ea0: 202a 2a6b 7761 7267 7329 0a0a 2020 2020   **kwargs)..    
+00044eb0: 2020 2020 2020 2020 2020 2020 6966 206c              if l
+00044ec0: 6567 656e 643a 0a20 2020 2020 2020 2020  egend:.         
+00044ed0: 2020 2020 2020 2020 2020 2069 6620 2869             if (i
+00044ee0: 6478 2069 7320 4e6f 6e65 2061 6e64 2070  dx is None and p
+00044ef0: 6f73 2069 7320 4e6f 6e65 2061 6e64 2073  os is None and s
+00044f00: 6c20 6973 204e 6f6e 6529 206f 7220 5c0a  l is None) or \.
+00044f10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00044f20: 2020 2020 2020 2072 6f69 2e6f 6e5f 736c         roi.on_sl
+00044f30: 6963 6528 7669 6577 2c20 736c 3d73 6c2c  ice(view, sl=sl,
+00044f40: 2069 6478 3d69 6478 2c20 706f 733d 706f   idx=idx, pos=po
+00044f50: 7329 3a0a 2020 2020 2020 2020 2020 2020  s):.            
+00044f60: 2020 2020 2020 2020 2020 2020 726f 695f              roi_
+00044f70: 6861 6e64 6c65 732e 6170 7065 6e64 2872  handles.append(r
+00044f80: 6f69 2e67 6574 5f70 6174 6368 2870 6c6f  oi.get_patch(plo
+00044f90: 745f 7479 7065 2c20 726f 692e 636f 6c6f  t_type, roi.colo
+00044fa0: 722c 0a20 2020 2020 2020 2020 2020 2020  r,.             
+00044fb0: 2020 2020 2020 2020 2020 2020 2020 206f                 o
+00044fc0: 7061 6369 7479 2c20 6c69 6e65 7769 6474  pacity, linewidt
+00044fd0: 682c 2072 6f69 2e6e 616d 6529 290a 0a20  h, roi.name)).. 
+00044fe0: 2020 2020 2020 2023 2044 7261 7720 6c65         # Draw le
+00044ff0: 6765 6e64 0a20 2020 2020 2020 2069 6620  gend.        if 
+00045000: 6c65 6765 6e64 2061 6e64 206c 656e 2872  legend and len(r
+00045010: 6f69 5f68 616e 646c 6573 293a 0a20 2020  oi_handles):.   
+00045020: 2020 2020 2020 2020 2073 656c 662e 6178           self.ax
+00045030: 2e6c 6567 656e 6428 6861 6e64 6c65 733d  .legend(handles=
+00045040: 726f 695f 6861 6e64 6c65 732c 0a20 2020  roi_handles,.   
+00045050: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00045060: 2062 626f 785f 746f 5f61 6e63 686f 723d   bbox_to_anchor=
+00045070: 6c65 6765 6e64 5f62 626f 785f 746f 5f61  legend_bbox_to_a
+00045080: 6e63 686f 722c 206c 6f63 3d6c 6567 656e  nchor, loc=legen
+00045090: 645f 6c6f 632c 0a20 2020 2020 2020 2020  d_loc,.         
+000450a0: 2020 2020 2020 2020 2020 2066 6163 6563             facec
+000450b0: 6f6c 6f72 3d22 7768 6974 6522 2c20 6672  olor="white", fr
+000450c0: 616d 6561 6c70 6861 3d31 0a20 2020 2020  amealpha=1.     
+000450d0: 2020 2020 2020 2029 0a0a 2020 2020 2020         )..      
+000450e0: 2020 2320 4469 7370 6c61 7920 696d 6167    # Display imag
+000450f0: 650a 2020 2020 2020 2020 706c 742e 7469  e.        plt.ti
+00045100: 6768 745f 6c61 796f 7574 2829 0a20 2020  ght_layout().   
+00045110: 2020 2020 2069 6620 7368 6f77 3a0a 2020       if show:.  
+00045120: 2020 2020 2020 2020 2020 706c 742e 7368            plt.sh
+00045130: 6f77 2829 0a0a 2020 2020 2020 2020 2320  ow()..        # 
+00045140: 5361 7665 2074 6f20 6669 6c65 0a20 2020  Save to file.   
+00045150: 2020 2020 2069 6620 7361 7665 5f61 733a       if save_as:
+00045160: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00045170: 662e 6669 672e 7361 7665 6669 6728 7361  f.fig.savefig(sa
+00045180: 7665 5f61 7329 0a20 2020 2020 2020 2020  ve_as).         
+00045190: 2020 2070 6c74 2e63 6c6f 7365 2829 0a0a     plt.close()..
+000451a0: 2020 2020 6465 6620 706c 6f74 5f63 6f6e      def plot_con
+000451b0: 7365 6e73 7573 2873 656c 662c 2063 6f6e  sensus(self, con
+000451c0: 7365 6e73 7573 5f74 7970 652c 2076 6965  sensus_type, vie
+000451d0: 773d 2278 2d79 222c 2073 6c3d 4e6f 6e65  w="x-y", sl=None
+000451e0: 2c20 6964 783d 4e6f 6e65 2c0a 2020 2020  , idx=None,.    
+000451f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00045200: 2020 2070 6f73 3d4e 6f6e 652c 2072 6f69     pos=None, roi
+00045210: 735f 696e 5f62 6163 6b67 726f 756e 643d  s_in_background=
+00045220: 4661 6c73 652c 2063 6f6c 6f72 3d4e 6f6e  False, color=Non
+00045230: 652c 200a 2020 2020 2020 2020 2020 2020  e, .            
+00045240: 2020 2020 2020 2020 2020 2073 686f 773d             show=
+00045250: 5472 7565 2c20 2a2a 6b77 6172 6773 293a  True, **kwargs):
+00045260: 0a20 2020 2020 2020 2022 2222 506c 6f74  .        """Plot
+00045270: 2074 6865 2063 6f6e 7365 6e73 7573 2063   the consensus c
+00045280: 6f6e 746f 7572 2c20 7769 7468 2061 6c6c  ontour, with all
+00045290: 2052 4f49 7320 696e 2067 7265 7920 6265   ROIs in grey be
+000452a0: 6869 6e64 2069 7420 6966 0a20 2020 2020  hind it if.     
+000452b0: 2020 2072 6f69 735f 696e 5f62 6163 6b67     rois_in_backg
+000452c0: 726f 756e 643d 5472 7565 2e22 2222 0a0a  round=True."""..
+000452d0: 2020 2020 2020 2020 636f 6e73 656e 7375          consensu
+000452e0: 7320 3d20 7365 6c66 2e67 6574 5f63 6f6e  s = self.get_con
+000452f0: 7365 6e73 7573 2863 6f6e 7365 6e73 7573  sensus(consensus
+00045300: 5f74 7970 6529 0a0a 2020 2020 2020 2020  _type)..        
+00045310: 6966 2069 6478 2069 7320 4e6f 6e65 2061  if idx is None a
+00045320: 6e64 2073 6c20 6973 204e 6f6e 6520 616e  nd sl is None an
+00045330: 6420 706f 7320 6973 204e 6f6e 653a 0a20  d pos is None:. 
+00045340: 2020 2020 2020 2020 2020 2069 6478 203d             idx =
+00045350: 2073 656c 662e 6765 745f 6d69 645f 6964   self.get_mid_id
+00045360: 7828 7669 6577 290a 2020 2020 2020 2020  x(view).        
+00045370: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+00045380: 2020 6964 7820 3d20 636f 6e73 656e 7375    idx = consensu
+00045390: 732e 6765 745f 6964 7828 7669 6577 2c20  s.get_idx(view, 
+000453a0: 736c 2c20 6964 782c 2070 6f73 290a 2020  sl, idx, pos).  
+000453b0: 2020 2020 2020 6178 203d 2073 6b72 742e        ax = skrt.
+000453c0: 696d 6167 652e 5f73 6c69 6365 5f61 7865  image._slice_axe
+000453d0: 735b 7669 6577 5d0a 2020 2020 2020 2020  s[view].        
+000453e0: 706f 7320 3d20 636f 6e73 656e 7375 732e  pos = consensus.
+000453f0: 6964 785f 746f 5f70 6f73 2869 6478 2c20  idx_to_pos(idx, 
+00045400: 6178 290a 0a20 2020 2020 2020 2069 6620  ax)..        if 
+00045410: 636f 6e73 656e 7375 732e 656d 7074 793a  consensus.empty:
+00045420: 0a20 2020 2020 2020 2020 2020 2070 7269  .            pri
+00045430: 6e74 2866 227b 636f 6e73 656e 7375 735f  nt(f"{consensus_
+00045440: 7479 7065 7d20 636f 6e74 6f75 7220 6973  type} contour is
+00045450: 2065 6d70 7479 2229 0a20 2020 2020 2020   empty").       
+00045460: 2020 2020 2072 6574 7572 6e0a 2020 2020       return.    
+00045470: 2020 2020 636f 6e73 656e 7375 732e 706c      consensus.pl
+00045480: 6f74 2863 6f6c 6f72 3d63 6f6c 6f72 2c20  ot(color=color, 
+00045490: 706f 733d 706f 732c 2076 6965 773d 7669  pos=pos, view=vi
+000454a0: 6577 2c20 7368 6f77 3d46 616c 7365 2c20  ew, show=False, 
+000454b0: 2a2a 6b77 6172 6773 290a 0a20 2020 2020  **kwargs)..     
+000454c0: 2020 2069 6620 726f 6973 5f69 6e5f 6261     if rois_in_ba
+000454d0: 636b 6772 6f75 6e64 3a0a 2020 2020 2020  ckground:.      
+000454e0: 2020 2020 2020 6b77 6172 6773 5b22 6178        kwargs["ax
+000454f0: 225d 203d 2063 6f6e 7365 6e73 7573 2e61  "] = consensus.a
+00045500: 780a 2020 2020 2020 2020 2020 2020 666f  x.            fo
+00045510: 7220 726f 6920 696e 2073 656c 662e 6765  r roi in self.ge
+00045520: 745f 726f 6973 2869 676e 6f72 655f 656d  t_rois(ignore_em
+00045530: 7074 793d 5472 7565 293a 0a20 2020 2020  pty=True):.     
+00045540: 2020 2020 2020 2020 2020 2072 6f69 2e70             roi.p
+00045550: 6c6f 7428 636f 6c6f 723d 226c 6967 6874  lot(color="light
+00045560: 6772 6579 222c 2076 6965 773d 7669 6577  grey", view=view
+00045570: 2c20 706f 733d 706f 732c 2073 686f 773d  , pos=pos, show=
+00045580: 4661 6c73 652c 202a 2a6b 7761 7267 7329  False, **kwargs)
+00045590: 0a20 2020 2020 2020 2020 2020 2063 6f6e  .            con
+000455a0: 7365 6e73 7573 2e70 6c6f 7428 636f 6c6f  sensus.plot(colo
+000455b0: 723d 636f 6c6f 722c 2076 6965 773d 7669  r=color, view=vi
+000455c0: 6577 2c20 706f 733d 706f 732c 2073 686f  ew, pos=pos, sho
+000455d0: 773d 4661 6c73 652c 202a 2a6b 7761 7267  w=False, **kwarg
+000455e0: 7329 0a0a 2020 2020 2020 2020 636f 6e73  s)..        cons
+000455f0: 656e 7375 732e 6178 2e73 6574 5f61 7370  ensus.ax.set_asp
+00045600: 6563 7428 2265 7175 616c 2229 0a0a 2020  ect("equal")..  
+00045610: 2020 2020 2020 6966 2073 686f 773a 0a20        if show:. 
+00045620: 2020 2020 2020 2020 2020 2070 6c74 2e73             plt.s
+00045630: 686f 7728 290a 0a20 2020 2064 6566 2067  how()..    def g
+00045640: 6574 5f6c 656e 6774 6828 7365 6c66 2c20  et_length(self, 
+00045650: 6178 293a 0a20 2020 2020 2020 2022 2222  ax):.        """
+00045660: 4765 7420 6c65 6e67 7468 2063 6f76 6572  Get length cover
+00045670: 6564 2062 7920 524f 4973 2061 6c6f 6e67  ed by ROIs along
+00045680: 2061 6e20 6178 6973 2e22 2222 0a0a 2020   an axis."""..  
+00045690: 2020 2020 2020 6578 7465 6e74 203d 2073        extent = s
+000456a0: 656c 662e 6765 745f 6578 7465 6e74 2861  elf.get_extent(a
+000456b0: 783d 6178 290a 2020 2020 2020 2020 7265  x=ax).        re
+000456c0: 7475 726e 2061 6273 2865 7874 656e 745b  turn abs(extent[
+000456d0: 315d 202d 2065 7874 656e 745b 305d 290a  1] - extent[0]).
+000456e0: 0a20 2020 2064 6566 2067 6574 5f63 656e  .    def get_cen
+000456f0: 7472 6528 7365 6c66 2c20 2a2a 6b77 6172  tre(self, **kwar
+00045700: 6773 293a 0a20 2020 2020 2020 2022 2222  gs):.        """
+00045710: 4765 7420 3344 2063 656e 7472 6520 6f66  Get 3D centre of
+00045720: 2074 6865 2061 7265 6120 636f 7665 7265   the area covere
+00045730: 6420 6279 2052 4f49 732e 2222 220a 0a20  d by ROIs.""".. 
+00045740: 2020 2020 2020 206b 7761 7267 732e 706f         kwargs.po
+00045750: 7028 2261 7822 2c20 4e6f 6e65 290a 2020  p("ax", None).  
+00045760: 2020 2020 2020 6578 7465 6e74 7320 3d20        extents = 
+00045770: 5b73 656c 662e 6765 745f 6578 7465 6e74  [self.get_extent
+00045780: 2861 783d 6178 2c20 2a2a 6b77 6172 6773  (ax=ax, **kwargs
+00045790: 2920 666f 7220 6178 2069 6e20 736b 7274  ) for ax in skrt
+000457a0: 2e69 6d61 6765 2e5f 6178 6573 5d0a 2020  .image._axes].  
+000457b0: 2020 2020 2020 7265 7475 726e 205b 6e70        return [np
+000457c0: 2e6d 6561 6e28 6578 2920 666f 7220 6578  .mean(ex) for ex
+000457d0: 2069 6e20 6578 7465 6e74 735d 0a0a 2020   in extents]..  
+000457e0: 2020 6465 6620 6669 6e64 5f6d 6f73 745f    def find_most_
+000457f0: 706f 7075 6c61 7465 645f 736c 6963 6528  populated_slice(
+00045800: 7365 6c66 2c20 7669 6577 3d22 782d 7922  self, view="x-y"
+00045810: 293a 0a20 2020 2020 2020 2022 2222 4669  ):.        """Fi
+00045820: 6e64 2074 6865 2069 6e64 6578 206f 6620  nd the index of 
+00045830: 7468 6520 736c 6963 6520 7769 7468 2074  the slice with t
+00045840: 6865 206d 6f73 7420 524f 4973 206f 6e20  he most ROIs on 
+00045850: 6974 2e22 2222 0a0a 2020 2020 2020 2020  it."""..        
+00045860: 696e 6469 6365 7320 3d20 5b5d 0a20 2020  indices = [].   
+00045870: 2020 2020 2066 6f72 2072 6f69 2069 6e20       for roi in 
+00045880: 7365 6c66 2e67 6574 5f72 6f69 7328 6967  self.get_rois(ig
+00045890: 6e6f 7265 5f65 6d70 7479 3d54 7275 6529  nore_empty=True)
+000458a0: 3a0a 2020 2020 2020 2020 2020 2020 696e  :.            in
+000458b0: 6469 6365 732e 6578 7465 6e64 2872 6f69  dices.extend(roi
+000458c0: 2e67 6574 5f69 6e64 6963 6573 2876 6965  .get_indices(vie
+000458d0: 7729 290a 2020 2020 2020 2020 7661 6c73  w)).        vals
+000458e0: 2c20 636f 756e 7473 203d 206e 702e 756e  , counts = np.un
+000458f0: 6971 7565 2869 6e64 6963 6573 2c20 7265  ique(indices, re
+00045900: 7475 726e 5f63 6f75 6e74 733d 5472 7565  turn_counts=True
+00045910: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
+00045920: 2076 616c 735b 6e70 2e61 7267 6d61 7828   vals[np.argmax(
+00045930: 636f 756e 7473 295d 0a0a 2020 2020 6465  counts)]..    de
+00045940: 6620 7669 6577 2873 656c 662c 2069 6e63  f view(self, inc
+00045950: 6c75 6465 5f69 6d61 6765 3d54 7275 652c  lude_image=True,
+00045960: 2072 6f69 733d 4e6f 6e65 2c20 766f 7865   rois=None, voxe
+00045970: 6c5f 7369 7a65 3d5b 312c 2031 5d2c 2062  l_size=[1, 1], b
+00045980: 7566 6665 723d 352c 202a 2a6b 7761 7267  uffer=5, **kwarg
+00045990: 7329 3a0a 2020 2020 2020 2020 2222 2256  s):.        """V
+000459a0: 6965 7720 7468 6520 5374 7275 6374 7572  iew the Structur
+000459b0: 6553 6574 2e0a 0a20 2020 2020 2020 202a  eSet...        *
+000459c0: 2a50 6172 616d 6574 6572 733a 2a2a 0a20  *Parameters:**. 
+000459d0: 2020 2020 2020 200a 2020 2020 2020 2020         .        
+000459e0: 696e 636c 7564 655f 696d 6167 6520 3a20  include_image : 
+000459f0: 626f 6f6c 2c20 6465 6661 756c 743d 5472  bool, default=Tr
+00045a00: 7565 0a20 2020 2020 2020 2020 2020 2049  ue.            I
+00045a10: 6620 5472 7565 2061 6e64 2074 6869 7320  f True and this 
+00045a20: 5374 7275 6374 7572 6553 6574 2068 6173  StructureSet has
+00045a30: 2061 6e20 6173 736f 6369 6174 6564 2069   an associated i
+00045a40: 6d61 6765 200a 2020 2020 2020 2020 2020  mage .          
+00045a50: 2020 2869 6e20 7365 6c66 2e69 6d61 6765    (in self.image
+00045a60: 292c 2074 6865 2069 6d61 6765 2077 696c  ), the image wil
+00045a70: 6c20 6265 2064 6973 706c 6179 6564 2062  l be displayed b
+00045a80: 6568 696e 6420 7468 6520 524f 4973 2e0a  ehind the ROIs..
+00045a90: 0a20 2020 2020 2020 2072 6f69 7320 3a20  .        rois : 
+00045aa0: 5374 7275 6374 7572 6553 6574 2f6c 6973  StructureSet/lis
+00045ab0: 742c 2064 6566 6175 6c74 3d4e 6f6e 650a  t, default=None.
+00045ac0: 2020 2020 2020 2020 2020 2020 416e 7920              Any 
+00045ad0: 6f74 6865 7220 524f 4973 206f 7220 5374  other ROIs or St
+00045ae0: 7275 6374 7572 6553 6574 7320 746f 2069  ructureSets to i
+00045af0: 6e63 6c75 6465 2069 6e20 7468 6520 706c  nclude in the pl
+00045b00: 6f74 2e0a 0a20 2020 2020 2020 2076 6f78  ot...        vox
+00045b10: 656c 5f73 697a 6520 3a20 6c69 7374 2c20  el_size : list, 
+00045b20: 6465 6661 756c 743d 5b31 2c20 315d 0a20  default=[1, 1]. 
+00045b30: 2020 2020 2020 2020 2020 2049 6620 7468             If th
+00045b40: 6520 5374 7275 6374 7572 6553 6574 2064  e StructureSet d
+00045b50: 6f65 7320 6e6f 7420 6861 7665 2061 6e20  oes not have an 
+00045b60: 6173 736f 6369 6174 6564 2069 6d61 6765  associated image
+00045b70: 2061 6e64 2068 6173 2052 4f49 7320 0a20   and has ROIs . 
+00045b80: 2020 2020 2020 2020 2020 2064 6573 6372             descr
+00045b90: 6962 6564 206f 6e6c 7920 6279 2063 6f6e  ibed only by con
+00045ba0: 746f 7572 732c 2074 6869 7320 7769 6c6c  tours, this will
+00045bb0: 2062 6520 7468 6520 766f 7865 6c20 7369   be the voxel si
+00045bc0: 7a65 7320 7573 6564 2069 6e20 0a20 2020  zes used in .   
+00045bd0: 2020 2020 2020 2020 2074 6865 2078 2d79           the x-y
+00045be0: 2064 6972 6563 7469 6f6e 2077 6865 6e20   direction when 
+00045bf0: 636f 6e76 6572 7469 6e67 2052 4f49 7320  converting ROIs 
+00045c00: 746f 206d 6173 6b73 2069 6620 6120 6d61  to masks if a ma
+00045c10: 736b 2070 6c6f 7420 0a20 2020 2020 2020  sk plot .       
+00045c20: 2020 2020 2074 7970 6520 6973 2073 656c       type is sel
+00045c30: 6563 7465 642e 0a0a 2020 2020 2020 2020  ected...        
+00045c40: 6275 6666 6572 203a 2069 6e74 2c20 6465  buffer : int, de
+00045c50: 6661 756c 743d 350a 2020 2020 2020 2020  fault=5.        
+00045c60: 2020 2020 4966 2074 6865 2053 7472 7563      If the Struc
+00045c70: 7475 7265 5365 7420 646f 6573 206e 6f74  tureSet does not
+00045c80: 2068 6176 6520 616e 2061 7373 6f63 6961   have an associa
+00045c90: 7465 6420 696d 6167 6520 616e 6420 6861  ted image and ha
+00045ca0: 7320 524f 4973 0a20 2020 2020 2020 2020  s ROIs.         
+00045cb0: 2020 2064 6573 6372 6962 6564 206f 6e6c     described onl
+00045cc0: 7920 6279 2063 6f6e 746f 7572 732c 2074  y by contours, t
+00045cd0: 6869 7320 7769 6c6c 2062 6520 7468 6520  his will be the 
+00045ce0: 6e75 6d62 6572 206f 6620 6275 6666 6572  number of buffer
+00045cf0: 2076 6f78 656c 7320 0a20 2020 2020 2020   voxels .       
+00045d00: 2020 2020 2028 692e 652e 2077 6869 7465       (i.e. white
+00045d10: 7370 6163 6529 2064 6973 706c 6179 6564  space) displayed
+00045d20: 2061 726f 756e 6420 7468 6520 6578 7465   around the exte
+00045d30: 6e74 206f 6620 7468 6520 524f 4973 2e0a  nt of the ROIs..
+00045d40: 2020 2020 2020 2020 2222 220a 0a20 2020          """..   
+00045d50: 2020 2020 2066 726f 6d20 736b 7274 2e62       from skrt.b
+00045d60: 6574 7465 725f 7669 6577 6572 2069 6d70  etter_viewer imp
+00045d70: 6f72 7420 4265 7474 6572 5669 6577 6572  ort BetterViewer
+00045d80: 0a20 2020 2020 2020 2073 656c 662e 6c6f  .        self.lo
+00045d90: 6164 2829 0a0a 2020 2020 2020 2020 2320  ad()..        # 
+00045da0: 5365 7420 696e 6974 6961 6c20 7a6f 6f6d  Set initial zoom
+00045db0: 2061 6d6f 756e 7420 616e 6420 6365 6e74   amount and cent
+00045dc0: 7265 0a20 2020 2020 2020 2073 656c 662e  re.        self.
+00045dd0: 726f 6973 5b30 5d2e 6c6f 6164 2829 0a20  rois[0].load(). 
+00045de0: 2020 2020 2020 2069 6620 7365 6c66 2e69         if self.i
+00045df0: 6d61 6765 2069 7320 6e6f 7420 4e6f 6e65  mage is not None
+00045e00: 2061 6e64 206e 6f74 2073 656c 662e 6765   and not self.ge
+00045e10: 745f 726f 6973 2869 676e 6f72 655f 656d  t_rois(ignore_em
+00045e20: 7074 793d 5472 7565 295b 305d 2e63 6f6e  pty=True)[0].con
+00045e30: 746f 7572 735f 6f6e 6c79 3a0a 2020 2020  tours_only:.    
+00045e40: 2020 2020 2020 2020 7669 6577 203d 206b          view = k
+00045e50: 7761 7267 732e 6765 7428 2269 6e69 745f  wargs.get("init_
+00045e60: 7669 6577 222c 2022 782d 7922 290a 2020  view", "x-y").  
+00045e70: 2020 2020 2020 2020 2020 6178 6573 203d            axes =
+00045e80: 2073 6b72 742e 696d 6167 652e 5f70 6c6f   skrt.image._plo
+00045e90: 745f 6178 6573 5b76 6965 775d 0a20 2020  t_axes[view].   
+00045ea0: 2020 2020 2020 2020 2065 7874 656e 7473           extents
+00045eb0: 203d 205b 7365 6c66 2e67 6574 5f6c 656e   = [self.get_len
+00045ec0: 6774 6828 6178 3d61 7829 2066 6f72 2061  gth(ax=ax) for a
+00045ed0: 7820 696e 2061 7865 735d 0a20 2020 2020  x in axes].     
+00045ee0: 2020 2020 2020 2069 6d5f 6c69 6d73 203d         im_lims =
+00045ef0: 205b 7365 6c66 2e69 6d61 6765 2e67 6574   [self.image.get
+00045f00: 5f6c 656e 6774 6828 6178 3d61 7829 2066  _length(ax=ax) f
+00045f10: 6f72 2061 7820 696e 2061 7865 735d 0a20  or ax in axes]. 
+00045f20: 2020 2020 2020 2020 2020 207a 6f6f 6d20             zoom 
+00045f30: 3d20 6d69 6e28 5b69 6d5f 6c69 6d73 5b69  = min([im_lims[i
+00045f40: 5d20 2f20 6578 7465 6e74 735b 695d 2066  ] / extents[i] f
+00045f50: 6f72 2069 2069 6e20 7261 6e67 6528 3229  or i in range(2)
+00045f60: 5d29 202a 2030 2e38 0a20 2020 2020 2020  ]) * 0.8.       
+00045f70: 2020 2020 207a 6f6f 6d5f 6365 6e74 7265       zoom_centre
+00045f80: 203d 2073 656c 662e 6765 745f 6365 6e74   = self.get_cent
+00045f90: 7265 2829 0a20 2020 2020 2020 2020 2020  re().           
+00045fa0: 2069 6620 7a6f 6f6d 203e 2031 3a0a 2020   if zoom > 1:.  
+00045fb0: 2020 2020 2020 2020 2020 2020 2020 6b77                kw
+00045fc0: 6172 6773 2e73 6574 6465 6661 756c 7428  args.setdefault(
+00045fd0: 227a 6f6f 6d22 2c20 7a6f 6f6d 290a 2020  "zoom", zoom).  
+00045fe0: 2020 2020 2020 2020 2020 2020 2020 6b77                kw
+00045ff0: 6172 6773 2e73 6574 6465 6661 756c 7428  args.setdefault(
+00046000: 227a 6f6f 6d5f 6365 6e74 7265 222c 207a  "zoom_centre", z
+00046010: 6f6f 6d5f 6365 6e74 7265 290a 0a20 2020  oom_centre)..   
+00046020: 2020 2020 2020 2020 2023 2053 6574 2069           # Set i
+00046030: 6e69 7469 616c 2073 6c69 6365 0a20 2020  nitial slice.   
+00046040: 2020 2020 2020 2020 206b 7761 7267 732e           kwargs.
+00046050: 7365 7464 6566 6175 6c74 280a 2020 2020  setdefault(.    
+00046060: 2020 2020 2020 2020 2020 2020 2269 6e69              "ini
+00046070: 745f 736c 6963 6522 2c20 0a20 2020 2020  t_slice", .     
+00046080: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00046090: 696d 6167 652e 6964 785f 746f 5f73 6c69  image.idx_to_sli
+000460a0: 6365 2873 656c 662e 6669 6e64 5f6d 6f73  ce(self.find_mos
+000460b0: 745f 706f 7075 6c61 7465 645f 736c 6963  t_populated_slic
+000460c0: 6528 7669 6577 292c 0a20 2020 2020 2020  e(view),.       
+000460d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000460e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000460f0: 2073 6b72 742e 696d 6167 652e 5f73 6c69   skrt.image._sli
+00046100: 6365 5f61 7865 735b 7669 6577 5d29 290a  ce_axes[view])).
+00046110: 0a20 2020 2020 2020 2069 6620 2270 6c6f  .        if "plo
+00046120: 745f 7479 7065 2220 696e 206b 7761 7267  t_type" in kwarg
+00046130: 733a 0a20 2020 2020 2020 2020 2020 206b  s:.            k
+00046140: 7761 7267 735b 2272 6f69 5f70 6c6f 745f  wargs["roi_plot_
+00046150: 7479 7065 225d 203d 206b 7761 7267 732e  type"] = kwargs.
+00046160: 706f 7028 2270 6c6f 745f 7479 7065 2229  pop("plot_type")
+00046170: 0a0a 2020 2020 2020 2020 2320 5669 6577  ..        # View
+00046180: 2077 6974 6820 696d 6167 650a 2020 2020   with image.    
+00046190: 2020 2020 6966 2069 6e63 6c75 6465 5f69      if include_i
+000461a0: 6d61 6765 2061 6e64 2073 656c 662e 696d  mage and self.im
+000461b0: 6167 6520 6973 206e 6f74 204e 6f6e 653a  age is not None:
+000461c0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+000461d0: 726f 6973 2069 7320 4e6f 6e65 3a0a 2020  rois is None:.  
+000461e0: 2020 2020 2020 2020 2020 2020 2020 726f                ro
+000461f0: 6973 203d 2073 656c 660a 2020 2020 2020  is = self.      
+00046200: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+00046210: 2020 2020 2020 2020 2020 2020 6966 2073              if s
+00046220: 6b72 742e 636f 7265 2e69 735f 6c69 7374  krt.core.is_list
+00046230: 2872 6f69 7329 3a0a 2020 2020 2020 2020  (rois):.        
+00046240: 2020 2020 2020 2020 2020 2020 726f 6973              rois
+00046250: 203d 205b 7365 6c66 5d20 2b20 726f 6973   = [self] + rois
+00046260: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00046270: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+00046280: 2020 2020 2020 2020 2020 2072 6f69 7320             rois 
+00046290: 3d20 5b73 656c 662c 2072 6f69 735d 0a20  = [self, rois]. 
+000462a0: 2020 2020 2020 2020 2020 2062 7620 3d20             bv = 
+000462b0: 4265 7474 6572 5669 6577 6572 2873 656c  BetterViewer(sel
+000462c0: 662e 696d 6167 652c 2072 6f69 733d 726f  f.image, rois=ro
+000462d0: 6973 2c20 2a2a 6b77 6172 6773 290a 0a20  is, **kwargs).. 
+000462e0: 2020 2020 2020 2023 2056 6965 7720 7769         # View wi
+000462f0: 7468 6f75 7420 696d 6167 650a 2020 2020  thout image.    
+00046300: 2020 2020 656c 7365 3a0a 0a20 2020 2020      else:..     
+00046310: 2020 2020 2020 2069 6620 6b77 6172 6773         if kwargs
+00046320: 2e67 6574 2822 7469 746c 6522 2c20 4e6f  .get("title", No
+00046330: 6e65 2920 6973 204e 6f6e 653a 0a20 2020  ne) is None:.   
+00046340: 2020 2020 2020 2020 2020 2020 206b 7761               kwa
+00046350: 7267 735b 2274 6974 6c65 225d 203d 2073  rgs["title"] = s
+00046360: 656c 662e 6e61 6d65 0a0a 2020 2020 2020  elf.name..      
+00046370: 2020 2020 2020 7374 7275 6374 7572 655f        structure_
+00046380: 7365 745f 746d 7020 3d20 7365 6c66 0a0a  set_tmp = self..
+00046390: 2020 2020 2020 2020 2020 2020 2320 4d61              # Ma
+000463a0: 6b65 2064 756d 6d79 2069 6d61 6765 0a20  ke dummy image. 
+000463b0: 2020 2020 2020 2020 2020 2069 6d20 3d20             im = 
+000463c0: 7365 6c66 2e67 6574 5f64 756d 6d79 5f69  self.get_dummy_i
+000463d0: 6d61 6765 2862 7566 6665 723d 6275 6666  mage(buffer=buff
+000463e0: 6572 2c20 0a20 2020 2020 2020 2020 2020  er, .           
+000463f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00046400: 2020 2020 2020 2020 2020 2076 6f78 656c             voxel
+00046410: 5f73 697a 653d 766f 7865 6c5f 7369 7a65  _size=voxel_size
+00046420: 290a 2020 2020 2020 2020 2020 2020 7374  ).            st
+00046430: 7275 6374 7572 655f 7365 745f 746d 7020  ructure_set_tmp 
+00046440: 3d20 7365 6c66 2e63 6c6f 6e65 280a 2020  = self.clone(.  
+00046450: 2020 2020 2020 2020 2020 2020 2020 636f                co
+00046460: 7079 5f72 6f69 733d 5472 7565 2c20 0a20  py_rois=True, . 
+00046470: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+00046480: 6f70 795f 726f 695f 6461 7461 3d46 616c  opy_roi_data=Fal
+00046490: 7365 2c0a 2020 2020 2020 2020 2020 2020  se,.            
+000464a0: 290a 2020 2020 2020 2020 2020 2020 7374  ).            st
+000464b0: 7275 6374 7572 655f 7365 745f 746d 702e  ructure_set_tmp.
+000464c0: 7365 745f 696d 6167 6528 696d 290a 2020  set_image(im).  
+000464d0: 2020 2020 2020 2020 2020 2222 220a 2020            """.  
+000464e0: 2020 2020 2020 2020 2020 6966 2073 656c            if sel
+000464f0: 662e 726f 6973 5b30 5d2e 636f 6e74 6f75  f.rois[0].contou
+00046500: 7273 5f6f 6e6c 7920 6f72 2054 7275 653a  rs_only or True:
+00046510: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00046520: 2069 6d20 3d20 7365 6c66 2e67 6574 5f64   im = self.get_d
+00046530: 756d 6d79 5f69 6d61 6765 2862 7566 6665  ummy_image(buffe
+00046540: 723d 6275 6666 6572 2c20 0a20 2020 2020  r=buffer, .     
+00046550: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00046560: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00046570: 2020 2020 2076 6f78 656c 5f73 697a 653d       voxel_size=
+00046580: 766f 7865 6c5f 7369 7a65 290a 2020 2020  voxel_size).    
+00046590: 2020 2020 2020 2020 2020 2020 7374 7275              stru
+000465a0: 6374 7572 655f 7365 745f 746d 7020 3d20  cture_set_tmp = 
+000465b0: 7365 6c66 2e63 6c6f 6e65 280a 2020 2020  self.clone(.    
+000465c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000465d0: 636f 7079 5f72 6f69 733d 5472 7565 2c20  copy_rois=True, 
+000465e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000465f0: 2020 2020 2063 6f70 795f 726f 695f 6461       copy_roi_da
+00046600: 7461 3d46 616c 7365 0a20 2020 2020 2020  ta=False.       
+00046610: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
+00046620: 2020 2020 2020 2020 2020 2066 6f72 2072             for r
+00046630: 6f69 2069 6e20 7374 7275 6374 7572 655f  oi in structure_
+00046640: 7365 745f 746d 702e 726f 6973 3a0a 2020  set_tmp.rois:.  
+00046650: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00046660: 2020 6966 2072 6f69 2e63 6f6e 746f 7572    if roi.contour
+00046670: 735f 6f6e 6c79 3a0a 2020 2020 2020 2020  s_only:.        
+00046680: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00046690: 726f 692e 7365 745f 696d 6167 6528 696d  roi.set_image(im
+000466a0: 290a 2020 2020 2020 2020 2020 2020 656c  ).            el
+000466b0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+000466c0: 2020 2020 696d 203d 2073 6b72 742e 696d      im = skrt.im
+000466d0: 6167 652e 496d 6167 6528 0a20 2020 2020  age.Image(.     
+000466e0: 2020 2020 2020 2020 2020 2020 2020 206e                 n
+000466f0: 702e 6f6e 6573 2873 656c 662e 726f 6973  p.ones(self.rois
+00046700: 5b30 5d2e 7368 6170 6529 202a 2031 6534  [0].shape) * 1e4
+00046710: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00046720: 2020 2020 2020 6166 6669 6e65 3d73 656c        affine=sel
+00046730: 662e 726f 6973 5b30 5d2e 6166 6669 6e65  f.rois[0].affine
+00046740: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00046750: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
+00046760: 2222 220a 0a20 2020 2020 2020 2020 2020  """..           
+00046770: 2069 6620 726f 6973 2069 7320 4e6f 6e65   if rois is None
+00046780: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00046790: 2020 726f 6973 203d 2073 7472 7563 7475    rois = structu
+000467a0: 7265 5f73 6574 5f74 6d70 0a20 2020 2020  re_set_tmp.     
+000467b0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+000467c0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+000467d0: 736b 7274 2e63 6f72 652e 6973 5f6c 6973  skrt.core.is_lis
+000467e0: 7428 726f 6973 293a 0a20 2020 2020 2020  t(rois):.       
+000467f0: 2020 2020 2020 2020 2020 2020 2072 6f69               roi
+00046800: 7320 3d20 5b73 7472 7563 7475 7265 5f73  s = [structure_s
+00046810: 6574 5f74 6d70 5d20 2b20 726f 6973 0a20  et_tmp] + rois. 
+00046820: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+00046830: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+00046840: 2020 2020 2020 2020 2072 6f69 7320 3d20           rois = 
+00046850: 5b73 7472 7563 7475 7265 5f73 6574 5f74  [structure_set_t
+00046860: 6d70 2c20 726f 6973 5d0a 2020 2020 2020  mp, rois].      
+00046870: 2020 2020 2020 6b77 6172 6773 5b22 7368        kwargs["sh
+00046880: 6f77 225d 203d 2046 616c 7365 0a20 2020  ow"] = False.   
+00046890: 2020 2020 2020 2020 2062 7620 3d20 4265           bv = Be
+000468a0: 7474 6572 5669 6577 6572 2869 6d2c 2072  tterViewer(im, r
+000468b0: 6f69 733d 726f 6973 2c20 2a2a 6b77 6172  ois=rois, **kwar
+000468c0: 6773 290a 0a20 2020 2020 2020 2020 2020  gs)..           
+000468d0: 2023 2041 646a 7573 7420 5549 0a20 2020   # Adjust UI.   
+000468e0: 2020 2020 2020 2020 206e 6f5f 7569 203d           no_ui =
+000468f0: 206b 7761 7267 732e 6765 7428 226e 6f5f   kwargs.get("no_
+00046900: 7569 222c 2073 6b72 742e 636f 7265 2e44  ui", skrt.core.D
+00046910: 6566 6175 6c74 7328 292e 6e6f 5f75 6929  efaults().no_ui)
+00046920: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00046930: 6e6f 7420 6e6f 5f75 693a 0a20 2020 2020  not no_ui:.     
+00046940: 2020 2020 2020 2020 2020 2062 762e 6d61             bv.ma
+00046950: 6b65 5f75 6928 6e6f 5f69 6e74 656e 7369  ke_ui(no_intensi
+00046960: 7479 3d54 7275 6529 0a20 2020 2020 2020  ty=True).       
+00046970: 2020 2020 2020 2020 2062 762e 7368 6f77           bv.show
+00046980: 2829 0a0a 2020 2020 2020 2020 7265 7475  ()..        retu
+00046990: 726e 2062 760a 0a20 2020 2064 6566 2067  rn bv..    def g
+000469a0: 6574 5f65 7874 656e 7428 7365 6c66 2c20  et_extent(self, 
+000469b0: 2a2a 6b77 6172 6773 293a 0a20 2020 2020  **kwargs):.     
+000469c0: 2020 2022 2222 4765 7420 6d69 6e20 616e     """Get min an
+000469d0: 6420 6d61 7820 6578 7465 6e74 206f 6620  d max extent of 
+000469e0: 616c 6c20 524f 4973 2069 6e20 7468 6520  all ROIs in the 
+000469f0: 5374 7275 6374 7572 6553 6574 2e22 2222  StructureSet."""
+00046a00: 0a0a 2020 2020 2020 2020 616c 6c5f 6578  ..        all_ex
+00046a10: 7465 6e74 7320 3d20 5b5d 0a20 2020 2020  tents = [].     
+00046a20: 2020 2066 6f72 2072 6f69 2069 6e20 7365     for roi in se
+00046a30: 6c66 2e67 6574 5f72 6f69 7328 6967 6e6f  lf.get_rois(igno
+00046a40: 7265 5f65 6d70 7479 3d54 7275 6529 3a0a  re_empty=True):.
+00046a50: 2020 2020 2020 2020 2020 2020 616c 6c5f              all_
+00046a60: 6578 7465 6e74 732e 6578 7465 6e64 2872  extents.extend(r
+00046a70: 6f69 2e67 6574 5f65 7874 656e 7428 2a2a  oi.get_extent(**
+00046a80: 6b77 6172 6773 2929 0a20 2020 2020 2020  kwargs)).       
+00046a90: 2072 6574 7572 6e20 6d69 6e28 616c 6c5f   return min(all_
+00046aa0: 6578 7465 6e74 7329 2c20 6d61 7828 616c  extents), max(al
+00046ab0: 6c5f 6578 7465 6e74 7329 0a0a 2020 2020  l_extents)..    
+00046ac0: 6465 6620 6765 745f 6578 7465 6e74 7328  def get_extents(
+00046ad0: 7365 6c66 2c20 726f 695f 6e61 6d65 733d  self, roi_names=
+00046ae0: 4e6f 6e65 2c20 6275 6666 6572 3d4e 6f6e  None, buffer=Non
+00046af0: 652c 2062 7566 6665 725f 756e 6974 733d  e, buffer_units=
+00046b00: 226d 6d22 2c0a 2020 2020 2020 2020 2020  "mm",.          
+00046b10: 2020 6d65 7468 6f64 3d4e 6f6e 652c 206f    method=None, o
+00046b20: 7269 6769 6e3d 4e6f 6e65 293a 0a20 2020  rigin=None):.   
+00046b30: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+00046b40: 2047 6574 206d 696e 696d 756d 2061 6e64   Get minimum and
+00046b50: 206d 6178 696d 756d 2065 7874 656e 7420   maximum extent 
+00046b60: 6f66 2053 7472 7563 7475 7265 5365 7420  of StructureSet 
+00046b70: 524f 4973 2c0a 2020 2020 2020 2020 696e  ROIs,.        in
+00046b80: 206d 6d20 616c 6f6e 6720 616c 6c20 7468   mm along all th
+00046b90: 7265 6520 6178 6573 2c20 7265 7475 726e  ree axes, return
+00046ba0: 6564 2069 6e20 6f72 6465 7220 5b78 2c20  ed in order [x, 
+00046bb0: 792c 207a 5d2e 0a20 2020 2020 2020 204f  y, z]..        O
+00046bc0: 7074 696f 6e61 6c6c 7920 6170 706c 7920  ptionally apply 
+00046bd0: 6120 6275 6666 6572 2074 6f20 7468 6520  a buffer to the 
+00046be0: 6578 7465 6e74 7320 7375 6368 2074 6861  extents such tha
+00046bf0: 7420 7468 6579 2063 6f76 6572 0a20 2020  t they cover.   
+00046c00: 2020 2020 206d 6f72 6520 7468 616e 2074       more than t
+00046c10: 6865 2072 6567 696f 6e20 6f66 2074 6865  he region of the
+00046c20: 2052 4f49 732e 0a0a 2020 2020 2020 2020   ROIs...        
+00046c30: 2a2a 5061 7261 6d65 7465 7273 3a2a 2a0a  **Parameters:**.
+00046c40: 0a20 2020 2020 2020 2072 6f69 5f6e 616d  .        roi_nam
+00046c50: 6573 203a 206c 6973 742c 2064 6566 6175  es : list, defau
+00046c60: 6c74 3d4e 6f6e 650a 2020 2020 2020 2020  lt=None.        
+00046c70: 2020 2020 4c69 7374 206f 6620 6e61 6d65      List of name
+00046c80: 7320 6f66 2052 4f49 7320 746f 2062 6520  s of ROIs to be 
+00046c90: 636f 6e73 6964 6572 6564 2e20 2049 6620  considered.  If 
+00046ca0: 4e6f 6e65 2c20 616c 6c20 6f66 2074 6865  None, all of the
+00046cb0: 0a20 2020 2020 2020 2020 2020 2073 7472  .            str
+00046cc0: 7563 7475 7265 2073 6574 2773 2052 4f49  ucture set's ROI
+00046cd0: 7320 6172 6520 636f 6e73 6964 6572 6564  s are considered
+00046ce0: 2e0a 0a20 2020 2020 2020 2062 7566 6665  ...        buffe
+00046cf0: 7220 3a20 666c 6f61 742c 2064 6566 6175  r : float, defau
+00046d00: 6c74 3d4e 6f6e 650a 2020 2020 2020 2020  lt=None.        
+00046d10: 2020 2020 4f70 7469 6f6e 616c 2062 7566      Optional buf
+00046d20: 6665 7220 746f 2061 6464 2074 6f20 7468  fer to add to th
+00046d30: 6520 6578 7465 6e74 732e 2055 6e69 7473  e extents. Units
+00046d40: 2073 6574 2062 7920 6062 7566 6665 725f   set by `buffer_
+00046d50: 756e 6974 7360 2e0a 0a20 2020 2020 2020  units`...       
+00046d60: 2062 7566 6665 725f 756e 6974 7320 3a20   buffer_units : 
+00046d70: 7374 722c 2064 6566 6175 6c74 3d22 6d6d  str, default="mm
+00046d80: 220a 2020 2020 2020 2020 2020 2020 556e  ".            Un
+00046d90: 6974 7320 666f 7220 6275 6666 6572 2c20  its for buffer, 
+00046da0: 6966 2075 7369 6e67 2e20 4361 6e20 6265  if using. Can be
+00046db0: 2022 6d6d 222c 2022 766f 7865 6c73 222c   "mm", "voxels",
+00046dc0: 206f 7220 2266 7261 6322 2028 7768 6963   or "frac" (whic
+00046dd0: 680a 2020 2020 2020 2020 2020 2020 6170  h.            ap
+00046de0: 706c 6965 7320 6275 6666 6572 2061 7320  plies buffer as 
+00046df0: 6120 6672 6163 7469 6f6e 206f 6620 746f  a fraction of to
+00046e00: 7461 6c20 6c65 6e67 7468 2069 6e20 6561  tal length in ea
+00046e10: 6368 2064 696d 656e 7369 6f6e 292e 0a0a  ch dimension)...
+00046e20: 2020 2020 2020 2020 6d65 7468 6f64 203a          method :
+00046e30: 2073 7472 2c20 6465 6661 756c 743d 4e6f   str, default=No
+00046e40: 6e65 0a20 2020 2020 2020 2020 2020 204d  ne.            M
+00046e50: 6574 686f 6420 746f 2075 7365 2066 6f72  ethod to use for
+00046e60: 2065 7874 656e 7420 6361 6c63 756c 6174   extent calculat
+00046e70: 696f 6e2e 2043 616e 2062 653a 200a 0a20  ion. Can be: .. 
+00046e80: 2020 2020 2020 2020 2020 2020 2020 202a                 *
+00046e90: 2022 636f 6e74 6f75 7222 3a20 6765 7420   "contour": get 
+00046ea0: 6578 7465 6e74 2066 726f 6d20 6d69 6e2f  extent from min/
+00046eb0: 6d61 7820 706f 7369 7469 6f6e 7320 6f66  max positions of
+00046ec0: 2063 6f6e 746f 7572 2873 292e 0a20 2020   contour(s)..   
+00046ed0: 2020 2020 2020 2020 2020 2020 202a 2022               * "
+00046ee0: 6d61 736b 223a 2067 6574 2065 7874 656e  mask": get exten
+00046ef0: 7420 6672 6f6d 206d 696e 2f6d 6178 2070  t from min/max p
+00046f00: 6f73 6974 696f 6e73 206f 6620 766f 7865  ositions of voxe
+00046f10: 6c73 2069 6e20 7468 6520 0a20 2020 2020  ls in the .     
+00046f20: 2020 2020 2020 2020 2020 2020 2062 696e               bin
+00046f30: 6172 7920 6d61 736b 2e0a 2020 2020 2020  ary mask..      
+00046f40: 2020 2020 2020 2020 2020 2a20 4e6f 6e65            * None
+00046f50: 3a20 7573 6520 7468 6520 6d65 7468 6f64  : use the method
+00046f60: 2073 6574 2069 6e20 7365 6c66 2e64 6566   set in self.def
+00046f70: 6175 6c74 5f67 656f 6d5f 6d65 7468 6f64  ault_geom_method
+00046f80: 2e0a 0a20 2020 2020 2020 206f 7269 6769  ...        origi
+00046f90: 6e20 3a20 7475 706c 652c 2064 6566 6175  n : tuple, defau
+00046fa0: 6c74 3d4e 6f6e 650a 2020 2020 2020 2020  lt=None.        
+00046fb0: 2020 2020 5475 706c 6520 7370 6563 6966      Tuple specif
+00046fc0: 7969 6e67 2074 6865 2028 782c 2079 2c20  ying the (x, y, 
+00046fd0: 7a29 2063 6f6f 7264 696e 6174 6573 206f  z) coordinates o
+00046fe0: 6620 7468 6520 706f 696e 740a 2020 2020  f the point.    
+00046ff0: 2020 2020 2020 2020 7769 7468 2072 6573          with res
+00047000: 7065 6374 2074 6f20 7768 6963 6820 6578  pect to which ex
+00047010: 7465 6e74 7320 6172 6520 746f 2062 6520  tents are to be 
+00047020: 6465 7465 726d 696e 6564 2e0a 2020 2020  determined..    
+00047030: 2020 2020 2020 2020 4966 204e 6f6e 652c          If None,
+00047040: 2074 6865 6e20 2830 2c20 302c 2030 2920   then (0, 0, 0) 
+00047050: 6973 2075 7365 642e 0a20 2020 2020 2020  is used..       
+00047060: 2022 2222 0a20 2020 2020 2020 2072 6574   """.        ret
+00047070: 7572 6e20 7365 6c66 2e63 6f6d 6269 6e65  urn self.combine
+00047080: 5f72 6f69 7328 726f 695f 6e61 6d65 7329  _rois(roi_names)
+00047090: 2e67 6574 5f65 7874 656e 7473 280a 2020  .get_extents(.  
+000470a0: 2020 2020 2020 2020 2020 2020 2020 6275                bu
+000470b0: 6666 6572 2c20 6275 6666 6572 5f75 6e69  ffer, buffer_uni
+000470c0: 7473 2c20 6d65 7468 6f64 2c20 6f72 6967  ts, method, orig
+000470d0: 696e 290a 0a20 2020 2064 6566 2067 6574  in)..    def get
+000470e0: 5f63 726f 705f 6c69 6d69 7473 2873 656c  _crop_limits(sel
+000470f0: 662c 2072 6f69 5f6e 616d 6573 3d4e 6f6e  f, roi_names=Non
+00047100: 652c 2063 726f 705f 6d61 7267 696e 733d  e, crop_margins=
+00047110: 4e6f 6e65 2c20 6d65 7468 6f64 3d4e 6f6e  None, method=Non
+00047120: 6529 3a0a 2020 2020 2020 2020 2222 220a  e):.        """.
+00047130: 2020 2020 2020 2020 4765 7420 6372 6f70          Get crop
+00047140: 206c 696d 6974 7320 636f 7272 6573 706f   limits correspo
+00047150: 6e64 696e 6720 746f 2053 7472 7563 7475  nding to Structu
+00047160: 7265 5365 7420 524f 4920 6578 7465 6e74  reSet ROI extent
+00047170: 7320 706c 7573 206d 6172 6769 6e73 2e0a  s plus margins..
+00047180: 0a20 2020 2020 2020 2054 6865 2074 7570  .        The tup
+00047190: 6c65 7320 6f66 206c 696d 6974 7320 7265  les of limits re
+000471a0: 7475 726e 6564 2c20 696e 2074 6865 206f  turned, in the o
+000471b0: 7264 6572 2028 782c 2079 2c20 7a29 2063  rder (x, y, z) c
+000471c0: 616e 0a20 2020 2020 2020 2062 6520 7573  an.        be us
+000471d0: 6564 2c20 666f 7220 6578 616d 706c 652c  ed, for example,
+000471e0: 2061 7320 696e 7075 7473 2074 6f20 736b   as inputs to sk
+000471f0: 7274 2e69 6d61 6765 2e49 6d61 6765 2e63  rt.image.Image.c
+00047200: 726f 7028 292e 0a0a 2020 2020 2020 2020  rop()...        
+00047210: 5468 6973 206d 6574 686f 6420 6973 2073  This method is s
+00047220: 696d 696c 6172 2074 6f20 7468 6520 6d65  imilar to the me
+00047230: 7468 6f64 2067 6574 5f65 7874 656e 7473  thod get_extents
+00047240: 2829 2c20 6275 7420 616c 6c6f 7773 0a20  (), but allows. 
+00047250: 2020 2020 2020 2064 6966 6665 7265 6e74         different
+00047260: 206d 6172 6769 6e73 206f 6e20 6561 6368   margins on each
+00047270: 2073 6964 6520 6f66 2074 6865 2053 7472   side of the Str
+00047280: 7563 7475 7265 5365 742e 0a0a 2020 2020  uctureSet...    
+00047290: 2020 2020 2a2a 5061 7261 6d65 7465 7273      **Parameters
+000472a0: 3a2a 2a0a 0a20 2020 2020 2020 2072 6f69  :**..        roi
+000472b0: 5f6e 616d 6573 203a 206c 6973 742c 2064  _names : list, d
+000472c0: 6566 6175 6c74 3d4e 6f6e 650a 2020 2020  efault=None.    
+000472d0: 2020 2020 2020 2020 4c69 7374 206f 6620          List of 
+000472e0: 6e61 6d65 7320 6f66 2052 4f49 7320 746f  names of ROIs to
+000472f0: 2062 6520 636f 6e73 6964 6572 6564 2e20   be considered. 
+00047300: 2049 6620 4e6f 6e65 2c20 616c 6c20 6f66   If None, all of
+00047310: 2074 6865 0a20 2020 2020 2020 2020 2020   the.           
+00047320: 2073 7472 7563 7475 7265 2073 6574 2773   structure set's
+00047330: 2052 4f49 7320 6172 6520 636f 6e73 6964   ROIs are consid
+00047340: 6572 6564 2e0a 0a20 2020 2020 2020 2063  ered...        c
+00047350: 726f 705f 6d61 7267 696e 7320 3a20 666c  rop_margins : fl
+00047360: 6f61 742f 7475 706c 652c 2064 6566 6175  oat/tuple, defau
+00047370: 6c74 3d4e 6f6e 650a 2020 2020 2020 2020  lt=None.        
+00047380: 2020 2020 466c 6f61 7420 6f72 2074 6872      Float or thr
+00047390: 6565 2d65 6c65 6d65 6e74 2074 7570 6c65  ee-element tuple
+000473a0: 2073 7065 6369 6679 696e 6720 7468 6520   specifying the 
+000473b0: 6d61 7267 696e 732c 2069 6e20 6d6d 2c0a  margins, in mm,.
+000473c0: 2020 2020 2020 2020 2020 2020 746f 2062              to b
+000473d0: 6520 6164 6465 6420 746f 2053 7472 7563  e added to Struc
+000473e0: 7475 7265 5365 7420 6578 7465 6e74 732e  tureSet extents.
+000473f0: 2020 4966 2061 2066 6c6f 6174 2c20 6d69    If a float, mi
+00047400: 6e75 7320 616e 6420 706c 7573 2074 6865  nus and plus the
+00047410: 0a20 2020 2020 2020 2020 2020 2076 616c  .            val
+00047420: 7565 2073 7065 6369 6669 6564 2061 7265  ue specified are
+00047430: 2061 6464 6564 2074 6f20 6c6f 7765 7220   added to lower 
+00047440: 616e 6420 7570 7065 7220 6578 7465 6e74  and upper extent
+00047450: 7320 7265 7370 6563 7469 7665 6c79 0a20  s respectively. 
+00047460: 2020 2020 2020 2020 2020 2061 6c6f 6e67             along
+00047470: 2065 6163 6820 6178 6973 2e20 2049 6620   each axis.  If 
+00047480: 6120 7468 7265 652d 656c 656d 656e 7420  a three-element 
+00047490: 7475 706c 652c 2065 6c65 6d65 6e74 7320  tuple, elements 
+000474a0: 6172 650a 2020 2020 2020 2020 2020 2020  are.            
+000474b0: 7461 6b65 6e20 746f 2073 7065 6369 6679  taken to specify
+000474c0: 206d 6172 6769 6e73 2069 6e20 7468 6520   margins in the 
+000474d0: 6f72 6465 7220 2878 2c20 792c 207a 292e  order (x, y, z).
+000474e0: 2020 456c 656d 656e 7473 0a20 2020 2020    Elements.     
+000474f0: 2020 2020 2020 2063 616e 2062 6520 6569         can be ei
+00047500: 7468 6572 2066 6c6f 6174 7320 286d 696e  ther floats (min
+00047510: 7573 2061 6e64 2070 6c75 7320 7468 6520  us and plus the 
+00047520: 7661 6c75 6520 6164 6465 6420 7265 7370  value added resp
+00047530: 6563 7469 7665 6c79 0a20 2020 2020 2020  ectively.       
+00047540: 2020 2020 2074 6f20 6c6f 7765 7220 616e       to lower an
+00047550: 6420 7570 7065 7220 6578 7465 6e74 7329  d upper extents)
+00047560: 206f 7220 7477 6f2d 656c 656d 656e 7420   or two-element 
+00047570: 7475 706c 6573 2028 656c 656d 656e 7473  tuples (elements
+00047580: 2030 2061 6e64 2031 0a20 2020 2020 2020   0 and 1.       
+00047590: 2020 2020 2061 6464 6564 2072 6573 7065       added respe
+000475a0: 6374 6976 656c 7920 746f 206c 6f77 6572  ctively to lower
+000475b0: 2061 6e64 2075 7070 6572 2065 7874 656e   and upper exten
+000475c0: 7473 292e 0a0a 2020 2020 2020 2020 6d65  ts)...        me
+000475d0: 7468 6f64 203a 2073 7472 2c20 6465 6661  thod : str, defa
+000475e0: 756c 743d 4e6f 6e65 0a20 2020 2020 2020  ult=None.       
+000475f0: 2020 2020 204d 6574 686f 6420 746f 2075       Method to u
+00047600: 7365 2066 6f72 2065 7874 656e 7420 6361  se for extent ca
+00047610: 6c63 756c 6174 696f 6e2e 2043 616e 2062  lculation. Can b
+00047620: 653a 0a0a 2020 2020 2020 2020 2020 2020  e:..            
+00047630: 2020 2020 2a20 2263 6f6e 746f 7572 223a      * "contour":
+00047640: 2067 6574 2065 7874 656e 7420 6672 6f6d   get extent from
+00047650: 206d 696e 2f6d 6178 2070 6f73 6974 696f   min/max positio
+00047660: 6e73 206f 6620 636f 6e74 6f75 7228 7329  ns of contour(s)
+00047670: 2e0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00047680: 2020 2a20 226d 6173 6b22 3a20 6765 7420    * "mask": get 
+00047690: 6578 7465 6e74 2066 726f 6d20 6d69 6e2f  extent from min/
+000476a0: 6d61 7820 706f 7369 7469 6f6e 7320 6f66  max positions of
+000476b0: 2076 6f78 656c 7320 696e 2074 6865 0a20   voxels in the. 
+000476c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000476d0: 2062 696e 6172 7920 6d61 736b 2e0a 2020   binary mask..  
+000476e0: 2020 2020 2020 2020 2020 2020 2020 2a20                * 
+000476f0: 4e6f 6e65 3a20 7573 6520 7468 6520 6d65  None: use the me
+00047700: 7468 6f64 2073 6574 2069 6e20 7365 6c66  thod set in self
+00047710: 2e64 6566 6175 6c74 5f67 656f 6d5f 6d65  .default_geom_me
+00047720: 7468 6f64 2e0a 2020 2020 2020 2020 2222  thod..        ""
+00047730: 220a 2020 2020 2020 2020 7265 7475 726e  ".        return
+00047740: 2073 656c 662e 636f 6d62 696e 655f 726f   self.combine_ro
+00047750: 6973 2872 6f69 5f6e 616d 6573 292e 6765  is(roi_names).ge
+00047760: 745f 6372 6f70 5f6c 696d 6974 7328 0a20  t_crop_limits(. 
+00047770: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+00047780: 726f 705f 6d61 7267 696e 732c 206d 6574  rop_margins, met
+00047790: 686f 6429 0a0a 2020 2020 6465 6620 6765  hod)..    def ge
+000477a0: 745f 6262 6f78 5f63 656e 7472 655f 616e  t_bbox_centre_an
+000477b0: 645f 7769 6474 6873 2873 656c 662c 0a20  d_widths(self,. 
+000477c0: 2020 2020 2020 2020 2020 2072 6f69 5f6e             roi_n
+000477d0: 616d 6573 3d4e 6f6e 652c 2062 7566 6665  ames=None, buffe
+000477e0: 723d 4e6f 6e65 2c20 6275 6666 6572 5f75  r=None, buffer_u
+000477f0: 6e69 7473 3d22 6d6d 222c 206d 6574 686f  nits="mm", metho
+00047800: 643d 4e6f 6e65 293a 0a20 2020 2020 2020  d=None):.       
+00047810: 2022 2222 0a20 2020 2020 2020 2047 6574   """.        Get
+00047820: 2063 656e 7472 6520 616e 6420 7769 6474   centre and widt
+00047830: 6873 2069 6e20 6d6d 2061 6c6f 6e67 2061  hs in mm along a
+00047840: 6c6c 2074 6872 6565 2061 7865 7320 6f66  ll three axes of
+00047850: 2061 2062 6f75 6e64 696e 6720 626f 780a   a bounding box.
+00047860: 2020 2020 2020 2020 656e 636c 6f73 696e          enclosin
+00047870: 6720 5374 7275 6374 7572 6553 6574 2052  g StructureSet R
+00047880: 4f49 7320 616e 6420 6f70 7469 6f6e 616c  OIs and optional
+00047890: 2062 7566 6665 722e 2020 4365 6e74 7265   buffer.  Centre
+000478a0: 0a20 2020 2020 2020 2061 6e64 2077 6964  .        and wid
+000478b0: 7468 7320 6172 6520 7265 7475 726e 6564  ths are returned
+000478c0: 2061 7320 6120 7475 706c 6520 285b 782c   as a tuple ([x,
+000478d0: 2079 2c20 7a5d 2c20 5b64 782c 2064 792c   y, z], [dx, dy,
+000478e0: 2064 7a5d 292e 0a0a 2020 2020 2020 2020   dz])...        
+000478f0: 4d65 7468 6f64 2070 6172 616d 6574 6572  Method parameter
+00047900: 7320 6172 6520 7061 7373 6564 2074 6f0a  s are passed to.
+00047910: 2020 2020 2020 2020 736b 7274 2e73 7472          skrt.str
+00047920: 7563 7475 7265 732e 5374 7275 6374 7572  uctures.Structur
+00047930: 6553 6574 2e67 6574 5f65 7874 656e 7473  eSet.get_extents
+00047940: 2829 2074 6f20 6f62 7461 696e 2053 7472  () to obtain Str
+00047950: 7563 7475 7265 5365 740a 2020 2020 2020  uctureSet.      
+00047960: 2020 6578 7465 6e74 732e 2020 466f 7220    extents.  For 
+00047970: 7061 7261 6d65 7465 7220 6578 706c 616e  parameter explan
+00047980: 6174 696f 6e73 2c20 7365 650a 2020 2020  ations, see.    
+00047990: 2020 2020 736b 7274 2e73 7472 7563 7475      skrt.structu
+000479a0: 7265 732e 5374 7275 6374 7572 6553 6574  res.StructureSet
+000479b0: 2e67 6574 5f65 7874 656e 7473 2829 2064  .get_extents() d
+000479c0: 6f63 756d 656e 7461 7469 6f6e 2e0a 2020  ocumentation..  
+000479d0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+000479e0: 2020 6578 7465 6e74 7320 3d20 7365 6c66    extents = self
+000479f0: 2e67 6574 5f65 7874 656e 7473 2872 6f69  .get_extents(roi
+00047a00: 5f6e 616d 6573 2c20 6275 6666 6572 2c20  _names, buffer, 
+00047a10: 6275 6666 6572 5f75 6e69 7473 2c20 6d65  buffer_units, me
+00047a20: 7468 6f64 2920 0a20 2020 2020 2020 2063  thod) .        c
+00047a30: 656e 7472 6520 3d20 5b30 2e35 202a 2028  entre = [0.5 * (
+00047a40: 6578 7465 6e74 5b30 5d20 2b20 6578 7465  extent[0] + exte
+00047a50: 6e74 5b31 5d29 2066 6f72 2065 7874 656e  nt[1]) for exten
+00047a60: 7420 696e 2065 7874 656e 7473 5d0a 2020  t in extents].  
+00047a70: 2020 2020 2020 7769 6474 6873 203d 205b        widths = [
+00047a80: 2865 7874 656e 745b 315d 202d 2065 7874  (extent[1] - ext
+00047a90: 656e 745b 305d 2920 666f 7220 6578 7465  ent[0]) for exte
+00047aa0: 6e74 2069 6e20 6578 7465 6e74 735d 0a20  nt in extents]. 
+00047ab0: 2020 2020 2020 2072 6574 7572 6e20 2863         return (c
+00047ac0: 656e 7472 652c 2077 6964 7468 7329 0a0a  entre, widths)..
+00047ad0: 2020 2020 6465 6620 6765 745f 6475 6d6d      def get_dumm
+00047ae0: 795f 696d 6167 6528 7365 6c66 2c20 2a2a  y_image(self, **
+00047af0: 6b77 6172 6773 293a 0a20 2020 2020 2020  kwargs):.       
+00047b00: 2022 2222 4d61 6b65 2061 2064 756d 6d79   """Make a dummy
+00047b10: 2069 6d61 6765 2074 6861 7420 636f 7665   image that cove
+00047b20: 7273 2074 6865 2061 7265 6120 7370 616e  rs the area span
+00047b30: 6e65 6420 6279 2061 6c6c 2052 4f49 7320  ned by all ROIs 
+00047b40: 696e 2074 6869 730a 2020 2020 2020 2020  in this.        
+00047b50: 5374 7275 6374 7572 6553 6574 2e20 5265  StructureSet. Re
+00047b60: 7475 726e 7320 616e 2049 6d61 6765 206f  turns an Image o
+00047b70: 626a 6563 742e 0a0a 2020 2020 2020 2020  bject...        
+00047b80: 2a2a 5061 7261 6d65 7465 7273 3a2a 2a0a  **Parameters:**.
+00047b90: 2020 2020 2020 2020 0a20 2020 2020 2020          .       
+00047ba0: 2076 6f78 656c 5f73 697a 6520 3a20 6c69   voxel_size : li
+00047bb0: 7374 2c20 6465 6661 756c 743d 4e6f 6e65  st, default=None
+00047bc0: 0a20 2020 2020 2020 2020 2020 2056 6f78  .            Vox
+00047bd0: 656c 2073 697a 6520 696e 206d 6d20 696e  el size in mm in
+00047be0: 2074 6865 2064 756d 6d79 2069 6d61 6765   the dummy image
+00047bf0: 2069 6e20 7468 6520 782d 7920 706c 616e   in the x-y plan
+00047c00: 652c 2067 6976 656e 2061 7320 0a20 2020  e, given as .   
+00047c10: 2020 2020 2020 2020 205b 7678 2c20 7679           [vx, vy
+00047c20: 5d2e 2049 6620 3c73 6861 7065 3e20 616e  ]. If <shape> an
+00047c30: 6420 3c76 6f78 656c 5f73 697a 653e 2061  d <voxel_size> a
+00047c40: 7265 2062 6f74 6820 4e6f 6e65 2c20 766f  re both None, vo
+00047c50: 7865 6c20 7369 7a65 7320 6f66 0a20 2020  xel sizes of.   
+00047c60: 2020 2020 2020 2020 205b 312c 2031 5d20           [1, 1] 
+00047c70: 7769 6c6c 2062 6520 7573 6564 2062 7920  will be used by 
+00047c80: 6465 6661 756c 742e 2054 6865 2076 6f78  default. The vox
+00047c90: 656c 2073 697a 6520 696e 2074 6865 207a  el size in the z
+00047ca0: 2064 6972 6563 7469 6f6e 200a 2020 2020   direction .    
+00047cb0: 2020 2020 2020 2020 6973 2064 6566 696e          is defin
+00047cc0: 6564 2062 7920 3c73 6c69 6365 5f74 6869  ed by <slice_thi
+00047cd0: 636b 6e65 7373 3e2e 0a0a 2020 2020 2020  ckness>...      
+00047ce0: 2020 7368 6170 6520 3a20 6c69 7374 2c20    shape : list, 
+00047cf0: 6465 6661 756c 743d 4e6f 6e65 0a20 2020  default=None.   
+00047d00: 2020 2020 2020 2020 204e 756d 6265 7220           Number 
+00047d10: 6f66 2076 6f78 656c 7320 696e 2074 6865  of voxels in the
+00047d20: 2064 756d 6d79 2069 6d61 6765 2069 6e20   dummy image in 
+00047d30: 7468 6520 782d 7920 706c 616e 652c 2067  the x-y plane, g
+00047d40: 6976 656e 2061 730a 2020 2020 2020 2020  iven as.        
+00047d50: 2020 2020 5b6e 782c 206e 795d 2e20 4f6e      [nx, ny]. On
+00047d60: 6c79 2075 7365 6420 6966 203c 766f 7865  ly used if <voxe
+00047d70: 6c5f 7369 7a65 3e20 6973 204e 6f6e 652e  l_size> is None.
+00047d80: 200a 2020 2020 2020 2020 2020 2020 5468   .            Th
+00047d90: 6520 6e75 6d62 6572 206f 6620 766f 7865  e number of voxe
+00047da0: 6c73 2069 6e20 7468 6520 7a20 6469 7265  ls in the z dire
+00047db0: 6374 696f 6e20 7769 6c6c 2062 6520 7461  ction will be ta
+00047dc0: 6b65 6e20 6672 6f6d 2074 6865 200a 2020  ken from the .  
+00047dd0: 2020 2020 2020 2020 2020 6e75 6d62 6572            number
+00047de0: 206f 6620 736c 6963 6573 2069 6e20 7468   of slices in th
+00047df0: 6520 782d 7920 636f 6e74 6f75 7273 2064  e x-y contours d
+00047e00: 6963 7469 6f6e 6172 792e 0a0a 2020 2020  ictionary...    
+00047e10: 2020 2020 6669 6c6c 5f76 616c 203a 2069      fill_val : i
+00047e20: 6e74 2f66 6c6f 6174 2c20 6465 6661 756c  nt/float, defaul
+00047e30: 743d 3165 340a 2020 2020 2020 2020 2020  t=1e4.          
+00047e40: 2020 5661 6c75 6520 7769 7468 2077 6869    Value with whi
+00047e50: 6368 2074 6865 2076 6f78 656c 7320 696e  ch the voxels in
+00047e60: 2074 6865 2064 756d 6d79 2069 6d61 6765   the dummy image
+00047e70: 2073 686f 756c 6420 6265 2066 696c 6c65   should be fille
+00047e80: 642e 200a 0a20 2020 2020 2020 2062 7566  d. ..        buf
+00047e90: 6665 7220 3a20 696e 742c 2064 6566 6175  fer : int, defau
+00047ea0: 6c74 3d31 0a20 2020 2020 2020 2020 2020  lt=1.           
+00047eb0: 204e 756d 6265 7220 6f66 2065 6d70 7479   Number of empty
+00047ec0: 2062 7566 6665 7220 766f 7865 6c73 2074   buffer voxels t
+00047ed0: 6f20 6164 6420 6f75 7473 6964 6520 7468  o add outside th
+00047ee0: 6520 524f 4920 696e 2065 6163 680a 2020  e ROI in each.  
+00047ef0: 2020 2020 2020 2020 2020 6469 7265 6374            direct
+00047f00: 696f 6e2e 0a0a 2020 2020 2020 2020 736c  ion...        sl
+00047f10: 6963 655f 7468 6963 6b6e 6573 7320 3a20  ice_thickness : 
+00047f20: 666c 6f61 742c 2064 6566 6175 6c74 3d4e  float, default=N
+00047f30: 6f6e 650a 2020 2020 2020 2020 2020 2020  one.            
+00047f40: 566f 7865 6c20 7369 7a65 2069 6e20 6d6d  Voxel size in mm
+00047f50: 2069 6e20 7468 6520 6475 6d6d 7920 696d   in the dummy im
+00047f60: 6167 6520 696e 2074 6865 207a 2064 6972  age in the z dir
+00047f70: 6563 7469 6f6e 2e20 2049 6620 4e6f 6e65  ection.  If None
+00047f80: 2c0a 2020 2020 2020 2020 2020 2020 7468  ,.            th
+00047f90: 6520 7661 6c75 6520 7573 6564 2069 7320  e value used is 
+00047fa0: 7468 6520 6d69 6e69 6d75 6d20 6469 7374  the minimum dist
+00047fb0: 616e 6365 2062 6574 7765 656e 2073 6c69  ance between sli
+00047fc0: 6365 2070 6f73 6974 696f 6e73 0a20 2020  ce positions.   
+00047fd0: 2020 2020 2020 2020 2069 6e20 7468 6520           in the 
+00047fe0: 782d 7920 636f 6e74 6f75 7273 2064 6963  x-y contours dic
+00047ff0: 7469 6f6e 6172 792e 0a20 2020 2020 2020  tionary..       
+00048000: 2022 2222 0a20 2020 2020 2020 2065 7874   """.        ext
+00048010: 656e 7473 203d 205b 7365 6c66 2e67 6574  ents = [self.get
+00048020: 5f65 7874 656e 7428 6178 3d61 7829 2066  _extent(ax=ax) f
+00048030: 6f72 2061 7820 696e 2073 6b72 742e 696d  or ax in skrt.im
+00048040: 6167 652e 5f61 7865 735d 0a20 2020 2020  age._axes].     
+00048050: 2020 2073 6c69 6365 5f74 6869 636b 6e65     slice_thickne
+00048060: 7373 203d 206b 7761 7267 732e 706f 7028  ss = kwargs.pop(
+00048070: 2273 6c69 6365 5f74 6869 636b 6e65 7373  "slice_thickness
+00048080: 222c 204e 6f6e 6529 0a20 2020 2020 2020  ", None).       
+00048090: 2073 6c69 6365 5f74 6869 636b 6e65 7373   slice_thickness
+000480a0: 203d 2028 736c 6963 655f 7468 6963 6b6e   = (slice_thickn
+000480b0: 6573 7320 6f72 0a20 2020 2020 2020 2020  ess or.         
+000480c0: 2020 2020 2020 2073 656c 662e 6765 745f         self.get_
+000480d0: 726f 6973 2869 676e 6f72 655f 656d 7074  rois(ignore_empt
+000480e0: 793d 5472 7565 295b 305d 5c0a 2020 2020  y=True)[0]\.    
+000480f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00048100: 2020 2020 2e67 6574 5f73 6c69 6365 5f74      .get_slice_t
+00048110: 6869 636b 6e65 7373 5f63 6f6e 746f 7572  hickness_contour
+00048120: 7328 2929 0a20 2020 2020 2020 2072 6574  s()).        ret
+00048130: 7572 6e20 6372 6561 7465 5f64 756d 6d79  urn create_dummy
+00048140: 5f69 6d61 6765 2865 7874 656e 7473 2c20  _image(extents, 
+00048150: 736c 6963 655f 7468 6963 6b6e 6573 732c  slice_thickness,
+00048160: 202a 2a6b 7761 7267 7329 0a0a 2020 2020   **kwargs)..    
+00048170: 6465 6620 5f67 6574 5f63 6f6d 6269 6e61  def _get_combina
+00048180: 7469 6f6e 2873 656c 662c 206e 616d 652c  tion(self, name,
+00048190: 2066 6f72 6365 2c20 6578 636c 7564 652c   force, exclude,
+000481a0: 2063 6f6d 626f 5f6d 616b 6572 2c20 2a2a   combo_maker, **
+000481b0: 6b77 6172 6773 293a 0a20 2020 2020 2020  kwargs):.       
+000481c0: 2022 2222 4569 7468 6572 2067 6574 2061   """Either get a
+000481d0: 6e20 616c 7265 6164 7920 6361 6c63 756c  n already calcul
+000481e0: 6174 6564 2063 6f6d 6269 6e61 7469 6f6e  ated combination
+000481f0: 2066 726f 6d20 7468 6520 6361 6368 650a   from the cache.
+00048200: 2020 2020 2020 2020 6f72 2063 7265 6174          or creat
+00048210: 6520 6974 2c20 6361 6368 6520 6974 2c20  e it, cache it, 
+00048220: 616e 6420 7265 7475 726e 2069 742e 2222  and return it.""
+00048230: 220a 0a20 2020 2020 2020 2023 2052 6574  "..        # Ret
+00048240: 7572 6e20 6361 6368 6564 2072 6573 756c  urn cached resul
+00048250: 7420 6966 2069 7420 6578 6973 7473 2061  t if it exists a
+00048260: 6e64 206e 6f74 2066 6f72 6369 6e67 0a20  nd not forcing. 
+00048270: 2020 2020 2020 2061 7474 7220 3d20 6622         attr = f"
+00048280: 5f7b 6e61 6d65 7d22 0a20 2020 2020 2020  _{name}".       
+00048290: 2069 6620 6578 636c 7564 653a 0a20 2020   if exclude:.   
+000482a0: 2020 2020 2020 2020 2061 7474 7220 2b3d           attr +=
+000482b0: 2066 225f 6578 636c 7564 6564 220a 2020   f"_excluded".  
+000482c0: 2020 2020 2020 6966 206e 6f74 2066 6f72        if not for
+000482d0: 6365 3a0a 2020 2020 2020 2020 2020 2020  ce:.            
+000482e0: 6966 2065 7863 6c75 6465 2069 7320 4e6f  if exclude is No
+000482f0: 6e65 2061 6e64 2068 6173 6174 7472 2873  ne and hasattr(s
+00048300: 656c 662c 2061 7474 7229 3a0a 2020 2020  elf, attr):.    
+00048310: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00048320: 726e 2067 6574 6174 7472 2873 656c 662c  rn getattr(self,
+00048330: 2061 7474 7229 0a20 2020 2020 2020 2020   attr).         
+00048340: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+00048350: 2020 2020 2020 2020 2069 6620 6861 7361           if hasa
+00048360: 7474 7228 7365 6c66 2c20 6174 7472 2920  ttr(self, attr) 
+00048370: 616e 6420 6578 636c 7564 6520 696e 2067  and exclude in g
+00048380: 6574 6174 7472 2873 656c 662c 2061 7474  etattr(self, att
+00048390: 7229 3a0a 2020 2020 2020 2020 2020 2020  r):.            
+000483a0: 2020 2020 2020 2020 7265 7475 726e 2067          return g
+000483b0: 6574 6174 7472 2873 656c 662c 2061 7474  etattr(self, att
+000483c0: 7229 5b65 7863 6c75 6465 5d0a 0a20 2020  r)[exclude]..   
+000483d0: 2020 2020 2023 2047 6574 206c 6973 7420       # Get list 
+000483e0: 6f66 2052 4f49 7320 746f 2069 6e63 6c75  of ROIs to inclu
+000483f0: 6465 2069 6e20 7468 6973 2063 6f6d 6269  de in this combi
+00048400: 6e61 7469 6f6e 2052 4f49 0a20 2020 2020  nation ROI.     
+00048410: 2020 2069 6620 6578 636c 7564 6520 6973     if exclude is
+00048420: 206e 6f74 204e 6f6e 653a 0a0a 2020 2020   not None:..    
+00048430: 2020 2020 2020 2020 6966 2065 7863 6c75          if exclu
+00048440: 6465 206e 6f74 2069 6e20 7365 6c66 2e67  de not in self.g
+00048450: 6574 5f72 6f69 5f6e 616d 6573 2829 3a0a  et_roi_names():.
+00048460: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00048470: 7072 696e 7428 6622 524f 4920 746f 2065  print(f"ROI to e
+00048480: 7863 6c75 6465 207b 6578 636c 7564 657d  xclude {exclude}
+00048490: 206e 6f74 2066 6f75 6e64 2e22 290a 2020   not found.").  
+000484a0: 2020 2020 2020 2020 2020 2020 2020 7265                re
+000484b0: 7475 726e 0a0a 2020 2020 2020 2020 2020  turn..          
+000484c0: 2020 726f 6973 5f74 6f5f 696e 636c 7564    rois_to_includ
+000484d0: 6520 3d20 5b72 6f69 2066 6f72 2072 6f69  e = [roi for roi
+000484e0: 2069 6e20 7365 6c66 2e72 6f69 7320 6966   in self.rois if
+000484f0: 2072 6f69 2e6e 616d 6520 213d 2065 7863   roi.name != exc
+00048500: 6c75 6465 5d0a 0a20 2020 2020 2020 2020  lude]..         
+00048510: 2020 2069 6620 6e6f 7420 6861 7361 7474     if not hasatt
+00048520: 7228 7365 6c66 2c20 6174 7472 293a 0a20  r(self, attr):. 
+00048530: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00048540: 6574 6174 7472 2873 656c 662c 2061 7474  etattr(self, att
+00048550: 722c 207b 7d29 0a20 2020 2020 2020 2065  r, {}).        e
+00048560: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+00048570: 2072 6f69 735f 746f 5f69 6e63 6c75 6465   rois_to_include
+00048580: 203d 2073 656c 662e 726f 6973 0a0a 2020   = self.rois..  
+00048590: 2020 2020 2020 2320 4d61 6b65 206b 7761        # Make kwa
+000485a0: 7267 7320 666f 7220 524f 4920 6372 6561  rgs for ROI crea
+000485b0: 7469 6f6e 0a20 2020 2020 2020 2072 6f69  tion.        roi
+000485c0: 5f6b 7761 7267 7320 3d20 7365 6c66 2e72  _kwargs = self.r
+000485d0: 6f69 5f6b 7761 7267 732e 636f 7079 2829  oi_kwargs.copy()
+000485e0: 0a20 2020 2020 2020 2072 6f69 5f6b 7761  .        roi_kwa
+000485f0: 7267 732e 7570 6461 7465 286b 7761 7267  rgs.update(kwarg
+00048600: 7329 0a20 2020 2020 2020 2072 6f69 5f6b  s).        roi_k
+00048610: 7761 7267 735b 226e 616d 6522 5d20 3d20  wargs["name"] = 
+00048620: 6e61 6d65 0a20 2020 2020 2020 2072 6f69  name.        roi
+00048630: 5f6b 7761 7267 735b 2269 6d61 6765 225d  _kwargs["image"]
+00048640: 203d 2073 656c 662e 696d 6167 650a 2020   = self.image.  
+00048650: 2020 2020 2020 726f 695f 6b77 6172 6773        roi_kwargs
+00048660: 5b22 6166 6669 6e65 225d 203d 2072 6f69  ["affine"] = roi
+00048670: 735f 746f 5f69 6e63 6c75 6465 5b30 5d2e  s_to_include[0].
+00048680: 6765 745f 6166 6669 6e65 2873 7461 6e64  get_affine(stand
+00048690: 6172 6469 7365 3d54 7275 6529 0a0a 2020  ardise=True)..  
+000486a0: 2020 2020 2020 2320 4372 6561 7465 2074        # Create t
+000486b0: 6865 2052 4f49 0a20 2020 2020 2020 2072  he ROI.        r
+000486c0: 6f69 203d 2063 6f6d 626f 5f6d 616b 6572  oi = combo_maker
+000486d0: 2872 6f69 735f 746f 5f69 6e63 6c75 6465  (rois_to_include
+000486e0: 2c20 2a2a 726f 695f 6b77 6172 6773 290a  , **roi_kwargs).
+000486f0: 0a20 2020 2020 2020 2023 2041 6464 2069  .        # Add i
+00048700: 7420 746f 2074 6865 2063 6163 6865 2061  t to the cache a
+00048710: 6e64 2072 6574 7572 6e0a 2020 2020 2020  nd return.      
+00048720: 2020 6966 2065 7863 6c75 6465 2069 7320    if exclude is 
+00048730: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+00048740: 2020 7365 7461 7474 7228 7365 6c66 2c20    setattr(self, 
+00048750: 6174 7472 2c20 726f 6929 0a20 2020 2020  attr, roi).     
+00048760: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+00048770: 2020 2020 2067 6574 6174 7472 2873 656c       getattr(sel
+00048780: 662c 2061 7474 7229 5b65 7863 6c75 6465  f, attr)[exclude
+00048790: 5d20 3d20 726f 690a 2020 2020 2020 2020  ] = roi.        
+000487a0: 7265 7475 726e 2072 6f69 0a0a 2020 2020  return roi..    
+000487b0: 6465 6620 6765 745f 636f 6e73 656e 7375  def get_consensu
+000487c0: 7328 7365 6c66 2c20 636f 6e73 656e 7375  s(self, consensu
+000487d0: 735f 7479 7065 2c20 636f 6c6f 723d 2262  s_type, color="b
+000487e0: 6c75 6522 2c20 2a2a 6b77 6172 6773 293a  lue", **kwargs):
+000487f0: 0a0a 2020 2020 2020 2020 2320 4765 7420  ..        # Get 
+00048800: 636f 6e73 656e 7375 7320 6361 6c63 756c  consensus calcul
+00048810: 6174 696f 6e20 6675 6e63 7469 6f6e 0a20  ation function. 
+00048820: 2020 2020 2020 2069 6620 636f 6e73 656e         if consen
+00048830: 7375 735f 7479 7065 203d 3d20 226d 616a  sus_type == "maj
+00048840: 6f72 6974 7922 3a0a 2020 2020 2020 2020  ority":.        
+00048850: 2020 2020 636f 6e73 656e 7375 735f 6675      consensus_fu
+00048860: 6e63 203d 2053 7472 7563 7475 7265 5365  nc = StructureSe
+00048870: 742e 6765 745f 6d61 6a6f 7269 7479 5f76  t.get_majority_v
+00048880: 6f74 650a 2020 2020 2020 2020 656c 6966  ote.        elif
+00048890: 2063 6f6e 7365 6e73 7573 5f74 7970 6520   consensus_type 
+000488a0: 3d3d 2022 7375 6d22 3a0a 2020 2020 2020  == "sum":.      
+000488b0: 2020 2020 2020 636f 6e73 656e 7375 735f        consensus_
+000488c0: 6675 6e63 203d 2053 7472 7563 7475 7265  func = Structure
+000488d0: 5365 742e 6765 745f 7375 6d0a 2020 2020  Set.get_sum.    
+000488e0: 2020 2020 656c 6966 2063 6f6e 7365 6e73      elif consens
+000488f0: 7573 5f74 7970 6520 3d3d 2022 6f76 6572  us_type == "over
+00048900: 6c61 7022 3a0a 2020 2020 2020 2020 2020  lap":.          
+00048910: 2020 636f 6e73 656e 7375 735f 6675 6e63    consensus_func
+00048920: 203d 2053 7472 7563 7475 7265 5365 742e   = StructureSet.
+00048930: 6765 745f 6f76 6572 6c61 700a 2020 2020  get_overlap.    
+00048940: 2020 2020 656c 6966 2063 6f6e 7365 6e73      elif consens
+00048950: 7573 5f74 7970 6520 3d3d 2022 7374 6170  us_type == "stap
+00048960: 6c65 223a 0a20 2020 2020 2020 2020 2020  le":.           
+00048970: 2063 6f6e 7365 6e73 7573 5f66 756e 6320   consensus_func 
+00048980: 3d20 5374 7275 6374 7572 6553 6574 2e67  = StructureSet.g
+00048990: 6574 5f73 7461 706c 650a 2020 2020 2020  et_staple.      
+000489a0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+000489b0: 2020 2020 7261 6973 6520 5661 6c75 6545      raise ValueE
+000489c0: 7272 6f72 2866 2255 6e72 6563 6f67 6e69  rror(f"Unrecogni
+000489d0: 7365 6420 636f 6e73 656e 7375 7320 7479  sed consensus ty
+000489e0: 7065 3a20 7b63 6f6e 7365 6e73 7573 5f74  pe: {consensus_t
+000489f0: 7970 657d 2229 0a0a 2020 2020 2020 2020  ype}")..        
+00048a00: 7265 7475 726e 2063 6f6e 7365 6e73 7573  return consensus
+00048a10: 5f66 756e 6328 7365 6c66 2c20 636f 6c6f  _func(self, colo
+00048a20: 723d 636f 6c6f 722c 202a 2a6b 7761 7267  r=color, **kwarg
+00048a30: 7329 0a0a 2020 2020 6465 6620 6765 745f  s)..    def get_
+00048a40: 7374 6170 6c65 2873 656c 662c 2066 6f72  staple(self, for
+00048a50: 6365 3d46 616c 7365 2c20 6578 636c 7564  ce=False, exclud
+00048a60: 653d 4e6f 6e65 2c20 2a2a 6b77 6172 6773  e=None, **kwargs
+00048a70: 293a 0a20 2020 2020 2020 2022 2222 4765  ):.        """Ge
+00048a80: 7420 524f 4920 6f62 6a65 6374 2072 6570  t ROI object rep
+00048a90: 7265 7365 6e74 696e 6720 7468 6520 5354  resenting the ST
+00048aa0: 4150 4c45 2063 6f6d 6269 6e61 7469 6f6e  APLE combination
+00048ab0: 206f 6620 524f 4973 2069 6e20 7468 6973   of ROIs in this
+00048ac0: 200a 2020 2020 2020 2020 7374 7275 6374   .        struct
+00048ad0: 7572 6520 7365 742e 2049 6620 3c65 7863  ure set. If <exc
+00048ae0: 6c75 6465 3e20 6973 2073 6574 2074 6f20  lude> is set to 
+00048af0: 6120 7374 7269 6e67 2c20 7468 6520 524f  a string, the RO
+00048b00: 4920 7769 7468 2074 6861 7420 6e61 6d65  I with that name
+00048b10: 200a 2020 2020 2020 2020 7769 6c6c 2062   .        will b
+00048b20: 6520 6578 636c 7564 6564 2066 726f 6d20  e excluded from 
+00048b30: 7468 6520 6361 6c63 756c 6174 696f 6e2e  the calculation.
+00048b40: 0a0a 2020 2020 2020 2020 2a2a 5061 7261  ..        **Para
+00048b50: 6d65 7465 7273 3a2a 2a0a 0a20 2020 2020  meters:**..     
+00048b60: 2020 2066 6f72 6365 203a 2062 6f6f 6c2c     force : bool,
+00048b70: 2064 6566 6175 6c74 3d46 616c 7365 0a20   default=False. 
+00048b80: 2020 2020 2020 2020 2020 2049 6620 4661             If Fa
+00048b90: 6c73 6520 616e 6420 5354 4150 4c45 2052  lse and STAPLE R
+00048ba0: 4f49 2068 6173 2061 6c72 6561 6479 2062  OI has already b
+00048bb0: 6565 6e20 6372 6561 7465 642c 2074 6865  een created, the
+00048bc0: 200a 2020 2020 2020 2020 2020 2020 7072   .            pr
+00048bd0: 6576 696f 7573 6c79 2063 6f6d 7075 7465  eviously compute
+00048be0: 6420 524f 4920 7769 6c6c 2062 6520 7265  d ROI will be re
+00048bf0: 7475 726e 6564 2e20 4966 2046 6f72 6365  turned. If Force
+00048c00: 3d54 7275 652c 2074 6865 200a 2020 2020  =True, the .    
+00048c10: 2020 2020 2020 2020 5354 4150 4c45 2052          STAPLE R
+00048c20: 4f49 2077 696c 6c20 6265 2072 6563 7265  OI will be recre
+00048c30: 6174 6564 2e0a 0a20 2020 2020 2020 2065  ated...        e
+00048c40: 7863 6c75 6465 203a 2073 7472 2c20 6465  xclude : str, de
+00048c50: 6661 756c 743d 4e6f 6e65 0a20 2020 2020  fault=None.     
+00048c60: 2020 2020 2020 2049 6620 7365 7420 746f         If set to
+00048c70: 2061 2073 7472 696e 672c 2074 6865 2066   a string, the f
+00048c80: 6972 7374 2052 4f49 2069 6e20 7365 6c66  irst ROI in self
+00048c90: 2e72 6f69 7320 7769 7468 2074 6861 7420  .rois with that 
+00048ca0: 6e61 6d65 2077 696c 6c20 0a20 2020 2020  name will .     
+00048cb0: 2020 2020 2020 2062 6520 6578 636c 7564         be exclud
+00048cc0: 6564 2066 726f 6d20 7468 6520 636f 6d62  ed from the comb
+00048cd0: 696e 6174 696f 6e2e 2054 6869 7320 6d61  ination. This ma
+00048ce0: 7920 6265 2075 7365 6675 6c20 6966 2063  y be useful if c
+00048cf0: 6f6d 7061 7269 736f 6e20 0a20 2020 2020  omparison .     
+00048d00: 2020 2020 2020 206f 6620 6120 7369 6e67         of a sing
+00048d10: 6c65 2052 4f49 2077 6974 6820 7468 6520  le ROI with the 
+00048d20: 636f 6e73 656e 7375 7320 6f66 2061 6c6c  consensus of all
+00048d30: 206f 7468 6572 7320 6973 2064 6573 6972   others is desir
+00048d40: 6564 2e0a 0a20 2020 2020 2020 2060 2a2a  ed...        `**
+00048d50: 606b 7761 7267 7320 3a0a 2020 2020 2020  `kwargs :.      
+00048d60: 2020 2020 2020 4578 7472 6120 6b65 7977        Extra keyw
+00048d70: 6f72 6420 6172 6775 6d65 6e74 7320 746f  ord arguments to
+00048d80: 2070 6173 7320 746f 2074 6865 2063 7265   pass to the cre
+00048d90: 6174 696f 6e20 6f66 2074 6865 2052 4f49  ation of the ROI
+00048da0: 206f 626a 6563 740a 2020 2020 2020 2020   object.        
+00048db0: 2020 2020 7265 7072 6573 656e 7469 6e67      representing
+00048dc0: 2074 6865 2063 6f6d 6269 6e61 7469 6f6e   the combination
+00048dd0: 2e0a 2020 2020 2020 2020 2222 220a 0a20  ..        """.. 
+00048de0: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
+00048df0: 6c66 2e5f 6765 745f 636f 6d62 696e 6174  lf._get_combinat
+00048e00: 696f 6e28 2273 7461 706c 6522 2c20 666f  ion("staple", fo
+00048e10: 7263 652c 2065 7863 6c75 6465 2c20 6372  rce, exclude, cr
+00048e20: 6561 7465 5f73 7461 706c 652c 0a20 2020  eate_staple,.   
+00048e30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00048e40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00048e50: 2020 2a2a 6b77 6172 6773 290a 0a20 2020    **kwargs)..   
+00048e60: 2064 6566 2067 6574 5f6d 616a 6f72 6974   def get_majorit
+00048e70: 795f 766f 7465 2873 656c 662c 2066 6f72  y_vote(self, for
+00048e80: 6365 3d46 616c 7365 2c20 6578 636c 7564  ce=False, exclud
+00048e90: 653d 4e6f 6e65 2c20 2a2a 6b77 6172 6773  e=None, **kwargs
+00048ea0: 293a 0a20 2020 2020 2020 2022 2222 4765  ):.        """Ge
+00048eb0: 7420 524f 4920 6f62 6a65 6374 2072 6570  t ROI object rep
+00048ec0: 7265 7365 6e74 696e 6720 7468 6520 6d61  resenting the ma
+00048ed0: 6a6f 7269 7479 2076 6f74 6520 636f 6d62  jority vote comb
+00048ee0: 696e 6174 696f 6e20 6f66 2052 4f49 7320  ination of ROIs 
+00048ef0: 696e 200a 2020 2020 2020 2020 7468 6973  in .        this
+00048f00: 2073 7472 7563 7475 7265 2073 6574 2e20   structure set. 
+00048f10: 4966 203c 6578 636c 7564 653e 2069 7320  If <exclude> is 
+00048f20: 7365 7420 746f 2061 2073 7472 696e 672c  set to a string,
+00048f30: 2074 6865 2052 4f49 2077 6974 6820 7468   the ROI with th
+00048f40: 6174 200a 2020 2020 2020 2020 6e61 6d65  at .        name
+00048f50: 2077 696c 6c20 6265 2065 7863 6c75 6465   will be exclude
+00048f60: 6420 6672 6f6d 2074 6865 2063 616c 6375  d from the calcu
+00048f70: 6c61 7469 6f6e 2e0a 0a20 2020 2020 2020  lation...       
+00048f80: 202a 2a50 6172 616d 6574 6572 733a 2a2a   **Parameters:**
+00048f90: 0a0a 2020 2020 2020 2020 666f 7263 6520  ..        force 
+00048fa0: 3a20 626f 6f6c 2c20 6465 6661 756c 743d  : bool, default=
+00048fb0: 4661 6c73 650a 2020 2020 2020 2020 2020  False.          
+00048fc0: 2020 4966 2046 616c 7365 2061 6e64 206d    If False and m
+00048fd0: 616a 6f72 6974 7920 766f 7465 2052 4f49  ajority vote ROI
+00048fe0: 2068 6173 2061 6c72 6561 6479 2062 6565   has already bee
+00048ff0: 6e20 6372 6561 7465 642c 2074 6865 200a  n created, the .
+00049000: 2020 2020 2020 2020 2020 2020 7072 6576              prev
+00049010: 696f 7573 6c79 2063 6f6d 7075 7465 6420  iously computed 
+00049020: 524f 4920 7769 6c6c 2062 6520 7265 7475  ROI will be retu
+00049030: 726e 6564 2e20 4966 2046 6f72 6365 3d54  rned. If Force=T
+00049040: 7275 652c 2074 6865 200a 2020 2020 2020  rue, the .      
+00049050: 2020 2020 2020 6d61 6a6f 7269 7479 2076        majority v
+00049060: 6f74 6520 524f 4920 7769 6c6c 2062 6520  ote ROI will be 
+00049070: 7265 6372 6561 7465 642e 0a0a 2020 2020  recreated...    
+00049080: 2020 2020 6578 636c 7564 6520 3a20 7374      exclude : st
+00049090: 722c 2064 6566 6175 6c74 3d4e 6f6e 650a  r, default=None.
+000490a0: 2020 2020 2020 2020 2020 2020 4966 2073              If s
+000490b0: 6574 2074 6f20 6120 7374 7269 6e67 2c20  et to a string, 
+000490c0: 7468 6520 6669 7273 7420 524f 4920 696e  the first ROI in
+000490d0: 2073 656c 662e 726f 6973 2077 6974 6820   self.rois with 
+000490e0: 7468 6174 206e 616d 6520 7769 6c6c 200a  that name will .
+000490f0: 2020 2020 2020 2020 2020 2020 6265 2065              be e
+00049100: 7863 6c75 6465 6420 6672 6f6d 2074 6865  xcluded from the
+00049110: 2063 6f6d 6269 6e61 7469 6f6e 2e20 5468   combination. Th
+00049120: 6973 206d 6179 2062 6520 7573 6566 756c  is may be useful
+00049130: 2069 6620 636f 6d70 6172 6973 6f6e 200a   if comparison .
+00049140: 2020 2020 2020 2020 2020 2020 6f66 2061              of a
+00049150: 2073 696e 676c 6520 524f 4920 7769 7468   single ROI with
+00049160: 2074 6865 2063 6f6e 7365 6e73 7573 206f   the consensus o
+00049170: 6620 616c 6c20 6f74 6865 7273 2069 7320  f all others is 
+00049180: 6465 7369 7265 642e 0a0a 2020 2020 2020  desired...      
+00049190: 2020 602a 2a60 6b77 6172 6773 203a 0a20    `**`kwargs :. 
+000491a0: 2020 2020 2020 2020 2020 2045 7874 7261             Extra
+000491b0: 206b 6579 776f 7264 2061 7267 756d 656e   keyword argumen
+000491c0: 7473 2074 6f20 7061 7373 2074 6f20 7468  ts to pass to th
+000491d0: 6520 6372 6561 7469 6f6e 206f 6620 7468  e creation of th
+000491e0: 6520 524f 4920 6f62 6a65 6374 0a20 2020  e ROI object.   
+000491f0: 2020 2020 2020 2020 2072 6570 7265 7365           represe
+00049200: 6e74 696e 6720 7468 6520 636f 6d62 696e  nting the combin
+00049210: 6174 696f 6e2e 0a20 2020 2020 2020 2022  ation..        "
+00049220: 2222 0a0a 2020 2020 2020 2020 7265 7475  ""..        retu
+00049230: 726e 2073 656c 662e 5f67 6574 5f63 6f6d  rn self._get_com
+00049240: 6269 6e61 7469 6f6e 2822 6d61 6a6f 7269  bination("majori
+00049250: 7479 5f76 6f74 6522 2c20 666f 7263 652c  ty_vote", force,
+00049260: 2065 7863 6c75 6465 2c20 0a20 2020 2020   exclude, .     
+00049270: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00049280: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00049290: 6372 6561 7465 5f6d 616a 6f72 6974 795f  create_majority_
+000492a0: 766f 7465 2c20 2a2a 6b77 6172 6773 290a  vote, **kwargs).
+000492b0: 0a20 2020 2064 6566 2067 6574 5f73 756d  .    def get_sum
+000492c0: 2873 656c 662c 2066 6f72 6365 3d46 616c  (self, force=Fal
+000492d0: 7365 2c20 6578 636c 7564 653d 4e6f 6e65  se, exclude=None
+000492e0: 2c20 2a2a 6b77 6172 6773 293a 0a20 2020  , **kwargs):.   
+000492f0: 2020 2020 2022 2222 4765 7420 524f 4920       """Get ROI 
+00049300: 6f62 6a65 6374 2072 6570 7265 7365 6e74  object represent
+00049310: 696e 6720 7468 6520 7375 6d20 6f66 2052  ing the sum of R
+00049320: 4f49 7320 696e 2074 6869 7320 7374 7275  OIs in this stru
+00049330: 6374 7572 6520 7365 742e 200a 2020 2020  cture set. .    
+00049340: 2020 2020 4966 203c 6578 636c 7564 653e      If <exclude>
+00049350: 2069 7320 7365 7420 746f 2061 2073 7472   is set to a str
+00049360: 696e 672c 2074 6865 2052 4f49 2077 6974  ing, the ROI wit
+00049370: 6820 7468 6174 206e 616d 6520 7769 6c6c  h that name will
+00049380: 2062 6520 0a20 2020 2020 2020 2065 7863   be .        exc
+00049390: 6c75 6465 6420 6672 6f6d 2074 6865 2063  luded from the c
+000493a0: 616c 6375 6c61 7469 6f6e 2e0a 0a20 2020  alculation...   
+000493b0: 2020 2020 202a 2a50 6172 616d 6574 6572       **Parameter
+000493c0: 733a 2a2a 0a0a 2020 2020 2020 2020 666f  s:**..        fo
+000493d0: 7263 6520 3a20 626f 6f6c 2c20 6465 6661  rce : bool, defa
+000493e0: 756c 743d 4661 6c73 650a 2020 2020 2020  ult=False.      
+000493f0: 2020 2020 2020 4966 2046 616c 7365 2061        If False a
+00049400: 6e64 2073 756d 2052 4f49 2068 6173 2061  nd sum ROI has a
+00049410: 6c72 6561 6479 2062 6565 6e20 6372 6561  lready been crea
+00049420: 7465 642c 2074 6865 200a 2020 2020 2020  ted, the .      
+00049430: 2020 2020 2020 7072 6576 696f 7573 6c79        previously
+00049440: 2063 6f6d 7075 7465 6420 524f 4920 7769   computed ROI wi
+00049450: 6c6c 2062 6520 7265 7475 726e 6564 2e20  ll be returned. 
+00049460: 4966 2046 6f72 6365 3d54 7275 652c 2074  If Force=True, t
+00049470: 6865 200a 2020 2020 2020 2020 2020 2020  he .            
+00049480: 7375 6d20 524f 4920 7769 6c6c 2062 6520  sum ROI will be 
+00049490: 7265 6372 6561 7465 642e 0a0a 2020 2020  recreated...    
+000494a0: 2020 2020 6578 636c 7564 6520 3a20 7374      exclude : st
+000494b0: 722c 2064 6566 6175 6c74 3d4e 6f6e 650a  r, default=None.
+000494c0: 2020 2020 2020 2020 2020 2020 4966 2073              If s
+000494d0: 6574 2074 6f20 6120 7374 7269 6e67 2c20  et to a string, 
+000494e0: 7468 6520 6669 7273 7420 524f 4920 696e  the first ROI in
+000494f0: 2073 656c 662e 726f 6973 2077 6974 6820   self.rois with 
+00049500: 7468 6174 206e 616d 6520 7769 6c6c 200a  that name will .
+00049510: 2020 2020 2020 2020 2020 2020 6265 2065              be e
+00049520: 7863 6c75 6465 6420 6672 6f6d 2074 6865  xcluded from the
+00049530: 2063 6f6d 6269 6e61 7469 6f6e 2e20 5468   combination. Th
+00049540: 6973 206d 6179 2062 6520 7573 6566 756c  is may be useful
+00049550: 2069 6620 636f 6d70 6172 6973 6f6e 200a   if comparison .
+00049560: 2020 2020 2020 2020 2020 2020 6f66 2061              of a
+00049570: 2073 696e 676c 6520 524f 4920 7769 7468   single ROI with
+00049580: 2074 6865 2063 6f6e 7365 6e73 7573 206f   the consensus o
+00049590: 6620 616c 6c20 6f74 6865 7273 2069 7320  f all others is 
+000495a0: 6465 7369 7265 642e 0a0a 2020 2020 2020  desired...      
+000495b0: 2020 602a 2a60 6b77 6172 6773 203a 0a20    `**`kwargs :. 
+000495c0: 2020 2020 2020 2020 2020 2045 7874 7261             Extra
+000495d0: 206b 6579 776f 7264 2061 7267 756d 656e   keyword argumen
+000495e0: 7473 2074 6f20 7061 7373 2074 6f20 7468  ts to pass to th
+000495f0: 6520 6372 6561 7469 6f6e 206f 6620 7468  e creation of th
+00049600: 6520 524f 4920 6f62 6a65 6374 0a20 2020  e ROI object.   
+00049610: 2020 2020 2020 2020 2072 6570 7265 7365           represe
+00049620: 6e74 696e 6720 7468 6520 636f 6d62 696e  nting the combin
+00049630: 6174 696f 6e2e 0a20 2020 2020 2020 2022  ation..        "
+00049640: 2222 0a0a 2020 2020 2020 2020 7265 7475  ""..        retu
+00049650: 726e 2073 656c 662e 5f67 6574 5f63 6f6d  rn self._get_com
+00049660: 6269 6e61 7469 6f6e 2822 7375 6d22 2c20  bination("sum", 
+00049670: 666f 7263 652c 2065 7863 6c75 6465 2c20  force, exclude, 
+00049680: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00049690: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000496a0: 2020 2020 2020 6372 6561 7465 5f72 6f69        create_roi
+000496b0: 5f73 756d 2c20 2a2a 6b77 6172 6773 290a  _sum, **kwargs).
+000496c0: 0a20 2020 2064 6566 2067 6574 5f6f 7665  .    def get_ove
+000496d0: 726c 6170 2873 656c 662c 2066 6f72 6365  rlap(self, force
+000496e0: 3d46 616c 7365 2c20 6578 636c 7564 653d  =False, exclude=
+000496f0: 4e6f 6e65 2c20 2a2a 6b77 6172 6773 293a  None, **kwargs):
+00049700: 0a20 2020 2020 2020 2022 2222 4765 7420  .        """Get 
+00049710: 524f 4920 6f62 6a65 6374 2072 6570 7265  ROI object repre
+00049720: 7365 6e74 696e 6720 7468 6520 6f76 6572  senting the over
+00049730: 6c61 7020 6f66 2052 4f49 7320 696e 2074  lap of ROIs in t
+00049740: 6869 7320 0a20 2020 2020 2020 2073 7472  his .        str
+00049750: 7563 7475 7265 2073 6574 2e20 4966 203c  ucture set. If <
+00049760: 6578 636c 7564 653e 2069 7320 7365 7420  exclude> is set 
+00049770: 746f 2061 2073 7472 696e 672c 2074 6865  to a string, the
+00049780: 2052 4f49 2077 6974 6820 7468 6174 206e   ROI with that n
+00049790: 616d 6520 0a20 2020 2020 2020 2077 696c  ame .        wil
+000497a0: 6c20 6265 2065 7863 6c75 6465 6420 6672  l be excluded fr
+000497b0: 6f6d 2074 6865 2063 616c 6375 6c61 7469  om the calculati
+000497c0: 6f6e 2e0a 0a20 2020 2020 2020 202a 2a50  on...        **P
+000497d0: 6172 616d 6574 6572 733a 2a2a 0a0a 2020  arameters:**..  
+000497e0: 2020 2020 2020 666f 7263 6520 3a20 626f        force : bo
+000497f0: 6f6c 2c20 6465 6661 756c 743d 4661 6c73  ol, default=Fals
+00049800: 650a 2020 2020 2020 2020 2020 2020 4966  e.            If
+00049810: 2046 616c 7365 2061 6e64 206f 7665 726c   False and overl
+00049820: 6170 2052 4f49 2068 6173 2061 6c72 6561  ap ROI has alrea
+00049830: 6479 2062 6565 6e20 6372 6561 7465 642c  dy been created,
+00049840: 2074 6865 200a 2020 2020 2020 2020 2020   the .          
+00049850: 2020 7072 6576 696f 7573 6c79 2063 6f6d    previously com
+00049860: 7075 7465 6420 524f 4920 7769 6c6c 2062  puted ROI will b
+00049870: 6520 7265 7475 726e 6564 2e20 4966 2046  e returned. If F
+00049880: 6f72 6365 3d54 7275 652c 2074 6865 200a  orce=True, the .
+00049890: 2020 2020 2020 2020 2020 2020 6f76 6572              over
+000498a0: 6c61 7020 524f 4920 7769 6c6c 2062 6520  lap ROI will be 
+000498b0: 7265 6372 6561 7465 642e 0a0a 2020 2020  recreated...    
+000498c0: 2020 2020 6578 636c 7564 6520 3a20 7374      exclude : st
+000498d0: 722c 2064 6566 6175 6c74 3d4e 6f6e 650a  r, default=None.
+000498e0: 2020 2020 2020 2020 2020 2020 4966 2073              If s
+000498f0: 6574 2074 6f20 6120 7374 7269 6e67 2c20  et to a string, 
+00049900: 7468 6520 6669 7273 7420 524f 4920 696e  the first ROI in
+00049910: 2073 656c 662e 726f 6973 2077 6974 6820   self.rois with 
+00049920: 7468 6174 206e 616d 6520 7769 6c6c 200a  that name will .
+00049930: 2020 2020 2020 2020 2020 2020 6265 2065              be e
+00049940: 7863 6c75 6465 6420 6672 6f6d 2074 6865  xcluded from the
+00049950: 2063 6f6d 6269 6e61 7469 6f6e 2e20 5468   combination. Th
+00049960: 6973 206d 6179 2062 6520 7573 6566 756c  is may be useful
+00049970: 2069 6620 636f 6d70 6172 6973 6f6e 200a   if comparison .
+00049980: 2020 2020 2020 2020 2020 2020 6f66 2061              of a
+00049990: 2073 696e 676c 6520 524f 4920 7769 7468   single ROI with
+000499a0: 2074 6865 2063 6f6e 7365 6e73 7573 206f   the consensus o
+000499b0: 6620 616c 6c20 6f74 6865 7273 2069 7320  f all others is 
+000499c0: 6465 7369 7265 642e 0a0a 2020 2020 2020  desired...      
+000499d0: 2020 602a 2a60 6b77 6172 6773 203a 0a20    `**`kwargs :. 
+000499e0: 2020 2020 2020 2020 2020 2045 7874 7261             Extra
+000499f0: 206b 6579 776f 7264 2061 7267 756d 656e   keyword argumen
+00049a00: 7473 2074 6f20 7061 7373 2074 6f20 7468  ts to pass to th
+00049a10: 6520 6372 6561 7469 6f6e 206f 6620 7468  e creation of th
+00049a20: 6520 524f 4920 6f62 6a65 6374 0a20 2020  e ROI object.   
+00049a30: 2020 2020 2020 2020 2072 6570 7265 7365           represe
+00049a40: 6e74 696e 6720 7468 6520 636f 6d62 696e  nting the combin
+00049a50: 6174 696f 6e2e 0a20 2020 2020 2020 2022  ation..        "
+00049a60: 2222 0a0a 2020 2020 2020 2020 7265 7475  ""..        retu
+00049a70: 726e 2073 656c 662e 5f67 6574 5f63 6f6d  rn self._get_com
+00049a80: 6269 6e61 7469 6f6e 2822 6f76 6572 6c61  bination("overla
+00049a90: 7022 2c20 666f 7263 652c 2065 7863 6c75  p", force, exclu
+00049aa0: 6465 2c20 0a20 2020 2020 2020 2020 2020  de, .           
+00049ab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00049ac0: 2020 2020 2020 2020 2020 6372 6561 7465            create
+00049ad0: 5f72 6f69 5f6f 7665 726c 6170 2c20 2a2a  _roi_overlap, **
+00049ae0: 6b77 6172 6773 290a 0a20 2020 2064 6566  kwargs)..    def
+00049af0: 2074 7261 6e73 666f 726d 2873 656c 662c   transform(self,
+00049b00: 2073 6361 6c65 3d31 2c20 7472 616e 736c   scale=1, transl
+00049b10: 6174 696f 6e3d 5b30 2c20 302c 2030 5d2c  ation=[0, 0, 0],
+00049b20: 2072 6f74 6174 696f 6e3d 5b30 2c20 302c   rotation=[0, 0,
+00049b30: 2030 5d2c 0a20 2020 2020 2020 2020 2020   0],.           
+00049b40: 2063 656e 7472 653d 5b30 2c20 302c 2030   centre=[0, 0, 0
+00049b50: 5d2c 2072 6573 616d 706c 653d 2266 696e  ], resample="fin
+00049b60: 6522 2c20 7265 7374 6f72 653d 5472 7565  e", restore=True
+00049b70: 2c20 0a20 2020 2020 2020 2020 2020 2066  , .            f
+00049b80: 696c 6c5f 7661 6c75 653d 4e6f 6e65 2c20  ill_value=None, 
+00049b90: 666f 7263 655f 636f 6e74 6f75 7273 3d46  force_contours=F
+00049ba0: 616c 7365 2c20 6e61 6d65 733d 4e6f 6e65  alse, names=None
+00049bb0: 293a 0a20 2020 2020 2020 2022 2222 0a20  ):.        """. 
+00049bc0: 2020 2020 2020 2041 7070 6c79 2074 6872         Apply thr
+00049bd0: 6565 2d64 696d 656e 7369 6f6e 616c 2073  ee-dimensional s
+00049be0: 696d 696c 6172 6974 7920 7472 616e 7366  imilarity transf
+00049bf0: 6f72 6d20 746f 2073 7472 7563 7475 7265  orm to structure
+00049c00: 2d73 6574 2052 4f49 732e 0a0a 2020 2020  -set ROIs...    
+00049c10: 2020 2020 4966 2074 6865 2074 7261 6e73      If the trans
+00049c20: 666f 726d 2063 6f72 7265 7370 6f6e 6473  form corresponds
+00049c30: 2074 6f20 6120 7472 616e 736c 6174 696f   to a translatio
+00049c40: 6e20 616e 642f 6f72 2072 6f74 6174 696f  n and/or rotatio
+00049c50: 6e0a 2020 2020 2020 2020 6162 6f75 7420  n.        about 
+00049c60: 7468 6520 7a2d 6178 6973 2c20 616e 6420  the z-axis, and 
+00049c70: 6569 7468 6572 2074 6865 2072 6f69 2073  either the roi s
+00049c80: 6f75 7263 6520 7479 7065 2069 7320 2264  ource type is "d
+00049c90: 6963 6f6d 220a 2020 2020 2020 2020 6f72  icom".        or
+00049ca0: 2066 6f72 6365 2d63 6f6e 746f 7572 7320   force-contours 
+00049cb0: 6973 2054 7275 652c 2074 6865 2074 7261  is True, the tra
+00049cc0: 6e73 666f 726d 2069 7320 6170 706c 6965  nsform is applie
+00049cd0: 6420 746f 2063 6f6e 746f 7572 0a20 2020  d to contour.   
+00049ce0: 2020 2020 2070 6f69 6e74 7320 616e 6420       points and 
+00049cf0: 7468 6520 726f 6920 6d61 736b 2069 7320  the roi mask is 
+00049d00: 7365 7420 6173 2075 6e6c 6f61 6465 642e  set as unloaded.
+00049d10: 2020 4f74 6865 7277 6973 6520 7468 6520    Otherwise the 
+00049d20: 7472 616e 7366 6f72 6d0a 2020 2020 2020  transform.      
+00049d30: 2020 6973 2061 7070 6c69 6564 2074 6f20    is applied to 
+00049d40: 7468 6520 6d61 736b 2061 6e64 2063 6f6e  the mask and con
+00049d50: 746f 7572 7320 6172 6520 7365 7420 6173  tours are set as
+00049d60: 2075 6e6c 6f61 6465 642e 0a0a 2020 2020   unloaded...    
+00049d70: 2020 2020 5468 6520 7472 616e 7366 6f72      The transfor
+00049d80: 6d20 6973 2061 7070 6c69 6564 2069 6e20  m is applied in 
+00049d90: 7468 6520 6f72 6465 723a 2074 7261 6e73  the order: trans
+00049da0: 6c61 7469 6f6e 2c20 7363 616c 696e 672c  lation, scaling,
+00049db0: 0a20 2020 2020 2020 2072 6f74 6174 696f  .        rotatio
+00049dc0: 6e2e 2020 5468 6520 6c61 7474 6572 2074  n.  The latter t
+00049dd0: 776f 2061 7265 2061 626f 7574 2074 6865  wo are about the
+00049de0: 2063 656e 7472 6520 636f 6f72 6469 6e61   centre coordina
+00049df0: 7465 732e 0a0a 2020 2020 2020 2020 2a2a  tes...        **
+00049e00: 5061 7261 6d65 7465 7273 3a2a 2a0a 2020  Parameters:**.  
+00049e10: 2020 2020 2020 0a20 2020 2020 2020 2066        .        f
+00049e20: 6f72 6365 5f63 6f6e 746f 7572 7320 3a20  orce_contours : 
+00049e30: 626f 6f6c 2c20 6465 6661 756c 743d 4661  bool, default=Fa
+00049e40: 6c73 650a 2020 2020 2020 2020 2020 2020  lse.            
+00049e50: 4966 2054 7275 652c 2061 6e64 2074 6865  If True, and the
+00049e60: 2074 7261 6e73 666f 726d 2063 6f72 7265   transform corre
+00049e70: 7370 6f6e 6473 2074 6f20 6120 7472 616e  sponds to a tran
+00049e80: 736c 6174 696f 6e0a 2020 2020 2020 2020  slation.        
+00049e90: 2020 2020 616e 642f 6f72 2072 6f74 6174      and/or rotat
+00049ea0: 696f 6e20 6162 6f75 7420 7468 6520 7a2d  ion about the z-
+00049eb0: 6178 6973 2c20 6170 706c 7920 7472 616e  axis, apply tran
+00049ec0: 7366 6f72 6d20 746f 2063 6f6e 746f 7572  sform to contour
+00049ed0: 0a20 2020 2020 2020 2020 2020 2070 6f69  .            poi
+00049ee0: 6e74 7320 696e 6465 7065 6e64 656e 746c  nts independentl
+00049ef0: 7920 6f66 2074 6865 206f 7269 6769 6e61  y of the origina
+00049f00: 6c20 6461 7461 2073 6f75 7263 652e 0a0a  l data source...
+00049f10: 2020 2020 2020 2020 6e61 6d65 7320 3a20          names : 
+00049f20: 6c69 7374 2f4e 6f6e 652c 2064 6566 6175  list/None, defau
+00049f30: 6c74 3d46 616c 7365 0a20 2020 2020 2020  lt=False.       
+00049f40: 2020 2020 204c 6973 7420 6f66 2052 4f49       List of ROI
+00049f50: 7320 746f 2077 6869 6368 2074 7261 6e73  s to which trans
+00049f60: 666f 726d 2069 7320 746f 2062 6520 6170  form is to be ap
+00049f70: 706c 6965 642e 2020 4966 204e 6f6e 652c  plied.  If None,
+00049f80: 0a20 2020 2020 2020 2020 2020 2074 7261  .            tra
+00049f90: 6e73 666f 726d 2069 7320 6170 706c 6965  nsform is applie
+00049fa0: 6420 746f 2061 6c6c 2052 4f49 732e 0a0a  d to all ROIs...
+00049fb0: 2020 2020 2020 2020 466f 7220 6f74 6865          For othe
+00049fc0: 7220 7061 7261 6d65 7465 7273 2c20 7365  r parameters, se
+00049fd0: 6520 646f 6375 6d65 6e74 6174 696f 6e20  e documentation 
+00049fe0: 666f 720a 2020 2020 2020 2020 736b 7274  for.        skrt
+00049ff0: 2e69 6d61 6765 2e49 6d61 6765 2e74 7261  .image.Image.tra
+0004a000: 6e73 666f 726d 2829 2e20 204e 6f74 6520  nsform().  Note 
+0004a010: 7468 6174 2074 6865 2060 606f 7264 6572  that the ``order
+0004a020: 6060 0a20 2020 2020 2020 2070 6172 616d  ``.        param
+0004a030: 6574 6572 2069 736e 2774 2061 7661 696c  eter isn't avail
+0004a040: 6162 6c65 2066 6f72 2073 7472 7563 7475  able for structu
+0004a050: 7265 2d73 6574 2074 7261 6e73 666f 726d  re-set transform
+0004a060: 7320 2d20 6120 7661 6c75 6520 6f66 2030  s - a value of 0
+0004a070: 0a20 2020 2020 2020 2069 7320 7573 6564  .        is used
+0004a080: 2061 6c77 6179 732e 0a20 2020 2020 2020   always..       
+0004a090: 2022 2222 0a0a 2020 2020 2020 2020 666f   """..        fo
+0004a0a0: 7220 726f 6920 696e 2073 656c 662e 6765  r roi in self.ge
+0004a0b0: 745f 726f 6973 286e 616d 6573 293a 0a20  t_rois(names):. 
+0004a0c0: 2020 2020 2020 2020 2020 2072 6f69 2e74             roi.t
+0004a0d0: 7261 6e73 666f 726d 2873 6361 6c65 2c20  ransform(scale, 
+0004a0e0: 7472 616e 736c 6174 696f 6e2c 2072 6f74  translation, rot
+0004a0f0: 6174 696f 6e2c 2063 656e 7472 652c 2072  ation, centre, r
+0004a100: 6573 616d 706c 652c 0a20 2020 2020 2020  esample,.       
+0004a110: 2020 2020 2020 2020 2020 2020 2072 6573               res
+0004a120: 746f 7265 2c20 6669 6c6c 5f76 616c 7565  tore, fill_value
+0004a130: 2c20 666f 7263 655f 636f 6e74 6f75 7273  , force_contours
+0004a140: 290a 0a20 2020 2020 2020 2072 6574 7572  )..        retur
+0004a150: 6e20 4e6f 6e65 0a0a 2020 2020 6465 6620  n None..    def 
+0004a160: 6164 645f 706c 616e 2873 656c 662c 2070  add_plan(self, p
+0004a170: 6c61 6e29 3a0a 2020 2020 2020 2020 2222  lan):.        ""
+0004a180: 2241 6464 2061 2050 6c61 6e20 6f62 6a65  "Add a Plan obje
+0004a190: 6374 2074 6f20 6265 2061 7373 6f63 6961  ct to be associa
+0004a1a0: 7465 6420 7769 7468 2074 6869 7320 7374  ted with this st
+0004a1b0: 7275 6374 7572 6520 7365 7420 616e 640a  ructure set and.
+0004a1c0: 2020 2020 2020 2020 6974 7320 524f 4973          its ROIs
+0004a1d0: 2e20 5468 6973 2064 6f65 7320 6e6f 7420  . This does not 
+0004a1e0: 6166 6665 6374 2074 6865 2073 7472 7563  affect the struc
+0004a1f0: 7475 7265 2073 6574 2061 7373 6f63 6961  ture set associa
+0004a200: 7465 6420 7769 7468 0a20 2020 2020 2020  ted with.       
+0004a210: 2074 6865 2050 6c61 6e20 6f62 6a65 6374   the Plan object
+0004a220: 2e0a 0a20 2020 2020 2020 202a 2a50 6172  ...        **Par
+0004a230: 616d 6574 6572 733a 2a2a 0a0a 2020 2020  ameters:**..    
+0004a240: 2020 2020 706c 616e 203a 2073 6b72 742e      plan : skrt.
+0004a250: 646f 7365 2e50 6c61 6e0a 2020 2020 2020  dose.Plan.      
+0004a260: 2020 2020 2020 4120 506c 616e 206f 626a        A Plan obj
+0004a270: 6563 7420 746f 2061 7373 6967 6e20 746f  ect to assign to
+0004a280: 2074 6869 7320 7374 7275 6374 7572 6520   this structure 
+0004a290: 7365 742e 0a20 2020 2020 2020 2022 2222  set..        """
+0004a2a0: 0a0a 2020 2020 2020 2020 6966 206e 6f74  ..        if not
+0004a2b0: 2070 6c61 6e20 696e 2073 656c 662e 706c   plan in self.pl
+0004a2c0: 616e 733a 0a20 2020 2020 2020 2020 2020  ans:.           
+0004a2d0: 2073 656c 662e 706c 616e 732e 6170 7065   self.plans.appe
+0004a2e0: 6e64 2870 6c61 6e29 0a20 2020 2020 2020  nd(plan).       
+0004a2f0: 2020 2020 2073 656c 662e 706c 616e 732e       self.plans.
+0004a300: 736f 7274 2829 0a0a 2020 2020 2020 2020  sort()..        
+0004a310: 2020 2020 666f 7220 726f 6920 696e 2073      for roi in s
+0004a320: 656c 662e 726f 6973 3a0a 2020 2020 2020  elf.rois:.      
+0004a330: 2020 2020 2020 2020 2020 726f 692e 6164            roi.ad
+0004a340: 645f 706c 616e 2870 6c61 6e29 0a0a 2020  d_plan(plan)..  
+0004a350: 2020 6465 6620 636c 6561 725f 706c 616e    def clear_plan
+0004a360: 7328 7365 6c66 293a 0a20 2020 2020 2020  s(self):.       
+0004a370: 2022 2222 436c 6561 7220 616c 6c20 706c   """Clear all pl
+0004a380: 616e 206d 6170 7320 6173 736f 6369 6174  an maps associat
+0004a390: 6564 2077 6974 6820 7468 6973 2073 7472  ed with this str
+0004a3a0: 7563 7475 7265 2073 6574 2e22 2222 0a0a  ucture set."""..
+0004a3b0: 2020 2020 2020 2020 7365 6c66 2e70 6c61          self.pla
+0004a3c0: 6e73 203d 205b 5d0a 0a20 2020 2064 6566  ns = []..    def
+0004a3d0: 2067 6574 5f70 6c61 6e73 2873 656c 6629   get_plans(self)
+0004a3e0: 3a0a 2020 2020 2020 2020 2222 2252 6574  :.        """Ret
+0004a3f0: 7572 6e20 6c69 7374 206f 6620 506c 616e  urn list of Plan
+0004a400: 206f 626a 6563 7473 2061 7373 6f63 6961   objects associa
+0004a410: 7465 6420 7769 7468 2074 6869 7320 7374  ted with this st
+0004a420: 7275 6374 7572 6520 7365 742e 2222 220a  ructure set.""".
+0004a430: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0004a440: 7365 6c66 2e70 6c61 6e73 0a0a 2020 2020  self.plans..    
+0004a450: 6465 6620 696e 7465 7270 6f6c 6174 655f  def interpolate_
+0004a460: 706f 696e 7473 2873 656c 662c 206e 5f70  points(self, n_p
+0004a470: 6f69 6e74 3d4e 6f6e 652c 2064 7879 3d4e  oint=None, dxy=N
+0004a480: 6f6e 652c 0a20 2020 2020 2020 2073 6d6f  one,.        smo
+0004a490: 6f74 686e 6573 735f 7065 725f 706f 696e  othness_per_poin
+0004a4a0: 743d 3029 3a0a 2020 2020 2020 2020 2727  t=0):.        ''
+0004a4b0: 270a 2020 2020 2020 2020 5265 7475 726e  '.        Return
+0004a4c0: 206e 6577 2053 7472 7563 7475 7265 5365   new StructureSe
+0004a4d0: 7420 6f62 6a65 6374 2c20 7769 7468 2069  t object, with i
+0004a4e0: 6e74 6572 706f 6c61 7465 6420 636f 6e74  nterpolated cont
+0004a4f0: 6f75 7220 706f 696e 7473 2e0a 0a20 2020  our points...   
+0004a500: 2020 2020 2050 6f69 6e74 7320 6172 6520       Points are 
+0004a510: 696e 7465 7270 6f6c 6174 6564 2066 6f72  interpolated for
+0004a520: 2065 6163 6820 636f 6e74 6f75 7220 6f66   each contour of
+0004a530: 2065 6163 6820 524f 492e 0a0a 2020 2020   each ROI...    
+0004a540: 2020 2020 2a2a 5061 7261 6d65 7465 7273      **Parameters
+0004a550: 3a2a 2a0a 0a20 2020 2020 2020 206e 5f70  :**..        n_p
+0004a560: 6f69 6e74 203a 2069 6e74 2c20 6465 6661  oint : int, defa
+0004a570: 756c 743d 4e6f 6e65 0a20 2020 2020 2020  ult=None.       
+0004a580: 2020 2020 204e 756d 6265 7220 6f66 2070       Number of p
+0004a590: 6f69 6e74 7320 7065 7220 636f 6e74 6f75  oints per contou
+0004a5a0: 722c 2061 6674 6572 2069 6e74 6572 706f  r, after interpo
+0004a5b0: 6c61 7469 6f6e 2e20 2054 6869 7320 6d75  lation.  This mu
+0004a5c0: 7374 0a20 2020 2020 2020 2020 2020 2062  st.            b
+0004a5d0: 6520 7365 7420 746f 204e 6f6e 6520 666f  e set to None fo
+0004a5e0: 7220 6478 7920 746f 2062 6520 636f 6e73  r dxy to be cons
+0004a5f0: 6964 6572 6564 2e0a 0a20 2020 2020 2020  idered...       
+0004a600: 2064 7879 203a 2066 6c6f 6174 2c20 6465   dxy : float, de
+0004a610: 6661 756c 743d 4e6f 6e65 0a20 2020 2020  fault=None.     
+0004a620: 2020 2020 2020 2041 7070 726f 7869 6d61         Approxima
+0004a630: 7465 2064 6973 7461 6e63 6520 7265 7175  te distance requ
+0004a640: 6972 6564 2062 6574 7765 656e 2063 6f6e  ired between con
+0004a650: 746f 7572 2070 6f69 6e74 732e 2020 5468  tour points.  Th
+0004a660: 6973 2069 7320 7461 6b65 6e0a 2020 2020  is is taken.    
+0004a670: 2020 2020 2020 2020 696e 746f 2061 6363          into acc
+0004a680: 6f75 6e74 206f 6e6c 7920 6966 206e 5f70  ount only if n_p
+0004a690: 6f69 6e74 2069 7320 7365 7420 746f 204e  oint is set to N
+0004a6a0: 6f6e 652e 2020 466f 7220 6120 636f 6e74  one.  For a cont
+0004a6b0: 6f75 7220 6f66 0a20 2020 2020 2020 2020  our of.         
+0004a6c0: 2020 206c 656e 6774 6820 636f 6e74 6f75     length contou
+0004a6d0: 725f 6c65 6e67 7468 2c20 7468 6520 6e75  r_length, the nu
+0004a6e0: 6d62 6572 206f 6620 636f 6e74 6f75 7220  mber of contour 
+0004a6f0: 706f 696e 7473 2069 7320 7468 656e 2074  points is then t
+0004a700: 616b 656e 0a20 2020 2020 2020 2020 2020  aken.           
+0004a710: 2074 6f20 6265 206d 6178 2869 6e74 2863   to be max(int(c
+0004a720: 6f6e 746f 7572 5f6c 656e 6774 6820 2f20  ontour_length / 
+0004a730: 6478 7929 2c20 3329 2e20 200a 0a20 2020  dxy), 3).  ..   
+0004a740: 2020 2020 2073 6d6f 6f74 686e 6573 735f       smoothness_
+0004a750: 7065 725f 706f 696e 7420 3a20 666c 6f61  per_point : floa
+0004a760: 742c 2064 6566 6175 6c74 3d30 0a20 2020  t, default=0.   
+0004a770: 2020 2020 2020 2020 2050 6172 616d 6574           Paramet
+0004a780: 6572 2064 6574 6572 6d69 6e69 6e67 2074  er determining t
+0004a790: 6865 2073 6d6f 6f74 686e 6573 7320 6f66  he smoothness of
+0004a7a0: 2074 6865 2042 2d73 706c 696e 6520 6375   the B-spline cu
+0004a7b0: 7276 6520 7573 6564 0a20 2020 2020 2020  rve used.       
+0004a7c0: 2020 2020 2069 6e20 636f 6e74 6f75 7220       in contour 
+0004a7d0: 6170 7072 6f78 696d 6174 696f 6e20 666f  approximation fo
+0004a7e0: 7220 696e 7465 7270 6f6c 6174 696f 6e2e  r interpolation.
+0004a7f0: 2020 5468 6520 7072 6f64 7563 7420 6f66    The product of
+0004a800: 0a20 2020 2020 2020 2020 2020 2073 6d6f  .            smo
+0004a810: 6f74 686e 6573 735f 7065 725f 706f 696e  othness_per_poin
+0004a820: 7420 616e 6420 7468 6520 6e75 6d62 6572  t and the number
+0004a830: 206f 6620 636f 6e74 6f75 7220 706f 696e   of contour poin
+0004a840: 7473 2028 7370 6563 6966 6965 640a 2020  ts (specified.  
+0004a850: 2020 2020 2020 2020 2020 6469 7265 6374            direct
+0004a860: 6c79 2076 6961 206e 5f70 6f69 6e74 2c20  ly via n_point, 
+0004a870: 6f72 2069 6e64 6972 6563 746c 7920 7669  or indirectly vi
+0004a880: 6120 6478 7929 2063 6f72 7265 7370 6f6e  a dxy) correspon
+0004a890: 6473 2074 6f20 7468 650a 2020 2020 2020  ds to the.      
+0004a8a0: 2020 2020 2020 7061 7261 6d65 7465 7220        parameter 
+0004a8b0: 7320 6f66 2073 6369 7079 2e69 6e74 6572  s of scipy.inter
+0004a8c0: 706f 6c61 7465 2e73 706c 7072 6570 202d  polate.splprep -
+0004a8d0: 2073 6565 2064 6f63 756d 656e 7461 7469   see documentati
+0004a8e0: 6f6e 2061 743a 0a20 2020 2020 2020 200a  on at:.        .
+0004a8f0: 2020 2020 2020 2020 2020 2020 6874 7470              http
+0004a900: 733a 2f2f 7363 6970 792e 6769 7468 7562  s://scipy.github
+0004a910: 2e69 6f2f 6465 7664 6f63 732f 7265 6665  .io/devdocs/refe
+0004a920: 7265 6e63 652f 6765 6e65 7261 7465 642f  rence/generated/
+0004a930: 7363 6970 792e 696e 7465 7270 6f6c 6174  scipy.interpolat
+0004a940: 652e 7370 6c70 7265 702e 6874 6d6c 2373  e.splprep.html#s
+0004a950: 6369 7079 2e69 6e74 6572 706f 6c61 7465  cipy.interpolate
+0004a960: 2e73 706c 7072 6570 0a0a 2020 2020 2020  .splprep..      
+0004a970: 2020 2020 2020 4120 736d 6f6f 7468 6e65        A smoothne
+0004a980: 7373 5f70 6572 5f70 6f69 6e74 206f 6620  ss_per_point of 
+0004a990: 3020 666f 7263 6573 2074 6865 2042 2d73  0 forces the B-s
+0004a9a0: 706c 696e 6520 746f 2070 6173 7320 7468  pline to pass th
+0004a9b0: 726f 7567 680a 2020 2020 2020 2020 2020  rough.          
+0004a9c0: 2020 616c 6c20 6f66 2074 6865 2070 7265    all of the pre
+0004a9d0: 2d69 6e74 6572 706f 6c61 7469 6f6e 2063  -interpolation c
+0004a9e0: 6f6e 746f 7572 2070 6f69 6e74 732e 0a20  ontour points.. 
+0004a9f0: 2020 2020 2020 2027 2727 0a0a 2020 2020         '''..    
+0004aa00: 2020 2020 2320 496e 7465 7270 6f6c 6174      # Interpolat
+0004aa10: 6520 706f 696e 7473 2066 6f72 2074 6865  e points for the
+0004aa20: 2072 6f69 730a 2020 2020 2020 2020 726f   rois.        ro
+0004aa30: 6973 203d 205b 5d0a 2020 2020 2020 2020  is = [].        
+0004aa40: 666f 7220 726f 6920 696e 2073 656c 662e  for roi in self.
+0004aa50: 6765 745f 726f 6973 2829 3a0a 2020 2020  get_rois():.    
+0004aa60: 2020 2020 2020 2020 726f 6973 2e61 7070          rois.app
+0004aa70: 656e 6428 726f 692e 696e 7465 7270 6f6c  end(roi.interpol
+0004aa80: 6174 655f 706f 696e 7473 280a 2020 2020  ate_points(.    
+0004aa90: 2020 2020 2020 2020 2020 2020 6e5f 706f              n_po
+0004aaa0: 696e 742c 2064 7879 2c20 736d 6f6f 7468  int, dxy, smooth
+0004aab0: 6e65 7373 5f70 6572 5f70 6f69 6e74 2929  ness_per_point))
+0004aac0: 0a0a 2020 2020 2020 2020 2320 436c 6f6e  ..        # Clon
+0004aad0: 6520 7365 6c66 2c20 7468 656e 2072 6573  e self, then res
+0004aae0: 6574 2073 6f75 7263 6520 616e 6420 726f  et source and ro
+0004aaf0: 6973 0a20 2020 2020 2020 2073 7320 3d20  is.        ss = 
+0004ab00: 5374 7275 6374 7572 6553 6574 2873 656c  StructureSet(sel
+0004ab10: 6629 0a20 2020 2020 2020 2073 732e 736f  f).        ss.so
+0004ab20: 7572 6365 7320 3d20 726f 6973 0a20 2020  urces = rois.   
+0004ab30: 2020 2020 2073 732e 726f 6973 203d 2072       ss.rois = r
+0004ab40: 6f69 730a 0a20 2020 2020 2020 2072 6574  ois..        ret
+0004ab50: 7572 6e20 7373 0a0a 2020 2020 6465 6620  urn ss..    def 
+0004ab60: 6f72 6465 725f 726f 6973 2873 656c 662c  order_rois(self,
+0004ab70: 206f 7264 6572 3d27 782b 2729 3a0a 2020   order='x+'):.  
+0004ab80: 2020 2020 2020 2727 270a 2020 2020 2020        '''.      
+0004ab90: 2020 4f72 6465 7220 524f 4973 2062 7920    Order ROIs by 
+0004aba0: 6f6e 6520 6f66 2074 6865 6972 2063 656e  one of their cen
+0004abb0: 7472 6f69 6420 636f 6f72 6469 6e61 7465  troid coordinate
+0004abc0: 732e 0a0a 2020 2020 2020 2020 2a2a 5061  s...        **Pa
+0004abd0: 7261 6d65 7465 723a 2a2a 0a0a 2020 2020  rameter:**..    
+0004abe0: 2020 2020 6f72 6465 7220 3a20 7374 722c      order : str,
+0004abf0: 2064 6566 6175 6c74 3d27 782b 270a 2020   default='x+'.  
+0004ac00: 2020 2020 2020 2020 2020 5370 6563 6966            Specif
+0004ac10: 6963 6174 696f 6e20 6f66 2077 6179 2069  ication of way i
+0004ac20: 7420 7768 6963 6820 524f 4973 2061 7265  t which ROIs are
+0004ac30: 2074 6f20 6265 206f 7264 6572 643a 0a20   to be orderd:. 
+0004ac40: 2020 2020 2020 2020 2020 202d 2027 782b             - 'x+
+0004ac50: 2720 3a20 696e 206f 7264 6572 206f 6620  ' : in order of 
+0004ac60: 696e 6372 6561 7369 6e67 2078 2076 616c  increasing x val
+0004ac70: 7565 2e0a 2020 2020 2020 2020 2020 2020  ue..            
+0004ac80: 2d20 2778 2d27 203a 2069 6e20 6f72 6465  - 'x-' : in orde
+0004ac90: 7220 6f66 2064 6563 7265 6173 696e 6720  r of decreasing 
+0004aca0: 7820 7661 6c75 652e 0a20 2020 2020 2020  x value..       
+0004acb0: 2020 2020 202d 2027 792b 2720 3a20 696e       - 'y+' : in
+0004acc0: 206f 7264 6572 206f 6620 696e 6372 6561   order of increa
+0004acd0: 7369 6e67 2079 2076 616c 7565 2e0a 2020  sing y value..  
+0004ace0: 2020 2020 2020 2020 2020 2d20 2779 2d27            - 'y-'
+0004acf0: 203a 2069 6e20 6f72 6465 7220 6f66 2064   : in order of d
+0004ad00: 6563 7265 6173 696e 6720 7920 7661 6c75  ecreasing y valu
+0004ad10: 652e 0a20 2020 2020 2020 2020 2020 202d  e..            -
+0004ad20: 2027 7a2b 2720 3a20 696e 206f 7264 6572   'z+' : in order
+0004ad30: 206f 6620 696e 6372 6561 7369 6e67 207a   of increasing z
+0004ad40: 2076 616c 7565 2e0a 2020 2020 2020 2020   value..        
+0004ad50: 2020 2020 2d20 277a 2d27 203a 2069 6e20      - 'z-' : in 
+0004ad60: 6f72 6465 7220 6f66 2064 6563 7265 6173  order of decreas
+0004ad70: 696e 6720 7a20 7661 6c75 652e 0a20 2020  ing z value..   
+0004ad80: 2020 2020 2027 2727 0a0a 2020 2020 2020       '''..      
+0004ad90: 2020 6966 206f 7264 6572 206e 6f74 2069    if order not i
+0004ada0: 6e20 5b27 782b 272c 2027 782d 272c 2027  n ['x+', 'x-', '
+0004adb0: 792b 272c 2027 792d 272c 2027 7a2b 272c  y+', 'y-', 'z+',
+0004adc0: 2027 7a2d 275d 3a0a 2020 2020 2020 2020   'z-']:.        
+0004add0: 2020 2020 7265 7475 726e 0a0a 2020 2020      return..    
+0004ade0: 2020 2020 2320 4465 7465 726d 696e 6520      # Determine 
+0004adf0: 6178 6973 2066 6f72 206f 7264 6572 696e  axis for orderin
+0004ae00: 672c 2061 6e64 2064 6972 6563 7469 6f6e  g, and direction
+0004ae10: 2e0a 2020 2020 2020 2020 6178 6973 203d  ..        axis =
+0004ae20: 2027 7879 7a27 2e66 696e 6428 6f72 6465   'xyz'.find(orde
+0004ae30: 725b 305d 290a 2020 2020 2020 2020 7265  r[0]).        re
+0004ae40: 7665 7273 6520 3d20 2827 2d27 2069 6e20  verse = ('-' in 
+0004ae50: 6f72 6465 7229 0a0a 2020 2020 2020 2020  order)..        
+0004ae60: 2320 4372 6561 7465 2064 6963 7469 6f6e  # Create diction
+0004ae70: 6172 7920 7768 6572 6520 6b65 7973 2061  ary where keys a
+0004ae80: 7265 2063 656e 7472 6f69 6420 636f 6f72  re centroid coor
+0004ae90: 6469 6e61 7465 730a 2020 2020 2020 2020  dinates.        
+0004aea0: 2320 616e 6420 7661 6c75 6573 2061 7265  # and values are
+0004aeb0: 206c 6973 7473 206f 6620 524f 4920 696e   lists of ROI in
+0004aec0: 6469 6369 6573 2061 7420 7468 6573 6520  dicies at these 
+0004aed0: 636f 6f72 6469 6e61 7465 732e 0a20 2020  coordinates..   
+0004aee0: 2020 2020 2063 656e 7472 6f69 6473 203d       centroids =
+0004aef0: 207b 7d0a 2020 2020 2020 2020 666f 7220   {}.        for 
+0004af00: 6920 696e 2072 616e 6765 286c 656e 2873  i in range(len(s
+0004af10: 656c 662e 726f 6973 2929 3a0a 2020 2020  elf.rois)):.    
+0004af20: 2020 2020 2020 2020 7879 7a20 3d20 7365          xyz = se
+0004af30: 6c66 2e72 6f69 735b 695d 2e67 6574 5f63  lf.rois[i].get_c
+0004af40: 656e 7472 6f69 6428 295b 6178 6973 5d0a  entroid()[axis].
+0004af50: 2020 2020 2020 2020 2020 2020 6966 2078              if x
+0004af60: 797a 206e 6f74 2069 6e20 6365 6e74 726f  yz not in centro
+0004af70: 6964 733a 0a20 2020 2020 2020 2020 2020  ids:.           
+0004af80: 2020 2020 2063 656e 7472 6f69 6473 5b78       centroids[x
+0004af90: 797a 5d20 3d20 5b5d 0a20 2020 2020 2020  yz] = [].       
+0004afa0: 2020 2020 2063 656e 7472 6f69 6473 5b78       centroids[x
+0004afb0: 797a 5d2e 6170 7065 6e64 2869 290a 0a20  yz].append(i).. 
+0004afc0: 2020 2020 2020 2023 2043 7265 6174 6520         # Create 
+0004afd0: 6c69 7374 206f 6620 524f 4973 206f 7264  list of ROIs ord
+0004afe0: 6572 6564 2062 7920 6365 6e74 726f 6964  ered by centroid
+0004aff0: 2063 6f6f 7264 696e 6174 652e 0a20 2020   coordinate..   
+0004b000: 2020 2020 2072 6f69 7320 3d20 5b5d 0a20       rois = []. 
+0004b010: 2020 2020 2020 2066 6f72 2063 656e 7472         for centr
+0004b020: 6f69 6420 696e 2073 6f72 7465 6428 6365  oid in sorted(ce
+0004b030: 6e74 726f 6964 732c 2072 6576 6572 7365  ntroids, reverse
+0004b040: 3d72 6576 6572 7365 293a 0a20 2020 2020  =reverse):.     
+0004b050: 2020 2020 2020 2066 6f72 2069 2069 6e20         for i in 
+0004b060: 6365 6e74 726f 6964 735b 6365 6e74 726f  centroids[centro
+0004b070: 6964 5d3a 0a20 2020 2020 2020 2020 2020  id]:.           
+0004b080: 2020 2020 2072 6f69 732e 6170 7065 6e64       rois.append
+0004b090: 2873 656c 662e 726f 6973 5b69 5d29 0a0a  (self.rois[i])..
+0004b0a0: 2020 2020 2020 2020 2320 5374 6f72 6520          # Store 
+0004b0b0: 7468 6520 6e65 7720 6f72 6465 7220 6f66  the new order of
+0004b0c0: 2052 4f49 732e 0a20 2020 2020 2020 2073   ROIs..        s
+0004b0d0: 656c 662e 726f 6973 203d 2072 6f69 730a  elf.rois = rois.
+0004b0e0: 0a20 2020 2064 6566 2063 6f6d 6269 6e65  .    def combine
+0004b0f0: 5f72 6f69 7328 7365 6c66 2c20 6e61 6d65  _rois(self, name
+0004b100: 3d4e 6f6e 652c 2072 6f69 5f6e 616d 6573  =None, roi_names
+0004b110: 3d4e 6f6e 652c 2069 6d61 6765 3d4e 6f6e  =None, image=Non
+0004b120: 652c 206d 6574 686f 643d 4e6f 6e65 293a  e, method=None):
+0004b130: 0a20 2020 2020 2020 2027 2727 0a20 2020  .        '''.   
+0004b140: 2020 2020 2043 6f6d 6269 6e65 2074 776f       Combine two
+0004b150: 206f 7220 6d6f 7265 2052 4f49 7320 6173   or more ROIs as
+0004b160: 2061 2073 696e 676c 6520 524f 492e 0a0a   a single ROI...
+0004b170: 2020 2020 2020 2020 2a2a 5061 7261 6d65          **Parame
+0004b180: 7465 7273 3a2a 2a0a 0a20 2020 2020 2020  ters:**..       
+0004b190: 206e 616d 6520 3a20 7374 722c 2064 6566   name : str, def
+0004b1a0: 6175 6c74 3d4e 6f6e 650a 2020 2020 2020  ault=None.      
+0004b1b0: 2020 2020 2020 4e61 6d65 2074 6f20 6265        Name to be
+0004b1c0: 2067 6976 656e 2074 6f20 7468 6520 636f   given to the co
+0004b1d0: 6d70 6f73 6974 6520 524f 492e 2020 4966  mposite ROI.  If
+0004b1e0: 204e 6f6e 652c 2074 6865 0a20 2020 2020   None, the.     
+0004b1f0: 2020 2020 2020 206e 616d 6520 6173 7369         name assi
+0004b200: 676e 6564 2069 7320 666f 726d 6564 2062  gned is formed b
+0004b210: 7920 6a6f 696e 696e 6720 746f 6765 7468  y joining togeth
+0004b220: 6572 2074 6865 206e 616d 6573 0a20 2020  er the names.   
+0004b230: 2020 2020 2020 2020 206f 6620 7468 6520           of the 
+0004b240: 6f72 6967 696e 616c 2052 4f49 732e 0a0a  original ROIs...
+0004b250: 2020 2020 2020 2020 726f 695f 6e61 6d65          roi_name
+0004b260: 7320 3a20 6c69 7374 2c20 6465 6661 756c  s : list, defaul
+0004b270: 743d 4e6f 6e65 0a20 2020 2020 2020 2020  t=None.         
+0004b280: 2020 204c 6973 7420 6f66 206e 616d 6573     List of names
+0004b290: 206f 6620 524f 4973 2074 6f20 6265 2063   of ROIs to be c
+0004b2a0: 6f6d 6269 6e65 642e 2020 4966 204e 6f6e  ombined.  If Non
+0004b2b0: 652c 2061 6c6c 206f 6620 7468 650a 2020  e, all of the.  
+0004b2c0: 2020 2020 2020 2020 2020 7374 7275 6374            struct
+0004b2d0: 7572 6520 7365 7427 7320 524f 4973 2061  ure set's ROIs a
+0004b2e0: 7265 2063 6f6d 6269 6e65 642e 0a0a 2020  re combined...  
+0004b2f0: 2020 2020 2020 696d 6167 6520 3a20 736b        image : sk
+0004b300: 7274 2e69 6d61 6765 2e49 6d61 6765 2c20  rt.image.Image, 
+0004b310: 6465 6661 756c 743d 4e6f 6e65 0a20 2020  default=None.   
+0004b320: 2020 2020 2020 2020 2049 6d61 6765 2074           Image t
+0004b330: 6f20 7365 7420 666f 7220 7468 6520 636f  o set for the co
+0004b340: 6d70 6f73 6974 6520 524f 492e 2020 4966  mposite ROI.  If
+0004b350: 204e 6f6e 652c 2075 7365 2074 6865 2069   None, use the i
+0004b360: 6d61 6765 0a20 2020 2020 2020 2020 2020  mage.           
+0004b370: 206f 6620 7468 6520 524f 4920 7769 7468   of the ROI with
+0004b380: 2074 6865 2066 6972 7374 206e 616d 6520   the first name 
+0004b390: 696e 203c 726f 695f 6e61 6d65 733e 2e0a  in <roi_names>..
+0004b3a0: 0a20 2020 2020 2020 206d 6574 686f 6420  .        method 
+0004b3b0: 3a20 7374 722c 2064 6566 6175 6c74 3d4e  : str, default=N
+0004b3c0: 6f6e 650a 2020 2020 2020 2020 2020 2020  one.            
+0004b3d0: 4d65 7468 6f64 2074 6f20 7573 6520 666f  Method to use fo
+0004b3e0: 7220 636f 6d62 696e 696e 6720 524f 4973  r combining ROIs
+0004b3f0: 2e20 2043 616e 2062 653a 200a 0a20 2020  .  Can be: ..   
+0004b400: 2020 2020 2020 2020 2020 2020 202d 2022               - "
+0004b410: 636f 6e74 6f75 7222 3a20 7461 6b65 2075  contour": take u
+0004b420: 6e61 7279 2075 6e69 6f6e 206f 6620 7368  nary union of sh
+0004b430: 6170 656c 7920 706f 6c79 676f 6e73 2e0a  apely polygons..
+0004b440: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004b450: 2d20 226d 6173 6b22 3a20 7375 6d20 6269  - "mask": sum bi
+0004b460: 6e61 7279 206d 6173 6b73 2e0a 2020 2020  nary masks..    
+0004b470: 2020 2020 2020 2020 2020 2020 2d20 2261              - "a
+0004b480: 7574 6f22 3a20 7573 6520 7468 6520 6465  uto": use the de
+0004b490: 6661 756c 745f 6765 6f6d 5f6d 6574 686f  fault_geom_metho
+0004b4a0: 6420 6f66 2074 6865 2052 4f49 2077 6974  d of the ROI wit
+0004b4b0: 6820 7468 650a 2020 2020 2020 2020 2020  h the.          
+0004b4c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004b4d0: 6669 7273 7420 6e61 6d65 2069 6e20 3c72  first name in <r
+0004b4e0: 6f69 5f6e 616d 6573 3e2e 0a0a 2020 2020  oi_names>...    
+0004b4f0: 2020 2020 2020 2020 4966 204e 6f6e 652c          If None,
+0004b500: 2022 6175 746f 2220 6973 2075 7365 642e   "auto" is used.
+0004b510: 0a20 2020 2020 2020 2027 2727 0a0a 2020  .        '''..  
+0004b520: 2020 2020 2020 2320 4966 204e 6f6e 6520        # If None 
+0004b530: 7661 6c75 6573 2070 6173 7365 642c 2073  values passed, s
+0004b540: 6574 2064 6566 6175 6c74 2062 6568 6176  et default behav
+0004b550: 696f 7572 2e0a 2020 2020 2020 2020 6966  iour..        if
+0004b560: 2072 6f69 5f6e 616d 6573 2069 7320 4e6f   roi_names is No
+0004b570: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+0004b580: 726f 695f 6e61 6d65 7320 3d20 7365 6c66  roi_names = self
+0004b590: 2e67 6574 5f72 6f69 5f6e 616d 6573 2829  .get_roi_names()
+0004b5a0: 0a20 2020 2020 2020 2069 6620 6e61 6d65  .        if name
+0004b5b0: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
+0004b5c0: 2020 2020 2020 6e61 6d65 203d 2027 2b27        name = '+'
+0004b5d0: 2e6a 6f69 6e28 726f 695f 6e61 6d65 7329  .join(roi_names)
+0004b5e0: 0a20 2020 2020 2020 2069 6620 6d65 7468  .        if meth
+0004b5f0: 6f64 2069 6e20 5b4e 6f6e 652c 2022 6175  od in [None, "au
+0004b600: 746f 225d 3a0a 2020 2020 2020 2020 2020  to"]:.          
+0004b610: 2020 6d65 7468 6f64 203d 2073 656c 665b    method = self[
+0004b620: 726f 695f 6e61 6d65 735b 305d 5d2e 6465  roi_names[0]].de
+0004b630: 6661 756c 745f 6765 6f6d 5f6d 6574 686f  fault_geom_metho
+0004b640: 640a 2020 2020 2020 2020 6966 2069 6d61  d.        if ima
+0004b650: 6765 2069 7320 4e6f 6e65 3a0a 2020 2020  ge is None:.    
+0004b660: 2020 2020 2020 2020 696d 6167 6520 3d20          image = 
+0004b670: 7365 6c66 5b72 6f69 5f6e 616d 6573 5b30  self[roi_names[0
+0004b680: 5d5d 2e69 6d61 6765 0a0a 2020 2020 2020  ]].image..      
+0004b690: 2020 6966 2022 636f 6e74 6f75 7222 203d    if "contour" =
+0004b6a0: 3d20 6d65 7468 6f64 3a0a 2020 2020 2020  = method:.      
+0004b6b0: 2020 2020 2020 2320 4372 6561 7465 2061        # Create a
+0004b6c0: 2064 6963 7469 6f6e 6172 7920 636f 6e74   dictionary cont
+0004b6d0: 6169 6e69 6e67 2070 6f6c 7967 6f6e 7320  aining polygons 
+0004b6e0: 666f 7220 616c 6c20 524f 4973 2e0a 2020  for all ROIs..  
+0004b6f0: 2020 2020 2020 2020 2020 616c 6c5f 706f            all_po
+0004b700: 6c79 676f 6e73 203d 207b 7d0a 2020 2020  lygons = {}.    
+0004b710: 2020 2020 2020 2020 666f 7220 726f 6920          for roi 
+0004b720: 696e 2073 656c 662e 6765 745f 726f 6973  in self.get_rois
+0004b730: 2872 6f69 5f6e 616d 6573 293a 0a20 2020  (roi_names):.   
+0004b740: 2020 2020 2020 2020 2020 2020 2066 6f72               for
+0004b750: 206b 6579 2c20 706f 6c79 676f 6e73 2069   key, polygons i
+0004b760: 6e20 726f 692e 6765 745f 706f 6c79 676f  n roi.get_polygo
+0004b770: 6e73 2829 2e69 7465 6d73 2829 3a0a 2020  ns().items():.  
+0004b780: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004b790: 2020 6966 206e 6f74 206b 6579 2069 6e20    if not key in 
+0004b7a0: 616c 6c5f 706f 6c79 676f 6e73 3a0a 2020  all_polygons:.  
+0004b7b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004b7c0: 2020 2020 2020 616c 6c5f 706f 6c79 676f        all_polygo
+0004b7d0: 6e73 5b6b 6579 5d20 3d20 5b5d 0a20 2020  ns[key] = [].   
+0004b7e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004b7f0: 2061 6c6c 5f70 6f6c 7967 6f6e 735b 6b65   all_polygons[ke
+0004b800: 795d 2e65 7874 656e 6428 706f 6c79 676f  y].extend(polygo
+0004b810: 6e73 290a 0a20 2020 2020 2020 2020 2020  ns)..           
+0004b820: 2023 2045 7661 6c75 6174 6520 7468 6520   # Evaluate the 
+0004b830: 756e 6172 7920 756e 696f 6e20 6f66 2070  unary union of p
+0004b840: 6f6c 7967 6f6e 7320 666f 7220 6561 6368  olygons for each
+0004b850: 2073 6c69 6365 2e0a 2020 2020 2020 2020   slice..        
+0004b860: 2020 2020 616c 6c5f 706f 6c79 676f 6e73      all_polygons
+0004b870: 203d 207b 6b65 793a 205b 6f70 732e 756e   = {key: [ops.un
+0004b880: 6172 795f 756e 696f 6e28 616c 6c5f 706f  ary_union(all_po
+0004b890: 6c79 676f 6e73 5b6b 6579 5d29 5d0a 2020  lygons[key])].  
+0004b8a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004b8b0: 2020 2066 6f72 206b 6579 2069 6e20 616c     for key in al
+0004b8c0: 6c5f 706f 6c79 676f 6e73 7d0a 0a20 2020  l_polygons}..   
+0004b8d0: 2020 2020 2020 2020 2023 2043 7265 6174           # Creat
+0004b8e0: 6520 7468 6520 636f 6d70 6f73 6974 6520  e the composite 
+0004b8f0: 524f 492e 0a20 2020 2020 2020 2020 2020  ROI..           
+0004b900: 2072 6f69 5f6e 6577 203d 2052 4f49 2873   roi_new = ROI(s
+0004b910: 6f75 7263 653d 616c 6c5f 706f 6c79 676f  ource=all_polygo
+0004b920: 6e73 2c20 696d 6167 653d 696d 6167 652c  ns, image=image,
+0004b930: 206e 616d 653d 6e61 6d65 290a 0a20 2020   name=name)..   
+0004b940: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+0004b950: 2020 2020 2020 2023 2055 7365 2064 6174         # Use dat
+0004b960: 6120 6672 6f6d 206f 6e65 206f 6620 7468  a from one of th
+0004b970: 6520 524f 4973 2061 7320 6120 7374 6172  e ROIs as a star
+0004b980: 7469 6e67 2070 6f69 6e74 2e0a 2020 2020  ting point..    
+0004b990: 2020 2020 2020 2020 726f 6930 203d 2073          roi0 = s
+0004b9a0: 656c 662e 6765 745f 726f 6928 726f 695f  elf.get_roi(roi_
+0004b9b0: 6e61 6d65 735b 305d 290a 2020 2020 2020  names[0]).      
+0004b9c0: 2020 2020 2020 726f 695f 6e65 7720 3d20        roi_new = 
+0004b9d0: 524f 4928 736f 7572 6365 3d72 6f69 302e  ROI(source=roi0.
+0004b9e0: 6765 745f 6d61 736b 2829 2e63 6f70 7928  get_mask().copy(
+0004b9f0: 292c 2061 6666 696e 653d 726f 6930 2e61  ), affine=roi0.a
+0004ba00: 6666 696e 652c 0a20 2020 2020 2020 2020  ffine,.         
+0004ba10: 2020 2020 2020 2020 2020 206e 616d 653d             name=
+0004ba20: 6e61 6d65 2c20 696d 6167 653d 696d 6167  name, image=imag
+0004ba30: 6529 0a0a 2020 2020 2020 2020 2020 2020  e)..            
+0004ba40: 2320 436f 6d62 696e 6520 7769 7468 2064  # Combine with d
+0004ba50: 6174 6120 6672 6f6d 2074 6865 206f 7468  ata from the oth
+0004ba60: 6572 2052 4f49 732e 0a20 2020 2020 2020  er ROIs..       
+0004ba70: 2020 2020 2066 6f72 2069 2069 6e20 7261       for i in ra
+0004ba80: 6e67 6528 312c 206c 656e 2872 6f69 5f6e  nge(1, len(roi_n
+0004ba90: 616d 6573 2929 3a0a 2020 2020 2020 2020  ames)):.        
+0004baa0: 2020 2020 2020 2020 726f 695f 6e65 772e          roi_new.
+0004bab0: 6d61 736b 2e64 6174 6120 7c3d 2073 656c  mask.data |= sel
+0004bac0: 662e 6765 745f 726f 6928 726f 695f 6e61  f.get_roi(roi_na
+0004bad0: 6d65 735b 695d 292e 6765 745f 6d61 736b  mes[i]).get_mask
+0004bae0: 2829 0a0a 2020 2020 2020 2020 7265 7475  ()..        retu
+0004baf0: 726e 2072 6f69 5f6e 6577 0a0a 2020 2020  rn roi_new..    
+0004bb00: 6465 6620 6765 745f 6d61 736b 5f69 6d61  def get_mask_ima
+0004bb10: 6765 2873 656c 662c 206e 616d 653d 4e6f  ge(self, name=No
+0004bb20: 6e65 293a 0a20 2020 2020 2020 2022 2222  ne):.        """
+0004bb30: 0a20 2020 2020 2020 2047 6574 2069 6d61  .        Get ima
+0004bb40: 6765 206f 626a 6563 7420 7265 7072 6573  ge object repres
+0004bb50: 656e 7469 6e67 206d 6173 6b20 666f 7220  enting mask for 
+0004bb60: 616c 6c20 524f 4973 206f 6620 7374 7275  all ROIs of stru
+0004bb70: 6374 7572 6520 7365 742e 0a0a 2020 2020  cture set...    
+0004bb80: 2020 2020 2a2a 5061 7261 6d65 7465 7273      **Parameters
+0004bb90: 3a2a 2a0a 0a20 2020 2020 2020 206e 616d  :**..        nam
+0004bba0: 6520 3a20 7374 722c 2064 6566 6175 6c74  e : str, default
+0004bbb0: 3d4e 6f6e 650a 2020 2020 2020 2020 2020  =None.          
+0004bbc0: 2020 4e61 6d65 2074 6f20 6265 2067 6976    Name to be giv
+0004bbd0: 656e 2074 6f20 7468 6520 6d61 736b 2069  en to the mask i
+0004bbe0: 6d61 6765 2e20 2049 6620 4e6f 6e65 2c20  mage.  If None, 
+0004bbf0: 7468 650a 2020 2020 2020 2020 2020 2020  the.            
+0004bc00: 6e61 6d65 2061 7373 6967 6e65 6420 6973  name assigned is
+0004bc10: 2074 6865 206e 616d 6520 6f66 2074 6865   the name of the
+0004bc20: 2073 7472 7563 7475 7265 2073 6574 2c20   structure set, 
+0004bc30: 7769 7468 2073 7566 6669 780a 2020 2020  with suffix.    
+0004bc40: 2020 2020 2020 2020 225f 6d61 736b 2220          "_mask" 
+0004bc50: 6170 7065 6e64 6564 2e0a 2020 2020 2020  appended..      
+0004bc60: 2020 2222 220a 2020 2020 2020 2020 6e61    """.        na
+0004bc70: 6d65 203d 206e 616d 6520 6f72 2066 227b  me = name or f"{
+0004bc80: 7365 6c66 2e6e 616d 657d 5f6d 6173 6b22  self.name}_mask"
+0004bc90: 0a20 2020 2020 2020 2072 6f69 5f63 6f6d  .        roi_com
+0004bca0: 6269 6e65 6420 3d20 7365 6c66 2e63 6f6d  bined = self.com
+0004bcb0: 6269 6e65 5f72 6f69 7328 6e61 6d65 3d6e  bine_rois(name=n
+0004bcc0: 616d 6529 0a20 2020 2020 2020 206d 6173  ame).        mas
+0004bcd0: 6b5f 696d 6167 6520 3d20 726f 695f 636f  k_image = roi_co
+0004bce0: 6d62 696e 6564 2e67 6574 5f6d 6173 6b5f  mbined.get_mask_
+0004bcf0: 696d 6167 6528 290a 2020 2020 2020 2020  image().        
+0004bd00: 7265 7475 726e 206d 6173 6b5f 696d 6167  return mask_imag
+0004bd10: 650a 0a20 2020 2064 6566 2063 726f 7028  e..    def crop(
+0004bd20: 7365 6c66 2c20 786c 696d 3d4e 6f6e 652c  self, xlim=None,
+0004bd30: 2079 6c69 6d3d 4e6f 6e65 2c20 7a6c 696d   ylim=None, zlim
+0004bd40: 3d4e 6f6e 6529 3a0a 2020 2020 2020 2020  =None):.        
+0004bd50: 2222 220a 2020 2020 2020 2020 4372 6f70  """.        Crop
+0004bd60: 2061 6c6c 2052 4f49 7320 6f66 2053 7472   all ROIs of Str
+0004bd70: 7563 7475 7265 5365 7420 746f 2073 7065  uctureSet to spe
+0004bd80: 6369 6669 6564 2072 616e 6765 2069 6e20  cified range in 
+0004bd90: 782c 2079 2c20 7a2e 0a0a 2020 2020 2020  x, y, z...      
+0004bda0: 2020 5468 6520 7061 7261 6d65 7465 7273    The parameters
+0004bdb0: 2078 6c69 6d2c 2079 6c69 6d2c 207a 6c69   xlim, ylim, zli
+0004bdc0: 6d20 6172 6520 7061 7373 6564 2074 6f20  m are passed to 
+0004bdd0: 6561 6368 2052 4f49 2773 2063 726f 7028  each ROI's crop(
+0004bde0: 2920 6d65 7468 6f64 2e0a 2020 2020 2020  ) method..      
+0004bdf0: 2020 466f 7220 6578 706c 616e 6174 696f    For explanatio
+0004be00: 6e20 6f66 2074 6865 7365 2070 6172 616d  n of these param
+0004be10: 6574 6572 732c 2073 6565 2064 6f63 756d  eters, see docum
+0004be20: 656e 7461 7469 6f6e 2066 6f72 0a20 2020  entation for.   
+0004be30: 2020 2020 2073 6b72 742e 7374 7275 6374       skrt.struct
+0004be40: 7572 6573 2e52 4f49 2e63 726f 7028 292e  ures.ROI.crop().
+0004be50: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+0004be60: 2020 2020 2066 6f72 2072 6f69 2069 6e20       for roi in 
+0004be70: 7365 6c66 2e67 6574 5f72 6f69 7328 293a  self.get_rois():
+0004be80: 0a20 2020 2020 2020 2020 2020 2072 6f69  .            roi
+0004be90: 2e63 726f 7028 786c 696d 2c20 796c 696d  .crop(xlim, ylim
+0004bea0: 2c20 7a6c 696d 290a 0a63 6c61 7373 2053  , zlim)..class S
+0004beb0: 7472 7563 7475 7265 5365 7449 7465 7261  tructureSetItera
+0004bec0: 746f 723a 0a0a 2020 2020 6465 6620 5f5f  tor:..    def __
+0004bed0: 696e 6974 5f5f 2873 656c 662c 2073 7472  init__(self, str
+0004bee0: 7563 7475 7265 5f73 6574 293a 0a20 2020  ucture_set):.   
+0004bef0: 2020 2020 2073 656c 662e 6964 7820 3d20       self.idx = 
+0004bf00: 2d31 0a20 2020 2020 2020 2073 656c 662e  -1.        self.
+0004bf10: 7374 7275 6374 7572 655f 7365 7420 3d20  structure_set = 
+0004bf20: 7374 7275 6374 7572 655f 7365 740a 0a20  structure_set.. 
+0004bf30: 2020 2064 6566 205f 5f6e 6578 745f 5f28     def __next__(
+0004bf40: 7365 6c66 293a 0a20 2020 2020 2020 2073  self):.        s
+0004bf50: 656c 662e 6964 7820 2b3d 2031 0a20 2020  elf.idx += 1.   
+0004bf60: 2020 2020 2069 6620 7365 6c66 2e69 6478       if self.idx
+0004bf70: 203c 206c 656e 2873 656c 662e 7374 7275   < len(self.stru
+0004bf80: 6374 7572 655f 7365 742e 6765 745f 726f  cture_set.get_ro
+0004bf90: 6973 2829 293a 0a20 2020 2020 2020 2020  is()):.         
+0004bfa0: 2020 2072 6574 7572 6e20 7365 6c66 2e73     return self.s
+0004bfb0: 7472 7563 7475 7265 5f73 6574 2e67 6574  tructure_set.get
+0004bfc0: 5f72 6f69 7328 295b 7365 6c66 2e69 6478  _rois()[self.idx
+0004bfd0: 5d0a 2020 2020 2020 2020 7261 6973 6520  ].        raise 
+0004bfe0: 5374 6f70 4974 6572 6174 696f 6e0a 0a0a  StopIteration...
+0004bff0: 6465 6620 6c6f 6164 5f72 6f69 735f 6469  def load_rois_di
+0004c000: 636f 6d28 7061 7468 2c20 6e61 6d65 733d  com(path, names=
+0004c010: 4e6f 6e65 293a 0a20 2020 2022 2222 4c6f  None):.    """Lo
+0004c020: 6164 2052 4f49 2873 2920 6672 6f6d 2061  ad ROI(s) from a
+0004c030: 2064 6963 6f6d 2073 7472 7563 7475 7265   dicom structure
+0004c040: 2073 6574 2066 696c 652e 203c 6e61 6d65   set file. <name
+0004c050: 3e20 6361 6e20 6265 2061 2073 696e 676c  > can be a singl
+0004c060: 650a 2020 2020 6e61 6d65 206f 7220 6c69  e.    name or li
+0004c070: 7374 206f 6620 6e61 6d65 7320 6f66 2052  st of names of R
+0004c080: 4f49 7320 746f 206c 6f61 642e 2222 220a  OIs to load.""".
+0004c090: 0a20 2020 2023 204c 6f61 6420 6469 636f  .    # Load dico
+0004c0a0: 6d20 6f62 6a65 6374 0a20 2020 2074 7279  m object.    try
+0004c0b0: 3a0a 2020 2020 2020 2020 6473 203d 2070  :.        ds = p
+0004c0c0: 7964 6963 6f6d 2e64 636d 7265 6164 2870  ydicom.dcmread(p
+0004c0d0: 6174 682c 2066 6f72 6365 3d54 7275 6529  ath, force=True)
+0004c0e0: 0a20 2020 2065 7863 6570 7420 7079 6469  .    except pydi
+0004c0f0: 636f 6d2e 6572 726f 7273 2e49 6e76 616c  com.errors.Inval
+0004c100: 6964 4469 636f 6d45 7272 6f72 3a0a 2020  idDicomError:.  
+0004c110: 2020 2020 2020 7265 7475 726e 205b 5d2c        return [],
+0004c120: 204e 6f6e 650a 2020 2020 6966 206e 6f74   None.    if not
+0004c130: 2068 6173 6174 7472 2864 732c 2022 534f   hasattr(ds, "SO
+0004c140: 5043 6c61 7373 5549 4422 293a 0a20 2020  PClassUID"):.   
+0004c150: 2020 2020 2072 6574 7572 6e20 5b5d 2c20       return [], 
+0004c160: 4e6f 6e65 0a20 2020 2069 6620 6e6f 7420  None.    if not 
+0004c170: 2864 732e 534f 5043 6c61 7373 5549 4420  (ds.SOPClassUID 
+0004c180: 3d3d 2022 312e 322e 3834 302e 3130 3030  == "1.2.840.1000
+0004c190: 382e 352e 312e 342e 312e 312e 3438 312e  8.5.1.4.1.1.481.
+0004c1a0: 3322 293a 0a20 2020 2020 2020 2070 7269  3"):.        pri
+0004c1b0: 6e74 2866 2257 6172 6e69 6e67 3a20 7b70  nt(f"Warning: {p
+0004c1c0: 6174 687d 2069 7320 6e6f 7420 6120 4449  ath} is not a DI
+0004c1d0: 434f 4d20 7374 7275 6374 7572 6520 7365  COM structure se
+0004c1e0: 7420 6669 6c65 2122 290a 2020 2020 2020  t file!").      
+0004c1f0: 2020 7265 7475 726e 205b 5d2c 204e 6f6e    return [], Non
+0004c200: 650a 0a20 2020 2023 2047 6574 2052 4f49  e..    # Get ROI
+0004c210: 206e 616d 6573 0a20 2020 2073 6571 203d   names.    seq =
+0004c220: 2067 6574 5f64 6963 6f6d 5f73 6571 7565   get_dicom_seque
+0004c230: 6e63 6528 6473 2c20 2253 7472 7563 7475  nce(ds, "Structu
+0004c240: 7265 5365 7452 4f49 2229 0a20 2020 2072  reSetROI").    r
+0004c250: 6f69 7320 3d20 7b7d 0a20 2020 2066 6f72  ois = {}.    for
+0004c260: 2072 6f69 2069 6e20 7365 713a 0a20 2020   roi in seq:.   
+0004c270: 2020 2020 2072 6f69 735b 696e 7428 726f       rois[int(ro
+0004c280: 692e 524f 494e 756d 6265 7229 5d20 3d20  i.ROINumber)] = 
+0004c290: 7b22 6e61 6d65 223a 2072 6f69 2e52 4f49  {"name": roi.ROI
+0004c2a0: 4e61 6d65 7d0a 0a20 2020 2023 2046 696e  Name}..    # Fin
+0004c2b0: 6420 524f 4973 206d 6174 6368 696e 6720  d ROIs matching 
+0004c2c0: 7265 7175 6573 7465 6420 6e61 6d65 730a  requested names.
+0004c2d0: 2020 2020 6e61 6d65 735f 746f 5f6c 6f61      names_to_loa
+0004c2e0: 6420 3d20 4e6f 6e65 0a20 2020 2069 6620  d = None.    if 
+0004c2f0: 6973 696e 7374 616e 6365 286e 616d 6573  isinstance(names
+0004c300: 2c20 7374 7229 3a0a 2020 2020 2020 2020  , str):.        
+0004c310: 6e61 6d65 735f 746f 5f6c 6f61 6420 3d20  names_to_load = 
+0004c320: 5b6e 616d 6573 5d0a 2020 2020 656c 6966  [names].    elif
+0004c330: 2073 6b72 742e 636f 7265 2e69 735f 6c69   skrt.core.is_li
+0004c340: 7374 286e 616d 6573 293a 0a20 2020 2020  st(names):.     
+0004c350: 2020 206e 616d 6573 5f74 6f5f 6c6f 6164     names_to_load
+0004c360: 203d 206e 616d 6573 0a20 2020 2069 6620   = names.    if 
+0004c370: 6e61 6d65 735f 746f 5f6c 6f61 643a 0a20  names_to_load:. 
+0004c380: 2020 2020 2020 2072 6f69 7320 3d20 7b0a         rois = {.
+0004c390: 2020 2020 2020 2020 2020 2020 693a 2073              i: s
+0004c3a0: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
+0004c3b0: 2069 2c20 7320 696e 2072 6f69 732e 6974   i, s in rois.it
+0004c3c0: 656d 7328 290a 2020 2020 2020 2020 2020  ems().          
+0004c3d0: 2020 6966 2061 6e79 280a 2020 2020 2020    if any(.      
+0004c3e0: 2020 2020 2020 2020 2020 5b66 6e6d 6174            [fnmat
+0004c3f0: 6368 2e66 6e6d 6174 6368 2873 5b22 6e61  ch.fnmatch(s["na
+0004c400: 6d65 225d 2e6c 6f77 6572 2829 2c20 6e2e  me"].lower(), n.
+0004c410: 6c6f 7765 7228 2929 2066 6f72 206e 2069  lower()) for n i
+0004c420: 6e20 6e61 6d65 735f 746f 5f6c 6f61 645d  n names_to_load]
+0004c430: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
+0004c440: 2020 2020 2020 207d 0a20 2020 2020 2020         }.       
+0004c450: 2069 6620 6e6f 7420 6c65 6e28 726f 6973   if not len(rois
+0004c460: 293a 0a20 2020 2020 2020 2020 2020 2070  ):.            p
+0004c470: 7269 6e74 2866 2257 6172 6e69 6e67 3a20  rint(f"Warning: 
+0004c480: 6e6f 2052 4f49 7320 666f 756e 6420 6d61  no ROIs found ma
+0004c490: 7463 6869 6e67 206e 616d 6528 7329 3a20  tching name(s): 
+0004c4a0: 7b6e 616d 6573 7d22 290a 2020 2020 2020  {names}").      
+0004c4b0: 2020 2020 2020 7265 7475 726e 205b 5d2c        return [],
+0004c4c0: 204e 6f6e 650a 0a20 2020 2023 2047 6574   None..    # Get
+0004c4d0: 2052 4f49 2064 6574 6169 6c73 0a20 2020   ROI details.   
+0004c4e0: 2072 6f69 5f73 6571 203d 2067 6574 5f64   roi_seq = get_d
+0004c4f0: 6963 6f6d 5f73 6571 7565 6e63 6528 6473  icom_sequence(ds
+0004c500: 2c20 2252 4f49 436f 6e74 6f75 7222 290a  , "ROIContour").
+0004c510: 2020 2020 666f 7220 726f 6920 696e 2072      for roi in r
+0004c520: 6f69 5f73 6571 3a0a 0a20 2020 2020 2020  oi_seq:..       
+0004c530: 206e 756d 6265 7220 3d20 726f 692e 5265   number = roi.Re
+0004c540: 6665 7265 6e63 6564 524f 494e 756d 6265  ferencedROINumbe
+0004c550: 720a 2020 2020 2020 2020 6966 206e 756d  r.        if num
+0004c560: 6265 7220 6e6f 7420 696e 2072 6f69 733a  ber not in rois:
+0004c570: 0a20 2020 2020 2020 2020 2020 2063 6f6e  .            con
+0004c580: 7469 6e75 650a 2020 2020 2020 2020 6461  tinue.        da
+0004c590: 7461 203d 207b 2263 6f6e 746f 7572 7322  ta = {"contours"
+0004c5a0: 3a20 7b7d 7d0a 0a20 2020 2020 2020 2023  : {}}..        #
+0004c5b0: 2047 6574 2052 4f49 2063 6f6c 6f75 720a   Get ROI colour.
+0004c5c0: 2020 2020 2020 2020 6966 2022 524f 4944          if "ROID
+0004c5d0: 6973 706c 6179 436f 6c6f 7222 2069 6e20  isplayColor" in 
+0004c5e0: 726f 693a 0a20 2020 2020 2020 2020 2020  roi:.           
+0004c5f0: 2064 6174 615b 2263 6f6c 6f72 225d 203d   data["color"] =
+0004c600: 205b 696e 7428 6329 202f 2032 3535 2066   [int(c) / 255 f
+0004c610: 6f72 2063 2069 6e20 6c69 7374 2872 6f69  or c in list(roi
+0004c620: 2e52 4f49 4469 7370 6c61 7943 6f6c 6f72  .ROIDisplayColor
+0004c630: 295d 0a20 2020 2020 2020 2065 6c73 653a  )].        else:
+0004c640: 0a20 2020 2020 2020 2020 2020 2064 6174  .            dat
+0004c650: 615b 2263 6f6c 6f72 225d 203d 204e 6f6e  a["color"] = Non
+0004c660: 650a 0a20 2020 2020 2020 2023 2047 6574  e..        # Get
+0004c670: 2063 6f6e 746f 7572 730a 2020 2020 2020   contours.      
+0004c680: 2020 636f 6e74 6f75 725f 7365 7120 3d20    contour_seq = 
+0004c690: 6765 745f 6469 636f 6d5f 7365 7175 656e  get_dicom_sequen
+0004c6a0: 6365 2872 6f69 2c20 2243 6f6e 746f 7572  ce(roi, "Contour
+0004c6b0: 2229 0a20 2020 2020 2020 2069 6620 636f  ").        if co
+0004c6c0: 6e74 6f75 725f 7365 713a 0a20 2020 2020  ntour_seq:.     
+0004c6d0: 2020 2020 2020 2066 6f72 2063 2069 6e20         for c in 
+0004c6e0: 636f 6e74 6f75 725f 7365 713a 0a20 2020  contour_seq:.   
+0004c6f0: 2020 2020 2020 2020 2020 2020 2070 6c61               pla
+0004c700: 6e65 5f64 6174 6120 3d20 5b0a 2020 2020  ne_data = [.    
+0004c710: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004c720: 5b66 6c6f 6174 2870 2920 666f 7220 7020  [float(p) for p 
+0004c730: 696e 2063 2e43 6f6e 746f 7572 4461 7461  in c.ContourData
+0004c740: 5b69 202a 2033 203a 2069 202a 2033 202b  [i * 3 : i * 3 +
+0004c750: 2033 5d5d 0a20 2020 2020 2020 2020 2020   3]].           
+0004c760: 2020 2020 2020 2020 2066 6f72 2069 2069           for i i
+0004c770: 6e20 7261 6e67 6528 632e 4e75 6d62 6572  n range(c.Number
+0004c780: 4f66 436f 6e74 6f75 7250 6f69 6e74 7329  OfContourPoints)
+0004c790: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0004c7a0: 205d 0a20 2020 2020 2020 2020 2020 2020   ].             
+0004c7b0: 2020 207a 203d 2066 6c6f 6174 2863 2e43     z = float(c.C
+0004c7c0: 6f6e 746f 7572 4461 7461 5b32 5d29 0a20  ontourData[2]). 
+0004c7d0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0004c7e0: 6620 7a20 6e6f 7420 696e 2064 6174 615b  f z not in data[
+0004c7f0: 2263 6f6e 746f 7572 7322 5d3a 0a20 2020  "contours"]:.   
+0004c800: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004c810: 2064 6174 615b 2263 6f6e 746f 7572 7322   data["contours"
+0004c820: 5d5b 7a5d 203d 205b 5d0a 2020 2020 2020  ][z] = [].      
+0004c830: 2020 2020 2020 2020 2020 6461 7461 5b22            data["
+0004c840: 636f 6e74 6f75 7273 225d 5b7a 5d2e 6170  contours"][z].ap
+0004c850: 7065 6e64 286e 702e 6172 7261 7928 706c  pend(np.array(pl
+0004c860: 616e 655f 6461 7461 2929 0a0a 2020 2020  ane_data))..    
+0004c870: 2020 2020 726f 6973 5b6e 756d 6265 725d      rois[number]
+0004c880: 2e75 7064 6174 6528 6461 7461 290a 0a20  .update(data).. 
+0004c890: 2020 2072 6574 7572 6e20 726f 6973 2c20     return rois, 
+0004c8a0: 6473 0a0a 0a64 6566 2067 6574 5f64 6963  ds...def get_dic
+0004c8b0: 6f6d 5f73 6571 7565 6e63 6528 6473 3d4e  om_sequence(ds=N
+0004c8c0: 6f6e 652c 2062 6173 656e 616d 653d 2222  one, basename=""
+0004c8d0: 293a 0a0a 2020 2020 7365 7175 656e 6365  ):..    sequence
+0004c8e0: 203d 205b 5d0a 2020 2020 666f 7220 7375   = [].    for su
+0004c8f0: 6666 6978 2069 6e20 5b22 5365 7175 656e  ffix in ["Sequen
+0004c900: 6365 222c 2022 7322 5d3a 0a20 2020 2020  ce", "s"]:.     
+0004c910: 2020 2061 7474 7269 6275 7465 203d 2066     attribute = f
+0004c920: 227b 6261 7365 6e61 6d65 7d7b 7375 6666  "{basename}{suff
+0004c930: 6978 7d22 0a20 2020 2020 2020 2069 6620  ix}".        if 
+0004c940: 6861 7361 7474 7228 6473 2c20 6174 7472  hasattr(ds, attr
+0004c950: 6962 7574 6529 3a0a 2020 2020 2020 2020  ibute):.        
+0004c960: 2020 2020 7365 7175 656e 6365 203d 2067      sequence = g
+0004c970: 6574 6174 7472 2864 732c 2061 7474 7269  etattr(ds, attri
+0004c980: 6275 7465 290a 2020 2020 2020 2020 2020  bute).          
+0004c990: 2020 6272 6561 6b0a 2020 2020 7265 7475    break.    retu
+0004c9a0: 726e 2073 6571 7565 6e63 650a 0a64 6566  rn sequence..def
+0004c9b0: 2063 6f6e 746f 7572 5f74 6f5f 706f 6c79   contour_to_poly
+0004c9c0: 676f 6e28 636f 6e74 6f75 7229 3a0a 2020  gon(contour):.  
+0004c9d0: 2020 2222 2243 6f6e 7665 7274 2061 206c    """Convert a l
+0004c9e0: 6973 7420 6f66 2063 6f6e 746f 7572 2070  ist of contour p
+0004c9f0: 6f69 6e74 7320 746f 2061 2053 6861 7065  oints to a Shape
+0004ca00: 6c79 2070 6f6c 7967 6f6e 2c20 656e 7375  ly polygon, ensu
+0004ca10: 7269 6e67 2074 6861 7420 0a20 2020 2074  ring that .    t
+0004ca20: 6865 2070 6f6c 7967 6f6e 2069 7320 7661  he polygon is va
+0004ca30: 6c69 642e 2222 220a 0a20 2020 2070 6f6c  lid."""..    pol
+0004ca40: 7967 6f6e 203d 2067 656f 6d65 7472 792e  ygon = geometry.
+0004ca50: 506f 6c79 676f 6e28 636f 6e74 6f75 7229  Polygon(contour)
+0004ca60: 0a0a 2020 2020 6465 6c74 6120 3d20 302e  ..    delta = 0.
+0004ca70: 3030 350a 2020 2020 6966 206e 6f74 2070  005.    if not p
+0004ca80: 6f6c 7967 6f6e 2e69 735f 7661 6c69 643a  olygon.is_valid:
+0004ca90: 0a20 2020 2020 2020 2074 6d70 203d 2067  .        tmp = g
+0004caa0: 656f 6d65 7472 792e 506f 6c79 676f 6e28  eometry.Polygon(
+0004cab0: 706f 6c79 676f 6e29 0a20 2020 2020 2020  polygon).       
+0004cac0: 2062 7566 6665 7220 3d20 302e 0a20 2020   buffer = 0..   
+0004cad0: 2020 2020 2023 2054 6865 2069 6465 6120       # The idea 
+0004cae0: 6865 7265 2069 7320 746f 2069 6e63 7265  here is to incre
+0004caf0: 6173 6520 7468 6520 6275 6666 6572 2064  ase the buffer d
+0004cb00: 6973 7461 6e63 6520 756e 7469 6c0a 2020  istance until.  
+0004cb10: 2020 2020 2020 2320 6120 7661 6c69 6420        # a valid 
+0004cb20: 706f 6c79 676f 6e20 6973 206f 6274 6169  polygon is obtai
+0004cb30: 6e65 642e 2020 5468 6973 2067 656e 6572  ned.  This gener
+0004cb40: 616c 6c79 2073 6565 6d73 2074 6f20 776f  ally seems to wo
+0004cb50: 726b 2e2e 2e0a 2020 2020 2020 2020 7768  rk....        wh
+0004cb60: 696c 6520 2869 7369 6e73 7461 6e63 6528  ile (isinstance(
+0004cb70: 706f 6c79 676f 6e2c 2067 656f 6d65 7472  polygon, geometr
+0004cb80: 792e 4d75 6c74 6950 6f6c 7967 6f6e 290a  y.MultiPolygon).
+0004cb90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004cba0: 6f72 206e 6f74 2070 6f6c 7967 6f6e 2e69  or not polygon.i
+0004cbb0: 735f 7661 6c69 6429 3a0a 2020 2020 2020  s_valid):.      
+0004cbc0: 2020 2020 2020 6275 6666 6572 202b 3d20        buffer += 
+0004cbd0: 6465 6c74 610a 2020 2020 2020 2020 2020  delta.          
+0004cbe0: 2020 706f 6c79 676f 6e20 3d20 746d 702e    polygon = tmp.
+0004cbf0: 6275 6666 6572 2862 7566 6665 7229 0a20  buffer(buffer). 
+0004cc00: 2020 2020 2020 2070 6f69 6e74 7320 3d20         points = 
+0004cc10: 5b5d 0a20 2020 2020 2020 2066 6f72 2078  [].        for x
+0004cc20: 2c20 7920 696e 2070 6f6c 7967 6f6e 2e65  , y in polygon.e
+0004cc30: 7874 6572 696f 722e 636f 6f72 6473 3a0a  xterior.coords:.
+0004cc40: 2020 2020 2020 2020 2020 2020 706f 696e              poin
+0004cc50: 7473 2e61 7070 656e 6428 2878 2c20 7929  ts.append((x, y)
+0004cc60: 290a 2020 2020 2020 2020 706f 6c79 676f  ).        polygo
+0004cc70: 6e20 3d20 6765 6f6d 6574 7279 2e50 6f6c  n = geometry.Pol
+0004cc80: 7967 6f6e 2870 6f69 6e74 7329 0a0a 2020  ygon(points)..  
+0004cc90: 2020 7265 7475 726e 2070 6f6c 7967 6f6e    return polygon
+0004cca0: 0a0a 6465 6620 706f 6c79 676f 6e5f 746f  ..def polygon_to
+0004ccb0: 5f63 6f6e 746f 7572 2870 6f6c 7967 6f6e  _contour(polygon
+0004ccc0: 293a 0a20 2020 2027 2727 0a20 2020 2043  ):.    '''.    C
+0004ccd0: 6f6e 7665 7274 2061 2053 6861 7065 6c79  onvert a Shapely
+0004cce0: 2070 6f6c 7967 6f6e 2074 6f20 6120 6c69   polygon to a li
+0004ccf0: 7374 206f 6620 636f 6e74 6f75 7220 706f  st of contour po
+0004cd00: 696e 7473 2e0a 0a20 2020 202a 2a50 6172  ints...    **Par
+0004cd10: 616d 6574 6572 3a2a 2a0a 0a20 2020 2070  ameter:**..    p
+0004cd20: 6f6c 7967 6f6e 3a20 7368 6170 656c 792e  olygon: shapely.
+0004cd30: 6765 6f6d 6574 7279 2e70 6f6c 7967 6f6e  geometry.polygon
+0004cd40: 0a20 2020 2020 2020 2053 6861 7065 6c79  .        Shapely
+0004cd50: 2070 6f6c 7967 6f6e 2e0a 0a20 2020 207a   polygon...    z
+0004cd60: 5f70 6f6c 7967 6f6e 3a20 7a20 636f 6f72  _polygon: z coor
+0004cd70: 6469 6e61 7465 2061 7420 7768 6963 6820  dinate at which 
+0004cd80: 706f 6c79 676f 6e20 6973 2064 6566 696e  polygon is defin
+0004cd90: 6564 2e0a 2020 2020 2727 270a 2020 2020  ed..    '''.    
+0004cda0: 636f 6e74 6f75 725f 706f 696e 7473 203d  contour_points =
+0004cdb0: 205b 5d0a 2020 2020 666f 7220 782c 2079   [].    for x, y
+0004cdc0: 2069 6e20 6c69 7374 2870 6f6c 7967 6f6e   in list(polygon
+0004cdd0: 2e65 7874 6572 696f 722e 636f 6f72 6473  .exterior.coords
+0004cde0: 293a 0a20 2020 2020 2020 2063 6f6e 746f  ):.        conto
+0004cdf0: 7572 5f70 6f69 6e74 732e 6170 7065 6e64  ur_points.append
+0004ce00: 285b 782c 2079 5d29 0a20 2020 2063 6f6e  ([x, y]).    con
+0004ce10: 746f 7572 203d 206e 702e 6172 7261 7928  tour = np.array(
+0004ce20: 636f 6e74 6f75 725f 706f 696e 7473 290a  contour_points).
+0004ce30: 0a20 2020 2072 6574 7572 6e20 636f 6e74  .    return cont
+0004ce40: 6f75 720a 0a64 6566 2069 6e74 6572 706f  our..def interpo
+0004ce50: 6c61 7465 5f70 6f69 6e74 735f 7369 6e67  late_points_sing
+0004ce60: 6c65 5f63 6f6e 746f 7572 2873 6f75 7263  le_contour(sourc
+0004ce70: 653d 4e6f 6e65 2c20 6e5f 706f 696e 743d  e=None, n_point=
+0004ce80: 4e6f 6e65 2c20 6478 793d 4e6f 6e65 2c0a  None, dxy=None,.
+0004ce90: 2020 2020 2020 2020 736d 6f6f 7468 6e65          smoothne
+0004cea0: 7373 5f70 6572 5f70 6f69 6e74 3d30 293a  ss_per_point=0):
+0004ceb0: 0a20 2020 2027 2727 0a20 2020 2049 6e74  .    '''.    Int
+0004cec0: 6572 706f 6c61 7465 2070 6f69 6e74 7320  erpolate points 
+0004ced0: 666f 7220 6120 7369 6e67 6c65 2063 6f6e  for a single con
+0004cee0: 746f 7572 2e0a 0a20 2020 202a 2a50 6172  tour...    **Par
+0004cef0: 616d 6574 6572 733a 2a2a 0a0a 2020 2020  ameters:**..    
+0004cf00: 736f 7572 6365 203a 2073 6861 7065 6c79  source : shapely
+0004cf10: 2e70 6f6c 7967 6f6e 2e50 6f6c 7967 6f6e  .polygon.Polygon
+0004cf20: 2f6e 702e 6e64 6172 7261 792f 6c69 7374  /np.ndarray/list
+0004cf30: 2c20 6465 6661 756c 743d 4e6f 6e65 0a20  , default=None. 
+0004cf40: 2020 2020 2020 2043 6f6e 746f 7572 2072         Contour r
+0004cf50: 6570 7265 7365 6e74 6174 696f 6e20 6173  epresentation as
+0004cf60: 2065 6974 6865 7220 6120 7368 6170 656c   either a shapel
+0004cf70: 7920 506f 6c79 676f 6e2c 2061 206e 756d  y Polygon, a num
+0004cf80: 7079 0a20 2020 2020 2020 2061 7272 6179  py.        array
+0004cf90: 206f 6620 5b78 2c20 795d 2070 6169 7273   of [x, y] pairs
+0004cfa0: 206f 7220 6120 6c69 7374 206f 6620 5b78   or a list of [x
+0004cfb0: 2c20 795d 2070 6169 7273 2e20 2054 6865  , y] pairs.  The
+0004cfc0: 0a20 2020 2020 2020 2072 6574 7572 6e65  .        returne
+0004cfd0: 6420 636f 6e74 6f75 7220 6861 7320 7468  d contour has th
+0004cfe0: 6520 7361 6d65 2072 6570 7265 7365 6e74  e same represent
+0004cff0: 6174 696f 6e2e 0a0a 2020 2020 6e5f 706f  ation...    n_po
+0004d000: 696e 7420 3a20 696e 742c 2064 6566 6175  int : int, defau
+0004d010: 6c74 3d4e 6f6e 650a 2020 2020 2020 2020  lt=None.        
+0004d020: 4e75 6d62 6572 206f 6620 706f 696e 7473  Number of points
+0004d030: 2074 6f20 6465 6669 6e65 2063 6f6e 746f   to define conto
+0004d040: 7572 2c20 6166 7465 7220 696e 7465 7270  ur, after interp
+0004d050: 6f6c 6174 696f 6e2e 2020 5468 6973 206d  olation.  This m
+0004d060: 7573 740a 2020 2020 2020 2020 6265 2073  ust.        be s
+0004d070: 6574 2074 6f20 4e6f 6e65 2066 6f72 2064  et to None for d
+0004d080: 7879 2074 6f20 6265 2063 6f6e 7369 6465  xy to be conside
+0004d090: 7265 642e 0a0a 2020 2020 6478 7920 3a20  red...    dxy : 
+0004d0a0: 666c 6f61 742c 2064 6566 6175 6c74 3d4e  float, default=N
+0004d0b0: 6f6e 650a 2020 2020 2020 2020 4170 7072  one.        Appr
+0004d0c0: 6f78 696d 6174 6520 6469 7374 616e 6365  oximate distance
+0004d0d0: 2072 6571 7569 7265 6420 6265 7477 6565   required betwee
+0004d0e0: 6e20 636f 6e74 6f75 7220 706f 696e 7473  n contour points
+0004d0f0: 2e20 2054 6869 7320 6973 2074 616b 656e  .  This is taken
+0004d100: 0a20 2020 2020 2020 2069 6e74 6f20 6163  .        into ac
+0004d110: 636f 756e 7420 6f6e 6c79 2069 6620 6e5f  count only if n_
+0004d120: 706f 696e 7420 6973 2073 6574 2074 6f20  point is set to 
+0004d130: 4e6f 6e65 2e20 2046 6f72 2061 2063 6f6e  None.  For a con
+0004d140: 746f 7572 206f 660a 2020 2020 2020 2020  tour of.        
+0004d150: 6c65 6e67 7468 2063 6f6e 746f 7572 5f6c  length contour_l
+0004d160: 656e 6774 682c 2074 6865 206e 756d 6265  ength, the numbe
+0004d170: 7220 6f66 2063 6f6e 746f 7572 2070 6f69  r of contour poi
+0004d180: 6e74 7320 6973 2074 6865 6e20 7461 6b65  nts is then take
+0004d190: 6e0a 2020 2020 2020 2020 746f 2062 6520  n.        to be 
+0004d1a0: 6d61 7828 696e 7428 636f 6e74 6f75 725f  max(int(contour_
+0004d1b0: 6c65 6e67 7468 202f 2064 7879 292c 2033  length / dxy), 3
+0004d1c0: 292e 2020 0a0a 2020 2020 736d 6f6f 7468  ).  ..    smooth
+0004d1d0: 6e65 7373 5f70 6572 5f70 6f69 6e74 203a  ness_per_point :
+0004d1e0: 2066 6c6f 6174 2c20 6465 6661 756c 743d   float, default=
+0004d1f0: 300a 2020 2020 2020 2020 5061 7261 6d65  0.        Parame
+0004d200: 7465 7220 6465 7465 726d 696e 696e 6720  ter determining 
+0004d210: 7468 6520 736d 6f6f 7468 6e65 7373 206f  the smoothness o
+0004d220: 6620 7468 6520 422d 7370 6c69 6e65 2063  f the B-spline c
+0004d230: 7572 7665 2075 7365 640a 2020 2020 2020  urve used.      
+0004d240: 2020 696e 2063 6f6e 746f 7572 2061 7070    in contour app
+0004d250: 726f 7869 6d61 7469 6f6e 2066 6f72 2069  roximation for i
+0004d260: 6e74 6572 706f 6c61 7469 6f6e 2e20 2054  nterpolation.  T
+0004d270: 6865 2070 726f 6475 6374 206f 660a 2020  he product of.  
+0004d280: 2020 2020 2020 736d 6f6f 7468 6e65 7373        smoothness
+0004d290: 5f70 6572 5f70 6f69 6e74 2061 6e64 2074  _per_point and t
+0004d2a0: 6865 206e 756d 6265 7220 6f66 2063 6f6e  he number of con
+0004d2b0: 746f 7572 2070 6f69 6e74 7320 2873 7065  tour points (spe
+0004d2c0: 6369 6669 6564 0a20 2020 2020 2020 2064  cified.        d
+0004d2d0: 6972 6563 746c 7920 7669 6120 6e5f 706f  irectly via n_po
+0004d2e0: 696e 742c 206f 7220 696e 6469 7265 6374  int, or indirect
+0004d2f0: 6c79 2076 6961 2064 7879 2920 636f 7272  ly via dxy) corr
+0004d300: 6573 706f 6e64 7320 746f 2074 6865 0a20  esponds to the. 
+0004d310: 2020 2020 2020 2070 6172 616d 6574 6572         parameter
+0004d320: 2073 206f 6620 7363 6970 792e 696e 7465   s of scipy.inte
+0004d330: 7270 6f6c 6174 652e 7370 6c70 7265 7020  rpolate.splprep 
+0004d340: 2d20 7365 6520 646f 6375 6d65 6e74 6174  - see documentat
+0004d350: 696f 6e20 6174 3a0a 2020 2020 2020 2020  ion at:.        
+0004d360: 0a20 2020 2020 2020 2068 7474 7073 3a2f  .        https:/
+0004d370: 2f73 6369 7079 2e67 6974 6875 622e 696f  /scipy.github.io
+0004d380: 2f64 6576 646f 6373 2f72 6566 6572 656e  /devdocs/referen
+0004d390: 6365 2f67 656e 6572 6174 6564 2f73 6369  ce/generated/sci
+0004d3a0: 7079 2e69 6e74 6572 706f 6c61 7465 2e73  py.interpolate.s
+0004d3b0: 706c 7072 6570 2e68 746d 6c23 7363 6970  plprep.html#scip
+0004d3c0: 792e 696e 7465 7270 6f6c 6174 652e 7370  y.interpolate.sp
+0004d3d0: 6c70 7265 700a 0a20 2020 2020 2020 2041  lprep..        A
+0004d3e0: 2073 6d6f 6f74 686e 6573 735f 7065 725f   smoothness_per_
+0004d3f0: 706f 696e 7420 6f66 2030 2066 6f72 6365  point of 0 force
+0004d400: 7320 7468 6520 422d 7370 6c69 6e65 2074  s the B-spline t
+0004d410: 6f20 7061 7373 2074 6872 6f75 6768 0a20  o pass through. 
+0004d420: 2020 2020 2020 2061 6c6c 206f 6620 7468         all of th
+0004d430: 6520 7072 652d 696e 7465 7270 6f6c 6174  e pre-interpolat
+0004d440: 696f 6e20 636f 6e74 6f75 7220 706f 696e  ion contour poin
+0004d450: 7473 2e0a 2020 2020 2727 270a 0a20 2020  ts..    '''..   
+0004d460: 2023 2045 7874 7261 6374 206c 6973 7420   # Extract list 
+0004d470: 6f66 2063 6f6e 746f 7572 2070 6f69 6e74  of contour point
+0004d480: 7320 6672 6f6d 2073 6f75 7263 652e 0a20  s from source.. 
+0004d490: 2020 2063 6f6e 746f 7572 5f6c 656e 6774     contour_lengt
+0004d4a0: 6820 3d20 4e6f 6e65 0a20 2020 2069 6620  h = None.    if 
+0004d4b0: 6973 696e 7374 616e 6365 2873 6f75 7263  isinstance(sourc
+0004d4c0: 652c 2067 656f 6d65 7472 792e 706f 6c79  e, geometry.poly
+0004d4d0: 676f 6e2e 506f 6c79 676f 6e29 3a0a 2020  gon.Polygon):.  
+0004d4e0: 2020 2020 2020 706f 696e 7473 203d 206c        points = l
+0004d4f0: 6973 7428 706f 6c79 676f 6e5f 746f 5f63  ist(polygon_to_c
+0004d500: 6f6e 746f 7572 2873 6f75 7263 6529 290a  ontour(source)).
+0004d510: 2020 2020 2020 2020 636f 6e74 6f75 725f          contour_
+0004d520: 6c65 6e67 7468 203d 2073 6f75 7263 652e  length = source.
+0004d530: 6c65 6e67 7468 0a20 2020 2065 6c69 6620  length.    elif 
+0004d540: 6973 696e 7374 616e 6365 2873 6f75 7263  isinstance(sourc
+0004d550: 652c 206e 702e 6e64 6172 7261 7929 206f  e, np.ndarray) o
+0004d560: 7220 6973 696e 7374 616e 6365 2873 6f75  r isinstance(sou
+0004d570: 7263 652c 206c 6973 7429 3a0a 2020 2020  rce, list):.    
+0004d580: 2020 2020 706f 696e 7473 203d 206c 6973      points = lis
+0004d590: 7428 736f 7572 6365 290a 2020 2020 656c  t(source).    el
+0004d5a0: 7365 3a0a 2020 2020 2020 2020 706f 696e  se:.        poin
+0004d5b0: 7473 203d 204e 6f6e 650a 0a20 2020 2069  ts = None..    i
+0004d5c0: 6620 706f 696e 7473 2069 7320 4e6f 6e65  f points is None
+0004d5d0: 3a0a 2020 2020 2020 2020 7072 696e 7428  :.        print(
+0004d5e0: 2755 6e72 6563 6f67 6e69 7365 6420 736f  'Unrecognised so
+0004d5f0: 7572 6365 2070 6173 7365 6420 746f 2027  urce passed to '
+0004d600: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0004d610: 2027 5c27 696e 7465 7270 6f6c 6174 655f   '\'interpolate_
+0004d620: 706f 696e 7473 5f73 696e 676c 655f 636f  points_single_co
+0004d630: 6e74 6f75 7228 295c 2727 290a 2020 2020  ntour()\'').    
+0004d640: 2020 2020 7072 696e 7428 2753 6f75 7263      print('Sourc
+0004d650: 6520 6d75 7374 2062 6520 7368 6170 656c  e must be shapel
+0004d660: 7920 506f 6c79 676f 6e20 6f72 2063 6f6e  y Polygon or con
+0004d670: 746f 7572 2729 0a20 2020 2020 2020 2072  tour').        r
+0004d680: 6574 7572 6e20 4e6f 6e65 0a0a 2020 2020  eturn None..    
+0004d690: 2320 4966 206e 756d 6265 7220 6f66 2063  # If number of c
+0004d6a0: 6f6e 746f 7572 2070 6f69 6e74 7320 6e6f  ontour points no
+0004d6b0: 7420 7061 7373 6564 2064 6972 6563 746c  t passed directl
+0004d6c0: 792c 0a20 2020 2023 2074 7279 2074 6f20  y,.    # try to 
+0004d6d0: 6465 7465 726d 696e 6520 6974 7320 7661  determine its va
+0004d6e0: 6c75 6520 6672 6f6d 2074 6865 2064 6973  lue from the dis
+0004d6f0: 7461 6e63 6520 6265 7477 6565 6e20 636f  tance between co
+0004d700: 6e74 6f75 7220 706f 696e 7473 2e0a 2020  ntour points..  
+0004d710: 2020 6966 206e 5f70 6f69 6e74 2069 7320    if n_point is 
+0004d720: 4e6f 6e65 2061 6e64 2064 7879 3a0a 2020  None and dxy:.  
+0004d730: 2020 2020 2020 6966 2063 6f6e 746f 7572        if contour
+0004d740: 5f6c 656e 6774 6820 6973 204e 6f6e 653a  _length is None:
+0004d750: 0a20 2020 2020 2020 2020 2020 2063 6f6e  .            con
+0004d760: 746f 7572 5f6c 656e 6774 6820 3d20 636f  tour_length = co
+0004d770: 6e74 6f75 725f 746f 5f70 6f6c 7967 6f6e  ntour_to_polygon
+0004d780: 2873 6f75 7263 6529 2e6c 656e 6774 680a  (source).length.
+0004d790: 2020 2020 2020 2020 6e5f 706f 696e 7420          n_point 
+0004d7a0: 3d20 6d61 7828 696e 7428 636f 6e74 6f75  = max(int(contou
+0004d7b0: 725f 6c65 6e67 7468 202f 2064 7879 292c  r_length / dxy),
+0004d7c0: 2033 290a 2020 2020 6966 206e 5f70 6f69   3).    if n_poi
+0004d7d0: 6e74 2069 7320 4e6f 6e65 3a0a 2020 2020  nt is None:.    
+0004d7e0: 2020 2020 7072 696e 7428 274e 6f20 696e      print('No in
+0004d7f0: 7465 7270 6f6c 6174 696f 6e20 7065 7266  terpolation perf
+0004d800: 6f72 6d65 6427 290a 2020 2020 2020 2020  ormed').        
+0004d810: 7072 696e 7428 274e 756d 6265 7220 6f66  print('Number of
+0004d820: 2063 6f6e 746f 7572 2070 6f69 6e74 7320   contour points 
+0004d830: 286e 5f70 6f69 6e74 2920 6f72 2064 6973  (n_point) or dis
+0004d840: 7461 6e63 6520 6265 7477 6565 6e20 706f  tance between po
+0004d850: 696e 7473 270a 2020 2020 2020 2020 2020  ints'.          
+0004d860: 2020 2020 2020 276d 7573 7420 6265 2073        'must be s
+0004d870: 7065 6369 6669 6564 2e27 290a 2020 2020  pecified.').    
+0004d880: 2020 2020 7265 7475 726e 204e 6f6e 650a      return None.
+0004d890: 0a20 2020 2023 204d 616b 6520 6c61 7374  .    # Make last
+0004d8a0: 2070 6f69 6e74 2074 6865 2073 616d 6520   point the same 
+0004d8b0: 6173 2074 6865 2066 6972 7374 2c20 746f  as the first, to
+0004d8c0: 2065 6e73 7572 6520 636c 6f73 6564 2063   ensure closed c
+0004d8d0: 7572 7665 2e0a 2020 2020 706f 696e 7473  urve..    points
+0004d8e0: 2e61 7070 656e 6428 706f 696e 7473 5b30  .append(points[0
+0004d8f0: 5d29 0a0a 2020 2020 2320 4469 7363 6172  ])..    # Discar
+0004d900: 6420 706f 696e 7473 2074 6861 7420 6172  d points that ar
+0004d910: 656e 2774 2073 6570 6172 6174 6564 2066  en't separated f
+0004d920: 726f 6d20 7468 6520 7072 6563 6565 6469  rom the preceedi
+0004d930: 6e67 2070 6f69 6e74 0a20 2020 2023 2062  ng point.    # b
+0004d940: 7920 6174 206c 6561 7374 2073 6f6d 6520  y at least some 
+0004d950: 6d69 6e69 6d75 6d20 6469 7374 616e 6365  minimum distance
+0004d960: 2e0a 2020 2020 6478 795f 6d69 6e20 3d20  ..    dxy_min = 
+0004d970: 302e 3030 310a 2020 2020 785f 6c61 7374  0.001.    x_last
+0004d980: 2c20 795f 6c61 7374 203d 2070 6f69 6e74  , y_last = point
+0004d990: 735b 305d 0a20 2020 2078 5f76 616c 7565  s[0].    x_value
+0004d9a0: 732c 2079 5f76 616c 7565 7320 3d20 285b  s, y_values = ([
+0004d9b0: 785f 6c61 7374 5d2c 205b 795f 6c61 7374  x_last], [y_last
+0004d9c0: 5d29 0a20 2020 2066 6f72 2069 2069 6e20  ]).    for i in 
+0004d9d0: 7261 6e67 6528 312c 206c 656e 2870 6f69  range(1, len(poi
+0004d9e0: 6e74 7329 293a 0a20 2020 2020 2020 2078  nts)):.        x
+0004d9f0: 2c20 7920 3d20 706f 696e 7473 5b69 5d0a  , y = points[i].
+0004da00: 2020 2020 2020 2020 6966 2028 6162 7328          if (abs(
+0004da10: 7820 2d20 785f 6c61 7374 2920 3e20 6478  x - x_last) > dx
+0004da20: 795f 6d69 6e29 206f 7220 2861 6273 2879  y_min) or (abs(y
+0004da30: 202d 2079 5f6c 6173 7429 203e 2064 7879   - y_last) > dxy
+0004da40: 5f6d 696e 293a 0a20 2020 2020 2020 2020  _min):.         
+0004da50: 2020 2078 5f76 616c 7565 732e 6170 7065     x_values.appe
+0004da60: 6e64 2870 6f69 6e74 735b 695d 5b30 5d29  nd(points[i][0])
+0004da70: 0a20 2020 2020 2020 2020 2020 2079 5f76  .            y_v
+0004da80: 616c 7565 732e 6170 7065 6e64 2870 6f69  alues.append(poi
+0004da90: 6e74 735b 695d 5b31 5d29 0a20 2020 2020  nts[i][1]).     
+0004daa0: 2020 2078 5f6c 6173 742c 2079 5f6c 6173     x_last, y_las
+0004dab0: 7420 3d20 706f 696e 7473 5b69 5d0a 0a20  t = points[i].. 
+0004dac0: 2020 2078 5f76 616c 7565 7320 3d20 6e70     x_values = np
+0004dad0: 2e61 7272 6179 2878 5f76 616c 7565 7329  .array(x_values)
+0004dae0: 0a20 2020 2079 5f76 616c 7565 7320 3d20  .    y_values = 
+0004daf0: 6e70 2e61 7272 6179 2879 5f76 616c 7565  np.array(y_value
+0004db00: 7329 0a0a 2020 2020 2320 496e 7465 7270  s)..    # Interp
+0004db10: 6f6c 6174 6520 636f 6e74 6f75 7220 706f  olate contour po
+0004db20: 696e 7473 2e0a 2020 2020 736d 6f6f 7468  ints..    smooth
+0004db30: 6e65 7373 203d 2073 6d6f 6f74 686e 6573  ness = smoothnes
+0004db40: 735f 7065 725f 706f 696e 7420 2a20 6c65  s_per_point * le
+0004db50: 6e28 785f 7661 6c75 6573 290a 2020 2020  n(x_values).    
+0004db60: 7472 793a 0a23 2020 2020 2020 2020 7769  try:.#        wi
+0004db70: 7468 2077 6172 6e69 6e67 732e 6361 7463  th warnings.catc
+0004db80: 685f 7761 726e 696e 6773 2829 3a0a 2320  h_warnings():.# 
+0004db90: 2020 2020 2020 2020 2020 2077 6172 6e69             warni
+0004dba0: 6e67 732e 6669 6c74 6572 7761 726e 696e  ngs.filterwarnin
+0004dbb0: 6773 2822 6967 6e6f 7265 222c 206d 6573  gs("ignore", mes
+0004dbc0: 7361 6765 3d22 5365 7474 696e 6720 7822  sage="Setting x"
+0004dbd0: 290a 2020 2020 2020 2020 2020 2020 7463  ).            tc
+0004dbe0: 6b2c 2075 203d 2069 6e74 6572 706f 6c61  k, u = interpola
+0004dbf0: 7465 2e73 706c 7072 6570 280a 2020 2020  te.splprep(.    
+0004dc00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004dc10: 5b78 5f76 616c 7565 732c 2079 5f76 616c  [x_values, y_val
+0004dc20: 7565 735d 2c20 733d 736d 6f6f 7468 6e65  ues], s=smoothne
+0004dc30: 7373 2c20 7065 723d 5472 7565 290a 2020  ss, per=True).  
+0004dc40: 2020 6578 6365 7074 2054 7970 6545 7272    except TypeErr
+0004dc50: 6f72 2061 7320 7072 6f62 6c65 6d3a 0a20  or as problem:. 
+0004dc60: 2020 2020 2020 2070 7269 6e74 2822 5741         print("WA
+0004dc70: 524e 494e 473a 2050 726f 626c 656d 2069  RNING: Problem i
+0004dc80: 6e20 696e 7465 7270 6f6c 6174 655f 636f  n interpolate_co
+0004dc90: 6e74 6f75 725f 706f 696e 7473 2829 3a22  ntour_points():"
+0004dca0: 2c20 7072 6f62 6c65 6d29 0a20 2020 2020  , problem).     
+0004dcb0: 2020 2072 6574 7572 6e20 4e6f 6e65 0a0a     return None..
+0004dcc0: 2020 2020 7869 5f76 616c 7565 732c 2079      xi_values, y
+0004dcd0: 695f 7661 6c75 6573 203d 2069 6e74 6572  i_values = inter
+0004dce0: 706f 6c61 7465 2e73 706c 6576 280a 2020  polate.splev(.  
+0004dcf0: 2020 2020 2020 6e70 2e6c 696e 7370 6163        np.linspac
+0004dd00: 6528 302e 2c20 312e 2c20 6e5f 706f 696e  e(0., 1., n_poin
+0004dd10: 7420 2b20 3129 2c20 7463 6b29 0a0a 2020  t + 1), tck)..  
+0004dd20: 2020 2320 5374 6f72 6520 706f 696e 7473    # Store points
+0004dd30: 2069 6e20 6120 666f 726d 2074 6861 7420   in a form that 
+0004dd40: 6d61 7920 6265 2063 6f6e 7665 7274 6564  may be converted
+0004dd50: 2074 6f20 6120 6e75 6d70 7920 6172 7261   to a numpy arra
+0004dd60: 792e 0a20 2020 2070 6f69 6e74 735f 696e  y..    points_in
+0004dd70: 7465 7270 6f6c 6174 6564 203d 206c 6973  terpolated = lis
+0004dd80: 7428 7a69 7028 7869 5f76 616c 7565 732c  t(zip(xi_values,
+0004dd90: 2079 695f 7661 6c75 6573 2929 0a20 2020   yi_values)).   
+0004dda0: 2070 6f69 6e74 735f 696e 7465 7270 6f6c   points_interpol
+0004ddb0: 6174 6564 203d 205b 7879 2066 6f72 2078  ated = [xy for x
+0004ddc0: 7920 696e 2070 6f69 6e74 735f 696e 7465  y in points_inte
+0004ddd0: 7270 6f6c 6174 6564 5d0a 0a20 2020 2023  rpolated]..    #
+0004dde0: 2052 6574 7572 6e20 696e 7465 7270 6f6c   Return interpol
+0004ddf0: 6174 6564 2063 6f6e 746f 7572 2069 6e20  ated contour in 
+0004de00: 7468 6520 7361 6d65 2072 6570 7265 7365  the same represe
+0004de10: 6e74 6174 696f 6e20 6173 2074 6865 2073  ntation as the s
+0004de20: 6f75 7263 652e 0a20 2020 2069 6620 6973  ource..    if is
+0004de30: 696e 7374 616e 6365 2873 6f75 7263 652c  instance(source,
+0004de40: 2067 656f 6d65 7472 792e 706f 6c79 676f   geometry.polygo
+0004de50: 6e2e 506f 6c79 676f 6e29 3a0a 2020 2020  n.Polygon):.    
+0004de60: 2020 2020 6f75 745f 6f62 6a65 6374 203d      out_object =
+0004de70: 2067 656f 6d65 7472 792e 706f 6c79 676f   geometry.polygo
+0004de80: 6e2e 506f 6c79 676f 6e28 706f 696e 7473  n.Polygon(points
+0004de90: 5f69 6e74 6572 706f 6c61 7465 6429 0a20  _interpolated). 
+0004dea0: 2020 2065 6c69 6620 6973 696e 7374 616e     elif isinstan
+0004deb0: 6365 2873 6f75 7263 652c 206e 702e 6e64  ce(source, np.nd
+0004dec0: 6172 7261 7929 3a0a 2020 2020 2020 2020  array):.        
+0004ded0: 6f75 745f 6f62 6a65 6374 203d 206e 702e  out_object = np.
+0004dee0: 6172 7261 7928 706f 696e 7473 5f69 6e74  array(points_int
+0004def0: 6572 706f 6c61 7465 6429 0a20 2020 2065  erpolated).    e
+0004df00: 6c73 653a 0a20 2020 2020 2020 206f 7574  lse:.        out
+0004df10: 5f6f 626a 6563 7420 3d20 706f 696e 7473  _object = points
+0004df20: 5f69 6e74 6572 706f 6c61 7465 640a 0a20  _interpolated.. 
+0004df30: 2020 2072 6574 7572 6e20 6f75 745f 6f62     return out_ob
+0004df40: 6a65 6374 0a0a 6465 6620 7772 6974 655f  ject..def write_
+0004df50: 7374 7275 6374 7572 655f 7365 745f 6469  structure_set_di
+0004df60: 636f 6d28 0a20 2020 206f 7574 6e61 6d65  com(.    outname
+0004df70: 2c20 0a20 2020 2072 6f69 732c 200a 2020  , .    rois, .  
+0004df80: 2020 696d 6167 653d 4e6f 6e65 2c20 0a20    image=None, . 
+0004df90: 2020 2061 6666 696e 653d 4e6f 6e65 2c20     affine=None, 
+0004dfa0: 0a20 2020 2073 6861 7065 3d4e 6f6e 652c  .    shape=None,
+0004dfb0: 0a20 2020 206f 7269 656e 7461 7469 6f6e  .    orientation
+0004dfc0: 3d4e 6f6e 652c 200a 2020 2020 6865 6164  =None, .    head
+0004dfd0: 6572 5f73 6f75 7263 653d 4e6f 6e65 2c20  er_source=None, 
+0004dfe0: 0a20 2020 2070 6174 6965 6e74 5f69 643d  .    patient_id=
+0004dff0: 4e6f 6e65 2c0a 2020 2020 6d6f 6461 6c69  None,.    modali
+0004e000: 7479 3d4e 6f6e 652c 200a 2020 2020 726f  ty=None, .    ro
+0004e010: 6f74 5f75 6964 3d4e 6f6e 650a 293a 0a0a  ot_uid=None.):..
+0004e020: 2020 2020 2320 4368 6563 6b20 7765 2068      # Check we h
+0004e030: 6176 6520 7468 6520 7265 6c65 7661 6e74  ave the relevant
+0004e040: 2069 6e66 6f0a 2020 2020 6966 206e 6f74   info.    if not
+0004e050: 2069 6d61 6765 2061 6e64 2028 6e6f 7420   image and (not 
+0004e060: 6166 6669 6e65 206f 7220 6e6f 7420 7368  affine or not sh
+0004e070: 6170 6529 3a0a 2020 2020 2020 2020 7261  ape):.        ra
+0004e080: 6973 6520 5275 6e74 696d 6545 7272 6f72  ise RuntimeError
+0004e090: 2822 4d75 7374 2070 726f 7669 6465 2065  ("Must provide e
+0004e0a0: 6974 6865 7220 616e 2069 6d61 6765 206f  ither an image o
+0004e0b0: 7220 616e 2061 6666 696e 6520 6d61 7472  r an affine matr
+0004e0c0: 6978 2022 0a20 2020 2020 2020 2020 2020  ix ".           
+0004e0d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004e0e0: 2261 6e64 2073 6861 7065 2122 290a 0a20  "and shape!").. 
+0004e0f0: 2020 2023 2054 7279 2067 6574 7469 6e67     # Try getting
+0004e100: 2064 6963 6f6d 2064 6174 6173 6574 2066   dicom dataset f
+0004e110: 726f 6d20 696d 6167 650a 2020 2020 6473  rom image.    ds
+0004e120: 203d 204e 6f6e 650a 2020 2020 6966 2069   = None.    if i
+0004e130: 6d61 6765 3a0a 2020 2020 2020 2020 6966  mage:.        if
+0004e140: 2068 6173 6174 7472 2869 6d61 6765 2c20   hasattr(image, 
+0004e150: 2264 6963 6f6d 5f64 6174 6173 6574 2229  "dicom_dataset")
+0004e160: 3a0a 2020 2020 2020 2020 2020 2020 6473  :.            ds
+0004e170: 203d 2069 6d61 6765 2e64 6963 6f6d 5f64   = image.dicom_d
+0004e180: 6174 6173 6574 0a20 2020 2020 2020 2065  ataset.        e
+0004e190: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+0004e1a0: 2064 7320 3d20 736b 7274 2e69 6d61 6765   ds = skrt.image
+0004e1b0: 2e63 7265 6174 655f 6469 636f 6d28 290a  .create_dicom().
+0004e1c0: 2020 2020 2020 2020 2020 2020 6473 2e73              ds.s
+0004e1d0: 6574 5f67 656f 6d65 7472 7928 0a20 2020  et_geometry(.   
+0004e1e0: 2020 2020 2020 2020 2020 2020 2069 6d61               ima
+0004e1f0: 6765 2e67 6574 5f61 6666 696e 6528 292c  ge.get_affine(),
+0004e200: 2069 6d61 6765 2e67 6574 5f64 6174 6128   image.get_data(
+0004e210: 292e 7368 6170 652c 0a20 2020 2020 2020  ).shape,.       
+0004e220: 2020 2020 2020 2020 2069 6d61 6765 2e67           image.g
+0004e230: 6574 5f6f 7269 656e 7461 7469 6f6e 5f76  et_orientation_v
+0004e240: 6563 746f 7228 696d 6167 652e 6765 745f  ector(image.get_
+0004e250: 6166 6669 6e65 2c20 2264 6963 6f6d 2229  affine, "dicom")
+0004e260: 0a20 2020 2020 2020 2020 2020 2029 0a0a  .            )..
+0004e270: 2020 2020 2320 4f74 6865 7277 6973 652c      # Otherwise,
+0004e280: 2063 7265 6174 6520 6672 6573 6820 6469   create fresh di
+0004e290: 636f 6d20 6461 7461 7365 740a 2020 2020  com dataset.    
+0004e2a0: 656c 7365 3a0a 2020 2020 2020 2020 6473  else:.        ds
+0004e2b0: 203d 2073 6b72 742e 696d 6167 652e 6372   = skrt.image.cr
+0004e2c0: 6561 7465 5f64 6963 6f6d 2870 6174 6965  eate_dicom(patie
+0004e2d0: 6e74 5f69 642c 206d 6f64 616c 6974 792c  nt_id, modality,
+0004e2e0: 2072 6f6f 745f 7569 6429 0a20 2020 2020   root_uid).     
+0004e2f0: 2020 2064 732e 7365 745f 6765 6f6d 6574     ds.set_geomet
+0004e300: 7279 2861 6666 696e 652c 2073 6861 7065  ry(affine, shape
+0004e310: 2c20 6f72 6965 6e74 6174 696f 6e29 0a0a  , orientation)..
+0004e320: 2020 2020 2320 4164 6a75 7374 2064 6174      # Adjust dat
+0004e330: 6173 6574 2074 6f20 6265 2066 6f72 2053  aset to be for S
+0004e340: 7472 7563 7475 7265 5365 7420 696e 7374  tructureSet inst
+0004e350: 6561 6420 6f66 2069 6d61 6765 0a0a 0a64  ead of image...d
+0004e360: 6566 2064 6963 6f6d 5f64 6174 6173 6574  ef dicom_dataset
+0004e370: 5f74 6f5f 7374 7275 6374 7572 655f 7365  _to_structure_se
+0004e380: 7428 6473 293a 0a20 2020 2027 2727 436f  t(ds):.    '''Co
+0004e390: 6e76 6572 7420 616e 2065 7869 7374 696e  nvert an existin
+0004e3a0: 6720 696d 6167 6520 6469 636f 6d20 6461  g image dicom da
+0004e3b0: 7461 7365 7420 746f 2061 2053 7472 7563  taset to a Struc
+0004e3c0: 7475 7265 5365 7420 6461 7461 7365 742e  tureSet dataset.
+0004e3d0: 2727 270a 0a20 2020 2023 2041 646a 7573  '''..    # Adjus
+0004e3e0: 7420 636c 6173 7320 5549 4473 0a20 2020  t class UIDs.   
+0004e3f0: 2064 732e 6669 6c65 5f6d 6574 612e 496d   ds.file_meta.Im
+0004e400: 706c 656d 656e 7461 7469 6f6e 436c 6173  plementationClas
+0004e410: 7355 4944 203d 2022 392e 392e 392e 3130  sUID = "9.9.9.10
+0004e420: 302e 302e 302e 312e 302e 392e 362e 302e  0.0.0.1.0.9.6.0.
+0004e430: 302e 3122 0a20 2020 2064 732e 6669 6c65  0.1".    ds.file
+0004e440: 5f6d 6574 612e 4d65 6469 6153 746f 7261  _meta.MediaStora
+0004e450: 6765 534f 5043 6c61 7373 5549 4420 3d20  geSOPClassUID = 
+0004e460: 2231 2e32 2e38 3430 2e31 3030 3038 2e35  "1.2.840.10008.5
+0004e470: 2e31 2e34 2e31 2e31 2e34 3831 2e33 220a  .1.4.1.1.481.3".
+0004e480: 0a20 2020 2023 2041 7373 6967 6e20 656d  .    # Assign em
+0004e490: 7074 7920 7365 7175 656e 6365 730a 2020  pty sequences.  
+0004e4a0: 2020 6473 2e52 6566 6572 656e 6365 6446    ds.ReferencedF
+0004e4b0: 7261 6d65 6f66 5265 6665 7265 6e63 6553  rameofReferenceS
+0004e4c0: 6571 7565 6e63 6520 3d20 5365 7175 656e  equence = Sequen
+0004e4d0: 6365 2829 0a20 2020 2064 732e 5374 7275  ce().    ds.Stru
+0004e4e0: 6374 7572 6553 6574 524f 4953 6571 7565  ctureSetROISeque
+0004e4f0: 6e63 6520 3d20 5365 7175 656e 6365 2829  nce = Sequence()
+0004e500: 0a20 2020 2064 732e 5254 524f 494f 6273  .    ds.RTROIObs
+0004e510: 6572 7661 7469 6f6e 7353 6571 7565 6e63  ervationsSequenc
+0004e520: 6520 3d20 5365 7175 656e 6365 2829 0a20  e = Sequence(). 
+0004e530: 2020 2064 732e 524f 4943 6f6e 746f 7572     ds.ROIContour
+0004e540: 5365 7175 656e 6365 203d 2053 6571 7565  Sequence = Seque
+0004e550: 6e63 6528 290a 0a20 2020 2023 2041 7373  nce()..    # Ass
+0004e560: 6967 6e20 7374 7275 6374 7572 6520 7365  ign structure se
+0004e570: 7420 7072 6f70 6572 7469 6573 0a20 2020  t properties.   
+0004e580: 2064 732e 5374 7275 6374 7572 6553 6574   ds.StructureSet
+0004e590: 4c61 6265 6c20 3d20 2222 0a20 2020 2064  Label = "".    d
+0004e5a0: 732e 5374 7275 6374 7572 6553 6574 4461  s.StructureSetDa
+0004e5b0: 7465 203d 2064 732e 496e 7374 616e 6365  te = ds.Instance
+0004e5c0: 4372 6561 7469 6f6e 4461 7465 0a20 2020  CreationDate.   
+0004e5d0: 2064 732e 5374 7275 6374 7572 6553 6574   ds.StructureSet
+0004e5e0: 5469 6d65 203d 2064 732e 496e 7374 616e  Time = ds.Instan
+0004e5f0: 6365 4372 6561 7469 6f6e 5469 6d65 0a0a  ceCreationTime..
+0004e600: 2020 2020 2320 4173 7369 676e 2066 7261      # Assign fra
+0004e610: 6d65 206f 6620 7265 6665 7265 6e63 650a  me of reference.
+0004e620: 0a0a 6465 6620 6372 6561 7465 5f64 756d  ..def create_dum
+0004e630: 6d79 5f69 6d61 6765 280a 2020 2020 6578  my_image(.    ex
+0004e640: 7465 6e74 732c 200a 2020 2020 736c 6963  tents, .    slic
+0004e650: 655f 7468 6963 6b6e 6573 732c 0a20 2020  e_thickness,.   
+0004e660: 2073 6861 7065 3d4e 6f6e 652c 200a 2020   shape=None, .  
+0004e670: 2020 766f 7865 6c5f 7369 7a65 3d4e 6f6e    voxel_size=Non
+0004e680: 652c 0a20 2020 2066 696c 6c5f 7661 6c3d  e,.    fill_val=
+0004e690: 3165 342c 0a20 2020 2062 7566 6665 723d  1e4,.    buffer=
+0004e6a0: 320a 293a 0a20 2020 2022 2222 4d61 6b65  2.):.    """Make
+0004e6b0: 2061 2064 756d 6d79 2069 6d61 6765 2074   a dummy image t
+0004e6c0: 6861 7420 636f 7665 7273 2074 6865 2061  hat covers the a
+0004e6d0: 7265 6120 7370 616e 6e65 6420 6279 203c  rea spanned by <
+0004e6e0: 6578 7465 6e74 733e 2070 6c75 7320 6120  extents> plus a 
+0004e6f0: 0a20 2020 2062 7566 6665 722e 0a0a 2020  .    buffer...  
+0004e700: 2020 2a2a 5061 7261 6d65 7465 7273 3a2a    **Parameters:*
+0004e710: 2a0a 2020 2020 0a20 2020 2065 7874 656e  *.    .    exten
+0004e720: 7473 203a 206c 6973 740a 2020 2020 2020  ts : list.      
+0004e730: 2020 4c69 7374 206f 6620 5b6d 696e 2c20    List of [min, 
+0004e740: 6d61 785d 2065 7874 656e 7473 2069 6e20  max] extents in 
+0004e750: 6d6d 2061 6c6f 6e67 2065 6163 6820 6f66  mm along each of
+0004e760: 2074 6865 2074 6872 6565 2061 7865 7320   the three axes 
+0004e770: 696e 200a 2020 2020 2020 2020 6f72 6465  in .        orde
+0004e780: 7220 5b78 2c20 792c 207a 5d2e 0a0a 2020  r [x, y, z]...  
+0004e790: 2020 736c 6963 655f 7468 6963 6b6e 6573    slice_thicknes
+0004e7a0: 7320 3a20 666c 6f61 740a 2020 2020 2020  s : float.      
+0004e7b0: 2020 536c 6963 6520 7468 6963 6b6e 6573    Slice thicknes
+0004e7c0: 7320 696e 206d 6d2e 0a0a 2020 2020 766f  s in mm...    vo
+0004e7d0: 7865 6c5f 7369 7a65 203a 206c 6973 742c  xel_size : list,
+0004e7e0: 2064 6566 6175 6c74 3d4e 6f6e 650a 2020   default=None.  
+0004e7f0: 2020 2020 2020 566f 7865 6c20 7369 7a65        Voxel size
+0004e800: 2069 6e20 6d6d 2069 6e20 7468 6520 6475   in mm in the du
+0004e810: 6d6d 7920 696d 6167 6520 696e 2074 6865  mmy image in the
+0004e820: 2078 2d79 2070 6c61 6e65 2c20 6769 7665   x-y plane, give
+0004e830: 6e20 6173 200a 2020 2020 2020 2020 5b76  n as .        [v
+0004e840: 782c 2076 795d 2e20 4966 203c 7368 6170  x, vy]. If <shap
+0004e850: 653e 2061 6e64 203c 766f 7865 6c5f 7369  e> and <voxel_si
+0004e860: 7a65 3e20 6172 6520 626f 7468 204e 6f6e  ze> are both Non
+0004e870: 652c 2076 6f78 656c 2073 697a 6573 206f  e, voxel sizes o
+0004e880: 660a 2020 2020 2020 2020 5b31 2c20 315d  f.        [1, 1]
+0004e890: 2077 696c 6c20 6265 2075 7365 6420 6279   will be used by
+0004e8a0: 2064 6566 6175 6c74 2e20 5468 6520 766f   default. The vo
+0004e8b0: 7865 6c20 7369 7a65 2069 6e20 7468 6520  xel size in the 
+0004e8c0: 7a20 6469 7265 6374 696f 6e20 0a20 2020  z direction .   
+0004e8d0: 2020 2020 2077 696c 6c20 6265 2074 616b       will be tak
+0004e8e0: 656e 2066 726f 6d20 7468 6520 6d69 6e69  en from the mini
+0004e8f0: 6d75 6d20 6469 7374 616e 6365 2062 6574  mum distance bet
+0004e900: 7765 656e 2073 6c69 6365 2070 6f73 6974  ween slice posit
+0004e910: 696f 6e73 2069 6e20 0a20 2020 2020 2020  ions in .       
+0004e920: 2074 6865 2078 2d79 2063 6f6e 746f 7572   the x-y contour
+0004e930: 7320 6469 6374 696f 6e61 7279 2e0a 0a20  s dictionary... 
+0004e940: 2020 2073 6861 7065 203a 206c 6973 742c     shape : list,
+0004e950: 2064 6566 6175 6c74 3d4e 6f6e 650a 2020   default=None.  
+0004e960: 2020 2020 2020 4e75 6d62 6572 206f 6620        Number of 
+0004e970: 766f 7865 6c73 2069 6e20 7468 6520 6475  voxels in the du
+0004e980: 6d6d 7920 696d 6167 6520 696e 2074 6865  mmy image in the
+0004e990: 2078 2d79 2070 6c61 6e65 2c20 6769 7665   x-y plane, give
+0004e9a0: 6e20 6173 0a20 2020 2020 2020 205b 6e78  n as.        [nx
+0004e9b0: 2c20 6e79 5d2e 204f 6e6c 7920 7573 6564  , ny]. Only used
+0004e9c0: 2069 6620 3c76 6f78 656c 5f73 697a 653e   if <voxel_size>
+0004e9d0: 2069 7320 4e6f 6e65 2e20 0a20 2020 2020   is None. .     
+0004e9e0: 2020 2054 6865 206e 756d 6265 7220 6f66     The number of
+0004e9f0: 2076 6f78 656c 7320 696e 2074 6865 207a   voxels in the z
+0004ea00: 2064 6972 6563 7469 6f6e 2077 696c 6c20   direction will 
+0004ea10: 6265 2074 616b 656e 2066 726f 6d20 7468  be taken from th
+0004ea20: 6520 0a20 2020 2020 2020 206e 756d 6265  e .        numbe
+0004ea30: 7220 6f66 2073 6c69 6365 7320 696e 2074  r of slices in t
+0004ea40: 6865 2078 2d79 2063 6f6e 746f 7572 7320  he x-y contours 
+0004ea50: 6469 6374 696f 6e61 7279 2e0a 0a20 2020  dictionary...   
+0004ea60: 2066 696c 6c5f 7661 6c20 3a20 696e 742f   fill_val : int/
+0004ea70: 666c 6f61 742c 2064 6566 6175 6c74 3d31  float, default=1
+0004ea80: 6534 0a20 2020 2020 2020 2056 616c 7565  e4.        Value
+0004ea90: 2077 6974 6820 7768 6963 6820 7468 6520   with which the 
+0004eaa0: 766f 7865 6c73 2069 6e20 7468 6520 6475  voxels in the du
+0004eab0: 6d6d 7920 696d 6167 6520 7368 6f75 6c64  mmy image should
+0004eac0: 2062 6520 6669 6c6c 6564 2e20 0a0a 2020   be filled. ..  
+0004ead0: 2020 6275 6666 6572 203a 2066 6c6f 6174    buffer : float
+0004eae0: 2c20 6465 6661 756c 743d 320a 2020 2020  , default=2.    
+0004eaf0: 2020 2020 4275 6666 6572 2061 6d6f 756e      Buffer amoun
+0004eb00: 7420 6f66 2077 6869 7465 7370 6163 6520  t of whitespace 
+0004eb10: 696e 206d 6d20 746f 2061 6464 206f 7574  in mm to add out
+0004eb20: 7369 6465 2074 6865 2052 4f49 2069 6e20  side the ROI in 
+0004eb30: 6561 6368 200a 2020 2020 2020 2020 6469  each .        di
+0004eb40: 7265 6374 696f 6e2e 0a20 2020 2022 2222  rection..    """
+0004eb50: 0a0a 2020 2020 2320 4173 7369 676e 2064  ..    # Assign d
+0004eb60: 6566 6175 6c74 2076 6f78 656c 2073 697a  efault voxel siz
+0004eb70: 650a 2020 2020 6966 2073 6861 7065 2069  e.    if shape i
+0004eb80: 7320 4e6f 6e65 2061 6e64 2076 6f78 656c  s None and voxel
+0004eb90: 5f73 697a 6520 6973 204e 6f6e 653a 0a20  _size is None:. 
+0004eba0: 2020 2020 2020 2076 6f78 656c 5f73 697a         voxel_siz
+0004ebb0: 6520 3d20 5b31 2c20 315d 0a20 2020 2069  e = [1, 1].    i
+0004ebc0: 6620 6e6f 7420 736b 7274 2e63 6f72 652e  f not skrt.core.
+0004ebd0: 6973 5f6c 6973 7428 766f 7865 6c5f 7369  is_list(voxel_si
+0004ebe0: 7a65 293a 0a20 2020 2020 2020 2076 6f78  ze):.        vox
+0004ebf0: 656c 5f73 697a 6520 3d20 5b76 6f78 656c  el_size = [voxel
+0004ec00: 5f73 697a 655d 202a 2032 0a0a 2020 2020  _size] * 2..    
+0004ec10: 2320 4361 6c63 756c 6174 6520 766f 7865  # Calculate voxe
+0004ec20: 6c20 7369 7a65 7320 6672 6f6d 2073 6861  l sizes from sha
+0004ec30: 7065 0a20 2020 2069 6620 7368 6170 6520  pe.    if shape 
+0004ec40: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
+0004ec50: 2020 2020 2073 6861 7065 203d 206c 6973       shape = lis
+0004ec60: 7428 7368 6170 6529 0a20 2020 2020 2020  t(shape).       
+0004ec70: 2069 6620 6c65 6e28 7368 6170 6529 2021   if len(shape) !
+0004ec80: 3d20 323a 0a20 2020 2020 2020 2020 2020  = 2:.           
+0004ec90: 2072 6169 7365 2054 7970 6545 7272 6f72   raise TypeError
+0004eca0: 2822 5368 6170 6520 7368 6f75 6c64 2062  ("Shape should b
+0004ecb0: 6520 6120 6c69 7374 206f 6620 7477 6f20  e a list of two 
+0004ecc0: 7661 6c75 6573 2022 0a20 2020 2020 2020  values ".       
+0004ecd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004ece0: 2020 2020 2022 7370 6563 6966 7969 6e67       "specifying
+0004ecf0: 2064 756d 6d79 2069 6d61 6765 2073 6861   dummy image sha
+0004ed00: 7065 2069 6e20 7468 6520 5b78 2c20 795d  pe in the [x, y]
+0004ed10: 2022 0a20 2020 2020 2020 2020 2020 2020   ".             
+0004ed20: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+0004ed30: 6469 7265 6374 696f 6e73 2e22 290a 0a20  directions.").. 
+0004ed40: 2020 2020 2020 2023 2043 616c 6375 6c61         # Calcula
+0004ed50: 7465 2076 6f78 656c 2073 697a 6520 6966  te voxel size if
+0004ed60: 2052 4f49 2065 7874 656e 7420 706c 7573   ROI extent plus
+0004ed70: 2062 7566 6665 7220 6973 2064 6976 6964   buffer is divid
+0004ed80: 6564 2062 7920 7368 6170 650a 2020 2020  ed by shape.    
+0004ed90: 2020 2020 766f 7865 6c5f 7369 7a65 203d      voxel_size =
+0004eda0: 205b 286d 6178 2865 7829 202d 206d 696e   [(max(ex) - min
+0004edb0: 2865 7829 202b 2032 202a 2062 7566 6665  (ex) + 2 * buffe
+0004edc0: 7229 202f 2073 6861 7065 5b69 5d0a 2020  r) / shape[i].  
+0004edd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004ede0: 2020 2020 666f 7220 692c 2065 7820 696e      for i, ex in
+0004edf0: 2065 6e75 6d65 7261 7465 2865 7874 656e   enumerate(exten
+0004ee00: 7473 5b3a 325d 295d 0a0a 2020 2020 2320  ts[:2])]..    # 
+0004ee10: 4f74 6865 7277 6973 652c 2063 616c 6375  Otherwise, calcu
+0004ee20: 6c61 7465 2073 6861 7065 2066 726f 6d20  late shape from 
+0004ee30: 766f 7865 6c20 7369 7a65 730a 2020 2020  voxel sizes.    
+0004ee40: 656c 7365 3a0a 2020 2020 2020 2020 766f  else:.        vo
+0004ee50: 7865 6c5f 7369 7a65 203d 206c 6973 7428  xel_size = list(
+0004ee60: 766f 7865 6c5f 7369 7a65 290a 2020 2020  voxel_size).    
+0004ee70: 2020 2020 0a20 2020 2020 2020 2023 2043      .        # C
+0004ee80: 616c 6375 6c61 7465 206e 756d 6265 7220  alculate number 
+0004ee90: 6f66 2076 6f78 656c 7320 6e65 6564 6564  of voxels needed
+0004eea0: 2074 6f20 636f 7665 7220 524f 4920 706c   to cover ROI pl
+0004eeb0: 7573 2062 7566 6665 7220 6561 6368 2073  us buffer each s
+0004eec0: 6964 650a 2020 2020 2020 2020 7368 6170  ide.        shap
+0004eed0: 6520 3d20 5b28 6e70 2e63 6569 6c28 286d  e = [(np.ceil((m
+0004eee0: 6178 2865 7829 202d 206d 696e 2865 7829  ax(ex) - min(ex)
+0004eef0: 2920 2b20 3220 2a20 6275 6666 6572 2920  ) + 2 * buffer) 
+0004ef00: 2f20 766f 7865 6c5f 7369 7a65 5b69 5d29  / voxel_size[i])
+0004ef10: 200a 2020 2020 2020 2020 2020 2020 2020   .              
+0004ef20: 2020 2066 6f72 2069 2c20 6578 2069 6e20     for i, ex in 
+0004ef30: 656e 756d 6572 6174 6528 6578 7465 6e74  enumerate(extent
+0004ef40: 735b 3a32 5d29 5d0a 0a20 2020 2023 2047  s[:2])]..    # G
+0004ef50: 6574 207a 2076 6f78 656c 2073 697a 6520  et z voxel size 
+0004ef60: 616e 6420 7368 6170 650a 2020 2020 766f  and shape.    vo
+0004ef70: 7865 6c5f 7369 7a65 2e61 7070 656e 6428  xel_size.append(
+0004ef80: 736c 6963 655f 7468 6963 6b6e 6573 7329  slice_thickness)
+0004ef90: 0a20 2020 2073 6861 7065 5f7a 203d 2028  .    shape_z = (
+0004efa0: 6d61 7828 6578 7465 6e74 735b 325d 2920  max(extents[2]) 
+0004efb0: 2d20 6d69 6e28 6578 7465 6e74 735b 325d  - min(extents[2]
+0004efc0: 2929 202f 2073 6c69 6365 5f74 6869 636b  )) / slice_thick
+0004efd0: 6e65 7373 0a0a 2020 2020 2320 4164 6420  ness..    # Add 
+0004efe0: 6e65 6172 6573 7420 696e 7465 6765 7220  nearest integer 
+0004eff0: 6e75 6d62 6572 206f 6620 6275 6666 6572  number of buffer
+0004f000: 2076 6f78 656c 730a 2020 2020 6e5f 6275   voxels.    n_bu
+0004f010: 6666 5f7a 203d 206e 702e 6365 696c 2862  ff_z = np.ceil(b
+0004f020: 7566 6665 7220 2f20 736c 6963 655f 7468  uffer / slice_th
+0004f030: 6963 6b6e 6573 7329 0a20 2020 2073 6861  ickness).    sha
+0004f040: 7065 2e61 7070 656e 6428 7368 6170 655f  pe.append(shape_
+0004f050: 7a20 2b20 3220 2a20 6e5f 6275 6666 5f7a  z + 2 * n_buff_z
+0004f060: 290a 2020 2020 7368 6170 6520 3d20 5b69  ).    shape = [i
+0004f070: 6e74 2873 2920 666f 7220 7320 696e 2073  nt(s) for s in s
+0004f080: 6861 7065 5d0a 0a20 2020 2023 2047 6574  hape]..    # Get
+0004f090: 206f 7269 6769 6e20 706f 7369 7469 6f6e   origin position
+0004f0a0: 3b20 656e 7375 7265 2074 6861 7420 6f72  ; ensure that or
+0004f0b0: 6967 696e 2070 6f69 6e74 7320 746f 2063  igin points to c
+0004f0c0: 656e 7472 6520 6f66 2062 7566 6665 7220  entre of buffer 
+0004f0d0: 766f 7865 6c20 0a20 2020 2023 206f 7574  voxel .    # out
+0004f0e0: 7369 6465 2052 4f49 0a20 2020 206f 7269  side ROI.    ori
+0004f0f0: 6769 6e20 3d20 5b6d 696e 2865 7829 202b  gin = [min(ex) +
+0004f100: 2061 6273 2876 6f78 656c 5f73 697a 655b   abs(voxel_size[
+0004f110: 695d 2920 2a20 302e 3520 2d20 6275 6666  i]) * 0.5 - buff
+0004f120: 6572 0a20 2020 2020 2020 2020 2020 2020  er.             
+0004f130: 2066 6f72 2069 2c20 6578 2069 6e20 656e   for i, ex in en
+0004f140: 756d 6572 6174 6528 6578 7465 6e74 735b  umerate(extents[
+0004f150: 3a32 5d29 5d0a 2020 2020 6f72 6967 696e  :2])].    origin
+0004f160: 2e61 7070 656e 6428 6d69 6e28 6578 7465  .append(min(exte
+0004f170: 6e74 735b 325d 2920 2d20 6162 7328 736c  nts[2]) - abs(sl
+0004f180: 6963 655f 7468 6963 6b6e 6573 7329 202a  ice_thickness) *
+0004f190: 2028 6e5f 6275 6666 5f7a 202d 2030 2e35   (n_buff_z - 0.5
+0004f1a0: 2929 0a0a 2020 2020 2320 4372 6561 7465  ))..    # Create
+0004f1b0: 2069 6d61 6765 0a20 2020 2072 6574 7572   image.    retur
+0004f1c0: 6e20 736b 7274 2e69 6d61 6765 2e49 6d61  n skrt.image.Ima
+0004f1d0: 6765 280a 2020 2020 2020 2020 6e70 2e6f  ge(.        np.o
+0004f1e0: 6e65 7328 2873 6861 7065 5b31 5d2c 2073  nes((shape[1], s
+0004f1f0: 6861 7065 5b30 5d2c 2073 6861 7065 5b32  hape[0], shape[2
+0004f200: 5d29 2920 2a20 6669 6c6c 5f76 616c 2c0a  ])) * fill_val,.
+0004f210: 2020 2020 2020 2020 766f 7865 6c5f 7369          voxel_si
+0004f220: 7a65 3d76 6f78 656c 5f73 697a 652c 0a20  ze=voxel_size,. 
+0004f230: 2020 2020 2020 206f 7269 6769 6e3d 6f72         origin=or
+0004f240: 6967 696e 0a20 2020 2029 0a0a 0a64 6566  igin.    )...def
+0004f250: 2063 7265 6174 655f 7374 6170 6c65 2872   create_staple(r
+0004f260: 6f69 732c 202a 2a6b 7761 7267 7329 3a0a  ois, **kwargs):.
+0004f270: 2020 2020 2222 2243 7265 6174 6520 5354      """Create ST
+0004f280: 4150 4c45 2052 4f49 2066 726f 6d20 6c69  APLE ROI from li
+0004f290: 7374 206f 6620 524f 4973 2e22 2222 0a0a  st of ROIs."""..
+0004f2a0: 2020 2020 2320 5472 7920 696d 706f 7274      # Try import
+0004f2b0: 2053 696d 706c 6549 544b 0a20 2020 2074   SimpleITK.    t
+0004f2c0: 7279 3a0a 2020 2020 2020 2020 696d 706f  ry:.        impo
+0004f2d0: 7274 2053 696d 706c 6549 544b 2061 7320  rt SimpleITK as 
+0004f2e0: 7369 746b 0a20 2020 2065 7863 6570 7420  sitk.    except 
+0004f2f0: 4d6f 6475 6c65 4e6f 7446 6f75 6e64 4572  ModuleNotFoundEr
+0004f300: 726f 723a 0a20 2020 2020 2020 2072 6169  ror:.        rai
+0004f310: 7365 204d 6f64 756c 654e 6f74 466f 756e  se ModuleNotFoun
+0004f320: 6445 7272 6f72 2822 5369 6d70 6c65 4954  dError("SimpleIT
+0004f330: 4b20 6973 2072 6571 7569 7265 6420 746f  K is required to
+0004f340: 2063 616c 6375 6c61 7465 2053 5441 504c   calculate STAPL
+0004f350: 4520 636f 6e74 6f75 722e 2022 0a20 2020  E contour. ".   
+0004f360: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004f370: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+0004f380: 5472 7920 696e 7374 616c 6c69 6e67 2076  Try installing v
+0004f390: 6961 3a20 7069 7020 696e 7374 616c 6c20  ia: pip install 
+0004f3a0: 7369 6d70 6c65 6974 6b22 290a 0a20 2020  simpleitk")..   
+0004f3b0: 2023 2047 6574 2053 5441 504c 4520 6d61   # Get STAPLE ma
+0004f3c0: 736b 0a20 2020 2072 6f69 5f61 7272 6179  sk.    roi_array
+0004f3d0: 7320 3d20 5b5d 0a20 2020 2066 6f72 2072  s = [].    for r
+0004f3e0: 6f69 2069 6e20 726f 6973 3a0a 2020 2020  oi in rois:.    
+0004f3f0: 2020 2020 726f 695f 6172 7261 7973 2e61      roi_arrays.a
+0004f400: 7070 656e 6428 7369 746b 2e47 6574 496d  ppend(sitk.GetIm
+0004f410: 6167 6546 726f 6d41 7272 6179 2872 6f69  ageFromArray(roi
+0004f420: 2e67 6574 5f6d 6173 6b28 0a20 2020 2020  .get_mask(.     
+0004f430: 2020 2020 2020 2073 7461 6e64 6172 6469         standardi
+0004f440: 7365 3d54 7275 6529 2e61 7374 7970 6528  se=True).astype(
+0004f450: 696e 7429 2929 0a20 2020 2070 726f 6273  int))).    probs
+0004f460: 203d 2073 6974 6b2e 4765 7441 7272 6179   = sitk.GetArray
+0004f470: 4672 6f6d 496d 6167 6528 7369 746b 2e53  FromImage(sitk.S
+0004f480: 5441 504c 4528 726f 695f 6172 7261 7973  TAPLE(roi_arrays
+0004f490: 2c20 3129 290a 2020 2020 6d61 736b 203d  , 1)).    mask =
+0004f4a0: 2070 726f 6273 203e 2030 2e39 350a 0a20   probs > 0.95.. 
+0004f4b0: 2020 2023 2043 7265 6174 6520 5354 4150     # Create STAP
+0004f4c0: 4c45 2052 4f49 206f 626a 6563 740a 2020  LE ROI object.  
+0004f4d0: 2020 7265 7475 726e 2052 4f49 286d 6173    return ROI(mas
+0004f4e0: 6b2c 202a 2a6b 7761 7267 7329 0a0a 0a64  k, **kwargs)...d
+0004f4f0: 6566 2063 7265 6174 655f 6d61 6a6f 7269  ef create_majori
+0004f500: 7479 5f76 6f74 6528 726f 6973 2c20 2a2a  ty_vote(rois, **
+0004f510: 6b77 6172 6773 293a 0a20 2020 2022 2222  kwargs):.    """
+0004f520: 4372 6561 7465 206d 616a 6f72 6974 7920  Create majority 
+0004f530: 766f 7465 2052 4f49 2066 726f 6d20 6c69  vote ROI from li
+0004f540: 7374 206f 6620 524f 4973 2e22 2222 0a0a  st of ROIs."""..
+0004f550: 2020 2020 6d61 736b 203d 2072 6f69 735b      mask = rois[
+0004f560: 305d 2e67 6574 5f6d 6173 6b28 7374 616e  0].get_mask(stan
+0004f570: 6461 7264 6973 653d 5472 7565 292e 6173  dardise=True).as
+0004f580: 7479 7065 2869 6e74 290a 2020 2020 666f  type(int).    fo
+0004f590: 7220 726f 6920 696e 2072 6f69 735b 313a  r roi in rois[1:
+0004f5a0: 5d3a 0a20 2020 2020 2020 206d 6173 6b20  ]:.        mask 
+0004f5b0: 2b3d 2072 6f69 2e67 6574 5f6d 6173 6b28  += roi.get_mask(
+0004f5c0: 7374 616e 6461 7264 6973 653d 5472 7565  standardise=True
+0004f5d0: 292e 6173 7479 7065 2869 6e74 290a 2020  ).astype(int).  
+0004f5e0: 2020 6d61 736b 203d 206d 6173 6b20 3e3d    mask = mask >=
+0004f5f0: 206c 656e 2872 6f69 7329 202f 2032 0a20   len(rois) / 2. 
+0004f600: 2020 2072 6574 7572 6e20 524f 4928 6d61     return ROI(ma
+0004f610: 736b 2c20 2a2a 6b77 6172 6773 290a 0a0a  sk, **kwargs)...
+0004f620: 6465 6620 6372 6561 7465 5f72 6f69 5f73  def create_roi_s
+0004f630: 756d 2872 6f69 732c 202a 2a6b 7761 7267  um(rois, **kwarg
+0004f640: 7329 3a0a 2020 2020 2222 2243 7265 6174  s):.    """Creat
+0004f650: 6520 524f 4920 6672 6f6d 2073 756d 206f  e ROI from sum o
+0004f660: 6620 6c69 7374 206f 6620 524f 4973 2e22  f list of ROIs."
+0004f670: 2222 0a0a 2020 2020 6d61 736b 203d 2072  ""..    mask = r
+0004f680: 6f69 735b 305d 2e67 6574 5f6d 6173 6b28  ois[0].get_mask(
+0004f690: 7374 616e 6461 7264 6973 653d 5472 7565  standardise=True
+0004f6a0: 292e 636f 7079 2829 0a20 2020 2066 6f72  ).copy().    for
+0004f6b0: 2072 6f69 2069 6e20 726f 6973 5b31 3a5d   roi in rois[1:]
+0004f6c0: 3a0a 2020 2020 2020 2020 6d61 736b 202b  :.        mask +
+0004f6d0: 3d20 726f 692e 6765 745f 6d61 736b 2873  = roi.get_mask(s
+0004f6e0: 7461 6e64 6172 6469 7365 3d54 7275 6529  tandardise=True)
+0004f6f0: 0a20 2020 2072 6574 7572 6e20 524f 4928  .    return ROI(
+0004f700: 6d61 736b 2c20 2a2a 6b77 6172 6773 290a  mask, **kwargs).
+0004f710: 0a0a 6465 6620 6372 6561 7465 5f72 6f69  ..def create_roi
+0004f720: 5f6f 7665 726c 6170 2872 6f69 732c 202a  _overlap(rois, *
+0004f730: 2a6b 7761 7267 7329 3a0a 2020 2020 2222  *kwargs):.    ""
+0004f740: 2243 7265 6174 6520 524f 4920 6672 6f6d  "Create ROI from
+0004f750: 206f 7665 726c 6170 206f 6620 6c69 7374   overlap of list
+0004f760: 206f 6620 524f 4973 2e22 2222 0a0a 2020   of ROIs."""..  
+0004f770: 2020 6d61 736b 203d 2072 6f69 735b 305d    mask = rois[0]
+0004f780: 2e67 6574 5f6d 6173 6b28 7374 616e 6461  .get_mask(standa
+0004f790: 7264 6973 653d 5472 7565 292e 636f 7079  rdise=True).copy
+0004f7a0: 2829 0a20 2020 2066 6f72 2072 6f69 2069  ().    for roi i
+0004f7b0: 6e20 726f 6973 5b31 3a5d 3a0a 2020 2020  n rois[1:]:.    
+0004f7c0: 2020 2020 6d61 736b 202a 3d20 726f 692e      mask *= roi.
+0004f7d0: 6765 745f 6d61 736b 2873 7461 6e64 6172  get_mask(standar
+0004f7e0: 6469 7365 3d54 7275 6529 0a20 2020 2072  dise=True).    r
+0004f7f0: 6574 7572 6e20 524f 4928 6d61 736b 2c20  eturn ROI(mask, 
+0004f800: 2a2a 6b77 6172 6773 290a 0a0a 6465 6620  **kwargs)...def 
+0004f810: 6466 5f74 6f5f 6874 6d6c 2864 6629 3a0a  df_to_html(df):.
+0004f820: 2020 2020 2222 2243 6f6e 7665 7274 2061      """Convert a
+0004f830: 2070 616e 6461 7320 4461 7461 4672 616d   pandas DataFram
+0004f840: 6520 746f 2068 746d 6c2e 2222 220a 0a20  e to html.""".. 
+0004f850: 2020 2023 2043 6f6e 7665 7274 2064 6174     # Convert dat
+0004f860: 6166 7261 6d65 2074 6f20 4854 4d4c 0a20  aframe to HTML. 
+0004f870: 2020 2068 746d 6c20 3d20 6466 2e66 696c     html = df.fil
+0004f880: 6c6e 6128 27e2 8094 2729 2e74 6f5f 6874  lna('...').to_ht
+0004f890: 6d6c 2869 6e64 6578 3d46 616c 7365 290a  ml(index=False).
+0004f8a0: 2020 2020 6874 6d6c 203d 2068 746d 6c2e      html = html.
+0004f8b0: 7265 706c 6163 6528 225e 3322 2c20 223c  replace("^3", "<
+0004f8c0: 7375 703e 333c 2f73 7570 3e22 292e 7265  sup>3</sup>").re
+0004f8d0: 706c 6163 6528 225e 3222 2c20 223c 7375  place("^2", "<su
+0004f8e0: 703e 323c 2f73 7570 3e22 290a 0a20 2020  p>2</sup>")..   
+0004f8f0: 2023 2041 6464 2068 6561 6465 7220 7769   # Add header wi
+0004f900: 7468 2073 7479 6c65 2064 6574 6169 6c73  th style details
+0004f910: 0a20 2020 2068 6561 6465 7220 3d20 2222  .    header = ""
+0004f920: 220a 2020 2020 2020 2020 3c68 6561 643e  ".        <head>
+0004f930: 0a20 2020 2020 2020 2020 2020 203c 7374  .            <st
+0004f940: 796c 653e 0a20 2020 2020 2020 2020 2020  yle>.           
+0004f950: 2020 2020 2074 682c 2074 6420 7b0a 2020       th, td {.  
+0004f960: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004f970: 2020 7061 6464 696e 673a 2032 7078 2032    padding: 2px 2
+0004f980: 7078 3b0a 2020 2020 2020 2020 2020 2020  px;.            
+0004f990: 2020 2020 7d0a 2020 2020 2020 2020 2020      }.          
+0004f9a0: 2020 2020 2020 7468 207b 0a20 2020 2020        th {.     
+0004f9b0: 2020 2020 2020 2020 2020 2020 2020 2062                 b
+0004f9c0: 6163 6b67 726f 756e 642d 636f 6c6f 723a  ackground-color:
+0004f9d0: 2074 7261 6e73 7061 7265 6e74 3b0a 2020   transparent;.  
+0004f9e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004f9f0: 2020 7465 7874 2d61 6c69 676e 3a20 6365    text-align: ce
+0004fa00: 6e74 6572 3b0a 2020 2020 2020 2020 2020  nter;.          
+0004fa10: 2020 2020 2020 7d0a 2020 2020 2020 2020        }.        
+0004fa20: 2020 2020 3c2f 7374 796c 653e 0a20 2020      </style>.   
+0004fa30: 2020 2020 203c 2f68 6561 643e 0a20 2020       </head>.   
+0004fa40: 2022 2222 0a20 2020 2074 6162 6c65 5f68   """.    table_h
+0004fa50: 746d 6c20 3d20 280a 2020 2020 2020 2020  tml = (.        
+0004fa60: 2868 6561 6465 7220 2b20 6874 6d6c 290a  (header + html).
+0004fa70: 2020 2020 2020 2020 2e72 6570 6c61 6365          .replace
+0004fa80: 2822 2667 743b 222c 2022 3e22 290a 2020  ("&gt;", ">").  
+0004fa90: 2020 2020 2020 2e72 6570 6c61 6365 2822        .replace("
+0004faa0: 266c 743b 222c 2022 3c22 290a 2020 2020  &lt;", "<").    
+0004fab0: 2020 2020 2e72 6570 6c61 6365 2822 2661      .replace("&a
+0004fac0: 6d70 3b22 2c20 2226 2229 0a20 2020 2029  mp;", "&").    )
+0004fad0: 0a20 2020 2072 6574 7572 6e20 7461 626c  .    return tabl
+0004fae0: 655f 6874 6d6c 0a0a 0a64 6566 2062 6573  e_html...def bes
+0004faf0: 745f 7465 7874 5f63 6f6c 6f72 2872 6564  t_text_color(red
+0004fb00: 2c20 6772 6565 6e2c 2062 6c75 6529 3a0a  , green, blue):.
+0004fb10: 2020 2020 6966 2028 7265 6420 2a20 302e      if (red * 0.
+0004fb20: 3239 3920 2b20 6772 6565 6e20 2a20 302e  299 + green * 0.
+0004fb30: 3538 3720 2b20 626c 7565 202a 2030 2e31  587 + blue * 0.1
+0004fb40: 3134 2920 3e20 3138 363a 0a20 2020 2020  14) > 186:.     
+0004fb50: 2020 2072 6574 7572 6e20 2262 6c61 636b     return "black
+0004fb60: 220a 2020 2020 7265 7475 726e 2022 7768  ".    return "wh
+0004fb70: 6974 6522 0a0a 0a64 6566 2067 6574 5f63  ite"...def get_c
+0004fb80: 6f6c 6f72 6564 5f72 6f69 5f73 7472 696e  olored_roi_strin
+0004fb90: 6728 726f 692c 2067 7265 793d 4661 6c73  g(roi, grey=Fals
+0004fba0: 652c 2063 6f6c 6f72 3d4e 6f6e 6529 3a0a  e, color=None):.
+0004fbb0: 2020 2020 2222 2247 6574 2052 4f49 206e      """Get ROI n
+0004fbc0: 616d 6520 696e 2048 544d 4c20 7769 7468  ame in HTML with
+0004fbd0: 2062 6163 6b67 726f 756e 6420 636f 6c6f   background colo
+0004fbe0: 7220 6672 6f6d 2072 6f69 2e63 6f6c 6f72  r from roi.color
+0004fbf0: 2e20 4966 2067 7265 793d 5472 7565 2c0a  . If grey=True,.
+0004fc00: 2020 2020 7468 6520 6261 636b 6772 6f75      the backgrou
+0004fc10: 6e64 2063 6f6c 6f72 2077 696c 6c20 6265  nd color will be
+0004fc20: 2067 7265 792e 2222 220a 0a20 2020 2069   grey."""..    i
+0004fc30: 6620 636f 6c6f 7220 6973 204e 6f6e 653a  f color is None:
+0004fc40: 0a20 2020 2020 2020 2063 6f6c 6f72 203d  .        color =
+0004fc50: 2072 6f69 2e63 6f6c 6f72 0a20 2020 2069   roi.color.    i
+0004fc60: 6620 6772 6579 3a0a 2020 2020 2020 2020  f grey:.        
+0004fc70: 7265 642c 2067 7265 656e 2c20 626c 7565  red, green, blue
+0004fc80: 203d 2032 3535 2c20 3235 352c 2032 3535   = 255, 255, 255
+0004fc90: 0a20 2020 2020 2020 2072 6564 2c20 6772  .        red, gr
+0004fca0: 6565 6e2c 2062 6c75 6520 3d20 3132 382c  een, blue = 128,
+0004fcb0: 2031 3238 2c20 3132 380a 2020 2020 2020   128, 128.      
+0004fcc0: 2020 7465 7874 5f63 6f6c 203d 2032 3030    text_col = 200
+0004fcd0: 2c20 3230 302c 2032 3030 0a20 2020 2020  , 200, 200.     
+0004fce0: 2020 2023 2041 766f 6964 2073 6574 7469     # Avoid setti
+0004fcf0: 6e67 2063 6f6c 6f75 7220 666f 7220 6772  ng colour for gr
+0004fd00: 6579 6564 206f 7574 2052 4f49 732e 0a20  eyed out ROIs.. 
+0004fd10: 2020 2020 2020 2023 2054 6869 7320 6769         # This gi
+0004fd20: 7665 7320 676f 6f64 2072 6561 6461 6269  ves good readabi
+0004fd30: 6c69 7479 2066 6f72 2062 6f74 6820 6461  lity for both da
+0004fd40: 726b 2061 6e64 206c 6967 6874 2074 6865  rk and light the
+0004fd50: 6d65 732e 0a20 2020 2020 2020 2072 6574  mes..        ret
+0004fd60: 7572 6e20 2827 3c70 3e26 6e62 7370 3b7b  urn ('<p>&nbsp;{
+0004fd70: 7d26 6e62 7370 3b3c 2f70 3e27 292e 666f  }&nbsp;</p>').fo
+0004fd80: 726d 6174 2872 6f69 2e6e 616d 6529 0a20  rmat(roi.name). 
+0004fd90: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+0004fda0: 2072 6564 2c20 6772 6565 6e2c 2062 6c75   red, green, blu
+0004fdb0: 6520 3d20 5b63 202a 2032 3535 2066 6f72  e = [c * 255 for
+0004fdc0: 2063 2069 6e20 636f 6c6f 725b 3a33 5d5d   c in color[:3]]
+0004fdd0: 0a20 2020 2020 2020 2074 6578 745f 636f  .        text_co
+0004fde0: 6c20 3d20 6265 7374 5f74 6578 745f 636f  l = best_text_co
+0004fdf0: 6c6f 7228 7265 642c 2067 7265 656e 2c20  lor(red, green, 
+0004fe00: 626c 7565 290a 2020 2020 7265 7475 726e  blue).    return
+0004fe10: 2028 0a20 2020 2020 2020 2027 3c70 2073   (.        '<p s
+0004fe20: 7479 6c65 3d22 6261 636b 6772 6f75 6e64  tyle="background
+0004fe30: 2d63 6f6c 6f72 3a20 7267 6228 7b7d 2c20  -color: rgb({}, 
+0004fe40: 7b7d 2c20 7b7d 293b 2027 0a20 2020 2020  {}, {}); '.     
+0004fe50: 2020 2027 636f 6c6f 723a 207b 7d3b 223e     'color: {};">
+0004fe60: 266e 6273 703b 7b7d 266e 6273 703b 3c2f  &nbsp;{}&nbsp;</
+0004fe70: 703e 270a 2020 2020 292e 666f 726d 6174  p>'.    ).format
+0004fe80: 2872 6564 2c20 6772 6565 6e2c 2062 6c75  (red, green, blu
+0004fe90: 652c 2074 6578 745f 636f 6c2c 2072 6f69  e, text_col, roi
+0004fea0: 2e6e 616d 6529 0a0a 6465 6620 636f 6d70  .name)..def comp
+0004feb0: 6172 655f 726f 695f 7061 6972 7328 0a20  are_roi_pairs(. 
+0004fec0: 2020 2070 6169 7273 2c20 0a20 2020 2068     pairs, .    h
+0004fed0: 746d 6c3d 4661 6c73 652c 0a20 2020 206e  tml=False,.    n
+0004fee0: 616d 655f 6173 5f69 6e64 6578 3d54 7275  ame_as_index=Tru
+0004fef0: 652c 0a20 2020 2067 7265 7965 645f 6f75  e,.    greyed_ou
+0004ff00: 743d 4e6f 6e65 2c0a 2020 2020 636f 6c6f  t=None,.    colo
+0004ff10: 7265 643d 4661 6c73 652c 0a20 2020 2072  red=False,.    r
+0004ff20: 6f69 5f6b 7761 7267 733d 7b7d 2c0a 2020  oi_kwargs={},.  
+0004ff30: 2020 2a2a 6b77 6172 6773 0a29 3a0a 2020    **kwargs.):.  
+0004ff40: 2020 6966 2068 746d 6c3a 0a20 2020 2020    if html:.     
+0004ff50: 2020 206e 616d 655f 6173 5f69 6e64 6578     name_as_index
+0004ff60: 203d 2046 616c 7365 0a20 2020 2069 6620   = False.    if 
+0004ff70: 6772 6579 6564 5f6f 7574 2069 7320 4e6f  greyed_out is No
+0004ff80: 6e65 3a0a 2020 2020 2020 2020 6772 6579  ne:.        grey
+0004ff90: 6564 5f6f 7574 203d 205b 5d0a 2020 2020  ed_out = [].    
+0004ffa0: 6466 7320 3d20 5b5d 0a20 2020 2066 6f72  dfs = [].    for
+0004ffb0: 2072 6f69 312c 2072 6f69 3220 696e 2070   roi1, roi2 in p
+0004ffc0: 6169 7273 3a0a 0a20 2020 2020 2020 2023  airs:..        #
+0004ffd0: 2047 6574 2044 6174 6146 7261 6d65 2066   Get DataFrame f
+0004ffe0: 6f72 2074 6869 7320 7061 6972 0a20 2020  or this pair.   
+0004fff0: 2020 2020 2064 665f 726f 7720 3d20 726f       df_row = ro
+00050000: 6931 2e67 6574 5f63 6f6d 7061 7269 736f  i1.get_compariso
+00050010: 6e28 726f 6932 2c20 6e61 6d65 5f61 735f  n(roi2, name_as_
+00050020: 696e 6465 783d 6e61 6d65 5f61 735f 696e  index=name_as_in
+00050030: 6465 782c 0a20 2020 2020 2020 2020 2020  dex,.           
+00050040: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00050050: 2020 2020 2020 2020 2020 2a2a 6b77 6172            **kwar
+00050060: 6773 290a 0a20 2020 2020 2020 2023 2052  gs)..        # R
+00050070: 6570 6c61 6365 2076 616c 7565 7320 7769  eplace values wi
+00050080: 7468 2022 2d2d 2220 6966 2065 6974 6865  th "--" if eithe
+00050090: 7220 524f 4920 6973 2067 7265 7965 6420  r ROI is greyed 
+000500a0: 6f75 740a 2020 2020 2020 2020 6772 6579  out.        grey
+000500b0: 203d 2072 6f69 3120 696e 2067 7265 7965   = roi1 in greye
+000500c0: 645f 6f75 7420 6f72 2072 6f69 3220 696e  d_out or roi2 in
+000500d0: 2067 7265 7965 645f 6f75 740a 2020 2020   greyed_out.    
+000500e0: 2020 2020 6966 2067 7265 793a 0a20 2020      if grey:.   
+000500f0: 2020 2020 2020 2020 2066 6f72 2063 6f6c           for col
+00050100: 2069 6e20 6466 5f72 6f77 2e63 6f6c 756d   in df_row.colum
+00050110: 6e73 3a0a 2020 2020 2020 2020 2020 2020  ns:.            
+00050120: 2020 2020 6966 2063 6f6c 203d 3d20 2252      if col == "R
+00050130: 4f49 223a 200a 2020 2020 2020 2020 2020  OI": .          
+00050140: 2020 2020 2020 2020 2020 636f 6e74 696e            contin
+00050150: 7565 0a20 2020 2020 2020 2020 2020 2020  ue.             
+00050160: 2020 2064 665f 726f 775b 636f 6c5d 203d     df_row[col] =
+00050170: 2022 2d2d 220a 0a20 2020 2020 2020 2023   "--"..        #
+00050180: 2041 646a 7573 7420 636f 6d70 6172 6973   Adjust comparis
+00050190: 6f6e 206e 616d 650a 2020 2020 2020 2020  on name.        
+000501a0: 636f 6d70 5f6e 616d 6520 3d20 726f 6931  comp_name = roi1
+000501b0: 2e67 6574 5f63 6f6d 7061 7269 736f 6e5f  .get_comparison_
+000501c0: 6e61 6d65 2872 6f69 322c 2063 6f6c 6f72  name(roi2, color
+000501d0: 6564 3d63 6f6c 6f72 6564 2c20 6772 6579  ed=colored, grey
+000501e0: 3d67 7265 792c 0a20 2020 2020 2020 2020  =grey,.         
+000501f0: 2020 2020 2020 2072 6f69 5f6b 7761 7267         roi_kwarg
+00050200: 733d 726f 695f 6b77 6172 6773 290a 2020  s=roi_kwargs).  
+00050210: 2020 2020 2020 6966 206e 616d 655f 6173        if name_as
+00050220: 5f69 6e64 6578 3a0a 2020 2020 2020 2020  _index:.        
+00050230: 2020 2020 6466 5f72 6f77 2e72 656e 616d      df_row.renam
+00050240: 6528 7b64 665f 726f 772e 696e 6465 785b  e({df_row.index[
+00050250: 305d 3a20 636f 6d70 5f6e 616d 657d 2c20  0]: comp_name}, 
+00050260: 696e 706c 6163 653d 5472 7565 290a 2020  inplace=True).  
+00050270: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+00050280: 2020 2020 2020 2020 6466 5f72 6f77 2e69          df_row.i
+00050290: 6c6f 635b 302c 2030 5d20 3d20 636f 6d70  loc[0, 0] = comp
+000502a0: 5f6e 616d 650a 0a20 2020 2020 2020 2064  _name..        d
+000502b0: 6673 2e61 7070 656e 6428 6466 5f72 6f77  fs.append(df_row
+000502c0: 290a 0a20 2020 2069 676e 6f72 655f 696e  )..    ignore_in
+000502d0: 6465 7820 3d20 4661 6c73 6520 6966 206e  dex = False if n
+000502e0: 616d 655f 6173 5f69 6e64 6578 2065 6c73  ame_as_index els
+000502f0: 6520 5472 7565 0a20 2020 2064 6620 3d20  e True.    df = 
+00050300: 7064 2e63 6f6e 6361 7428 6466 732c 2069  pd.concat(dfs, i
+00050310: 676e 6f72 655f 696e 6465 783d 6967 6e6f  gnore_index=igno
+00050320: 7265 5f69 6e64 6578 2920 6966 2064 6673  re_index) if dfs
+00050330: 2065 6c73 6520 4e6f 6e65 0a20 2020 2069   else None.    i
+00050340: 6620 6874 6d6c 3a0a 2020 2020 2020 2020  f html:.        
+00050350: 7265 7475 726e 2064 665f 746f 5f68 746d  return df_to_htm
+00050360: 6c28 6466 290a 2020 2020 7265 7475 726e  l(df).    return
+00050370: 2064 660a 0a64 6566 2067 6574 5f63 6f6e   df..def get_con
+00050380: 666f 726d 6974 795f 696e 6465 7828 0a20  formity_index(. 
+00050390: 2020 2072 6f69 732c 0a20 2020 2063 695f     rois,.    ci_
+000503a0: 7479 7065 3d22 6765 6e22 2c0a 2020 2020  type="gen",.    
+000503b0: 7369 6e67 6c65 5f73 6c69 6365 3d46 616c  single_slice=Fal
+000503c0: 7365 2c0a 2020 2020 7669 6577 3d22 782d  se,.    view="x-
+000503d0: 7922 2c20 0a20 2020 2073 6c3d 4e6f 6e65  y", .    sl=None
+000503e0: 2c20 0a20 2020 2069 6478 3d4e 6f6e 652c  , .    idx=None,
+000503f0: 200a 2020 2020 706f 733d 4e6f 6e65 2c20   .    pos=None, 
+00050400: 0a20 2020 206d 6574 686f 643d 4e6f 6e65  .    method=None
+00050410: 2c0a 2020 2020 666c 6174 7465 6e3d 4661  ,.    flatten=Fa
+00050420: 6c73 652c 0a20 2020 2029 3a0a 2020 2020  lse,.    ):.    
+00050430: 2222 220a 2020 2020 4765 7420 636f 6e66  """.    Get conf
+00050440: 6f72 6d69 7479 2069 6e64 6578 2066 6f72  ormity index for
+00050450: 2074 776f 206f 7220 6d6f 7265 2052 4f49   two or more ROI
+00050460: 732e 0a0a 2020 2020 5468 6520 636f 6e66  s...    The conf
+00050470: 6f72 6d69 7479 2069 6e64 6578 206d 6179  ormity index may
+00050480: 2062 6520 6361 6c63 756c 6174 6564 2067   be calculated g
+00050490: 6c6f 6261 6c6c 7920 6f72 2066 6f72 2061  lobally or for a
+000504a0: 2073 696e 676c 6520 736c 6963 652e 0a0a   single slice...
+000504b0: 2020 2020 5468 6973 2066 756e 6374 696f      This functio
+000504c0: 6e20 7265 7475 726e 7320 6569 7468 6572  n returns either
+000504d0: 2074 6865 2076 616c 7565 206f 6620 6f6e   the value of on
+000504e0: 6520 6f66 2074 6865 2074 6872 6565 2074  e of the three t
+000504f0: 7970 6573 0a20 2020 206f 6620 636f 6e66  ypes.    of conf
+00050500: 6f72 6d69 7479 2069 6e64 6578 2028 2267  ormity index ("g
+00050510: 656e 2220 2866 6f72 2067 656e 6572 616c  en" (for general
+00050520: 6973 6564 292c 2022 7061 6972 7322 2c20  ised), "pairs", 
+00050530: 2263 6f6d 6d6f 6e22 290a 2020 2020 7265  "common").    re
+00050540: 6665 7272 6564 2074 6f20 696e 3a0a 2020  ferred to in:.  
+00050550: 2020 6874 7470 733a 2f2f 646f 692e 6f72    https://doi.or
+00050560: 672f 3130 2e31 3038 382f 3030 3331 2d39  g/10.1088/0031-9
+00050570: 3135 352f 3534 2f39 2f30 3138 0a20 2020  155/54/9/018.   
+00050580: 206f 7220 6120 736b 7274 2e63 6f72 652e   or a skrt.core.
+00050590: 4461 7461 206f 626a 6563 7420 7769 7468  Data object with
+000505a0: 2074 6865 2076 616c 7565 7320 6f66 2061   the values of a
+000505b0: 6c6c 2074 6872 6565 2e0a 2020 2020 466f  ll three..    Fo
+000505c0: 7220 7468 6520 6361 7365 206f 6620 7477  r the case of tw
+000505d0: 6f20 524f 4973 2c20 7468 6520 7468 7265  o ROIs, the thre
+000505e0: 6520 6d65 7472 6963 7320 6172 6520 616c  e metrics are al
+000505f0: 6c20 6571 7569 7661 6c65 6e74 0a20 2020  l equivalent.   
+00050600: 2074 6f20 7468 6520 4a61 6363 6172 6420   to the Jaccard 
+00050610: 636f 6e66 6f72 6d69 7479 2069 6e64 6578  conformity index
+00050620: 2e0a 0a20 2020 202a 2a50 6172 616d 6574  ...    **Paramet
+00050630: 6572 733a 2a2a 0a20 2020 2020 2020 200a  ers:**.        .
+00050640: 2020 2020 726f 6973 203a 206c 6973 740a      rois : list.
+00050650: 2020 2020 2020 2020 4c69 7374 206f 6620          List of 
+00050660: 7477 6f20 6f72 206d 6f72 6520 736b 7274  two or more skrt
+00050670: 2e73 7472 7563 7475 7265 732e 524f 4920  .structures.ROI 
+00050680: 6f62 6a65 6374 7320 666f 7220 7768 6963  objects for whic
+00050690: 6820 636f 6e66 6f72 6d69 7479 0a20 2020  h conformity.   
+000506a0: 2020 2020 2069 6e64 6578 2069 7320 746f       index is to
+000506b0: 2062 6520 6361 6c63 756c 6174 6564 2e0a   be calculated..
+000506c0: 0a20 2020 2063 695f 7479 7065 3a20 7374  .    ci_type: st
+000506d0: 722c 2064 6566 6175 6c74 3d22 6765 6e22  r, default="gen"
+000506e0: 0a20 2020 2020 2020 2054 7970 6520 6f66  .        Type of
+000506f0: 2063 6f6e 666f 726d 6974 7920 696e 6465   conformity inde
+00050700: 7820 746f 2062 6520 7265 7475 726e 6564  x to be returned
+00050710: 2c20 6672 6f6d 2022 6765 6e22 2028 666f  , from "gen" (fo
+00050720: 7220 6765 6e65 7261 6c69 7365 6429 2c0a  r generalised),.
+00050730: 2020 2020 2020 2020 2270 6169 7273 222c          "pairs",
+00050740: 2022 636f 6d6d 6f6e 222e 2020 4966 2073   "common".  If s
+00050750: 6574 2074 6f20 2261 6c6c 222c 2061 2073  et to "all", a s
+00050760: 6b72 742e 636f 7265 2e44 6174 6120 6f62  krt.core.Data ob
+00050770: 6a65 6374 2077 6974 680a 2020 2020 2020  ject with.      
+00050780: 2020 7661 6c75 6573 2066 6f72 2074 6865    values for the
+00050790: 2074 6872 6565 2074 7970 6573 206f 6620   three types of 
+000507a0: 636f 6e66 6f72 6d69 7479 2069 6e64 6578  conformity index
+000507b0: 2069 7320 7265 7475 726e 6564 2e0a 0a20   is returned... 
+000507c0: 2020 2073 696e 676c 655f 736c 6963 6520     single_slice 
+000507d0: 3a20 626f 6f6c 2c20 6465 6661 756c 743d  : bool, default=
+000507e0: 4661 6c73 650a 2020 2020 2020 2020 4966  False.        If
+000507f0: 2046 616c 7365 2c20 7468 6520 676c 6f62   False, the glob
+00050800: 616c 2033 4420 4469 6365 2073 636f 7265  al 3D Dice score
+00050810: 206f 6620 7468 6520 6675 6c6c 2052 4f49   of the full ROI
+00050820: 7320 7769 6c6c 2062 6520 7265 7475 726e  s will be return
+00050830: 6564 3b0a 2020 2020 2020 2020 6f74 6865  ed;.        othe
+00050840: 7277 6973 652c 2074 6865 2032 4420 4469  rwise, the 2D Di
+00050850: 6365 2073 636f 7265 206f 6e20 6120 7369  ce score on a si
+00050860: 6e67 6c65 2073 6c69 6365 2077 696c 6c20  ngle slice will 
+00050870: 6265 2072 6574 7572 6e65 642e 0a0a 2020  be returned...  
+00050880: 2020 7669 6577 203a 2073 7472 2c20 6465    view : str, de
+00050890: 6661 756c 743d 2278 2d79 220a 2020 2020  fault="x-y".    
+000508a0: 2020 2020 4f72 6965 6e74 6174 696f 6e20      Orientation 
+000508b0: 6f66 2073 6c69 6365 206f 6e20 7768 6963  of slice on whic
+000508c0: 6820 746f 2067 6574 2044 6963 6520 7363  h to get Dice sc
+000508d0: 6f72 652e 204f 6e6c 7920 7573 6564 2069  ore. Only used i
+000508e0: 6620 0a20 2020 2020 2020 2073 696e 676c  f .        singl
+000508f0: 655f 736c 6963 653d 5472 7565 2e20 4966  e_slice=True. If
+00050900: 2075 7369 6e67 2c20 3c61 783e 206d 7573   using, <ax> mus
+00050910: 7420 6265 2061 6e20 6178 6973 2074 6861  t be an axis tha
+00050920: 7420 6c69 6573 2061 6c6f 6e67 0a20 2020  t lies along.   
+00050930: 2020 2020 2074 6865 2073 6c69 6365 2069       the slice i
+00050940: 6e20 7468 6973 206f 7269 656e 7461 7469  n this orientati
+00050950: 6f6e 2e0a 0a20 2020 2073 6c20 3a20 696e  on...    sl : in
+00050960: 742c 2064 6566 6175 6c74 3d4e 6f6e 650a  t, default=None.
+00050970: 2020 2020 2020 2020 536c 6963 6520 6e75          Slice nu
+00050980: 6d62 6572 2e20 4966 206e 6f6e 6520 6f66  mber. If none of
+00050990: 203c 736c 3e2c 203c 6964 783e 206f 7220   <sl>, <idx> or 
+000509a0: 3c70 6f73 3e20 6172 6520 7375 7070 6c69  <pos> are suppli
+000509b0: 6564 2062 7574 0a20 2020 2020 2020 203c  ed but.        <
+000509c0: 7369 6e67 6c65 5f73 6c69 6365 3e20 6973  single_slice> is
+000509d0: 2054 7275 652c 2074 6865 2063 656e 7472   True, the centr
+000509e0: 616c 2073 6c69 6365 206f 6620 7468 6973  al slice of this
+000509f0: 2052 4f49 2077 696c 6c20 6265 2075 7365   ROI will be use
+00050a00: 642e 0a0a 2020 2020 6964 7820 3a20 696e  d...    idx : in
+00050a10: 742c 2064 6566 6175 6c74 3d4e 6f6e 650a  t, default=None.
+00050a20: 2020 2020 2020 2020 4172 7261 7920 696e          Array in
+00050a30: 6465 7820 6f66 2073 6c69 6365 2e20 4966  dex of slice. If
+00050a40: 206e 6f6e 6520 6f66 203c 736c 3e2c 203c   none of <sl>, <
+00050a50: 6964 783e 206f 7220 3c70 6f73 3e20 6172  idx> or <pos> ar
+00050a60: 6520 7375 7070 6c69 6564 2062 7574 0a20  e supplied but. 
+00050a70: 2020 2020 2020 203c 7369 6e67 6c65 5f73         <single_s
+00050a80: 6c69 6365 3e20 6973 2054 7275 652c 2074  lice> is True, t
+00050a90: 6865 2063 656e 7472 616c 2073 6c69 6365  he central slice
+00050aa0: 206f 6620 7468 6973 2052 4f49 2077 696c   of this ROI wil
+00050ab0: 6c20 6265 2075 7365 642e 0a0a 2020 2020  l be used...    
+00050ac0: 706f 7320 3a20 666c 6f61 742c 2064 6566  pos : float, def
+00050ad0: 6175 6c74 3d4e 6f6e 650a 2020 2020 2020  ault=None.      
+00050ae0: 2020 536c 6963 6520 706f 7369 7469 6f6e    Slice position
+00050af0: 2069 6e20 6d6d 2e20 4966 206e 6f6e 6520   in mm. If none 
+00050b00: 6f66 203c 736c 3e2c 203c 6964 783e 206f  of <sl>, <idx> o
+00050b10: 7220 3c70 6f73 3e20 6172 6520 7375 7070  r <pos> are supp
+00050b20: 6c69 6564 2062 7574 0a20 2020 2020 2020  lied but.       
+00050b30: 203c 7369 6e67 6c65 5f73 6c69 6365 3e20   <single_slice> 
+00050b40: 6973 2054 7275 652c 2074 6865 2063 656e  is True, the cen
+00050b50: 7472 616c 2073 6c69 6365 206f 6620 7468  tral slice of th
+00050b60: 6973 2052 4f49 2077 696c 6c20 6265 2075  is ROI will be u
+00050b70: 7365 642e 0a0a 2020 2020 6d65 7468 6f64  sed...    method
+00050b80: 203a 2073 7472 2c20 6465 6661 756c 743d   : str, default=
+00050b90: 4e6f 6e65 0a20 2020 2020 2020 204d 6574  None.        Met
+00050ba0: 686f 6420 746f 2075 7365 2066 6f72 2044  hod to use for D
+00050bb0: 6963 6520 7363 6f72 6520 6361 6c63 756c  ice score calcul
+00050bc0: 6174 696f 6e2e 2043 616e 2062 653a 200a  ation. Can be: .
+00050bd0: 2020 2020 2020 2020 2d20 2263 6f6e 746f          - "conto
+00050be0: 7572 223a 2067 6574 2069 6e74 6572 7365  ur": get interse
+00050bf0: 6374 696f 6e73 2061 6e64 2061 7265 6173  ctions and areas
+00050c00: 206f 6620 7368 6170 656c 7920 636f 6e74   of shapely cont
+00050c10: 6f75 7273 2e0a 2020 2020 2020 2020 2d20  ours..        - 
+00050c20: 226d 6173 6b22 3a20 636f 756e 7420 696e  "mask": count in
+00050c30: 7465 7273 6563 7469 6e67 2076 6f78 656c  tersecting voxel
+00050c40: 7320 696e 2062 696e 6172 7920 6d61 736b  s in binary mask
+00050c50: 732e 0a20 2020 2020 2020 202d 204e 6f6e  s..        - Non
+00050c60: 653a 2075 7365 2074 6865 206d 6574 686f  e: use the metho
+00050c70: 6420 7365 7420 696e 2073 656c 662e 6465  d set in self.de
+00050c80: 6661 756c 745f 6765 6f6d 5f6d 6574 686f  fault_geom_metho
+00050c90: 642e 0a20 2020 2020 2020 2046 6f72 206d  d..        For m
+00050ca0: 6f72 6520 7468 616e 2074 776f 2052 4f49  ore than two ROI
+00050cb0: 7320 616e 6420 3c63 695f 7479 7065 3e20  s and <ci_type> 
+00050cc0: 2263 6f6d 6d6f 6e22 2c20 6f6e 6c79 2074  "common", only t
+00050cd0: 6865 2022 6d61 736b 220a 2020 2020 2020  he "mask".      
+00050ce0: 2020 6d65 7468 6f64 2069 7320 696d 706c    method is impl
+00050cf0: 656d 656e 7465 642e 0a0a 2020 2020 666c  emented...    fl
+00050d00: 6174 7465 6e20 3a20 626f 6f6c 2c20 6465  atten : bool, de
+00050d10: 6661 756c 743d 4661 6c73 650a 2020 2020  fault=False.    
+00050d20: 2020 2020 4966 2054 7275 652c 2061 6c6c      If True, all
+00050d30: 2073 6c69 6365 7320 7769 6c6c 2062 6520   slices will be 
+00050d40: 666c 6174 7465 6e65 6420 696e 2074 6865  flattened in the
+00050d50: 2067 6976 656e 206f 7269 656e 7461 7469   given orientati
+00050d60: 6f6e 2061 6e64 0a20 2020 2020 2020 2074  on and.        t
+00050d70: 6865 2044 6963 6520 7363 6f72 6520 6f66  he Dice score of
+00050d80: 2074 6865 2066 6c61 7474 656e 6564 2073   the flattened s
+00050d90: 6c69 6365 7320 7769 6c6c 2062 6520 7265  lices will be re
+00050da0: 7475 726e 6564 2e20 4f6e 6c79 200a 2020  turned. Only .  
+00050db0: 2020 2020 2020 6176 6169 6c61 626c 6520        available 
+00050dc0: 6966 206d 6574 686f 643d 226d 6173 6b22  if method="mask"
+00050dd0: 2e0a 2020 2020 2222 220a 0a20 2020 2023  ..    """..    #
+00050de0: 2052 6571 7569 7265 2076 616c 6964 2069   Require valid i
+00050df0: 6e70 7574 732e 0a20 2020 2069 6620 6c65  nputs..    if le
+00050e00: 6e28 726f 6973 2920 3c20 3220 6f72 2063  n(rois) < 2 or c
+00050e10: 695f 7479 7065 206e 6f74 2069 6e20 5b22  i_type not in ["
+00050e20: 636f 6d6d 6f6e 222c 2022 6765 6e22 2c20  common", "gen", 
+00050e30: 2270 6169 7273 222c 2022 616c 6c22 5d3a  "pairs", "all"]:
+00050e40: 0a20 2020 2020 2020 2072 6574 7572 6e0a  .        return.
+00050e50: 0a20 2020 2023 2049 6e69 7469 616c 6973  .    # Initialis
+00050e60: 6520 4461 7461 206f 626a 6563 7420 666f  e Data object fo
+00050e70: 7220 636f 6e66 6f72 6d69 7479 2069 6e64  r conformity ind
+00050e80: 6963 6573 2e0a 2020 2020 6369 203d 2073  ices..    ci = s
+00050e90: 6b72 742e 636f 7265 2e44 6174 6128 7b22  krt.core.Data({"
+00050ea0: 636f 6d6d 6f6e 223a 2030 2c20 2267 656e  common": 0, "gen
+00050eb0: 223a 302c 2022 7061 6972 7322 3a30 7d29  ":0, "pairs":0})
+00050ec0: 0a0a 2020 2020 2320 4465 616c 2077 6974  ..    # Deal wit
+00050ed0: 6820 6361 7365 7320 2267 656e 2220 616e  h cases "gen" an
+00050ee0: 6420 2270 6169 7273 222e 0a20 2020 2023  d "pairs"..    #
+00050ef0: 0a20 2020 2023 2046 6f72 2022 6765 6e22  .    # For "gen"
+00050f00: 2c20 7468 6520 636f 6e66 6f72 6d69 7479  , the conformity
+00050f10: 2069 6e64 6578 2069 7320 6361 6c63 756c   index is calcul
+00050f20: 6174 6564 2061 7320 7468 6520 7261 7469  ated as the rati
+00050f30: 6f20 6f66 0a20 2020 2023 2028 3129 2074  o of.    # (1) t
+00050f40: 6865 2073 756d 206f 6620 7468 6520 696e  he sum of the in
+00050f50: 7465 7273 6563 7469 6f6e 7320 666f 7220  tersections for 
+00050f60: 616c 6c20 7061 6972 7320 746f 2028 3229  all pairs to (2)
+00050f70: 2074 6865 2073 756d 206f 660a 2020 2020   the sum of.    
+00050f80: 2320 7468 6520 756e 696f 6e73 2066 6f72  # the unions for
+00050f90: 2061 6c6c 2070 6169 7273 2e0a 2020 2020   all pairs..    
+00050fa0: 230a 2020 2020 2320 466f 7220 2270 6169  #.    # For "pai
+00050fb0: 7273 2c20 7468 6520 636f 6e66 6f72 6d69  rs, the conformi
+00050fc0: 7479 2069 6e64 6578 2069 7320 6361 6c63  ty index is calc
+00050fd0: 7561 6c74 6564 2061 7320 7468 6520 6d65  ualted as the me
+00050fe0: 616e 206f 6620 7468 650a 2020 2020 2320  an of the.    # 
+00050ff0: 4a61 6363 6172 6420 636f 6e66 6f72 6d69  Jaccard conformi
+00051000: 7479 2069 6e64 6963 6573 2066 6f72 2061  ty indices for a
+00051010: 6c6c 2070 6169 7273 2e0a 0a20 2020 206e  ll pairs...    n
+00051020: 756d 6572 6174 6f72 203d 2030 0a20 2020  umerator = 0.   
+00051030: 2064 656e 6f6d 696e 6174 6f72 203d 2030   denominator = 0
+00051040: 0a20 2020 206e 5f70 6169 7220 3d20 300a  .    n_pair = 0.
+00051050: 2020 2020 666f 7220 6964 7831 2069 6e20      for idx1 in 
+00051060: 7261 6e67 6528 6c65 6e28 726f 6973 2920  range(len(rois) 
+00051070: 2d20 3129 3a0a 2020 2020 2020 2020 666f  - 1):.        fo
+00051080: 7220 6964 7832 2069 6e20 7261 6e67 6528  r idx2 in range(
+00051090: 6964 7831 202b 2031 2c20 6c65 6e28 726f  idx1 + 1, len(ro
+000510a0: 6973 2929 3a0a 2020 2020 2020 2020 2020  is)):.          
+000510b0: 2020 726f 6931 203d 2072 6f69 735b 6964    roi1 = rois[id
+000510c0: 7831 5d0a 2020 2020 2020 2020 2020 2020  x1].            
+000510d0: 726f 6932 203d 2072 6f69 735b 6964 7832  roi2 = rois[idx2
+000510e0: 5d0a 2020 2020 2020 2020 2020 2020 696e  ].            in
+000510f0: 7465 7273 6563 7469 6f6e 2c20 756e 696f  tersection, unio
+00051100: 6e2c 206d 6561 6e5f 7369 7a65 203d 2028  n, mean_size = (
+00051110: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00051120: 2020 2020 2072 6f69 312e 6765 745f 696e       roi1.get_in
+00051130: 7465 7273 6563 7469 6f6e 5f75 6e69 6f6e  tersection_union
+00051140: 5f73 697a 6528 726f 6932 2c20 7369 6e67  _size(roi2, sing
+00051150: 6c65 5f73 6c69 6365 2c0a 2020 2020 2020  le_slice,.      
+00051160: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00051170: 2020 7669 6577 2c20 736c 2c20 6964 782c    view, sl, idx,
+00051180: 2070 6f73 2c20 6d65 7468 6f64 2c20 666c   pos, method, fl
+00051190: 6174 7465 6e29 290a 2020 2020 2020 2020  atten)).        
+000511a0: 2020 2020 6e75 6d65 7261 746f 7220 2b3d      numerator +=
+000511b0: 2069 6e74 6572 7365 6374 696f 6e0a 2020   intersection.  
+000511c0: 2020 2020 2020 2020 2020 6465 6e6f 6d69            denomi
+000511d0: 6e61 746f 7220 2b3d 2075 6e69 6f6e 0a20  nator += union. 
+000511e0: 2020 2020 2020 2020 2020 2063 692e 7061             ci.pa
+000511f0: 6972 7320 2b3d 2069 6e74 6572 7365 6374  irs += intersect
+00051200: 696f 6e20 2f20 756e 696f 6e0a 2020 2020  ion / union.    
+00051210: 2020 2020 2020 2020 6e5f 7061 6972 202b          n_pair +
+00051220: 3d20 310a 0a20 2020 2063 692e 6765 6e20  = 1..    ci.gen 
+00051230: 3d20 6e75 6d65 7261 746f 7220 2f20 6465  = numerator / de
+00051240: 6e6f 6d69 6e61 746f 720a 2020 2020 6369  nominator.    ci
+00051250: 2e70 6169 7273 202f 3d20 6e5f 7061 6972  .pairs /= n_pair
+00051260: 0a0a 2020 2020 2320 4465 616c 2077 6974  ..    # Deal wit
+00051270: 6820 6361 7365 2022 636f 6d6d 6f6e 222e  h case "common".
+00051280: 0a20 2020 2023 0a20 2020 2023 2054 6865  .    #.    # The
+00051290: 2063 6f6e 666f 726d 6974 7920 696e 6465   conformity inde
+000512a0: 7820 6973 2063 616c 6375 6c61 7465 6420  x is calculated 
+000512b0: 6173 2074 6865 2072 6174 696f 206f 660a  as the ratio of.
+000512c0: 2020 2020 2320 2831 2920 7468 6520 636f      # (1) the co
+000512d0: 6d6d 6f6e 2069 6e74 6572 7365 6374 696f  mmon intersectio
+000512e0: 6e20 6f66 2061 6c6c 2052 4f49 7320 746f  n of all ROIs to
+000512f0: 2028 3229 2074 6865 2063 6f6d 6269 6e65   (2) the combine
+00051300: 6420 756e 696f 6e0a 2020 2020 2320 6f66  d union.    # of
+00051310: 2061 6c6c 2052 4f49 732e 0a20 2020 2069   all ROIs..    i
+00051320: 6620 3220 3d3d 206c 656e 2872 6f69 7329  f 2 == len(rois)
+00051330: 3a0a 2020 2020 2020 2020 696e 7465 7273  :.        inters
+00051340: 6563 7469 6f6e 2c20 756e 696f 6e2c 206d  ection, union, m
+00051350: 6561 6e5f 7369 7a65 203d 2028 0a20 2020  ean_size = (.   
+00051360: 2020 2020 2020 2020 2020 2020 2072 6f69               roi
+00051370: 735b 305d 2e67 6574 5f69 6e74 6572 7365  s[0].get_interse
+00051380: 6374 696f 6e5f 756e 696f 6e5f 7369 7a65  ction_union_size
+00051390: 2872 6f69 735b 315d 2c20 7369 6e67 6c65  (rois[1], single
+000513a0: 5f73 6c69 6365 2c0a 2020 2020 2020 2020  _slice,.        
+000513b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000513c0: 7669 6577 2c20 736c 2c20 6964 782c 2070  view, sl, idx, p
+000513d0: 6f73 2c20 6d65 7468 6f64 2c20 666c 6174  os, method, flat
+000513e0: 7465 6e29 290a 2020 2020 2020 2020 6369  ten)).        ci
+000513f0: 2e63 6f6d 6d6f 6e20 3d20 696e 7465 7273  .common = inters
+00051400: 6563 7469 6f6e 202f 2075 6e69 6f6e 0a20  ection / union. 
+00051410: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+00051420: 2069 6620 6e6f 7420 7369 6e67 6c65 5f73   if not single_s
+00051430: 6c69 6365 3a0a 2020 2020 2020 2020 2020  lice:.          
+00051440: 2020 6d61 736b 5f69 6e74 6572 7365 6374    mask_intersect
+00051450: 696f 6e20 3d20 726f 6973 5b30 5d2e 636c  ion = rois[0].cl
+00051460: 6f6e 6528 292e 6765 745f 6d61 736b 280a  one().get_mask(.
+00051470: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00051480: 2020 2020 7669 6577 2c20 666c 6174 7465      view, flatte
+00051490: 6e2c 2073 7461 6e64 6172 6469 7365 3d54  n, standardise=T
+000514a0: 7275 6529 0a20 2020 2020 2020 2020 2020  rue).           
+000514b0: 206d 6173 6b5f 756e 696f 6e20 3d20 726f   mask_union = ro
+000514c0: 6973 5b30 5d2e 636c 6f6e 6528 292e 6765  is[0].clone().ge
+000514d0: 745f 6d61 736b 280a 2020 2020 2020 2020  t_mask(.        
+000514e0: 2020 2020 2020 2020 2020 2020 7669 6577              view
+000514f0: 2c20 666c 6174 7465 6e2c 2073 7461 6e64  , flatten, stand
+00051500: 6172 6469 7365 3d54 7275 6529 0a20 2020  ardise=True).   
+00051510: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+00051520: 2020 2020 2020 206d 6173 6b5f 696e 7465         mask_inte
+00051530: 7273 6563 7469 6f6e 203d 2072 6f69 735b  rsection = rois[
+00051540: 305d 2e63 6c6f 6e65 2829 2e67 6574 5f73  0].clone().get_s
+00051550: 6c69 6365 280a 2020 2020 2020 2020 2020  lice(.          
+00051560: 2020 2020 2020 2020 2020 7669 6577 2c20            view, 
+00051570: 736c 2c20 6964 782c 2070 6f73 290a 2020  sl, idx, pos).  
+00051580: 2020 2020 2020 2020 2020 6d61 736b 5f75            mask_u
+00051590: 6e69 6f6e 203d 2072 6f69 735b 305d 2e63  nion = rois[0].c
+000515a0: 6c6f 6e65 2829 2e67 6574 5f73 6c69 6365  lone().get_slice
+000515b0: 2876 6965 772c 2073 6c2c 2069 6478 2c20  (view, sl, idx, 
+000515c0: 706f 7329 0a0a 2020 2020 2020 2020 666f  pos)..        fo
+000515d0: 7220 726f 6920 696e 2072 6f69 735b 313a  r roi in rois[1:
+000515e0: 5d3a 0a20 2020 2020 2020 2020 2020 2069  ]:.            i
+000515f0: 6620 6e6f 7420 7369 6e67 6c65 5f73 6c69  f not single_sli
+00051600: 6365 3a0a 2020 2020 2020 2020 2020 2020  ce:.            
+00051610: 2020 2020 6d61 736b 203d 2072 6f69 2e67      mask = roi.g
+00051620: 6574 5f6d 6173 6b28 7669 6577 2c20 666c  et_mask(view, fl
+00051630: 6174 7465 6e2c 2073 7461 6e64 6172 6469  atten, standardi
+00051640: 7365 3d54 7275 6529 0a20 2020 2020 2020  se=True).       
+00051650: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+00051660: 2020 2020 2020 2020 2020 206d 6173 6b20             mask 
+00051670: 3d20 726f 692e 6765 745f 736c 6963 6528  = roi.get_slice(
+00051680: 7669 6577 2c20 736c 2c20 6964 782c 2070  view, sl, idx, p
+00051690: 6f73 290a 0a20 2020 2020 2020 2020 2020  os)..           
+000516a0: 206d 6173 6b5f 696e 7465 7273 6563 7469   mask_intersecti
+000516b0: 6f6e 203d 2028 6d61 736b 5f69 6e74 6572  on = (mask_inter
+000516c0: 7365 6374 696f 6e20 2620 6d61 736b 290a  section & mask).
+000516d0: 2020 2020 2020 2020 2020 2020 6d61 736b              mask
+000516e0: 5f75 6e69 6f6e 203d 2028 6d61 736b 5f75  _union = (mask_u
+000516f0: 6e69 6f6e 207c 206d 6173 6b29 0a0a 2020  nion | mask)..  
+00051700: 2020 2020 2020 6369 2e63 6f6d 6d6f 6e20        ci.common 
+00051710: 3d20 6d61 736b 5f69 6e74 6572 7365 6374  = mask_intersect
+00051720: 696f 6e2e 7375 6d28 2920 2f20 6d61 736b  ion.sum() / mask
+00051730: 5f75 6e69 6f6e 2e73 756d 2829 0a0a 2020  _union.sum()..  
+00051740: 2020 7265 7475 726e 2067 6574 6174 7472    return getattr
+00051750: 2863 692c 2063 695f 7479 7065 2c20 6369  (ci, ci_type, ci
+00051760: 290a 0a64 6566 2067 6574 5f72 6f69 5f73  )..def get_roi_s
+00051770: 6c69 6365 2872 6f69 2c20 7a5f 6672 6163  lice(roi, z_frac
+00051780: 7469 6f6e 3d31 2c20 7375 6666 6978 3d4e  tion=1, suffix=N
+00051790: 6f6e 6529 3a0a 2020 2020 2222 220a 2020  one):.    """.  
+000517a0: 2020 4765 7420 524f 4920 6f62 6a65 6374    Get ROI object
+000517b0: 2063 6f72 7265 7370 6f6e 6469 6e67 2074   corresponding t
+000517c0: 6f20 782d 7920 736c 6963 6520 7468 726f  o x-y slice thro
+000517d0: 7567 6820 696e 7075 7420 524f 492e 0a0a  ugh input ROI...
+000517e0: 2020 2020 2a2a 5061 7261 6d65 7465 7273      **Parameters
+000517f0: 3a2a 2a0a 0a20 2020 2072 6f69 203a 2073  :**..    roi : s
+00051800: 6b72 742e 7374 7275 6374 7572 6573 2e52  krt.structures.R
+00051810: 4f49 0a20 2020 2020 2020 2052 4f49 206f  OI.        ROI o
+00051820: 626a 6563 7420 666f 7220 7768 6963 6820  bject for which 
+00051830: 736c 6963 6520 6973 2074 6f20 6265 206f  slice is to be o
+00051840: 6274 6169 6e65 642e 0a0a 2020 2020 7a5f  btained...    z_
+00051850: 6672 6163 7469 6f6e 203a 2066 6c6f 6174  fraction : float
+00051860: 2c20 6465 6661 756c 743d 310a 2020 2020  , default=1.    
+00051870: 2020 2020 506f 7369 7469 6f6e 2061 6c6f      Position alo
+00051880: 6e67 207a 2061 7869 7320 6174 2077 6869  ng z axis at whi
+00051890: 6368 2074 6f20 7461 6b65 2073 6c69 6365  ch to take slice
+000518a0: 2074 6872 6f75 6768 2052 4f49 2e0a 2020   through ROI..  
+000518b0: 2020 2020 2020 5468 6520 706f 7369 7469        The positi
+000518c0: 6f6e 2069 7320 7370 6563 6966 6965 6420  on is specified 
+000518d0: 6173 2074 6865 2066 7261 6374 696f 6e61  as the fractiona
+000518e0: 6c20 6469 7374 616e 6365 0a20 2020 2020  l distance.     
+000518f0: 2020 2066 726f 6d20 7468 6520 524f 4927     from the ROI'
+00051900: 7320 6d6f 7374 2d69 6e66 6572 696f 7220  s most-inferior 
+00051910: 706f 696e 743a 2030 2063 6f72 7265 7370  point: 0 corresp
+00051920: 6f6e 6473 2074 6f0a 2020 2020 2020 2020  onds to.        
+00051930: 7468 6520 6d6f 7374 2d69 6e66 6572 696f  the most-inferio
+00051940: 7220 706f 696e 7420 286c 6f77 6573 7420  r point (lowest 
+00051950: 7a29 3b20 3120 636f 7272 6573 706f 6e64  z); 1 correspond
+00051960: 7320 746f 2074 6865 0a20 2020 2020 2020  s to the.       
+00051970: 206d 6f73 742d 7375 7065 7269 6f72 2070   most-superior p
+00051980: 6f69 6e74 2028 6869 6768 6573 7420 7a29  oint (highest z)
+00051990: 2e20 2056 616c 7565 7320 666f 7220 7a5f  .  Values for z_
+000519a0: 6672 6163 7469 6f6e 0a20 2020 2020 2020  fraction.       
+000519b0: 206f 7574 7369 6465 2074 6865 2069 6e74   outside the int
+000519c0: 6572 7661 6c20 5b30 2c20 315d 2072 6573  erval [0, 1] res
+000519d0: 756c 7420 696e 2061 2052 756e 7469 6d65  ult in a Runtime
+000519e0: 4572 726f 722e 0a0a 2020 2020 7375 6666  Error...    suff
+000519f0: 6978 203a 2073 7472 2c20 6465 6661 756c  ix : str, defaul
+00051a00: 743d 4e6f 6e65 0a20 2020 2020 2020 2053  t=None.        S
+00051a10: 7566 6669 7820 746f 2061 7070 656e 6420  uffix to append 
+00051a20: 746f 206e 616d 6520 6f66 2069 6e70 7574  to name of input
+00051a30: 2052 4f49 2c20 746f 2066 6f72 6d20 6e61   ROI, to form na
+00051a40: 6d65 0a20 2020 2020 2020 206f 6620 6f75  me.        of ou
+00051a50: 7470 7574 2052 4f49 2e20 2049 6620 4e6f  tput ROI.  If No
+00051a60: 6e65 2c20 6170 7065 6e64 207a 5f66 7261  ne, append z_fra
+00051a70: 6374 696f 6e2c 2077 6974 6820 7661 6c75  ction, with valu
+00051a80: 650a 2020 2020 2020 2020 6769 7665 6e20  e.        given 
+00051a90: 746f 2074 776f 2064 6563 696d 616c 2070  to two decimal p
+00051aa0: 6c61 6365 732e 0a20 2020 2022 2222 0a20  laces..    """. 
+00051ab0: 2020 2023 2043 6865 636b 2074 6861 7420     # Check that 
+00051ac0: 7a5f 6672 6163 7469 6f6e 2069 7320 696e  z_fraction is in
+00051ad0: 2061 6c6c 6f77 6564 2069 6e74 6572 7661   allowed interva
+00051ae0: 6c2e 0a20 2020 2069 6620 7a5f 6672 6163  l..    if z_frac
+00051af0: 7469 6f6e 203c 2030 206f 7220 7a5f 6672  tion < 0 or z_fr
+00051b00: 6163 7469 6f6e 203e 2031 3a0a 2020 2020  action > 1:.    
+00051b10: 2020 2020 7261 6973 6520 5275 6e74 696d      raise Runtim
+00051b20: 6545 7272 6f72 2866 227a 5f66 7261 6374  eError(f"z_fract
+00051b30: 696f 6e3d 7b7a 5f66 7261 6374 696f 6e7d  ion={z_fraction}
+00051b40: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+00051b50: 2020 2020 2020 2020 2020 2020 2020 2220                " 
+00051b60: 6f75 7473 6964 6520 616c 6c6f 7765 6420  outside allowed 
+00051b70: 696e 7465 7276 616c 205b 302c 2031 5d22  interval [0, 1]"
+00051b80: 290a 0a20 2020 2023 2044 6574 6572 6d69  )..    # Determi
+00051b90: 6e65 2074 6865 2069 6e64 6578 206f 6620  ne the index of 
+00051ba0: 7468 6520 696d 6167 6520 736c 6963 6520  the image slice 
+00051bb0: 6174 2077 6869 6368 2074 6f20 7461 6b65  at which to take
+00051bc0: 2052 4f49 2073 6c69 6365 2e0a 2020 2020   ROI slice..    
+00051bd0: 706f 7331 2c20 706f 7332 203d 2072 6f69  pos1, pos2 = roi
+00051be0: 2e67 6574 5f65 7874 656e 7428 290a 2020  .get_extent().  
+00051bf0: 2020 706f 7320 3d20 706f 7331 202b 207a    pos = pos1 + z
+00051c00: 5f66 7261 6374 696f 6e20 2a20 2870 6f73  _fraction * (pos
+00051c10: 3220 2d20 706f 7331 290a 2020 2020 6964  2 - pos1).    id
+00051c20: 7820 3d20 726f 692e 706f 735f 746f 5f69  x = roi.pos_to_i
+00051c30: 6478 2870 6f73 2c20 227a 2229 0a0a 2020  dx(pos, "z")..  
+00051c40: 2020 2320 4f62 7461 696e 2063 6f6e 746f    # Obtain conto
+00051c50: 7572 7320 666f 7220 7265 7175 6972 6564  urs for required
+00051c60: 2073 6c69 6365 2c20 616e 6420 636f 6e76   slice, and conv
+00051c70: 6572 7420 746f 2052 4f49 206f 626a 6563  ert to ROI objec
+00051c80: 742e 0a20 2020 2063 6f6e 746f 7572 7320  t..    contours 
+00051c90: 3d20 726f 692e 6765 745f 636f 6e74 6f75  = roi.get_contou
+00051ca0: 7273 2869 6478 5f61 735f 6b65 793d 5472  rs(idx_as_key=Tr
+00051cb0: 7565 295b 6964 785d 0a20 2020 2072 6f69  ue)[idx].    roi
+00051cc0: 5f73 6c69 6365 203d 2052 4f49 287b 726f  _slice = ROI({ro
+00051cd0: 692e 6964 785f 746f 5f70 6f73 2869 6478  i.idx_to_pos(idx
+00051ce0: 2c20 227a 2229 3a20 636f 6e74 6f75 7273  , "z"): contours
+00051cf0: 7d29 0a0a 2020 2020 7375 6666 6978 203d  })..    suffix =
+00051d00: 2066 227b 7a5f 6672 6163 7469 6f6e 3a2e   f"{z_fraction:.
+00051d10: 3266 7d22 2069 6620 7375 6666 6978 2069  2f}" if suffix i
+00051d20: 7320 4e6f 6e65 2065 6c73 6520 7375 6666  s None else suff
+00051d30: 6978 0a20 2020 2069 6620 7375 6666 6978  ix.    if suffix
+00051d40: 3a0a 2020 2020 2020 2020 726f 695f 736c  :.        roi_sl
+00051d50: 6963 652e 6e61 6d65 203d 2066 227b 726f  ice.name = f"{ro
+00051d60: 692e 6e61 6d65 7d5f 7b73 7566 6669 787d  i.name}_{suffix}
+00051d70: 220a 2020 2020 656c 7365 3a0a 2020 2020  ".    else:.    
+00051d80: 2020 2020 726f 695f 736c 6963 652e 6e61      roi_slice.na
+00051d90: 6d65 203d 2073 7472 2872 6f69 2e6e 616d  me = str(roi.nam
+00051da0: 6529 0a0a 2020 2020 7265 7475 726e 2072  e)..    return r
+00051db0: 6f69 5f73 6c69 6365 0a0a 6465 6620 6765  oi_slice..def ge
+00051dc0: 745f 6d65 7472 6963 5f6d 6574 686f 6428  t_metric_method(
+00051dd0: 6d65 7472 6963 293a 0a20 2020 2022 2222  metric):.    """
+00051de0: 0a20 2020 204d 6170 2062 6574 7765 656e  .    Map between
+00051df0: 206d 6574 7269 6320 6964 656e 7469 6669   metric identifi
+00051e00: 6572 2061 7320 6c69 7374 6564 2069 6e20  er as listed in 
+00051e10: 6765 745f 636f 6d70 6172 6973 6f6e 5f6d  get_comparison_m
+00051e20: 6574 7269 6373 2829 0a20 2020 2061 6e64  etrics().    and
+00051e30: 206e 616d 6520 6f66 2052 4f49 206d 6574   name of ROI met
+00051e40: 686f 6420 666f 7220 6361 6c63 756c 6174  hod for calculat
+00051e50: 696e 6720 7468 6520 6d65 7472 6963 2e0a  ing the metric..
+00051e60: 2020 2020 0a20 2020 2054 6869 7320 6675      .    This fu
+00051e70: 6e63 7469 6f6e 2069 7320 7573 6564 2069  nction is used i
+00051e80: 6e20 524f 492e 6765 745f 6d65 7472 6963  n ROI.get_metric
+00051e90: 5f62 795f 736c 6963 6528 2920 746f 2064  _by_slice() to d
+00051ea0: 6574 6572 6d69 6e65 0a20 2020 2074 6865  etermine.    the
+00051eb0: 206d 6574 686f 6420 746f 2062 6520 6361   method to be ca
+00051ec0: 6c6c 6564 2066 6f72 2065 6163 6820 6d65  lled for each me
+00051ed0: 7472 6963 2e0a 2020 2020 2222 220a 2020  tric..    """.  
+00051ee0: 2020 2320 4b65 7973 2061 7265 206d 6574    # Keys are met
+00051ef0: 7269 6320 6964 656e 7469 6669 6572 733b  ric identifiers;
+00051f00: 2076 616c 7565 7320 6172 6520 6e61 6d65   values are name
+00051f10: 7320 6f66 2052 4f49 206d 6574 686f 6473  s of ROI methods
+00051f20: 0a20 2020 2023 2066 6f72 206d 6574 7269  .    # for metri
+00051f30: 6320 6361 6c63 756c 6174 696f 6e2e 0a20  c calculation.. 
+00051f40: 2020 2023 204d 6574 7269 6373 2061 7265     # Metrics are
+00051f50: 2069 6e63 6c75 6465 6420 696e 2074 6865   included in the
+00051f60: 2064 6963 7469 6f6e 6172 7920 6f6e 6c79   dictionary only
+00051f70: 2069 6620 6964 656e 7469 6669 6572 2061   if identifier a
+00051f80: 6e64 206d 6574 686f 640a 2020 2020 2320  nd method.    # 
+00051f90: 6e61 6d65 2061 7265 2064 6966 6665 7265  name are differe
+00051fa0: 6e74 2e0a 2020 2020 6d61 7070 696e 6773  nt..    mappings
+00051fb0: 203d 207b 0a20 2020 2020 2020 2020 2020   = {.           
+00051fc0: 2022 6162 735f 6365 6e74 726f 6964 223a   "abs_centroid":
+00051fd0: 2022 6162 735f 6365 6e74 726f 6964 5f64   "abs_centroid_d
+00051fe0: 6973 7461 6e63 6522 2c0a 2020 2020 2020  istance",.      
+00051ff0: 2020 2020 2020 2263 656e 7472 6f69 6422        "centroid"
+00052000: 3a20 2263 656e 7472 6f69 645f 6469 7374  : "centroid_dist
+00052010: 616e 6365 222c 0a20 2020 2020 2020 2020  ance",.         
+00052020: 2020 2022 7265 6c5f 6172 6561 5f64 6966     "rel_area_dif
+00052030: 6622 3a20 2272 656c 6174 6976 655f 6172  f": "relative_ar
+00052040: 6561 5f64 6966 6622 2c0a 2020 2020 2020  ea_diff",.      
+00052050: 2020 2020 2020 7d0a 2020 2020 7265 7475        }.    retu
+00052060: 726e 206d 6170 7069 6e67 732e 6765 7428  rn mappings.get(
+00052070: 6d65 7472 6963 2c20 6d65 7472 6963 290a  metric, metric).
+00052080: 0a64 6566 2067 6574 5f63 6f6d 7061 7269  .def get_compari
+00052090: 736f 6e5f 6d65 7472 6963 7328 6365 6e74  son_metrics(cent
+000520a0: 726f 6964 5f63 6f6d 706f 6e65 6e74 733d  roid_components=
+000520b0: 4661 6c73 652c 2073 6c69 6365 5f73 7461  False, slice_sta
+000520c0: 7473 3d4e 6f6e 652c 0a20 2020 2020 2020  ts=None,.       
+000520d0: 2064 6566 6175 6c74 5f62 795f 736c 6963   default_by_slic
+000520e0: 653d 4e6f 6e65 2c20 7669 6577 3d22 782d  e=None, view="x-
+000520f0: 7922 293a 0a20 2020 2022 2222 0a20 2020  y"):.    """.   
+00052100: 2047 6574 206c 6973 7420 6f66 2063 6f6d   Get list of com
+00052110: 7061 7269 736f 6e20 6d65 7472 6963 732e  parison metrics.
+00052120: 0a0a 2020 2020 416c 6c20 6d65 7472 6963  ..    All metric
+00052130: 7320 6c69 7374 6564 2068 6572 6520 7368  s listed here sh
+00052140: 6f75 6c64 2062 6520 7265 636f 676e 6973  ould be recognis
+00052150: 6564 2062 7920 524f 492e 6765 745f 636f  ed by ROI.get_co
+00052160: 6d70 6172 6973 6f6e 2829 2c0a 2020 2020  mparison(),.    
+00052170: 616e 6420 616c 6c20 6d65 7472 6963 7320  and all metrics 
+00052180: 7265 636f 676e 6973 6564 2062 7920 524f  recognised by RO
+00052190: 492e 6765 745f 636f 6d70 6172 6973 6f6e  I.get_comparison
+000521a0: 2829 2073 686f 756c 6420 6265 206c 6973  () should be lis
+000521b0: 7465 6420 6865 7265 2e0a 0a20 2020 202a  ted here...    *
+000521c0: 2a50 6172 616d 6574 6572 733a 2a2a 0a0a  *Parameters:**..
+000521d0: 2020 2020 6365 6e74 726f 6964 5f63 6f6d      centroid_com
+000521e0: 706f 6e65 6e74 7320 3a20 626f 6f6c 2c20  ponents : bool, 
+000521f0: 6465 6661 756c 743d 4661 6c73 650a 2020  default=False.  
+00052200: 2020 2020 2020 4966 2054 7275 652c 2072        If True, r
+00052210: 6570 6c61 6365 206d 6574 7269 6373 2022  eplace metrics "
+00052220: 6365 6e74 726f 6964 2220 616e 6420 2263  centroid" and "c
+00052230: 656e 7472 6f69 645f 736c 6963 6522 2062  entroid_slice" b
+00052240: 7920 7468 650a 2020 2020 2020 2020 6d65  y the.        me
+00052250: 7472 6963 7320 666f 7220 7468 6569 7220  trics for their 
+00052260: 636f 6d70 6f6e 656e 7473 2e0a 0a20 2020  components...   
+00052270: 2073 6c69 6365 5f73 7461 7473 203a 2073   slice_stats : s
+00052280: 7472 2f6c 6973 742f 6469 6374 2c20 6465  tr/list/dict, de
+00052290: 6661 756c 743d 4e6f 6e65 0a20 2020 2020  fault=None.     
+000522a0: 2020 2053 7065 6369 6669 6361 7469 6f6e     Specification
+000522b0: 206f 6620 7374 6174 6973 7469 6373 2074   of statistics t
+000522c0: 6f20 6265 2063 616c 6375 6c61 7465 6420  o be calculated 
+000522d0: 7265 6c61 7469 7665 0a20 2020 2020 2020  relative.       
+000522e0: 2074 6f20 736c 6963 652d 6279 2d73 6c69   to slice-by-sli
+000522f0: 6365 206d 6574 7269 6320 7661 6c75 6573  ce metric values
+00052300: 2e0a 0a20 2020 2020 2020 2041 2073 7461  ...        A sta
+00052310: 7469 7374 6963 2069 7320 7370 6563 6966  tistic is specif
+00052320: 6965 6420 6279 2074 6865 206e 616d 6520  ied by the name 
+00052330: 6f66 2074 6865 2066 756e 6374 696f 6e20  of the function 
+00052340: 666f 720a 2020 2020 2020 2020 6974 7320  for.        its 
+00052350: 6361 6c63 756c 6174 696f 6e20 696e 2074  calculation in t
+00052360: 6865 2050 7974 686f 6e20 7374 6174 6973  he Python statis
+00052370: 7469 6373 206d 6f64 756c 653a 0a0a 2020  tics module:..  
+00052380: 2020 2020 2020 6874 7470 733a 2f2f 646f        https://do
+00052390: 6373 2e70 7974 686f 6e2e 6f72 672f 332f  cs.python.org/3/
+000523a0: 6c69 6272 6172 792f 7374 6174 6973 7469  library/statisti
+000523b0: 6373 2e68 746d 6c0a 0a20 2020 2020 2020  cs.html..       
+000523c0: 2046 6f72 2069 7473 2075 7365 2068 6572   For its use her
+000523d0: 652c 2074 6865 2072 656c 6576 616e 7420  e, the relevant 
+000523e0: 6675 6e63 7469 6f6e 206d 7573 7420 7265  function must re
+000523f0: 7175 6972 650a 2020 2020 2020 2020 6120  quire.        a 
+00052400: 7369 6e67 6c65 2d76 6172 6961 626c 6520  single-variable 
+00052410: 696e 7075 742c 206d 7573 7420 6e6f 7420  input, must not 
+00052420: 7265 7175 6972 6520 616e 7920 6b65 7977  require any keyw
+00052430: 6f72 640a 2020 2020 2020 2020 6172 6775  ord.        argu
+00052440: 6d65 6e74 732c 2061 6e64 206d 7573 7420  ments, and must 
+00052450: 7265 7475 726e 2061 2073 696e 676c 6520  return a single 
+00052460: 6e75 6d62 6572 2e0a 0a20 2020 2020 2020  number...       
+00052470: 2041 7661 696c 6162 6c65 206f 7074 696f   Available optio
+00052480: 6e73 2069 6e63 6c75 6465 3a20 226d 6561  ns include: "mea
+00052490: 6e22 2c20 226d 6564 6961 6e22 2c20 226d  n", "median", "m
+000524a0: 6f64 6522 2c0a 2020 2020 2020 2020 2273  ode",.        "s
+000524b0: 7464 6576 222e 0a0a 2020 2020 2020 2053  tdev"...       S
+000524c0: 7461 7469 7374 6963 7320 746f 2062 6520  tatistics to be 
+000524d0: 6361 6c63 756c 6174 6564 2063 616e 2062  calculated can b
+000524e0: 6520 7370 6563 6966 6965 6420 7573 696e  e specified usin
+000524f0: 6720 616e 7920 6f66 0a20 2020 2020 2020  g any of.       
+00052500: 7468 6520 666f 6c6c 6f77 696e 673a 0a0a  the following:..
+00052510: 2020 2020 2020 202d 2053 7472 696e 6720         - String 
+00052520: 7370 6563 6966 7969 6e67 2073 696e 676c  specifying singl
+00052530: 6520 7374 6174 6973 7469 6320 746f 2062  e statistic to b
+00052540: 6520 6361 6c63 756c 6174 6564 2c0a 2020  e calculated,.  
+00052550: 2020 2020 2020 2077 6974 6820 736c 6963         with slic
+00052560: 6573 2063 6f6e 7369 6465 7265 6420 6173  es considered as
+00052570: 2067 6976 656e 2062 7920 3c64 6566 6175   given by <defau
+00052580: 6c74 5f62 795f 736c 6963 653e 2c0a 2020  lt_by_slice>,.  
+00052590: 2020 2020 2020 2066 6f72 2065 7861 6d70         for examp
+000525a0: 6c65 3a20 226d 6561 6e22 3b0a 2020 2020  le: "mean";.    
+000525b0: 2020 202d 204c 6973 7420 7370 6563 6966     - List specif
+000525c0: 7969 6e67 206d 756c 7469 706c 6520 7374  ying multiple st
+000525d0: 6174 6973 7469 6373 2074 6f20 6265 2063  atistics to be c
+000525e0: 616c 6375 6c61 7465 642c 0a20 2020 2020  alculated,.     
+000525f0: 2020 2020 7769 7468 2073 6c69 6365 7320      with slices 
+00052600: 636f 6e73 6964 6572 6564 2061 7320 6769  considered as gi
+00052610: 7665 6e20 6279 203c 6465 6661 756c 745f  ven by <default_
+00052620: 6279 5f73 6c69 6365 3e2c 0a20 2020 2020  by_slice>,.     
+00052630: 2020 2020 666f 7220 6578 616d 706c 653a      for example:
+00052640: 205b 226d 6561 6e22 2c20 2273 7464 6576   ["mean", "stdev
+00052650: 225d 3b0a 2020 2020 2020 202d 2044 6963  "];.       - Dic
+00052660: 7469 6f6e 6172 7920 7768 6572 6520 6b65  tionary where ke
+00052670: 7973 2073 7065 6369 6679 2073 6c69 6365  ys specify slice
+00052680: 7320 746f 2062 6520 636f 6e73 6964 6572  s to be consider
+00052690: 6564 2c0a 2020 2020 2020 2020 2061 6e64  ed,.         and
+000526a0: 2076 616c 7565 7320 7370 6563 6966 7920   values specify 
+000526b0: 7374 6174 6973 7469 6373 2028 7374 7269  statistics (stri
+000526c0: 6e67 206f 7220 6c69 7374 292c 2066 6f72  ng or list), for
+000526d0: 0a20 2020 2020 2020 2020 6578 616d 706c  .         exampl
+000526e0: 653a 207b 2275 6e69 6f6e 223a 205b 226d  e: {"union": ["m
+000526f0: 6561 6e22 2c20 2273 7464 6576 225d 7d2e  ean", "stdev"]}.
+00052700: 2020 5661 6c69 6420 736c 6963 650a 2020    Valid slice.  
+00052710: 2020 2020 2020 2073 7065 6369 6669 6361         specifica
+00052720: 7469 6f6e 7320 6172 6520 6173 206c 6973  tions are as lis
+00052730: 7465 6420 666f 7220 3c64 6566 6175 6c74  ted for <default
+00052740: 5f62 795f 736c 6963 653e 2e0a 0a20 2020  _by_slice>...   
+00052750: 2064 6566 6175 6c74 5f62 795f 736c 6963   default_by_slic
+00052760: 653a 2073 7472 2c20 6465 6661 756c 743d  e: str, default=
+00052770: 4e6f 6e65 0a20 2020 2020 2020 2044 6566  None.        Def
+00052780: 6175 6c74 2073 7065 6369 6669 6361 7469  ault specificati
+00052790: 6f6e 206f 6620 736c 6963 6573 2074 6f20  on of slices to 
+000527a0: 6265 2063 6f6e 7369 6465 7265 6420 7768  be considered wh
+000527b0: 656e 0a20 2020 2020 2020 2063 616c 6375  en.        calcu
+000527c0: 6c61 7469 6e67 2073 6c69 6365 2d62 792d  lating slice-by-
+000527d0: 736c 6963 6520 7374 6174 6973 7469 6373  slice statistics
+000527e0: 2066 6f72 2061 206d 6574 7269 6320 636f   for a metric co
+000527f0: 6d70 6172 696e 670a 2020 2020 2020 2020  mparing.        
+00052800: 7477 6f20 524f 4973 2c20 726f 6931 2061  two ROIs, roi1 a
+00052810: 6e64 2072 6f69 322e 2020 5468 6520 7661  nd roi2.  The va
+00052820: 6c69 6420 7370 6563 6966 6963 6174 696f  lid specificatio
+00052830: 6e73 2061 7265 3a0a 0a20 2020 2020 2020  ns are:..       
+00052840: 202d 2022 6c65 6674 223a 2063 6f6e 7369   - "left": consi
+00052850: 6465 7220 6f6e 6c79 2073 6c69 6365 7320  der only slices 
+00052860: 636f 6e74 6169 6e69 6e67 2072 6f69 313b  containing roi1;
+00052870: 0a20 2020 2020 2020 202d 2022 7269 6768  .        - "righ
+00052880: 7422 3a20 636f 6e73 6964 6572 206f 6e6c  t": consider onl
+00052890: 7920 736c 6963 6573 2063 6f6e 7461 696e  y slices contain
+000528a0: 696e 6720 726f 6932 3b0a 2020 2020 2020  ing roi2;.      
+000528b0: 2020 2d20 2275 6e69 6f6e 223a 2063 6f6e    - "union": con
+000528c0: 7369 6465 7220 736c 6963 6573 2063 6f6e  sider slices con
+000528d0: 7461 696e 696e 6720 6569 7468 6572 206f  taining either o
+000528e0: 6620 726f 6931 2061 6e64 2072 6f69 323b  f roi1 and roi2;
+000528f0: 0a20 2020 2020 2020 202d 2022 696e 7465  .        - "inte
+00052900: 7273 6563 7469 6f6e 223a 2063 6f6e 7369  rsection": consi
+00052910: 6465 7220 736c 6963 6573 2063 6f6e 7461  der slices conta
+00052920: 696e 696e 6720 626f 7468 2072 6f69 3120  ining both roi1 
+00052930: 616e 6420 726f 6932 2e0a 0a20 2020 2020  and roi2...     
+00052940: 2020 2049 6620 4e6f 6e65 2c20 7573 6520     If None, use 
+00052950: 736b 7274 2e63 6f72 652e 4465 6661 756c  skrt.core.Defaul
+00052960: 7473 2829 2e62 795f 736c 6963 650a 0a20  ts().by_slice.. 
+00052970: 2020 2020 2020 2076 6965 7720 3a20 7374         view : st
+00052980: 722c 2064 6566 6175 6c74 3d22 782d 7922  r, default="x-y"
+00052990: 0a20 2020 2020 2020 2020 2020 204f 7269  .            Ori
+000529a0: 656e 7461 7469 6f6e 2074 6f20 636f 6e73  entation to cons
+000529b0: 6964 6572 2077 6865 6e20 7461 6b69 6e67  ider when taking
+000529c0: 2063 656e 7472 6f69 6420 636f 6d70 6f6e   centroid compon
+000529d0: 656e 7473 2072 656c 6174 6976 650a 2020  ents relative.  
+000529e0: 2020 2020 2020 2020 2020 746f 2061 2073            to a s
+000529f0: 6c69 6365 2e20 2043 616e 2062 6520 2278  lice.  Can be "x
+00052a00: 2d79 222c 2022 792d 7a22 2c20 6f72 2022  -y", "y-z", or "
+00052a10: 782d 7a22 2e0a 2020 2020 2222 220a 2020  x-z"..    """.  
+00052a20: 2020 6d65 7472 6963 7320 3d20 5b0a 2020    metrics = [.  
+00052a30: 2020 2020 2020 2020 2020 2261 6273 5f63            "abs_c
+00052a40: 656e 7472 6f69 6422 2c0a 2020 2020 2020  entroid",.      
+00052a50: 2020 2020 2020 2261 6273 5f63 656e 7472        "abs_centr
+00052a60: 6f69 645f 666c 6174 222c 0a20 2020 2020  oid_flat",.     
+00052a70: 2020 2020 2020 2022 6162 735f 6365 6e74         "abs_cent
+00052a80: 726f 6964 5f73 6c69 6365 222c 0a20 2020  roid_slice",.   
+00052a90: 2020 2020 2020 2020 2022 6162 735f 6365           "abs_ce
+00052aa0: 6e74 726f 6964 5f73 6c69 6365 5f73 7461  ntroid_slice_sta
+00052ab0: 7473 222c 0a20 2020 2020 2020 2020 2020  ts",.           
+00052ac0: 2022 6172 6561 5f64 6966 6622 2c0a 2020   "area_diff",.  
+00052ad0: 2020 2020 2020 2020 2020 2261 7265 615f            "area_
+00052ae0: 6469 6666 5f66 6c61 7422 2c0a 2020 2020  diff_flat",.    
+00052af0: 2020 2020 2020 2020 2261 7265 615f 6469          "area_di
+00052b00: 6666 5f73 6c69 6365 5f73 7461 7473 222c  ff_slice_stats",
+00052b10: 0a20 2020 2020 2020 2020 2020 2022 6172  .            "ar
+00052b20: 6561 5f72 6174 696f 222c 0a20 2020 2020  ea_ratio",.     
+00052b30: 2020 2020 2020 2022 6172 6561 5f72 6174         "area_rat
+00052b40: 696f 5f66 6c61 7422 2c0a 2020 2020 2020  io_flat",.      
+00052b50: 2020 2020 2020 2261 7265 615f 7261 7469        "area_rati
+00052b60: 6f5f 736c 6963 655f 7374 6174 7322 2c0a  o_slice_stats",.
+00052b70: 2020 2020 2020 2020 2020 2020 2263 656e              "cen
+00052b80: 7472 6f69 6422 2c0a 2020 2020 2020 2020  troid",.        
+00052b90: 2020 2020 2263 656e 7472 6f69 645f 736c      "centroid_sl
+00052ba0: 6963 6522 2c0a 2020 2020 2020 2020 2020  ice",.          
+00052bb0: 2020 2263 656e 7472 6f69 645f 736c 6963    "centroid_slic
+00052bc0: 655f 7374 6174 7322 2c0a 2020 2020 2020  e_stats",.      
+00052bd0: 2020 2020 2020 2264 6963 6522 2c0a 2020        "dice",.  
+00052be0: 2020 2020 2020 2020 2020 2264 6963 655f            "dice_
+00052bf0: 666c 6174 222c 0a20 2020 2020 2020 2020  flat",.         
+00052c00: 2020 2022 6469 6365 5f73 6c69 6365 222c     "dice_slice",
+00052c10: 0a20 2020 2020 2020 2020 2020 2022 6469  .            "di
+00052c20: 6365 5f73 6c69 6365 5f73 7461 7473 222c  ce_slice_stats",
+00052c30: 0a20 2020 2020 2020 2020 2020 2022 6861  .            "ha
+00052c40: 7573 646f 7266 665f 6469 7374 616e 6365  usdorff_distance
+00052c50: 222c 0a20 2020 2020 2020 2020 2020 2022  ",.            "
+00052c60: 6861 7573 646f 7266 665f 6469 7374 616e  hausdorff_distan
+00052c70: 6365 5f66 6c61 7422 2c0a 2020 2020 2020  ce_flat",.      
+00052c80: 2020 2020 2020 226a 6163 6361 7264 222c        "jaccard",
+00052c90: 0a20 2020 2020 2020 2020 2020 2022 6a61  .            "ja
+00052ca0: 6363 6172 645f 666c 6174 222c 0a20 2020  ccard_flat",.   
+00052cb0: 2020 2020 2020 2020 2022 6a61 6363 6172           "jaccar
+00052cc0: 645f 736c 6963 6522 2c0a 2020 2020 2020  d_slice",.      
+00052cd0: 2020 2020 2020 226a 6163 6361 7264 5f73        "jaccard_s
+00052ce0: 6c69 6365 5f73 7461 7473 222c 0a20 2020  lice_stats",.   
+00052cf0: 2020 2020 2020 2020 2022 6d65 616e 5f64           "mean_d
+00052d00: 6973 7461 6e63 655f 746f 5f63 6f6e 666f  istance_to_confo
+00052d10: 726d 6974 7922 2c0a 2020 2020 2020 2020  rmity",.        
+00052d20: 2020 2020 226d 6561 6e5f 6469 7374 616e      "mean_distan
+00052d30: 6365 5f74 6f5f 636f 6e66 6f72 6d69 7479  ce_to_conformity
+00052d40: 5f66 6c61 7422 2c0a 2020 2020 2020 2020  _flat",.        
+00052d50: 2020 2020 226d 6561 6e5f 7369 676e 6564      "mean_signed
+00052d60: 5f73 7572 6661 6365 5f64 6973 7461 6e63  _surface_distanc
+00052d70: 6522 2c0a 2020 2020 2020 2020 2020 2020  e",.            
+00052d80: 226d 6561 6e5f 7369 676e 6564 5f73 7572  "mean_signed_sur
+00052d90: 6661 6365 5f64 6973 7461 6e63 655f 666c  face_distance_fl
+00052da0: 6174 222c 0a20 2020 2020 2020 2020 2020  at",.           
+00052db0: 2022 6d65 616e 5f73 7572 6661 6365 5f64   "mean_surface_d
+00052dc0: 6973 7461 6e63 6522 2c0a 2020 2020 2020  istance",.      
+00052dd0: 2020 2020 2020 226d 6561 6e5f 7375 7266        "mean_surf
+00052de0: 6163 655f 6469 7374 616e 6365 5f66 6c61  ace_distance_fla
+00052df0: 7422 2c0a 2020 2020 2020 2020 2020 2020  t",.            
+00052e00: 226d 6561 6e5f 6f76 6572 5f63 6f6e 746f  "mean_over_conto
+00052e10: 7572 696e 6722 2c0a 2020 2020 2020 2020  uring",.        
+00052e20: 2020 2020 226d 6561 6e5f 6f76 6572 5f63      "mean_over_c
+00052e30: 6f6e 746f 7572 696e 675f 666c 6174 222c  ontouring_flat",
+00052e40: 0a20 2020 2020 2020 2020 2020 2022 6d65  .            "me
+00052e50: 616e 5f75 6e64 6572 5f63 6f6e 746f 7572  an_under_contour
+00052e60: 696e 6722 2c0a 2020 2020 2020 2020 2020  ing",.          
+00052e70: 2020 226d 6561 6e5f 756e 6465 725f 636f    "mean_under_co
+00052e80: 6e74 6f75 7269 6e67 5f66 6c61 7422 2c0a  ntouring_flat",.
+00052e90: 2020 2020 2020 2020 2020 2020 2272 656c              "rel
+00052ea0: 5f61 7265 615f 6469 6666 222c 0a20 2020  _area_diff",.   
+00052eb0: 2020 2020 2020 2020 2022 7265 6c5f 6172           "rel_ar
+00052ec0: 6561 5f64 6966 665f 666c 6174 222c 0a20  ea_diff_flat",. 
+00052ed0: 2020 2020 2020 2020 2020 2022 7265 6c5f             "rel_
+00052ee0: 6172 6561 5f64 6966 665f 736c 6963 655f  area_diff_slice_
+00052ef0: 7374 6174 7322 2c0a 2020 2020 2020 2020  stats",.        
+00052f00: 2020 2020 2272 656c 5f76 6f6c 756d 655f      "rel_volume_
+00052f10: 6469 6666 222c 0a20 2020 2020 2020 2020  diff",.         
+00052f20: 2020 2022 726d 735f 7369 676e 6564 5f73     "rms_signed_s
+00052f30: 7572 6661 6365 5f64 6973 7461 6e63 6522  urface_distance"
+00052f40: 2c0a 2020 2020 2020 2020 2020 2020 2272  ,.            "r
+00052f50: 6d73 5f73 6967 6e65 645f 7375 7266 6163  ms_signed_surfac
+00052f60: 655f 6469 7374 616e 6365 5f66 6c61 7422  e_distance_flat"
+00052f70: 2c0a 2020 2020 2020 2020 2020 2020 2272  ,.            "r
+00052f80: 6d73 5f73 7572 6661 6365 5f64 6973 7461  ms_surface_dista
+00052f90: 6e63 6522 2c0a 2020 2020 2020 2020 2020  nce",.          
+00052fa0: 2020 2272 6d73 5f73 7572 6661 6365 5f64    "rms_surface_d
+00052fb0: 6973 7461 6e63 655f 666c 6174 222c 0a20  istance_flat",. 
+00052fc0: 2020 2020 2020 2020 2020 2022 766f 6c75             "volu
+00052fd0: 6d65 5f64 6966 6622 2c0a 2020 2020 2020  me_diff",.      
+00052fe0: 2020 2020 2020 2276 6f6c 756d 655f 7261        "volume_ra
+00052ff0: 7469 6f22 2c0a 2020 2020 2020 2020 2020  tio",.          
+00053000: 2020 5d0a 0a20 2020 2023 2052 6570 6c61    ]..    # Repla
+00053010: 6365 2063 656e 7472 6f69 6420 7665 6374  ce centroid vect
+00053020: 6f72 7320 6279 2063 6f6d 706f 6e65 6e74  ors by component
+00053030: 732e 0a20 2020 2069 6620 6365 6e74 726f  s..    if centro
+00053040: 6964 5f63 6f6d 706f 6e65 6e74 733a 0a20  id_components:. 
+00053050: 2020 2020 2020 2063 656e 7472 6f69 6473         centroids
+00053060: 203d 207b 0a20 2020 2020 2020 2020 2020   = {.           
+00053070: 2020 2020 2022 6365 6e74 726f 6964 223a       "centroid":
+00053080: 205b 2263 656e 7472 6f69 645f 7822 2c20   ["centroid_x", 
+00053090: 2263 656e 7472 6f69 645f 7922 2c20 2263  "centroid_y", "c
+000530a0: 656e 7472 6f69 645f 7a22 5d2c 0a20 2020  entroid_z"],.   
+000530b0: 2020 2020 2020 2020 2020 2020 2022 6365               "ce
+000530c0: 6e74 726f 6964 5f73 6c69 6365 223a 205b  ntroid_slice": [
+000530d0: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
+000530e0: 2020 7d0a 2020 2020 2020 2020 6966 2073    }.        if s
+000530f0: 6c69 6365 5f73 7461 7473 2069 7320 6e6f  lice_stats is no
+00053100: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
+00053110: 2020 2020 6365 6e74 726f 6964 735b 2263      centroids["c
+00053120: 656e 7472 6f69 645f 736c 6963 655f 7374  entroid_slice_st
+00053130: 6174 7322 5d20 3d20 5b5d 0a0a 2020 2020  ats"] = []..    
+00053140: 2020 2020 666f 7220 695f 6178 2069 6e20      for i_ax in 
+00053150: 736b 7274 2e69 6d61 6765 2e5f 706c 6f74  skrt.image._plot
+00053160: 5f61 7865 735b 7669 6577 5d3a 0a20 2020  _axes[view]:.   
+00053170: 2020 2020 2020 2020 2061 7820 3d20 736b           ax = sk
+00053180: 7274 2e69 6d61 6765 2e5f 6178 6573 5b69  rt.image._axes[i
+00053190: 5f61 785d 0a20 2020 2020 2020 2020 2020  _ax].           
+000531a0: 2063 656e 7472 6f69 6473 5b22 6365 6e74   centroids["cent
+000531b0: 726f 6964 5f73 6c69 6365 225d 2e61 7070  roid_slice"].app
+000531c0: 656e 6428 6622 6365 6e74 726f 6964 5f73  end(f"centroid_s
+000531d0: 6c69 6365 5f7b 6178 7d22 290a 0a20 2020  lice_{ax}")..   
+000531e0: 2020 2020 2020 2020 2069 6620 736c 6963           if slic
+000531f0: 655f 7374 6174 7320 6973 206e 6f74 204e  e_stats is not N
+00053200: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+00053210: 2020 2020 2063 656e 7472 6f69 6473 5b22       centroids["
+00053220: 6365 6e74 726f 6964 5f73 6c69 6365 5f73  centroid_slice_s
+00053230: 7461 7473 225d 2e61 7070 656e 6428 0a20  tats"].append(. 
+00053240: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00053250: 2020 2020 2020 2066 2263 656e 7472 6f69         f"centroi
+00053260: 645f 7b61 787d 5f73 6c69 6365 5f73 7461  d_{ax}_slice_sta
+00053270: 7473 2229 0a0a 2020 2020 2020 2020 666f  ts")..        fo
+00053280: 7220 7665 6374 6f72 2c20 636f 6d70 6f6e  r vector, compon
+00053290: 656e 7473 2069 6e20 6365 6e74 726f 6964  ents in centroid
+000532a0: 732e 6974 656d 7328 293a 0a20 2020 2020  s.items():.     
+000532b0: 2020 2020 2020 2069 6478 203d 206d 6574         idx = met
+000532c0: 7269 6373 2e69 6e64 6578 2876 6563 746f  rics.index(vecto
+000532d0: 7229 0a20 2020 2020 2020 2020 2020 206d  r).            m
+000532e0: 6574 7269 6373 5b69 6478 203a 2069 6478  etrics[idx : idx
+000532f0: 202b 2031 5d20 3d20 636f 6d70 6f6e 656e   + 1] = componen
+00053300: 7473 0a0a 2020 2020 2320 5265 6d6f 7665  ts..    # Remove
+00053310: 206d 6574 7269 6373 2077 6974 6820 7375   metrics with su
+00053320: 6666 6978 2022 736c 6963 655f 7374 6174  ffix "slice_stat
+00053330: 7322 2c0a 2020 2020 2320 616e 6420 7265  s",.    # and re
+00053340: 706c 6163 6520 7769 7468 2073 7065 6369  place with speci
+00053350: 6669 6320 6d65 7472 6963 7320 7265 6c61  fic metrics rela
+00053360: 7469 6e67 2074 6f20 736c 6963 652d 6279  ting to slice-by
+00053370: 2d73 6c69 6365 2073 7461 7469 7374 6963  -slice statistic
+00053380: 732e 0a20 2020 2069 6620 736c 6963 655f  s..    if slice_
+00053390: 7374 6174 7320 6973 206e 6f74 204e 6f6e  stats is not Non
+000533a0: 653a 0a20 2020 2020 2020 2073 6c69 6365  e:.        slice
+000533b0: 5f73 7461 7473 5f6d 6574 7269 6373 203d  _stats_metrics =
+000533c0: 205b 5d0a 2020 2020 2020 2020 6d65 7472   [].        metr
+000533d0: 6963 7332 203d 205b 5d0a 2020 2020 2020  ics2 = [].      
+000533e0: 2020 666f 7220 6d65 7472 6963 2069 6e20    for metric in 
+000533f0: 6d65 7472 6963 733a 0a20 2020 2020 2020  metrics:.       
+00053400: 2020 2020 2069 6620 2273 6c69 6365 5f73       if "slice_s
+00053410: 7461 7473 2220 696e 206d 6574 7269 633a  tats" in metric:
+00053420: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00053430: 2073 6c69 6365 5f73 7461 7473 5f6d 6574   slice_stats_met
+00053440: 7269 6373 2e61 7070 656e 6428 6d65 7472  rics.append(metr
+00053450: 6963 2e73 706c 6974 2822 5f73 6c69 6365  ic.split("_slice
+00053460: 5f73 7461 7473 2229 5b30 5d29 0a20 2020  _stats")[0]).   
+00053470: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+00053480: 2020 2020 2020 2020 2020 2020 2020 206d                 m
+00053490: 6574 7269 6373 322e 6170 7065 6e64 286d  etrics2.append(m
+000534a0: 6574 7269 6329 0a0a 2020 2020 2020 2020  etric)..        
+000534b0: 666f 7220 6279 5f73 6c69 6365 2c20 7374  for by_slice, st
+000534c0: 6174 7320 696e 2028 0a20 2020 2020 2020  ats in (.       
+000534d0: 2020 2020 2020 2020 2065 7870 616e 645f           expand_
+000534e0: 736c 6963 655f 7374 6174 7328 736c 6963  slice_stats(slic
+000534f0: 655f 7374 6174 732c 2064 6566 6175 6c74  e_stats, default
+00053500: 5f62 795f 736c 6963 6529 2e69 7465 6d73  _by_slice).items
+00053510: 2829 293a 0a20 2020 2020 2020 2020 2020  ()):.           
+00053520: 2066 6f72 206d 6574 7269 6320 696e 2073   for metric in s
+00053530: 6c69 6365 5f73 7461 7473 5f6d 6574 7269  lice_stats_metri
+00053540: 6373 3a0a 2020 2020 2020 2020 2020 2020  cs:.            
+00053550: 2020 2020 666f 7220 7374 6174 2069 6e20      for stat in 
+00053560: 7374 6174 733a 0a20 2020 2020 2020 2020  stats:.         
+00053570: 2020 2020 2020 2020 2020 206d 6574 7269             metri
+00053580: 6373 322e 6170 7065 6e64 2866 227b 6d65  cs2.append(f"{me
+00053590: 7472 6963 7d5f 736c 6963 655f 7b62 795f  tric}_slice_{by_
+000535a0: 736c 6963 657d 5f7b 7374 6174 7d22 290a  slice}_{stat}").
+000535b0: 2020 2020 2020 2020 6d65 7472 6963 7320          metrics 
+000535c0: 3d20 6d65 7472 6963 7332 0a0a 2020 2020  = metrics2..    
+000535d0: 7265 7475 726e 2073 6f72 7465 6428 6d65  return sorted(me
+000535e0: 7472 6963 7329 0a0a 6465 6620 6765 745f  trics)..def get_
+000535f0: 636f 6e73 656e 7375 735f 7479 7065 7328  consensus_types(
+00053600: 293a 0a20 2020 2022 2222 0a20 2020 2047  ):.    """.    G
+00053610: 6574 206c 6973 7420 6f66 2063 6f6e 7365  et list of conse
+00053620: 6e73 7573 2074 7970 6573 2e0a 0a20 2020  nsus types...   
+00053630: 2041 6c6c 2063 6f6e 7365 6e73 7573 2074   All consensus t
+00053640: 7970 6573 206c 6973 7465 6420 6865 7265  ypes listed here
+00053650: 2073 686f 756c 6420 6265 2072 6563 6f67   should be recog
+00053660: 6e69 7365 6420 6279 0a20 2020 2053 7472  nised by.    Str
+00053670: 7563 7475 7265 5365 742e 6765 745f 636f  uctureSet.get_co
+00053680: 6e73 656e 7375 7328 292c 2061 6e64 2061  nsensus(), and a
+00053690: 6c6c 2063 6f6e 7365 6e73 7573 2074 7970  ll consensus typ
+000536a0: 6573 2072 6563 6f67 6e69 7365 640a 2020  es recognised.  
+000536b0: 2020 6279 2053 7472 7563 7475 7265 5365    by StructureSe
+000536c0: 742e 6765 745f 636f 6e73 656e 7375 7320  t.get_consensus 
+000536d0: 7368 6f75 6c64 2062 6520 6c69 7374 6564  should be listed
+000536e0: 2068 6572 652e 0a20 2020 2022 2222 0a20   here..    """. 
+000536f0: 2020 2072 6574 7572 6e20 5b0a 2020 2020     return [.    
+00053700: 2020 2020 2020 2020 226d 616a 6f72 6974          "majorit
+00053710: 7922 2c0a 2020 2020 2020 2020 2020 2020  y",.            
+00053720: 226f 7665 726c 6170 222c 0a20 2020 2020  "overlap",.     
+00053730: 2020 2020 2020 2022 7374 6170 6c65 222c         "staple",
+00053740: 0a20 2020 2020 2020 2020 2020 2022 7375  .            "su
+00053750: 6d22 2c0a 2020 2020 2020 2020 2020 2020  m",.            
+00053760: 5d0a 0a64 6566 2067 6574 5f62 795f 736c  ]..def get_by_sl
+00053770: 6963 655f 6d65 7468 6f64 7328 293a 0a20  ice_methods():. 
+00053780: 2020 2022 2222 0a20 2020 2047 6574 206c     """.    Get l
+00053790: 6973 7420 6f66 206d 6574 686f 6473 2066  ist of methods f
+000537a0: 6f72 2064 6566 696e 696e 6720 736c 6963  or defining slic
+000537b0: 6573 2074 6f20 6265 2063 6f6e 7369 6465  es to be conside
+000537c0: 7265 640a 2020 2020 666f 7220 736c 6963  red.    for slic
+000537d0: 652d 6279 2d73 6c69 6365 2052 4f49 2063  e-by-slice ROI c
+000537e0: 6f6d 7061 7269 736f 6e73 2e0a 2020 2020  omparisons..    
+000537f0: 2222 220a 2020 2020 7265 7475 726e 205b  """.    return [
+00053800: 226c 6566 7422 2c20 2272 6967 6874 222c  "left", "right",
+00053810: 2022 756e 696f 6e22 2c20 2269 6e74 6572   "union", "inter
+00053820: 7365 6374 696f 6e22 5d0a 0a64 6566 2067  section"]..def g
+00053830: 6574 5f61 6c6c 5f72 6f69 7328 6f62 6a73  et_all_rois(objs
+00053840: 3d4e 6f6e 6529 3a0a 2020 2020 2222 220a  =None):.    """.
+00053850: 2020 2020 4372 6561 7465 206c 6973 7420      Create list 
+00053860: 6f66 2052 4f49 7320 6672 6f6d 2061 7262  of ROIs from arb
+00053870: 6974 7261 7279 2063 6f6d 6269 6e61 7469  itrary combinati
+00053880: 6f6e 206f 6620 524f 4973 2061 6e64 2053  on of ROIs and S
+00053890: 7472 7563 7475 7265 5365 7473 2e0a 0a20  tructureSets... 
+000538a0: 2020 202a 2a50 6172 616d 6574 6572 733a     **Parameters:
+000538b0: 2a2a 0a0a 2020 2020 6f62 6a73 203a 2052  **..    objs : R
+000538c0: 4f49 2f53 7472 7563 7475 7265 5365 742f  OI/StructureSet/
+000538d0: 6c69 7374 2c20 6465 6661 756c 743d 4e6f  list, default=No
+000538e0: 6e65 0a20 2020 2020 2020 204f 626a 6563  ne.        Objec
+000538f0: 7428 7329 2066 726f 6d20 7768 6963 6820  t(s) from which 
+00053900: 6120 6c69 7374 206f 6620 524f 4973 2069  a list of ROIs i
+00053910: 7320 746f 2062 6520 6372 6561 7465 642e  s to be created.
+00053920: 2020 5468 650a 2020 2020 2020 2020 6f62    The.        ob
+00053930: 6a65 6374 2873 2920 6361 6e20 6265 2061  ject(s) can be a
+00053940: 2073 696e 676c 6520 736b 7274 2e73 7472   single skrt.str
+00053950: 7563 7475 7265 732e 524f 4920 6f62 6a65  uctures.ROI obje
+00053960: 6374 2c20 6120 7369 6e67 6c65 0a20 2020  ct, a single.   
+00053970: 2020 2020 2073 6b72 742e 7374 7275 6374       skrt.struct
+00053980: 7572 6573 2e53 7472 7563 7475 7265 5365  ures.StructureSe
+00053990: 7420 6f62 6a65 6374 2c20 6f72 2061 206c  t object, or a l
+000539a0: 6973 7420 636f 6e74 6169 6e69 6e67 2061  ist containing a
+000539b0: 6e79 0a20 2020 2020 2020 2063 6f6d 6269  ny.        combi
+000539c0: 6e61 7469 6f6e 206f 6620 524f 4920 616e  nation of ROI an
+000539d0: 6420 5374 7275 6374 7572 6553 6574 206f  d StructureSet o
+000539e0: 626a 6563 7473 2e0a 2020 2020 2222 220a  bjects..    """.
+000539f0: 2020 2020 2320 456e 7375 7265 2074 6861      # Ensure tha
+00053a00: 7420 6f62 6a73 2069 7320 6120 6c69 7374  t objs is a list
+00053a10: 0a20 2020 2069 6620 6973 7375 6263 6c61  .    if issubcla
+00053a20: 7373 2874 7970 6528 6f62 6a73 292c 2028  ss(type(objs), (
+00053a30: 524f 492c 2053 7472 7563 7475 7265 5365  ROI, StructureSe
+00053a40: 7429 293a 0a20 2020 2020 2020 206f 626a  t)):.        obj
+00053a50: 7320 3d20 5b6f 626a 735d 0a20 2020 2065  s = [objs].    e
+00053a60: 6c69 6620 6f62 6a73 2069 7320 4e6f 6e65  lif objs is None
+00053a70: 3a0a 2020 2020 2020 2020 6f62 6a73 203d  :.        objs =
+00053a80: 205b 5d0a 0a20 2020 2023 2043 7265 6174   []..    # Creat
+00053a90: 6520 6120 6c69 7374 2063 6f6e 7461 696e  e a list contain
+00053aa0: 696e 6720 616c 6c20 756e 6971 7565 2072  ing all unique r
+00053ab0: 6f69 732e 0a20 2020 2061 6c6c 5f72 6f69  ois..    all_roi
+00053ac0: 7320 3d20 5b5d 0a20 2020 2066 6f72 2069  s = [].    for i
+00053ad0: 7465 6d20 696e 206f 626a 733a 0a20 2020  tem in objs:.   
+00053ae0: 2020 2020 2069 6620 6973 7375 6263 6c61       if issubcla
+00053af0: 7373 2874 7970 6528 6974 656d 292c 2052  ss(type(item), R
+00053b00: 4f49 293a 0a20 2020 2020 2020 2020 2020  OI):.           
+00053b10: 2063 616e 6469 6461 7465 5f72 6f69 7320   candidate_rois 
+00053b20: 3d20 5b69 7465 6d5d 0a20 2020 2020 2020  = [item].       
+00053b30: 2065 6c69 6620 6973 7375 6263 6c61 7373   elif issubclass
+00053b40: 2874 7970 6528 6974 656d 292c 2053 7472  (type(item), Str
+00053b50: 7563 7475 7265 5365 7429 3a0a 2020 2020  uctureSet):.    
+00053b60: 2020 2020 2020 2020 6361 6e64 6964 6174          candidat
+00053b70: 655f 726f 6973 203d 2069 7465 6d2e 6765  e_rois = item.ge
+00053b80: 745f 726f 6973 2829 0a20 2020 2020 2020  t_rois().       
+00053b90: 2066 6f72 2072 6f69 2069 6e20 6361 6e64   for roi in cand
+00053ba0: 6964 6174 655f 726f 6973 3a0a 2020 2020  idate_rois:.    
+00053bb0: 2020 2020 2020 2020 6966 206e 6f74 2072          if not r
+00053bc0: 6f69 2069 6e20 616c 6c5f 726f 6973 3a0a  oi in all_rois:.
+00053bd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00053be0: 616c 6c5f 726f 6973 2e61 7070 656e 6428  all_rois.append(
+00053bf0: 726f 6929 0a0a 2020 2020 7265 7475 726e  roi)..    return
+00053c00: 2061 6c6c 5f72 6f69 730a 0a64 6566 2067   all_rois..def g
+00053c10: 6574 5f74 7261 6e73 6c61 7469 6f6e 5f74  et_translation_t
+00053c20: 6f5f 616c 6967 6e28 726f 6931 2c20 726f  o_align(roi1, ro
+00053c30: 6932 2c20 7a5f 6672 6163 7469 6f6e 313d  i2, z_fraction1=
+00053c40: 4e6f 6e65 2c20 7a5f 6672 6163 7469 6f6e  None, z_fraction
+00053c50: 323d 4e6f 6e65 293a 0a20 2020 2022 2222  2=None):.    """
+00053c60: 0a20 2020 2044 6574 6572 6d69 6e65 2074  .    Determine t
+00053c70: 7261 6e73 6c61 7469 6f6e 2066 6f72 2061  ranslation for a
+00053c80: 6c69 676e 696e 6720 3c72 6f69 313e 2074  ligning <roi1> t
+00053c90: 6f20 3c72 6f69 323e 2e0a 0a20 2020 202a  o <roi2>...    *
+00053ca0: 2a50 6172 616d 6574 6572 733a 2a2a 0a0a  *Parameters:**..
+00053cb0: 2020 2020 726f 6931 203a 2052 4f49 2f53      roi1 : ROI/S
+00053cc0: 7472 7563 7475 7265 5365 742f 6c69 7374  tructureSet/list
+00053cd0: 0a20 2020 2020 2020 2052 4f49 2074 6861  .        ROI tha
+00053ce0: 7420 6973 2074 6f20 6265 2074 7261 6e73  t is to be trans
+00053cf0: 6c61 7469 6f6e 2074 6f20 6163 6869 6576  lation to achiev
+00053d00: 6520 7468 6520 616c 6967 6e6d 656e 742e  e the alignment.
+00053d10: 2020 5468 6973 0a20 2020 2020 2020 2063    This.        c
+00053d20: 616e 2062 6520 7370 6563 6966 6965 6420  an be specified 
+00053d30: 6469 7265 6374 6c79 2061 7320 6120 7369  directly as a si
+00053d40: 6e67 6c65 2052 4f49 2e20 2041 6c74 6572  ngle ROI.  Alter
+00053d50: 6e61 7469 7665 6c79 2c0a 2020 2020 2020  natively,.      
+00053d60: 2020 6974 2063 616e 2062 6520 6120 5374    it can be a St
+00053d70: 7275 6374 7572 6553 6574 2c20 6f72 2061  ructureSet, or a
+00053d80: 206c 6973 7420 6f72 2052 4f49 2f53 7472   list or ROI/Str
+00053d90: 7563 7475 7265 5365 7420 6f62 6a65 6374  uctureSet object
+00053da0: 732c 0a20 2020 2020 2020 2069 6e20 7768  s,.        in wh
+00053db0: 6963 6820 6361 7365 2074 6865 2069 6e64  ich case the ind
+00053dc0: 6976 6964 7561 6c20 524f 4973 2077 696c  ividual ROIs wil
+00053dd0: 6c20 6265 2063 6f6d 6269 6e65 642e 0a0a  l be combined...
+00053de0: 2020 2020 726f 6932 203a 2052 4f49 2f53      roi2 : ROI/S
+00053df0: 7472 7563 7475 7265 5365 742f 6c69 7374  tructureSet/list
+00053e00: 0a20 2020 2020 2020 2052 4f49 2077 6974  .        ROI wit
+00053e10: 6820 7768 6963 6820 616c 6967 6e6d 656e  h which alignmen
+00053e20: 7420 6973 2074 6f20 6265 2070 6572 666f  t is to be perfo
+00053e30: 726d 6564 2e20 2054 6869 7320 6361 6e20  rmed.  This can 
+00053e40: 6265 0a20 2020 2020 2020 2073 7065 6369  be.        speci
+00053e50: 6669 6564 2064 6972 6563 746c 7920 6173  fied directly as
+00053e60: 2061 2073 696e 676c 6520 524f 492e 2020   a single ROI.  
+00053e70: 416c 7465 726e 6174 6976 656c 792c 2069  Alternatively, i
+00053e80: 7420 6361 6e0a 2020 2020 2020 2020 6265  t can.        be
+00053e90: 2061 2053 7472 7563 7475 7265 5365 742c   a StructureSet,
+00053ea0: 206f 7220 6120 6c69 7374 206f 7220 524f   or a list or RO
+00053eb0: 492f 5374 7275 6374 7572 6553 6574 206f  I/StructureSet o
+00053ec0: 626a 6563 7473 2c0a 2020 2020 2020 2020  bjects,.        
+00053ed0: 696e 2077 6869 6368 2063 6173 6520 7468  in which case th
+00053ee0: 6520 696e 6469 7669 6475 616c 2052 4f49  e individual ROI
+00053ef0: 7320 7769 6c6c 2062 6520 636f 6d62 696e  s will be combin
+00053f00: 6564 2e0a 0a20 2020 207a 5f66 7261 6374  ed...    z_fract
+00053f10: 696f 6e31 203a 2066 6c6f 6174 2c20 6465  ion1 : float, de
+00053f20: 6661 756c 743d 4e6f 6e65 0a20 2020 2020  fault=None.     
+00053f30: 2020 2050 6f73 6974 696f 6e20 616c 6f6e     Position alon
+00053f40: 6720 7a20 6178 6973 206f 6620 736c 6963  g z axis of slic
+00053f50: 6520 7468 726f 7567 6820 3c72 6f69 313e  e through <roi1>
+00053f60: 206f 6e20 7768 6963 680a 2020 2020 2020   on which.      
+00053f70: 2020 746f 2061 6c69 676e 2e20 2049 6620    to align.  If 
+00053f80: 4e6f 6e65 2c20 616c 6967 6e6d 656e 7420  None, alignment 
+00053f90: 6973 2074 6f20 7468 6520 6365 6e74 726f  is to the centro
+00053fa0: 6964 206f 6620 7468 650a 2020 2020 2020  id of the.      
+00053fb0: 2020 7768 6f6c 6520 524f 4920 766f 6c75    whole ROI volu
+00053fc0: 6d65 2e20 204f 7468 6572 7769 7365 2c20  me.  Otherwise, 
+00053fd0: 616c 6967 6e6d 656e 7420 6973 2074 6f20  alignment is to 
+00053fe0: 7468 650a 2020 2020 2020 2020 6365 6e74  the.        cent
+00053ff0: 726f 6964 206f 6620 7468 6520 736c 6963  roid of the slic
+00054000: 6520 6174 2074 6865 2073 7065 6369 6669  e at the specifi
+00054010: 6564 2064 6973 7461 6e63 650a 2020 2020  ed distance.    
+00054020: 2020 2020 6672 6f6d 2074 6865 2052 4f49      from the ROI
+00054030: 2773 206d 6f73 742d 696e 6665 7269 6f72  's most-inferior
+00054040: 2070 6f69 6e74 3a20 3020 636f 7272 6573   point: 0 corres
+00054050: 706f 6e64 7320 746f 0a20 2020 2020 2020  ponds to.       
+00054060: 2074 6865 206d 6f73 742d 696e 6665 7269   the most-inferi
+00054070: 6f72 2070 6f69 6e74 2028 6c6f 7765 7374  or point (lowest
+00054080: 207a 293b 2031 2063 6f72 7265 7370 6f6e   z); 1 correspon
+00054090: 6473 2074 6f20 7468 650a 2020 2020 2020  ds to the.      
+000540a0: 2020 6d6f 7374 2d73 7570 6572 696f 7220    most-superior 
+000540b0: 706f 696e 7420 2868 6967 6865 7374 207a  point (highest z
+000540c0: 292e 2020 5661 6c75 6573 2066 6f72 207a  ).  Values for z
+000540d0: 5f66 7261 6374 696f 6e0a 2020 2020 2020  _fraction.      
+000540e0: 2020 6f75 7473 6964 6520 7468 6520 696e    outside the in
+000540f0: 7465 7276 616c 205b 302c 2031 5d20 7265  terval [0, 1] re
+00054100: 7375 6c74 2069 6e20 6120 5275 6e74 696d  sult in a Runtim
+00054110: 6545 7272 6f72 2e0a 0a20 2020 207a 5f66  eError...    z_f
+00054120: 7261 6374 696f 6e32 203a 2066 6c6f 6174  raction2 : float
+00054130: 2c20 6465 6661 756c 743d 4e6f 6e65 0a20  , default=None. 
+00054140: 2020 2020 2020 2050 6f73 6974 696f 6e20         Position 
+00054150: 616c 6f6e 6720 7a20 6178 6973 206f 6620  along z axis of 
+00054160: 736c 6963 6520 7468 726f 7567 6820 3c72  slice through <r
+00054170: 6f69 323e 206f 6e20 7768 6963 680a 2020  oi2> on which.  
+00054180: 2020 2020 2020 746f 2061 6c69 676e 2e20        to align. 
+00054190: 2049 6620 4e6f 6e65 2c20 616c 6967 6e6d   If None, alignm
+000541a0: 656e 7420 6973 2074 6f20 7468 6520 6365  ent is to the ce
+000541b0: 6e74 726f 6964 206f 6620 7468 650a 2020  ntroid of the.  
+000541c0: 2020 2020 2020 7768 6f6c 6520 524f 4920        whole ROI 
+000541d0: 766f 6c75 6d65 2e20 204f 7468 6572 7769  volume.  Otherwi
+000541e0: 7365 2c20 616c 6967 6e6d 656e 7420 6973  se, alignment is
+000541f0: 2074 6f20 7468 650a 2020 2020 2020 2020   to the.        
+00054200: 6365 6e74 726f 6964 206f 6620 7468 6520  centroid of the 
+00054210: 736c 6963 6520 6174 2074 6865 2073 7065  slice at the spe
+00054220: 6369 6669 6564 2064 6973 7461 6e63 650a  cified distance.
+00054230: 2020 2020 2020 2020 6672 6f6d 2074 6865          from the
+00054240: 2052 4f49 2773 206d 6f73 742d 696e 6665   ROI's most-infe
+00054250: 7269 6f72 2070 6f69 6e74 3a20 3020 636f  rior point: 0 co
+00054260: 7272 6573 706f 6e64 7320 746f 0a20 2020  rresponds to.   
+00054270: 2020 2020 2074 6865 206d 6f73 742d 696e       the most-in
+00054280: 6665 7269 6f72 2070 6f69 6e74 2028 6c6f  ferior point (lo
+00054290: 7765 7374 207a 293b 2031 2063 6f72 7265  west z); 1 corre
+000542a0: 7370 6f6e 6473 2074 6f20 7468 650a 2020  sponds to the.  
+000542b0: 2020 2020 2020 6d6f 7374 2d73 7570 6572        most-super
+000542c0: 696f 7220 706f 696e 7420 2868 6967 6865  ior point (highe
+000542d0: 7374 207a 292e 2020 5661 6c75 6573 2066  st z).  Values f
+000542e0: 6f72 207a 5f66 7261 6374 696f 6e0a 2020  or z_fraction.  
+000542f0: 2020 2020 2020 6f75 7473 6964 6520 7468        outside th
+00054300: 6520 696e 7465 7276 616c 205b 302c 2031  e interval [0, 1
+00054310: 5d20 7265 7375 6c74 2069 6e20 6120 5275  ] result in a Ru
+00054320: 6e74 696d 6545 7272 6f72 2e0a 2020 2020  ntimeError..    
+00054330: 2020 2020 2222 220a 2020 2020 2320 4372      """.    # Cr
+00054340: 6561 7465 206c 6973 7420 6f66 2074 776f  eate list of two
+00054350: 2073 696e 676c 6520 524f 4973 2e0a 2020   single ROIs..  
+00054360: 2020 726f 6973 203d 205b 5d0a 2020 2020    rois = [].    
+00054370: 666f 7220 726f 6920 696e 205b 726f 6931  for roi in [roi1
+00054380: 2c20 726f 6932 5d3a 0a20 2020 2020 2020  , roi2]:.       
+00054390: 2069 6620 6973 696e 7374 616e 6365 2872   if isinstance(r
+000543a0: 6f69 2c20 524f 4929 3a0a 2020 2020 2020  oi, ROI):.      
+000543b0: 2020 2020 2020 2320 5374 6f72 6520 7369        # Store si
+000543c0: 6e67 6c65 2052 4f49 2064 6972 6563 746c  ngle ROI directl
+000543d0: 792e 0a20 2020 2020 2020 2020 2020 2072  y..            r
+000543e0: 6f69 732e 6170 7065 6e64 2872 6f69 290a  ois.append(roi).
+000543f0: 2020 2020 2020 2020 656c 6966 2069 7369          elif isi
+00054400: 6e73 7461 6e63 6528 726f 692c 2053 7472  nstance(roi, Str
+00054410: 7563 7475 7265 5365 7429 3a0a 2020 2020  uctureSet):.    
+00054420: 2020 2020 2020 2020 2320 436f 6d62 696e          # Combin
+00054430: 6520 524f 4973 206f 6620 5374 7275 6374  e ROIs of Struct
+00054440: 7572 6553 6574 2e0a 2020 2020 2020 2020  ureSet..        
+00054450: 2020 2020 726f 6973 2e61 7070 656e 6428      rois.append(
+00054460: 726f 692e 636f 6d62 696e 655f 726f 6973  roi.combine_rois
+00054470: 2829 290a 2020 2020 2020 2020 656c 7365  ()).        else
+00054480: 3a0a 2020 2020 2020 2020 2020 2020 2320  :.            # 
+00054490: 436f 6d62 696e 6520 524f 4973 2066 726f  Combine ROIs fro
+000544a0: 6d20 6c69 7374 2e0a 2020 2020 2020 2020  m list..        
+000544b0: 2020 2020 726f 6973 2e61 7070 656e 6428      rois.append(
+000544c0: 5374 7275 6374 7572 6553 6574 2867 6574  StructureSet(get
+000544d0: 5f61 6c6c 5f72 6f69 7328 726f 6929 292e  _all_rois(roi)).
+000544e0: 636f 6d62 696e 655f 726f 6973 2829 290a  combine_rois()).
+000544f0: 0a20 2020 2023 2043 616c 6375 6c61 7465  .    # Calculate
+00054500: 2061 6c69 676e 6d65 6e74 2070 6f69 6e74   alignment point
+00054510: 732e 0a20 2020 2063 656e 7472 6f69 6473  s..    centroids
+00054520: 203d 205b 5d0a 2020 2020 666f 7220 726f   = [].    for ro
+00054530: 692c 207a 5f66 7261 6374 696f 6e20 696e  i, z_fraction in
+00054540: 207a 6970 2872 6f69 732c 205b 7a5f 6672   zip(rois, [z_fr
+00054550: 6163 7469 6f6e 312c 207a 5f66 7261 6374  action1, z_fract
+00054560: 696f 6e32 5d29 3a0a 2020 2020 2020 2020  ion2]):.        
+00054570: 2320 4361 6c63 756c 6174 6520 6365 6e74  # Calculate cent
+00054580: 726f 6964 2066 6f72 2074 6865 2077 686f  roid for the who
+00054590: 6c65 2052 4f49 2076 6f6c 756d 652e 0a20  le ROI volume.. 
+000545a0: 2020 2020 2020 2069 6620 7a5f 6672 6163         if z_frac
+000545b0: 7469 6f6e 2069 7320 4e6f 6e65 3a0a 2020  tion is None:.  
+000545c0: 2020 2020 2020 2020 2020 6365 6e74 726f            centro
+000545d0: 6964 732e 6170 7065 6e64 2872 6f69 2e67  ids.append(roi.g
+000545e0: 6574 5f63 656e 7472 6f69 6428 2929 0a20  et_centroid()). 
+000545f0: 2020 2020 2020 2023 2043 616c 6375 6c61         # Calcula
+00054600: 7465 2063 656e 7472 6f69 6420 666f 7220  te centroid for 
+00054610: 736c 6963 6520 6174 2073 7065 6369 6669  slice at specifi
+00054620: 6564 2070 6f73 6974 696f 6e2e 0a20 2020  ed position..   
+00054630: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+00054640: 2020 2020 2020 2063 656e 7472 6f69 6473         centroids
+00054650: 2e61 7070 656e 6428 726f 692e 6765 745f  .append(roi.get_
+00054660: 726f 695f 736c 6963 6528 7a5f 6672 6163  roi_slice(z_frac
+00054670: 7469 6f6e 292e 6765 745f 6365 6e74 726f  tion).get_centro
+00054680: 6964 2829 290a 0a20 2020 2072 6574 7572  id())..    retur
+00054690: 6e20 7475 706c 6528 6365 6e74 726f 6964  n tuple(centroid
+000546a0: 735b 315d 202d 2063 656e 7472 6f69 6473  s[1] - centroids
+000546b0: 5b30 5d29 0a0a 6465 6620 6765 745f 736c  [0])..def get_sl
+000546c0: 6963 655f 706f 7369 7469 6f6e 7328 726f  ice_positions(ro
+000546d0: 6931 2c20 726f 6932 3d4e 6f6e 652c 2076  i1, roi2=None, v
+000546e0: 6965 773d 2278 2d79 222c 2070 6f73 6974  iew="x-y", posit
+000546f0: 696f 6e5f 6173 5f69 6478 3d46 616c 7365  ion_as_idx=False
+00054700: 2c0a 2020 2020 2020 2020 6d65 7468 6f64  ,.        method
+00054710: 3d4e 6f6e 6529 3a0a 2020 2020 2222 220a  =None):.    """.
+00054720: 2020 2020 4765 7420 6f72 6465 7265 6420      Get ordered 
+00054730: 6c69 7374 206f 6620 736c 6963 6520 706f  list of slice po
+00054740: 7369 7469 6f6e 7320 666f 7220 6569 7468  sitions for eith
+00054750: 6572 206f 7220 626f 7468 206f 6620 6120  er or both of a 
+00054760: 7061 6972 206f 6620 524f 4973 2e0a 0a20  pair of ROIs... 
+00054770: 2020 202a 2a50 6172 616d 6574 6572 733a     **Parameters:
+00054780: 2a2a 0a0a 2020 2020 726f 6931 203a 2073  **..    roi1 : s
+00054790: 6b72 742e 7374 7275 6374 7572 6573 2e52  krt.structures.R
+000547a0: 4f49 0a20 2020 2020 2020 2052 4f49 2c20  OI.        ROI, 
+000547b0: 6f72 206f 6e65 206f 6620 6120 7061 6972  or one of a pair
+000547c0: 206f 6620 524f 4973 2c20 666f 7220 7768   of ROIs, for wh
+000547d0: 6963 6820 736c 6963 6520 696e 666f 726d  ich slice inform
+000547e0: 6174 696f 6e20 6973 2074 6f0a 2020 2020  ation is to.    
+000547f0: 2020 2020 6265 206f 6274 6169 6e65 642e      be obtained.
+00054800: 0a0a 2020 2020 726f 6932 203a 2073 6b72  ..    roi2 : skr
+00054810: 742e 7374 7275 6374 7572 6573 2e52 4f49  t.structures.ROI
+00054820: 2c20 6465 6661 756c 743d 4e6f 6e65 0a20  , default=None. 
+00054830: 2020 2020 2020 2049 6620 6e6f 7420 4e6f         If not No
+00054840: 6e65 2c20 7365 636f 6e64 2069 6e20 6120  ne, second in a 
+00054850: 7061 6972 206f 6620 524f 4973 2066 6f72  pair of ROIs for
+00054860: 2077 6869 6368 2073 6c69 6365 2069 6e66   which slice inf
+00054870: 6f72 6d61 7469 6f6e 0a20 2020 2020 2020  ormation.       
+00054880: 2069 7320 746f 2062 6520 6f62 7461 696e   is to be obtain
+00054890: 6564 2e0a 0a20 2020 2076 6965 7720 3a20  ed...    view : 
+000548a0: 7374 722c 2064 6566 6175 6c74 3d22 782d  str, default="x-
+000548b0: 7922 0a20 2020 2020 2020 2056 6965 7720  y".        View 
+000548c0: 696e 2077 6869 6368 2074 6f20 6f62 7461  in which to obta
+000548d0: 696e 2073 6c69 6365 732e 0a0a 2020 2020  in slices...    
+000548e0: 706f 7369 7469 6f6e 5f61 735f 6964 7820  position_as_idx 
+000548f0: 3a20 626f 6f6c 2c20 6465 6661 756c 743d  : bool, default=
+00054900: 4661 6c73 650a 2020 2020 2020 2020 4966  False.        If
+00054910: 2054 7275 652c 2072 6574 7572 6e20 706f   True, return po
+00054920: 7369 7469 6f6e 7320 6173 2073 6c69 6365  sitions as slice
+00054930: 2069 6e64 6963 6573 3b20 6966 2046 616c   indices; if Fal
+00054940: 7365 2c0a 2020 2020 2020 2020 7265 7475  se,.        retu
+00054950: 726e 2070 6f73 6974 696f 6e73 2061 7320  rn positions as 
+00054960: 736c 6963 6520 7a2d 636f 6f72 6469 6e61  slice z-coordina
+00054970: 7465 7320 286d 6d29 2e0a 0a20 2020 206d  tes (mm)...    m
+00054980: 6574 686f 643a 2073 7472 2c20 6465 6661  ethod: str, defa
+00054990: 756c 743d 4e6f 6e65 0a20 2020 2020 2020  ult=None.       
+000549a0: 2053 7472 696e 6720 7370 6563 6966 7969   String specifyi
+000549b0: 6e67 2073 6c69 6365 7320 666f 7220 7768  ng slices for wh
+000549c0: 6963 6820 706f 7369 7469 6f6e 7320 6172  ich positions ar
+000549d0: 6520 746f 2062 6520 6f62 7461 696e 6564  e to be obtained
+000549e0: 2c0a 2020 2020 2020 2020 666f 7220 524f  ,.        for RO
+000549f0: 4973 2072 6f69 312c 2072 6f69 323a 0a0a  Is roi1, roi2:..
+00054a00: 2020 2020 2020 2020 2d20 226c 6566 7422          - "left"
+00054a10: 2028 6f72 2072 6f69 3220 6973 204e 6f6e   (or roi2 is Non
+00054a20: 6529 3a20 7265 7475 726e 2070 6f73 6974  e): return posit
+00054a30: 696f 6e73 206f 6620 736c 6963 6573 2063  ions of slices c
+00054a40: 6f6e 7461 696e 696e 6720 726f 6931 3b0a  ontaining roi1;.
+00054a50: 2020 2020 2020 2020 2d20 2272 6967 6874          - "right
+00054a60: 223a 2072 6574 7572 6e20 706f 7369 7469  ": return positi
+00054a70: 6f6e 7320 6f66 2073 6c69 6365 7320 636f  ons of slices co
+00054a80: 6e74 6169 6e69 6e67 2072 6f69 323b 0a20  ntaining roi2;. 
+00054a90: 2020 2020 2020 202d 2022 756e 696f 6e22         - "union"
+00054aa0: 3a20 7265 7475 726e 2070 6f73 6974 696f  : return positio
+00054ab0: 6e73 206f 6620 736c 6963 6573 2063 6f6e  ns of slices con
+00054ac0: 7461 696e 696e 6720 6569 7468 6572 2072  taining either r
+00054ad0: 6f69 3120 6f72 2072 6f69 323b 0a20 2020  oi1 or roi2;.   
+00054ae0: 2020 2020 202d 2022 696e 7465 7273 6563       - "intersec
+00054af0: 7469 6f6e 223a 2072 6574 7572 6e20 706f  tion": return po
+00054b00: 7369 7469 6f6e 7320 6f66 2073 6c69 6365  sitions of slice
+00054b10: 7320 636f 6e74 6169 6e69 6e67 2062 6f74  s containing bot
+00054b20: 680a 2020 2020 2020 2020 2020 726f 6931  h.          roi1
+00054b30: 2061 6e64 2072 6f69 322e 0a0a 2020 2020   and roi2...    
+00054b40: 2020 2020 4966 204e 6f6e 652c 2076 616c      If None, val
+00054b50: 7565 206f 6620 736b 7274 2e63 6f72 652e  ue of skrt.core.
+00054b60: 4465 6661 756c 7473 2829 2e62 795f 736c  Defaults().by_sl
+00054b70: 6963 6520 6973 2075 7365 642e 0a20 2020  ice is used..   
+00054b80: 2022 2222 0a20 2020 206d 6574 686f 6420   """.    method 
+00054b90: 3d20 6d65 7468 6f64 206f 7220 736b 7274  = method or skrt
+00054ba0: 2e63 6f72 652e 4465 6661 756c 7473 2829  .core.Defaults()
+00054bb0: 2e62 795f 736c 6963 650a 2020 2020 6966  .by_slice.    if
+00054bc0: 206d 6574 686f 6420 6e6f 7420 696e 2067   method not in g
+00054bd0: 6574 5f62 795f 736c 6963 655f 6d65 7468  et_by_slice_meth
+00054be0: 6f64 7328 293a 0a20 2020 2020 2020 2072  ods():.        r
+00054bf0: 6169 7365 2052 756e 7469 6d65 4572 726f  aise RuntimeErro
+00054c00: 7228 6622 4d65 7468 6f64 206d 7573 7420  r(f"Method must 
+00054c10: 6265 206f 6e65 206f 6620 7b67 6574 5f62  be one of {get_b
+00054c20: 795f 736c 6963 655f 6d65 7468 6f64 7328  y_slice_methods(
+00054c30: 297d 220a 2020 2020 2020 2020 2220 2d20  )}".        " - 
+00054c40: 6e6f 7420 277b 6d65 7468 6f64 7d27 2229  not '{method}'")
+00054c50: 0a0a 2020 2020 696e 6469 6365 7320 3d20  ..    indices = 
+00054c60: 4e6f 6e65 0a0a 2020 2020 696e 6469 6365  None..    indice
+00054c70: 7331 203d 2072 6f69 312e 6765 745f 696e  s1 = roi1.get_in
+00054c80: 6469 6365 7328 7669 6577 3d76 6965 772c  dices(view=view,
+00054c90: 206d 6574 686f 643d 226d 6173 6b22 290a   method="mask").
+00054ca0: 2020 2020 6966 206e 6f74 2069 7373 7562      if not issub
+00054cb0: 636c 6173 7328 7479 7065 2872 6f69 3229  class(type(roi2)
+00054cc0: 2c20 524f 4929 206f 7220 226c 6566 7422  , ROI) or "left"
+00054cd0: 203d 3d20 6d65 7468 6f64 3a0a 2020 2020   == method:.    
+00054ce0: 2020 2020 696e 6469 6365 7320 3d20 696e      indices = in
+00054cf0: 6469 6365 7331 0a0a 2020 2020 6966 2069  dices1..    if i
+00054d00: 6e64 6963 6573 2069 7320 4e6f 6e65 3a0a  ndices is None:.
+00054d10: 2020 2020 2020 2020 696e 6469 6365 7332          indices2
+00054d20: 203d 2072 6f69 322e 6765 745f 696e 6469   = roi2.get_indi
+00054d30: 6365 7328 7669 6577 3d76 6965 772c 206d  ces(view=view, m
+00054d40: 6574 686f 643d 226d 6173 6b22 290a 2020  ethod="mask").  
+00054d50: 2020 2020 2020 6966 2022 7269 6768 7422        if "right"
+00054d60: 203d 3d20 6d65 7468 6f64 3a0a 2020 2020   == method:.    
+00054d70: 2020 2020 2020 2020 696e 6469 6365 7320          indices 
+00054d80: 3d20 696e 6469 6365 7332 0a20 2020 2020  = indices2.     
+00054d90: 2020 200a 2020 2020 6966 2069 6e64 6963     .    if indic
+00054da0: 6573 2069 7320 4e6f 6e65 3a0a 2020 2020  es is None:.    
+00054db0: 2020 2020 6966 2022 756e 696f 6e22 203d      if "union" =
+00054dc0: 3d20 6d65 7468 6f64 3a0a 2020 2020 2020  = method:.      
+00054dd0: 2020 2020 2020 696e 6469 6365 7320 3d20        indices = 
+00054de0: 6c69 7374 2873 6574 2869 6e64 6963 6573  list(set(indices
+00054df0: 3129 2e75 6e69 6f6e 2873 6574 2869 6e64  1).union(set(ind
+00054e00: 6963 6573 3229 2929 0a0a 2020 2020 6966  ices2)))..    if
+00054e10: 2069 6e64 6963 6573 2069 7320 4e6f 6e65   indices is None
+00054e20: 3a0a 2020 2020 2020 2020 6966 2022 696e  :.        if "in
+00054e30: 7465 7273 6563 7469 6f6e 2220 3d3d 206d  tersection" == m
+00054e40: 6574 686f 643a 0a20 2020 2020 2020 2020  ethod:.         
+00054e50: 2020 2069 6e64 6963 6573 203d 206c 6973     indices = lis
+00054e60: 7428 7365 7428 696e 6469 6365 7331 292e  t(set(indices1).
+00054e70: 696e 7465 7273 6563 7469 6f6e 2873 6574  intersection(set
+00054e80: 2869 6e64 6963 6573 3229 2929 0a0a 2020  (indices2)))..  
+00054e90: 2020 6966 2069 6e64 6963 6573 2069 7320    if indices is 
+00054ea0: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
+00054eb0: 2020 6966 2070 6f73 6974 696f 6e5f 6173    if position_as
+00054ec0: 5f69 6478 3a0a 2020 2020 2020 2020 2020  _idx:.          
+00054ed0: 2020 7265 7475 726e 2073 6f72 7465 6428    return sorted(
+00054ee0: 696e 6469 6365 7329 0a20 2020 2020 2020  indices).       
+00054ef0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+00054f00: 2020 2061 7820 3d20 736b 7274 2e69 6d61     ax = skrt.ima
+00054f10: 6765 2e5f 736c 6963 655f 6178 6573 5b76  ge._slice_axes[v
+00054f20: 6965 775d 0a20 2020 2020 2020 2020 2020  iew].           
+00054f30: 2072 6574 7572 6e20 736f 7274 6564 285b   return sorted([
+00054f40: 726f 6931 2e69 6478 5f74 6f5f 706f 7328  roi1.idx_to_pos(
+00054f50: 6964 782c 2061 7829 2066 6f72 2069 6478  idx, ax) for idx
+00054f60: 2069 6e20 696e 6469 6365 735d 290a 0a64   in indices])..d
+00054f70: 6566 2065 7870 616e 645f 736c 6963 655f  ef expand_slice_
+00054f80: 7374 6174 7328 736c 6963 655f 7374 6174  stats(slice_stat
+00054f90: 733d 4e6f 6e65 2c20 6465 6661 756c 745f  s=None, default_
+00054fa0: 6279 5f73 6c69 6365 3d4e 6f6e 6529 3a0a  by_slice=None):.
+00054fb0: 2020 2020 2222 220a 2020 2020 4578 7061      """.    Expa
+00054fc0: 6e64 2073 7065 6369 6669 6361 7469 6f6e  nd specification
+00054fd0: 206f 6620 7374 6174 6973 7469 6373 2074   of statistics t
+00054fe0: 6f20 6361 6c63 756c 6174 6520 666f 7220  o calculate for 
+00054ff0: 524f 4920 636f 6d70 6172 6973 6f6e 0a20  ROI comparison. 
+00055000: 2020 206d 6574 7269 6373 2065 7661 6c75     metrics evalu
+00055010: 6174 6564 2073 6c69 6365 2062 7920 736c  ated slice by sl
+00055020: 6963 652e 0a0a 2020 2020 4120 6469 6374  ice...    A dict
+00055030: 696f 6e61 7279 2069 7320 7265 7475 726e  ionary is return
+00055040: 6564 2c20 7768 6572 6520 6b65 7973 2067  ed, where keys g
+00055050: 6976 6520 7468 6520 736c 6963 6573 2074  ive the slices t
+00055060: 6f20 6265 2063 6f6e 7369 6465 7265 640a  o be considered.
+00055070: 2020 2020 666f 7220 6361 6c63 756c 6174      for calculat
+00055080: 696e 6720 7374 6174 6973 7469 6373 2c20  ing statistics, 
+00055090: 616e 6420 7661 6c75 6573 2061 7265 206c  and values are l
+000550a0: 6973 7473 206f 6620 6d65 7472 6963 732e  ists of metrics.
+000550b0: 0a0a 2020 2020 2a2a 5061 7261 6d65 7465  ..    **Paramete
+000550c0: 7273 3a2a 2a0a 0a20 2020 2073 6c69 6365  rs:**..    slice
+000550d0: 5f73 7461 7473 203a 2073 7472 2f6c 6973  _stats : str/lis
+000550e0: 742f 6469 6374 2c20 6465 6661 756c 743d  t/dict, default=
+000550f0: 4e6f 6e65 0a20 2020 2020 2020 2053 7065  None.        Spe
+00055100: 6369 6669 6361 7469 6f6e 206f 6620 7374  cification of st
+00055110: 6174 6973 7469 6373 2074 6f20 6265 2063  atistics to be c
+00055120: 616c 6375 6c61 7465 6420 7265 6c61 7469  alculated relati
+00055130: 7665 0a20 2020 2020 2020 2074 6f20 736c  ve.        to sl
+00055140: 6963 652d 6279 2d73 6c69 6365 206d 6574  ice-by-slice met
+00055150: 7269 6320 7661 6c75 6573 2e0a 0a20 2020  ric values...   
+00055160: 2020 2020 2041 2073 7461 7469 7374 6963       A statistic
+00055170: 2069 7320 7370 6563 6966 6965 6420 6279   is specified by
+00055180: 2074 6865 206e 616d 6520 6f66 2074 6865   the name of the
+00055190: 2066 756e 6374 696f 6e20 666f 720a 2020   function for.  
+000551a0: 2020 2020 2020 6974 7320 6361 6c63 756c        its calcul
+000551b0: 6174 696f 6e20 696e 2074 6865 2050 7974  ation in the Pyt
+000551c0: 686f 6e20 7374 6174 6973 7469 6373 206d  hon statistics m
+000551d0: 6f64 756c 653a 0a0a 2020 2020 2020 2020  odule:..        
+000551e0: 6874 7470 733a 2f2f 646f 6373 2e70 7974  https://docs.pyt
+000551f0: 686f 6e2e 6f72 672f 332f 6c69 6272 6172  hon.org/3/librar
+00055200: 792f 7374 6174 6973 7469 6373 2e68 746d  y/statistics.htm
+00055210: 6c0a 0a20 2020 2020 2020 2046 6f72 2069  l..        For i
+00055220: 7473 2075 7365 2068 6572 652c 2074 6865  ts use here, the
+00055230: 2072 656c 6576 616e 7420 6675 6e63 7469   relevant functi
+00055240: 6f6e 206d 7573 7420 7265 7175 6972 650a  on must require.
+00055250: 2020 2020 2020 2020 6120 7369 6e67 6c65          a single
+00055260: 2d76 6172 6961 626c 6520 696e 7075 742c  -variable input,
+00055270: 206d 7573 7420 6e6f 7420 7265 7175 6972   must not requir
+00055280: 6520 616e 7920 6b65 7977 6f72 640a 2020  e any keyword.  
+00055290: 2020 2020 2020 6172 6775 6d65 6e74 732c        arguments,
+000552a0: 2061 6e64 206d 7573 7420 7265 7475 726e   and must return
+000552b0: 2061 2073 696e 676c 6520 6e75 6d62 6572   a single number
+000552c0: 2e0a 0a20 2020 2020 2020 2041 7661 696c  ...        Avail
+000552d0: 6162 6c65 206f 7074 696f 6e73 2069 6e63  able options inc
+000552e0: 6c75 6465 3a20 226d 6561 6e22 2c20 226d  lude: "mean", "m
+000552f0: 6564 6961 6e22 2c20 226d 6f64 6522 2c0a  edian", "mode",.
+00055300: 2020 2020 2020 2020 2273 7464 6576 222e          "stdev".
+00055310: 0a0a 2020 2020 2020 2053 7461 7469 7374  ..       Statist
+00055320: 6963 7320 746f 2062 6520 6361 6c63 756c  ics to be calcul
+00055330: 6174 6564 2063 616e 2062 6520 7370 6563  ated can be spec
+00055340: 6966 6965 6420 7573 696e 6720 616e 7920  ified using any 
+00055350: 6f66 0a20 2020 2020 2020 7468 6520 666f  of.       the fo
+00055360: 6c6c 6f77 696e 673a 0a0a 2020 2020 2020  llowing:..      
+00055370: 202d 2053 7472 696e 6720 7370 6563 6966   - String specif
+00055380: 7969 6e67 2073 696e 676c 6520 7374 6174  ying single stat
+00055390: 6973 7469 6320 746f 2062 6520 6361 6c63  istic to be calc
+000553a0: 756c 6174 6564 2c0a 2020 2020 2020 2020  ulated,.        
+000553b0: 2077 6974 6820 736c 6963 6573 2063 6f6e   with slices con
+000553c0: 7369 6465 7265 6420 6173 2067 6976 656e  sidered as given
+000553d0: 2062 7920 3c64 6566 6175 6c74 5f62 795f   by <default_by_
+000553e0: 736c 6963 653e 2c0a 2020 2020 2020 2020  slice>,.        
+000553f0: 2066 6f72 2065 7861 6d70 6c65 3a20 226d   for example: "m
+00055400: 6561 6e22 3b0a 2020 2020 2020 202d 204c  ean";.       - L
+00055410: 6973 7420 7370 6563 6966 7969 6e67 206d  ist specifying m
+00055420: 756c 7469 706c 6520 7374 6174 6973 7469  ultiple statisti
+00055430: 6373 2074 6f20 6265 2063 616c 6375 6c61  cs to be calcula
+00055440: 7465 642c 0a20 2020 2020 2020 2020 7769  ted,.         wi
+00055450: 7468 2073 6c69 6365 7320 636f 6e73 6964  th slices consid
+00055460: 6572 6564 2061 7320 6769 7665 6e20 6279  ered as given by
+00055470: 203c 6465 6661 756c 745f 6279 5f73 6c69   <default_by_sli
+00055480: 6365 3e2c 0a20 2020 2020 2020 2020 666f  ce>,.         fo
+00055490: 7220 6578 616d 706c 653a 205b 226d 6561  r example: ["mea
+000554a0: 6e22 2c20 2273 7464 6576 225d 3b0a 2020  n", "stdev"];.  
+000554b0: 2020 2020 202d 2044 6963 7469 6f6e 6172       - Dictionar
+000554c0: 7920 7768 6572 6520 6b65 7973 2073 7065  y where keys spe
+000554d0: 6369 6679 2073 6c69 6365 7320 746f 2062  cify slices to b
+000554e0: 6520 636f 6e73 6964 6572 6564 2c0a 2020  e considered,.  
+000554f0: 2020 2020 2020 2061 6e64 2076 616c 7565         and value
+00055500: 7320 7370 6563 6966 7920 7374 6174 6973  s specify statis
+00055510: 7469 6373 2028 7374 7269 6e67 206f 7220  tics (string or 
+00055520: 6c69 7374 292c 2066 6f72 0a20 2020 2020  list), for.     
+00055530: 2020 2020 6578 616d 706c 653a 207b 2275      example: {"u
+00055540: 6e69 6f6e 223a 205b 226d 6561 6e22 2c20  nion": ["mean", 
+00055550: 2273 7464 6576 225d 7d2e 2020 5661 6c69  "stdev"]}.  Vali
+00055560: 6420 736c 6963 650a 2020 2020 2020 2020  d slice.        
+00055570: 2073 7065 6369 6669 6361 7469 6f6e 7320   specifications 
+00055580: 6172 6520 6173 206c 6973 7465 6420 666f  are as listed fo
+00055590: 7220 3c64 6566 6175 6c74 5f62 795f 736c  r <default_by_sl
+000555a0: 6963 653e 2e0a 0a20 2020 2064 6566 6175  ice>...    defau
+000555b0: 6c74 5f62 795f 736c 6963 653a 2073 7472  lt_by_slice: str
+000555c0: 2c20 6465 6661 756c 743d 4e6f 6e65 0a20  , default=None. 
+000555d0: 2020 2020 2020 2044 6566 6175 6c74 2073         Default s
+000555e0: 7065 6369 6669 6361 7469 6f6e 206f 6620  pecification of 
+000555f0: 736c 6963 6573 2074 6f20 6265 2063 6f6e  slices to be con
+00055600: 7369 6465 7265 6420 7768 656e 0a20 2020  sidered when.   
+00055610: 2020 2020 2063 616c 6375 6c61 7469 6e67       calculating
+00055620: 2073 6c69 6365 2d62 792d 736c 6963 6520   slice-by-slice 
+00055630: 7374 6174 6973 7469 6373 2066 6f72 2061  statistics for a
+00055640: 206d 6574 7269 6320 636f 6d70 6172 696e   metric comparin
+00055650: 670a 2020 2020 2020 2020 7477 6f20 524f  g.        two RO
+00055660: 4973 2c20 726f 6931 2061 6e64 2072 6f69  Is, roi1 and roi
+00055670: 322e 2020 5468 6520 7661 6c69 6420 7370  2.  The valid sp
+00055680: 6563 6966 6963 6174 696f 6e73 2061 7265  ecifications are
+00055690: 3a0a 0a20 2020 2020 2020 202d 2022 6c65  :..        - "le
+000556a0: 6674 223a 2063 6f6e 7369 6465 7220 6f6e  ft": consider on
+000556b0: 6c79 2073 6c69 6365 7320 636f 6e74 6169  ly slices contai
+000556c0: 6e69 6e67 2072 6f69 313b 0a20 2020 2020  ning roi1;.     
+000556d0: 2020 202d 2022 7269 6768 7422 3a20 636f     - "right": co
+000556e0: 6e73 6964 6572 206f 6e6c 7920 736c 6963  nsider only slic
+000556f0: 6573 2063 6f6e 7461 696e 696e 6720 726f  es containing ro
+00055700: 6932 3b0a 2020 2020 2020 2020 2d20 2275  i2;.        - "u
+00055710: 6e69 6f6e 223a 2063 6f6e 7369 6465 7220  nion": consider 
+00055720: 736c 6963 6573 2063 6f6e 7461 696e 696e  slices containin
+00055730: 6720 6569 7468 6572 206f 6620 726f 6931  g either of roi1
+00055740: 2061 6e64 2072 6f69 323b 0a20 2020 2020   and roi2;.     
+00055750: 2020 202d 2022 696e 7465 7273 6563 7469     - "intersecti
+00055760: 6f6e 223a 2063 6f6e 7369 6465 7220 736c  on": consider sl
+00055770: 6963 6573 2063 6f6e 7461 696e 696e 6720  ices containing 
+00055780: 626f 7468 2072 6f69 3120 616e 6420 726f  both roi1 and ro
+00055790: 6932 2e0a 0a20 2020 2020 2020 2049 6620  i2...        If 
+000557a0: 4e6f 6e65 2c20 7573 6520 736b 7274 2e63  None, use skrt.c
+000557b0: 6f72 652e 4465 6661 756c 7473 2829 2e62  ore.Defaults().b
+000557c0: 795f 736c 6963 650a 2020 2020 2222 220a  y_slice.    """.
+000557d0: 2020 2020 6966 206e 6f74 2073 6c69 6365      if not slice
+000557e0: 5f73 7461 7473 3a0a 2020 2020 2020 2020  _stats:.        
+000557f0: 7265 7475 726e 207b 7d0a 0a20 2020 2023  return {}..    #
+00055800: 2053 6574 2064 6566 6175 6c74 206d 6574   Set default met
+00055810: 686f 6420 666f 7220 736c 6963 6520 7365  hod for slice se
+00055820: 6c65 6374 696f 6e2e 0a20 2020 2064 6566  lection..    def
+00055830: 6175 6c74 5f62 795f 736c 6963 6520 3d20  ault_by_slice = 
+00055840: 6465 6661 756c 745f 6279 5f73 6c69 6365  default_by_slice
+00055850: 206f 7220 736b 7274 2e63 6f72 652e 4465   or skrt.core.De
+00055860: 6661 756c 7473 2829 2e62 795f 736c 6963  faults().by_slic
+00055870: 650a 0a20 2020 2023 2045 6e73 7572 6520  e..    # Ensure 
+00055880: 7468 6174 2073 6c69 6365 5f73 7461 7473  that slice_stats
+00055890: 2069 7320 6120 6469 6374 696f 6e61 7279   is a dictionary
+000558a0: 2e0a 2020 2020 6966 2069 7369 6e73 7461  ..    if isinsta
+000558b0: 6e63 6528 736c 6963 655f 7374 6174 732c  nce(slice_stats,
+000558c0: 2073 7472 293a 0a20 2020 2020 2020 2073   str):.        s
+000558d0: 6c69 6365 5f73 7461 7473 203d 207b 6465  lice_stats = {de
+000558e0: 6661 756c 745f 6279 5f73 6c69 6365 3a20  fault_by_slice: 
+000558f0: 5b73 6c69 6365 5f73 7461 7473 5d7d 0a0a  [slice_stats]}..
+00055900: 2020 2020 656c 6966 2073 6b72 742e 636f      elif skrt.co
+00055910: 7265 2e69 735f 6c69 7374 2873 6c69 6365  re.is_list(slice
+00055920: 5f73 7461 7473 293a 0a20 2020 2020 2020  _stats):.       
+00055930: 2073 6c69 6365 5f73 7461 7473 203d 207b   slice_stats = {
+00055940: 6465 6661 756c 745f 6279 5f73 6c69 6365  default_by_slice
+00055950: 3a20 736c 6963 655f 7374 6174 737d 0a0a  : slice_stats}..
+00055960: 2020 2020 656c 6966 2069 7369 6e73 7461      elif isinsta
+00055970: 6e63 6528 736c 6963 655f 7374 6174 732c  nce(slice_stats,
+00055980: 2064 6963 7429 3a0a 2020 2020 2020 2020   dict):.        
+00055990: 6368 6563 6b65 645f 736c 6963 655f 7374  checked_slice_st
+000559a0: 6174 7320 3d20 7b7d 0a20 2020 2020 2020  ats = {}.       
+000559b0: 2066 6f72 2062 795f 736c 6963 652c 2073   for by_slice, s
+000559c0: 7461 7473 2069 6e20 736c 6963 655f 7374  tats in slice_st
+000559d0: 6174 732e 6974 656d 7328 293a 0a20 2020  ats.items():.   
+000559e0: 2020 2020 2020 2020 2069 6620 6973 696e           if isin
+000559f0: 7374 616e 6365 2873 7461 7473 2c20 7374  stance(stats, st
+00055a00: 7229 3a0a 2020 2020 2020 2020 2020 2020  r):.            
+00055a10: 2020 2020 6368 6563 6b65 645f 736c 6963      checked_slic
+00055a20: 655f 7374 6174 735b 6279 5f73 6c69 6365  e_stats[by_slice
+00055a30: 5d20 3d20 5b73 7461 7473 5d0a 2020 2020  ] = [stats].    
+00055a40: 2020 2020 2020 2020 656c 6966 2073 6b72          elif skr
+00055a50: 742e 636f 7265 2e69 735f 6c69 7374 2873  t.core.is_list(s
+00055a60: 7461 7473 293a 0a20 2020 2020 2020 2020  tats):.         
+00055a70: 2020 2020 2020 2063 6865 636b 6564 5f73         checked_s
+00055a80: 6c69 6365 5f73 7461 7473 5b62 795f 736c  lice_stats[by_sl
+00055a90: 6963 655d 203d 206c 6973 7428 7374 6174  ice] = list(stat
+00055aa0: 7329 0a20 2020 2020 2020 2073 6c69 6365  s).        slice
+00055ab0: 5f73 7461 7473 203d 2063 6865 636b 6564  _stats = checked
+00055ac0: 5f73 6c69 6365 5f73 7461 7473 0a0a 2020  _slice_stats..  
+00055ad0: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
+00055ae0: 736c 6963 655f 7374 6174 732c 2064 6963  slice_stats, dic
+00055af0: 7429 3a0a 2020 2020 2020 2020 7265 7475  t):.        retu
+00055b00: 726e 2073 6c69 6365 5f73 7461 7473 0a0a  rn slice_stats..
+00055b10: 2020 2020 7265 7475 726e 207b 7d0a           return {}.
```

### Comparing `scikit-rt-0.4.3/src/skrt/viewer/core.py` & `scikit-rt-0.4.4/src/skrt/viewer/core.py`

 * *Files identical despite different names*

### Comparing `scikit-rt-0.4.3/src/skrt/viewer/viewer.py` & `scikit-rt-0.4.4/src/skrt/viewer/viewer.py`

 * *Files identical despite different names*

### Comparing `scikit-rt-0.4.3/tests/test_01_setup.py` & `scikit-rt-0.4.4/tests/test_01_setup.py`

 * *Files identical despite different names*

### Comparing `scikit-rt-0.4.3/tests/test_application.py` & `scikit-rt-0.4.4/tests/test_application.py`

 * *Files identical despite different names*

### Comparing `scikit-rt-0.4.3/tests/test_core.py` & `scikit-rt-0.4.4/tests/test_core.py`

 * *Files identical despite different names*

### Comparing `scikit-rt-0.4.3/tests/test_dose.py` & `scikit-rt-0.4.4/tests/test_dose.py`

 * *Files identical despite different names*

### Comparing `scikit-rt-0.4.3/tests/test_image.py` & `scikit-rt-0.4.4/tests/test_image.py`

 * *Files identical despite different names*

### Comparing `scikit-rt-0.4.3/tests/test_multi.py` & `scikit-rt-0.4.4/tests/test_multi.py`

 * *Files identical despite different names*

### Comparing `scikit-rt-0.4.3/tests/test_patient.py` & `scikit-rt-0.4.4/tests/test_patient.py`

 * *Files identical despite different names*

### Comparing `scikit-rt-0.4.3/tests/test_qv_image.py` & `scikit-rt-0.4.4/tests/test_qv_image.py`

 * *Files identical despite different names*

### Comparing `scikit-rt-0.4.3/tests/test_qv_quickviewer.py` & `scikit-rt-0.4.4/tests/test_qv_quickviewer.py`

 * *Files identical despite different names*

### Comparing `scikit-rt-0.4.3/tests/test_qv_struct_loader.py` & `scikit-rt-0.4.4/tests/test_qv_struct_loader.py`

 * *Files identical despite different names*

### Comparing `scikit-rt-0.4.3/tests/test_qv_struct_metrics.py` & `scikit-rt-0.4.4/tests/test_qv_struct_metrics.py`

 * *Files identical despite different names*

### Comparing `scikit-rt-0.4.3/tests/test_qv_structs.py` & `scikit-rt-0.4.4/tests/test_qv_structs.py`

 * *Files identical despite different names*

### Comparing `scikit-rt-0.4.3/tests/test_registration.py` & `scikit-rt-0.4.4/tests/test_registration.py`

 * *Files 2% similar despite different names*

```diff
@@ -24,14 +24,28 @@
 pfiles_dir = get_default_pfiles_dir()
 
 # Directory to store test registration data
 reg_dir = "tmp/reg"
 if os.path.exists(reg_dir):
     shutil.rmtree(reg_dir)
     
+# Directory for NiftyReg files.
+niftyreg_dir = Path("tmp/niftyreg")
+if niftyreg_dir.exists():
+    shutil.rmtree(str(niftyreg_dir))
+niftyreg_dir.mkdir()
+
+# Test affine matrix.
+affine = [
+        [11, 12, 13, 14],
+        [21, 22, 23, 24],
+        [31, 32, 33, 34],
+        [41, 42, 43, 44],
+        ]
+
 # Test images
 sim1 = SyntheticImage((10, 12, 8))
 sim1.add_cube(2, centre=(4, 4, 4))
 im1 = sim1.get_image()
 sim2 = SyntheticImage((11, 11, 11))
 sim2.add_cube(2, centre=(6, 6, 6))
 im2 = sim2.get_image()
@@ -589,15 +603,15 @@
             set_engine_dir(path="unknown", engine=engine)
         assert ("not implemented" in str(error_info.value)
                 or "executable(s) not found" in str(error_info.value))
 
     # Check that exception is raised if engine name is unknown.
     with pytest.raises(RuntimeError) as error_info:
         set_engine_dir(path="unknown", engine="unknown")
-    assert "engine not known" in str(error_info.value)
+    assert "executable(s) not found" in str(error_info.value)
 
 
 def test_set_elastix_dir():
     """Test deprecated function for setting elastix installation directory."""
     # Check that deprecation warning is issued,
     # and that exception is raised if elastix software not insalled
     # in specified directory.
@@ -868,7 +882,46 @@
     for exe in type(engine).exes:
         assert getattr(engine, exe)  == exe
 
 def test_get_jacobian_colormap():
     cmap = get_jacobian_colormap()
     assert isinstance(cmap, matplotlib.colors.LinearSegmentedColormap)
     assert "jacobian" == cmap.name
+
+def test_niftyreg_write_and_read_affine():
+    """Test writing and reading of affine matrix."""
+    niftyreg = NiftyReg()
+
+    # Write affine matrix to file.
+    transform_path = niftyreg_dir / "transform.txt"
+    transform_path.unlink(missing_ok=True)
+    assert not transform_path.exists()
+    niftyreg.write_affine(affine, transform_path)
+    assert transform_path.exists()
+
+    # Read affine matrix from file.
+    affine_from_file = niftyreg.read_affine(transform_path)
+    assert affine == affine_from_file
+
+def test_niftyreg_shift_translation_parameters():
+    """Test shifting of translation parameters for NiftyReg affine transform."""
+    niftyreg = NiftyReg()
+
+    # Define offsets, and signs to match elastix convention.
+    dxdydz = (94, 2, 5)
+    signs = (-1, -1, 1)
+
+    # Write initial affine matrix to file.
+    transform_path = niftyreg_dir / "transform.txt"
+    niftyreg.write_affine(affine, transform_path)
+    assert transform_path.exists()
+
+    # Apply shifts, and check that result is as expected.
+    shifted_path = niftyreg_dir / "shifted.txt"
+    niftyreg.shift_translation_parameters(transform_path, *dxdydz, shifted_path)
+    shifted = niftyreg.read_affine(shifted_path)
+    for irow, row in enumerate(shifted):
+        for icol, val in enumerate(row):
+            if irow <= 2 and icol == 3:
+                assert val == affine[irow][icol] + signs[irow] * dxdydz[irow]
+            else:
+                assert val == affine[irow][icol]
```

### Comparing `scikit-rt-0.4.3/tests/test_roi_metrics.py` & `scikit-rt-0.4.4/tests/test_roi_metrics.py`

 * *Files identical despite different names*

### Comparing `scikit-rt-0.4.3/tests/test_segmentation.py` & `scikit-rt-0.4.4/tests/test_segmentation.py`

 * *Files identical despite different names*

### Comparing `scikit-rt-0.4.3/tests/test_structs.py` & `scikit-rt-0.4.4/tests/test_structs.py`

 * *Files identical despite different names*

### Comparing `scikit-rt-0.4.3/tests/test_synthetic_image.py` & `scikit-rt-0.4.4/tests/test_synthetic_image.py`

 * *Files identical despite different names*

### Comparing `scikit-rt-0.4.3/tests/test_viewer.py` & `scikit-rt-0.4.4/tests/test_viewer.py`

 * *Files identical despite different names*

