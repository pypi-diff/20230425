# Comparing `tmp/accel-0.2.1-py3-none-any.whl.zip` & `tmp/accel-0.2.2-py3-none-any.whl.zip`

## zipinfo {}

```diff
@@ -1,16 +1,16 @@
-Zip file size: 61810 bytes, number of entries: 35
--rw-rw-rw-  2.0 fat      199 b- defN 23-Feb-15 08:56 accel/__init__.py
+Zip file size: 62095 bytes, number of entries: 35
+-rw-rw-rw-  2.0 fat      199 b- defN 23-Apr-25 06:55 accel/__init__.py
 -rw-rw-rw-  2.0 fat        0 b- defN 21-Jul-01 06:20 accel/__main__.py
 -rw-rw-rw-  2.0 fat        0 b- defN 22-Apr-24 06:17 accel/base/__init__.py
 -rw-rw-rw-  2.0 fat    14361 b- defN 22-Sep-14 09:56 accel/base/atoms.py
 -rw-rw-rw-  2.0 fat     2514 b- defN 22-Aug-23 04:00 accel/base/box.py
 -rw-rw-rw-  2.0 fat    22595 b- defN 23-Feb-01 02:23 accel/base/boxcore.py
 -rw-rw-rw-  2.0 fat    10265 b- defN 22-Dec-13 04:06 accel/base/formats.py
--rw-rw-rw-  2.0 fat    59807 b- defN 23-Feb-15 08:36 accel/base/modeler.py
+-rw-rw-rw-  2.0 fat    62554 b- defN 23-Apr-24 14:07 accel/base/modeler.py
 -rw-rw-rw-  2.0 fat      830 b- defN 22-Aug-23 04:00 accel/base/selector.py
 -rw-rw-rw-  2.0 fat    13436 b- defN 23-Feb-05 06:09 accel/base/systems.py
 -rw-rw-rw-  2.0 fat     1290 b- defN 22-Aug-23 04:00 accel/base/tools.py
 -rw-rw-rw-  2.0 fat    17216 b- defN 22-Aug-23 04:00 accel/base/topology.py
 -rw-rw-rw-  2.0 fat      755 b- defN 22-May-11 09:47 accel/plugin/__init__.py
 -rw-rw-rw-  2.0 fat    31834 b- defN 23-Feb-05 05:59 accel/plugin/gaulib.py
 -rw-rw-rw-  2.0 fat    10488 b- defN 23-Feb-05 06:02 accel/plugin/maelib.py
@@ -25,13 +25,13 @@
 -rw-rw-rw-  2.0 fat     1519 b- defN 23-Feb-05 07:21 accel/util/dialogue.py
 -rw-rw-rw-  2.0 fat     7662 b- defN 22-Apr-24 05:35 accel/util/elements.pkl
 -rw-rw-rw-  2.0 fat      546 b- defN 22-Aug-23 04:00 accel/util/execmd.py
 -rw-rw-rw-  2.0 fat      687 b- defN 22-Aug-23 04:00 accel/util/filetype.py
 -rw-rw-rw-  2.0 fat     4073 b- defN 23-Feb-05 07:59 accel/util/log.py
 -rw-rw-rw-  2.0 fat     7508 b- defN 22-Nov-24 03:42 accel/util/logo32.png
 -rw-rw-rw-  2.0 fat     2978 b- defN 22-Aug-23 04:00 accel/util/matrix.py
--rw-rw-rw-  2.0 fat     1059 b- defN 23-Feb-15 08:56 accel-0.2.1.dist-info/LICENSE
--rw-rw-rw-  2.0 fat      515 b- defN 23-Feb-15 08:56 accel-0.2.1.dist-info/METADATA
--rw-rw-rw-  2.0 fat       92 b- defN 23-Feb-15 08:56 accel-0.2.1.dist-info/WHEEL
--rw-rw-rw-  2.0 fat        6 b- defN 23-Feb-15 08:56 accel-0.2.1.dist-info/top_level.txt
-?rw-rw-r--  2.0 fat     2706 b- defN 23-Feb-15 08:56 accel-0.2.1.dist-info/RECORD
-35 files, 235118 bytes uncompressed, 57576 bytes compressed:  75.5%
+-rw-rw-rw-  2.0 fat     1059 b- defN 23-Apr-25 06:55 accel-0.2.2.dist-info/LICENSE
+-rw-rw-rw-  2.0 fat      515 b- defN 23-Apr-25 06:55 accel-0.2.2.dist-info/METADATA
+-rw-rw-rw-  2.0 fat       92 b- defN 23-Apr-25 06:55 accel-0.2.2.dist-info/WHEEL
+-rw-rw-rw-  2.0 fat        6 b- defN 23-Apr-25 06:55 accel-0.2.2.dist-info/top_level.txt
+?rw-rw-r--  2.0 fat     2706 b- defN 23-Apr-25 06:55 accel-0.2.2.dist-info/RECORD
+35 files, 237865 bytes uncompressed, 57861 bytes compressed:  75.7%
```

## zipnote {}

```diff
@@ -84,23 +84,23 @@
 
 Filename: accel/util/logo32.png
 Comment: 
 
 Filename: accel/util/matrix.py
 Comment: 
 
-Filename: accel-0.2.1.dist-info/LICENSE
+Filename: accel-0.2.2.dist-info/LICENSE
 Comment: 
 
-Filename: accel-0.2.1.dist-info/METADATA
+Filename: accel-0.2.2.dist-info/METADATA
 Comment: 
 
-Filename: accel-0.2.1.dist-info/WHEEL
+Filename: accel-0.2.2.dist-info/WHEEL
 Comment: 
 
-Filename: accel-0.2.1.dist-info/top_level.txt
+Filename: accel-0.2.2.dist-info/top_level.txt
 Comment: 
 
-Filename: accel-0.2.1.dist-info/RECORD
+Filename: accel-0.2.2.dist-info/RECORD
 Comment: 
 
 Zip file comment:
```

## accel/__init__.py

```diff
@@ -1,7 +1,7 @@
-__version__ = "0.2.1"
+__version__ = "0.2.2"
 
 from accel.base.atoms import Atom, Atoms
 from accel.base.box import Box
 from accel.base.systems import System, Systems
 
 __all__ = ["Box", "System", "Atom", "Systems", "Atoms"]
```

## accel/base/modeler.py

```diff
@@ -466,21 +466,23 @@
                             break
                     else:
                         numisomer_mat_list.append(a.cache["isomeric_subs_list"][0]["matrix"])
                         continue
                 rot_mat = a.cache["isomeric_subs_list"][0]["matrix"]
                 rot_mat = rot_mat.astype(int)
                 rotamer_mat_list.append(rot_mat)
-            elif [len(a.bonds), len(a.cache["isomeric_subs_list"])] in [[4, 3], [4, 6]]:
+            elif [len(a.bonds), len(a.cache["isomeric_subs_list"])] in [[4, 3], [4, 6], [3, 3]]:
                 for _ps in a.cache["isomeric_subs_list"][1:]:
                     rot_mat = np.dot(_ps["matrix"], a.cache["isomeric_subs_list"][0]["matrix"])
                     rot_mat = rot_mat.astype(int)
                     rotamer_mat_list.append(rot_mat)
                 for _ps in a.cache["isomeric_subs_list"]:
                     numisomer_mat_list.append(_ps["matrix"])
+                if [len(a.bonds), len(a.cache["isomeric_subs_list"])] in [[3, 3]]:
+                    rotamer_mat_list.append(a.cache["isomeric_subs_list"][0]["matrix"])
             else:
                 for _ps in a.cache["isomeric_subs_list"]:
                     numisomer_mat_list.append(_ps["matrix"])
 
         # generate identical collections of rot_mat
         rotamer_mat_list = list({_m.tobytes(): _m for _m in rotamer_mat_list}.values())
         numisomer_mat_list = list({_m.tobytes(): _m for _m in numisomer_mat_list}.values())
@@ -495,40 +497,82 @@
                 _b_indexs = sorted(a.number - 1 for a in _a.bonds)
                 original_matirix = original_xyz[_b_indexs[1:]] - original_xyz[_b_indexs[0]]
                 modified_matirix = modified_xyz[_b_indexs[1:]] - modified_xyz[_b_indexs[0]]
                 if (np.linalg.det(original_matirix) > 0) != (np.linalg.det(modified_matirix) > 0):
                     invalid_count += 1
             return invalid_count
 
+        def _get_invalid_chiral_atoms(atoms: Atoms, modified_xyz: np.ndarray) -> list[Atom]:
+            original_xyz = np.array([a.xyz for a in atoms])
+            ret_list = []
+            for _a in atoms:
+                if len(_a.bonds) != 4:
+                    continue
+                _b_indexs = sorted(a.number - 1 for a in _a.bonds)
+                original_matirix = original_xyz[_b_indexs[1:]] - original_xyz[_b_indexs[0]]
+                modified_matirix = modified_xyz[_b_indexs[1:]] - modified_xyz[_b_indexs[0]]
+                if (np.linalg.det(original_matirix) > 0) != (np.linalg.det(modified_matirix) > 0):
+                    ret_list.append(_a)
+            return ret_list
+
         # for TMS, cyclic_chiral_check has error
-        def _cyclic_chiral_check(atoms: Atoms, rotamer_mat_list, numisomer_mat_list):
+        def _cyclic_chiral_check_legacy(atoms: Atoms, rotamer_mat_list, numisomer_mat_list):
             unchanged_flag = True
             for rm_idx, rot_mat in enumerate(rotamer_mat_list):
                 original_xyz = np.array([at.xyz for at in atoms])
                 number_of_invalid = _invalid_chirality(atoms, np.dot(rot_mat, original_xyz))
+                logger.debug(f"number of invalid chirality for rotemer matrix {rm_idx} is {number_of_invalid}")
                 if number_of_invalid == 0:
                     continue
-                for num_mat in numisomer_mat_list:
+                for num_mat in reversed(numisomer_mat_list):
                     t_mat = np.dot(num_mat, rot_mat)
                     if _invalid_chirality(atoms, np.dot(t_mat, original_xyz)) < number_of_invalid:
                         rotamer_mat_list[rm_idx] = t_mat
                         unchanged_flag = False
                         logger.debug("chirality in rotamer matrix was partially corrected")
                         break
                 else:
                     logger.debug("chirality in rotamer matrix temporarily corrected")
             return unchanged_flag
 
+        def _cyclic_chiral_check(atoms: Atoms, rotamer_mat_list, numisomer_mat_list):
+            unchanged_flag = True
+            for rm_idx, rot_mat in enumerate(rotamer_mat_list):
+                original_xyz = np.array([at.xyz for at in atoms])
+                invalid_atoms = _get_invalid_chiral_atoms(atoms, np.dot(rot_mat, original_xyz))
+                if len(invalid_atoms) == 0:
+                    continue
+                logger.debug(
+                    f"invalid chiral atom is detected: {[str(ta) for ta in invalid_atoms]} in mat_idx {rm_idx}"
+                )
+                for isosub in invalid_atoms[0].cache["isomeric_subs_list"]:
+                    t_mat = np.dot(isosub["matrix"], rot_mat)
+                    iv_atoms = _get_invalid_chiral_atoms(atoms, np.dot(t_mat, original_xyz))
+                    if len(iv_atoms) < len(invalid_atoms):
+                        rotamer_mat_list[rm_idx] = t_mat
+                        unchanged_flag = False
+                        logger.debug("chirality in rotamer matrix was partially corrected")
+                        break
+                else:
+                    logger.debug("chirality in rotamer matrix not corrected")
+            return unchanged_flag
+
         if len(rotamer_mat_list) != 0:
-            for _ in range(len(rotamer_mat_list)):
-                if _cyclic_chiral_check(self.atoms, rotamer_mat_list, numisomer_mat_list):
-                    logger.debug("chirality in rotamer matrix was successfully corrected")
-                    break
-            else:
-                logger.error("chirality in rotamer matrix was not completely corrected")
+            if not _cyclic_chiral_check(self.atoms, rotamer_mat_list, numisomer_mat_list):
+                for _ in range(len(rotamer_mat_list) * len(numisomer_mat_list)):
+                    if _cyclic_chiral_check(self.atoms, rotamer_mat_list, numisomer_mat_list):
+                        logger.debug("chirality in rotamer matrix was successfully corrected")
+                        break
+                else:
+                    for _ in range(len(rotamer_mat_list) * len(numisomer_mat_list)):
+                        if _cyclic_chiral_check_legacy(self.atoms, rotamer_mat_list, numisomer_mat_list):
+                            logger.debug("chirality in rotamer matrix was successfully corrected by legacy protocol")
+                            break
+                    else:
+                        logger.error("chirality in rotamer matrix was not completely corrected")
 
         # generate identical collections of rot_mat again
         rotamer_mat_list = {_m.tobytes(): _m for _m in rotamer_mat_list}.values()
         numisomer_mat_list = {_m.tobytes(): _m for _m in numisomer_mat_list}.values()
 
         # added matrix property
         rotamer_mat_list = [Matrix(self.atoms.to_list()).bind(_m) for _m in rotamer_mat_list]
```

## Comparing `accel-0.2.1.dist-info/LICENSE` & `accel-0.2.2.dist-info/LICENSE`

 * *Files identical despite different names*

## Comparing `accel-0.2.1.dist-info/METADATA` & `accel-0.2.2.dist-info/METADATA`

 * *Files 23% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: accel
-Version: 0.2.1
+Version: 0.2.2
 Summary: automated computation chemical library specialized for handling large numbers of conformers
 Home-page: https://github.com/kfchem/accel
 Author: Keisuke Fukaya
 Author-email: kfukaya@pu-toyama.ac.jp
 License: MIT License
 Platform: UNKNOWN
 Classifier: Programming Language :: Python :: 3
```

## Comparing `accel-0.2.1.dist-info/RECORD` & `accel-0.2.2.dist-info/RECORD`

 * *Files 12% similar despite different names*

```diff
@@ -1,15 +1,15 @@
-accel/__init__.py,sha256=QXsMCdsTjtZidIyGgRnzYTF_a6haSEoupFUsikpzMqU,199
+accel/__init__.py,sha256=Vn_QNfk2fY06KKAU_THqfARle2grfesNpTRb0eB705g,199
 accel/__main__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 accel/base/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 accel/base/atoms.py,sha256=x9l25TMqLlpOf4Nhjjt6580CfqiOw1JTjd71Y3pmxbI,14361
 accel/base/box.py,sha256=5pka1-hA7-SeIG9HUI07V-xRFCWESShdcnziElCrv_E,2514
 accel/base/boxcore.py,sha256=tm5XwgY4xh966UOI2meelPzlnl0UmXgsc4cyWn6z_vk,22595
 accel/base/formats.py,sha256=xCzSv5_jRxCAoZYQLmXZDYKk-MajT4EQW_rkEK_ywE0,10265
-accel/base/modeler.py,sha256=b--R7hVUnUrDqnzumRq5kQyfAY7IiYFyKyswAALXPCw,59807
+accel/base/modeler.py,sha256=RwTbHMGFR6Mr-hEk-kTBALXDeK_4a9uS-zzw6HXm46I,62554
 accel/base/selector.py,sha256=BZERAbMyb1KoqfBW1c1EC4WTBsKgsfFGQnEh105oQKg,830
 accel/base/systems.py,sha256=08px0f8bFeMwnpf9tOS6P7gYBecjToqmZNNFtMGPfus,13436
 accel/base/tools.py,sha256=O40JDiua5a0RzBBEl13BN_QvfJ_WdhDcuQsz96PLUV8,1290
 accel/base/topology.py,sha256=BNgDRvmcsZorU2l08eqq9tfd7yyMvvaeAyr-M_V9FHA,17216
 accel/plugin/__init__.py,sha256=vIESlj9VGQnUMOVXn6UZHBfGKz54JtsDgJoLUeWMP6M,755
 accel/plugin/gaulib.py,sha256=NRf41yAweIgZd4Rj1qmoOReR_YDrk96OuniqQKy7-qs,31834
 accel/plugin/maelib.py,sha256=wS2AvjW0rMZTquxlB8sdLODjg9-KSMFLf9dS3hOgT4I,10488
@@ -24,12 +24,12 @@
 accel/util/dialogue.py,sha256=-s65zXRnEOohyH7N1ZEhDG9Z9p8e1b_Inog_oPkiK4s,1519
 accel/util/elements.pkl,sha256=JsxWQoKC4IovYUqReMqkHIuU9ykIiWK_Jl7Lgl1lDOg,7662
 accel/util/execmd.py,sha256=kyqgnB2etvU7de3gXlWKmv7H-_GIVRih-Jkl50jK1-o,546
 accel/util/filetype.py,sha256=JKpyowreNB3_lch7fJVBTDwJnHt7XC2LTPpAykZwW-o,687
 accel/util/log.py,sha256=N0eJUOkKU1TiZWAFC9BTEbh7AqPbBTsD08Tufu-l_6M,4073
 accel/util/logo32.png,sha256=fX2pmSs70rTbXTuGlTvy6hqSHjZ4VejSxtZ7F2o6_Wk,7508
 accel/util/matrix.py,sha256=ln-YsbzuTBrGJh4R3YZekFDEV__pcZYyLc9enD0g3dY,2978
-accel-0.2.1.dist-info/LICENSE,sha256=6kVvPMd5fpiLN44G42XCWHb0Q_nDhLOMW1K4py7EY1I,1059
-accel-0.2.1.dist-info/METADATA,sha256=r3ni9MRcDa7DjEmD6-Or5KRL1nC48ZhzGwuN6-pXuQE,515
-accel-0.2.1.dist-info/WHEEL,sha256=G16H4A3IeoQmnOrYV4ueZGKSjhipXx8zc8nu9FGlvMA,92
-accel-0.2.1.dist-info/top_level.txt,sha256=rvhggDW-aRtU4KyyeMQ0SKa754UarbjRb4izBDCNj6g,6
-accel-0.2.1.dist-info/RECORD,,
+accel-0.2.2.dist-info/LICENSE,sha256=6kVvPMd5fpiLN44G42XCWHb0Q_nDhLOMW1K4py7EY1I,1059
+accel-0.2.2.dist-info/METADATA,sha256=rJEitfmCt2lCoyu068CgxkobHpoZ8ljAqs_S6PytVRI,515
+accel-0.2.2.dist-info/WHEEL,sha256=G16H4A3IeoQmnOrYV4ueZGKSjhipXx8zc8nu9FGlvMA,92
+accel-0.2.2.dist-info/top_level.txt,sha256=rvhggDW-aRtU4KyyeMQ0SKa754UarbjRb4izBDCNj6g,6
+accel-0.2.2.dist-info/RECORD,,
```

